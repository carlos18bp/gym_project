import{r as x,u as G,a as L,c as _,b as U,o as B,d as M,e as u,f as m,g as e,w as p,v as g,n as b,h as v,t as h,i as w,j as f,k as y,l as k,F as q,_ as D,m as I,R as S,p as C}from"./index.js";import{_ as F,s as o}from"./notification_message.js";import{l as O}from"./login_with_google.js";import"./sweetalert2.esm.all.js";const P=e("div",{class:"absolute"},[e("div",{class:"flex justify-center p-4"},[e("img",{src:D})])],-1),A={class:"flex h-screen items-center justify-start"},W={class:"space-y-5 px-8 w-full md:px-32 2xl:px-72 xl:w-1/2 2xl:w-2/3 order-2"},z=e("h1",{class:"font-bold text-center text-2xl xl:text-3xl 2xl:text-4xl"}," Te damos la bienvenida de nuevo ",-1),Y=e("label",{for:"email",class:"block mb-2 text-sm font-medium text-gray-900"}," Correo electronico ",-1),H=e("label",{for:"passcode",class:"block mb-2 text-sm font-medium text-gray-900"}," Código de verificación ",-1),J=["disabled"],K={key:0,class:"text-start text-sm mt-2 text-gray-600"},Q=e("span",{class:"font-regular"},"Enviar nuevo código en ",-1),X={class:"font-bold"},Z=e("span",{class:"font-regular"}," segundos.",-1),$=e("label",{for:"password",class:"block mb-2 text-sm font-medium text-gray-900"}," Contraseña ",-1),ee={class:"text-sm font-medium text-blue-800"},se={class:"flex flex-col space-y-2"},te=["disabled"],oe={key:0,class:"text-start text-sm mt-2 text-gray-600"},ae=e("span",{class:"font-regular"},"Intentar de nuevo en ",-1),ne={class:"font-bold"},le=e("span",{class:"font-regular"}," segundos.",-1),re=e("span",{class:"font-regular"},"¿Nuevo en G&M?",-1),ie={class:"font-regular text-blue-800"},de={class:"flex flex-col items-center justify-center text-center"},ce=e("div",{class:"flex items-center w-full mx-4"},[e("div",{class:"flex-grow border-t border-gray-300"}),e("span",{class:"mx-4 text-gray-500"},"O continuar con"),e("div",{class:"flex-grow border-t border-gray-300"})],-1),ue=e("div",{class:"h-screen hidden overflow-hidden order-1 xl:w-1/2 2xl:w-1/3 xl:block"},[e("img",{src:F,alt:"illustration",class:"w-full h-full object-cover"})],-1),_e={__name:"SignIn",setup(me){const l=x(0),c=G(),a=L(),r=x(!1),V=_(()=>a.signInTries),i=_(()=>a.signInSecondsRemaining),s=U({email:"",passcode:"",password:""});B(()=>{a.attempsSignIn("initial"),a.isAuthenticated&&c.push({name:"process_list",params:{user_id:"",display:""}})});const j=async()=>{if(!s.email){o("Email is required!","warning");return}if(a.attempsSignIn(),V.value%3===0)o("You have exceeded the maximum number of attempts. Please try again later.","warning");else try{const t=await C.post("/api/sign_in/",s);a.login(t.data),o("Sign In successful!","success"),c.push({name:"process_list",params:{user_id:"",display:""}})}catch(t){t.response&&t.response.status===401?o("Invalid credentials!","warning"):o("Sign On failed!","error")}s.passcode="",s.password=""},E=t=>{O(t,c,a)},N=async()=>{if(!s.email){o("Email is required!","warning");return}R();try{await C.post("/api/send_passcode/",{email:s.email,subject_email:"Login code"}),o("Password code sent to your email","info")}catch(t){console.error("Error when code is sent:",t),o("User not found","warning")}},R=()=>{r.value=!0,l.value=180;const t=setInterval(()=>{l.value--,l.value<=0&&(clearInterval(t),r.value=!1)},1e3)};return(t,n)=>{const T=M("GoogleLogin");return u(),m(q,null,[P,e("section",A,[e("form",W,[z,e("div",null,[Y,p(e("input",{"onUpdate:modelValue":n[0]||(n[0]=d=>s.email=d),type:"email",id:"email",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5",required:""},null,512),[[g,s.email]])]),e("div",null,[H,p(e("input",{"onUpdate:modelValue":n[1]||(n[1]=d=>s.passcode=d),type:"number",id:"passcode",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"},null,512),[[g,s.passcode]]),e("button",{class:b({"text-sm font-medium text-blue-800 cursor-pointer":!r.value,hidden:r.value}),onClick:v(N,["prevent"]),disabled:r.value}," Enviar código ",10,J),l.value>0?(u(),m("div",K,[Q,e("span",X,h(l.value),1),Z])):w("",!0)]),e("div",null,[$,p(e("input",{"onUpdate:modelValue":n[2]||(n[2]=d=>s.password=d),type:"password",id:"password",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5",placeholder:""},null,512),[[g,s.password]]),e("a",ee,[f(k(S),{to:{name:"forget_password"}},{default:y(()=>[I(" ¿Olvidaste tu contraseña? ")]),_:1})])]),e("div",se,[e("div",null,[e("button",{onClick:v(j,["prevent"]),type:"submit",disabled:i.value>1,class:b({"w-full text-white bg-blue-700 hover:bg-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center":i.value<1,"w-full text-white bg-gray-400 cursor-not-allowed font-medium rounded-lg text-sm px-5 py-2.5 text-center":i.value>=1})}," Iniciar sesión ",10,te),i.value>0?(u(),m("div",oe,[ae,e("span",ne,h(i.value),1),le])):w("",!0)]),e("p",null,[re,e("a",ie,[f(k(S),{to:{name:"sign_on"}},{default:y(()=>[I(" Registrarse. ")]),_:1})])])]),e("div",de,[ce,f(T,{class:"mt-6",callback:E,prompt:""})])]),ue])],64)}}};export{_e as default};
