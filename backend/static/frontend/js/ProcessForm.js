import{e as n,f as c,g as e,H as ae,ak as v,C as xe,D as he,ab as ve,r as b,c as T,I as be,a as _e,b as we,o as ke,T as z,a9 as Ce,w as _,v as w,h as l,i as y,j as r,p as m,F as A,N as B,n as x,l as k,y as E,a4 as G,k as F,t as P,J as Se,s as R}from"./index.js";import{a as H,i as X,n as Z,r as K,b as W,u as Y,l as Q}from"./combobox.js";import{r as ee}from"./TrashIcon.js";import{r as Ie}from"./EyeIcon.js";function te(h,d){return n(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"})])}async function se(h,d,f){const u=ae();v.fire({title:"Procesando...",text:"Por favor espere, estamos procesando la solicitud.",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{v.showLoading()}});const C=await(f?u.updateProcess(h):u.createProcess(h));if(v.close(),C==201||f&&C==200)v.fire({icon:"success",title:"Exitoso",text:d,confirmButtonText:"OK!"}).then(D=>{if(D.isConfirmed)return!0});else return v.fire({icon:"error",title:"Oops...",text:"Something went wrong!",footer:"<a>Try again or later.</a>"}),!1}const Te=xe("case_type",{state:()=>({caseTypes:[],dataLoaded:!1}),getters:{caseTypeById:h=>d=>h.caseTypes.find(f=>f.id==d)},actions:{async init(){this.dataLoaded||await this.fetchCaseTypesData()},async fetchCaseTypesData(){try{let d=(await he("case_types/")).data;if(d&&typeof d=="string")try{d=JSON.parse(d)}catch(f){console.error("JSON parse error:",f.message),d=[]}this.caseTypes=d??[],this.dataLoaded=!0}catch(h){console.error("Error fetching caseTypes data:",h.message),this.caseTypes=[],this.dataLoaded=!1}}}}),Ae={class:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8 lg:hidden"},Pe={class:"pb-10 px-4 sm:px-6 lg:px-8 lg:pt-10"},De={class:"w-full p-5 rounded-lg border-2 border-stroke bg-terciary"},Be=e("div",null,[e("h1",{class:"text-primary text-xl font-semibold"}," Información del proceso ")],-1),Ee={class:"mt-4 space-y-3"},Fe={class:"grid md:grid-cols-2 xl:grid-cols-4 gap-3"},$e=e("label",{for:"plaintiff",class:"block text-base font-medium leading-6 text-primary"},[m(" Dte./Accionante "),e("span",{class:"text-red-500"},"*")],-1),qe={class:"mt-2"},Ne=e("label",{for:"defendant",class:"block text-base font-medium leading-6 text-primary"},[m(" Ddo./Accionado "),e("span",{class:"text-red-500"},"*")],-1),Ve={class:"mt-2"},Le=e("span",{class:"text-red-500"},"*",-1),Oe={class:"relative mt-2"},Ue=e("label",{for:"defendant",class:"block text-base font-medium leading-6 text-primary"},[m(" Subclase "),e("span",{class:"text-red-500"},"*")],-1),Je={class:"mt-2"},Me={class:"grid md:grid-cols-3 gap-3"},je=e("label",{for:"plaintiff",class:"block text-base font-medium leading-6 text-primary"},[m(" Radicado "),e("span",{class:"text-red-500"},"*")],-1),ze={class:"mt-2"},Ge=e("label",{for:"plaintiff",class:"block text-base font-medium leading-6 text-primary"},[m(" Autoridad "),e("span",{class:"text-red-500"},"*")],-1),Re={class:"mt-2"},He=e("span",{class:"text-red-500"},"*",-1),Xe={class:"relative mt-2"},Ze={class:"flex items-center"},Ke=["src"],We={class:"flex items-center gap-3 font-medium"},Ye=e("p",{class:"inline-block text-base text-primary"},[m(" Etapa procesal "),e("span",{class:"text-red-500"},"*")],-1),Qe={class:"qflow-root"},et={class:"-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8"},tt={class:"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8"},st={class:"min-w-full divide-y divide-gray-300"},at=e("thead",null,[e("tr",{class:"text-left text-base font-regular text-primary"},[e("th",{scope:"col",class:"py-3.5 pr-3 w-3/5"},"Descripción"),e("th",{scope:"col",class:"px-3 py-3.5 w-1/5"},"Acción")])],-1),ot={class:"divide-y divide-gray-200"},rt={class:"w-4/5 py-4 pr-3 text-sm font-medium text-primary sm:pl-0 break-words"},it=["onUpdate:modelValue"],nt={class:"whitespace-nowrap w-1/5 px-3 py-4 text-sm text-primary flex gap-2"},lt=["onClick","disabled"],dt={class:"flex items-center gap-3 font-medium"},ct=e("p",{class:"inline-block text-base text-primary"},"Documento",-1),ut={class:"qflow-root"},pt={class:"-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8"},ft={class:"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8"},mt={class:"min-w-full divide-y divide-gray-300"},gt=e("thead",null,[e("tr",{class:"text-left text-base font-regular text-primary"},[e("th",{scope:"col",class:"py-3.5 pr-3 w-3/5"}," Documentos Cargados "),e("th",{scope:"col",class:"px-3 py-3.5 w-1/5"},"Acción")])],-1),yt={class:"divide-y divide-gray-200"},xt={class:"w-4/5 py-4 pr-3 text-sm font-medium text-primary sm:pl-0 break-words"},ht={key:0},vt=["href"],bt={key:1,class:"text-gray-500"},_t={key:2,class:"text-gray-500"},wt=["id","onChange"],kt=["onClick"],Ct=["onClick"],St={class:"flex space-x-4"},It=["disabled"],Tt=e("span",null,"Guardar",-1),At=[Tt],Pt=e("span",null,"Archivar Proceso",-1),Dt=[Pt],Bt=50*1024*1024,Nt={__name:"ProcessForm",setup(h){const d=ve(),f=b(""),u=b(""),C=ae(),D=Te(),q=T(()=>D.caseTypes),N=be(),V=T(()=>N.clients),L=_e(),s=we({plaintiff:"",defendant:"",caseTypeId:"",subcase:"",ref:"",authority:"",clientId:"",lawyerId:"",stages:[{status:""}],caseFiles:[{file:null}]}),$=b(!1);let O={};ke(async()=>{if(f.value=d.params.action,u.value=d.params.process_id,u.value){await C.init();const o=C.processById(u.value);o&&(re(o),O=JSON.parse(JSON.stringify(s)))}await D.init(),await N.init()}),z(s,()=>{oe(s,O)?$.value=!1:$.value=!0},{deep:!0}),z(()=>d.params.action,o=>{o==="add"&&ge()});function oe(o,a){return JSON.stringify(o)===JSON.stringify(a)}const U=T(()=>s.plaintiff.trim()&&s.defendant.trim()&&s.subcase.trim()&&s.ref.trim()&&s.authority.trim()&&s.stages.every(o=>o.status.trim()));function re(o){console.log("Process ID being assigned:",o.id),s.processIdParam=o.id||"",s.plaintiff=o.plaintiff||"",s.defendant=o.defendant||"",S.value=o.case||"",s.subcase=o.subcase||"",s.ref=o.ref||"",s.authority=o.authority||"",I.value=o.client||"",s.lawyerId=o.lawyer.id||"",s.stages=o.stages.map(a=>({status:a.status||""})),s.caseFiles=o.case_files.map(a=>({file:a.file,id:a.id||""})),$.value=!1}const J=()=>{const o={Accionante:s.plaintiff,Accionado:s.defendant,"Tipo de Caso":s.caseTypeId,"Sub Caso":s.subcase,Radicado:s.ref,Autoridad:s.authority,Cliente:s.clientId,Abogado:s.lawyerId};for(const[a,t]of Object.entries(o))if(!t||String(t).trim()==="")return v.fire({title:"Campo requerido!",text:`El campo "${a}" es obligatorio.`,icon:"warning"}),!1;for(const[a,t]of s.stages.entries())if(!t.status||t.status.trim()==="")return v.fire({title:"Estado requerido!",text:`El estado de la etapa procesal en la fila ${a+1} es obligatorio o debe ser eliminado si no es necesario.`,icon:"warning"}),!1;for(const[a,t]of s.caseFiles.entries())if(!t.file)return v.fire({title:"¡Archivo requerido!",text:`El archivo en la fila ${a+1} es obligatorio o debe ser eliminado si no es necesario.`,icon:"warning"}),!1;return!0},ie=async()=>{var o,a,t;s.caseTypeId=((o=S.value)==null?void 0:o.id)||"",s.clientId=((a=I.value)==null?void 0:a.id)||"",s.lawyerId=((t=L.userAuth)==null?void 0:t.id)||"",f.value==="edit"&&u.value&&(console.log("Submitting with process ID:",u.value),s.processIdParam=u.value),J()&&(await se(s,"La información del proceso se ha guardado exitosamente!",!!u.value),f.value=="add"?E.push({name:"process_list",params:{user_id:"",display:""}}):E.back())},ne=async()=>{var a,t,i;(await v.fire({title:"¿Archivar este proceso?",text:"Esta acción marcará el proceso como archivado. ¿Desea continuar?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#BD93F9",cancelButtonColor:"#d33",confirmButtonText:"Sí, archivar proceso",cancelButtonText:"Cancelar"})).isConfirmed&&(s.stages.push({status:"Fallo"}),s.processIdParam=u.value,s.caseTypeId=((a=S.value)==null?void 0:a.id)||"",s.clientId=((t=I.value)==null?void 0:t.id)||"",s.lawyerId=((i=L.userAuth)==null?void 0:i.id)||"",s.isArchiving=!0,J()&&(await se(s,"El proceso ha sido archivado exitosamente!",!0),E.back()))},g=b(""),S=b(null),M=T(()=>g.value===""?q.value:q.value.filter(o=>o.type.toLowerCase().includes(g.value.toLowerCase()))),I=b(null),j=T(()=>g.value===""?V.value:V.value.filter(o=>["first_name","last_name","identification","email"].some(a=>{var t;return(t=o[a])==null?void 0:t.toLowerCase().includes(g.value.toLowerCase())}))),le=()=>{s.stages.push({status:""})},de=o=>{s.stages.splice(o,1)},ce=["png","jpg","jpeg","pdf","docx"],ue=(o,a)=>{const t=o.target.files[0];if(!t)return;if(t.size>Bt){R(`El archivo "${t.name}" excede el límite de 50 MB. Por favor, selecciona un archivo más pequeño.`,"warning");return}const i=t.name.split(".").pop().toLowerCase();if(!ce.includes(i)){R("¡Ups! Ese tipo de archivo no es compatible. Asegúrate de que el archivo sea PDF, DOCX, JPG, PNG, JPEG.","warning");return}s.caseFiles[a].file=t},pe=()=>{s.caseFiles.push({file:null,id:""})};function fe(o){window.open(o,"_blank")}const me=o=>{s.caseFiles.splice(o,1)},ge=()=>{s.plaintiff="",s.defendant="",s.caseTypeId="",s.subcase="",s.ref="",s.authority="",s.clientId="",s.lawyerId="",s.stages=[{status:""}],s.caseFiles=[{file:null}]},ye=()=>{E.back()};return(o,a)=>(n(),c(A,null,[e("div",Ae,[Ce(o.$slots,"default")]),e("div",Pe,[e("div",De,[Be,e("div",Ee,[e("div",Fe,[e("div",null,[$e,e("div",qe,[_(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>s.plaintiff=t),type:"text",name:"plaintiff",id:"plaintiff",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[w,s.plaintiff]])])]),e("div",null,[Ne,e("div",Ve,[_(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>s.defendant=t),type:"text",name:"defendant",id:"defendant",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[w,s.defendant]])])]),e("div",null,[l(r(Q),{as:"div",modelValue:S.value,"onUpdate:modelValue":[a[4]||(a[4]=t=>S.value=t),a[5]||(a[5]=t=>g.value="")]},{default:y(()=>[l(r(H),{class:"block text-base font-medium leading-6 text-primary"},{default:y(()=>[m(" Tipo Proceso "),Le]),_:1}),e("div",Oe,[l(r(X),{class:"w-full rounded-md border-0 bg-white py-1.5 pl-3 pr-10 text-primary shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",onChange:a[2]||(a[2]=t=>g.value=t.target.value),onBlur:a[3]||(a[3]=t=>g.value=""),"display-value":t=>t==null?void 0:t.type},null,8,["display-value"]),l(r(Z),{class:"absolute inset-y-0 right-0 flex items-center gap-2 rounded-r-md px-2 focus:outline-none border-l border-gray-300"},{default:y(()=>[m(" Seleccionar "),l(r(G),{class:"h-5 w-5 text-gray-400","aria-hidden":"true"})]),_:1}),M.value.length>0?(n(),F(r(Y),{key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:y(()=>[(n(!0),c(A,null,B(M.value,t=>(n(),F(r(K),{key:t.id,value:t,as:"template"},{default:y(({active:i,selected:p})=>[e("li",{class:x(["relative cursor-default select-none py-2 pl-3 pr-9",i?"bg-secondary text-white":"text-primary"])},[e("span",{class:x(["block truncate",p&&"font-semibold"])},P(t.type),3),p?(n(),c("span",{key:0,class:x(["absolute inset-y-0 right-0 flex items-center pr-4",i?"text-white":"text-secondary"])},[l(r(W),{class:"h-5 w-5","aria-hidden":"true"})],2)):k("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})):k("",!0)])]),_:1},8,["modelValue"])]),e("div",null,[Ue,e("div",Je,[_(e("input",{"onUpdate:modelValue":a[6]||(a[6]=t=>s.subcase=t),type:"text",name:"defendant",id:"defendant",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[w,s.subcase]])])])]),e("div",Me,[e("div",null,[je,e("div",ze,[_(e("input",{"onUpdate:modelValue":a[7]||(a[7]=t=>s.ref=t),type:"text",name:"plaintiff",id:"plaintiff",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[w,s.ref]])])]),e("div",null,[Ge,e("div",Re,[_(e("input",{"onUpdate:modelValue":a[8]||(a[8]=t=>s.authority=t),type:"text",name:"plaintiff",id:"plaintiff",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[w,s.authority]])])]),e("div",null,[l(r(Q),{as:"div",modelValue:I.value,"onUpdate:modelValue":[a[11]||(a[11]=t=>I.value=t),a[12]||(a[12]=t=>g.value="")]},{default:y(()=>[l(r(H),{class:"block text-sm font-medium leading-6 text-primary"},{default:y(()=>[m(" Usuario "),He]),_:1}),e("div",Xe,[l(r(X),{class:"w-full rounded-md border-0 bg-white py-1.5 pl-3 pr-12 text-primary shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",onChange:a[9]||(a[9]=t=>g.value=t.target.value),onBlur:a[10]||(a[10]=t=>g.value=""),"display-value":t=>t!=null&&t.last_name&&(t!=null&&t.first_name)?`${t==null?void 0:t.last_name} ${t==null?void 0:t.first_name}`:""},null,8,["display-value"]),l(r(Z),{class:"absolute inset-y-0 right-0 flex items-center rounded-r-md px-2 focus:outline-none"},{default:y(()=>[l(r(G),{class:"h-5 w-5 text-gray-400","aria-hidden":"true"})]),_:1}),j.value.length>0?(n(),F(r(Y),{key:0,class:"absolute z-10 mt-1 max-h-56 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:y(()=>[(n(!0),c(A,null,B(j.value,t=>(n(),F(r(K),{key:t.id,value:t,as:"template"},{default:y(({active:i,selected:p})=>[e("li",{class:x(["relative cursor-default select-none py-2 pl-3 pr-9",i?"bg-secondary text-white":"text-primary"])},[e("div",Ze,[e("img",{src:t.photo_profile||r(Se),alt:"Foto de perfil",class:"h-6 w-6 flex-shrink-0 rounded-full"},null,8,Ke),e("span",{class:x(["ml-3 truncate",p&&"font-semibold"])},P(t.last_name)+" "+P(t.first_name),3)]),p?(n(),c("span",{key:0,class:x(["absolute inset-y-0 right-0 flex items-center pr-4",i?"text-white":"text-secondary"])},[l(r(W),{class:"h-5 w-5","aria-hidden":"true"})],2)):k("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})):k("",!0)])]),_:1},8,["modelValue"])])]),e("div",null,[e("div",We,[Ye,e("button",{onClick:le,class:"flex items-center px-2 py-1 rounded-md text-sm text-secondary bg-selected-background"},[l(r(te),{class:"h-5 w-5"}),m(" Nuevo ")])]),e("div",Qe,[e("div",et,[e("div",tt,[e("table",st,[at,e("tbody",ot,[(n(!0),c(A,null,B(s.stages,(t,i)=>(n(),c("tr",{key:i},[e("td",rt,[_(e("input",{"onUpdate:modelValue":p=>t.status=p,type:"text",name:"stage",id:"stage",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,8,it),[[w,t.status]])]),e("td",nt,[e("button",{onClick:p=>de(i),disabled:i==0},[l(r(ee),{class:x(["mx-3 h-7 w-7",i==0?"text-gray-500 cursor-not-allowed":"text-red-600/80"])},null,8,["class"])],8,lt)])]))),128))])])])])])]),e("div",null,[e("div",dt,[ct,e("button",{onClick:pe,class:"flex items-center px-2 py-1 rounded-md text-sm text-secondary bg-selected-background"},[l(r(te),{class:"h-5 w-5"}),m(" Nuevo ")])]),e("div",ut,[e("div",pt,[e("div",ft,[e("table",mt,[gt,e("tbody",yt,[(n(!0),c(A,null,B(s.caseFiles,(t,i)=>(n(),c("tr",{key:i},[e("td",xt,[typeof t.file=="string"?(n(),c("span",ht,[e("a",{href:t.file,target:"_blank",class:"text-blue-500 hover:underline"},P(t.file.split("/").pop()),9,vt)])):t.file?(n(),c("span",bt," Archivo cargado: "+P(t.file.name),1)):(n(),c("span",_t,"Ningún archivo subido")),e("input",{type:"file",id:"file-"+i,onChange:p=>ue(p,i),class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,40,wt)]),e("td",{class:x(["whitespace-nowrap w-1/5 py-4 text-sm text-primary flex gap-2",t.file?"":"px-3"])},[t.file?(n(),c("button",{key:0,onClick:p=>fe(t.file)},[l(r(Ie),{class:"h-7 w-7 text-primary"})],8,kt)):k("",!0),e("button",{onClick:p=>me(i)},[l(r(ee),{class:x(["h-7 w-7 text-red-600/80",t.file?"":"mx-3"])},null,8,["class"])],8,Ct)],2)]))),128))])])])])])]),e("div",St,[e("button",{onClick:ie,type:"button",class:x(["p-2.5 text-sm font-medium rounded-md flex gap-2",U.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!U.value},At,10,It),f.value==="edit"&&u.value?(n(),c("button",{key:0,onClick:ne,type:"button",class:"p-2.5 text-sm font-medium rounded-md flex gap-2 bg-blue-500 text-white"},Dt)):k("",!0),e("button",{onClick:ye,type:"button",class:"p-2.5 text-sm font-medium rounded-md flex gap-2 bg-red-600/80 text-white cursor-pointer"}," Cancelar ")])])])])],64))}};export{Nt as default};
