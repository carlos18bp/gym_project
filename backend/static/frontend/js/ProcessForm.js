import{e as i,f as c,g as e,B as ee,L as h,N as ge,O as ye,z as xe,r as b,c as C,A as he,a as ve,b as be,o as _e,C as j,I as we,w as _,v as w,j as l,k as g,l as r,m,F as S,E,n as y,x as $,P as z,Q as N,t as I,i as L,U as ke,s as M}from"./index.js";import{a as G,i as R,n as H,r as X,b as Z,u as K,l as Q}from"./combobox.js";import{r as Ce}from"./EyeIcon.js";function W(p,d){return i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})])}function Y(p,d){return i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"})])}async function Se(p,d,x){const v=ee();h.fire({title:"Procesando...",text:"Por favor espere, estamos procesando la solicitud.",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{h.showLoading()}});const k=await(x?v.updateProcess(p):v.createProcess(p));if(h.close(),k==201||x&&k==200)h.fire({icon:"success",title:"Exitoso",text:d,confirmButtonText:"OK!"}).then(T=>{if(T.isConfirmed)return!0});else return h.fire({icon:"error",title:"Oops...",text:"Something went wrong!",footer:"<a>Try again or later.</a>"}),!1}const Ie=ge("case_type",{state:()=>({caseTypes:[],dataLoaded:!1}),getters:{caseTypeById:p=>d=>p.caseTypes.find(x=>x.id==d)},actions:{async init(){this.dataLoaded||await this.fetchCaseTypesData()},async fetchCaseTypesData(){try{let d=(await ye("case_types/")).data;if(d&&typeof d=="string")try{d=JSON.parse(d)}catch(x){console.error("JSON parse error:",x.message),d=[]}this.caseTypes=d??[],this.dataLoaded=!0}catch(p){console.error("Error fetching caseTypes data:",p.message),this.caseTypes=[],this.dataLoaded=!1}}}}),Le={class:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8"},Te={class:"pb-10 px-4 sm:px-6 lg:px-8 lg:pt-10"},De={class:"w-full p-5 rounded-lg border-2 border-stroke bg-terciary"},Ae=e("div",null,[e("h1",{class:"text-primary text-xl font-semibold"}," Información del proceso ")],-1),Ee={class:"mt-4 space-y-3"},Ne={class:"grid md:grid-cols-2 xl:grid-cols-4 gap-3"},Pe=e("label",{for:"plaintiff",class:"block text-base font-medium leading-6 text-primary"},[m(" Dte./Accionante "),e("span",{class:"text-red-500"},"*")],-1),$e={class:"mt-2"},qe=e("label",{for:"defendant",class:"block text-base font-medium leading-6 text-primary"},[m(" Ddo./Accionado "),e("span",{class:"text-red-500"},"*")],-1),Fe={class:"mt-2"},Ve=e("span",{class:"text-red-500"},"*",-1),Be={class:"relative mt-2"},Oe=e("label",{for:"defendant",class:"block text-base font-medium leading-6 text-primary"},[m(" Subclase "),e("span",{class:"text-red-500"},"*")],-1),Ue={class:"mt-2"},Je={class:"grid md:grid-cols-3 gap-3"},je=e("label",{for:"plaintiff",class:"block text-base font-medium leading-6 text-primary"},[m(" Radicado "),e("span",{class:"text-red-500"},"*")],-1),ze={class:"mt-2"},Me=e("label",{for:"plaintiff",class:"block text-base font-medium leading-6 text-primary"},[m(" Autoridad "),e("span",{class:"text-red-500"},"*")],-1),Ge={class:"mt-2"},Re=e("span",{class:"text-red-500"},"*",-1),He={class:"relative mt-2"},Xe={class:"flex items-center"},Ze=["src"],Ke={class:"flex items-center gap-3 font-medium"},Qe=e("p",{class:"inline-block text-base text-primary"},[m(" Etapa procesal "),e("span",{class:"text-red-500"},"*")],-1),We={class:"qflow-root"},Ye={class:"-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8"},et={class:"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8"},tt={class:"min-w-full divide-y divide-gray-300"},st=e("thead",null,[e("tr",{class:"text-left text-base font-regular text-primary"},[e("th",{scope:"col",class:"py-3.5 pr-3 w-3/5"},"Descripción"),e("th",{scope:"col",class:"px-3 py-3.5 w-1/5"},"Acción")])],-1),at={class:"divide-y divide-gray-200"},ot={class:"w-4/5 py-4 pr-3 text-sm font-medium text-primary sm:pl-0 break-words"},rt=["onUpdate:modelValue"],it={class:"whitespace-nowrap w-1/5 px-3 py-4 text-sm text-primary flex gap-2"},nt=["onClick","disabled"],lt={class:"flex items-center gap-3 font-medium"},dt=e("p",{class:"inline-block text-base text-primary"},"Documento",-1),ct={class:"qflow-root"},ut={class:"-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8"},mt={class:"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8"},pt={class:"min-w-full divide-y divide-gray-300"},ft=e("thead",null,[e("tr",{class:"text-left text-base font-regular text-primary"},[e("th",{scope:"col",class:"py-3.5 pr-3 w-3/5"}," Documentos Cargados "),e("th",{scope:"col",class:"px-3 py-3.5 w-1/5"},"Acción")])],-1),gt={class:"divide-y divide-gray-200"},yt={class:"w-4/5 py-4 pr-3 text-sm font-medium text-primary sm:pl-0 break-words"},xt={key:0},ht=["href"],vt={key:1,class:"text-gray-500"},bt={key:2,class:"text-gray-500"},_t=["id","onChange"],wt=["onClick"],kt=["onClick"],Ct={class:"flex space-x-4"},St=["disabled"],It=e("span",null,"Guardar",-1),Lt=[It],Tt=50*1024*1024,Nt={__name:"ProcessForm",setup(p){const d=xe(),x=b(""),v=b(""),k=ee(),T=Ie(),q=C(()=>T.caseTypes),F=he(),V=C(()=>F.clients),te=ve(),s=be({plaintiff:"",defendant:"",caseTypeId:"",subcase:"",ref:"",authority:"",clientId:"",lawyerId:"",stages:[{status:""}],caseFiles:[{file:null}]}),P=b(!1);let B={};_e(async()=>{if(x.value=d.params.action,v.value=d.params.process_id,v.value){await k.init();const o=k.processById(v.value);o&&(ae(o),B=JSON.parse(JSON.stringify(s)))}await T.init(),await F.init()}),j(s,()=>{se(s,B)?(console.log("No changes detected in formData"),P.value=!1):(console.log("Detected changes in formData"),P.value=!0)},{deep:!0}),j(()=>d.params.action,o=>{o==="add"&&pe()});function se(o,a){return JSON.stringify(o)===JSON.stringify(a)}const O=C(()=>s.plaintiff.trim()&&s.defendant.trim()&&s.subcase.trim()&&s.ref.trim()&&s.authority.trim()&&s.stages.every(o=>o.status.trim()));function ae(o){s.processIdParam=o.id,s.plaintiff=o.plaintiff||"",s.defendant=o.defendant||"",D.value=o.case||"",s.subcase=o.subcase||"",s.ref=o.ref||"",s.authority=o.authority||"",A.value=o.client||"",s.lawyerId=o.lawyer.id||"",s.stages=o.stages.map(a=>({status:a.status||""})),s.caseFiles=o.case_files.map(a=>({file:a.file,id:a.id||""})),P.value=!1}const oe=()=>{const o={Accionante:s.plaintiff,Accionado:s.defendant,"Tipo de Caso":s.caseTypeId,"Sub Caso":s.subcase,Radicado:s.ref,Autoridad:s.authority,Cliente:s.clientId,Abogado:s.lawyerId};for(const[a,t]of Object.entries(o))if(!t||String(t).trim()==="")return h.fire({title:"Campo requerido!",text:`El campo "${a}" es obligatorio.`,icon:"warning"}),!1;for(const[a,t]of s.stages.entries())if(!t.status||t.status.trim()==="")return h.fire({title:"Estado requerido!",text:`El estado de la etapa procesal en la fila ${a+1} es obligatorio o debe ser eliminado si no es necesario.`,icon:"warning"}),!1;for(const[a,t]of s.caseFiles.entries())if(!t.file)return h.fire({title:"¡Archivo requerido!",text:`El archivo en la fila ${a+1} es obligatorio o debe ser eliminado si no es necesario.`,icon:"warning"}),!1;return!0},re=async()=>{var o,a,t;s.caseTypeId=((o=D.value)==null?void 0:o.id)||"",s.clientId=((a=A.value)==null?void 0:a.id)||"",s.lawyerId=((t=te.userAuth)==null?void 0:t.id)||"",oe()&&(await Se(s,"La información del proceso se ha guardado exitosamente!",!!v.value),x.value=="add"?$.push({name:"process_list",params:{user_id:"",display:""}}):$.back())},f=b(""),D=b(null),U=C(()=>f.value===""?q.value:q.value.filter(o=>o.type.toLowerCase().includes(f.value.toLowerCase()))),A=b(null),J=C(()=>f.value===""?V.value:V.value.filter(o=>["first_name","last_name","identification","email"].some(a=>{var t;return(t=o[a])==null?void 0:t.toLowerCase().includes(f.value.toLowerCase())}))),ie=()=>{s.stages.push({status:""})},ne=o=>{s.stages.splice(o,1)},le=["png","jpg","jpeg","pdf","docx"],de=(o,a)=>{const t=o.target.files[0];if(!t)return;if(t.size>Tt){M(`El archivo "${t.name}" excede el límite de 50 MB. Por favor, selecciona un archivo más pequeño.`,"warning");return}const n=t.name.split(".").pop().toLowerCase();if(!le.includes(n)){M("¡Ups! Ese tipo de archivo no es compatible. Asegúrate de que el archivo sea PDF, DOCX, JPG, PNG, JPEG.","warning");return}s.caseFiles[a].file=t},ce=()=>{s.caseFiles.push({file:null,id:""})};function ue(o){window.open(o,"_blank")}const me=o=>{s.caseFiles.splice(o,1)},pe=()=>{s.plaintiff="",s.defendant="",s.caseTypeId="",s.subcase="",s.ref="",s.authority="",s.clientId="",s.lawyerId="",s.stages=[{status:""}],s.caseFiles=[{file:null}]},fe=()=>{$.back()};return(o,a)=>(i(),c(S,null,[e("div",Le,[we(o.$slots,"default")]),e("div",Te,[e("div",De,[Ae,e("div",Ee,[e("div",Ne,[e("div",null,[Pe,e("div",$e,[_(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>s.plaintiff=t),type:"text",name:"plaintiff",id:"plaintiff",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[w,s.plaintiff]])])]),e("div",null,[qe,e("div",Fe,[_(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>s.defendant=t),type:"text",name:"defendant",id:"defendant",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[w,s.defendant]])])]),e("div",null,[l(r(Q),{as:"div",modelValue:D.value,"onUpdate:modelValue":[a[4]||(a[4]=t=>D.value=t),a[5]||(a[5]=t=>f.value="")]},{default:g(()=>[l(r(G),{class:"block text-base font-medium leading-6 text-primary"},{default:g(()=>[m(" Tipo Proceso "),Ve]),_:1}),e("div",Be,[l(r(R),{class:"w-full rounded-md border-0 bg-white py-1.5 pl-3 pr-10 text-primary shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",onChange:a[2]||(a[2]=t=>f.value=t.target.value),onBlur:a[3]||(a[3]=t=>f.value=""),"display-value":t=>t==null?void 0:t.type},null,8,["display-value"]),l(r(H),{class:"absolute inset-y-0 right-0 flex items-center gap-2 rounded-r-md px-2 focus:outline-none border-l border-gray-300"},{default:g(()=>[m(" Seleccionar "),l(r(z),{class:"h-5 w-5 text-gray-400","aria-hidden":"true"})]),_:1}),U.value.length>0?(i(),N(r(K),{key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:g(()=>[(i(!0),c(S,null,E(U.value,t=>(i(),N(r(X),{key:t.id,value:t,as:"template"},{default:g(({active:n,selected:u})=>[e("li",{class:y(["relative cursor-default select-none py-2 pl-3 pr-9",n?"bg-secondary text-white":"text-primary"])},[e("span",{class:y(["block truncate",u&&"font-semibold"])},I(t.type),3),u?(i(),c("span",{key:0,class:y(["absolute inset-y-0 right-0 flex items-center pr-4",n?"text-white":"text-secondary"])},[l(r(Z),{class:"h-5 w-5","aria-hidden":"true"})],2)):L("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})):L("",!0)])]),_:1},8,["modelValue"])]),e("div",null,[Oe,e("div",Ue,[_(e("input",{"onUpdate:modelValue":a[6]||(a[6]=t=>s.subcase=t),type:"text",name:"defendant",id:"defendant",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[w,s.subcase]])])])]),e("div",Je,[e("div",null,[je,e("div",ze,[_(e("input",{"onUpdate:modelValue":a[7]||(a[7]=t=>s.ref=t),type:"text",name:"plaintiff",id:"plaintiff",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[w,s.ref]])])]),e("div",null,[Me,e("div",Ge,[_(e("input",{"onUpdate:modelValue":a[8]||(a[8]=t=>s.authority=t),type:"text",name:"plaintiff",id:"plaintiff",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[w,s.authority]])])]),e("div",null,[l(r(Q),{as:"div",modelValue:A.value,"onUpdate:modelValue":[a[11]||(a[11]=t=>A.value=t),a[12]||(a[12]=t=>f.value="")]},{default:g(()=>[l(r(G),{class:"block text-sm font-medium leading-6 text-primary"},{default:g(()=>[m(" Usuario "),Re]),_:1}),e("div",He,[l(r(R),{class:"w-full rounded-md border-0 bg-white py-1.5 pl-3 pr-12 text-primary shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",onChange:a[9]||(a[9]=t=>f.value=t.target.value),onBlur:a[10]||(a[10]=t=>f.value=""),"display-value":t=>t!=null&&t.last_name&&(t!=null&&t.first_name)?`${t==null?void 0:t.last_name} ${t==null?void 0:t.first_name}`:""},null,8,["display-value"]),l(r(H),{class:"absolute inset-y-0 right-0 flex items-center rounded-r-md px-2 focus:outline-none"},{default:g(()=>[l(r(z),{class:"h-5 w-5 text-gray-400","aria-hidden":"true"})]),_:1}),J.value.length>0?(i(),N(r(K),{key:0,class:"absolute z-10 mt-1 max-h-56 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:g(()=>[(i(!0),c(S,null,E(J.value,t=>(i(),N(r(X),{key:t.id,value:t,as:"template"},{default:g(({active:n,selected:u})=>[e("li",{class:y(["relative cursor-default select-none py-2 pl-3 pr-9",n?"bg-secondary text-white":"text-primary"])},[e("div",Xe,[e("img",{src:t.photo_profile||r(ke),alt:"Foto de perfil",class:"h-6 w-6 flex-shrink-0 rounded-full"},null,8,Ze),e("span",{class:y(["ml-3 truncate",u&&"font-semibold"])},I(t.last_name)+" "+I(t.first_name),3)]),u?(i(),c("span",{key:0,class:y(["absolute inset-y-0 right-0 flex items-center pr-4",n?"text-white":"text-secondary"])},[l(r(Z),{class:"h-5 w-5","aria-hidden":"true"})],2)):L("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})):L("",!0)])]),_:1},8,["modelValue"])])]),e("div",null,[e("div",Ke,[Qe,e("button",{onClick:ie,class:"flex items-center px-2 py-1 rounded-md text-sm text-secondary bg-selected-background"},[l(r(Y),{class:"h-5 w-5"}),m(" Nuevo ")])]),e("div",We,[e("div",Ye,[e("div",et,[e("table",tt,[st,e("tbody",at,[(i(!0),c(S,null,E(s.stages,(t,n)=>(i(),c("tr",{key:n},[e("td",ot,[_(e("input",{"onUpdate:modelValue":u=>t.status=u,type:"text",name:"stage",id:"stage",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,8,rt),[[w,t.status]])]),e("td",it,[e("button",{onClick:u=>ne(n),disabled:n==0},[l(r(W),{class:y(["mx-3 h-7 w-7",n==0?"text-gray-500 cursor-not-allowed":"text-red-600/80"])},null,8,["class"])],8,nt)])]))),128))])])])])])]),e("div",null,[e("div",lt,[dt,e("button",{onClick:ce,class:"flex items-center px-2 py-1 rounded-md text-sm text-secondary bg-selected-background"},[l(r(Y),{class:"h-5 w-5"}),m(" Nuevo ")])]),e("div",ct,[e("div",ut,[e("div",mt,[e("table",pt,[ft,e("tbody",gt,[(i(!0),c(S,null,E(s.caseFiles,(t,n)=>(i(),c("tr",{key:n},[e("td",yt,[typeof t.file=="string"?(i(),c("span",xt,[e("a",{href:t.file,target:"_blank",class:"text-blue-500 hover:underline"},I(t.file.split("/").pop()),9,ht)])):t.file?(i(),c("span",vt," Archivo cargado: "+I(t.file.name),1)):(i(),c("span",bt,"Ningún archivo subido")),e("input",{type:"file",id:"file-"+n,onChange:u=>de(u,n),class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,40,_t)]),e("td",{class:y(["whitespace-nowrap w-1/5 py-4 text-sm text-primary flex gap-2",t.file?"":"px-3"])},[t.file?(i(),c("button",{key:0,onClick:u=>ue(t.file)},[l(r(Ce),{class:"h-7 w-7 text-primary"})],8,wt)):L("",!0),e("button",{onClick:u=>me(n)},[l(r(W),{class:y(["h-7 w-7 text-red-600/80",t.file?"":"mx-3"])},null,8,["class"])],8,kt)],2)]))),128))])])])])])]),e("div",Ct,[e("button",{onClick:re,type:"button",class:y(["p-2.5 text-sm font-medium rounded-md flex gap-2",O.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!O.value},Lt,10,St),e("button",{onClick:fe,type:"button",class:"p-2.5 text-sm font-medium rounded-md flex gap-2 bg-red-600/80 text-white cursor-pointer"}," Cancelar ")])])])])],64))}};export{Nt as default};
