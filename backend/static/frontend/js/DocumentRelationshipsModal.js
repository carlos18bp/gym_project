import{e as r,f as l,g as e,w as Q,U as me,k as O,i as he,t as m,h as x,j as f,B as K,a5 as pe,r as D,c as B,v as X,F as M,J as N,n as A,a4 as Z,p as F,l as $,m as ee,Q as te,T as se,D as z,E as ge,ao as Y,ap as G,a3 as fe,W as ye,o as be,a8 as ve,s as E}from"./index.js";import{o as oe,g as ae}from"./index2.js";import{_ as ne}from"./_plugin-vue_export-helper.js";import{r as re}from"./MagnifyingGlassIcon.js";import{r as le}from"./DocumentIcon.js";import{a as V}from"./LinkIcon.js";import{r as _e}from"./TrashIcon.js";function ie(s,i){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"})])}const xe={class:"bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full overflow-auto max-h-[80vh]"},we={class:"flex justify-between items-center mb-4"},De={class:"text-lg font-bold"},$e=["innerHTML"],_s={__name:"DocumentPreviewModal",props:{isVisible:Boolean,documentData:{type:Object,default:()=>({title:"",content:""})}},emits:["close"],setup(s,{emit:i}){const o=i,u=()=>{o("close")};return(p,g)=>Q((r(),O(pe,null,{default:he(()=>[e("div",xe,[e("div",we,[e("h2",De," Previsualización del Documento: "+m(s.documentData.title),1),e("button",{onClick:u},[x(f(K),{class:"size-6 text-gray-500 hover:text-gray-700"})])]),e("div",{class:"prose max-w-none",innerHTML:s.documentData.content},null,8,$e)])]),_:1},512)),[[me,s.isVisible]])}},q=s=>(te("data-v-45d4aeb0"),s=s(),se(),s),Re={class:"space-y-6"},ke=q(()=>e("h4",{class:"text-lg font-semibold text-gray-900"},"Relacionar Documentos Jurídicos",-1)),Se={class:"text-sm text-gray-600 mt-1"},Ce=q(()=>e("p",{class:"text-xs text-blue-600 mt-1"}," Solo se muestran documentos completados que te pertenecen ",-1)),Pe={class:"bg-gray-50 p-4 rounded-lg"},Ee={class:"relative"},Te={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},Le={key:0,class:"flex items-center justify-center py-12"},je=q(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),Fe=q(()=>e("span",{class:"ml-3 text-gray-600"},"Cargando documentos disponibles...",-1)),Ae=[je,Fe],Be={key:1,class:"text-center py-12"},Me={class:"mt-2 text-sm font-medium text-gray-900"},Ne={class:"mt-1 text-sm text-gray-500"},qe={key:2,class:"space-y-4"},Ve={class:"grid grid-cols-1 gap-4"},Oe={class:"flex items-start justify-between"},He={class:"flex-1 min-w-0"},Ue={class:"flex items-center space-x-3"},ze={class:"flex-shrink-0"},Qe={class:"flex-1 min-w-0"},Je={class:"text-sm font-medium text-gray-900 truncate"},Ie={class:"mt-1 flex items-center space-x-4 text-xs text-gray-500"},We={class:"inline-flex items-center"},Ye={key:0},Ge={key:0,class:"mt-3 text-sm text-gray-600 line-clamp-2"},Ke={key:1,class:"mt-3 flex flex-wrap gap-1"},Xe={class:"flex-shrink-0 ml-4 flex flex-col space-y-2"},Ze=["onClick"],et=["onClick","disabled"],tt={key:1,class:"w-4 h-4 mr-2 animate-spin rounded-full border-2 border-white border-t-transparent"},st={key:0,class:"flex justify-center mt-6"},ot=q(()=>e("nav",{class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px"},null,-1)),at=[ot],nt={__name:"RelateDocumentsTab",props:{document:{type:Object,required:!0},availableDocuments:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},deferSave:{type:Boolean,default:!1},pendingRelationships:{type:Array,default:()=>[]}},emits:["relate-document"],setup(s,{emit:i}){const o=s,u=i,p=D(""),g=D(!1),v=B(()=>{if(!o.availableDocuments)return[];let d=o.availableDocuments;if(o.deferSave&&o.pendingRelationships.length>0&&(d=d.filter(n=>!o.pendingRelationships.includes(n.id))),p.value.trim()){const n=p.value.toLowerCase();d=d.filter(a=>{var t,c;return((t=a.title)==null?void 0:t.toLowerCase().includes(n))||((c=a.content)==null?void 0:c.toLowerCase().includes(n))})}return d}),w=async d=>{g.value=!0;try{await u("relate-document",d,"related")}finally{g.value=!1}},R=d=>({Draft:"bg-gray-500",Published:"bg-green-500",Progress:"bg-blue-500",Completed:"bg-purple-500",FullySigned:"bg-emerald-500",PendingSignatures:"bg-yellow-500"})[d]||"bg-gray-500",k=d=>({Draft:"bg-gray-400",Published:"bg-green-400",Progress:"bg-blue-400",Completed:"bg-purple-400",FullySigned:"bg-emerald-400",PendingSignatures:"bg-yellow-400"})[d]||"bg-gray-400",S=d=>({Draft:"Borrador",Published:"Publicado",Progress:"En Progreso",Completed:"Completado",FullySigned:"Firmado",PendingSignatures:"Pendiente de Firma"})[d]||d,C=d=>{if(!d)return"";try{return new Date(d).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}catch{return d}},P=d=>{if(!d)return"";const n=document.createElement("div");return n.innerHTML=d,n.textContent||n.innerText||""},T=d=>{const n=ae(d);return P(n)};return(d,n)=>(r(),l("div",Re,[e("div",null,[ke,e("p",Se,' Selecciona documentos para asociar con "'+m(s.document.title)+'" ',1),Ce]),e("div",Pe,[e("div",Ee,[e("div",Te,[x(f(re),{class:"h-5 w-5 text-gray-400"})]),Q(e("input",{id:"search","onUpdate:modelValue":n[0]||(n[0]=a=>p.value=a),type:"text",placeholder:"Buscar por título...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md text-sm placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[X,p.value]])])]),s.isLoading?(r(),l("div",Le,Ae)):v.value.length===0?(r(),l("div",Be,[x(f(le),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",Me,m(s.availableDocuments.length===0?"No hay documentos disponibles":"No se encontraron documentos"),1),e("p",Ne,m(s.availableDocuments.length===0?"No tienes otros documentos completados disponibles para relacionar, o todos ya están relacionados con este documento.":"Intenta ajustar tu búsqueda para encontrar documentos."),1)])):(r(),l("div",qe,[e("div",Ve,[(r(!0),l(M,null,N(v.value,a=>(r(),l("div",{key:a.id,class:"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors"},[e("div",Oe,[e("div",He,[e("div",Ue,[e("div",ze,[e("div",{class:A(["w-10 h-10 rounded-lg flex items-center justify-center",R(a.state)])},[x(f(Z),{class:"w-5 h-5 text-white"})],2)]),e("div",Qe,[e("h5",Je,m(a.title),1),e("div",Ie,[e("span",We,[e("span",{class:A(["w-2 h-2 rounded-full mr-1.5",k(a.state)])},null,2),F(" "+m(S(a.state)),1)]),a.created_at?(r(),l("span",Ye,m(C(a.created_at)),1)):$("",!0)])])]),a.content?(r(),l("div",Ge,m(T(a)),1)):$("",!0),a.tags&&a.tags.length>0?(r(),l("div",Ke,[(r(!0),l(M,null,N(a.tags,t=>(r(),l("span",{key:t.id,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800"},m(t.name),1))),128))])):$("",!0)]),e("div",Xe,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 border border-gray-200 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors",onClick:ee(t=>f(oe)(a),["stop"])}," Ver documento ",8,Ze),e("button",{onClick:t=>w(a),disabled:g.value,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[g.value?(r(),l("div",tt)):(r(),O(f(V),{key:0,class:"w-4 h-4 mr-2"})),F(" "+m(g.value?"Relacionando...":"Relacionar"),1)],8,et)])])]))),128))]),v.value.length>=10?(r(),l("div",st,at)):$("",!0)]))]))}},rt=ne(nt,[["__scopeId","data-v-45d4aeb0"]]),H=s=>(te("data-v-78d14788"),s=s(),se(),s),lt={class:"space-y-6"},it=H(()=>e("h4",{class:"text-lg font-semibold text-gray-900"},"Documentos Relacionados",-1)),ct={class:"text-sm text-gray-600 mt-1"},dt=H(()=>e("p",{class:"text-xs text-blue-600 mt-1"}," Solo se muestran documentos completados que te pertenecen ",-1)),ut={class:"bg-gray-50 p-4 rounded-lg"},mt={class:"relative"},ht={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},pt={key:0,class:"flex items-center justify-center py-12"},gt=H(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),ft=H(()=>e("span",{class:"ml-3 text-gray-600"},"Cargando documentos relacionados...",-1)),yt=[gt,ft],bt={key:1,class:"text-center py-12"},vt={class:"mt-2 text-sm font-medium text-gray-900"},_t={class:"mt-1 text-sm text-gray-500"},xt={key:2,class:"space-y-4"},wt={class:"grid grid-cols-1 gap-4"},Dt={class:"flex items-start justify-between"},$t={class:"flex-1 min-w-0"},Rt={class:"flex items-center space-x-3"},kt={class:"flex-shrink-0"},St={class:"flex-1 min-w-0"},Ct={class:"text-sm font-medium text-gray-900 truncate"},Pt={class:"mt-1 flex items-center space-x-4 text-xs text-gray-500"},Et={class:"inline-flex items-center"},Tt={key:0},Lt={class:"mt-3"},jt={class:"flex items-center space-x-2"},Ft={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-800"},At={key:1,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Bt={key:0,class:"mt-2 text-xs text-gray-500"},Mt={key:0,class:"mt-3 text-sm text-gray-600 line-clamp-2"},Nt={key:1,class:"mt-3 flex flex-wrap gap-1"},qt={class:"flex-shrink-0 ml-4 flex flex-col space-y-2"},Vt=["onClick"],Ot=["onClick","disabled"],Ht={key:1,class:"w-4 h-4 mr-2 animate-spin rounded-full border-2 border-red-600 border-t-transparent"},Ut={__name:"RelatedDocumentsTab",props:{document:{type:Object,required:!0},relatedDocuments:{type:Array,default:()=>[]},relationships:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},deferSave:{type:Boolean,default:!1},pendingRelationships:{type:Array,default:()=>[]},availableDocuments:{type:Array,default:()=>[]}},emits:["unrelate-document"],setup(s,{emit:i}){const o=s,u=i,p=D(""),g=D(!1),v=B(()=>{let n=[];if(o.deferSave&&o.pendingRelationships.length>0?n=[...o.availableDocuments.filter(t=>o.pendingRelationships.includes(t.id)).map(t=>({...t,isPending:!0}))]:n=o.relatedDocuments||[],p.value.trim()){const a=p.value.toLowerCase();n=n.filter(t=>{var c,b;return((c=t.title)==null?void 0:c.toLowerCase().includes(a))||((b=t.content)==null?void 0:b.toLowerCase().includes(a))})}return n}),w=n=>{const a=o.relationships.find(t=>t.source_document===n||t.target_document===n);return a?{id:a.id,created_by:a.created_by_name,created_at:a.created_at}:null},R=async n=>{if(o.deferSave){u("unrelate-document",n.id);return}const a=w(n.id);if(a){g.value=!0;try{await u("unrelate-document",a.id)}finally{g.value=!1}}},k=n=>({Draft:"bg-gray-500",Published:"bg-green-500",Progress:"bg-blue-500",Completed:"bg-purple-500",FullySigned:"bg-emerald-500",PendingSignatures:"bg-yellow-500"})[n]||"bg-gray-500",S=n=>({Draft:"bg-gray-400",Published:"bg-green-400",Progress:"bg-blue-400",Completed:"bg-purple-400",FullySigned:"bg-emerald-400",PendingSignatures:"bg-yellow-400"})[n]||"bg-gray-400",C=n=>({Draft:"Borrador",Published:"Publicado",Progress:"En Progreso",Completed:"Completado",FullySigned:"Firmado",PendingSignatures:"Pendiente de Firma"})[n]||n,P=n=>{if(!n)return"";try{return new Date(n).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}catch{return n}},T=n=>{if(!n)return"";const a=document.createElement("div");return a.innerHTML=n,a.textContent||a.innerText||""},d=n=>{const a=ae(n);return T(a)};return(n,a)=>(r(),l("div",lt,[e("div",null,[it,e("p",ct,' Documentos asociados con "'+m(s.document.title)+'" ',1),dt]),e("div",ut,[e("div",mt,[e("div",ht,[x(f(re),{class:"h-5 w-5 text-gray-400"})]),Q(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>p.value=t),type:"text",placeholder:"Buscar en documentos relacionados...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md text-sm placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[X,p.value]])])]),s.isLoading?(r(),l("div",pt,yt)):v.value.length===0?(r(),l("div",bt,[x(f(ie),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",vt,m(s.relatedDocuments.length===0?"No hay documentos relacionados":"No se encontraron documentos"),1),e("p",_t,m(s.relatedDocuments.length===0?'Este documento aún no tiene documentos relacionados. Utiliza la pestaña "Relacionar Documentos" para crear asociaciones.':"Intenta ajustar tu búsqueda para encontrar documentos relacionados."),1)])):(r(),l("div",xt,[e("div",wt,[(r(!0),l(M,null,N(v.value,t=>{var c;return r(),l("div",{key:t.id,class:"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors"},[e("div",Dt,[e("div",$t,[e("div",Rt,[e("div",kt,[e("div",{class:A(["w-10 h-10 rounded-lg flex items-center justify-center",k(t.state)])},[x(f(Z),{class:"w-5 h-5 text-white"})],2)]),e("div",St,[e("h5",Ct,m(t.title),1),e("div",Pt,[e("span",Et,[e("span",{class:A(["w-2 h-2 rounded-full mr-1.5",S(t.state)])},null,2),F(" "+m(C(t.state)),1)]),t.created_at?(r(),l("span",Tt,m(P(t.created_at)),1)):$("",!0)])])]),e("div",Lt,[e("div",jt,[t.isPending?(r(),l("span",Ft,[x(f(V),{class:"w-3 h-3 mr-1"}),F(" Pendiente (se creará al formalizar) ")])):(r(),l("span",At,[x(f(V),{class:"w-3 h-3 mr-1"}),F(" Relacionado ")]))]),(c=w(t.id))!=null&&c.created_by?(r(),l("div",Bt," Relacionado por "+m(w(t.id).created_by)+" el "+m(P(w(t.id).created_at)),1)):$("",!0)]),t.content?(r(),l("div",Mt,m(d(t)),1)):$("",!0),t.tags&&t.tags.length>0?(r(),l("div",Nt,[(r(!0),l(M,null,N(t.tags,b=>(r(),l("span",{key:b.id,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800"},m(b.name),1))),128))])):$("",!0)]),e("div",qt,[e("button",{type:"button",class:"inline-flex items-center justify-center px-3 py-1.5 border border-gray-200 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors",onClick:ee(b=>f(oe)(t),["stop"])}," Ver documento ",8,Vt),s.readonly?$("",!0):(r(),l("button",{key:0,onClick:b=>R(t),disabled:g.value,class:"inline-flex items-center justify-center px-3 py-2 border border-red-300 shadow-sm text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 disabled:opacity-50 transition-colors"},[g.value?(r(),l("div",Ht)):(r(),O(f(_e),{key:0,class:"w-4 h-4 mr-2"})),F(" "+m(g.value?"Eliminando...":"Desrelacionar"),1)],8,Ot))])])])}),128))])]))]))}},zt=ne(Ut,[["__scopeId","data-v-78d14788"]]),j={async getDocumentRelationships(s){try{return(await z(`dynamic-documents/${s}/relationships/`)).data||[]}catch(i){throw console.error("Error fetching document relationships:",i),i}},async getRelatedDocuments(s){try{return(await z(`dynamic-documents/${s}/related-documents/`)).data||[]}catch(i){throw i}},async getAvailableDocumentsForRelationship(s){try{return(await z(`dynamic-documents/${s}/available-for-relationship/`)).data||[]}catch(i){throw console.error("Error fetching available documents:",i),i}},async createDocumentRelationship(s){try{const o=(await ge("dynamic-documents/relationships/create/",s)).data;try{const u=o.source_document_title||"documento origen",p=o.target_document_title||"documento relacionado";await Y(G.CREATE,`Relacionaste el documento "${u}" con "${p}"`)}catch(u){console.warn("No se pudo registrar la actividad de asociación:",u)}return o}catch(i){throw console.error("Error creating document relationship:",i),i}},async deleteDocumentRelationship(s){try{const i=await fe(`dynamic-documents/relationships/${s}/delete/`),o=i.status===200||i.status===204;if(o)try{await Y(G.DELETE,"Eliminaste una asociación entre documentos")}catch(u){console.warn("No se pudo registrar la actividad al eliminar asociación:",u)}return o}catch(i){throw console.error("Error deleting document relationship:",i),i}}},xs=Object.freeze(Object.defineProperty({__proto__:null,documentRelationshipsActions:j},Symbol.toStringTag,{value:"Module"}));function Qt(s,i={}){const o=D([]),u=D([]),p=D([]),g=D(!1),v=D(!1),w=D(!1),R=D(!1),k=async(t={})=>{if(s){v.value=!0;try{let c=await j.getAvailableDocumentsForRelationship(s);t.filterCompleted||i.filterCompleted?c=c.filter(b=>b.state==="Completed"):(t.filterFullySigned||i.filterFullySigned)&&(c=c.filter(b=>b.state==="FullySigned")),o.value=c}catch(c){if(c.response&&c.response.status===404)console.warn(`Document ${s} not found when loading available documents`),o.value=[];else throw console.error("Error loading available documents:",c),o.value=[],c}finally{v.value=!1}}},S=async()=>{if(s){w.value=!0;try{const t=await j.getRelatedDocuments(s);u.value=t}catch(t){if(t.response&&t.response.status===404)console.warn(`Document ${s} not found when loading related documents`),u.value=[];else throw u.value=[],t}finally{w.value=!1}}},C=async()=>{if(s){R.value=!0;try{p.value=await j.getDocumentRelationships(s)}catch(t){if(t.response&&t.response.status===404)console.warn(`Document ${s} not found when loading relationships`),p.value=[];else throw console.error("Error loading relationships:",t),p.value=[],t}finally{R.value=!1}}},P=async t=>{g.value=!0;try{return await j.createDocumentRelationship(t)}catch(c){throw console.error("Error creating relationship:",c),c}finally{g.value=!1}},T=async t=>{g.value=!0;try{return await j.deleteDocumentRelationship(t)}catch(c){throw console.error("Error deleting relationship:",c),c}finally{g.value=!1}},d=(t,c)=>p.value.find(b=>b.source_document===t&&b.target_document===c||b.source_document===c&&b.target_document===t);return{availableDocuments:o,relatedDocuments:u,relationships:p,isLoading:g,isLoadingAvailable:v,isLoadingRelated:w,isLoadingRelationships:R,loadAvailableDocuments:k,loadRelatedDocuments:S,loadRelationships:C,loadAllData:async()=>{await Promise.all([k(),S(),C()])},createRelationship:P,deleteRelationship:T,findRelationship:d,areDocumentsRelated:(t,c)=>!!d(t,c)}}const Jt={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center p-4"},It={class:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col"},Wt={class:"bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-6 rounded-t-lg flex-shrink-0"},Yt={class:"flex items-start justify-between gap-4"},Gt={class:"flex items-start space-x-3 flex-1 min-w-0"},Kt={class:"p-2 bg-white bg-opacity-20 rounded-lg flex-shrink-0"},Xt={class:"flex-1 min-w-0"},Zt=e("h3",{class:"text-lg font-semibold text-white"}," Administrar Asociaciones de Documentos ",-1),es={class:"text-blue-100 text-sm truncate"},ts={class:"text-blue-200 text-xs mt-1"},ss={class:"border-b border-gray-200 bg-gray-50 flex-shrink-0"},os={class:"flex"},as=["onClick"],ns={class:"flex items-center space-x-2"},rs={class:"p-6 overflow-y-auto flex-1"},ls={key:0,class:"flex items-center justify-center py-12"},is=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),cs=e("span",{class:"ml-3 text-gray-600"},"Cargando...",-1),ds=[is,cs],us={key:1,class:"space-y-6"},ms={key:2,class:"space-y-6"},ws={__name:"DocumentRelationshipsModal",props:{isOpen:{type:Boolean,default:!1},document:{type:Object,required:!0},readonly:{type:Boolean,default:!1},filterFullySigned:{type:Boolean,default:!1},forceRelateTab:{type:Boolean,default:!1},deferSave:{type:Boolean,default:!1},pendingRelationships:{type:Array,default:()=>[]}},emits:["close","refresh","update-pending","update-count"],setup(s,{emit:i}){var I;const o=s,u=i,{availableDocuments:p,relatedDocuments:g,relationships:v,isLoading:w,isLoadingAvailable:R,isLoadingRelated:k,loadAvailableDocuments:S,loadRelatedDocuments:C,loadRelationships:P,createRelationship:T,deleteRelationship:d}=Qt((I=o.document)==null?void 0:I.id,{filterFullySigned:o.filterFullySigned}),n=B(()=>{var h;return((h=o.document)==null?void 0:h.state)==="Completed"}),a=B(()=>o.forceRelateTab?o.readonly:o.readonly||!n.value),t=D(a.value?"related":"relate"),c=()=>{var h;return o.forceRelateTab?"relate":a.value||((h=g.value)==null?void 0:h.length)>0?"related":"relate"},b=B(()=>{var _,U,W;const h=o.deferSave?((_=o.pendingRelationships)==null?void 0:_.length)||0:((U=g.value)==null?void 0:U.length)||0,y=[{id:"related",label:"Documentos Relacionados",icon:ie,count:h},{id:"relate",label:"Relacionar Documentos",icon:V,count:(W=p.value)==null?void 0:W.length}];return o.forceRelateTab?y:a.value?y.filter(ue=>ue.id==="related"):y}),J=()=>{u("update-count",{documentId:o.document.id,count:v.value.length}),u("refresh"),u("close")},L=async()=>{var h;if((h=o.document)!=null&&h.id)try{const y=[];if(!a.value){const _=o.filterFullySigned?{filterFullySigned:!0}:{filterCompleted:!0};y.push(S(_))}y.push(C(),P()),await Promise.all(y),t.value=c()}catch{await E("Error al cargar los datos","error")}},ce=async h=>{try{if(!n.value&&!o.forceRelateTab){await E("Solo puedes crear asociaciones para documentos completados.","warning");return}if(o.deferSave){if(!o.pendingRelationships.includes(h.id)){const y=[...o.pendingRelationships,h.id];u("update-pending",y),await E("Documento agregado a relaciones pendientes","success")}return}await T({source_document:o.document.id,target_document:h.id}),await E("Documentos relacionados exitosamente","success"),await L(),u("update-count",{documentId:o.document.id,count:v.value.length}),u("refresh")}catch(y){console.error("Error relating document:",y),await E("Error al relacionar los documentos","error")}},de=async h=>{try{if(o.deferSave){const y=o.pendingRelationships.filter(_=>_!==h);u("update-pending",y),await E("Documento removido de relaciones pendientes","success");return}await d(h),await E("Relación eliminada exitosamente","success"),await L(),u("update-count",{documentId:o.document.id,count:v.value.length}),u("refresh")}catch(y){console.error("Error unrelating document:",y),await E("Error al eliminar la relación","error")}};return ye(()=>o.isOpen,h=>{var y;h&&((y=o.document)!=null&&y.id)&&L()}),be(()=>{var h;o.isOpen&&((h=o.document)!=null&&h.id)&&L()}),(h,y)=>s.isOpen?(r(),l("div",Jt,[e("div",It,[e("div",Wt,[e("div",Yt,[e("div",Gt,[e("div",Kt,[x(f(le),{class:"w-6 h-6 text-white"})]),e("div",Xt,[Zt,e("p",es,m(s.document.title),1),e("p",ts,m(s.filterFullySigned?"Solo documentos firmados disponibles para asociar":"Solo documentos completados de tu propiedad"),1)])]),e("button",{onClick:J,class:"text-white hover:text-blue-200 transition-colors p-3 hover:bg-white hover:bg-opacity-10 rounded-lg flex-shrink-0"},[x(f(K),{class:"w-6 h-6"})])])]),e("div",ss,[e("nav",os,[(r(!0),l(M,null,N(b.value,_=>(r(),l("button",{key:_.id,onClick:U=>t.value=_.id,class:A(["py-3 px-6 text-sm font-medium border-b-2 transition-colors",t.value===_.id?"border-blue-500 text-blue-600 bg-white":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},[e("div",ns,[(r(),O(ve(_.icon),{class:"w-4 h-4"})),e("span",null,m(_.label),1),_.count!==void 0?(r(),l("span",{key:0,class:A(["px-2 py-0.5 rounded-full text-xs",t.value===_.id?"bg-blue-100 text-blue-600":"bg-gray-200 text-gray-600"])},m(_.count),3)):$("",!0)])],10,as))),128))])]),e("div",rs,[f(w)?(r(),l("div",ls,ds)):t.value==="relate"?(r(),l("div",us,[x(rt,{document:s.document,"available-documents":f(p),"is-loading":f(R),readonly:a.value,"defer-save":s.deferSave,"pending-relationships":s.pendingRelationships,onRelateDocument:ce,onRefresh:L},null,8,["document","available-documents","is-loading","readonly","defer-save","pending-relationships"])])):t.value==="related"?(r(),l("div",ms,[x(zt,{document:s.document,"related-documents":f(g),relationships:f(v),"is-loading":f(k),readonly:s.readonly,"defer-save":s.deferSave,"pending-relationships":s.pendingRelationships,"available-documents":f(p),onUnrelateDocument:de,onRefresh:L},null,8,["document","related-documents","relationships","is-loading","readonly","defer-save","pending-relationships","available-documents"])])):$("",!0)]),e("div",{class:"bg-gray-50 px-6 py-4 border-t border-gray-200 rounded-b-lg flex-shrink-0"},[e("div",{class:"flex justify-end space-x-3"},[e("button",{onClick:J,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"}," Cerrar ")])])])])):$("",!0)}};export{_s as _,ws as a,xs as b,ie as r};
