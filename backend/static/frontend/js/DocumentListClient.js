import{e as i,f as p,g as s,r as L,s as A,Y as Pe,b as Oe,c as F,P as oe,j as u,l as d,A as ee,w as Z,v as we,h as Y,F as W,H as J,n as P,M as re,I as R,a4 as ne,t as j,m as te,X as ie,u as xe,aG as Fe,o as ce,an as ze,i as H,L as Be,aW as Ue,k as C,ab as pe,ac as fe,ad as he,ae as X,aa as ve,a0 as le,aU as Qe,J as Ae,K as Te}from"./index.js";import{u as ue,s as de,p as je,o as Ve}from"./dynamicDocument.js";import{r as _e,_ as Ne,D as qe,s as ae}from"./DocumentSignaturesModal.js";import{_ as Re}from"./_plugin-vue_export-helper.js";import{s as We,h as Me,r as ge}from"./loading_message.js";import{r as Ge,a as Xe}from"./PhotoIcon.js";import{useRecentViews as Ze}from"./useRecentViews.js";function be(D,o){return i(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function Os(D,o){return i(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})])}function Qs(D,o){return i(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"})])}function Le(D,o){return i(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"})])}function ye(D,o){return i(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})])}function Ws(D,o){return i(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})])}function Je(){const D=L(!1),o=L("");async function w(_,x,f="",h="",E=[],S={}){if(!x)throw o.value="Recipient email is required.",await A(o.value,"error"),new Error(o.value);const k=new FormData;k.append("to_email",x),k.append("subject",f),k.append("body",h),E.forEach((c,M)=>{k.append(`attachments[${M}]`,c)});for(const[c,M]of Object.entries(S))k.append(c,M);try{D.value=!0,o.value="",We("Sending email...","Please wait while we send the email.");const c=await Pe(_,k);return Me(),await A("Email sent successfully.","success"),c.data}catch(c){throw Me(),console.error("Error sending email:",c.message),o.value="An error occurred while sending the email. Please try again.",await A(o.value,"error"),c}finally{D.value=!1}}return{sendEmail:w,isLoading:D,errorMessage:o}}const Ke={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Ye={class:"flex justify-end"},et=s("label",{for:"email",class:"block text-base font-medium leading-6 text-primary"},[te(" Correo electrónico "),s("span",{class:"text-red-500"},"*")],-1),tt={class:"mt-2"},st={class:"mt-4"},at=s("label",{for:"files",class:"block text-base font-medium leading-6 text-primary"}," Anexos ",-1),ot={key:0,class:"text-center"},rt={class:"mt-4 flex text-sm/6 text-gray-600"},nt={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"},it=s("span",null,"Sube un archivo",-1),lt=s("p",{class:"pl-1"},"o arrastra y suelta",-1),dt=s("p",{class:"text-xs/5 text-gray-600"}," PNG, JPG, PDF, DOCX de hasta 20MB ",-1),ct={key:1,class:"w-full flex flex-wrap gap-3"},ut=["onMouseenter","onMouseleave"],mt=["onClick"],gt={class:"text-center text-xs truncate w-20"},pt=["disabled"],ft=s("span",null,"Enviar",-1),ht=[ft],vt="dynamic-documents/send_email_with_attachments/",_t=20*1024*1024,bt={__name:"SendDocument",props:{emailDocument:{type:Object,required:!0}},emits:["closeEmailModal"],setup(D,{emit:o}){const w=o,{sendEmail:_}=Je(),x=L(null),f=D,h=()=>{E.email="",S.value=[],x.value=null},E=Oe({email:""}),S=L([]),k=v=>{const b=Array.from(v.target.files);M(b),v.target.value=null},c=v=>{const b=Array.from(v.dataTransfer.files);M(b)},M=v=>{let b=S.value.reduce(($,q)=>$+q.file.size,0);v.forEach($=>{if($.size>_t){A(`The file "${$.name}" exceeds the 20 MB limit.`,"warning");return}const q=$.name.split(".").pop().toLowerCase();let T="",N={general:"",xMark:""};switch(q){case"png":case"jpg":case"jpeg":T=Xe,N.general="border-gray-200 text-gray-400",N.xMark="bg-gray-400";break;case"pdf":T=ge,N.general="border-red-600/20 text-red-600/60",N.xMark="bg-red-600/60";break;case"docx":T=ge,N.general="border-blue-600/20 text-blue-600/60",N.xMark="bg-blue-600/60";break;default:A("Unsupported file type. Only PDF, DOCX, JPG, and PNG are allowed.","warning");return}S.value.push({name:$.name,icon:T,style:N,hover:!1,file:$}),b+=$.size})},V=v=>{S.value.splice(v,1)},g=v=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v),U=F(()=>g(E.email)),m=F(()=>U.value),z=async v=>{try{const b=await ie(`dynamic-documents/${v}/download-pdf/`,"blob");if(!b||!b.data)throw new Error("Invalid response from server");return new File([b.data],`document_${v}.pdf`,{type:"application/pdf"})}catch(b){return console.error("Error downloading PDF:",b),A("No se pudo descargar el documento PDF.","error"),null}};oe(()=>f.emailDocument,v=>{v&&Object.keys(v).length>0&&v.id&&z(v.id)},{immediate:!0});const O=async()=>{try{if(f.emailDocument.id){const b=await z(f.emailDocument.id);b&&S.value.push({name:b.name,file:b,icon:ge,style:{general:"border-blue-600/20 text-blue-600/60",xMark:"bg-blue-600/60"},hover:!1})}const v=S.value.map(b=>b.file);await _(vt,E.email,f.emailDocument.title,"Attached is the requested document along with additional attachments.",v,{documentId:f.emailDocument.id})}catch(v){console.error("Error sending the email:",v)}finally{Q()}},Q=()=>{h(),w("closeEmailModal")};return(v,b)=>(i(),p("div",Ke,[s("div",Ye,[s("button",{onClick:b[0]||(b[0]=$=>Q())},[u(d(ee),{class:"size-6"})])]),s("form",{onSubmit:Y(O,["prevent"])},[s("div",null,[et,s("div",tt,[Z(s("input",{"onUpdate:modelValue":b[1]||(b[1]=$=>E.email=$),type:"text",name:"email",id:"email",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[we,E.email]])])]),s("div",st,[at,s("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 bg-white px-6 py-10",onDragover:b[2]||(b[2]=Y(()=>{},["prevent"])),onDrop:Y(c,["prevent"])},[S.value.length<1?(i(),p("div",ot,[u(d(Ge),{class:"mx-auto size-12 text-gray-300","aria-hidden":"true"}),s("div",rt,[s("label",nt,[it,s("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",onChange:k},null,32)]),lt]),dt])):(i(),p("div",ct,[(i(!0),p(W,null,J(S.value,($,q)=>(i(),p("div",{key:q,class:P(["relative p-4 grid rounded-md bg-white border-2",$.style.general]),onMouseenter:T=>$.hover=!0,onMouseleave:T=>$.hover=!1},[Z(s("div",{class:P(["absolute p-0.5 mt-2 ml-2 rounded-full",$.style.xMark]),onClick:T=>V(q)},[u(d(ee),{class:"size-3 text-white"})],10,mt),[[re,$.hover]]),(i(),R(ne($.icon),{class:"size-12 mx-auto"})),s("span",gt,j($.name),1)],42,ut))),128))]))],32)]),s("button",{type:"submit",class:P(["mt-4 p-2.5 text-sm font-medium rounded-md flex gap-2",m.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!m.value},ht,10,pt)],32)]))}},yt={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},wt={class:"flex justify-end"},xt=s("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[te(" Nombre "),s("span",{class:"text-red-500"},"*")],-1),Dt={class:"mt-2"},kt={class:"flex gap-2 mt-2.5"},St=["disabled"],$t=s("span",null,"Actualizar nombre",-1),It=[$t],Ct=["disabled"],Et={__name:"CreateDocumentByLawyer",emits:["close"],setup(D,{emit:o}){const w=xe(),_=ue(),x=o,f=L(""),h=L("");Fe(()=>{var g;(g=_.selectedDocument)!=null&&g.title?(f.value=_.selectedDocument.title,h.value=_.selectedDocument.title):(f.value="",h.value="")});const E=g=>{g.key==="Escape"&&x("close")};ce(()=>{document.addEventListener("keydown",E)}),ze(()=>{document.removeEventListener("keydown",E)});const S=F(()=>f.value.trim().length>0),k=F(()=>{var g;return!!((g=_.selectedDocument)!=null&&g.id)}),c=F(()=>k.value&&f.value.trim()!==h.value.trim()&&f.value.trim().length>0);async function M(){if(k.value&&c.value)try{const g={title:f.value.trim()};await _.updateDocument(_.selectedDocument.id,g),h.value=f.value.trim(),_.selectedDocument.title=f.value.trim(),_.lastUpdatedDocumentId=_.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",_.selectedDocument.id);const U=_.selectedDocument.id;x("close",{updatedDocId:U});const m=window.location.pathname;m==="/dynamic_document_dashboard"||m==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(U)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(g){console.error("Error updating document name:",g)}}const V=async()=>{if(!S.value)return;const g=encodeURIComponent(f.value.trim());k.value?(_.selectedDocument.title=f.value,_.selectedDocument.id&&(_.lastUpdatedDocumentId=_.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",_.selectedDocument.id.toString())),w.push(`/dynamic_document_dashboard/lawyer/editor/edit/${_.selectedDocument.id}`)):(_.selectedDocument={title:f.value.trim()},w.push(`/dynamic_document_dashboard/lawyer/editor/create/${g}`))};return(g,U)=>(i(),p("div",yt,[s("div",wt,[s("button",{onClick:U[0]||(U[0]=m=>x("close"))},[u(d(ee),{class:"size-6"})])]),s("form",{onSubmit:Y(V,["prevent"])},[s("div",null,[xt,s("div",Dt,[Z(s("input",{"onUpdate:modelValue":U[1]||(U[1]=m=>f.value=m),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[we,f.value]])])]),s("div",kt,[k.value?(i(),p("button",{key:0,type:"button",onClick:M,disabled:!c.value,class:P(["p-2.5 text-sm font-medium rounded-md flex gap-2",c.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},It,10,St)):H("",!0),s("button",{type:"submit",class:P(["p-2.5 text-sm font-medium rounded-md flex gap-2",S.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!S.value},[s("span",null,j(k.value?"Editar Documento":"Continuar"),1)],10,Ct)])],32)]))}},K=D=>(Ae("data-v-d009b0dc"),D=D(),Te(),D),Ut=["data-document-id"],Mt={class:"flex-1 flex justify-between items-center"},Lt={class:"grid gap-1"},Pt={class:"flex items-center"},Ft={class:"text-base font-medium"},zt={key:0,class:"relative group ml-2"},Bt={key:0,class:"h-4 w-4 text-green-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},At=K(()=>s("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1)),Tt=K(()=>s("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)),jt=[At,Tt],Vt={key:1,class:"h-4 w-4 text-blue-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Nt=K(()=>s("path",{d:"M20 6L9 17l-5-5"},null,-1)),qt=[Nt],Rt={key:2,class:"h-4 w-4 text-yellow-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ht=K(()=>s("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),Ot=[Ht],Qt={key:3,class:"h-4 w-4 text-blue-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Wt=K(()=>s("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),Gt=[Wt],Xt={class:"absolute z-10 w-48 px-2 py-1 text-xs bg-gray-800 text-white rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 delay-150 -top-8 left-0 pointer-events-none tooltip-with-arrow"},Zt={class:"text-sm font-regular text-gray-400"},Jt=["disabled","onClick"],Kt={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4"},Yt=["data-document-id"],es={class:"flex-1 flex justify-between items-center"},ts={class:"grid gap-1"},ss={class:"flex items-center"},as={class:"text-base font-medium"},os={class:"text-sm font-regular text-gray-400"},rs=["disabled","onClick"],ns={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-auto"},is={class:"flex justify-between items-center mb-4"},ls=K(()=>s("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1)),ds={__name:"DocumentListLawyer",props:{searchQuery:String,promptDocuments:{type:Array,default:null}},setup(D){const o=ue(),w=Be(),_=xe(),x=L(!1),f=L(!1),h=L(null),E=L([]),S=L([]),k=L(!1),c=D,M=F(()=>c.promptDocuments?[]:(o.getDocumentsByLawyerId(w.currentUser.id)||[]).filter(a=>a.state!=="FullySigned").filter(a=>a.title&&a.title.toLowerCase().includes(c.searchQuery.toLowerCase()))),V=F(()=>{if(c.promptDocuments)return[];const e=o.getDocumentsByLawyerId(w.currentUser.id)||[],a=S.value||[],t=new Map;return e.filter(n=>n.state==="FullySigned").forEach(n=>t.set(n.id,n)),a.filter(n=>n.state==="FullySigned").forEach(n=>t.set(n.id,n)),Array.from(t.values()).filter(n=>n.title&&n.title.toLowerCase().includes(c.searchQuery.toLowerCase()))}),g=F(()=>c.promptDocuments&&c.promptDocuments.length>0?(c.promptDocuments||[]).filter(e=>e.title&&e.title.toLowerCase().includes(c.searchQuery.toLowerCase())):[]);F(()=>c.promptDocuments?g.value.length===0:M.value.length===0&&V.value.length===0);const U=F(()=>c.promptDocuments?g.value:M.value),m=F(()=>{if(c.promptDocuments)return null;const e=o.lastUpdatedDocumentId,a=localStorage.getItem("lastUpdatedDocumentId"),t=[...M.value,...V.value];return e&&t.some(B=>String(B.id)===String(e))?e:a&&t.some(B=>String(B.id)===String(a))?a:null}),z=async()=>{try{const e=w.currentUser.id,a=await ie(`dynamic-documents/user/${e}/pending-documents-full/`),t=await ie(`dynamic-documents/user/${e}/signed-documents/`);a.status===200&&(E.value=a.data),t.status===200&&(S.value=t.data)}catch(e){console.error("Error fetching lawyer documents:",e),e.response&&(console.error("Error response data:",e.response.data),console.error("Error status:",e.response.status))}},O=e=>{const a=[{label:"Editar",action:"edit"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"}];if(e.requires_signature&&e.signatures&&e.signatures.length>0){const n=String(w.currentUser.id);e.signatures.find(y=>String(y.signer_id)===n&&!y.signed)}return e.state==="Draft"?a.push({label:"Publicar",action:"publish",disabled:!Q(e)}):e.state==="Published"&&(a.push({label:"Mover a Borrador",action:"draft",disabled:!1}),a.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:!1}),a.push({label:"Mover a Borrador",action:"draft",disabled:!1})),E.value.some(n=>n.id===e.id)&&a.push({label:"Firmar documento",action:"sign_document",disabled:!1}),a},Q=e=>e.variables.every(a=>a.value&&a.value.trim().length>0),v=e=>{if(!e.signatures||!e.requires_signature)return null;const a=String(w.currentUser.id);return e.signatures.find(t=>String(t.signer_id)===a)},b=e=>{if(!e.requires_signature)return"";if(e.fully_signed)return"Documento formalizado";const a=v(e);if(e.signatures&&e.signatures.length>0){const t=e.signatures.length,n=e.signatures.filter(y=>y.signed).length;if(a&&a.signed){if(n===1&&t>1)return`Has firmado. Faltan ${t-n} firmas más`;if(n<t)return`Has firmado. Faltan ${t-n} firmas más`}return`Firmas: ${n}/${t}`}return a?"Requiere tu firma":"Requiere firmas"},$=async(e,a)=>{switch(e){case"edit":o.selectedDocument=a,x.value=!0;break;case"delete":await ae(`¿Deseas eliminar el documento '${a.title}'?`)&&(await o.deleteDocument(a.id),await A("Documento eliminado correctamente.","success"));break;case"publish":await q(a);break;case"draft":await T(a);break;case"preview":Ve(a);break;case"sign_document":me(a);break;case"formalize":l(a);break;default:console.warn(`Acción desconocida: ${e}`)}},q=async e=>{const a={...e,state:"Published"};await o.updateDocument(e.id,a),o.lastUpdatedDocumentId=e.id,localStorage.setItem("lastUpdatedDocumentId",e.id),G(e.id);const t=window.location.pathname;t==="/dynamic_document_dashboard"||t==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},800)},T=async e=>{const a={...e,state:"Draft"};await o.updateDocument(e.id,a),o.lastUpdatedDocumentId=e.id,localStorage.setItem("lastUpdatedDocumentId",e.id),G(e.id);const t=window.location.pathname;t==="/dynamic_document_dashboard"||t==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},800)},N=e=>{if(x.value=!1,o.selectedDocument=null,e&&e.updatedDocId){o.lastUpdatedDocumentId=e.updatedDocId,localStorage.setItem("lastUpdatedDocumentId",e.updatedDocId),G(e.updatedDocId);const a=window.location.pathname;a==="/dynamic_document_dashboard"||a==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},800)}};oe(U,e=>{if(!c.promptDocuments&&o.lastUpdatedDocumentId&&!e.some(t=>String(t.id)===String(o.lastUpdatedDocumentId))&&e.length>0){const n=[...e].sort((y,B)=>B.id-y.id)[0].id;o.lastUpdatedDocumentId=n,localStorage.setItem("lastUpdatedDocumentId",n)}});const G=e=>{e&&setTimeout(()=>{try{const a=document.querySelectorAll(`[data-document-id="${e}"]`);if(a.length>0){const t=a[0];t.style.border="2px solid #3b82f6",t.classList.remove("animate-pulse-highlight"),t.offsetWidth,t.classList.add("animate-pulse-highlight"),t.scrollIntoView({behavior:"smooth",block:"center"})}}catch(a){console.error("Error forcing highlight:",a)}},100)};window.forceDocumentHighlight=G,ce(async()=>{if(c.promptDocuments)return;await o.init();const e=localStorage.getItem("lastUpdatedDocumentId");e&&(o.lastUpdatedDocumentId=e,setTimeout(()=>{U.value.some(t=>String(t.id)===String(e))&&G(e)},500)),z()});const me=async e=>{try{if(!w.currentUser.has_signature){await ae("No tienes una firma registrada. ¿Deseas crear una firma ahora?","Necesitas una firma","Crear firma","Cancelar")&&(k.value=!0);return}if(!await ae(`¿Estás seguro de que deseas firmar el documento "${e.title}"?`,"Confirmar firma","Firmar","Cancelar"))return;const t=await Pe(`dynamic-documents/${e.id}/sign/${w.currentUser.id}/`,{});if(t.status!==200&&t.status!==201)throw new Error(`Error al firmar: ${t.statusText}`);await A("Documento firmado correctamente","success"),await new Promise(n=>setTimeout(n,1e3)),await z(),o.lastUpdatedDocumentId=e.id,localStorage.setItem("lastUpdatedDocumentId",e.id),G(e.id),setTimeout(()=>{window.location.reload()},1500)}catch(a){console.error("Error signing document:",a),a.response&&(console.error("Error response data:",a.response.data),console.error("Error status:",a.response.status)),await A(`Error signing document: ${a.message}`,"error")}},r=()=>{f.value=!1},I=async()=>{await o.init()},l=async e=>{try{_.push({path:`/dynamic_document_dashboard/document/use/formalize/${e.id}/${e.title}`})}catch(a){console.error("Error al formalizar el documento:",a),await A("Error al formalizar el documento","error")}};return(e,a)=>(i(),p(W,null,[c.promptDocuments&&g.value.length>0?(i(!0),p(W,{key:0},J(g.value,t=>{var n;return i(),p("div",{key:t.id,"data-document-id":t.id,class:P(["flex items-center gap-3 py-2 px-4 border rounded-xl cursor-pointer mb-3",t.state==="Published"||t.state==="FullySigned"?"border-green-400 bg-green-300/30 hover:bg-green-300/50":"border-stroke bg-white hover:bg-gray-100",m.value&&String(m.value)===String(t.id)?"animate-pulse-highlight":""]),style:Ue(m.value&&String(m.value)===String(t.id)?"border: 1px solid #CCE0FF !important;":"")},[(i(),R(ne(t.state==="Published"||t.state==="FullySigned"?d(be):d(ye)),{class:P(t.state==="Published"||t.state==="FullySigned"?"size-8 text-green-500":"size-8 text-secondary")},null,8,["class"])),s("div",Mt,[s("div",Lt,[s("div",Pt,[s("span",Ft,j(t.title),1),t.requires_signature?(i(),p("div",zt,[t.fully_signed?(i(),p("svg",Bt,jt)):(n=v(t))!=null&&n.signed?(i(),p("svg",Vt,qt)):v(t)?(i(),p("svg",Rt,Ot)):(i(),p("svg",Qt,Gt)),s("div",Xt,j(t.fully_signed?"Documento formalizado":b(t)),1)])):H("",!0)]),s("span",Zt,j(t.state==="Published"?"Publicado":t.state==="Draft"?"Borrador":t.state==="Progress"?"En progreso":t.state==="Completed"?"Completado":t.state==="PendingSignatures"?"Pendiente de firmas":t.state==="FullySigned"?"Completamente firmado":"Desconocido"),1)]),u(d(ve),{as:"div",class:"relative inline-block text-left"},{default:C(()=>[u(d(pe),{class:"flex items-center text-gray-400"},{default:C(()=>[u(d(_e),{class:"size-6","aria-hidden":"true"})]),_:1}),u(fe,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:C(()=>[u(d(he),{class:P(["absolute z-20 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5",[c.promptDocuments?"right-auto left-0 -translate-x-[calc(100%-24px)]":"right-0 left-auto"]])},{default:C(()=>[(i(!0),p(W,null,J(O(t),y=>(i(),R(d(X),{key:y.label},{default:C(()=>[s("button",{class:P(["w-full text-left px-4 py-2 text-sm font-regular transition flex items-center gap-2",{"opacity-50 cursor-not-allowed":y.disabled,"cursor-pointer":!y.disabled}]),disabled:y.disabled,onClick:B=>!y.disabled&&$(y.action,t)},[y.disabled?(i(),R(d(Le),{key:0,class:"size-5 text-gray-400","aria-hidden":"true"})):H("",!0),te(" "+j(y.label),1)],10,Jt)]),_:2},1024))),128))]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024)])],14,Ut)}),128)):c.promptDocuments?H("",!0):(i(),p("div",Kt,[(i(!0),p(W,null,J(M.value.filter(t=>!t.requires_signature),t=>(i(),p("div",{key:t.id,"data-document-id":t.id,class:P(["flex items-center gap-3 py-2 px-4 border rounded-xl cursor-pointer mb-3",t.state==="Published"||t.state==="FullySigned"?"border-green-400 bg-green-300/30 hover:bg-green-300/50":"border-stroke bg-white hover:bg-gray-100",m.value&&String(m.value)===String(t.id)?"animate-pulse-highlight":""]),style:Ue(m.value&&String(m.value)===String(t.id)?"border: 1px solid #CCE0FF !important;":"")},[(i(),R(ne(t.state==="Published"||t.state==="FullySigned"?d(be):d(ye)),{class:P(t.state==="Published"||t.state==="FullySigned"?"size-8 text-green-500":"size-8 text-secondary")},null,8,["class"])),s("div",es,[s("div",ts,[s("div",ss,[s("span",as,j(t.title),1)]),s("span",os,j(t.state==="Published"?"Publicado":t.state==="Draft"?"Borrador":t.state==="Progress"?"En progreso":t.state==="Completed"?"Completado":t.state==="PendingSignatures"?"Pendiente de firmas":t.state==="FullySigned"?"Completamente firmado":"Desconocido"),1)]),u(d(ve),{as:"div",class:"relative inline-block text-left"},{default:C(()=>[u(d(pe),{class:"flex items-center text-gray-400"},{default:C(()=>[u(d(_e),{class:"size-6","aria-hidden":"true"})]),_:1}),u(fe,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:C(()=>[u(d(he),{class:P(["absolute z-20 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5",[c.promptDocuments?"right-auto left-0 -translate-x-[calc(100%-24px)]":"right-0 left-auto"]])},{default:C(()=>[(i(!0),p(W,null,J(O(t),n=>(i(),R(d(X),{key:n.label},{default:C(()=>[s("button",{class:P(["w-full text-left px-4 py-2 text-sm font-regular transition flex items-center gap-2",{"opacity-50 cursor-not-allowed":n.disabled,"cursor-pointer":!n.disabled}]),disabled:n.disabled,onClick:y=>!n.disabled&&$(n.action,t)},[n.disabled?(i(),R(d(Le),{key:0,class:"size-5 text-gray-400","aria-hidden":"true"})):H("",!0),te(" "+j(n.label),1)],10,rs)]),_:2},1024))),128))]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024)])],14,Yt))),128))])),Z(u(le,null,{default:C(()=>[u(Et,{onClose:N})]),_:1},512),[[re,x.value]]),u(Ne,{isVisible:d(de),documentData:d(je),onClose:a[0]||(a[0]=t=>de.value=!1)},null,8,["isVisible","documentData"]),u(qe,{isVisible:f.value,documentId:h.value,onClose:r,onRefresh:I},null,8,["isVisible","documentId"]),k.value?(i(),R(le,{key:2},{default:C(()=>[s("div",ns,[s("div",is,[ls,s("button",{onClick:a[1]||(a[1]=t=>k.value=!1),class:"text-gray-400 hover:text-gray-500"},[u(d(ee),{class:"h-6 w-6"})])]),u(Qe,{initialShowOptions:!0,"user-id":d(w).currentUser.id,onSignatureSaved:e.handleSignatureSaved,onCancel:a[2]||(a[2]=t=>k.value=!1)},null,8,["user-id","onSignatureSaved"])])]),_:1})):H("",!0)],64))}},Gs=Re(ds,[["__scopeId","data-v-d009b0dc"]]),cs={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},us={class:"flex justify-end"},ms=s("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[te(" Nombre "),s("span",{class:"text-red-500"},"*")],-1),gs={class:"mt-2"},ps={class:"flex gap-2 mt-2.5"},fs=["disabled"],hs=s("span",null,"Actualizar nombre",-1),vs=[hs],_s=["disabled"],bs={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(D,{emit:o}){const w=D,_=xe(),x=ue(),f=o,h=L(""),E=L(""),S=()=>{f("close")};Fe(()=>{var m,z;x.selectedDocument?(h.value=((m=x.selectedDocument)==null?void 0:m.title)||"",E.value=((z=x.selectedDocument)==null?void 0:z.title)||""):(h.value="",E.value="")});const k=m=>{m.key==="Escape"&&S()};ce(()=>{document.addEventListener("keydown",k)}),ze(()=>{document.removeEventListener("keydown",k)});const c=F(()=>h.value.trim().length>0),M=F(()=>{var m;return!!((m=x.selectedDocument)!=null&&m.id)}),V=F(()=>M.value&&h.value.trim()!==E.value.trim()&&h.value.trim().length>0);async function g(){if(M.value&&V.value)try{const m={title:h.value.trim()};await x.updateDocument(x.selectedDocument.id,m),E.value=h.value.trim(),x.selectedDocument.title=h.value.trim();const z=x.selectedDocument.id;A("Document name successfully updated.","success"),f("close",{updatedDocId:z});const Q=window.location.pathname;Q==="/dynamic_document_dashboard"||Q==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(m){console.error("Error updating document name:",m),A("Error updating document name.","error")}}function U(){const m=encodeURIComponent(h.value.trim());w.documentId&&!x.selectedDocument?_.push(`/dynamic_document_dashboard/document/use/creator/${w.documentId}/${m}`):x.selectedDocument?(x.selectedDocument.title=h.value.trim(),_.push(`/dynamic_document_dashboard/document/use/editor/${x.selectedDocument.id}/${m}`)):A("Error: No se pudo continuar. Documento no seleccionado.","error")}return(m,z)=>(i(),p("div",cs,[s("div",us,[s("button",{onClick:S},[u(d(ee),{class:"size-6"})])]),s("form",{onSubmit:Y(U,["prevent"])},[s("div",null,[ms,s("div",gs,[Z(s("input",{"onUpdate:modelValue":z[0]||(z[0]=O=>h.value=O),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[we,h.value]])])]),s("div",ps,[M.value?(i(),p("button",{key:0,type:"button",onClick:g,disabled:!V.value,class:P(["p-2.5 text-sm font-medium rounded-md flex gap-2",V.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},vs,10,fs)):H("",!0),s("button",{type:"submit",class:P(["p-2.5 text-sm font-medium rounded-md flex gap-2",c.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!c.value},[s("span",null,j(M.value?"Editar Documento":"Continuar"),1)],10,_s)])],32)]))}},He=D=>(Ae("data-v-06464e4a"),D=D(),Te(),D),ys={class:"mb-6"},ws=["data-document-id","onClick"],xs={class:"flex justify-between items-center w-full"},Ds={class:"grid gap-1"},ks={class:"text-base font-medium"},Ss={class:"text-sm font-regular text-gray-400"},$s={class:"py-1"},Is=["onClick"],Cs=["onClick"],Es=["onClick"],Us=["onClick"],Ms=["onClick"],Ls=["onClick"],Ps={key:0,class:"col-span-full mt-6 flex flex-col items-center justify-center text-center text-gray-500 w-full p-8 rounded-xl"},Fs=He(()=>s("p",{class:"text-lg font-semibold mb-2"}," No hay documentos disponibles para mostrar. ",-1)),zs=He(()=>s("p",{class:"text-sm"}," Contacta a tu abogado para gestionar tus documentos. ",-1)),Bs=[Fs,zs],As={__name:"DocumentListClient",props:{searchQuery:String,promptDocuments:{type:Array,default:null}},setup(D){const o=ue(),w=Be(),{registerView:_}=Ze(),x=F(()=>w.getCurrentUser),f=L(!1),h=L(null),E=L(!1),S=L({}),k=L(!1),c=L([]),M=L(!1);w.userSignature;const V=F(()=>{if(g.promptDocuments)return null;const r=o.lastUpdatedDocumentId,I=localStorage.getItem("lastUpdatedDocumentId");return r&&U.value.some(e=>String(e.id)===String(r))?r:I&&U.value.some(a=>String(a.id)===String(I))?I:null}),g=D;ce(async()=>{if(g.promptDocuments)return;await o.init(),await m();const r=localStorage.getItem("lastUpdatedDocumentId");r&&!o.lastUpdatedDocumentId&&(o.lastUpdatedDocumentId=r),o.lastUpdatedDocumentId&&U.value.some(I=>String(I.id)===String(o.lastUpdatedDocumentId))}),oe(()=>o.lastUpdatedDocumentId,r=>{g.promptDocuments||r&&localStorage.setItem("lastUpdatedDocumentId",r)});const U=F(()=>{var e,a;if(g.promptDocuments){const t=(e=x.value)==null?void 0:e.id;let n=g.promptDocuments.filter(y=>{const B=y.assigned_to?String(y.assigned_to):null,se=String(t);return B===se&&(y.state==="Progress"||y.state==="Completed")});if(g.searchQuery){const y=g.searchQuery.toLowerCase();n=n.filter(B=>{var se,De,ke,Se,$e,Ie,Ce,Ee;return B.title.toLowerCase().includes(y)||B.state.toLowerCase().includes(y)||B.assigned_to&&w&&(((De=(se=w.userById(B.assigned_to))==null?void 0:se.first_name)==null?void 0:De.toLowerCase().includes(y))||((Se=(ke=w.userById(B.assigned_to))==null?void 0:ke.last_name)==null?void 0:Se.toLowerCase().includes(y))||((Ie=($e=w.userById(B.assigned_to))==null?void 0:$e.email)==null?void 0:Ie.toLowerCase().includes(y))||((Ee=(Ce=w.userById(B.assigned_to))==null?void 0:Ce.identification)==null?void 0:Ee.toLowerCase().includes(y)))})}return n}const r=o.progressAndCompletedDocumentsByClient((a=x.value)==null?void 0:a.id);return o.filteredDocuments(g.searchQuery,w).filter(t=>r.some(n=>String(n.id)===String(t.id)))}),m=async()=>{M.value=!0;try{const r=w.currentUser.id;if(!r)return;const I=await ie(`dynamic-documents/user/${r}/pending-documents-full/`);c.value=I.data}catch(r){console.error("Error fetching documents:",r),r.response&&console.error("Error details:",r.response.data),await A("Error al cargar documentos","error"),c.value=[]}finally{M.value=!1}},z=r=>{o.downloadPDF(r.id,r.title)},O=r=>{o.downloadWord(r.id,r.title)},Q=async r=>{await ae(`¿Deseas eliminar el documento "${r.title}"?`)&&(await o.deleteDocument(r.id),await A("Documento eliminado exitosamente.","success"))},v=r=>{o.selectedDocument=r,h.value=r.id,f.value=!0},b=r=>{f.value=!1,r&&r.updatedDocId&&T(r.updatedDocId),o.clearSelectedDocument()},$=r=>{S.value=r,E.value=!0},q=()=>{S.value={},E.value=!1};oe(U,r=>{if(!g.promptDocuments&&o.lastUpdatedDocumentId&&!r.some(l=>String(l.id)===String(o.lastUpdatedDocumentId))&&r.length>0){const e=[...r].sort((a,t)=>t.id-a.id)[0].id;o.lastUpdatedDocumentId=e,localStorage.setItem("lastUpdatedDocumentId",e)}});const T=r=>{r&&(o.lastUpdatedDocumentId=r,localStorage.setItem("lastUpdatedDocumentId",r),setTimeout(()=>{try{const I=document.querySelectorAll(`[data-document-id="${r}"]`);if(I.length>0){const l=I[0];l.style.border="3px solid #3b82f6",l.classList.remove("animate-pulse-highlight"),l.classList.remove("border-secondary"),l.classList.remove("shadow-md"),l.offsetWidth,l.classList.add("animate-pulse-highlight"),l.classList.add("border-secondary"),l.classList.add("shadow-md"),l.scrollIntoView({behavior:"smooth",block:"center"})}}catch(I){console.error("Error forcing highlight:",I)}},100))};window.forceDocumentHighlight=T;const N=async r=>{await _("document",r.id),Ve(r)},G=()=>{k.value=!1},me=async()=>{await o.init(!0),U.value.some(I=>String(I.id)===String(h.value))&&(o.lastUpdatedDocumentId=h.value,localStorage.setItem("lastUpdatedDocumentId",h.value),T(h.value))};return(r,I)=>(i(),p(W,null,[s("div",null,[s("div",ys,[(i(!0),p(W,null,J(U.value,l=>(i(),p("div",{key:l.id,"data-document-id":l.id,class:P(["flex items-center gap-3 py-2 px-4 border rounded-xl cursor-pointer mb-3",{"border-green-400 bg-green-300/30":l.state==="Completed","border-stroke bg-white":l.state==="Progress","border-secondary shadow-md animate-pulse-highlight":String(l.id)===String(V.value)}]),onClick:e=>{e.target.closest(".menu-container")||N(l)}},[(i(),R(ne(l.state==="Completed"?d(be):d(ye)),{class:P(["size-6",{"text-green-500":l.state==="Completed","text-secondary":l.state==="Progress"}])},null,8,["class"])),s("div",xs,[s("div",Ds,[s("span",ks,j(l.title),1),s("span",Ss,j(l.description),1)]),u(d(ve),{as:"div",class:"relative inline-block text-left menu-container"},{default:C(()=>[u(d(pe),{class:"flex items-center text-gray-400"},{default:C(()=>[u(d(_e),{class:"size-6","aria-hidden":"true"})]),_:1}),u(fe,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:C(()=>[u(d(he),{class:P(["absolute z-10 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",[g.promptDocuments?"right-auto left-0 -translate-x-[calc(100%-24px)]":"right-0 left-auto"]])},{default:C(()=>[s("div",$s,[u(d(X),null,{default:C(()=>[s("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:e=>v(l)},j(l.state==="Completed"?"Editar":"Completar"),9,Is)]),_:2},1024),l.state==="Completed"?(i(),R(d(X),{key:0},{default:C(()=>[s("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:e=>N(l)}," Previsualizar ",8,Cs)]),_:2},1024)):H("",!0),u(d(X),null,{default:C(()=>[s("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:e=>Q(l)}," Eliminar ",8,Es)]),_:2},1024),l.state==="Completed"?(i(),p(W,{key:1},[u(d(X),null,{default:C(()=>[s("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:e=>z(l)}," Descargar PDF ",8,Us)]),_:2},1024),u(d(X),null,{default:C(()=>[s("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:e=>O(l)}," Descargar Word ",8,Ms)]),_:2},1024),u(d(X),null,{default:C(()=>[s("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:e=>$(l)}," Enviar ",8,Ls)]),_:2},1024)],64)):H("",!0)])]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024)])],10,ws))),128))]),U.value.length===0?(i(),p("div",Ps,Bs)):H("",!0),Z(u(le,null,{default:C(()=>[u(bs,{"document-id":h.value,onClose:b},null,8,["document-id"])]),_:1},512),[[re,f.value]])]),u(Ne,{isVisible:d(de),documentData:d(je),onClose:I[0]||(I[0]=l=>de.value=!1)},null,8,["isVisible","documentData"]),Z(u(le,null,{default:C(()=>[u(bt,{onCloseEmailModal:I[1]||(I[1]=l=>q()),emailDocument:S.value},null,8,["emailDocument"])]),_:1},512),[[re,E.value]]),u(qe,{isVisible:k.value,documentId:h.value,onClose:G,onRefresh:me},null,8,["isVisible","documentId"])],64))}},Xs=Re(As,[["__scopeId","data-v-06464e4a"]]);export{Gs as D,bt as _,ye as a,Os as b,Qs as c,Xs as d,bs as e,be as f,Et as g,Ws as r};
