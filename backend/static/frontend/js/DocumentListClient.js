import{e as c,f as w,g as e,r as E,s as T,Y as Ue,b as Le,c as U,P as X,j as f,l as m,A as Z,w as F,v as ae,h as R,F as V,H as J,n as M,M as W,I as N,a3 as ne,t as z,m as ee,X as Pe,k as S,ag as Be,u as he,aF as ge,o as te,am as fe,i as O,L as ve,aT as Te,aa as be,ab as _e,ac as we,ad as j,a9 as ye,J as ze,K as Ae}from"./index.js";import{u as se,s as K,p as xe,o as De}from"./dynamicDocument.js";import{r as Fe,a as je,_ as Y}from"./ModalTransition.js";import{_ as ke}from"./_plugin-vue_export-helper.js";import{s as Ve,h as pe,r as oe}from"./loading_message.js";import{useRecentViews as Ne}from"./useRecentViews.js";function $e(p,o){return c(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function ms(p,o){return c(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})])}function Ie(p,o){return c(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"})])}function ps(p,o){return c(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"})])}function qe(p,o){return c(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"})])}function Ce(p,o){return c(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})])}function hs(p,o){return c(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})])}function Oe(){const p=E(!1),o=E("");async function $(i,d,l="",h="",I=[],y={}){if(!d)throw o.value="Recipient email is required.",await T(o.value,"error"),new Error(o.value);const C=new FormData;C.append("to_email",d),C.append("subject",l),C.append("body",h),I.forEach((u,D)=>{C.append(`attachments[${D}]`,u)});for(const[u,D]of Object.entries(y))C.append(u,D);try{p.value=!0,o.value="",Ve("Sending email...","Please wait while we send the email.");const u=await Ue(i,C);return pe(),await T("Email sent successfully.","success"),u.data}catch(u){throw pe(),console.error("Error sending email:",u.message),o.value="An error occurred while sending the email. Please try again.",await T(o.value,"error"),u}finally{p.value=!1}}return{sendEmail:$,isLoading:p,errorMessage:o}}const He={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Qe={class:"flex justify-end"},Re=e("label",{for:"email",class:"block text-base font-medium leading-6 text-primary"},[ee(" Correo electrónico "),e("span",{class:"text-red-500"},"*")],-1),Ze={class:"mt-2"},We={class:"mt-4"},Ge=e("label",{for:"files",class:"block text-base font-medium leading-6 text-primary"}," Anexos ",-1),Xe={key:0,class:"text-center"},Je={class:"mt-4 flex text-sm/6 text-gray-600"},Ke={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"},Ye=e("span",null,"Sube un archivo",-1),et=e("p",{class:"pl-1"},"o arrastra y suelta",-1),tt=e("p",{class:"text-xs/5 text-gray-600"}," PNG, JPG, PDF, DOCX de hasta 20MB ",-1),st={key:1,class:"w-full flex flex-wrap gap-3"},ot=["onMouseenter","onMouseleave"],at=["onClick"],nt={class:"text-center text-xs truncate w-20"},rt=["disabled"],lt=e("span",null,"Enviar",-1),it=[lt],dt="dynamic-documents/send_email_with_attachments/",ct=20*1024*1024,ut={__name:"SendDocument",props:{emailDocument:{type:Object,required:!0}},emits:["closeEmailModal"],setup(p,{emit:o}){const $=o,{sendEmail:i}=Oe(),d=E(null),l=p,h=()=>{I.email="",y.value=[],d.value=null},I=Le({email:""}),y=E([]),C=g=>{const v=Array.from(g.target.files);D(v),g.target.value=null},u=g=>{const v=Array.from(g.dataTransfer.files);D(v)},D=g=>{let v=y.value.reduce((s,_)=>s+_.file.size,0);g.forEach(s=>{if(s.size>ct){T(`The file "${s.name}" exceeds the 20 MB limit.`,"warning");return}const _=s.name.split(".").pop().toLowerCase();let r="",k={general:"",xMark:""};switch(_){case"png":case"jpg":case"jpeg":r=je,k.general="border-gray-200 text-gray-400",k.xMark="bg-gray-400";break;case"pdf":r=oe,k.general="border-red-600/20 text-red-600/60",k.xMark="bg-red-600/60";break;case"docx":r=oe,k.general="border-blue-600/20 text-blue-600/60",k.xMark="bg-blue-600/60";break;default:T("Unsupported file type. Only PDF, DOCX, JPG, and PNG are allowed.","warning");return}y.value.push({name:s.name,icon:r,style:k,hover:!1,file:s}),v+=s.size})},P=g=>{y.value.splice(g,1)},b=g=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g),a=U(()=>b(I.email)),t=U(()=>a.value),n=async g=>{try{const v=await Pe(`dynamic-documents/${g}/download-pdf/`,"blob");if(!v||!v.data)throw new Error("Invalid response from server");return new File([v.data],`document_${g}.pdf`,{type:"application/pdf"})}catch(v){return console.error("Error downloading PDF:",v),T("No se pudo descargar el documento PDF.","error"),null}};X(()=>l.emailDocument,g=>{g&&Object.keys(g).length>0&&g.id&&n(g.id)},{immediate:!0});const x=async()=>{try{if(l.emailDocument.id){const v=await n(l.emailDocument.id);v&&y.value.push({name:v.name,file:v,icon:oe,style:{general:"border-blue-600/20 text-blue-600/60",xMark:"bg-blue-600/60"},hover:!1})}const g=y.value.map(v=>v.file);await i(dt,I.email,l.emailDocument.title,"Attached is the requested document along with additional attachments.",g,{documentId:l.emailDocument.id})}catch(g){console.error("Error sending the email:",g)}finally{L()}},L=()=>{h(),$("closeEmailModal")};return(g,v)=>(c(),w("div",He,[e("div",Qe,[e("button",{onClick:v[0]||(v[0]=s=>L())},[f(m(Z),{class:"size-6"})])]),e("form",{onSubmit:R(x,["prevent"])},[e("div",null,[Re,e("div",Ze,[F(e("input",{"onUpdate:modelValue":v[1]||(v[1]=s=>I.email=s),type:"text",name:"email",id:"email",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[ae,I.email]])])]),e("div",We,[Ge,e("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 bg-white px-6 py-10",onDragover:v[2]||(v[2]=R(()=>{},["prevent"])),onDrop:R(u,["prevent"])},[y.value.length<1?(c(),w("div",Xe,[f(m(Fe),{class:"mx-auto size-12 text-gray-300","aria-hidden":"true"}),e("div",Je,[e("label",Ke,[Ye,e("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",onChange:C},null,32)]),et]),tt])):(c(),w("div",st,[(c(!0),w(V,null,J(y.value,(s,_)=>(c(),w("div",{key:_,class:M(["relative p-4 grid rounded-md bg-white border-2",s.style.general]),onMouseenter:r=>s.hover=!0,onMouseleave:r=>s.hover=!1},[F(e("div",{class:M(["absolute p-0.5 mt-2 ml-2 rounded-full",s.style.xMark]),onClick:r=>P(_)},[f(m(Z),{class:"size-3 text-white"})],10,at),[[W,s.hover]]),(c(),N(ne(s.icon),{class:"size-12 mx-auto"})),e("span",nt,z(s.name),1)],42,ot))),128))]))],32)]),e("button",{type:"submit",class:M(["mt-4 p-2.5 text-sm font-medium rounded-md flex gap-2",t.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!t.value},it,10,rt)],32)]))}},mt={class:"bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full overflow-auto max-h-[80vh]"},pt={class:"flex justify-between items-center mb-4"},ht={class:"text-lg font-bold"},gt=["innerHTML"],Se={__name:"DocumentPreviewModal",props:{isVisible:Boolean,documentData:{type:Object,default:()=>({title:"",content:""})}},emits:["close"],setup(p,{emit:o}){const $=o,i=()=>{$("close")};return(d,l)=>F((c(),N(Y,null,{default:S(()=>[e("div",mt,[e("div",pt,[e("h2",ht," Previsualización del Documento: "+z(p.documentData.title),1),e("button",{onClick:i},[f(m(Z),{class:"size-6 text-gray-500 hover:text-gray-700"})])]),e("div",{class:"prose max-w-none",innerHTML:p.documentData.content},null,8,gt)])]),_:1},512)),[[W,p.isVisible]])}};function Ee(p){return Be.fire({title:p,icon:"question",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",buttonsStyling:!1}).then(o=>o.isConfirmed)}const ft={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},vt={class:"flex justify-end"},bt=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[ee(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),_t={class:"mt-2"},wt={class:"flex gap-2 mt-2.5"},yt=["disabled"],xt=e("span",null,"Actualizar nombre",-1),Dt=[xt],kt=["disabled"],$t={__name:"CreateDocumentByLawyer",emits:["close"],setup(p,{emit:o}){const $=he(),i=se(),d=o,l=E(""),h=E("");ge(()=>{var b;(b=i.selectedDocument)!=null&&b.title?(l.value=i.selectedDocument.title,h.value=i.selectedDocument.title):(l.value="",h.value="")});const I=b=>{b.key==="Escape"&&d("close")};te(()=>{document.addEventListener("keydown",I)}),fe(()=>{document.removeEventListener("keydown",I)});const y=U(()=>l.value.trim().length>0),C=U(()=>{var b;return!!((b=i.selectedDocument)!=null&&b.id)}),u=U(()=>C.value&&l.value.trim()!==h.value.trim()&&l.value.trim().length>0);async function D(){if(C.value&&u.value)try{const b={title:l.value.trim()};await i.updateDocument(i.selectedDocument.id,b),h.value=l.value.trim(),i.selectedDocument.title=l.value.trim(),i.lastUpdatedDocumentId=i.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",i.selectedDocument.id);const a=i.selectedDocument.id;d("close",{updatedDocId:a});const t=window.location.pathname;t==="/dynamic_document_dashboard"||t==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(a)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(b){console.error("Error updating document name:",b)}}const P=async()=>{if(!y.value)return;const b=encodeURIComponent(l.value.trim());C.value?(i.selectedDocument.title=l.value,i.selectedDocument.id&&(i.lastUpdatedDocumentId=i.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",i.selectedDocument.id.toString())),$.push(`/dynamic_document_dashboard/lawyer/editor/edit/${i.selectedDocument.id}`)):(i.selectedDocument={title:l.value.trim()},$.push(`/dynamic_document_dashboard/lawyer/editor/create/${b}`))};return(b,a)=>(c(),w("div",ft,[e("div",vt,[e("button",{onClick:a[0]||(a[0]=t=>d("close"))},[f(m(Z),{class:"size-6"})])]),e("form",{onSubmit:R(P,["prevent"])},[e("div",null,[bt,e("div",_t,[F(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>l.value=t),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[ae,l.value]])])]),e("div",wt,[C.value?(c(),w("button",{key:0,type:"button",onClick:D,disabled:!u.value,class:M(["p-2.5 text-sm font-medium rounded-md flex gap-2",u.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Dt,10,yt)):O("",!0),e("button",{type:"submit",class:M(["p-2.5 text-sm font-medium rounded-md flex gap-2",y.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!y.value},[e("span",null,z(C.value?"Editar Documento":"Continuar"),1)],10,kt)])],32)]))}},It=["data-document-id"],Ct={class:"flex justify-between items-center w-full"},St={class:"grid gap-1"},Et={class:"text-base font-medium"},Mt={class:"text-sm font-regular text-gray-400"},Ut=["disabled","onClick"],Lt={__name:"DocumentListLawyer",props:{searchQuery:String,promptDocuments:{type:Array,default:null}},setup(p){const o=se(),$=ve(),i=E(!1);E(null);const d=p,l=U(()=>d.promptDocuments?d.promptDocuments:o.getDocumentsByLawyerId($.currentUser.id).filter(t=>t.title.toLowerCase().includes(d.searchQuery.toLowerCase()))),h=U(()=>{if(d.promptDocuments)return null;const a=o.lastUpdatedDocumentId,t=localStorage.getItem("lastUpdatedDocumentId");return a&&l.value.some(x=>String(x.id)===String(a))?a:t&&l.value.some(L=>String(L.id)===String(t))?t:null}),I=a=>{const t=[{label:"Editar",action:"edit"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"}];return a.state==="Draft"?t.push({label:"Publicar",action:"publish",disabled:!y(a)}):a.state==="Published"&&t.push({label:"Mover a Borrador",action:"draft",disabled:!1}),t},y=a=>a.variables.every(t=>t.value&&t.value.trim().length>0),C=async(a,t)=>{switch(a){case"edit":o.selectedDocument=t,i.value=!0;break;case"delete":await Ee(`¿Deseas eliminar el documento '${t.title}'?`)&&(await o.deleteDocument(t.id),await T("Documento eliminado correctamente.","success"));break;case"publish":await u(t);break;case"draft":await D(t);break;case"preview":De(t);break;default:console.warn(`Acción desconocida: ${a}`)}},u=async a=>{const t={...a,state:"Published"};await o.updateDocument(a.id,t),o.lastUpdatedDocumentId=a.id,localStorage.setItem("lastUpdatedDocumentId",a.id),b(a.id);const n=window.location.pathname;n==="/dynamic_document_dashboard"||n==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},800)},D=async a=>{const t={...a,state:"Draft"};await o.updateDocument(a.id,t),o.lastUpdatedDocumentId=a.id,localStorage.setItem("lastUpdatedDocumentId",a.id),b(a.id);const n=window.location.pathname;n==="/dynamic_document_dashboard"||n==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},800)},P=a=>{if(i.value=!1,o.selectedDocument=null,a&&a.updatedDocId){o.lastUpdatedDocumentId=a.updatedDocId,localStorage.setItem("lastUpdatedDocumentId",a.updatedDocId),b(a.updatedDocId);const t=window.location.pathname;t==="/dynamic_document_dashboard"||t==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},800)}};X(l,a=>{if(!d.promptDocuments&&o.lastUpdatedDocumentId&&!a.some(n=>String(n.id)===String(o.lastUpdatedDocumentId))&&a.length>0){const x=[...a].sort((L,g)=>g.id-L.id)[0].id;o.lastUpdatedDocumentId=x,localStorage.setItem("lastUpdatedDocumentId",x)}});const b=a=>{a&&setTimeout(()=>{try{const t=document.querySelectorAll(`[data-document-id="${a}"]`);if(t.length>0){const n=t[0];n.style.border="2px solid #3b82f6",n.classList.remove("animate-pulse-highlight"),n.offsetWidth,n.classList.add("animate-pulse-highlight"),n.scrollIntoView({behavior:"smooth",block:"center"})}}catch(t){console.error("Error forcing highlight:",t)}},100)};return window.forceDocumentHighlight=b,te(async()=>{if(d.promptDocuments)return;await o.init();const a=localStorage.getItem("lastUpdatedDocumentId");a&&(o.lastUpdatedDocumentId=a,setTimeout(()=>{l.value.some(n=>String(n.id)===String(a))&&b(a)},500))}),(a,t)=>(c(),w(V,null,[(c(!0),w(V,null,J(l.value,n=>(c(),w("div",{key:n.id,"data-document-id":n.id,class:M(["flex items-center gap-2 py-2 px-4 border rounded-lg cursor-pointer transition",n.state==="Published"?"border-green-400 bg-green-300/30 hover:bg-green-300/50":"border-stroke bg-white hover:bg-gray-100",h.value&&String(h.value)===String(n.id)?"animate-pulse-highlight":""]),style:Te(h.value&&String(h.value)===String(n.id)?"border: 1px solid #CCE0FF !important;":"")},[(c(),N(ne(n.state==="Published"?m($e):m(Ce)),{class:M(n.state==="Published"?"size-8 text-green-500":"size-8 text-secondary")},null,8,["class"])),e("div",Ct,[e("div",St,[e("span",Et,z(n.title),1),e("span",Mt,z(n.state==="Published"?"Publicado":"Borrador"),1)]),f(m(ye),{as:"div",class:"relative inline-block text-left"},{default:S(()=>[f(m(be),{class:"flex items-center text-gray-400"},{default:S(()=>[f(m(Ie),{class:"size-6","aria-hidden":"true"})]),_:1}),f(_e,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:S(()=>[f(m(we),{class:M(["absolute z-20 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5",[d.promptDocuments?"right-auto left-0 -translate-x-[calc(100%-24px)]":"right-0 left-auto"]])},{default:S(()=>[(c(!0),w(V,null,J(I(n),x=>(c(),N(m(j),{key:x.label},{default:S(()=>[e("button",{class:M(["w-full text-left px-4 py-2 text-sm font-regular transition flex items-center gap-2",{"opacity-50 cursor-not-allowed":x.disabled,"cursor-pointer":!x.disabled}]),disabled:x.disabled,onClick:L=>!x.disabled&&C(x.action,n)},[x.disabled?(c(),N(m(qe),{key:0,class:"size-5 text-gray-400","aria-hidden":"true"})):O("",!0),ee(" "+z(x.label),1)],10,Ut)]),_:2},1024))),128))]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024)])],14,It))),128)),F(f(Y,null,{default:S(()=>[f($t,{onClose:P})]),_:1},512),[[W,i.value]]),f(Se,{isVisible:m(K),documentData:m(xe),onClose:t[0]||(t[0]=n=>K.value=!1)},null,8,["isVisible","documentData"])],64))}},gs=ke(Lt,[["__scopeId","data-v-e18a8679"]]),Pt={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Bt={class:"flex justify-end"},Tt=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[ee(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),zt={class:"mt-2"},At={class:"flex gap-2 mt-2.5"},Ft=["disabled"],jt=e("span",null,"Actualizar nombre",-1),Vt=[jt],Nt=["disabled"],qt={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(p,{emit:o}){const $=p,i=he(),d=se(),l=o,h=E(""),I=E(""),y=()=>{l("close")};ge(()=>{var t,n;d.selectedDocument?(h.value=((t=d.selectedDocument)==null?void 0:t.title)||"",I.value=((n=d.selectedDocument)==null?void 0:n.title)||""):(h.value="",I.value="")});const C=t=>{t.key==="Escape"&&y()};te(()=>{document.addEventListener("keydown",C)}),fe(()=>{document.removeEventListener("keydown",C)});const u=U(()=>h.value.trim().length>0),D=U(()=>{var t;return!!((t=d.selectedDocument)!=null&&t.id)}),P=U(()=>D.value&&h.value.trim()!==I.value.trim()&&h.value.trim().length>0);async function b(){if(D.value&&P.value)try{const t={title:h.value.trim()};await d.updateDocument(d.selectedDocument.id,t),I.value=h.value.trim(),d.selectedDocument.title=h.value.trim();const n=d.selectedDocument.id;T("Document name successfully updated.","success"),l("close",{updatedDocId:n});const L=window.location.pathname;L==="/dynamic_document_dashboard"||L==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(t){console.error("Error updating document name:",t),T("Error updating document name.","error")}}function a(){const t=encodeURIComponent(h.value.trim());$.documentId&&!d.selectedDocument?i.push(`/dynamic_document_dashboard/document/use/creator/${$.documentId}/${t}`):d.selectedDocument?(d.selectedDocument.title=h.value.trim(),i.push(`/dynamic_document_dashboard/document/use/editor/${d.selectedDocument.id}/${t}`)):T("Error: No se pudo continuar. Documento no seleccionado.","error")}return(t,n)=>(c(),w("div",Pt,[e("div",Bt,[e("button",{onClick:y},[f(m(Z),{class:"size-6"})])]),e("form",{onSubmit:R(a,["prevent"])},[e("div",null,[Tt,e("div",zt,[F(e("input",{"onUpdate:modelValue":n[0]||(n[0]=x=>h.value=x),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[ae,h.value]])])]),e("div",At,[D.value?(c(),w("button",{key:0,type:"button",onClick:b,disabled:!P.value,class:M(["p-2.5 text-sm font-medium rounded-md flex gap-2",P.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Vt,10,Ft)):O("",!0),e("button",{type:"submit",class:M(["p-2.5 text-sm font-medium rounded-md flex gap-2",u.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!u.value},[e("span",null,z(D.value?"Editar Documento":"Continuar"),1)],10,Nt)])],32)]))}},Me=p=>(ze("data-v-008ec5f5"),p=p(),Ae(),p),Ot=["data-document-id"],Ht={class:"flex justify-between items-center w-full"},Qt={class:"grid gap-1"},Rt={class:"text-base font-medium"},Zt={class:"text-sm font-regular text-gray-400"},Wt={class:"py-1"},Gt=["onClick"],Xt=["onClick"],Jt=["onClick"],Kt=["onClick"],Yt=["onClick"],es=["onClick"],ts={key:0,class:"mt-6 flex flex-col items-center justify-center text-center text-gray-500 w-full"},ss=Me(()=>e("p",{class:"text-lg font-semibold"}," No hay documentos disponibles para mostrar. ",-1)),os=Me(()=>e("p",{class:"text-sm"}," Contacta a tu abogado para gestionar tus documentos. ",-1)),as=[ss,os],ns={__name:"DocumentListClient",props:{searchQuery:String,promptDocuments:{type:Array,default:null}},setup(p){const o=se(),$=ve(),{registerView:i}=Ne(),d=U(()=>$.getCurrentUser),l=E(!1),h=E(null),I=E(!1),y=E({}),C=U(()=>{if(u.promptDocuments)return null;const s=o.lastUpdatedDocumentId,_=localStorage.getItem("lastUpdatedDocumentId");return s&&D.value.some(k=>String(k.id)===String(s))?s:_&&D.value.some(q=>String(q.id)===String(_))?_:null}),u=p;te(async()=>{if(u.promptDocuments)return;await o.init();const s=localStorage.getItem("lastUpdatedDocumentId");s&&!o.lastUpdatedDocumentId&&(o.lastUpdatedDocumentId=s),o.lastUpdatedDocumentId&&D.value.some(_=>String(_.id)===String(o.lastUpdatedDocumentId))}),X(()=>o.lastUpdatedDocumentId,s=>{u.promptDocuments||s&&localStorage.setItem("lastUpdatedDocumentId",s)});const D=U(()=>{var k,q;if(u.promptDocuments){const H=(k=d.value)==null?void 0:k.id;let Q=u.promptDocuments.filter(B=>{const A=B.assigned_to?String(B.assigned_to):null,G=String(H);return A===G&&(B.state==="Progress"||B.state==="Completed")});if(u.searchQuery){const B=u.searchQuery.toLowerCase();Q=Q.filter(A=>{var G,re,le,ie,de,ce,ue,me;return A.title.toLowerCase().includes(B)||A.state.toLowerCase().includes(B)||A.assigned_to&&$&&(((re=(G=$.userById(A.assigned_to))==null?void 0:G.first_name)==null?void 0:re.toLowerCase().includes(B))||((ie=(le=$.userById(A.assigned_to))==null?void 0:le.last_name)==null?void 0:ie.toLowerCase().includes(B))||((ce=(de=$.userById(A.assigned_to))==null?void 0:de.email)==null?void 0:ce.toLowerCase().includes(B))||((me=(ue=$.userById(A.assigned_to))==null?void 0:ue.identification)==null?void 0:me.toLowerCase().includes(B)))})}return Q}const s=o.progressAndCompletedDocumentsByClient((q=d.value)==null?void 0:q.id);return o.filteredDocuments(u.searchQuery,$).filter(H=>s.some(Q=>String(Q.id)===String(H.id)))}),P=s=>{o.downloadPDF(s.id,s.title)},b=s=>{o.downloadWord(s.id,s.title)},a=async s=>{await Ee(`¿Deseas eliminar el documento "${s.title}"?`)&&(await o.deleteDocument(s.id),await T("Documento eliminado exitosamente.","success"))},t=s=>{o.selectedDocument=s,h.value=s.id,l.value=!0},n=s=>{l.value=!1,s&&s.updatedDocId&&g(s.updatedDocId),o.clearSelectedDocument()},x=s=>{y.value=s,I.value=!0},L=()=>{y.value={},I.value=!1};X(D,s=>{if(!u.promptDocuments&&o.lastUpdatedDocumentId&&!s.some(r=>String(r.id)===String(o.lastUpdatedDocumentId))&&s.length>0){const k=[...s].sort((q,H)=>H.id-q.id)[0].id;o.lastUpdatedDocumentId=k,localStorage.setItem("lastUpdatedDocumentId",k)}});const g=s=>{s&&(o.lastUpdatedDocumentId=s,localStorage.setItem("lastUpdatedDocumentId",s),setTimeout(()=>{try{const _=document.querySelectorAll(`[data-document-id="${s}"]`);if(_.length>0){const r=_[0];r.style.border="3px solid #3b82f6",r.classList.remove("animate-pulse-highlight"),r.classList.remove("border-secondary"),r.classList.remove("shadow-md"),r.offsetWidth,r.classList.add("animate-pulse-highlight"),r.classList.add("border-secondary"),r.classList.add("shadow-md"),r.scrollIntoView({behavior:"smooth",block:"center"})}}catch(_){console.error("Error forcing highlight:",_)}},100))};window.forceDocumentHighlight=g;const v=async s=>{await i("document",s.id),De(s)};return(s,_)=>(c(),w(V,null,[(c(!0),w(V,null,J(D.value,r=>(c(),w("div",{key:r.id,"data-document-id":r.id,class:M(["flex items-center gap-3 py-2 px-4 border rounded-xl cursor-pointer",{"border-green-400 bg-green-300/30":r.state==="Completed","border-stroke bg-white":r.state==="Progress","border-secondary shadow-md animate-pulse-highlight":String(r.id)===String(C.value)}])},[(c(),N(ne(r.state==="Completed"?m($e):m(Ce)),{class:M(["size-6",{"text-green-500":r.state==="Completed","text-secondary":r.state==="Progress"}])},null,8,["class"])),e("div",Ht,[e("div",Qt,[e("span",Rt,z(r.title),1),e("span",Zt,z(r.description),1)]),f(m(ye),{as:"div",class:"relative inline-block text-left"},{default:S(()=>[f(m(be),{class:"flex items-center text-gray-400"},{default:S(()=>[f(m(Ie),{class:"size-6","aria-hidden":"true"})]),_:1}),f(_e,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:S(()=>[f(m(we),{class:M(["absolute z-10 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",[u.promptDocuments?"right-auto left-0 -translate-x-[calc(100%-24px)]":"right-0 left-auto"]])},{default:S(()=>[e("div",Wt,[f(m(j),null,{default:S(()=>[e("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:k=>t(r)},z(r.state==="Completed"?"Editar":"Completar"),9,Gt)]),_:2},1024),r.state==="Completed"?(c(),N(m(j),{key:0},{default:S(()=>[e("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:k=>v(r)}," Previsualizar ",8,Xt)]),_:2},1024)):O("",!0),f(m(j),null,{default:S(()=>[e("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:k=>a(r)}," Eliminar ",8,Jt)]),_:2},1024),r.state==="Completed"?(c(),w(V,{key:1},[f(m(j),null,{default:S(()=>[e("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:k=>P(r)}," Descargar PDF ",8,Kt)]),_:2},1024),f(m(j),null,{default:S(()=>[e("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:k=>b(r)}," Descargar Word ",8,Yt)]),_:2},1024),f(m(j),null,{default:S(()=>[e("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:k=>x(r)}," Enviar ",8,es)]),_:2},1024)],64)):O("",!0)])]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024)]),D.value.length===0?(c(),w("div",ts,as)):O("",!0),F(f(Y,null,{default:S(()=>[f(qt,{"document-id":h.value,onClose:n},null,8,["document-id"])]),_:1},512),[[W,l.value]])],10,Ot))),128)),f(Se,{isVisible:m(K),documentData:m(xe),onClose:_[0]||(_[0]=r=>K.value=!1)},null,8,["isVisible","documentData"]),F(f(Y,null,{default:S(()=>[f(ut,{onCloseEmailModal:_[1]||(_[1]=r=>L()),emailDocument:y.value},null,8,["emailDocument"])]),_:1},512),[[W,I.value]])],64))}},fs=ke(ns,[["__scopeId","data-v-008ec5f5"]]);export{gs as D,Se as _,Ce as a,ms as b,ps as c,fs as d,ut as e,qt as f,$e as g,Ie as h,$t as i,hs as r};
