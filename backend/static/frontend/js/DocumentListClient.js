import{e as i,f as p,g as s,r as L,s as T,Y as Pe,b as Oe,c as F,P as oe,j as u,l as c,A as ee,w as Z,v as we,h as Y,F as G,H as J,n as P,M as re,I as R,a4 as ne,t as j,m as te,X as ie,u as xe,aG as Fe,o as ce,an as ze,i as H,L as Be,aW as Ue,k as C,ab as pe,ac as fe,ad as he,ae as X,aa as ve,a0 as le,aU as Qe,J as Te,K as Ae}from"./index.js";import{u as ue,s as de,p as je,o as Ne}from"./dynamicDocument.js";import{r as _e,_ as Ve,D as qe,s as ae}from"./DocumentSignaturesModal.js";import{_ as Re}from"./_plugin-vue_export-helper.js";import{s as Ge,h as Me,r as ge}from"./loading_message.js";import{r as We,a as Xe}from"./PhotoIcon.js";import{useRecentViews as Ze}from"./useRecentViews.js";function be(k,o){return i(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function Os(k,o){return i(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})])}function Qs(k,o){return i(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"})])}function Le(k,o){return i(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"})])}function ye(k,o){return i(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})])}function Gs(k,o){return i(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})])}function Je(){const k=L(!1),o=L("");async function w(_,x,f="",h="",E=[],$={}){if(!x)throw o.value="Recipient email is required.",await T(o.value,"error"),new Error(o.value);const S=new FormData;S.append("to_email",x),S.append("subject",f),S.append("body",h),E.forEach((l,M)=>{S.append(`attachments[${M}]`,l)});for(const[l,M]of Object.entries($))S.append(l,M);try{k.value=!0,o.value="",Ge("Sending email...","Please wait while we send the email.");const l=await Pe(_,S);return Me(),await T("Email sent successfully.","success"),l.data}catch(l){throw Me(),console.error("Error sending email:",l.message),o.value="An error occurred while sending the email. Please try again.",await T(o.value,"error"),l}finally{k.value=!1}}return{sendEmail:w,isLoading:k,errorMessage:o}}const Ke={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Ye={class:"flex justify-end"},et=s("label",{for:"email",class:"block text-base font-medium leading-6 text-primary"},[te(" Correo electrónico "),s("span",{class:"text-red-500"},"*")],-1),tt={class:"mt-2"},st={class:"mt-4"},at=s("label",{for:"files",class:"block text-base font-medium leading-6 text-primary"}," Anexos ",-1),ot={key:0,class:"text-center"},rt={class:"mt-4 flex text-sm/6 text-gray-600"},nt={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"},it=s("span",null,"Sube un archivo",-1),lt=s("p",{class:"pl-1"},"o arrastra y suelta",-1),dt=s("p",{class:"text-xs/5 text-gray-600"}," PNG, JPG, PDF, DOCX de hasta 20MB ",-1),ct={key:1,class:"w-full flex flex-wrap gap-3"},ut=["onMouseenter","onMouseleave"],mt=["onClick"],gt={class:"text-center text-xs truncate w-20"},pt=["disabled"],ft=s("span",null,"Enviar",-1),ht=[ft],vt="dynamic-documents/send_email_with_attachments/",_t=20*1024*1024,bt={__name:"SendDocument",props:{emailDocument:{type:Object,required:!0}},emits:["closeEmailModal"],setup(k,{emit:o}){const w=o,{sendEmail:_}=Je(),x=L(null),f=k,h=()=>{E.email="",$.value=[],x.value=null},E=Oe({email:""}),$=L([]),S=v=>{const b=Array.from(v.target.files);M(b),v.target.value=null},l=v=>{const b=Array.from(v.dataTransfer.files);M(b)},M=v=>{let b=$.value.reduce((I,q)=>I+q.file.size,0);v.forEach(I=>{if(I.size>_t){T(`The file "${I.name}" exceeds the 20 MB limit.`,"warning");return}const q=I.name.split(".").pop().toLowerCase();let A="",V={general:"",xMark:""};switch(q){case"png":case"jpg":case"jpeg":A=Xe,V.general="border-gray-200 text-gray-400",V.xMark="bg-gray-400";break;case"pdf":A=ge,V.general="border-red-600/20 text-red-600/60",V.xMark="bg-red-600/60";break;case"docx":A=ge,V.general="border-blue-600/20 text-blue-600/60",V.xMark="bg-blue-600/60";break;default:T("Unsupported file type. Only PDF, DOCX, JPG, and PNG are allowed.","warning");return}$.value.push({name:I.name,icon:A,style:V,hover:!1,file:I}),b+=I.size})},N=v=>{$.value.splice(v,1)},g=v=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v),U=F(()=>g(E.email)),m=F(()=>U.value),z=async v=>{try{const b=await ie(`dynamic-documents/${v}/download-pdf/`,"blob");if(!b||!b.data)throw new Error("Invalid response from server");return new File([b.data],`document_${v}.pdf`,{type:"application/pdf"})}catch(b){return console.error("Error downloading PDF:",b),T("No se pudo descargar el documento PDF.","error"),null}};oe(()=>f.emailDocument,v=>{v&&Object.keys(v).length>0&&v.id&&z(v.id)},{immediate:!0});const O=async()=>{try{if(f.emailDocument.id){const b=await z(f.emailDocument.id);b&&$.value.push({name:b.name,file:b,icon:ge,style:{general:"border-blue-600/20 text-blue-600/60",xMark:"bg-blue-600/60"},hover:!1})}const v=$.value.map(b=>b.file);await _(vt,E.email,f.emailDocument.title,"Attached is the requested document along with additional attachments.",v,{documentId:f.emailDocument.id})}catch(v){console.error("Error sending the email:",v)}finally{Q()}},Q=()=>{h(),w("closeEmailModal")};return(v,b)=>(i(),p("div",Ke,[s("div",Ye,[s("button",{onClick:b[0]||(b[0]=I=>Q())},[u(c(ee),{class:"size-6"})])]),s("form",{onSubmit:Y(O,["prevent"])},[s("div",null,[et,s("div",tt,[Z(s("input",{"onUpdate:modelValue":b[1]||(b[1]=I=>E.email=I),type:"text",name:"email",id:"email",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[we,E.email]])])]),s("div",st,[at,s("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 bg-white px-6 py-10",onDragover:b[2]||(b[2]=Y(()=>{},["prevent"])),onDrop:Y(l,["prevent"])},[$.value.length<1?(i(),p("div",ot,[u(c(We),{class:"mx-auto size-12 text-gray-300","aria-hidden":"true"}),s("div",rt,[s("label",nt,[it,s("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",onChange:S},null,32)]),lt]),dt])):(i(),p("div",ct,[(i(!0),p(G,null,J($.value,(I,q)=>(i(),p("div",{key:q,class:P(["relative p-4 grid rounded-md bg-white border-2",I.style.general]),onMouseenter:A=>I.hover=!0,onMouseleave:A=>I.hover=!1},[Z(s("div",{class:P(["absolute p-0.5 mt-2 ml-2 rounded-full",I.style.xMark]),onClick:A=>N(q)},[u(c(ee),{class:"size-3 text-white"})],10,mt),[[re,I.hover]]),(i(),R(ne(I.icon),{class:"size-12 mx-auto"})),s("span",gt,j(I.name),1)],42,ut))),128))]))],32)]),s("button",{type:"submit",class:P(["mt-4 p-2.5 text-sm font-medium rounded-md flex gap-2",m.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!m.value},ht,10,pt)],32)]))}},yt={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},wt={class:"flex justify-end"},xt=s("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[te(" Nombre "),s("span",{class:"text-red-500"},"*")],-1),Dt={class:"mt-2"},kt={class:"flex gap-2 mt-2.5"},St=["disabled"],$t=s("span",null,"Actualizar nombre",-1),It=[$t],Ct=["disabled"],Et={__name:"CreateDocumentByLawyer",emits:["close"],setup(k,{emit:o}){const w=xe(),_=ue(),x=o,f=L(""),h=L("");Fe(()=>{var g;(g=_.selectedDocument)!=null&&g.title?(f.value=_.selectedDocument.title,h.value=_.selectedDocument.title):(f.value="",h.value="")});const E=g=>{g.key==="Escape"&&x("close")};ce(()=>{document.addEventListener("keydown",E)}),ze(()=>{document.removeEventListener("keydown",E)});const $=F(()=>f.value.trim().length>0),S=F(()=>{var g;return!!((g=_.selectedDocument)!=null&&g.id)}),l=F(()=>S.value&&f.value.trim()!==h.value.trim()&&f.value.trim().length>0);async function M(){if(S.value&&l.value)try{const g={title:f.value.trim()};await _.updateDocument(_.selectedDocument.id,g),h.value=f.value.trim(),_.selectedDocument.title=f.value.trim(),_.lastUpdatedDocumentId=_.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",_.selectedDocument.id);const U=_.selectedDocument.id;x("close",{updatedDocId:U});const m=window.location.pathname;m==="/dynamic_document_dashboard"||m==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(U)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(g){console.error("Error updating document name:",g)}}const N=async()=>{if(!$.value)return;const g=encodeURIComponent(f.value.trim());S.value?(_.selectedDocument.title=f.value,_.selectedDocument.id&&(_.lastUpdatedDocumentId=_.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",_.selectedDocument.id.toString())),w.push(`/dynamic_document_dashboard/lawyer/editor/edit/${_.selectedDocument.id}`)):(_.selectedDocument={title:f.value.trim()},w.push(`/dynamic_document_dashboard/lawyer/editor/create/${g}`))};return(g,U)=>(i(),p("div",yt,[s("div",wt,[s("button",{onClick:U[0]||(U[0]=m=>x("close"))},[u(c(ee),{class:"size-6"})])]),s("form",{onSubmit:Y(N,["prevent"])},[s("div",null,[xt,s("div",Dt,[Z(s("input",{"onUpdate:modelValue":U[1]||(U[1]=m=>f.value=m),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[we,f.value]])])]),s("div",kt,[S.value?(i(),p("button",{key:0,type:"button",onClick:M,disabled:!l.value,class:P(["p-2.5 text-sm font-medium rounded-md flex gap-2",l.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},It,10,St)):H("",!0),s("button",{type:"submit",class:P(["p-2.5 text-sm font-medium rounded-md flex gap-2",$.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!$.value},[s("span",null,j(S.value?"Editar Documento":"Continuar"),1)],10,Ct)])],32)]))}},K=k=>(Te("data-v-d009b0dc"),k=k(),Ae(),k),Ut=["data-document-id"],Mt={class:"flex-1 flex justify-between items-center"},Lt={class:"grid gap-1"},Pt={class:"flex items-center"},Ft={class:"text-base font-medium"},zt={key:0,class:"relative group ml-2"},Bt={key:0,class:"h-4 w-4 text-green-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Tt=K(()=>s("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1)),At=K(()=>s("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)),jt=[Tt,At],Nt={key:1,class:"h-4 w-4 text-blue-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Vt=K(()=>s("path",{d:"M20 6L9 17l-5-5"},null,-1)),qt=[Vt],Rt={key:2,class:"h-4 w-4 text-yellow-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ht=K(()=>s("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),Ot=[Ht],Qt={key:3,class:"h-4 w-4 text-blue-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Gt=K(()=>s("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),Wt=[Gt],Xt={class:"absolute z-10 w-48 px-2 py-1 text-xs bg-gray-800 text-white rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 delay-150 -top-8 left-0 pointer-events-none tooltip-with-arrow"},Zt={class:"text-sm font-regular text-gray-400"},Jt=["disabled","onClick"],Kt={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4"},Yt=["data-document-id"],es={class:"flex-1 flex justify-between items-center"},ts={class:"grid gap-1"},ss={class:"flex items-center"},as={class:"text-base font-medium"},os={class:"text-sm font-regular text-gray-400"},rs=["disabled","onClick"],ns={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-auto"},is={class:"flex justify-between items-center mb-4"},ls=K(()=>s("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1)),ds={__name:"DocumentListLawyer",props:{searchQuery:String,promptDocuments:{type:Array,default:null}},setup(k){const o=ue(),w=Be(),_=xe(),x=L(!1),f=L(!1),h=L(null),E=L([]),$=L([]),S=L(!1),l=k,M=F(()=>l.promptDocuments?[]:(o.getDocumentsByLawyerId(w.currentUser.id)||[]).filter(a=>a.state!=="FullySigned").filter(a=>a.title&&a.title.toLowerCase().includes(l.searchQuery.toLowerCase()))),N=F(()=>{if(l.promptDocuments)return[];const e=o.getDocumentsByLawyerId(w.currentUser.id)||[],a=$.value||[],t=new Map;return e.filter(n=>n.state==="FullySigned").forEach(n=>t.set(n.id,n)),a.filter(n=>n.state==="FullySigned").forEach(n=>t.set(n.id,n)),Array.from(t.values()).filter(n=>n.title&&n.title.toLowerCase().includes(l.searchQuery.toLowerCase()))}),g=F(()=>l.promptDocuments&&l.promptDocuments.length>0?(l.promptDocuments||[]).filter(e=>e.title&&e.title.toLowerCase().includes(l.searchQuery.toLowerCase())):[]);F(()=>l.promptDocuments?g.value.length===0:M.value.length===0&&N.value.length===0);const U=F(()=>l.promptDocuments?g.value:M.value),m=F(()=>{if(l.promptDocuments)return null;const e=o.lastUpdatedDocumentId,a=localStorage.getItem("lastUpdatedDocumentId"),t=[...M.value,...N.value];return e&&t.some(B=>String(B.id)===String(e))?e:a&&t.some(B=>String(B.id)===String(a))?a:null}),z=async()=>{try{const e=w.currentUser.id,a=await ie(`dynamic-documents/user/${e}/pending-documents-full/`),t=await ie(`dynamic-documents/user/${e}/signed-documents/`);a.status===200&&(E.value=a.data),t.status===200&&($.value=t.data)}catch(e){console.error("Error fetching lawyer documents:",e),e.response&&(console.error("Error response data:",e.response.data),console.error("Error status:",e.response.status))}},O=e=>{const a=[{label:"Editar",action:"edit"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"}];if(e.requires_signature&&e.signatures&&e.signatures.length>0){const n=String(w.currentUser.id);e.signatures.find(y=>String(y.signer_id)===n&&!y.signed)}return e.state==="Draft"?a.push({label:"Publicar",action:"publish",disabled:!Q(e)}):e.state==="Published"&&(a.push({label:"Mover a Borrador",action:"draft",disabled:!1}),a.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:!1}),a.push({label:"Mover a Borrador",action:"draft",disabled:!1})),E.value.some(n=>n.id===e.id)&&a.push({label:"Firmar documento",action:"sign_document",disabled:!1}),a},Q=e=>e.variables.every(a=>a.value&&a.value.trim().length>0),v=e=>{if(!e.signatures||!e.requires_signature)return null;const a=String(w.currentUser.id);return e.signatures.find(t=>String(t.signer_id)===a)},b=e=>{if(!e.requires_signature)return"";if(e.fully_signed)return"Documento formalizado";const a=v(e);if(e.signatures&&e.signatures.length>0){const t=e.signatures.length,n=e.signatures.filter(y=>y.signed).length;if(a&&a.signed){if(n===1&&t>1)return`Has firmado. Faltan ${t-n} firmas más`;if(n<t)return`Has firmado. Faltan ${t-n} firmas más`}return`Firmas: ${n}/${t}`}return a?"Requiere tu firma":"Requiere firmas"},I=async(e,a)=>{switch(e){case"edit":o.selectedDocument=a,x.value=!0;break;case"delete":await ae(`¿Deseas eliminar el documento '${a.title}'?`)&&(await o.deleteDocument(a.id),await T("Documento eliminado correctamente.","success"));break;case"publish":await q(a);break;case"draft":await A(a);break;case"preview":Ne(a);break;case"sign_document":me(a);break;case"formalize":d(a);break;default:console.warn(`Acción desconocida: ${e}`)}},q=async e=>{const a={...e,state:"Published"};await o.updateDocument(e.id,a),o.lastUpdatedDocumentId=e.id,localStorage.setItem("lastUpdatedDocumentId",e.id),W(e.id);const t=window.location.pathname;t==="/dynamic_document_dashboard"||t==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},800)},A=async e=>{const a={...e,state:"Draft"};await o.updateDocument(e.id,a),o.lastUpdatedDocumentId=e.id,localStorage.setItem("lastUpdatedDocumentId",e.id),W(e.id);const t=window.location.pathname;t==="/dynamic_document_dashboard"||t==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},800)},V=e=>{if(x.value=!1,o.selectedDocument=null,e&&e.updatedDocId){o.lastUpdatedDocumentId=e.updatedDocId,localStorage.setItem("lastUpdatedDocumentId",e.updatedDocId),W(e.updatedDocId);const a=window.location.pathname;a==="/dynamic_document_dashboard"||a==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},800)}};oe(U,e=>{if(!l.promptDocuments&&o.lastUpdatedDocumentId&&!e.some(t=>String(t.id)===String(o.lastUpdatedDocumentId))&&e.length>0){const n=[...e].sort((y,B)=>B.id-y.id)[0].id;o.lastUpdatedDocumentId=n,localStorage.setItem("lastUpdatedDocumentId",n)}});const W=e=>{e&&setTimeout(()=>{try{const a=document.querySelectorAll(`[data-document-id="${e}"]`);if(a.length>0){const t=a[0];t.style.border="2px solid #3b82f6",t.classList.remove("animate-pulse-highlight"),t.offsetWidth,t.classList.add("animate-pulse-highlight"),t.scrollIntoView({behavior:"smooth",block:"center"})}}catch(a){console.error("Error forcing highlight:",a)}},100)};window.forceDocumentHighlight=W,ce(async()=>{if(l.promptDocuments)return;await o.init();const e=localStorage.getItem("lastUpdatedDocumentId");e&&(o.lastUpdatedDocumentId=e,setTimeout(()=>{U.value.some(t=>String(t.id)===String(e))&&W(e)},500)),z()});const me=async e=>{try{if(!w.currentUser.has_signature){await ae("No tienes una firma registrada. ¿Deseas crear una firma ahora?","Necesitas una firma","Crear firma","Cancelar")&&(S.value=!0);return}if(!await ae(`¿Estás seguro de que deseas firmar el documento "${e.title}"?`,"Confirmar firma","Firmar","Cancelar"))return;const t=await Pe(`dynamic-documents/${e.id}/sign/${w.currentUser.id}/`,{});if(t.status!==200&&t.status!==201)throw new Error(`Error al firmar: ${t.statusText}`);await T("Documento firmado correctamente","success"),await new Promise(n=>setTimeout(n,1e3)),await z(),o.lastUpdatedDocumentId=e.id,localStorage.setItem("lastUpdatedDocumentId",e.id),W(e.id),setTimeout(()=>{window.location.reload()},1500)}catch(a){console.error("Error signing document:",a),a.response&&(console.error("Error response data:",a.response.data),console.error("Error status:",a.response.status)),await T(`Error signing document: ${a.message}`,"error")}},r=()=>{f.value=!1},D=async()=>{await o.init()},d=async e=>{try{_.push({path:`/dynamic_document_dashboard/document/use/formalize/${e.id}/${e.title}`})}catch(a){console.error("Error al formalizar el documento:",a),await T("Error al formalizar el documento","error")}};return(e,a)=>(i(),p(G,null,[l.promptDocuments&&g.value.length>0?(i(!0),p(G,{key:0},J(g.value,t=>{var n;return i(),p("div",{key:t.id,"data-document-id":t.id,class:P(["flex items-center gap-3 py-2 px-4 border rounded-xl cursor-pointer mb-3",t.state==="Published"||t.state==="FullySigned"?"border-green-400 bg-green-300/30 hover:bg-green-300/50":"border-stroke bg-white hover:bg-gray-100",m.value&&String(m.value)===String(t.id)?"animate-pulse-highlight":""]),style:Ue(m.value&&String(m.value)===String(t.id)?"border: 1px solid #CCE0FF !important;":"")},[(i(),R(ne(t.state==="Published"||t.state==="FullySigned"?c(be):c(ye)),{class:P(t.state==="Published"||t.state==="FullySigned"?"size-8 text-green-500":"size-8 text-secondary")},null,8,["class"])),s("div",Mt,[s("div",Lt,[s("div",Pt,[s("span",Ft,j(t.title),1),t.requires_signature?(i(),p("div",zt,[t.fully_signed?(i(),p("svg",Bt,jt)):(n=v(t))!=null&&n.signed?(i(),p("svg",Nt,qt)):v(t)?(i(),p("svg",Rt,Ot)):(i(),p("svg",Qt,Wt)),s("div",Xt,j(t.fully_signed?"Documento formalizado":b(t)),1)])):H("",!0)]),s("span",Zt,j(t.state==="Published"?"Publicado":t.state==="Draft"?"Borrador":t.state==="Progress"?"En progreso":t.state==="Completed"?"Completado":t.state==="PendingSignatures"?"Pendiente de firmas":t.state==="FullySigned"?"Completamente firmado":"Desconocido"),1)]),u(c(ve),{as:"div",class:"relative inline-block text-left"},{default:C(()=>[u(c(pe),{class:"flex items-center text-gray-400"},{default:C(()=>[u(c(_e),{class:"size-6","aria-hidden":"true"})]),_:1}),u(fe,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:C(()=>[u(c(he),{class:P(["absolute z-20 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5",[l.promptDocuments?"right-auto left-0 -translate-x-[calc(100%-24px)]":"right-0 left-auto"]])},{default:C(()=>[(i(!0),p(G,null,J(O(t),y=>(i(),R(c(X),{key:y.label},{default:C(()=>[s("button",{class:P(["w-full text-left px-4 py-2 text-sm font-regular transition flex items-center gap-2",{"opacity-50 cursor-not-allowed":y.disabled,"cursor-pointer":!y.disabled}]),disabled:y.disabled,onClick:B=>!y.disabled&&I(y.action,t)},[y.disabled?(i(),R(c(Le),{key:0,class:"size-5 text-gray-400","aria-hidden":"true"})):H("",!0),te(" "+j(y.label),1)],10,Jt)]),_:2},1024))),128))]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024)])],14,Ut)}),128)):l.promptDocuments?H("",!0):(i(),p("div",Kt,[(i(!0),p(G,null,J(M.value.filter(t=>!t.requires_signature),t=>(i(),p("div",{key:t.id,"data-document-id":t.id,class:P(["flex items-center gap-3 py-2 px-4 border rounded-xl cursor-pointer mb-3",t.state==="Published"||t.state==="FullySigned"?"border-green-400 bg-green-300/30 hover:bg-green-300/50":"border-stroke bg-white hover:bg-gray-100",m.value&&String(m.value)===String(t.id)?"animate-pulse-highlight":""]),style:Ue(m.value&&String(m.value)===String(t.id)?"border: 1px solid #CCE0FF !important;":"")},[(i(),R(ne(t.state==="Published"||t.state==="FullySigned"?c(be):c(ye)),{class:P(t.state==="Published"||t.state==="FullySigned"?"size-8 text-green-500":"size-8 text-secondary")},null,8,["class"])),s("div",es,[s("div",ts,[s("div",ss,[s("span",as,j(t.title),1)]),s("span",os,j(t.state==="Published"?"Publicado":t.state==="Draft"?"Borrador":t.state==="Progress"?"En progreso":t.state==="Completed"?"Completado":t.state==="PendingSignatures"?"Pendiente de firmas":t.state==="FullySigned"?"Completamente firmado":"Desconocido"),1)]),u(c(ve),{as:"div",class:"relative inline-block text-left"},{default:C(()=>[u(c(pe),{class:"flex items-center text-gray-400"},{default:C(()=>[u(c(_e),{class:"size-6","aria-hidden":"true"})]),_:1}),u(fe,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:C(()=>[u(c(he),{class:P(["absolute z-20 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5",[l.promptDocuments?"right-auto left-0 -translate-x-[calc(100%-24px)]":"right-0 left-auto"]])},{default:C(()=>[(i(!0),p(G,null,J(O(t),n=>(i(),R(c(X),{key:n.label},{default:C(()=>[s("button",{class:P(["w-full text-left px-4 py-2 text-sm font-regular transition flex items-center gap-2",{"opacity-50 cursor-not-allowed":n.disabled,"cursor-pointer":!n.disabled}]),disabled:n.disabled,onClick:y=>!n.disabled&&I(n.action,t)},[n.disabled?(i(),R(c(Le),{key:0,class:"size-5 text-gray-400","aria-hidden":"true"})):H("",!0),te(" "+j(n.label),1)],10,rs)]),_:2},1024))),128))]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024)])],14,Yt))),128))])),Z(u(le,null,{default:C(()=>[u(Et,{onClose:V})]),_:1},512),[[re,x.value]]),u(Ve,{isVisible:c(de),documentData:c(je),onClose:a[0]||(a[0]=t=>de.value=!1)},null,8,["isVisible","documentData"]),u(qe,{isVisible:f.value,documentId:h.value,onClose:r,onRefresh:D},null,8,["isVisible","documentId"]),S.value?(i(),R(le,{key:2},{default:C(()=>[s("div",ns,[s("div",is,[ls,s("button",{onClick:a[1]||(a[1]=t=>S.value=!1),class:"text-gray-400 hover:text-gray-500"},[u(c(ee),{class:"h-6 w-6"})])]),u(Qe,{initialShowOptions:!0,"user-id":c(w).currentUser.id,onSignatureSaved:e.handleSignatureSaved,onCancel:a[2]||(a[2]=t=>S.value=!1)},null,8,["user-id","onSignatureSaved"])])]),_:1})):H("",!0)],64))}},Ws=Re(ds,[["__scopeId","data-v-d009b0dc"]]),cs={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},us={class:"flex justify-end"},ms=s("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[te(" Nombre "),s("span",{class:"text-red-500"},"*")],-1),gs={class:"mt-2"},ps={class:"flex gap-2 mt-2.5"},fs=["disabled"],hs=s("span",null,"Actualizar nombre",-1),vs=[hs],_s=["disabled"],bs={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(k,{emit:o}){const w=k,_=xe(),x=ue(),f=o,h=L(""),E=L(""),$=()=>{f("close")};Fe(()=>{var m,z;x.selectedDocument?(h.value=((m=x.selectedDocument)==null?void 0:m.title)||"",E.value=((z=x.selectedDocument)==null?void 0:z.title)||""):(h.value="",E.value="")});const S=m=>{m.key==="Escape"&&$()};ce(()=>{document.addEventListener("keydown",S)}),ze(()=>{document.removeEventListener("keydown",S)});const l=F(()=>h.value.trim().length>0),M=F(()=>{var m;return!!((m=x.selectedDocument)!=null&&m.id)}),N=F(()=>M.value&&h.value.trim()!==E.value.trim()&&h.value.trim().length>0);async function g(){if(M.value&&N.value)try{const m={title:h.value.trim()};await x.updateDocument(x.selectedDocument.id,m),E.value=h.value.trim(),x.selectedDocument.title=h.value.trim();const z=x.selectedDocument.id;T("Document name successfully updated.","success"),f("close",{updatedDocId:z});const Q=window.location.pathname;Q==="/dynamic_document_dashboard"||Q==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(m){console.error("Error updating document name:",m),T("Error updating document name.","error")}}function U(){const m=encodeURIComponent(h.value.trim());w.documentId&&!x.selectedDocument?_.push(`/dynamic_document_dashboard/document/use/creator/${w.documentId}/${m}`):x.selectedDocument?(x.selectedDocument.title=h.value.trim(),_.push(`/dynamic_document_dashboard/document/use/editor/${x.selectedDocument.id}/${m}`)):T("Error: No se pudo continuar. Documento no seleccionado.","error")}return(m,z)=>(i(),p("div",cs,[s("div",us,[s("button",{onClick:$},[u(c(ee),{class:"size-6"})])]),s("form",{onSubmit:Y(U,["prevent"])},[s("div",null,[ms,s("div",gs,[Z(s("input",{"onUpdate:modelValue":z[0]||(z[0]=O=>h.value=O),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[we,h.value]])])]),s("div",ps,[M.value?(i(),p("button",{key:0,type:"button",onClick:g,disabled:!N.value,class:P(["p-2.5 text-sm font-medium rounded-md flex gap-2",N.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},vs,10,fs)):H("",!0),s("button",{type:"submit",class:P(["p-2.5 text-sm font-medium rounded-md flex gap-2",l.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!l.value},[s("span",null,j(M.value?"Editar Documento":"Continuar"),1)],10,_s)])],32)]))}},He=k=>(Te("data-v-138439b6"),k=k(),Ae(),k),ys={class:"mb-6"},ws=["data-document-id","onClick"],xs={class:"flex justify-between items-center w-full"},Ds={class:"grid gap-1"},ks={class:"text-base font-medium"},Ss={class:"text-sm font-regular text-gray-400"},$s={class:"py-1"},Is=["onClick"],Cs=["onClick"],Es=["onClick"],Us=["onClick"],Ms=["onClick"],Ls=["onClick"],Ps={key:0,class:"col-span-full mt-6 flex flex-col items-center justify-center text-center text-gray-500 w-full p-8 rounded-xl"},Fs=He(()=>s("p",{class:"text-lg font-semibold mb-2"}," No hay documentos disponibles para mostrar. ",-1)),zs=He(()=>s("p",{class:"text-sm"}," Contacta a tu abogado para gestionar tus documentos. ",-1)),Bs=[Fs,zs],Ts={__name:"DocumentListClient",props:{searchQuery:String,promptDocuments:{type:Array,default:null}},setup(k){const o=ue(),w=Be(),{registerView:_}=Ze(),x=F(()=>w.getCurrentUser),f=L(!1),h=L(null),E=L(!1),$=L({}),S=L(!1),l=L([]),M=L(!1);w.userSignature;const N=F(()=>{if(g.promptDocuments)return null;const r=o.lastUpdatedDocumentId,D=localStorage.getItem("lastUpdatedDocumentId");return r&&U.value.some(e=>String(e.id)===String(r))?r:D&&U.value.some(a=>String(a.id)===String(D))?D:null}),g=k;ce(async()=>{if(g.promptDocuments)return;await o.init(),await m();const r=localStorage.getItem("lastUpdatedDocumentId");r&&!o.lastUpdatedDocumentId&&(o.lastUpdatedDocumentId=r),o.lastUpdatedDocumentId&&U.value.some(D=>String(D.id)===String(o.lastUpdatedDocumentId))}),oe(()=>o.lastUpdatedDocumentId,r=>{g.promptDocuments||r&&localStorage.setItem("lastUpdatedDocumentId",r)});const U=F(()=>{var e,a;if(g.promptDocuments){const t=(e=x.value)==null?void 0:e.id;let n=g.promptDocuments.filter(y=>{const B=y.assigned_to?String(y.assigned_to):null,se=String(t);return B===se&&(y.state==="Progress"||y.state==="Completed")});if(g.searchQuery){const y=g.searchQuery.toLowerCase();n=n.filter(B=>{var se,De,ke,Se,$e,Ie,Ce,Ee;return B.title.toLowerCase().includes(y)||B.state.toLowerCase().includes(y)||B.assigned_to&&w&&(((De=(se=w.userById(B.assigned_to))==null?void 0:se.first_name)==null?void 0:De.toLowerCase().includes(y))||((Se=(ke=w.userById(B.assigned_to))==null?void 0:ke.last_name)==null?void 0:Se.toLowerCase().includes(y))||((Ie=($e=w.userById(B.assigned_to))==null?void 0:$e.email)==null?void 0:Ie.toLowerCase().includes(y))||((Ee=(Ce=w.userById(B.assigned_to))==null?void 0:Ce.identification)==null?void 0:Ee.toLowerCase().includes(y)))})}return n}const r=o.progressAndCompletedDocumentsByClient((a=x.value)==null?void 0:a.id);return o.filteredDocuments(g.searchQuery,w).filter(t=>r.some(n=>String(n.id)===String(t.id)))}),m=async()=>{M.value=!0;try{console.log("==== GETTING DOCUMENTS ====");const r=w.currentUser.id;console.log("Current user ID:",r);const D=await ie(`dynamic-documents/user/${r}/pending-documents-full/`);D&&D.data?(console.log("Number of documents received:",D.data.length),l.value=D.data,l.value.length>0?console.log("Documents found:",l.value.length):console.log("No documents found")):(console.warn("Response does not contain expected data or format:",D),l.value=[])}catch(r){console.error("Error fetching documents:",r),r.response&&console.error("Error details:",r.response.data),T("Error al cargar documentos","error"),l.value=[]}finally{M.value=!1}},z=r=>{o.downloadPDF(r.id,r.title)},O=r=>{o.downloadWord(r.id,r.title)},Q=async r=>{await ae(`¿Deseas eliminar el documento "${r.title}"?`)&&(await o.deleteDocument(r.id),await T("Documento eliminado exitosamente.","success"))},v=r=>{o.selectedDocument=r,h.value=r.id,f.value=!0},b=r=>{f.value=!1,r&&r.updatedDocId&&A(r.updatedDocId),o.clearSelectedDocument()},I=r=>{$.value=r,E.value=!0},q=()=>{$.value={},E.value=!1};oe(U,r=>{if(!g.promptDocuments&&o.lastUpdatedDocumentId&&!r.some(d=>String(d.id)===String(o.lastUpdatedDocumentId))&&r.length>0){const e=[...r].sort((a,t)=>t.id-a.id)[0].id;o.lastUpdatedDocumentId=e,localStorage.setItem("lastUpdatedDocumentId",e)}});const A=r=>{r&&(o.lastUpdatedDocumentId=r,localStorage.setItem("lastUpdatedDocumentId",r),setTimeout(()=>{try{const D=document.querySelectorAll(`[data-document-id="${r}"]`);if(D.length>0){const d=D[0];d.style.border="3px solid #3b82f6",d.classList.remove("animate-pulse-highlight"),d.classList.remove("border-secondary"),d.classList.remove("shadow-md"),d.offsetWidth,d.classList.add("animate-pulse-highlight"),d.classList.add("border-secondary"),d.classList.add("shadow-md"),d.scrollIntoView({behavior:"smooth",block:"center"})}}catch(D){console.error("Error forcing highlight:",D)}},100))};window.forceDocumentHighlight=A;const V=async r=>{await _("document",r.id),Ne(r)},W=()=>{S.value=!1},me=async()=>{await o.init(!0),U.value.some(D=>String(D.id)===String(h.value))&&(o.lastUpdatedDocumentId=h.value,localStorage.setItem("lastUpdatedDocumentId",h.value),A(h.value))};return(r,D)=>(i(),p(G,null,[s("div",null,[s("div",ys,[(i(!0),p(G,null,J(U.value,d=>(i(),p("div",{key:d.id,"data-document-id":d.id,class:P(["flex items-center gap-3 py-2 px-4 border rounded-xl cursor-pointer mb-3",{"border-green-400 bg-green-300/30":d.state==="Completed","border-stroke bg-white":d.state==="Progress","border-secondary shadow-md animate-pulse-highlight":String(d.id)===String(N.value)}]),onClick:e=>{e.target.closest(".menu-container")||V(d)}},[(i(),R(ne(d.state==="Completed"?c(be):c(ye)),{class:P(["size-6",{"text-green-500":d.state==="Completed","text-secondary":d.state==="Progress"}])},null,8,["class"])),s("div",xs,[s("div",Ds,[s("span",ks,j(d.title),1),s("span",Ss,j(d.description),1)]),u(c(ve),{as:"div",class:"relative inline-block text-left menu-container"},{default:C(()=>[u(c(pe),{class:"flex items-center text-gray-400"},{default:C(()=>[u(c(_e),{class:"size-6","aria-hidden":"true"})]),_:1}),u(fe,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:C(()=>[u(c(he),{class:P(["absolute z-10 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",[g.promptDocuments?"right-auto left-0 -translate-x-[calc(100%-24px)]":"right-0 left-auto"]])},{default:C(()=>[s("div",$s,[u(c(X),null,{default:C(()=>[s("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:e=>v(d)},j(d.state==="Completed"?"Editar":"Completar"),9,Is)]),_:2},1024),d.state==="Completed"?(i(),R(c(X),{key:0},{default:C(()=>[s("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:e=>V(d)}," Previsualizar ",8,Cs)]),_:2},1024)):H("",!0),u(c(X),null,{default:C(()=>[s("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:e=>Q(d)}," Eliminar ",8,Es)]),_:2},1024),d.state==="Completed"?(i(),p(G,{key:1},[u(c(X),null,{default:C(()=>[s("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:e=>z(d)}," Descargar PDF ",8,Us)]),_:2},1024),u(c(X),null,{default:C(()=>[s("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:e=>O(d)}," Descargar Word ",8,Ms)]),_:2},1024),u(c(X),null,{default:C(()=>[s("button",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition",onClick:e=>I(d)}," Enviar ",8,Ls)]),_:2},1024)],64)):H("",!0)])]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024)])],10,ws))),128))]),U.value.length===0?(i(),p("div",Ps,Bs)):H("",!0),Z(u(le,null,{default:C(()=>[u(bs,{"document-id":h.value,onClose:b},null,8,["document-id"])]),_:1},512),[[re,f.value]])]),u(Ve,{isVisible:c(de),documentData:c(je),onClose:D[0]||(D[0]=d=>de.value=!1)},null,8,["isVisible","documentData"]),Z(u(le,null,{default:C(()=>[u(bt,{onCloseEmailModal:D[1]||(D[1]=d=>q()),emailDocument:$.value},null,8,["emailDocument"])]),_:1},512),[[re,E.value]]),u(qe,{isVisible:S.value,documentId:h.value,onClose:W,onRefresh:me},null,8,["isVisible","documentId"])],64))}},Xs=Re(Ts,[["__scopeId","data-v-138439b6"]]);export{Ws as D,bt as _,ye as a,Os as b,Qs as c,Xs as d,bs as e,be as f,Et as g,Gs as r};
