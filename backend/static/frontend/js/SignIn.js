import{r as f,u as U,a as M,c as S,b as A,o as D,d as F,e as p,f as h,g as e,w as y,v as b,n as C,h as E,t as V,i as w,j as u,k as g,l as m,m as O,F as K,_ as W,s as o,p as x,R as _,q as j}from"./index.js";import{u as $,_ as z,a as Y,b as H}from"./captcha.js";import{l as J}from"./login_with_google.js";const Q=e("div",{class:"relative xl:absolute"},[e("div",{class:"flex justify-start p-4"},[e("img",{class:"w-40 hidden xl:block",src:z}),e("img",{class:"w-20 block xl:hidden",src:W})])],-1),X={class:"flex mt-6 justify-center xl:mt-0 xl:h-screen xl:items-center"},Z={class:"space-y-5 px-8 w-full md:px-32 2xl:px-72 xl:w-1/2 2xl:w-2/3 order-2"},ee=e("h1",{class:"font-bold text-center text-2xl xl:text-3xl 2xl:text-4xl"}," Te damos la bienvenida de nuevo ",-1),se=e("label",{for:"email",class:"block mb-2 text-sm font-medium text-gray-900"}," Correo electronico ",-1),te=e("label",{for:"passcode",class:"block mb-2 text-sm font-medium text-gray-900"}," Código de verificación ",-1),oe=["disabled"],ae={key:0,class:"text-start text-sm mt-2 text-gray-600"},ne=e("span",{class:"font-regular"},"Enviar nuevo código en ",-1),re={class:"font-bold"},le=e("span",{class:"font-regular"}," segundos.",-1),ie=e("label",{for:"password",class:"block mb-2 text-sm font-medium text-gray-900"}," Contraseña ",-1),ce={class:"text-sm font-medium text-secondary"},de={class:"flex flex-col space-y-2"},ue=["disabled"],me={key:0,class:"text-start text-sm mt-2 text-gray-600"},fe=e("span",{class:"font-regular"},"Intentar de nuevo en ",-1),pe={class:"font-bold"},ge=e("span",{class:"font-regular"}," segundos.",-1),xe=e("span",{class:"font-regular"},"¿Nuevo en G&M?",-1),_e={class:"flex flex-col items-center justify-center text-center"},ve=e("div",{class:"flex items-center w-full mx-4"},[e("div",{class:"flex-grow border-t border-gray-300"}),e("span",{class:"mx-4 text-gray-500"},"O continuar con"),e("div",{class:"flex-grow border-t border-gray-300"})],-1),he={class:"w-full flex justify-around items-center text-center text-secondary font font-regular text-sm"},ye=e("div",{class:"h-screen hidden overflow-hidden order-1 xl:w-1/2 2xl:w-1/3 xl:block"},[e("img",{src:Y,alt:"illustration",class:"w-full h-full object-cover"})],-1),Se={__name:"SignIn",setup(be){const l=f(0),k=U(),a=M(),I=$(),v=f(""),n=f(""),T=async s=>{await I.verify(s)?n.value=s:(o("Error verificando captcha","error"),n.value="")},q=()=>{n.value=""},i=f(!1),N=S(()=>a.signInTries),c=S(()=>a.signInSecondsRemaining),t=A({email:"",passcode:"",password:""});D(async()=>{a.attempsSignIn("initial"),v.value=await I.fetchSiteKey(),await a.isAuthenticated()&&k.push({name:"dashboard",params:{user_id:"",display:""}})});const R=async()=>{if(!t.email){o("Email is required!","warning");return}if(!n.value){o("Por favor verifica que no eres un robot","warning");return}if(a.attempsSignIn(),N.value%3===0)o("You have exceeded the maximum number of attempts. Please try again later.","warning");else try{const s=await j.post("/api/sign_in/",{...t,captcha_token:n.value});a.login(s.data),o("Sign In successful!","success"),window.location.href="/dashboard"}catch(s){s.response&&s.response.status===401?o("Invalid credentials!","warning"):o("Sign On failed!","error")}t.passcode="",t.password=""},B=s=>{J(s,k,a)},G=async()=>{if(!t.email){o("Email is required!","warning");return}if(!n.value){o("Por favor verifica que no eres un robot","warning");return}L();try{await j.post("/api/send_passcode/",{email:t.email,subject_email:"Login code",captcha_token:n.value}),o("Password code sent to your email","info")}catch(s){console.error("Error when code is sent:",s),o("User not found","warning")}},L=()=>{i.value=!0,l.value=180;const s=setInterval(()=>{l.value--,l.value<=0&&(clearInterval(s),i.value=!1)},1e3)};return(s,r)=>{const P=F("GoogleLogin");return p(),h(K,null,[Q,e("section",X,[e("form",Z,[ee,e("div",null,[se,y(e("input",{"onUpdate:modelValue":r[0]||(r[0]=d=>t.email=d),type:"email",id:"email",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-secondary focus:border-secondary block w-full p-2.5",required:""},null,512),[[b,t.email]])]),e("div",null,[te,y(e("input",{"onUpdate:modelValue":r[1]||(r[1]=d=>t.passcode=d),type:"number",id:"passcode",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-secondary focus:border-secondary block w-full p-2.5"},null,512),[[b,t.passcode]]),e("button",{class:C({"text-sm font-medium text-secondary cursor-pointer":!i.value,hidden:i.value}),onClick:E(G,["prevent"]),disabled:i.value}," Enviar código ",10,oe),l.value>0?(p(),h("div",ae,[ne,e("span",re,V(l.value),1),le])):w("",!0)]),e("div",null,[ie,y(e("input",{"onUpdate:modelValue":r[2]||(r[2]=d=>t.password=d),type:"password",id:"password",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-secondary focus:border-secondary block w-full p-2.5",placeholder:""},null,512),[[b,t.password]]),e("a",ce,[u(m(_),{to:{name:"forget_password"}},{default:g(()=>[x(" ¿Olvidaste tu contraseña? ")]),_:1})])]),e("div",null,[v.value?(p(),O(m(H),{key:0,sitekey:v.value,onVerify:T,onExpire:q,hl:"es",class:"mx-auto"},null,8,["sitekey"])):w("",!0)]),e("div",de,[e("div",null,[e("button",{onClick:E(R,["prevent"]),type:"submit",disabled:c.value>1,class:C({"w-full text-white bg-secondary hover:bg-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center":c.value<1,"w-full text-white bg-gray-400 cursor-not-allowed font-medium rounded-lg text-sm px-5 py-2.5 text-center":c.value>=1})}," Iniciar sesión ",10,ue),c.value>0?(p(),h("div",me,[fe,e("span",pe,V(c.value),1),ge])):w("",!0)]),e("p",null,[xe,u(m(_),{to:{name:"sign_on"},class:"font-regular text-secondary"},{default:g(()=>[x(" Registrarse. ")]),_:1})])]),e("div",_e,[ve,u(P,{class:"mt-6",callback:B,"select-account":"","auto-login":!1})]),e("div",he,[u(m(_),{to:{name:"terms_of_use"},class:"cursor-pointer"},{default:g(()=>[x("Condiciones de uso")]),_:1}),u(m(_),{to:{name:"privacy_policy"},class:"cursor-pointer"},{default:g(()=>[x("Aviso de privacidad")]),_:1})])]),ye])],64)}}};export{Se as default};
