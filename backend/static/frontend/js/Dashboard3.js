import{e as n,f as i,g as e,u as et,r as y,aJ as Gt,o as Oe,ar as ut,c as L,h as o,j as t,G as Ue,w as Pe,v as Re,n as $,l as F,t as f,m as fe,p as ee,s as De,b4 as ts,i as w,ac as Ge,a9 as Ht,b5 as ss,Q as mt,k as re,a2 as Ke,F as de,D as Dt,E as os,b6 as ns,a0 as rs,C as as,T as we,N as me,I as Je,a1 as Qe,ag as Te,ad as Ae,ae as Me,af as ue,b7 as ls,O as gt,P as pt,a5 as is,ah as tt,aX as ds,ai as ht,b8 as ft,ab as cs,b9 as $t,ba as zt}from"./index.js";import{u as qe,o as us,s as nt,p as It}from"./index2.js";import{g as dt,a as ct}from"./DocumentPermissionsManager.js";import{B as ms,r as gs,a as ps,b as vt,c as bt,d as St,e as Ft,L as yt,f as Et,_ as jt,D as Zt,g as hs,s as Nt}from"./index3.js";import{_ as xt}from"./_plugin-vue_export-helper.js";import{r as Ct}from"./FolderIcon.js";import{r as Xe}from"./PlusIcon.js";import{r as ot}from"./EllipsisVerticalIcon.js";import{r as rt}from"./DocumentIcon.js";import{_ as fs}from"./DocumentCard.js";import{r as Jt}from"./EyeIcon.js";import{r as at}from"./ChevronRightIcon.js";import{_ as Ot}from"./SignatureDocumentCard.js";import{r as Rt,a as vs,b as bs}from"./TagIcon.js";import{r as Ne}from"./ChevronDownIcon.js";import{r as He}from"./MagnifyingGlassIcon.js";import{r as qt}from"./PencilIcon.js";import{r as Pt}from"./TrashIcon.js";import{r as ys}from"./LinkIcon.js";import{r as Kt}from"./PhotoIcon.js";import{r as Lt}from"./CheckCircleIcon.js";import{r as st,a as lt}from"./FunnelIcon.js";import{r as xs}from"./ArrowLeftIcon.js";import{r as Vt}from"./InformationCircleIcon.js";import{r as Qt}from"./CloudArrowUpIcon.js";import{r as _s}from"./ExclamationTriangleIcon.js";import"./useRecentViews.js";import"./loading_message.js";function Wt(l,v){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})])}function ws(l,v){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})])}function $s(l,v){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})])}const ks={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Cs={class:"flex justify-end"},Ds=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[ee(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),Ss={class:"mt-2"},Fs={class:"flex gap-2 mt-2.5"},Es=["disabled"],Ts=e("span",null,"Actualizar nombre",-1),As=[Ts],Ms=["disabled"],Yt={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(l,{emit:v}){const c=l,u=et(),S=qe(),C=v,m=y(""),D=y(""),_=()=>{C("close")};Gt(()=>{var G,x;S.selectedDocument?(m.value=((G=S.selectedDocument)==null?void 0:G.title)||"",D.value=((x=S.selectedDocument)==null?void 0:x.title)||""):(m.value="",D.value="")});const T=G=>{G.key==="Escape"&&_()};Oe(()=>{document.addEventListener("keydown",T)}),ut(()=>{document.removeEventListener("keydown",T)});const te=L(()=>m.value.trim().length>0),Q=L(()=>{var G;return!!((G=S.selectedDocument)!=null&&G.id)}),K=L(()=>Q.value&&m.value.trim()!==D.value.trim()&&m.value.trim().length>0);async function Y(){if(Q.value&&K.value)try{const G={title:m.value.trim()};await S.updateDocument(S.selectedDocument.id,G),D.value=m.value.trim(),S.selectedDocument.title=m.value.trim();const x=S.selectedDocument.id;De("Document name successfully updated.","success"),C("close",{updatedDocId:x});const h=window.location.pathname;h==="/dynamic_document_dashboard"||h==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(G){console.error("Error updating document name:",G),De("Error updating document name.","error")}}function le(){const G=encodeURIComponent(m.value.trim());c.documentId&&!S.selectedDocument?u.push(`/dynamic_document_dashboard/document/use/creator/${c.documentId}/${G}`):S.selectedDocument?(S.selectedDocument.title=m.value.trim(),u.push(`/dynamic_document_dashboard/document/use/editor/${S.selectedDocument.id}/${G}`)):De("Error: No se pudo continuar. Documento no seleccionado.","error")}return(G,x)=>(n(),i("div",ks,[e("div",Cs,[e("button",{onClick:_},[o(t(Ue),{class:"size-6"})])]),e("form",{onSubmit:fe(le,["prevent"])},[e("div",null,[Ds,e("div",Ss,[Pe(e("input",{"onUpdate:modelValue":x[0]||(x[0]=d=>m.value=d),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[Re,m.value]])])]),e("div",Fs,[Q.value?(n(),i("button",{key:0,type:"button",onClick:Y,disabled:!K.value,class:$(["p-2.5 text-sm font-medium rounded-md flex gap-2",K.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},As,10,Es)):F("",!0),e("button",{type:"submit",class:$(["p-2.5 text-sm font-medium rounded-md flex gap-2",te.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!te.value},[e("span",null,f(Q.value?"Editar Documento":"Continuar"),1)],10,Ms)])],32)]))}},Ps={class:"mt-3 pt-2 border-t border-gray-100"},Ls={class:"flex items-center gap-2 text-xs text-gray-500"},Is=e("span",null,"Hacer clic para usar este documento",-1),js={__name:"UseDocumentCard",props:{document:{type:Object,required:!0},showTags:{type:Boolean,default:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null}},emits:["click","remove-from-folder","document-created"],setup(l,{emit:v}){const c=l,u=v,S=y(!1),C=y(null),m=dt(9),D=L(()=>"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium !bg-purple-100 !text-purple-700 !border !border-purple-200"),_=L(()=>m.dark),T=L(()=>"group !border-purple-400 !bg-purple-50/50 !shadow-purple-100"),te=L(()=>c.menuOptions!==null?c.menuOptions:[{label:"Usar",action:"use",icon:ws,iconClasses:"w-4 h-4 text-purple-600"},{label:"Previsualización",action:"preview",icon:Jt,iconClasses:"w-4 h-4 text-gray-600"}]),Q=L(()=>!1),K=(x,d)=>{c.disableInternalActions?u("click",x,d):le(x.id)},Y=(x,d)=>{switch(x){case"use":le(d.id);break;case"preview":us(d);break;default:console.warn("Unknown menu action:",x)}};function le(x){x?(C.value=x,S.value=!0):console.error("Document ID is required:",x)}function G(x){if(S.value=!1,C.value=null,x&&x.updatedDocId){u("document-created",x);const d=window.location.pathname;d==="/dynamic_document_dashboard"||d==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(x.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}}return(x,d)=>(n(),i(de,null,[o(ms,{document:l.document,"card-type":l.cardType,"card-context":l.cardContext,"status-icon":t(ss),"status-text":"Disponible","status-badge-classes":D.value,"menu-options":te.value,"highlighted-doc-id":null,"show-tags":l.showTags,"document-store":l.documentStore,"user-store":l.userStore,"additional-classes":T.value,"disable-internal-actions":l.disableInternalActions,"show-menu-options":l.showMenuOptions,onClick:K,onMenuAction:Y,onRemoveFromFolder:d[0]||(d[0]=h=>x.$emit("remove-from-folder",h))},ts({"additional-actions":w(()=>[Ht(x.$slots,"additional-actions")]),_:2},[Q.value?{name:"right-action",fn:w(()=>[o(t(at),{class:"w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors"})]),key:"0"}:void 0,l.disableInternalActions?void 0:{name:"footer",fn:w(()=>[e("div",Ps,[e("div",Ls,[e("div",{class:"w-2 h-2 rounded-full",style:Ge({backgroundColor:_.value})},null,4),Is])])]),key:"1"}]),1032,["document","card-type","card-context","status-icon","status-badge-classes","menu-options","show-tags","document-store","user-store","additional-classes","disable-internal-actions","show-menu-options"]),Pe(o(Ke,null,{default:w(()=>[C.value!==null?(n(),re(Yt,{key:0,"document-id":C.value,onClose:G},null,8,["document-id"])):F("",!0)]),_:1},512),[[mt,S.value]])],64))}},Bs=()=>({folders:[],currentFolder:null,isLoading:!1,error:null,lastUpdatedFolderId:null}),Us={sortedFolders:l=>[...l.folders].sort((v,c)=>new Date(c.created_at)-new Date(v.created_at)),getFolderById:l=>v=>l.folders.find(c=>c.id===v),getFoldersByColor:l=>v=>l.folders.filter(c=>c.color_id===v),getFolderWithColor:l=>v=>{const c=l.folders.find(u=>u.id===v);return c?{...c,color:dt(c.color_id)}:null},getFoldersContainingDocument:l=>v=>l.folders.filter(c=>c.document_ids&&c.document_ids.includes(v)),totalDocumentsInFolders:l=>l.folders.reduce((v,c)=>v+(c.document_ids?c.document_ids.length:0),0),hasFolders:l=>l.folders.length>0,availableColors:()=>ct()},zs={async init(l=!1){if(!(this.folders.length>0&&!l)){this.isLoading=!0,this.error=null;try{await this.fetchFolders()}catch(v){console.error("Error initializing document folder store:",v),this.error="Error al inicializar las carpetas"}finally{this.isLoading=!1}}},async fetchFolders(){try{const l=await Dt("dynamic-documents/folders/");if(l.status===200)return this.folders=l.data,l.data;throw new Error(`Error fetching folders: ${l.status}`)}catch(l){throw console.error("Error fetching folders:",l),this.error="Error al obtener las carpetas",l}},async fetchFolder(l){this.isLoading=!0,this.error=null;try{const v=await Dt(`dynamic-documents/folders/${l}/`);if(v.status===200){const c=v.data,u=this.folders.findIndex(S=>S.id===c.id);return u!==-1?this.folders[u]=c:this.folders.push(c),this.currentFolder=c,c}else throw new Error(`Error fetching folder: ${v.status}`)}catch(v){throw console.error("Error fetching folder:",v),this.error="Error al obtener la carpeta",v}finally{this.isLoading=!1}},async createFolder(l){this.isLoading=!0,this.error=null;try{if(!l.name||l.name.trim()==="")throw new Error("El nombre de la carpeta es requerido");const v=l.color_id??0;if(v<0||v>=ct().length)throw new Error("Color de carpeta no válido");const c={name:l.name.trim(),color_id:v,...l.document_ids&&{document_ids:l.document_ids}},u=await os("dynamic-documents/folders/create/",c);if(u.status===200||u.status===201){const S=u.data;return this.folders.push(S),this.lastUpdatedFolderId=S.id,De("Carpeta creada exitosamente","success"),S}else throw new Error(`Error creating folder: ${u.status}`)}catch(v){throw console.error("Error creating folder:",v),this.error=v.message||"Error al crear la carpeta",De(this.error,"error"),v}finally{this.isLoading=!1}},async updateFolder(l,v){this.isLoading=!0,this.error=null;try{if(v.name&&v.name.trim()==="")throw new Error("El nombre de la carpeta no puede estar vacío");if(v.color_id!==void 0){const S=v.color_id;if(S<0||S>=ct().length)throw new Error("Color de carpeta no válido")}const c={};v.name&&(c.name=v.name.trim()),v.color_id!==void 0&&(c.color_id=v.color_id),v.document_ids!==void 0&&(c.document_ids=v.document_ids);const u=await ns(`dynamic-documents/folders/${l}/update/`,c);if(u.status===200){const S=u.data,C=this.folders.findIndex(m=>m.id===l);return C!==-1&&(this.folders[C]=S),this.currentFolder&&this.currentFolder.id===l&&(this.currentFolder=S),this.lastUpdatedFolderId=l,De("Carpeta actualizada exitosamente","success"),S}else throw new Error(`Error updating folder: ${u.status}`)}catch(c){throw console.error("Error updating folder:",c),this.error=c.message||"Error al actualizar la carpeta",De(this.error,"error"),c}finally{this.isLoading=!1}},async deleteFolder(l){this.isLoading=!0,this.error=null;try{const v=await rs(`dynamic-documents/folders/${l}/delete/`);if(v.status===204||v.status===200)return this.folders=this.folders.filter(c=>c.id!==l),this.currentFolder&&this.currentFolder.id===l&&(this.currentFolder=null),await De("Carpeta eliminada exitosamente","success"),!0;throw new Error(`Error deleting folder: ${v.status}`)}catch(v){throw console.error("Error deleting folder:",v),this.error=v.message||"Error al eliminar la carpeta",await De(this.error,"error"),v}finally{this.isLoading=!1}},setCurrentFolder(l){this.currentFolder=l},clearCurrentFolder(){this.currentFolder=null},reset(){this.folders=[],this.currentFolder=null,this.isLoading=!1,this.error=null,this.lastUpdatedFolderId=null}},Ns={async addDocumentsToFolder(l,v){const c=this.getFolderById(l);if(!c)throw new Error("Carpeta no encontrada");const u=c.document_ids||[],S=[...new Set([...u,...v])];return await this.updateFolder(l,{document_ids:S})},async removeDocumentsFromFolder(l,v){const c=this.getFolderById(l);if(!c)throw new Error("Carpeta no encontrada");const S=(c.document_ids||[]).filter(C=>!v.includes(C));return await this.updateFolder(l,{document_ids:S})},async moveDocumentsBetweenFolders(l,v,c){try{v&&await this.removeDocumentsFromFolder(v,l),c&&await this.addDocumentsToFolder(c,l),await De("Documentos movidos exitosamente","success")}catch(u){throw console.error("Error moving documents between folders:",u),await De("Error al mover documentos","error"),u}},getFolderColor(l){const v=this.getFolderById(l);return v?dt(v.color_id):dt(0)},validateFolderData(l){const v=[];if((!l.name||l.name.trim()==="")&&v.push("El nombre de la carpeta es requerido"),l.name&&l.name.length>100&&v.push("El nombre de la carpeta no puede exceder 100 caracteres"),l.color_id!==void 0){const c=l.color_id;(c<0||c>=ct().length)&&v.push("Color de carpeta no válido")}return l.document_ids&&!Array.isArray(l.document_ids)&&v.push("Los IDs de documentos deben ser un array"),{isValid:v.length===0,errors:v}}},Bt=as("documentFolder",{state:Bs,getters:Us,actions:{...zs,...Ns}}),Os={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Rs={class:"bg-white rounded-xl shadow-xl max-w-md w-full"},qs={class:"flex justify-between items-center p-6 border-b"},Vs={class:"text-lg font-semibold text-gray-900"},Qs={class:"mb-4"},Ws=e("label",{for:"folderName",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la carpeta ",-1),Gs={class:"mb-6"},Hs=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Color de la carpeta ",-1),Zs={class:"grid grid-cols-8 gap-2"},Js=["onClick","title"],Ks={class:"flex gap-3"},Ys=["disabled"],Xs={__name:"CreateEditFolderModal",props:{isVisible:{type:Boolean,required:!0},editingFolder:{type:Object,default:null}},emits:["close","success"],setup(l,{emit:v}){const c=l,u=v,S=Bt(),C=y(!1),m=y({name:"",color_id:0}),D=L(()=>ct()),_=()=>{m.value={name:"",color_id:0}};we(()=>c.editingFolder,Q=>{Q?m.value={name:Q.name,color_id:Q.color_id}:_()},{immediate:!0}),we(()=>c.isVisible,Q=>{Q||_()});const T=()=>{u("close")},te=async()=>{if(m.value.name.trim()){C.value=!0;try{c.editingFolder?await S.updateFolder(c.editingFolder.id,m.value):await S.createFolder(m.value),C.value=!1,u("success")}catch{C.value=!1}}};return(Q,K)=>l.isVisible?(n(),re(Ke,{key:0},{default:w(()=>[e("div",Os,[e("div",Rs,[e("div",qs,[e("h3",Vs,f(l.editingFolder?"Editar Carpeta":"Nueva Carpeta"),1),e("button",{onClick:T,class:"text-gray-400 hover:text-gray-500"},[o(t(Ue),{class:"w-6 h-6"})])]),e("form",{onSubmit:fe(te,["prevent"]),class:"p-6"},[e("div",Qs,[Ws,Pe(e("input",{id:"folderName","onUpdate:modelValue":K[0]||(K[0]=Y=>m.value.name=Y),type:"text",required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ej: Contratos Laborales"},null,512),[[Re,m.value.name]])]),e("div",Gs,[Hs,e("div",Zs,[(n(!0),i(de,null,me(D.value,Y=>(n(),i("button",{key:Y.id,type:"button",onClick:le=>m.value.color_id=Y.id,class:$(["w-8 h-8 rounded-full border-2 transition-all",m.value.color_id===Y.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"]),style:Ge({backgroundColor:Y.hex}),title:Y.name},null,14,Js))),128))])]),e("div",Ks,[e("button",{type:"button",onClick:T,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:!m.value.name.trim()||C.value,class:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},f(C.value?"Guardando...":l.editingFolder?"Actualizar":"Crear"),9,Ys)])],32)])])]),_:1})):F("",!0)}},eo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},to={class:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col"},so={class:"border-b px-6 py-4 flex-shrink-0"},oo={class:"flex justify-between items-center"},no={class:"flex items-center gap-3"},ro={class:"text-xl font-semibold text-gray-900"},ao={class:"text-sm text-gray-600"},lo={class:"flex items-center gap-2"},io={class:"flex-1 overflow-y-auto p-6"},co={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},uo={class:"min-w-full divide-y divide-gray-200"},mo=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tipo "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),go={class:"bg-white divide-y divide-gray-200"},po=["onClick"],ho={class:"px-6 py-4 whitespace-nowrap"},fo={class:"flex items-center"},vo={class:"flex-shrink-0 h-10 w-10"},bo={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},yo={class:"ml-4"},xo={class:"text-sm font-medium text-gray-900"},_o={class:"px-6 py-4 whitespace-nowrap"},wo={class:"text-sm text-gray-600"},$o={class:"px-6 py-4 whitespace-nowrap"},ko={class:"px-6 py-4 whitespace-nowrap"},Co={class:"flex flex-wrap gap-1"},Do={key:0,class:"text-sm text-gray-400"},So={class:"py-1"},Fo=["onClick"],Eo=["onClick"],To={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Ao=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"Esta carpeta está vacía",-1),Mo=e("p",{class:"text-gray-600 mb-4"},"Agrega documentos para organizar tu trabajo",-1),Po={__name:"FolderDetailsModalTable",props:{folder:{type:Object,default:null}},emits:["close","add-documents","remove-document","view-document","use-document","document-action"],setup(l,{emit:v}){const c=l,u=v;Je(),qe();const S=y({}),C=y({}),m=y(!1),D=y(-1),_=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],T=L(()=>{if(!c.folder)return _[0];if(c.folder.color)return _.find(A=>A.name===c.folder.color)||_[0];const g=c.folder.id%_.length;return _[g]}),te=g=>g.state==="Published"||g.state==="Draft"?"Formato":g.state==="PendingSignatures"||g.state==="FullySigned"?"Para Firmar":g.state==="Progress"||g.state==="Completed"?"Mis Documentos":"Documento",Q=g=>({Published:"Publicado",Draft:"Borrador",Progress:"En Progreso",Completed:"Completado",PendingSignatures:"Pendiente Firma",FullySigned:"Firmado"})[g.state]||g.state,K=g=>({Published:"bg-green-100 text-green-700 border border-green-200",Draft:"bg-gray-100 text-gray-700 border border-gray-200",Progress:"bg-blue-100 text-blue-700 border border-blue-200",Completed:"bg-green-100 text-green-700 border border-green-200",PendingSignatures:"bg-yellow-100 text-yellow-700 border border-yellow-200",FullySigned:"bg-green-100 text-green-700 border border-green-200"})[g.state]||"bg-gray-100 text-gray-700 border border-gray-200",Y=g=>{const A=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],B=g.id%A.length;return A[B]},le=()=>{u("close")},G=()=>{u("add-documents",c.folder)},x=g=>{u("remove-document",{folderId:c.folder.id,documentId:g.id})},d=g=>{const A=te(g);u(A==="Formato"?"use-document":"view-document",g)},h=()=>!m.value||!c.folder?"auto":c.folder.documents.length===1?"280px":c.folder.documents.length===2&&D.value===1?"340px":"280px",p=(g,A)=>{g&&(S.value[A]=g)},oe=(g,A)=>{g&&(C.value[A]=g)},k=(g,A)=>{m.value=!A,D.value=A?-1:g,A||setTimeout(()=>{const B=C.value[g];if(B){const E=B.$el||B;if(E&&E.getBoundingClientRect){const j=E.getBoundingClientRect(),ae=window.innerHeight;if(g===0){if(j.bottom>ae-20){const se=j.bottom-ae+40;window.scrollBy({top:se,behavior:"smooth"})}}else if(j.bottom>ae-10){const se=j.bottom-ae+30;window.scrollBy({top:se,behavior:"smooth"})}else if(j.top<80){const se=j.top-100;window.scrollBy({top:se,behavior:"smooth"})}}}},100)};return(g,A)=>l.folder?(n(),re(Ke,{key:0},{default:w(()=>[e("div",eo,[e("div",to,[e("div",so,[e("div",oo,[e("div",no,[e("div",{class:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:Ge({backgroundColor:T.value.hex+"20"})},[o(t(Ct),{class:"h-6 w-6",style:Ge({color:T.value.hex})},null,8,["style"])],4),e("div",null,[e("h3",ro,f(l.folder.name),1),e("p",ao,f(l.folder.documents.length)+" documento"+f(l.folder.documents.length!==1?"s":""),1)])]),e("div",lo,[e("button",{onClick:G,class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"},[o(t(Xe),{class:"w-5 h-5"}),ee(" Agregar documentos ")]),e("button",{onClick:le,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[o(t(Ue),{class:"w-6 h-6"})])])])]),e("div",io,[l.folder.documents.length>0?(n(),i("div",co,[e("div",{class:"overflow-x-auto",style:Ge({minHeight:h()})},[e("table",uo,[mo,e("tbody",go,[(n(!0),i(de,null,me(l.folder.documents,(B,E)=>(n(),i("tr",{key:B.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:j=>d(B)},[e("td",ho,[e("div",fo,[e("div",vo,[e("div",bo,[o(t(Qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",yo,[e("div",xo,f(B.title),1)])])]),e("td",_o,[e("span",wo,f(te(B)),1)]),e("td",$o,[e("span",{class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",K(B)])},f(Q(B)),3)]),e("td",ko,[e("div",Co,[(n(!0),i(de,null,me(B.tags,j=>(n(),i("span",{key:j.id,class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",Y(j)])},f(j.name),3))),128)),!B.tags||B.tags.length===0?(n(),i("span",Do,"-")):F("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:A[0]||(A[0]=fe(()=>{},["stop"]))},[o(t(Te),{as:"div",class:"relative inline-block text-left"},{default:w(({open:j})=>[o(t(Ae),{ref_for:!0,ref:ae=>p(ae,E),onClick:ae=>k(E,j),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:w(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),o(t(Me),{ref_for:!0,ref:ae=>oe(ae,E),class:$([l.folder.documents.length>2&&E>0&&E>=l.folder.documents.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:w(()=>[e("div",So,[o(t(ue),null,{default:w(({active:ae})=>[e("a",{onClick:se=>d(B),class:$([ae?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver documento ",10,Fo)]),_:2},1024),o(t(ue),null,{default:w(({active:ae})=>[e("a",{onClick:se=>x(B),class:$([ae?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Quitar de carpeta ",10,Eo)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,po))),128))])])],4)])):(n(),i("div",To,[o(t(rt),{class:"w-12 h-12 text-gray-300 mx-auto mb-4"}),Ao,Mo,e("button",{onClick:G,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},[o(t(Xe),{class:"w-5 h-5"}),ee(" Agregar documentos ")])]))])])])]),_:1})):F("",!0)}},_t=l=>(gt("data-v-d403a707"),l=l(),pt(),l),Lo={class:"tag-filter-container"},Io={class:"relative"},jo={class:"flex items-center"},Bo={key:0,class:"ml-2 inline-flex items-center justify-center h-5 w-5 bg-primary text-white text-xs rounded-full font-medium"},Uo={key:0,class:"absolute left-0 mt-2 w-full sm:w-80 bg-white rounded-xl shadow-xl ring-1 ring-black ring-opacity-5 border border-gray-100 z-50 overflow-hidden"},zo={class:"bg-gray-50 p-4 border-b border-gray-200"},No={class:"flex items-center justify-between mb-3"},Oo=_t(()=>e("h3",{class:"text-sm font-semibold text-gray-900"},"Filtrar por etiquetas",-1)),Ro={key:0,class:"text-xs text-gray-500"},qo={class:"relative"},Vo={key:0,class:"px-4 py-2 bg-blue-50 border-b border-blue-100"},Qo={class:"flex items-center justify-between"},Wo={class:"text-xs font-medium text-blue-700"},Go={class:"max-h-52 overflow-y-auto"},Ho={key:0,class:"px-4 py-8 text-center"},Zo=_t(()=>e("p",{class:"text-gray-500 text-sm"},"No hay etiquetas disponibles",-1)),Jo={key:1,class:"px-4 py-8 text-center"},Ko={class:"text-gray-500 text-sm"},Yo={key:2,class:"px-4 py-8 text-center"},Xo=_t(()=>e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"}),e("span",{class:"ml-3 text-sm text-gray-600"},"Cargando etiquetas...")],-1)),en=[Xo],tn={key:3,class:"py-2"},sn=["onClick"],on={class:"flex items-center h-5"},nn={class:"relative"},rn=["id","checked","onChange"],an={key:0,class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},ln=_t(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),dn=[ln],cn={class:"ml-3 flex items-center flex-1 min-w-0"},un={class:"text-sm font-medium text-gray-900 truncate"},mn={key:0,class:"mt-4"},gn={class:"flex items-start gap-2"},pn=_t(()=>e("span",{class:"text-xs font-medium text-gray-500 mt-1.5 flex-shrink-0"},"Activos:",-1)),hn={class:"flex flex-wrap gap-2"},fn=["onClick"],vn={class:"mr-1"},bn={class:"ml-1 p-0.5 rounded-full hover:bg-white/50 transition-colors duration-150"},yn={__name:"TagFilter",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(l,{emit:v}){const c=l,u=v,S=qe(),C=y(!1),m=y([]),D=y(!1),_=y(""),T=L(()=>S.sortedTags),te=L(()=>{if(!_.value.trim())return T.value;const d=_.value.toLowerCase().trim();return T.value.filter(h=>h.name.toLowerCase().includes(d))}),Q=d=>{const h=dt(d.color_id);return{hex:h&&h.hex?h.hex:"#9CA3AF",dark:h&&h.dark?h.dark:"#374151"}},K=()=>{C.value=!C.value,C.value&&(_.value="")},Y=d=>m.value.some(h=>h.id===d.id),le=d=>{const h=m.value.findIndex(p=>p.id===d.id);h>=0?m.value.splice(h,1):m.value.push(d),u("update:modelValue",m.value)},G=()=>{m.value=[],u("update:modelValue",[])},x=d=>{d.target.closest(".tag-filter-container")||(C.value=!1,_.value="")};return Oe(async()=>{try{D.value=!0,await S.initTags()}catch(d){console.error("Error loading tags:",d)}finally{D.value=!1}document.addEventListener("click",x)}),we(()=>c.modelValue,d=>{m.value=d||[]},{immediate:!0}),ut(()=>{document.removeEventListener("click",x)}),(d,h)=>(n(),i("div",Lo,[e("div",Io,[e("button",{onClick:K,class:$(["group inline-flex items-center justify-between w-full sm:w-auto sm:min-w-[200px] px-4 py-3 border border-gray-200 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-primary transition-all duration-200",{"ring-2 ring-primary border-primary bg-blue-50":C.value,"border-primary bg-primary/5":m.value.length>0&&!C.value}])},[e("div",jo,[o(t(Rt),{class:$(["h-5 w-5 mr-2.5 text-gray-500 group-hover:text-gray-600",{"text-primary":m.value.length>0||C.value}])},null,8,["class"]),e("span",{class:$(["text-gray-700",{"text-primary font-semibold":m.value.length>0||C.value}])}," Filtrar por etiquetas ",2),m.value.length>0?(n(),i("span",Bo,f(m.value.length),1)):F("",!0)]),o(t(Ne),{class:$(["ml-3 h-4 w-4 text-gray-400 transition-all duration-200 group-hover:text-gray-600",{"rotate-180 text-primary":C.value,"text-primary":m.value.length>0&&!C.value}])},null,8,["class"])],2),o(ls,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:w(()=>[C.value?(n(),i("div",Uo,[e("div",zo,[e("div",No,[Oo,T.value.length>0?(n(),i("span",Ro,f(T.value.length)+" disponibles ",1)):F("",!0)]),e("div",qo,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":h[0]||(h[0]=p=>_.value=p),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"},null,512),[[Re,_.value]])])]),m.value.length>0?(n(),i("div",Vo,[e("div",Qo,[e("span",Wo,f(m.value.length)+" etiqueta"+f(m.value.length!==1?"s":"")+" seleccionada"+f(m.value.length!==1?"s":""),1),e("button",{onClick:G,class:"text-xs text-red-600 hover:text-red-700 font-medium px-2 py-1 rounded-md hover:bg-red-50 transition-all duration-200"}," Limpiar todo ")])])):F("",!0),e("div",Go,[!D.value&&te.value.length===0&&_.value.trim()===""?(n(),i("div",Ho,[o(t(Rt),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),Zo])):F("",!0),!D.value&&te.value.length===0&&_.value.trim()!==""?(n(),i("div",Jo,[o(t(He),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e("p",Ko,'Sin resultados para "'+f(_.value)+'"',1),e("button",{onClick:h[1]||(h[1]=p=>_.value=""),class:"text-xs text-primary hover:text-primary-dark mt-2 font-medium"}," Ver todas las etiquetas ")])):F("",!0),D.value?(n(),i("div",Yo,en)):F("",!0),!D.value&&te.value.length>0?(n(),i("div",tn,[(n(!0),i(de,null,me(te.value,p=>(n(),i("div",{key:p.id,class:"group flex items-center px-4 py-2.5 hover:bg-gray-50 cursor-pointer transition-colors duration-150",onClick:oe=>le(p)},[e("div",on,[e("div",nn,[e("input",{id:`tag-${p.id}`,type:"checkbox",checked:Y(p),onChange:oe=>le(p),class:"sr-only"},null,40,rn),e("div",{class:$(["w-4 h-4 border-2 rounded transition-all duration-200 flex items-center justify-center",Y(p)?"bg-primary border-primary":"border-gray-300 group-hover:border-gray-400"])},[Y(p)?(n(),i("svg",an,dn)):F("",!0)],2)])]),e("div",cn,[e("div",{class:"w-3 h-3 rounded-full mr-2.5 border flex-shrink-0 shadow-sm",style:Ge({backgroundColor:Q(p).hex})},null,4),e("span",un,f(p.name),1)])],8,sn))),128))])):F("",!0)])])):F("",!0)]),_:1})]),m.value.length>0?(n(),i("div",mn,[e("div",gn,[pn,e("div",hn,[(n(!0),i(de,null,me(m.value,p=>(n(),i("div",{key:p.id,class:"group inline-flex items-center pl-2.5 pr-1.5 py-1.5 rounded-lg text-xs font-medium border shadow-sm cursor-pointer transition-all duration-200 hover:shadow-md",style:Ge({backgroundColor:Q(p).hex+"20",borderColor:Q(p).hex+"40",color:Q(p).dark}),onClick:oe=>le(p)},[e("div",{class:"w-2 h-2 rounded-full mr-2 flex-shrink-0",style:Ge({backgroundColor:Q(p).hex})},null,4),e("span",vn,f(p.name),1),e("div",bn,[o(t(Ue),{class:"h-3 w-3 opacity-60 group-hover:opacity-100"})])],12,fn))),128))])])])):F("",!0)]))}},xn=xt(yn,[["__scopeId","data-v-d403a707"]]),_n={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},wn={class:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden"},$n={class:"border-b"},kn={class:"hidden sm:flex justify-between items-center p-6"},Cn=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Dn={class:"text-sm text-gray-600"},Sn={class:"sm:hidden p-4"},Fn={class:"flex justify-between items-start mb-2"},En={class:"flex-1 min-w-0 mr-3"},Tn=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),An={class:"text-sm text-gray-600 truncate"},Mn={class:"border-b"},Pn={class:"hidden sm:flex space-x-8 px-6","aria-label":"Tabs"},Ln=["onClick"],In={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},jn={class:"sm:hidden relative px-4 py-3"},Bn={class:"flex items-center"},Un={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},zn=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),Nn=[zn],On={class:"absolute top-full left-4 right-4 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},Rn=["onClick"],qn={class:"border-b bg-gray-50 p-4 sm:p-6"},Vn={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Qn={class:"flex-1"},Wn={key:0,class:"flex items-center gap-3"},Gn={class:"text-sm text-gray-600"},Hn={class:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-350px)]"},Zn={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Jn={key:4,class:"absolute top-2 left-2 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center shadow-sm"},Kn={key:0,class:"text-center py-8 sm:py-12"},Yn={class:"text-lg font-medium text-gray-900 mb-2"},Xn={class:"text-gray-600 text-sm sm:text-base"},er={class:"border-t bg-gray-50"},tr={class:"hidden sm:flex justify-between items-center p-6"},sr={class:"text-sm text-gray-600"},or={class:"flex gap-3"},nr=["disabled"],rr={class:"sm:hidden p-4 space-y-3"},ar={class:"text-center text-sm text-gray-600"},lr={class:"flex gap-3"},ir=["disabled"],dr={__name:"AddDocumentsModal",props:{isVisible:{type:Boolean,required:!0},folder:{type:Object,default:null}},emits:["close","add-documents"],setup(l,{emit:v}){const c=l,u=v,S=qe(),C=Je(),m=y([]),D=y([]),_=y("my-documents"),T=y(!1),te=y(!1),Q=[{name:"my-documents",label:"Mis Documentos"},{name:"use-documents",label:"Formatos Disponibles"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Documentos Firmados"}],K=L(()=>C.currentUser);we(()=>c.isVisible,g=>{g&&(m.value=[],D.value=[],_.value="my-documents")}),we(_,()=>{m.value=[]}),we(D,()=>{m.value=[]},{deep:!0});const Y=L(()=>{const g=G(_.value);return g.length===0?!1:g.every(A=>m.value.includes(A.id))}),le=g=>{var E;if(!c.folder)return[];const A=c.folder.documents.map(j=>j.id);let B=[];switch(g){case"my-documents":B=S.progressAndCompletedDocumentsByClient((E=K.value)==null?void 0:E.id);break;case"use-documents":B=S.publishedDocumentsUnassigned;break;case"pending-signatures":B=S.documents.filter(j=>{var ae,se;return j.state==="PendingSignatures"&&(j.assigned_to===((ae=K.value)==null?void 0:ae.id)||((se=j.signatures)==null?void 0:se.some(O=>{var ce;return O.signer_email===((ce=K.value)==null?void 0:ce.email)})))});break;case"signed-documents":B=S.documents.filter(j=>{var ae,se;return j.state==="FullySigned"&&(j.assigned_to===((ae=K.value)==null?void 0:ae.id)||((se=j.signatures)==null?void 0:se.some(O=>{var ce;return O.signer_email===((ce=K.value)==null?void 0:ce.email)})))});break;default:B=[]}return B.filter(j=>!A.includes(j.id))},G=g=>{const A=le(g);if(!D.value||D.value.length===0)return A;const B=D.value.map(E=>E.id);return A.filter(E=>!E.tags||E.tags.length===0?!1:E.tags.some(j=>B.includes(j.id)))},x=g=>{const A=m.value.indexOf(g);A>-1?m.value.splice(A,1):m.value.push(g)},d=()=>{const A=G(_.value).map(B=>B.id);if(Y.value)m.value=m.value.filter(B=>!A.includes(B));else{const B=A.filter(E=>!m.value.includes(E));m.value.push(...B)}},h=()=>{u("close")},p=async()=>{if(m.value.length!==0){T.value=!0;try{await u("add-documents",m.value)}finally{T.value=!1}}},oe=g=>{_.value=g,te.value=!1},k=g=>{g.target.closest(".relative")||(te.value=!1)};return Oe(()=>{document.addEventListener("click",k)}),ut(()=>{document.removeEventListener("click",k)}),(g,A)=>l.isVisible&&l.folder?(n(),re(Ke,{key:0},{default:w(()=>{var B;return[e("div",_n,[e("div",wn,[e("div",$n,[e("div",kn,[e("div",null,[Cn,e("p",Dn,'Selecciona documentos para agregar a "'+f(l.folder.name)+'"',1)]),e("button",{onClick:h,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors"},[o(t(Ue),{class:"w-5 h-5"})])]),e("div",Sn,[e("div",Fn,[e("div",En,[Tn,e("p",An,'Para "'+f(l.folder.name)+'"',1)]),e("button",{onClick:h,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors flex-shrink-0"},[o(t(Ue),{class:"w-5 h-5"})])])])]),e("div",Mn,[e("nav",Pn,[(n(),i(de,null,me(Q,E=>e("button",{key:E.name,onClick:j=>_.value=E.name,class:$([_.value===E.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[ee(f(E.label)+" ",1),e("span",In,f(G(E.name).length),1)],10,Ln)),64))]),e("div",jn,[e("button",{onClick:A[0]||(A[0]=E=>te.value=!te.value),class:"w-full flex items-center justify-between py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("div",Bn,[e("span",null,f(((B=Q.find(E=>E.name===_.value))==null?void 0:B.label)||"Seleccionar categoría"),1),e("span",Un,f(G(_.value).length),1)]),(n(),i("svg",{class:$(["ml-2 h-5 w-5 transition-transform duration-200",te.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Nn,2))]),Pe(e("div",On,[(n(),i(de,null,me(Q,E=>e("button",{key:E.name,onClick:j=>oe(E.name),class:$(["w-full text-left px-4 py-3 text-sm transition-colors duration-150 flex items-center justify-between",_.value===E.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},[e("span",null,f(E.label),1),e("span",{class:$(["py-0.5 px-2 rounded-full text-xs",_.value===E.name?"bg-white/20 text-white":"bg-gray-100 text-gray-600"])},f(G(E.name).length),3)],10,Rn)),64))],512),[[mt,te.value]])])]),e("div",qn,[e("div",Vn,[e("div",Qn,[o(xn,{modelValue:D.value,"onUpdate:modelValue":A[1]||(A[1]=E=>D.value=E),class:"max-w-md"},null,8,["modelValue"])]),G(_.value).length>0?(n(),i("div",Wn,[e("span",Gn,f(G(_.value).length)+" documento(s) disponible(s) ",1),e("button",{onClick:d,class:$(["px-4 py-2 rounded-lg border font-medium text-sm transition-colors",Y.value?"bg-red-50 border-red-200 text-red-700 hover:bg-red-100":"bg-primary text-white border-primary hover:bg-primary-dark"])},f(Y.value?"Deseleccionar todos":"Seleccionar todos"),3)])):F("",!0)])]),e("div",Hn,[e("div",Zn,[(n(!0),i(de,null,me(G(_.value),E=>(n(),i("div",{key:E.id,class:"relative"},[_.value==="my-documents"?(n(),re(t(fs),{key:0,document:E,"highlighted-doc-id":null,"show-tags":!0,"show-client-name":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":m.value.includes(E.id)?"ring-2 ring-primary bg-primary-50":"",onClick:j=>x(E.id)},null,8,["document","additional-classes","onClick"])):F("",!0),_.value==="use-documents"?(n(),re(t(js),{key:1,document:E,"show-tags":!0,"menu-options":[],"show-menu-options":!1,"disable-internal-actions":!0,"additional-classes":m.value.includes(E.id)?"ring-2 ring-primary bg-primary-50":"",onClick:j=>x(E.id)},null,8,["document","additional-classes","onClick"])):F("",!0),_.value==="pending-signatures"?(n(),re(t(Ot),{key:2,document:E,"highlighted-doc-id":null,"show-tags":!0,"menu-options":[],"disable-internal-actions":!0,"additional-classes":m.value.includes(E.id)?"ring-2 ring-primary bg-primary-50":"",onClick:j=>x(E.id)},null,8,["document","additional-classes","onClick"])):F("",!0),_.value==="signed-documents"?(n(),re(t(Ot),{key:3,document:E,"highlighted-doc-id":null,"show-tags":!0,"menu-options":[],"disable-internal-actions":!0,"additional-classes":m.value.includes(E.id)?"ring-2 ring-primary bg-primary-50":"",onClick:j=>x(E.id)},null,8,["document","additional-classes","onClick"])):F("",!0),m.value.includes(E.id)?(n(),i("div",Jn,[o(t(vs),{class:"w-4 h-4"})])):F("",!0)]))),128))]),G(_.value).length===0?(n(),i("div",Kn,[o(t(rt),{class:"w-12 h-12 sm:w-16 sm:h-16 text-gray-300 mx-auto mb-4"}),e("h4",Yn,f(D.value.length>0?"No hay documentos que coincidan con el filtro":"No hay documentos disponibles"),1),e("p",Xn,f(D.value.length>0?"Intenta ajustar los filtros de etiquetas o selecciona otra categoría":"No tienes documentos de esta categoría que no estén ya en la carpeta"),1)])):F("",!0)]),e("div",er,[e("div",tr,[e("div",sr,f(m.value.length)+" documento(s) seleccionado(s) ",1),e("div",or,[e("button",{onClick:h,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{onClick:p,disabled:m.value.length===0||T.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},f(T.value?"Agregando...":`Agregar ${m.value.length} documento(s)`),9,nr)])]),e("div",rr,[e("div",ar,f(m.value.length)+" documento(s) seleccionado(s) ",1),e("div",lr,[e("button",{onClick:h,class:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center font-medium"}," Cancelar "),e("button",{onClick:p,disabled:m.value.length===0||T.value,class:"flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-center font-medium"},f(T.value?"Agregando...":"Agregar"),9,ir)])])])])])]}),_:1})):F("",!0)}},it=l=>(gt("data-v-d9a5a89f"),l=l(),pt(),l),cr={class:"folders-table"},ur={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200",style:{"overflow-x":"visible","overflow-y":"hidden"}},mr={class:"min-w-full divide-y divide-gray-200"},gr=it(()=>e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Carpeta "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documentos "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Creada "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1)),pr={class:"bg-white divide-y divide-gray-200"},hr=["onClick"],fr={class:"px-6 py-4 whitespace-nowrap"},vr={class:"flex items-center"},br={class:"flex-shrink-0 h-10 w-10"},yr={class:"ml-4"},xr={class:"text-sm font-medium text-gray-900"},_r={class:"px-6 py-4 whitespace-nowrap"},wr={class:"flex items-center gap-2"},$r={class:"text-sm text-gray-900"},kr={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Cr={class:"py-1"},Dr=["onClick"],Sr=["onClick"],Fr=["onClick"],Er=["onClick"],Tr={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Ar=it(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No tienes carpetas aún",-1)),Mr=it(()=>e("p",{class:"text-gray-600 mb-6"},"Crea tu primera carpeta para organizar tus documentos",-1)),Pr={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Lr=it(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No se encontraron carpetas",-1)),Ir=it(()=>e("p",{class:"text-gray-600"},"No hay carpetas que coincidan con tu búsqueda",-1)),jr={key:3,class:"flex justify-center items-center py-12"},Br=it(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)),Ur=[Br],zr={__name:"FoldersTable",props:{sortedFolders:{type:Array,required:!0},searchQuery:{type:String,default:""},isLoading:{type:Boolean,default:!1}},emits:["folder-click","edit-folder","delete-folder","add-documents","create-folder"],setup(l,{emit:v}){const c=l,u=v,S=y({}),C=y({}),m=y(!1),D=y(-1),_=L(()=>{if(!c.searchQuery.trim())return c.sortedFolders;const k=c.searchQuery.toLowerCase();return c.sortedFolders.filter(g=>g.name.toLowerCase().includes(k))}),T=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],te=k=>{if(k.color)return T.find(A=>A.name===k.color)||T[0];const g=k.id%T.length;return T[g]},Q=k=>{if(!k)return"-";const g=new Date(k),B=Math.abs(new Date-g),E=Math.ceil(B/(1e3*60*60*24));return E===0?"Hoy":E===1?"Ayer":E<7?`Hace ${E} días`:E<30?`Hace ${Math.floor(E/7)} semanas`:E<365?`Hace ${Math.floor(E/30)} meses`:g.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},K=k=>{u("folder-click",k)},Y=k=>{u("edit-folder",k)},le=k=>{u("delete-folder",k)},G=k=>{u("add-documents",k)},x=()=>{u("create-folder")},d=()=>m.value?_.value.length===1?"280px":_.value.length===2&&D.value===1?"340px":"280px":"auto",h=(k,g)=>{k&&(S.value[g]=k)},p=(k,g)=>{k&&(C.value[g]=k)},oe=(k,g)=>{m.value=!g,D.value=g?-1:k,g||setTimeout(()=>{const A=C.value[k];if(A){const B=A.$el||A;if(B&&B.getBoundingClientRect){const E=B.getBoundingClientRect(),j=window.innerHeight;if(k===0){if(E.bottom>j-20){const ae=E.bottom-j+40;window.scrollBy({top:ae,behavior:"smooth"})}}else if(E.bottom>j-10){const ae=E.bottom-j+30;window.scrollBy({top:ae,behavior:"smooth"})}else if(E.top<80){const ae=E.top-100;window.scrollBy({top:ae,behavior:"smooth"})}}}},100)};return(k,g)=>(n(),i("div",cr,[!l.isLoading&&_.value.length>0?(n(),i("div",ur,[e("div",{class:"overflow-x-auto",style:Ge({minHeight:d(),overflowY:"visible"})},[e("table",mr,[gr,e("tbody",pr,[(n(!0),i(de,null,me(_.value,(A,B)=>{var E,j;return n(),i("tr",{key:A.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:ae=>K(A)},[e("td",fr,[e("div",vr,[e("div",br,[e("div",{class:"h-10 w-10 rounded-lg flex items-center justify-center",style:Ge({backgroundColor:te(A).hex+"20"})},[o(t(Ct),{class:"h-6 w-6",style:Ge({color:te(A).hex})},null,8,["style"])],4)]),e("div",yr,[e("div",xr,f(A.name),1)])])]),e("td",_r,[e("div",wr,[o(t(Qe),{class:"h-5 w-5 text-gray-400"}),e("span",$r,f(((E=A.documents)==null?void 0:E.length)||0)+" documento"+f((((j=A.documents)==null?void 0:j.length)||0)!==1?"s":""),1)])]),e("td",kr,f(Q(A.created_at)),1),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:g[0]||(g[0]=fe(()=>{},["stop"]))},[o(t(Te),{as:"div",class:"relative inline-block text-left"},{default:w(({open:ae})=>[o(t(Ae),{ref_for:!0,ref:se=>h(se,B),onClick:se=>oe(B,ae),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:w(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),o(t(Me),{ref_for:!0,ref:se=>p(se,B),class:$([_.value.length>2&&B>0&&B>=_.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:w(()=>[e("div",Cr,[o(t(ue),null,{default:w(({active:se})=>[e("a",{onClick:O=>K(A),class:$([se?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver carpeta ",10,Dr)]),_:2},1024),o(t(ue),null,{default:w(({active:se})=>[e("a",{onClick:O=>G(A),class:$([se?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Agregar documentos ",10,Sr)]),_:2},1024),o(t(ue),null,{default:w(({active:se})=>[e("a",{onClick:O=>Y(A),class:$([se?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Editar ",10,Fr)]),_:2},1024),o(t(ue),null,{default:w(({active:se})=>[e("a",{onClick:O=>le(A),class:$([se?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Eliminar ",10,Er)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,hr)}),128))])])],4)])):!l.isLoading&&l.sortedFolders.length===0?(n(),i("div",Tr,[o(t(Ct),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Ar,Mr,e("button",{onClick:x,class:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"},[o(t(Xe),{class:"w-5 h-5"}),ee(" Crear Primera Carpeta ")])])):!l.isLoading&&l.sortedFolders.length>0&&_.value.length===0?(n(),i("div",Pr,[o(t(Ct),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Lr,Ir])):F("",!0),l.isLoading?(n(),i("div",jr,Ur)):F("",!0)]))}},Nr=xt(zr,[["__scopeId","data-v-d9a5a89f"]]),Xt=l=>(gt("data-v-ab5666d5"),l=l(),pt(),l),Or={class:"folder-management"},Rr={class:"mb-6"},qr={class:"hidden sm:flex justify-between items-center"},Vr=Xt(()=>e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Qr={class:"sm:hidden"},Wr=Xt(()=>e("div",{class:"text-center mb-4"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1 px-2"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Gr={__name:"FolderManagement",props:{searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","navigate-to-main"],setup(l,{emit:v}){const c=l,u=v,S=Bt(),C=qe(),m=Je(),D=y(!1),_=y(null),T=y(null),te=y(!1),Q=y(null),K=L(()=>S.isLoading),Y=L(()=>S.sortedFolders);L(()=>m.currentUser),Oe(async()=>{await S.init(),await C.init()}),we(()=>c.searchQuery,()=>{}),we(()=>S.folders,O=>{var ce,ye;if(T.value&&O&&O.length>0){const ve=O.find(U=>U.id===T.value.id);if(ve){const U=((ce=T.value.documents)==null?void 0:ce.length)||0,J=((ye=ve.documents)==null?void 0:ye.length)||0;JSON.stringify(T.value)!==JSON.stringify(ve)&&(T.value={...ve},console.log(`🔄 FolderManagement: Synced selectedFolder "${ve.name}" with store. Documents: ${U} → ${J}`))}}},{deep:!0});const le=()=>{_.value=null,D.value=!0},G=O=>{_.value=O,D.value=!0},x=()=>{D.value=!1,_.value=null},d=()=>{x()},h=O=>{T.value=O},p=()=>{T.value=null},oe=async O=>{if(confirm(`¿Estás seguro de que quieres eliminar la carpeta "${O.name}"?`))try{await S.deleteFolder(O.id),De(`Carpeta "${O.name}" eliminada correctamente`,"success")}catch(ce){De("Error al eliminar la carpeta","error"),console.error("Error deleting folder:",ce)}},k=O=>{Q.value=O,te.value=!0},g=async(O=!1)=>{if(te.value=!1,Q.value=null,O&&T.value)try{await A()}catch(ce){console.warn("Error refreshing folder after adding documents:",ce)}},A=async()=>{if(T.value)try{await S.fetchFolderById(T.value.id,!0);const O=S.getFolderById(T.value.id);O&&(T.value={...O},console.log("✅ Selected folder refreshed successfully"))}catch(O){throw console.error("❌ Error refreshing selected folder:",O),O}},B=async O=>{var ce,ye,ve;if(!(!Q.value||O.length===0))try{const U=Q.value.documents.map(ne=>ne.id).filter(ne=>ne!=null&&!isNaN(parseInt(ne))).map(ne=>parseInt(ne)),J=O.filter(ne=>ne!=null&&!isNaN(parseInt(ne))).map(ne=>parseInt(ne)),q=[...new Set([...U,...J])];if(console.log("Current document IDs:",U),console.log("Selected document IDs:",J),console.log("Updated document IDs:",q),q.some(ne=>!Number.isInteger(ne)||ne<=0))throw new Error("IDs de documentos inválidos detectados");await S.updateFolder(Q.value.id,{document_ids:q}),await g(!0),De(`${J.length} documento(s) agregado(s) a la carpeta`,"success"),u("navigate-to-main")}catch(U){console.error("Error adding documents to folder:",U),console.error("Error details:",((ce=U.response)==null?void 0:ce.data)||U.message),(ye=U.response)!=null&&ye.status?De(`Error al agregar documentos: ${((ve=U.response.data)==null?void 0:ve.detail)||U.message}`,"error"):De("Error al agregar documentos a la carpeta","error")}},E=async O=>{var ce,ye,ve;if(T.value)try{const U=parseInt(O);if(!Number.isInteger(U)||U<=0)throw new Error("ID de documento inválido");const J=T.value.documents.map(q=>q.id).filter(q=>q!=null&&!isNaN(parseInt(q))).map(q=>parseInt(q)).filter(q=>q!==U);console.log("Removing document ID:",U),console.log("Updated document IDs after removal:",J),await S.updateFolder(T.value.id,{document_ids:J}),De("Documento removido de la carpeta","success"),T.value=null,u("navigate-to-main");try{await S.fetchFolderById(T.value.id,!0);const q=S.getFolderById(T.value.id);q&&(T.value=q),console.log("Folder data refreshed successfully after removal")}catch(q){console.warn("Error refreshing folder data:",q);try{T.value={...T.value,documents:T.value.documents.filter(ne=>ne.id!==U)},console.log("Applied optimistic removal for document ID:",U)}catch(ne){console.warn("Optimistic update failed:",ne)}}}catch(U){console.error("Error removing document from folder:",U),console.error("Error details:",((ce=U.response)==null?void 0:ce.data)||U.message),(ye=U.response)!=null&&ye.status?De(`Error al remover documento: ${((ve=U.response.data)==null?void 0:ve.detail)||U.message}`,"error"):De("Error al remover el documento de la carpeta","error")}},j=O=>{console.log("View document:",O)},ae=O=>{console.log("Use document:",O)},se=(O,ce)=>{console.log("Document action:",O,ce)};return(O,ce)=>(n(),i("div",Or,[e("div",Rr,[e("div",qr,[Vr,e("button",{onClick:le,class:"inline-flex items-center gap-2 px-4 py-2.5 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md"},[o(t(Xe),{class:"w-5 h-5"}),ee(" Nueva Carpeta ")])]),e("div",Qr,[Wr,e("button",{onClick:le,class:"w-full flex items-center justify-center gap-3 px-4 py-4 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium text-base"},[o(t(Xe),{class:"w-6 h-6"}),ee(" Nueva Carpeta ")])])]),o(t(Nr),{"sorted-folders":Y.value,"search-query":l.searchQuery,"is-loading":K.value,onFolderClick:h,onEditFolder:G,onDeleteFolder:oe,onAddDocuments:k,onCreateFolder:le},null,8,["sorted-folders","search-query","is-loading"]),o(t(Xs),{"is-visible":D.value,"editing-folder":_.value,onClose:x,onSuccess:d},null,8,["is-visible","editing-folder"]),o(t(Po),{folder:T.value,onClose:p,onAddDocuments:k,onRemoveDocument:E,onViewDocument:j,onUseDocument:ae,onDocumentAction:se},null,8,["folder"]),o(t(dr),{"is-visible":te.value,folder:Q.value,onClose:g,onAddDocuments:B},null,8,["is-visible","folder"])]))}},Hr=xt(Gr,[["__scopeId","data-v-ab5666d5"]]);function Ut(){const l=Je(),v=L(()=>{var C;return((C=l.currentUser)==null?void 0:C.role)==="basic"}),c=C=>{De("Esta funcionalidad está restringida para usuarios básicos. Por favor, contacta a tu abogado para obtener acceso completo.","warning")};return{isBasicUser:v,showRestrictionNotification:c,handleFeatureAccess:(C,m)=>v.value?(c(),!1):(m&&m(),!0),getRestrictedButtonClasses:C=>C?"opacity-60 cursor-not-allowed":""}}function Zr(l){return!l.variables||l.variables.length===0?!0:l.variables.every(v=>v.name_es&&v.name_es.trim().length>0)}function Mt(l,v){var S;if(!l.requires_signature||l.state!=="PendingSignatures"||!l.signatures||l.signatures.length===0)return!1;const c=(S=v==null?void 0:v.currentUser)==null?void 0:S.email,u=l.signatures.find(C=>C.signer_email===c);return!(!u||u.signed)}const Jr={lawyer:{getMenuOptions:(l,v,c)=>{const u=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Administrar Asociaciones",action:"relationships"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}];return l.state==="Draft"?u.push({label:"Publicar",action:"publish",disabled:!Zr(l)}):l.state==="Published"&&(u.push({label:"Mover a Borrador",action:"draft"}),u.push({label:"Formalizar y Agregar Firmas",action:"formalize"})),(l.state==="Completed"||l.state==="Published")&&u.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),l.requires_signature&&(u.push({label:"Ver Firmas",action:"viewSignatures"}),Mt(l,c)&&u.push({label:"Firmar documento",action:"sign"})),u}},signatures:{getMenuOptions:(l,v,c)=>{const u=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}];return l.requires_signature&&(l.state==="PendingSignatures"||l.state==="FullySigned")&&u.push({label:"Estado de las firmas",action:"viewSignatures"}),Mt(l,c)&&u.push({label:"Firmar documento",action:"sign"}),l.state==="FullySigned"&&u.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),l.state==="PendingSignatures"&&u.push({label:"Descargar PDF",action:"downloadPDF"}),u}},client:{getMenuOptions:(l,v,c)=>{var m,D,_;const u=[],S=((m=c==null?void 0:c.currentUser)==null?void 0:m.role)==="basic",C=((D=c==null?void 0:c.currentUser)==null?void 0:D.role)==="corporate_client"||((_=c==null?void 0:c.currentUser)==null?void 0:_.role)==="client";return l.state==="Completed"?(u.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Editar Formulario",action:"editForm"},{label:"Editar Documento",action:"editDocument"}]}),(C||S)&&u.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:S})):u.push({label:"Completar",action:"editForm"}),l.state==="Completed"&&u.push({label:"Previsualizar",action:"preview"}),u.push({label:"Eliminar",action:"delete"}),S?u.push({label:"Gestionar Membrete",action:"letterhead",disabled:!0}):u.push({label:"Gestionar Membrete",action:"letterhead"}),u.push({label:"Administrar Asociaciones",action:"relationships",disabled:S}),l.requires_signature&&(u.push({label:"Ver Firmas",action:"viewSignatures"}),Mt(l,c)&&u.push({label:"Firmar documento",action:"sign"})),l.state==="Completed"&&u.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord",disabled:S},{label:"Enviar",action:"email",disabled:S}),u}}};function Kr(l,v,c="list",u=null){const S=Jr[l];return S?S.getMenuOptions(v,c,u):[]}const Yr={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Xr={class:"px-6 py-4 border-b border-gray-200"},ea=e("h2",{class:"text-xl font-semibold text-gray-800"},"Acciones del Documento",-1),ta={class:"text-sm text-gray-500 mt-1"},sa={class:"p-6 overflow-y-auto flex-grow"},oa={class:"space-y-4"},na={key:0,class:"text-sm font-semibold text-gray-700 uppercase tracking-wide px-2"},ra={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},aa=["onClick","disabled"],la={class:"text-sm font-medium"},ia={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},da=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),ca={key:1,class:"border-t border-gray-200 my-4"},ua={key:0,class:"text-center py-12"},ma=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay acciones disponibles",-1),ga=e("p",{class:"mt-1 text-sm text-gray-500"}," No hay opciones disponibles para este documento. ",-1),wt={__name:"DocumentActionsModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null},cardType:{type:String,required:!0,validator:l=>["lawyer","client","signatures"].includes(l)},context:{type:String,default:"table"},userStore:{type:Object,default:null}},emits:["close","action"],setup(l,{emit:v}){const c=l,u=v,S=L(()=>c.document?Kr(c.cardType,c.document,c.context,c.userStore):[]),C=L(()=>{const x=S.value;if(!x||x.length===0)return[];const d=[],h={edit:"Edición",view:"Visualización",share:"Compartir",manage:"Gestión",signatures:"Firmas",delete:"Eliminación"},p={edit:[],view:[],share:[],manage:[],signatures:[],delete:[]};return x.forEach(oe=>{if(oe.children&&Array.isArray(oe.children))oe.children.forEach(k=>{const g=k.action.toLowerCase();m(k,g,p)});else{const k=oe.action.toLowerCase();m(oe,k,p)}}),p.edit.length>0&&d.push({title:h.edit,options:p.edit}),p.view.length>0&&d.push({title:h.view,options:p.view}),p.share.length>0&&d.push({title:h.share,options:p.share}),p.signatures.length>0&&d.push({title:h.signatures,options:p.signatures}),p.manage.length>0&&d.push({title:h.manage,options:p.manage}),p.delete.length>0&&d.push({title:h.delete,options:p.delete}),d}),m=(x,d,h)=>{d.includes("edit")||d.includes("editar")||d==="copy"||d==="draft"||d==="publish"||d==="formalize"||d==="completar"?h.edit.push(x):d.includes("view")||d.includes("preview")||d.includes("ver")||d.includes("previsualización")?h.view.push(x):d.includes("download")||d.includes("email")||d.includes("enviar")||d.includes("descargar")?h.share.push(x):d.includes("signature")||d.includes("firma")||d.includes("sign")?h.signatures.push(x):d.includes("permission")||d.includes("relationship")||d.includes("letterhead")||d.includes("permiso")||d.includes("asociación")||d.includes("membrete")?h.manage.push(x):d.includes("delete")||d.includes("eliminar")?h.delete.push(x):h.manage.push(x)},D=x=>{const d=x.toLowerCase();return d==="editform"||d.includes("completar")?Wt:d==="editdocument"||d.includes("editar documento")?qt:d.includes("edit")||d==="editar"?qt:d.includes("delete")||d==="eliminar"?Pt:d.includes("preview")||d.includes("ver")||d.includes("previsualización")?Jt:d==="copy"||d.includes("copia")?ps:d.includes("download")||d.includes("descargar")?tt:d.includes("email")||d.includes("enviar")?ds:d.includes("permission")||d.includes("permiso")?bs:d.includes("relationship")||d.includes("asociación")?ys:d.includes("letterhead")||d.includes("membrete")?Kt:d.includes("signature")||d.includes("firma")?Lt:d==="publish"||d.includes("publicar")?$s:d==="draft"||d.includes("borrador")?Qe:d==="formalize"||d.includes("formalizar")?Wt:rt},_=x=>{const d=x.toLowerCase();return d.includes("delete")||d==="eliminar"?"text-red-600":d.includes("download")||d.includes("descargar")?"text-blue-600":d.includes("email")||d.includes("enviar")?"text-green-600":d.includes("signature")||d.includes("firma")?"text-purple-600":"text-gray-600"},T=x=>{const d=x.toLowerCase();return d.includes("delete")||d==="eliminar"?"border-red-200 bg-red-50 text-red-700 hover:bg-red-100 hover:border-red-300":d.includes("download")||d.includes("descargar")?"border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 hover:border-blue-300":d.includes("email")||d.includes("enviar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":d.includes("signature")||d.includes("firma")?"border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-100 hover:border-purple-300":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-300"},{isBasicUser:te,handleFeatureAccess:Q}=Ut(),K=["formalize","letterhead","relationships","downloadWord","email"],Y=x=>{const d=x.toLowerCase();return K.some(h=>d===h.toLowerCase())},le=x=>{const d=S.value.find(p=>p.action===x?p:p.children?p.children.find(oe=>oe.action===x):null),h=d!=null&&d.children?d.children.find(p=>p.action===x):d;if(h!=null&&h.disabled){Q("Esta funcionalidad",null);return}u("action",x,c.document)},G=()=>{u("close")};return(x,d)=>Pe((n(),re(Ke,null,{default:w(()=>{var h;return[e("div",Yr,[e("div",Xr,[ea,e("p",ta,f(((h=l.document)==null?void 0:h.title)||"Cargando..."),1),e("button",{onClick:G,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500 transition-colors"},[o(t(Ue),{class:"h-6 w-6"})])]),e("div",sa,[e("div",oa,[(n(!0),i(de,null,me(C.value,(p,oe)=>(n(),i("div",{key:oe,class:"space-y-2"},[p.title?(n(),i("h3",na,f(p.title),1)):F("",!0),e("div",ra,[(n(!0),i(de,null,me(p.options,k=>(n(),i("div",{key:k.action,class:"relative group"},[e("button",{onClick:g=>le(k.action),disabled:k.disabled,class:$(["flex items-center justify-start w-full px-4 py-3 rounded-lg border transition-all duration-200",k.disabled?"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed opacity-60":T(k.action),"hover:shadow-md hover:scale-[1.02]"])},[(n(),re(is(D(k.action)),{class:$(["h-5 w-5 mr-3 flex-shrink-0",k.disabled?"text-gray-400":_(k.action)])},null,8,["class"])),e("span",la,f(k.label),1),k.disabled?(n(),re(t(gs),{key:0,class:"h-4 w-4 ml-auto text-gray-400"})):F("",!0)],10,aa),k.disabled&&t(te)&&Y(k.action)?(n(),i("div",ia,[ee(" Actualiza tu suscripción para usar esta funcionalidad "),da])):F("",!0)]))),128))]),oe<C.value.length-1?(n(),i("div",ca)):F("",!0)]))),128)),C.value.length===0?(n(),i("div",ua,[o(t(rt),{class:"mx-auto h-12 w-12 text-gray-400"}),ma,ga])):F("",!0)])])])]}),_:1},512)),[[mt,l.isVisible]])}},pa={class:"document-list-client-table"},ha={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},fa={class:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"},va={class:"flex flex-col sm:flex-row gap-3 flex-1 w-full lg:w-auto"},ba={class:"relative flex-1 min-w-[200px]"},ya={class:"max-w-[120px] truncate"},xa={class:"p-2"},_a={class:"relative mb-2"},wa={class:"max-h-60 overflow-y-auto"},$a=["onClick"],ka={class:"truncate"},Ca={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},Da={class:"flex items-center gap-3 w-full lg:w-auto"},Sa={class:"text-sm text-gray-500 whitespace-nowrap"},Fa={class:"py-1"},Ea={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Ta={class:"overflow-x-auto"},Aa={class:"min-w-full divide-y divide-gray-200"},Ma=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ")])],-1),Pa={class:"bg-white divide-y divide-gray-200"},La=["onClick"],Ia={class:"px-6 py-4 whitespace-nowrap"},ja={class:"flex items-center"},Ba={class:"flex-shrink-0 h-10 w-10"},Ua={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},za={class:"ml-4"},Na={class:"text-sm font-medium text-gray-900"},Oa={class:"px-6 py-4 whitespace-nowrap"},Ra={class:"px-6 py-4 whitespace-nowrap"},qa={class:"flex flex-wrap gap-1"},Va={key:0,class:"text-sm text-gray-400"},Qa={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Wa={class:"flex flex-1 justify-between sm:hidden"},Ga=["disabled"],Ha=["disabled"],Za={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Ja={class:"text-sm text-gray-700"},Ka={class:"font-medium"},Ya={class:"font-medium"},Xa={class:"font-medium"},el={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},tl=["disabled"],sl=e("span",{class:"sr-only"},"Anterior",-1),ol=["onClick"],nl={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},rl=["disabled"],al=e("span",{class:"sr-only"},"Siguiente",-1),ll={key:1,class:"text-center py-12"},il=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos",-1),dl=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos asignados por tu abogado aparecerán aquí.",-1),cl={__name:"DocumentListClientTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh","open-letterhead","open-relationships"],setup(l,{emit:v}){const c=qe(),u=Je(),S=et(),C=v,{handleFeatureAccess:m}=Ut(),{activeModals:D,openModal:_,closeModal:T}=vt(c,u),{handlePreviewDocument:te,deleteDocument:Q,downloadPDFDocument:K,downloadWordDocument:Y,formalizeDocument:le,signDocument:G}=bt(c,u,C);we(D,P=>{},{deep:!0}),Oe(()=>{});const x=y(""),d=y(""),h=y(null),p=y("recent");Oe(()=>{c.init(),u.init()});const oe=L(()=>u.getCurrentUser),k=L(()=>oe.value?c.progressAndCompletedDocumentsByClient(oe.value.id):[]),g=L(()=>{let P=[...k.value];const r=x.value.toLowerCase();return r&&(P=P.filter(s=>{var a,z;return((a=s.title)==null?void 0:a.toLowerCase().includes(r))||((z=s.tags)==null?void 0:z.some(pe=>{var _e;return(_e=pe.name)==null?void 0:_e.toLowerCase().includes(r)}))})),h.value&&(P=P.filter(s=>s.tags&&s.tags.some(a=>a.id===h.value))),p.value==="name"?P.sort((s,a)=>{const z=(s.title||"").toLowerCase(),pe=(a.title||"").toLowerCase();return z.localeCompare(pe)}):p.value==="recent"&&P.sort((s,a)=>a.id-s.id),P}),A=y(1),B=y(10),E=L(()=>{const P=(A.value-1)*B.value,r=P+B.value;return g.value.slice(P,r)}),j=L(()=>Math.ceil(g.value.length/B.value)),ae=L(()=>{const P=(A.value-1)*B.value+1,r=Math.min(A.value*B.value,g.value.length);return{start:P,end:r,total:g.value.length}});we([x,h,p],()=>{A.value=1});const se=L(()=>{const P=j.value,r=A.value,s=[];if(P<=7)for(let a=1;a<=P;a++)s.push(a);else if(r<=4){for(let a=1;a<=5;a++)s.push(a);s.push("..."),s.push(P)}else if(r>=P-3){s.push(1),s.push("...");for(let a=P-4;a<=P;a++)s.push(a)}else s.push(1),s.push("..."),s.push(r-1),s.push(r),s.push(r+1),s.push("..."),s.push(P);return s}),O=()=>{A.value>1&&A.value--},ce=()=>{A.value<j.value&&A.value++},ye=P=>{P>=1&&P<=j.value&&(A.value=P)},ve=L(()=>{const P=new Map;return k.value.forEach(r=>{r.tags&&r.tags.length>0&&r.tags.forEach(s=>{P.has(s.id)||P.set(s.id,s)})}),Array.from(P.values()).sort((r,s)=>r.name.localeCompare(s.name))}),U=L(()=>{if(!d.value)return ve.value;const P=d.value.toLowerCase();return ve.value.filter(r=>r.name.toLowerCase().includes(P))}),J=L(()=>{if(!h.value)return null;const P=ve.value.find(r=>r.id===h.value);return P?P.name:null}),q=L(()=>{switch(p.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),ne=P=>P.state==="Completed"?"Completado":P.state==="Progress"?"En Progreso":P.state||"Sin estado",ge=P=>P.state==="Completed"?"bg-green-100 text-green-700 border border-green-200":P.state==="Progress"?"bg-blue-100 text-blue-700 border border-blue-200":"bg-gray-100 text-gray-700 border border-gray-200",he=P=>{const r=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],s=P.id%r.length;return r[s]},xe=P=>{const r=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],s=P.id%r.length;return r[s]},je=()=>{h.value=null},Ee=y(!1),Be=y(null),R=P=>{Be.value=P,Ee.value=!0},I=async(P,r)=>{Ee.value=!1,await W(P,r)},W=async(P,r)=>{var s;try{switch(P){case"editForm":_("edit",r,{userRole:((s=u.currentUser)==null?void 0:s.role)||"client"});break;case"editDocument":S.push(`/dynamic_document_dashboard/client/editor/edit/${r.id}`);break;case"preview":await te(r);break;case"delete":await Q(r);break;case"letterhead":m("Membrete Individual",()=>{_("letterhead",r)});break;case"relationships":_("relationships",r);break;case"downloadPDF":await K(r);break;case"downloadWord":await Y(r);break;case"email":_("email",r);break;case"formalize":await le(r);break;case"viewSignatures":_("signatures",r);break;case"sign":await G(r,_);break;default:console.warn("Unknown action:",P)}}catch(a){console.error(`Error executing action ${P}:`,a)}};return(P,r)=>(n(),i(de,null,[e("div",pa,[e("div",ha,[e("div",fa,[e("div",va,[e("div",ba,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":r[0]||(r[0]=s=>x.value=s),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent"},null,512),[[Re,x.value]])]),o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:w(()=>[o(t(st),{class:"h-4 w-4"}),e("span",ya,f(J.value||"Etiqueta"),1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",xa,[e("div",_a,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":r[1]||(r[1]=s=>d.value=s),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:r[2]||(r[2]=fe(()=>{},["stop"]))},null,512),[[Re,d.value]])]),e("div",wa,[o(t(ue),null,{default:w(({active:s})=>[e("a",{onClick:r[3]||(r[3]=a=>h.value=null),class:$([s?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(n(!0),i(de,null,me(U.value,s=>(n(),re(t(ue),{key:s.id},{default:w(({active:a})=>[e("a",{onClick:z=>h.value=s.id,class:$([a?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:$(["w-3 h-3 rounded-full flex-shrink-0",xe(s)])},null,2),e("span",ka,f(s.name),1)],10,$a)]),_:2},1024))),128)),U.value.length===0?(n(),i("div",Ca," No se encontraron etiquetas ")):F("",!0)])])]),_:1})]),_:1}),h.value?(n(),i("button",{key:0,onClick:je,class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(Ue),{class:"h-4 w-4"}),ee(" Limpiar ")])):F("",!0)]),e("div",Da,[e("span",Sa,f(g.value.length)+" "+f(g.value.length===1?"resultado":"resultados"),1),o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:w(()=>[ee(" Ordenar: "+f(q.value)+" ",1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",Fa,[o(t(ue),null,{default:w(({active:s})=>[e("a",{onClick:r[4]||(r[4]=a=>p.value="recent"),class:$([s?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:w(({active:s})=>[e("a",{onClick:r[5]||(r[5]=a=>p.value="name"),class:$([s?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Ea,[e("div",Ta,[e("table",Aa,[Ma,e("tbody",Pa,[(n(!0),i(de,null,me(E.value,(s,a)=>(n(),i("tr",{key:s.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:z=>R(s)},[e("td",Ia,[e("div",ja,[e("div",Ba,[e("div",Ua,[o(t(Qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",za,[e("div",Na,f(s.title),1)])])]),e("td",Oa,[e("span",{class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ge(s)])},f(ne(s)),3)]),e("td",Ra,[e("div",qa,[(n(!0),i(de,null,me(s.tags,z=>(n(),i("span",{key:z.id,class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",he(z)])},f(z.name),3))),128)),!s.tags||s.tags.length===0?(n(),i("span",Va,"-")):F("",!0)])])],8,La))),128))])])]),j.value>1?(n(),i("div",Qa,[e("div",Wa,[e("button",{onClick:O,disabled:A.value===1,class:$(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",A.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,Ga),e("button",{onClick:ce,disabled:A.value===j.value,class:$(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",A.value===j.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Ha)]),e("div",Za,[e("div",null,[e("p",Ja,[ee(" Mostrando "),e("span",Ka,f(ae.value.start),1),ee(" a "),e("span",Ya,f(ae.value.end),1),ee(" de "),e("span",Xa,f(ae.value.total),1),ee(" resultados ")])]),e("div",null,[e("nav",el,[e("button",{onClick:O,disabled:A.value===1,class:$(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",A.value===1?"opacity-50 cursor-not-allowed":""])},[sl,o(t(ht),{class:"h-5 w-5","aria-hidden":"true"})],10,tl),(n(!0),i(de,null,me(se.value,s=>(n(),i(de,{key:s},[s!=="..."?(n(),i("button",{key:0,onClick:a=>ye(s),class:$(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",A.value===s?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},f(s),11,ol)):(n(),i("span",nl," ... "))],64))),128)),e("button",{onClick:ce,disabled:A.value===j.value,class:$(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",A.value===j.value?"opacity-50 cursor-not-allowed":""])},[al,o(t(at),{class:"h-5 w-5","aria-hidden":"true"})],10,rl)])])])])):F("",!0),g.value.length===0?(n(),i("div",ll,[o(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),il,dl])):F("",!0)])]),(n(),re(ft,{to:"body"},[t(D).edit.isOpen?(n(),re(St,{key:0,document:t(D).edit.document,"user-role":t(D).edit.userRole,onClose:r[6]||(r[6]=s=>t(T)("edit")),onRefresh:r[7]||(r[7]=s=>C("refresh"))},null,8,["document","user-role"])):F("",!0),t(D).email.isOpen?(n(),re(Ft,{key:1,document:t(D).email.document,onClose:r[8]||(r[8]=s=>t(T)("email"))},null,8,["document"])):F("",!0),t(D).letterhead.isOpen?(n(),re(yt,{key:2,"is-visible":!0,document:t(D).letterhead.document,onClose:r[9]||(r[9]=s=>t(T)("letterhead")),onRefresh:r[10]||(r[10]=s=>C("refresh"))},null,8,["document"])):F("",!0),t(D).relationships.isOpen?(n(),re(Et,{key:3,"is-open":!0,document:t(D).relationships.document,onClose:r[11]||(r[11]=s=>t(T)("relationships")),onRefresh:r[12]||(r[12]=s=>C("refresh"))},null,8,["document"])):F("",!0),Ee.value?(n(),re(wt,{key:4,"is-visible":Ee.value,document:Be.value,"card-type":"client",context:"table","user-store":t(u),onClose:r[13]||(r[13]=s=>Ee.value=!1),onAction:I},null,8,["is-visible","document","user-store"])):F("",!0)]))],64))}},ul={class:"mb-4"},ml={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},gl={class:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"},pl={class:"flex flex-col sm:flex-row gap-3 flex-1 w-full lg:w-auto"},hl={class:"relative flex-1 min-w-[200px]"},fl={class:"max-w-[120px] truncate"},vl={class:"p-2"},bl={class:"relative mb-2"},yl={class:"max-h-60 overflow-y-auto"},xl=["onClick"],_l={class:"truncate"},wl={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},$l={class:"flex items-center gap-3 w-full lg:w-auto"},kl={class:"text-sm text-gray-500 whitespace-nowrap"},Cl={class:"py-1"},Dl={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},Sl={class:"min-w-full divide-y divide-gray-200"},Fl=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plantilla "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),El={class:"bg-white divide-y divide-gray-200"},Tl=["onClick"],Al={class:"px-6 py-4 whitespace-nowrap"},Ml={class:"flex items-center"},Pl={class:"flex-shrink-0 h-10 w-10"},Ll={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},Il={class:"ml-4"},jl={class:"text-sm font-medium text-gray-900"},Bl=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-700 border border-purple-200"}," Disponible ")],-1),Ul={class:"px-6 py-4 whitespace-nowrap"},zl={class:"flex flex-wrap gap-1"},Nl={key:0,class:"text-sm text-gray-400"},Ol={class:"py-1"},Rl=["onClick"],ql={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Vl=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay plantillas disponibles",-1),Ql={class:"mt-1 text-sm text-gray-500"},Wl=e("div",{class:"mt-4"},[e("div",{class:"text-xs text-gray-400 bg-gray-100 px-3 py-2 rounded-lg inline-block"},[ee(" 💡 "),e("strong",null,"Tip:"),ee(" Las plantillas son creadas por los abogados ")])],-1),Gl={__name:"UseDocumentTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["go-back"],setup(l,{emit:v}){const c=qe();Je();const u=et(),S=v,C=y(""),m=y(""),D=y(null),_=y("recent"),T=y(!1),te=y(null),Q=y({}),K=y({}),Y=y(!1),le=y(-1),G=L(()=>c.publishedDocumentsUnassigned||[]),x=L(()=>{let U=[...G.value];const J=C.value.toLowerCase();return J&&(U=U.filter(q=>{var ne,ge;return((ne=q.title)==null?void 0:ne.toLowerCase().includes(J))||((ge=q.tags)==null?void 0:ge.some(he=>{var xe;return(xe=he.name)==null?void 0:xe.toLowerCase().includes(J)}))})),D.value&&(U=U.filter(q=>q.tags&&q.tags.some(ne=>ne.id===D.value))),_.value==="name"?U.sort((q,ne)=>{const ge=(q.title||"").toLowerCase(),he=(ne.title||"").toLowerCase();return ge.localeCompare(he)}):_.value==="recent"&&U.sort((q,ne)=>ne.id-q.id),U}),d=L(()=>{const U=new Map;return G.value.forEach(J=>{J.tags&&J.tags.length>0&&J.tags.forEach(q=>{U.has(q.id)||U.set(q.id,q)})}),Array.from(U.values()).sort((J,q)=>J.name.localeCompare(q.name))}),h=L(()=>{if(!m.value)return d.value;const U=m.value.toLowerCase();return d.value.filter(J=>J.name.toLowerCase().includes(U))}),p=L(()=>{if(!D.value)return null;const U=d.value.find(J=>J.id===D.value);return U?U.name:null}),oe=L(()=>{switch(_.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),k=L(()=>{const U=C.value&&C.value.trim().length>0,J=D.value!==null;return U&&J?"No se encontraron plantillas que coincidan con tu búsqueda y filtros":U?"No se encontraron plantillas que coincidan con tu búsqueda":J?"No se encontraron plantillas con la etiqueta seleccionada":"Aún no hay plantillas disponibles para usar"}),g=U=>{const J=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],q=U.id%J.length;return J[q]},A=U=>{const J=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],q=U.id%J.length;return J[q]},B=()=>{D.value=null},E=U=>{U&&(c.selectedDocument=null,te.value=U,T.value=!0)},j=()=>{T.value=!1,te.value=null},ae=U=>{if(U.state==="Published"&&!U.assigned_to)E(U.id);else{const q=`/dynamic_document_dashboard/document/use/editor/${U.id}/${encodeURIComponent(U.title.trim())}`;u.push(q)}},se=()=>{S("go-back")};Oe(async()=>{(!c.documents||c.documents.length===0)&&await c.init(!0)});const O=()=>Y.value?x.value.length===1?"280px":x.value.length===2&&le.value===1?"340px":"280px":"auto",ce=(U,J)=>{U&&(Q.value[J]=U)},ye=(U,J)=>{U&&(K.value[J]=U)},ve=(U,J)=>{Y.value=!J,le.value=J?-1:U,J||setTimeout(()=>{const q=K.value[U];if(q){const ne=q.$el||q;if(ne&&ne.getBoundingClientRect){const ge=ne.getBoundingClientRect(),he=window.innerHeight;if(U===0){if(ge.bottom>he-20){const xe=ge.bottom-he+40;window.scrollBy({top:xe,behavior:"smooth"})}}else if(ge.bottom>he-10){const xe=ge.bottom-he+30;window.scrollBy({top:xe,behavior:"smooth"})}else if(ge.top<80){const xe=ge.top-100;window.scrollBy({top:xe,behavior:"smooth"})}}}},100)};return(U,J)=>(n(),i("div",null,[e("div",ul,[e("button",{onClick:se,class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors border border-gray-300"},[o(t(xs),{class:"h-4 w-4"}),ee(" Volver a Mis Documentos ")])]),e("div",ml,[e("div",gl,[e("div",pl,[e("div",hl,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":J[0]||(J[0]=q=>C.value=q),type:"text",placeholder:"Buscar plantillas...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent"},null,512),[[Re,C.value]])]),o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:w(()=>[o(t(st),{class:"h-4 w-4"}),e("span",fl,f(p.value||"Etiqueta"),1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",vl,[e("div",bl,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":J[1]||(J[1]=q=>m.value=q),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:J[2]||(J[2]=fe(()=>{},["stop"]))},null,512),[[Re,m.value]])]),e("div",yl,[o(t(ue),null,{default:w(({active:q})=>[e("a",{onClick:J[3]||(J[3]=ne=>D.value=null),class:$([q?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(n(!0),i(de,null,me(h.value,q=>(n(),re(t(ue),{key:q.id},{default:w(({active:ne})=>[e("a",{onClick:ge=>D.value=q.id,class:$([ne?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:$(["w-3 h-3 rounded-full flex-shrink-0",A(q)])},null,2),e("span",_l,f(q.name),1)],10,xl)]),_:2},1024))),128)),h.value.length===0?(n(),i("div",wl," No se encontraron etiquetas ")):F("",!0)])])]),_:1})]),_:1}),D.value?(n(),i("button",{key:0,onClick:B,class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(Ue),{class:"h-4 w-4"}),ee(" Limpiar ")])):F("",!0)]),e("div",$l,[e("span",kl," Mostrando "+f(x.value.length)+" plantillas ",1),o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:w(()=>[ee(" Ordenar: "+f(oe.value)+" ",1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",Cl,[o(t(ue),null,{default:w(({active:q})=>[e("a",{onClick:J[4]||(J[4]=ne=>_.value="recent"),class:$([q?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:w(({active:q})=>[e("a",{onClick:J[5]||(J[5]=ne=>_.value="name"),class:$([q?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),x.value.length>0?(n(),i("div",Dl,[e("div",{class:"overflow-x-auto",style:Ge({minHeight:O()})},[e("table",Sl,[Fl,e("tbody",El,[(n(!0),i(de,null,me(x.value,(q,ne)=>(n(),i("tr",{key:q.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:ge=>ae(q)},[e("td",Al,[e("div",Ml,[e("div",Pl,[e("div",Ll,[o(t(Qe),{class:"h-5 w-5 text-purple-600"})])]),e("div",Il,[e("div",jl,f(q.title),1)])])]),Bl,e("td",Ul,[e("div",zl,[(n(!0),i(de,null,me(q.tags,ge=>(n(),i("span",{key:ge.id,class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",g(ge)])},f(ge.name),3))),128)),!q.tags||q.tags.length===0?(n(),i("span",Nl,"-")):F("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:J[6]||(J[6]=fe(()=>{},["stop"]))},[o(t(Te),{as:"div",class:"relative inline-block text-left"},{default:w(({open:ge})=>[o(t(Ae),{ref_for:!0,ref:he=>ce(he,ne),onClick:he=>ve(ne,ge),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:w(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),o(t(Me),{ref_for:!0,ref:he=>ye(he,ne),class:$([x.value.length>2&&ne>0&&ne>=x.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:w(()=>[e("div",Ol,[o(t(ue),null,{default:w(({active:he})=>[e("a",{onClick:xe=>ae(q),class:$([he?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Usar plantilla ",10,Rl)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,Tl))),128))])])],4)])):(n(),i("div",ql,[o(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),Vl,e("p",Ql,f(k.value),1),Wl])),Pe(o(Ke,null,{default:w(()=>[te.value!==null?(n(),re(Yt,{key:0,"document-id":te.value,onClose:j},null,8,["document-id"])):F("",!0)]),_:1},512),[[mt,T.value]])]))}},Ye=l=>(gt("data-v-20a3a659"),l=l(),pt(),l),Hl={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},Zl={class:"mb-4"},Jl={class:"relative w-full"},Kl={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},Yl={class:"flex items-center gap-2 min-w-0"},Xl={class:"truncate"},ei={class:"py-1"},ti=["onClick"],si={class:"flex items-center gap-2 min-w-0"},oi={class:"truncate"},ni={class:"p-2"},ri={class:"relative mb-2"},ai={class:"max-h-60 overflow-y-auto"},li=["onClick"],ii={class:"truncate"},di={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},ci={class:"flex items-center justify-stretch"},ui=Ye(()=>e("span",null,"Limpiar",-1)),mi={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},gi={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},pi={class:"flex items-center gap-2"},hi=Ye(()=>e("span",{class:"hidden sm:inline"},"Exportar",-1)),fi={class:"py-1"},vi=Ye(()=>e("span",{class:"hidden sm:inline"},"Ordenar:",-1)),bi={class:"py-1"},yi={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},xi={class:"overflow-x-auto",style:{"overflow-y":"visible"}},_i={class:"min-w-full divide-y divide-gray-200"},wi={class:"bg-gray-50"},$i={scope:"col",class:"w-12 px-6 py-3"},ki=["checked"],Ci=Ye(()=>e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Minuta ",-1)),Di=Ye(()=>e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1)),Si=Ye(()=>e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1)),Fi={class:"bg-white divide-y divide-gray-200"},Ei=["onClick"],Ti=["checked","onChange"],Ai={class:"px-6 py-4 whitespace-nowrap"},Mi={class:"flex items-center"},Pi={class:"flex-shrink-0 h-10 w-10"},Li={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Ii={class:"ml-4"},ji={class:"text-sm font-medium text-gray-900"},Bi={class:"px-6 py-4 whitespace-nowrap"},Ui={class:"px-6 py-4 whitespace-nowrap"},zi={class:"flex flex-wrap gap-1"},Ni={key:0,class:"text-sm text-gray-400"},Oi={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Ri={class:"flex flex-1 justify-between sm:hidden"},qi=["disabled"],Vi=["disabled"],Qi={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Wi={class:"text-sm text-gray-700"},Gi={class:"font-medium"},Hi={class:"font-medium"},Zi={class:"font-medium"},Ji={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Ki=["disabled"],Yi=Ye(()=>e("span",{class:"sr-only"},"Anterior",-1)),Xi=["onClick"],ed={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},td=["disabled"],sd=Ye(()=>e("span",{class:"sr-only"},"Siguiente",-1)),od={key:0,class:"text-center py-12"},nd=Ye(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos",-1)),rd=Ye(()=>e("p",{class:"mt-1 text-sm text-gray-500"},"No se encontraron documentos con los filtros seleccionados.",-1)),ad={__name:"DocumentListLawyer",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null}},emits:["refresh"],setup(l,{emit:v}){const c=qe(),u=Je(),S=et(),C=v,{activeModals:m,openModal:D,closeModal:_,getUserRole:T}=vt(c,u),{handlePreviewDocument:te,deleteDocument:Q,downloadPDFDocument:K,downloadWordDocument:Y,copyDocument:le,publishDocument:G,moveToDraft:x,formalizeDocument:d,signDocument:h,downloadSignedDocument:p}=bt(c,u,C),oe=y([]),k=y([]),g=l,A=y(""),B=y(""),E=y(null),j=y(null),ae=y("recent"),se=y([]),O=y(1),ce=y(10),ye=M=>{switch(M.state){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return"Desconocido"}},ve=M=>{switch(M.state){case"Published":case"FullySigned":return"bg-green-100 text-green-700 border border-green-200";case"Draft":case"Progress":return"bg-blue-100 text-blue-700 border border-blue-200";case"PendingSignatures":return"bg-yellow-100 text-yellow-700 border border-yellow-200";case"Completed":return"bg-purple-100 text-purple-700 border border-purple-200";default:return"bg-gray-100 text-gray-700 border border-gray-200"}},U=M=>{const b=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],H=M.id%b.length;return b[H]},J=M=>{switch(M){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return M}},q=L(()=>{const M=new Set;return je.value.forEach(b=>{b.state&&M.add(b.state)}),Array.from(M).sort()}),ne=L(()=>{const M=new Map;return je.value.forEach(b=>{b.tags&&b.tags.length>0&&b.tags.forEach(H=>{M.has(H.id)||M.set(H.id,H)})}),Array.from(M.values()).sort((b,H)=>b.name.localeCompare(H.name))}),ge=L(()=>{if(!B.value)return ne.value;const M=B.value.toLowerCase();return ne.value.filter(b=>b.name.toLowerCase().includes(M))}),he=L(()=>{if(!j.value)return null;const M=ne.value.find(b=>b.id===j.value);return M?M.name:null}),xe=M=>{const b=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],H=M.id%b.length;return b[H]},je=L(()=>{if(g.promptDocuments)return[];const b=(c.getDocumentsByLawyerId(u.currentUser.id)||[]).filter(Ce=>Ce.state!=="FullySigned"),H=g.selectedTags?g.selectedTags.map(Ce=>Ce.id):[];return c.filteredDocumentsBySearchAndTags(g.searchQuery,u,H).filter(Ce=>b.some(ke=>ke.id===Ce.id))}),Ee=L(()=>{if(g.promptDocuments&&g.promptDocuments.length>0){let M=g.promptDocuments.filter(b=>b.title&&b.title.toLowerCase().includes((g.searchQuery||"").toLowerCase()));if(g.selectedTags&&g.selectedTags.length>0){const b=g.selectedTags.map(H=>H.id);M=M.filter(H=>!H.tags||H.tags.length===0?!1:H.tags.some(N=>b.includes(N.id)))}return M}return[]}),Be=L(()=>g.promptDocuments?Ee.value:je.value),R=L(()=>{let M=[...Be.value];const b=A.value.toLowerCase();return b&&(M=M.filter(H=>{var N,Ce,ke;return((N=H.title)==null?void 0:N.toLowerCase().includes(b))||((Ce=H.state)==null?void 0:Ce.toLowerCase().includes(b))||((ke=H.tags)==null?void 0:ke.some(Tt=>{var Ze;return(Ze=Tt.name)==null?void 0:Ze.toLowerCase().includes(b)}))})),E.value&&(M=M.filter(H=>H.state===E.value)),j.value&&(M=M.filter(H=>H.tags&&H.tags.some(N=>N.id===j.value))),ae.value==="name"?M.sort((H,N)=>{const Ce=(H.title||"").toLowerCase(),ke=(N.title||"").toLowerCase();return Ce.localeCompare(ke)}):ae.value==="recent"&&M.sort((H,N)=>N.id-H.id),M}),I=L(()=>{const M=(O.value-1)*ce.value,b=M+ce.value;return R.value.slice(M,b)}),W=L(()=>Math.ceil(R.value.length/ce.value)),P=L(()=>{const M=(O.value-1)*ce.value+1,b=Math.min(O.value*ce.value,R.value.length);return{start:M,end:b,total:R.value.length}});we([A,E,j],()=>{O.value=1});const r=L(()=>{switch(ae.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}});L(()=>{if(g.promptDocuments)return null;const M=c.lastUpdatedDocumentId,b=localStorage.getItem("lastUpdatedDocumentId"),H=[...je.value];return M&&H.some(ke=>String(ke.id)===String(M))?M:b&&H.some(ke=>String(ke.id)===String(b))?b:null});const s=async()=>{try{const M=u.currentUser.id,b=await Dt(`dynamic-documents/user/${M}/pending-documents-full/`),H=await Dt(`dynamic-documents/user/${M}/signed-documents/`);b.status===200&&(oe.value=b.data),H.status===200&&(k.value=H.data)}catch(M){console.error("Error fetching lawyer documents:",M),M.response&&(console.error("Error response data:",M.response.data),console.error("Error status:",M.response.status))}};we(Be,M=>{if(!g.promptDocuments&&c.lastUpdatedDocumentId&&!M.some(H=>String(H.id)===String(c.lastUpdatedDocumentId))&&M.length>0){const N=[...M].sort((Ce,ke)=>ke.id-Ce.id)[0].id;c.lastUpdatedDocumentId=N,localStorage.setItem("lastUpdatedDocumentId",N)}});const a=M=>{M&&setTimeout(()=>{try{const b=document.querySelectorAll(`[data-document-id="${M}"]`);if(b.length>0){const H=b[0];H.classList.remove("animate-pulse-highlight-green","animate-pulse-highlight-blue"),H.offsetWidth,(H.querySelector("[data-document-id]")||H).classList.contains("border-green-400")?H.classList.add("animate-pulse-highlight-green"):H.classList.add("animate-pulse-highlight-blue"),H.scrollIntoView({behavior:"smooth",block:"center"})}}catch(b){console.error("Error forcing highlight:",b)}},100)};window.forceDocumentHighlight=a,Oe(async()=>{if(g.promptDocuments)return;await c.init();const M=localStorage.getItem("lastUpdatedDocumentId");M&&(c.lastUpdatedDocumentId=M,setTimeout(()=>{Be.value.some(H=>String(H.id)===String(M))&&a(M)},500)),s()});const z=L(()=>R.value.length>0&&se.value.length===R.value.length),pe=()=>{z.value?se.value=[]:se.value=R.value.map(M=>M.id)},_e=M=>{const b=se.value.indexOf(M);b>-1?se.value.splice(b,1):se.value.push(M)},Ve=()=>{se.value=R.value.map(M=>M.id)},Se=()=>{se.value=[]},We=()=>{E.value=null,j.value=null},X=()=>{O.value>1&&O.value--},V=()=>{O.value<W.value&&O.value++},ie=M=>{M>=1&&M<=W.value&&(O.value=M)},Z=L(()=>{const M=W.value,b=O.value,H=[];if(M<=7)for(let N=1;N<=M;N++)H.push(N);else if(b<=4){for(let N=1;N<=5;N++)H.push(N);H.push("..."),H.push(M)}else if(b>=M-3){H.push(1),H.push("...");for(let N=M-4;N<=M;N++)H.push(N)}else H.push(1),H.push("..."),H.push(b-1),H.push(b),H.push(b+1),H.push("..."),H.push(M);return H}),be=()=>{const M=se.value.length>0?R.value.filter(Ze=>se.value.includes(Ze.id)):R.value,b=["Nombre Minuta","Estado","Etiquetas"],H=M.map(Ze=>[Ze.title||"",ye(Ze),Ze.tags?Ze.tags.map(At=>At.name).join(", "):""]),N=[b.join(","),...H.map(Ze=>Ze.map(At=>`"${At}"`).join(","))].join(`
`),Ce=new Blob([N],{type:"text/csv;charset=utf-8;"}),ke=document.createElement("a"),Tt=URL.createObjectURL(Ce);ke.setAttribute("href",Tt),ke.setAttribute("download",`documentos_${new Date().toISOString().split("T")[0]}.csv`),ke.style.visibility="hidden",document.body.appendChild(ke),ke.click(),document.body.removeChild(ke)},$e=async(M,b)=>{try{switch(M){case"edit":S.push(`/dynamic_document_dashboard/lawyer/editor/edit/${b.id}`);break;case"permissions":D("permissions",b);break;case"relationships":D("relationships",b);break;case"preview":await te(b);break;case"delete":await Q(b);break;case"downloadPDF":await K(b);break;case"downloadWord":await Y(b);break;case"email":D("email",b);break;case"copy":await le(b);break;case"publish":await G(b);break;case"draft":await x(b);break;case"formalize":await d(b);break;case"viewSignatures":D("signatures",b);break;case"sign":await h(b,D);break;case"letterhead":D("letterhead",b);break;default:console.warn("Unknown action:",M)}}catch(H){console.error(`Error executing action ${M}:`,H)}},Ie=y(!1),Fe=y(null),ze=M=>{Fe.value=M,Ie.value=!0},es=async(M,b)=>{Ie.value=!1,await $e(M,b)};return(M,b)=>{var H;return n(),i("div",null,[e("div",Hl,[e("div",Zl,[e("div",Jl,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":b[0]||(b[0]=N=>A.value=N),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Re,A.value]])])]),e("div",Kl,[o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:w(()=>[e("div",Yl,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",Xl,f(E.value||"Estado"),1)]),o(t(Ne),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Me),{class:"absolute left-0 z-10 mt-2 w-full min-w-[14rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",ei,[o(t(ue),null,{default:w(({active:N})=>[e("a",{onClick:b[1]||(b[1]=Ce=>E.value=null),class:$([N?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(n(!0),i(de,null,me(q.value,N=>(n(),re(t(ue),{key:N},{default:w(({active:Ce})=>[e("a",{onClick:ke=>E.value=N,class:$([Ce?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},f(J(N)),11,ti)]),_:2},1024))),128))])]),_:1})]),_:1}),o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:w(()=>[e("div",si,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",oi,f(he.value||"Etiqueta"),1)]),o(t(Ne),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Me),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",ni,[e("div",ri,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":b[2]||(b[2]=N=>B.value=N),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:b[3]||(b[3]=fe(()=>{},["stop"]))},null,512),[[Re,B.value]])]),e("div",ai,[o(t(ue),null,{default:w(({active:N})=>[e("a",{onClick:b[4]||(b[4]=Ce=>j.value=null),class:$([N?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(n(!0),i(de,null,me(ge.value,N=>(n(),re(t(ue),{key:N.id},{default:w(({active:Ce})=>[e("a",{onClick:ke=>j.value=N.id,class:$([Ce?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:$(["w-3 h-3 rounded-full flex-shrink-0",xe(N)])},null,2),e("span",ii,f(N.name),1)],10,li)]),_:2},1024))),128)),ge.value.length===0?(n(),i("div",di," No se encontraron etiquetas ")):F("",!0)])])]),_:1})]),_:1}),e("div",ci,[E.value||j.value?(n(),i("button",{key:0,onClick:We,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(Ue),{class:"h-4 w-4 flex-shrink-0"}),ui])):F("",!0)])]),e("div",mi,[e("div",gi,[e("div",pi,[e("button",{onClick:be,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[o(t(tt),{class:"h-4 w-4"}),hi]),o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:w(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",fi,[o(t(ue),null,{default:w(({active:N})=>[e("a",{onClick:Ve,class:$([N?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),o(t(ue),null,{default:w(({active:N})=>[e("a",{onClick:Se,class:$([N?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:w(()=>[vi,ee(" "+f(r.value)+" ",1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",bi,[o(t(ue),null,{default:w(({active:N})=>[e("a",{onClick:b[5]||(b[5]=Ce=>ae.value="recent"),class:$([N?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:w(({active:N})=>[e("a",{onClick:b[6]||(b[6]=Ce=>ae.value="name"),class:$([N?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",yi,[e("div",xi,[e("table",_i,[e("thead",wi,[e("tr",null,[e("th",$i,[e("input",{type:"checkbox",checked:z.value,onChange:pe,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,ki)]),Ci,Di,Si])]),e("tbody",Fi,[(n(!0),i(de,null,me(I.value,(N,Ce)=>(n(),i("tr",{key:N.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:ke=>ze(N)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:b[7]||(b[7]=fe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:se.value.includes(N.id),onChange:ke=>_e(N.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Ti)]),e("td",Ai,[e("div",Mi,[e("div",Pi,[e("div",Li,[o(t(Qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",Ii,[e("div",ji,f(N.title),1)])])]),e("td",Bi,[e("span",{class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ve(N)])},f(ye(N)),3)]),e("td",Ui,[e("div",zi,[(n(!0),i(de,null,me(N.tags,ke=>(n(),i("span",{key:ke.id,class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",U(ke)])},f(ke.name),3))),128)),!N.tags||N.tags.length===0?(n(),i("span",Ni,"-")):F("",!0)])])],8,Ei))),128))])])]),W.value>1?(n(),i("div",Oi,[e("div",Ri,[e("button",{onClick:X,disabled:O.value===1,class:$(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",O.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,qi),e("button",{onClick:V,disabled:O.value===W.value,class:$(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",O.value===W.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Vi)]),e("div",Qi,[e("div",null,[e("p",Wi,[ee(" Mostrando "),e("span",Gi,f(P.value.start),1),ee(" a "),e("span",Hi,f(P.value.end),1),ee(" de "),e("span",Zi,f(P.value.total),1),ee(" resultados ")])]),e("div",null,[e("nav",Ji,[e("button",{onClick:X,disabled:O.value===1,class:$(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",O.value===1?"opacity-50 cursor-not-allowed":""])},[Yi,o(t(ht),{class:"h-5 w-5","aria-hidden":"true"})],10,Ki),(n(!0),i(de,null,me(Z.value,N=>(n(),i(de,{key:N},[N!=="..."?(n(),i("button",{key:0,onClick:Ce=>ie(N),class:$(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",O.value===N?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},f(N),11,Xi)):(n(),i("span",ed," ... "))],64))),128)),e("button",{onClick:V,disabled:O.value===W.value,class:$(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",O.value===W.value?"opacity-50 cursor-not-allowed":""])},[sd,o(t(at),{class:"h-5 w-5","aria-hidden":"true"})],10,td)])])])])):F("",!0)]),R.value.length===0?(n(),i("div",od,[o(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),nd,rd])):F("",!0),o(jt,{isVisible:t(nt),documentData:t(It),onClose:b[8]||(b[8]=N=>nt.value=!1)},null,8,["isVisible","documentData"]),(n(),re(ft,{to:"body"},[t(m).edit.isOpen?(n(),re(t(St),{key:0,document:t(m).edit.document,"user-role":t(T)(),onClose:b[9]||(b[9]=N=>t(_)("edit")),onRefresh:b[10]||(b[10]=N=>C("refresh"))},null,8,["document","user-role"])):F("",!0),t(m).email.isOpen?(n(),re(t(Ft),{key:1,document:t(m).email.document,onClose:b[11]||(b[11]=N=>t(_)("email"))},null,8,["document"])):F("",!0),t(m).signatures.isOpen?(n(),re(t(Zt),{key:2,"document-id":(H=t(m).signatures.document)==null?void 0:H.id,onClose:b[12]||(b[12]=N=>t(_)("signatures")),onRefresh:b[13]||(b[13]=N=>C("refresh"))},null,8,["document-id"])):F("",!0),t(m).permissions.isOpen?(n(),re(t(hs),{key:3,"is-open":t(m).permissions.isOpen,document:t(m).permissions.document,onClose:b[14]||(b[14]=N=>t(_)("permissions")),onSaved:b[15]||(b[15]=N=>C("refresh"))},null,8,["is-open","document"])):F("",!0),t(m).letterhead.isOpen?(n(),re(yt,{key:4,"is-visible":t(m).letterhead.isOpen,document:t(m).letterhead.document,onClose:b[16]||(b[16]=N=>t(_)("letterhead")),onUploaded:b[17]||(b[17]=N=>C("refresh")),onDeleted:b[18]||(b[18]=N=>C("refresh"))},null,8,["is-visible","document"])):F("",!0),t(m).relationships.isOpen?(n(),re(Et,{key:5,"is-open":t(m).relationships.isOpen,document:t(m).relationships.document,onClose:b[19]||(b[19]=N=>t(_)("relationships")),onRefresh:b[20]||(b[20]=N=>C("refresh"))},null,8,["is-open","document"])):F("",!0),Ie.value?(n(),re(wt,{key:6,"is-visible":Ie.value,document:Fe.value,"card-type":"lawyer",context:"table","user-store":t(u),onClose:b[21]||(b[21]=N=>Ie.value=!1),onAction:es},null,8,["is-visible","document","user-store"])):F("",!0)]))])}}},ld=xt(ad,[["__scopeId","data-v-20a3a659"]]),id={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},dd={class:"mb-4"},cd={class:"relative w-full"},ud={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},md={class:"flex items-center gap-2 min-w-0"},gd={class:"truncate"},pd={class:"py-1"},hd=["onClick"],fd={class:"flex items-center justify-stretch"},vd=e("span",null,"Limpiar",-1),bd={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},yd={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},xd={class:"flex items-center gap-2"},_d=e("span",{class:"hidden sm:inline"},"Exportar",-1),wd={class:"py-1"},$d=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),kd={class:"py-1"},Cd={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Dd={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Sd={class:"min-w-full divide-y divide-gray-200"},Fd={class:"bg-gray-50"},Ed={scope:"col",class:"w-12 px-6 py-3"},Td=["checked"],Ad=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Md=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),Pd=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),Ld=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),Id={class:"bg-white divide-y divide-gray-200"},jd=["onClick"],Bd=["checked","onChange"],Ud={class:"px-6 py-4 whitespace-nowrap"},zd={class:"flex items-center"},Nd={class:"flex-shrink-0 h-10 w-10"},Od={class:"h-10 w-10 rounded-lg bg-green-100 flex items-center justify-center"},Rd={class:"ml-4"},qd={class:"text-sm font-medium text-gray-900"},Vd={class:"px-6 py-4 whitespace-nowrap"},Qd={class:"text-sm text-gray-900"},Wd=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-700 border border-green-200"}," Completado ")],-1),Gd={class:"px-6 py-4 whitespace-nowrap"},Hd={class:"flex flex-wrap gap-1"},Zd={key:0,class:"text-sm text-gray-400"},Jd={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Kd={class:"flex flex-1 justify-between sm:hidden"},Yd=["disabled"],Xd=["disabled"],ec={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},tc={class:"text-sm text-gray-700"},sc={class:"font-medium"},oc={class:"font-medium"},nc={class:"font-medium"},rc={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},ac=["disabled"],lc=e("span",{class:"sr-only"},"Anterior",-1),ic=["onClick"],dc={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},cc=["disabled"],uc=e("span",{class:"sr-only"},"Siguiente",-1),mc={key:0,class:"text-center py-12"},gc=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos completados",-1),pc=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos completados por clientes aparecerán aquí.",-1),hc={__name:"DocumentFinishedByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(l,{emit:v}){const c=qe(),u=Je(),S=et(),C=l,m=v,{activeModals:D,openModal:_,closeModal:T,getUserRole:te}=vt(c,u),{handlePreviewDocument:Q,deleteDocument:K,downloadPDFDocument:Y,downloadWordDocument:le}=bt(c,u,m),G=y(""),x=y(null),d=y("recent"),h=y([]),p=y(1),oe=y(10);Oe(()=>{c.init(),u.init()});const k=L(()=>{const r=c.completedDocumentsByClient,s=C.selectedTags?C.selectedTags.map(z=>z.id):[];return c.filteredDocumentsBySearchAndTags(C.searchQuery,u,s).filter(z=>r.some(pe=>pe.id===z.id))}),g=L(()=>{let r=[...k.value];const s=G.value.toLowerCase();return s&&(r=r.filter(a=>{var z,pe;return((z=a.title)==null?void 0:z.toLowerCase().includes(s))||((pe=a.tags)==null?void 0:pe.some(_e=>{var Ve;return(Ve=_e.name)==null?void 0:Ve.toLowerCase().includes(s)}))})),x.value&&(r=r.filter(a=>a.tags&&a.tags.some(z=>z.id===x.value))),d.value==="name"?r.sort((a,z)=>{const pe=(a.title||"").toLowerCase(),_e=(z.title||"").toLowerCase();return pe.localeCompare(_e)}):d.value==="recent"&&r.sort((a,z)=>z.id-a.id),r}),A=L(()=>{const r=(p.value-1)*oe.value,s=r+oe.value;return g.value.slice(r,s)}),B=L(()=>Math.ceil(g.value.length/oe.value)),E=L(()=>{const r=(p.value-1)*oe.value+1,s=Math.min(p.value*oe.value,g.value.length);return{start:r,end:s,total:g.value.length}});we([G,x],()=>{p.value=1});const j=L(()=>{const r=new Map;return k.value.forEach(s=>{s.tags&&s.tags.length>0&&s.tags.forEach(a=>{r.has(a.id)||r.set(a.id,a)})}),Array.from(r.values()).sort((s,a)=>s.name.localeCompare(a.name))}),ae=L(()=>{if(!x.value)return null;const r=j.value.find(s=>s.id===x.value);return r?r.name:null}),se=L(()=>{switch(d.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),O=r=>r.client_name?r.client_name:r.client?`${r.client.first_name||""} ${r.client.last_name||""}`.trim():"Cliente",ce=r=>{const s=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],a=r.id%s.length;return s[a]},ye=L(()=>g.value.length>0&&h.value.length===g.value.length),ve=()=>{ye.value?h.value=[]:h.value=g.value.map(r=>r.id)},U=r=>{const s=h.value.indexOf(r);s>-1?h.value.splice(s,1):h.value.push(r)},J=()=>{h.value=g.value.map(r=>r.id)},q=()=>{h.value=[]},ne=()=>{x.value=null},ge=()=>{p.value>1&&p.value--},he=()=>{p.value<B.value&&p.value++},xe=r=>{r>=1&&r<=B.value&&(p.value=r)},je=L(()=>{const r=B.value,s=p.value,a=[];if(r<=7)for(let z=1;z<=r;z++)a.push(z);else if(s<=4){for(let z=1;z<=5;z++)a.push(z);a.push("..."),a.push(r)}else if(s>=r-3){a.push(1),a.push("...");for(let z=r-4;z<=r;z++)a.push(z)}else a.push(1),a.push("..."),a.push(s-1),a.push(s),a.push(s+1),a.push("..."),a.push(r);return a}),Ee=()=>{const r=h.value.length>0?g.value.filter(Se=>h.value.includes(Se.id)):g.value,s=["Nombre Documento","Cliente","Estado","Etiquetas"],a=r.map(Se=>[Se.title||"",O(Se),"Completado",Se.tags?Se.tags.map(We=>We.name).join(", "):""]),z=[s.join(","),...a.map(Se=>Se.map(We=>`"${We}"`).join(","))].join(`
`),pe=new Blob([z],{type:"text/csv;charset=utf-8;"}),_e=document.createElement("a"),Ve=URL.createObjectURL(pe);_e.setAttribute("href",Ve),_e.setAttribute("download",`documentos_completados_${new Date().toISOString().split("T")[0]}.csv`),_e.style.visibility="hidden",document.body.appendChild(_e),_e.click(),document.body.removeChild(_e)},Be=async(r,s)=>{try{switch(r){case"editForm":_("edit",s,{userRole:te()});break;case"editDocument":S.push(`/dynamic_document_dashboard/client/editor/edit/${s.id}`);break;case"preview":await Q(s);break;case"delete":await K(s);break;case"letterhead":_("letterhead",s);break;case"relationships":_("relationships",s);break;case"downloadPDF":await Y(s);break;case"downloadWord":await le(s);break;case"email":_("email",s);break;default:console.warn("Unknown action:",r)}}catch(a){console.error(`Error executing action ${r}:`,a)}},R=y(!1),I=y(null),W=r=>{I.value=r,R.value=!0},P=async(r,s)=>{R.value=!1,await Be(r,s)};return(r,s)=>(n(),i("div",null,[e("div",id,[e("div",dd,[e("div",cd,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>G.value=a),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Re,G.value]])])]),e("div",ud,[o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:w(()=>[e("div",md,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",gd,f(ae.value||"Etiqueta"),1)]),o(t(Ne),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Me),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:w(()=>[e("div",pd,[o(t(ue),null,{default:w(({active:a})=>[e("a",{onClick:s[1]||(s[1]=z=>x.value=null),class:$([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(n(!0),i(de,null,me(j.value,a=>(n(),re(t(ue),{key:a.id},{default:w(({active:z})=>[e("a",{onClick:pe=>x.value=a.id,class:$([z?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},f(a.name),11,hd)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",fd,[x.value?(n(),i("button",{key:0,onClick:ne,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(Ue),{class:"h-4 w-4 flex-shrink-0"}),vd])):F("",!0)])]),e("div",bd,[e("div",yd,[e("div",xd,[e("button",{onClick:Ee,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[o(t(tt),{class:"h-4 w-4"}),_d]),o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:w(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",wd,[o(t(ue),null,{default:w(({active:a})=>[e("a",{onClick:J,class:$([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),o(t(ue),null,{default:w(({active:a})=>[e("a",{onClick:q,class:$([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:w(()=>[$d,ee(" "+f(se.value)+" ",1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",kd,[o(t(ue),null,{default:w(({active:a})=>[e("a",{onClick:s[2]||(s[2]=z=>d.value="recent"),class:$([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:w(({active:a})=>[e("a",{onClick:s[3]||(s[3]=z=>d.value="name"),class:$([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Cd,[e("div",Dd,[e("table",Sd,[e("thead",Fd,[e("tr",null,[e("th",Ed,[e("input",{type:"checkbox",checked:ye.value,onChange:ve,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Td)]),Ad,Md,Pd,Ld])]),e("tbody",Id,[(n(!0),i(de,null,me(A.value,(a,z)=>(n(),i("tr",{key:a.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:pe=>W(a)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:s[4]||(s[4]=fe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:h.value.includes(a.id),onChange:pe=>U(a.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Bd)]),e("td",Ud,[e("div",zd,[e("div",Nd,[e("div",Od,[o(t(Qe),{class:"h-5 w-5 text-green-600"})])]),e("div",Rd,[e("div",qd,f(a.title),1)])])]),e("td",Vd,[e("div",Qd,f(O(a)),1)]),Wd,e("td",Gd,[e("div",Hd,[(n(!0),i(de,null,me(a.tags,pe=>(n(),i("span",{key:pe.id,class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ce(pe)])},f(pe.name),3))),128)),!a.tags||a.tags.length===0?(n(),i("span",Zd,"-")):F("",!0)])])],8,jd))),128))])])]),B.value>1?(n(),i("div",Jd,[e("div",Kd,[e("button",{onClick:ge,disabled:p.value===1,class:$(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",p.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,Yd),e("button",{onClick:he,disabled:p.value===B.value,class:$(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",p.value===B.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Xd)]),e("div",ec,[e("div",null,[e("p",tc,[ee(" Mostrando "),e("span",sc,f(E.value.start),1),ee(" a "),e("span",oc,f(E.value.end),1),ee(" de "),e("span",nc,f(E.value.total),1),ee(" resultados ")])]),e("div",null,[e("nav",rc,[e("button",{onClick:ge,disabled:p.value===1,class:$(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",p.value===1?"opacity-50 cursor-not-allowed":""])},[lc,o(t(ht),{class:"h-5 w-5","aria-hidden":"true"})],10,ac),(n(!0),i(de,null,me(je.value,a=>(n(),i(de,{key:a},[a!=="..."?(n(),i("button",{key:0,onClick:z=>xe(a),class:$(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",p.value===a?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},f(a),11,ic)):(n(),i("span",dc," ... "))],64))),128)),e("button",{onClick:he,disabled:p.value===B.value,class:$(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",p.value===B.value?"opacity-50 cursor-not-allowed":""])},[uc,o(t(at),{class:"h-5 w-5","aria-hidden":"true"})],10,cc)])])])])):F("",!0)]),g.value.length===0?(n(),i("div",mc,[o(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),gc,pc])):F("",!0),(n(),re(ft,{to:"body"},[t(D).edit.isOpen?(n(),re(t(St),{key:0,document:t(D).edit.document,"user-role":t(te)(),onClose:s[5]||(s[5]=a=>t(T)("edit")),onRefresh:s[6]||(s[6]=a=>m("refresh"))},null,8,["document","user-role"])):F("",!0),t(D).email.isOpen?(n(),re(t(Ft),{key:1,document:t(D).email.document,onClose:s[7]||(s[7]=a=>t(T)("email"))},null,8,["document"])):F("",!0),t(D).letterhead.isOpen?(n(),re(yt,{key:2,"is-visible":t(D).letterhead.isOpen,document:t(D).letterhead.document,onClose:s[8]||(s[8]=a=>t(T)("letterhead")),onUploaded:s[9]||(s[9]=a=>m("refresh")),onDeleted:s[10]||(s[10]=a=>m("refresh"))},null,8,["is-visible","document"])):F("",!0),t(D).relationships.isOpen?(n(),re(Et,{key:3,"is-open":t(D).relationships.isOpen,document:t(D).relationships.document,onClose:s[11]||(s[11]=a=>t(T)("relationships")),onRefresh:s[12]||(s[12]=a=>m("refresh"))},null,8,["is-open","document"])):F("",!0),R.value?(n(),re(wt,{key:4,"is-visible":R.value,document:I.value,"card-type":"client",context:"table","user-store":t(u),onClose:s[13]||(s[13]=a=>R.value=!1),onAction:P},null,8,["is-visible","document","user-store"])):F("",!0)]))]))}},fc={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},vc={class:"mb-4"},bc={class:"relative w-full"},yc={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},xc={class:"flex items-center gap-2 min-w-0"},_c={class:"truncate"},wc={class:"py-1"},$c=["onClick"],kc={class:"flex items-center justify-stretch"},Cc=e("span",null,"Limpiar",-1),Dc={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},Sc={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Fc={class:"flex items-center gap-2"},Ec=e("span",{class:"hidden sm:inline"},"Exportar",-1),Tc={class:"py-1"},Ac=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),Mc={class:"py-1"},Pc={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Lc={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Ic={class:"min-w-full divide-y divide-gray-200"},jc={class:"bg-gray-50"},Bc={scope:"col",class:"w-12 px-6 py-3"},Uc=["checked"],zc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Nc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),Oc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),Rc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),qc={class:"bg-white divide-y divide-gray-200"},Vc=["onClick"],Qc=["checked","onChange"],Wc={class:"px-6 py-4 whitespace-nowrap"},Gc={class:"flex items-center"},Hc={class:"flex-shrink-0 h-10 w-10"},Zc={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Jc={class:"ml-4"},Kc={class:"text-sm font-medium text-gray-900"},Yc={class:"px-6 py-4 whitespace-nowrap"},Xc={class:"text-sm text-gray-900"},eu=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-700 border border-blue-200"}," En Progreso ")],-1),tu={class:"px-6 py-4 whitespace-nowrap"},su={class:"flex flex-wrap gap-1"},ou={key:0,class:"text-sm text-gray-400"},nu={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},ru={class:"flex flex-1 justify-between sm:hidden"},au=["disabled"],lu=["disabled"],iu={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},du={class:"text-sm text-gray-700"},cu={class:"font-medium"},uu={class:"font-medium"},mu={class:"font-medium"},gu={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},pu=["disabled"],hu=e("span",{class:"sr-only"},"Anterior",-1),fu=["onClick"],vu={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},bu=["disabled"],yu=e("span",{class:"sr-only"},"Siguiente",-1),xu={key:0,class:"text-center py-12"},_u=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos en progreso",-1),wu=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos en progreso por clientes aparecerán aquí.",-1),$u={__name:"DocumentInProgressByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(l,{emit:v}){const c=qe(),u=Je(),S=et(),C=l,m=v,{activeModals:D,openModal:_,closeModal:T,getUserRole:te}=vt(c,u),{handlePreviewDocument:Q,deleteDocument:K,downloadPDFDocument:Y,downloadWordDocument:le}=bt(c,u,m),G=y(""),x=y(null),d=y("recent"),h=y([]),p=y(1),oe=y(10);Oe(()=>{c.init(),u.init()});const k=L(()=>{const r=c.progressDocumentsByClient,s=C.selectedTags?C.selectedTags.map(z=>z.id):[];return c.filteredDocumentsBySearchAndTags(C.searchQuery,u,s).filter(z=>r.some(pe=>pe.id===z.id))}),g=L(()=>{let r=[...k.value];const s=G.value.toLowerCase();return s&&(r=r.filter(a=>{var z,pe;return((z=a.title)==null?void 0:z.toLowerCase().includes(s))||((pe=a.tags)==null?void 0:pe.some(_e=>{var Ve;return(Ve=_e.name)==null?void 0:Ve.toLowerCase().includes(s)}))})),x.value&&(r=r.filter(a=>a.tags&&a.tags.some(z=>z.id===x.value))),d.value==="name"?r.sort((a,z)=>{const pe=(a.title||"").toLowerCase(),_e=(z.title||"").toLowerCase();return pe.localeCompare(_e)}):d.value==="recent"&&r.sort((a,z)=>z.id-a.id),r}),A=L(()=>{const r=(p.value-1)*oe.value,s=r+oe.value;return g.value.slice(r,s)}),B=L(()=>Math.ceil(g.value.length/oe.value)),E=L(()=>{const r=(p.value-1)*oe.value+1,s=Math.min(p.value*oe.value,g.value.length);return{start:r,end:s,total:g.value.length}});we([G,x],()=>{p.value=1});const j=L(()=>{const r=new Map;return k.value.forEach(s=>{s.tags&&s.tags.length>0&&s.tags.forEach(a=>{r.has(a.id)||r.set(a.id,a)})}),Array.from(r.values()).sort((s,a)=>s.name.localeCompare(a.name))}),ae=L(()=>{if(!x.value)return null;const r=j.value.find(s=>s.id===x.value);return r?r.name:null}),se=L(()=>{switch(d.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),O=r=>r.client_name?r.client_name:r.client?`${r.client.first_name||""} ${r.client.last_name||""}`.trim():"Cliente",ce=r=>{const s=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],a=r.id%s.length;return s[a]},ye=L(()=>g.value.length>0&&h.value.length===g.value.length),ve=()=>{ye.value?h.value=[]:h.value=g.value.map(r=>r.id)},U=r=>{const s=h.value.indexOf(r);s>-1?h.value.splice(s,1):h.value.push(r)},J=()=>{h.value=g.value.map(r=>r.id)},q=()=>{h.value=[]},ne=()=>{x.value=null},ge=()=>{p.value>1&&p.value--},he=()=>{p.value<B.value&&p.value++},xe=r=>{r>=1&&r<=B.value&&(p.value=r)},je=L(()=>{const r=B.value,s=p.value,a=[];if(r<=7)for(let z=1;z<=r;z++)a.push(z);else if(s<=4){for(let z=1;z<=5;z++)a.push(z);a.push("..."),a.push(r)}else if(s>=r-3){a.push(1),a.push("...");for(let z=r-4;z<=r;z++)a.push(z)}else a.push(1),a.push("..."),a.push(s-1),a.push(s),a.push(s+1),a.push("..."),a.push(r);return a}),Ee=()=>{const r=h.value.length>0?g.value.filter(Se=>h.value.includes(Se.id)):g.value,s=["Nombre Documento","Cliente","Estado","Etiquetas"],a=r.map(Se=>[Se.title||"",O(Se),"En Progreso",Se.tags?Se.tags.map(We=>We.name).join(", "):""]),z=[s.join(","),...a.map(Se=>Se.map(We=>`"${We}"`).join(","))].join(`
`),pe=new Blob([z],{type:"text/csv;charset=utf-8;"}),_e=document.createElement("a"),Ve=URL.createObjectURL(pe);_e.setAttribute("href",Ve),_e.setAttribute("download",`documentos_en_progreso_${new Date().toISOString().split("T")[0]}.csv`),_e.style.visibility="hidden",document.body.appendChild(_e),_e.click(),document.body.removeChild(_e)},Be=async(r,s)=>{try{switch(r){case"editForm":_("edit",s,{userRole:te()});break;case"editDocument":S.push(`/dynamic_document_dashboard/client/editor/edit/${s.id}`);break;case"preview":await Q(s);break;case"delete":await K(s);break;case"letterhead":_("letterhead",s);break;case"relationships":_("relationships",s);break;case"downloadPDF":await Y(s);break;case"downloadWord":await le(s);break;case"email":_("email",s);break;default:console.warn("Unknown action:",r)}}catch(a){console.error(`Error executing action ${r}:`,a)}},R=y(!1),I=y(null),W=r=>{I.value=r,R.value=!0},P=async(r,s)=>{R.value=!1,await Be(r,s)};return(r,s)=>(n(),i("div",null,[e("div",fc,[e("div",vc,[e("div",bc,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>G.value=a),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Re,G.value]])])]),e("div",yc,[o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:w(()=>[e("div",xc,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",_c,f(ae.value||"Etiqueta"),1)]),o(t(Ne),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Me),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:w(()=>[e("div",wc,[o(t(ue),null,{default:w(({active:a})=>[e("a",{onClick:s[1]||(s[1]=z=>x.value=null),class:$([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(n(!0),i(de,null,me(j.value,a=>(n(),re(t(ue),{key:a.id},{default:w(({active:z})=>[e("a",{onClick:pe=>x.value=a.id,class:$([z?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},f(a.name),11,$c)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",kc,[x.value?(n(),i("button",{key:0,onClick:ne,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(Ue),{class:"h-4 w-4 flex-shrink-0"}),Cc])):F("",!0)])]),e("div",Dc,[e("div",Sc,[e("div",Fc,[e("button",{onClick:Ee,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[o(t(tt),{class:"h-4 w-4"}),Ec]),o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:w(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",Tc,[o(t(ue),null,{default:w(({active:a})=>[e("a",{onClick:J,class:$([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),o(t(ue),null,{default:w(({active:a})=>[e("a",{onClick:q,class:$([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:w(()=>[Ac,ee(" "+f(se.value)+" ",1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",Mc,[o(t(ue),null,{default:w(({active:a})=>[e("a",{onClick:s[2]||(s[2]=z=>d.value="recent"),class:$([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:w(({active:a})=>[e("a",{onClick:s[3]||(s[3]=z=>d.value="name"),class:$([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Pc,[e("div",Lc,[e("table",Ic,[e("thead",jc,[e("tr",null,[e("th",Bc,[e("input",{type:"checkbox",checked:ye.value,onChange:ve,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Uc)]),zc,Nc,Oc,Rc])]),e("tbody",qc,[(n(!0),i(de,null,me(A.value,(a,z)=>(n(),i("tr",{key:a.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:pe=>W(a)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:s[4]||(s[4]=fe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:h.value.includes(a.id),onChange:pe=>U(a.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Qc)]),e("td",Wc,[e("div",Gc,[e("div",Hc,[e("div",Zc,[o(t(Qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",Jc,[e("div",Kc,f(a.title),1)])])]),e("td",Yc,[e("div",Xc,f(O(a)),1)]),eu,e("td",tu,[e("div",su,[(n(!0),i(de,null,me(a.tags,pe=>(n(),i("span",{key:pe.id,class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ce(pe)])},f(pe.name),3))),128)),!a.tags||a.tags.length===0?(n(),i("span",ou,"-")):F("",!0)])])],8,Vc))),128))])])]),B.value>1?(n(),i("div",nu,[e("div",ru,[e("button",{onClick:ge,disabled:p.value===1,class:$(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",p.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,au),e("button",{onClick:he,disabled:p.value===B.value,class:$(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",p.value===B.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,lu)]),e("div",iu,[e("div",null,[e("p",du,[ee(" Mostrando "),e("span",cu,f(E.value.start),1),ee(" a "),e("span",uu,f(E.value.end),1),ee(" de "),e("span",mu,f(E.value.total),1),ee(" resultados ")])]),e("div",null,[e("nav",gu,[e("button",{onClick:ge,disabled:p.value===1,class:$(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",p.value===1?"opacity-50 cursor-not-allowed":""])},[hu,o(t(ht),{class:"h-5 w-5","aria-hidden":"true"})],10,pu),(n(!0),i(de,null,me(je.value,a=>(n(),i(de,{key:a},[a!=="..."?(n(),i("button",{key:0,onClick:z=>xe(a),class:$(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",p.value===a?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},f(a),11,fu)):(n(),i("span",vu," ... "))],64))),128)),e("button",{onClick:he,disabled:p.value===B.value,class:$(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",p.value===B.value?"opacity-50 cursor-not-allowed":""])},[yu,o(t(at),{class:"h-5 w-5","aria-hidden":"true"})],10,bu)])])])])):F("",!0)]),g.value.length===0?(n(),i("div",xu,[o(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),_u,wu])):F("",!0),(n(),re(ft,{to:"body"},[t(D).edit.isOpen?(n(),re(t(St),{key:0,document:t(D).edit.document,"user-role":t(te)(),onClose:s[5]||(s[5]=a=>t(T)("edit")),onRefresh:s[6]||(s[6]=a=>m("refresh"))},null,8,["document","user-role"])):F("",!0),t(D).email.isOpen?(n(),re(t(Ft),{key:1,document:t(D).email.document,onClose:s[7]||(s[7]=a=>t(T)("email"))},null,8,["document"])):F("",!0),t(D).letterhead.isOpen?(n(),re(yt,{key:2,"is-visible":t(D).letterhead.isOpen,document:t(D).letterhead.document,onClose:s[8]||(s[8]=a=>t(T)("letterhead")),onUploaded:s[9]||(s[9]=a=>m("refresh")),onDeleted:s[10]||(s[10]=a=>m("refresh"))},null,8,["is-visible","document"])):F("",!0),t(D).relationships.isOpen?(n(),re(Et,{key:3,"is-open":t(D).relationships.isOpen,document:t(D).relationships.document,onClose:s[11]||(s[11]=a=>t(T)("relationships")),onRefresh:s[12]||(s[12]=a=>m("refresh"))},null,8,["is-open","document"])):F("",!0),R.value?(n(),re(wt,{key:4,"is-visible":R.value,document:I.value,"card-type":"client",context:"table","user-store":t(u),onClose:s[13]||(s[13]=a=>R.value=!1),onAction:P},null,8,["is-visible","document","user-store"])):F("",!0)]))]))}},ku={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},Cu={class:"mb-4"},Du={class:"relative w-full"},Su={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},Fu={class:"flex items-center gap-2 min-w-0"},Eu={class:"truncate"},Tu={class:"p-2"},Au={class:"relative mb-2"},Mu={class:"max-h-60 overflow-y-auto"},Pu=["onClick"],Lu={class:"truncate"},Iu={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},ju={class:"flex items-center justify-stretch"},Bu=e("span",null,"Limpiar",-1),Uu={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},zu={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Nu={class:"flex items-center gap-2"},Ou=e("span",{class:"hidden sm:inline"},"Exportar",-1),Ru={class:"py-1"},qu=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),Vu={class:"py-1"},Qu={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Wu={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Gu={class:"min-w-full divide-y divide-gray-200"},Hu={class:"bg-gray-50"},Zu={scope:"col",class:"w-12 px-6 py-3"},Ju=["checked"],Ku=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Yu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado Firma ",-1),Xu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),em={class:"bg-white divide-y divide-gray-200"},tm=["onClick"],sm=["checked","onChange"],om={class:"px-6 py-4 whitespace-nowrap"},nm={class:"flex items-center"},rm={class:"flex-shrink-0 h-10 w-10"},am={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},lm={class:"ml-4"},im={class:"text-sm font-medium text-gray-900"},dm={class:"px-6 py-4 whitespace-nowrap"},cm={class:"px-6 py-4 whitespace-nowrap"},um={class:"flex flex-wrap gap-1"},mm={key:0,class:"text-sm text-gray-400"},gm={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},pm={class:"flex flex-1 justify-between sm:hidden"},hm=["disabled"],fm=["disabled"],vm={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},bm={class:"text-sm text-gray-700"},ym={class:"font-medium"},xm={class:"font-medium"},_m={class:"font-medium"},wm={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},$m=["disabled"],km=e("span",{class:"sr-only"},"Anterior",-1),Cm=["onClick"],Dm={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},Sm=["disabled"],Fm=e("span",{class:"sr-only"},"Siguiente",-1),Em={key:0,class:"text-center py-12"},Tm={class:"mt-2 text-sm font-medium text-gray-900"},Am={class:"mt-1 text-sm text-gray-500"},Mm={key:1,class:"text-center py-12"},Pm=e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-secondary"},null,-1),Lm=e("p",{class:"mt-2 text-sm text-gray-500"},"Cargando documentos...",-1),Im=[Pm,Lm],kt={__name:"SignaturesListTable",props:{state:{type:String,required:!0,validator:l=>["PendingSignatures","FullySigned"].includes(l)},searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","document-fully-signed","open-electronic-signature"],setup(l,{expose:v,emit:c}){const u=l,S=c,C=Je(),m=qe();et();const{activeModals:D,openModal:_,closeModal:T,getUserRole:te}=vt(m,C),{handlePreviewDocument:Q,downloadPDFDocument:K,signDocument:Y,downloadSignedDocument:le}=bt(m,C,S);y([]);const G=y(!1),x=y(""),d=y(""),h=y(null),p=y("recent"),oe=y([]),k=y(1),g=y(10),A=L(()=>u.state==="PendingSignatures"?"No tienes documentos pendientes por firmar":"No tienes documentos firmados"),B=L(()=>u.state==="PendingSignatures"?"Cuando tengas documentos que requieran tu firma electrónica aparecerán aquí.":"Una vez que firmes documentos electrónicamente, aparecerán aquí."),E=L(()=>{const X=C.currentUser.role,V=C.currentUser.id,ie=C.currentUser.email;let Z=[];return X==="lawyer"?u.state==="PendingSignatures"?Z=m.pendingSignatureDocuments.filter(be=>{var Fe;const $e=be.created_by===V,Ie=(Fe=be.signatures)==null?void 0:Fe.some(ze=>ze.signer_email===ie);return $e||Ie}):Z=m.fullySignedDocuments.filter(be=>{var Fe;const $e=be.created_by===V,Ie=(Fe=be.signatures)==null?void 0:Fe.some(ze=>ze.signer_email===ie&&ze.signed);return $e||Ie}):u.state==="PendingSignatures"?Z=m.documents.filter(be=>{var Fe;if(be.state!=="PendingSignatures")return!1;const $e=(Fe=be.signatures)==null?void 0:Fe.some(ze=>ze.signer_email===ie),Ie=be.created_by===V;return $e||Ie}):Z=m.documents.filter(be=>{var Fe;if(be.state!=="FullySigned")return!1;const $e=(Fe=be.signatures)==null?void 0:Fe.some(ze=>ze.signer_email===ie&&ze.signed),Ie=be.created_by===V;return $e||Ie}),Z}),j=L(()=>{let X=[...E.value];const V=x.value.toLowerCase();return V&&(X=X.filter(ie=>{var Z,be;return((Z=ie.title)==null?void 0:Z.toLowerCase().includes(V))||((be=ie.tags)==null?void 0:be.some($e=>{var Ie;return(Ie=$e.name)==null?void 0:Ie.toLowerCase().includes(V)}))})),h.value&&(X=X.filter(ie=>ie.tags&&ie.tags.some(Z=>Z.id===h.value))),p.value==="name"?X.sort((ie,Z)=>{const be=(ie.title||"").toLowerCase(),$e=(Z.title||"").toLowerCase();return be.localeCompare($e)}):p.value==="recent"&&X.sort((ie,Z)=>Z.id-ie.id),X}),ae=L(()=>{const X=(k.value-1)*g.value,V=X+g.value;return j.value.slice(X,V)}),se=L(()=>Math.ceil(j.value.length/g.value)),O=L(()=>{const X=(k.value-1)*g.value+1,V=Math.min(k.value*g.value,j.value.length);return{start:X,end:V,total:j.value.length}});we([x,h],()=>{k.value=1});const ce=L(()=>{const X=new Map;return E.value.forEach(V=>{V.tags&&V.tags.length>0&&V.tags.forEach(ie=>{X.has(ie.id)||X.set(ie.id,ie)})}),Array.from(X.values()).sort((V,ie)=>V.name.localeCompare(ie.name))}),ye=L(()=>{if(!d.value)return ce.value;const X=d.value.toLowerCase();return ce.value.filter(V=>V.name.toLowerCase().includes(X))}),ve=L(()=>{if(!h.value)return null;const X=ce.value.find(V=>V.id===h.value);return X?X.name:null}),U=X=>{const V=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],ie=X.id%V.length;return V[ie]},J=L(()=>{switch(p.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),q=X=>{const V=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],ie=X.id%V.length;return V[ie]},ne=X=>u.state==="FullySigned"?"bg-green-100 text-green-700 border border-green-200":"bg-yellow-100 text-yellow-700 border border-yellow-200",ge=X=>u.state==="FullySigned"?"Firmado":"Pendiente",he=L(()=>j.value.length>0&&oe.value.length===j.value.length),xe=()=>{he.value?oe.value=[]:oe.value=j.value.map(X=>X.id)},je=X=>{const V=oe.value.indexOf(X);V>-1?oe.value.splice(V,1):oe.value.push(X)},Ee=()=>{oe.value=j.value.map(X=>X.id)},Be=()=>{oe.value=[]},R=()=>{h.value=null},I=()=>{k.value>1&&k.value--},W=()=>{k.value<se.value&&k.value++},P=X=>{X>=1&&X<=se.value&&(k.value=X)},r=L(()=>{const X=se.value,V=k.value,ie=[];if(X<=7)for(let Z=1;Z<=X;Z++)ie.push(Z);else if(V<=4){for(let Z=1;Z<=5;Z++)ie.push(Z);ie.push("..."),ie.push(X)}else if(V>=X-3){ie.push(1),ie.push("...");for(let Z=X-4;Z<=X;Z++)ie.push(Z)}else ie.push(1),ie.push("..."),ie.push(V-1),ie.push(V),ie.push(V+1),ie.push("..."),ie.push(X);return ie}),s=()=>{const X=oe.value.length>0?j.value.filter(Fe=>oe.value.includes(Fe.id)):j.value,V=["Nombre Documento","Estado Firma","Etiquetas"],ie=X.map(Fe=>[Fe.title||"",ge(),Fe.tags?Fe.tags.map(ze=>ze.name).join(", "):""]),Z=[V.join(","),...ie.map(Fe=>Fe.map(ze=>`"${ze}"`).join(","))].join(`
`),be=new Blob([Z],{type:"text/csv;charset=utf-8;"}),$e=document.createElement("a"),Ie=URL.createObjectURL(be);$e.setAttribute("href",Ie),$e.setAttribute("download",`documentos_firmas_${new Date().toISOString().split("T")[0]}.csv`),$e.style.visibility="hidden",document.body.appendChild($e),$e.click(),document.body.removeChild($e)},a=y(!1),z=y(null),pe=X=>{z.value=X,a.value=!0},_e=async(X,V)=>{a.value=!1,await Ve(X,V)},Ve=async(X,V)=>{try{switch(X){case"preview":await Q(V);break;case"letterhead":_("letterhead",V);break;case"viewSignatures":_("signatures",V);break;case"sign":await Y(V,_);break;case"downloadSignedDocument":await le(V);break;case"downloadPDF":await K(V);break;default:console.warn("Unknown action:",X)}}catch(ie){console.error(`Error executing action ${X}:`,ie)}},Se=async()=>{G.value=!0;try{await m.init(!0)}catch(X){console.error("Error refreshing documents:",X),De("Error al actualizar documentos","error")}finally{G.value=!1}},We=async()=>{await Se(),S("refresh")};return Oe(async()=>{await Se()}),v({refresh:We}),we(()=>C.currentUser,()=>{We()}),(X,V)=>{var ie;return n(),i("div",null,[e("div",ku,[e("div",Cu,[e("div",Du,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":V[0]||(V[0]=Z=>x.value=Z),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Re,x.value]])])]),e("div",Su,[o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:w(()=>[e("div",Fu,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",Eu,f(ve.value||"Etiqueta"),1)]),o(t(Ne),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Me),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",Tu,[e("div",Au,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":V[1]||(V[1]=Z=>d.value=Z),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:V[2]||(V[2]=fe(()=>{},["stop"]))},null,512),[[Re,d.value]])]),e("div",Mu,[o(t(ue),null,{default:w(({active:Z})=>[e("a",{onClick:V[3]||(V[3]=be=>h.value=null),class:$([Z?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(n(!0),i(de,null,me(ye.value,Z=>(n(),re(t(ue),{key:Z.id},{default:w(({active:be})=>[e("a",{onClick:$e=>h.value=Z.id,class:$([be?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:$(["w-3 h-3 rounded-full flex-shrink-0",U(Z)])},null,2),e("span",Lu,f(Z.name),1)],10,Pu)]),_:2},1024))),128)),ye.value.length===0?(n(),i("div",Iu," No se encontraron etiquetas ")):F("",!0)])])]),_:1})]),_:1}),e("div",ju,[h.value?(n(),i("button",{key:0,onClick:R,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(Ue),{class:"h-4 w-4 flex-shrink-0"}),Bu])):F("",!0)])]),e("div",Uu,[e("div",zu,[e("div",Nu,[e("button",{onClick:s,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[o(t(tt),{class:"h-4 w-4"}),Ou]),o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:w(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",Ru,[o(t(ue),null,{default:w(({active:Z})=>[e("a",{onClick:Ee,class:$([Z?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),o(t(ue),null,{default:w(({active:Z})=>[e("a",{onClick:Be,class:$([Z?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),o(t(Te),{as:"div",class:"relative"},{default:w(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:w(()=>[qu,ee(" "+f(J.value)+" ",1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:w(()=>[e("div",Vu,[o(t(ue),null,{default:w(({active:Z})=>[e("a",{onClick:V[4]||(V[4]=be=>p.value="recent"),class:$([Z?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:w(({active:Z})=>[e("a",{onClick:V[5]||(V[5]=be=>p.value="name"),class:$([Z?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Qu,[e("div",Wu,[e("table",Gu,[e("thead",Hu,[e("tr",null,[e("th",Zu,[e("input",{type:"checkbox",checked:he.value,onChange:xe,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Ju)]),Ku,Yu,Xu])]),e("tbody",em,[(n(!0),i(de,null,me(ae.value,(Z,be)=>(n(),i("tr",{key:Z.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:$e=>pe(Z)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:V[6]||(V[6]=fe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:oe.value.includes(Z.id),onChange:$e=>je(Z.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,sm)]),e("td",om,[e("div",nm,[e("div",rm,[e("div",am,[o(t(Qe),{class:"h-5 w-5 text-purple-600"})])]),e("div",lm,[e("div",im,f(Z.title),1)])])]),e("td",dm,[e("span",{class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ne()])},f(ge()),3)]),e("td",cm,[e("div",um,[(n(!0),i(de,null,me(Z.tags,$e=>(n(),i("span",{key:$e.id,class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",q($e)])},f($e.name),3))),128)),!Z.tags||Z.tags.length===0?(n(),i("span",mm,"-")):F("",!0)])])],8,tm))),128))])])]),se.value>1?(n(),i("div",gm,[e("div",pm,[e("button",{onClick:I,disabled:k.value===1,class:$(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",k.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,hm),e("button",{onClick:W,disabled:k.value===se.value,class:$(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",k.value===se.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,fm)]),e("div",vm,[e("div",null,[e("p",bm,[ee(" Mostrando "),e("span",ym,f(O.value.start),1),ee(" a "),e("span",xm,f(O.value.end),1),ee(" de "),e("span",_m,f(O.value.total),1),ee(" resultados ")])]),e("div",null,[e("nav",wm,[e("button",{onClick:I,disabled:k.value===1,class:$(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",k.value===1?"opacity-50 cursor-not-allowed":""])},[km,o(t(ht),{class:"h-5 w-5","aria-hidden":"true"})],10,$m),(n(!0),i(de,null,me(r.value,Z=>(n(),i(de,{key:Z},[Z!=="..."?(n(),i("button",{key:0,onClick:be=>P(Z),class:$(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",k.value===Z?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},f(Z),11,Cm)):(n(),i("span",Dm," ... "))],64))),128)),e("button",{onClick:W,disabled:k.value===se.value,class:$(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",k.value===se.value?"opacity-50 cursor-not-allowed":""])},[Fm,o(t(at),{class:"h-5 w-5","aria-hidden":"true"})],10,Sm)])])])])):F("",!0)]),j.value.length===0&&!G.value?(n(),i("div",Em,[o(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",Tm,f(A.value),1),e("p",Am,f(B.value),1)])):F("",!0),G.value?(n(),i("div",Mm,Im)):F("",!0),o(jt,{isVisible:t(nt),documentData:t(It),onClose:V[7]||(V[7]=Z=>nt.value=!1)},null,8,["isVisible","documentData"]),(n(),re(ft,{to:"body"},[t(D).signatures.isOpen?(n(),re(t(Zt),{key:0,"document-id":(ie=t(D).signatures.document)==null?void 0:ie.id,onClose:V[8]||(V[8]=Z=>t(T)("signatures")),onRefresh:V[9]||(V[9]=Z=>S("refresh"))},null,8,["document-id"])):F("",!0),t(D).letterhead.isOpen?(n(),re(yt,{key:1,"is-visible":t(D).letterhead.isOpen,document:t(D).letterhead.document,onClose:V[10]||(V[10]=Z=>t(T)("letterhead")),onUploaded:V[11]||(V[11]=Z=>S("refresh")),onDeleted:V[12]||(V[12]=Z=>S("refresh"))},null,8,["is-visible","document"])):F("",!0),a.value?(n(),re(wt,{key:2,"is-visible":a.value,document:z.value,"card-type":"signatures",context:"table","user-store":t(C),onClose:V[13]||(V[13]=Z=>a.value=!1),onAction:_e},null,8,["is-visible","document","user-store"])):F("",!0)]))])}}},jm={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Bm={class:"flex justify-end"},Um=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[ee(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),zm={class:"mt-2"},Nm={class:"flex gap-2 mt-2.5"},Om=["disabled"],Rm=e("span",null,"Actualizar nombre",-1),qm=[Rm],Vm=["disabled"],Qm={__name:"CreateDocumentByLawyer",emits:["close"],setup(l,{emit:v}){const c=et(),u=qe(),S=v,C=y(""),m=y("");Gt(()=>{var Y;(Y=u.selectedDocument)!=null&&Y.title?(C.value=u.selectedDocument.title,m.value=u.selectedDocument.title):(C.value="",m.value="")});const D=Y=>{Y.key==="Escape"&&S("close")};Oe(()=>{document.addEventListener("keydown",D)}),ut(()=>{document.removeEventListener("keydown",D)});const _=L(()=>C.value.trim().length>0),T=L(()=>{var Y;return!!((Y=u.selectedDocument)!=null&&Y.id)}),te=L(()=>T.value&&C.value.trim()!==m.value.trim()&&C.value.trim().length>0);async function Q(){if(T.value&&te.value)try{const Y={title:C.value.trim()};await u.updateDocument(u.selectedDocument.id,Y),m.value=C.value.trim(),u.selectedDocument.title=C.value.trim(),u.lastUpdatedDocumentId=u.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",u.selectedDocument.id);const le=u.selectedDocument.id;S("close",{updatedDocId:le});const G=window.location.pathname;G==="/dynamic_document_dashboard"||G==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(le)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(Y){console.error("Error updating document name:",Y)}}const K=async()=>{if(!_.value)return;const Y=encodeURIComponent(C.value.trim());T.value?(u.selectedDocument.title=C.value,u.selectedDocument.id&&(u.lastUpdatedDocumentId=u.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",u.selectedDocument.id.toString())),c.push(`/dynamic_document_dashboard/lawyer/editor/edit/${u.selectedDocument.id}`)):(u.selectedDocument={title:C.value.trim()},c.push(`/dynamic_document_dashboard/lawyer/editor/create/${Y}`))};return(Y,le)=>(n(),i("div",jm,[e("div",Bm,[e("button",{onClick:le[0]||(le[0]=G=>S("close"))},[o(t(Ue),{class:"size-6"})])]),e("form",{onSubmit:fe(K,["prevent"])},[e("div",null,[Um,e("div",zm,[Pe(e("input",{"onUpdate:modelValue":le[1]||(le[1]=G=>C.value=G),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[Re,C.value]])])]),e("div",Nm,[T.value?(n(),i("button",{key:0,type:"button",onClick:Q,disabled:!te.value,class:$(["p-2.5 text-sm font-medium rounded-md flex gap-2",te.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},qm,10,Om)):F("",!0),e("button",{type:"submit",class:$(["p-2.5 text-sm font-medium rounded-md flex gap-2",_.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!_.value},[e("span",null,f(T.value?"Editar Documento":"Continuar"),1)],10,Vm)])],32)]))}},Le=l=>(gt("data-v-4d444b98"),l=l(),pt(),l),Wm={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Gm={class:"px-6 py-4 border-b border-gray-200"},Hm=Le(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gestión de Membrete Global para PDF",-1)),Zm=Le(()=>e("p",{class:"text-sm text-gray-500 mt-1"}," La imagen de membrete se usará por defecto solo al generar documentos en PDF. Para documentos Word, se utiliza la plantilla .docx configurada más abajo. ",-1)),Jm={class:"p-6 overflow-y-auto flex-grow"},Km={key:0,class:"text-center py-10"},Ym=Le(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),Xm={class:"mt-4 text-gray-500"},eg={key:1,class:"space-y-6"},tg={key:0,class:"space-y-4"},sg=Le(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete de imagen para PDF actual",-1)),og={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},ng=["src"],rg={class:"mt-4 flex justify-center space-x-3"},ag=["disabled"],lg={key:1,class:"text-center py-8"},ig=Le(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete para PDF",-1)),dg=Le(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," No tienes una imagen de membrete global configurada para los documentos PDF. ",-1)),cg=Le(()=>e("p",{class:"mt-1 text-xs text-gray-400"}," Este membrete de imagen se aplicará solo a los PDF que no tengan un membrete específico. ",-1)),ug={class:"space-y-4"},mg={class:"text-lg font-medium text-gray-900"},gg={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},pg={key:0},hg={class:"mt-4"},fg=Le(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, máximo 10MB. Se usa únicamente para los PDF. ",-1)),vg=Le(()=>e("p",{class:"text-xs text-gray-400 mt-1"},' Dimensiones ideales: 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI) ',-1)),bg={key:1,class:"space-y-4"},yg={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},xg={class:"text-gray-400"},_g={key:0,class:"mt-4"},wg=["src"],$g={class:"flex justify-center space-x-3"},kg=["disabled"],Cg={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Dg={class:"space-y-4 border-t border-gray-200 pt-6"},Sg=Le(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Plantilla Word para documentos (.docx)",-1)),Fg=Le(()=>e("p",{class:"text-sm text-gray-500"}," Esta plantilla se usará al descargar documentos en Word. Debe ser un archivo .docx con tu membrete configurado (header, footer o watermark). El contenido del documento se añadirá sobre esa plantilla. ",-1)),Eg={key:0,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Tg={class:"text-sm text-gray-700"},Ag=Le(()=>e("div",{class:"font-medium"},"Plantilla actual:",-1)),Mg={class:"mt-1 break-words"},Pg={class:"font-mono break-all"},Lg={key:0,class:"text-gray-400 ml-2"},Ig={class:"mt-3 flex flex-wrap gap-3"},jg=["disabled"],Bg={key:1,class:"text-sm text-gray-500"},Ug={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},zg={key:0},Ng={class:"mt-4"},Og=Le(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos .docx, máximo 10MB. ",-1)),Rg={key:1,class:"space-y-4"},qg={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Vg={class:"text-gray-400"},Qg={class:"flex justify-center space-x-3"},Wg=["disabled"],Gg={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Hg={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},Zg={class:"flex items-center space-x-2"},Jg=Le(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete para PDF",-1)),Kg=Le(()=>e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-yellow-800 mb-2"},"🔄 Prioridad de Membrete"),e("div",{class:"text-sm text-yellow-700 space-y-1"},[e("div",null,[e("strong",null,"1º Prioridad:"),ee(" Membrete específico del documento")]),e("div",null,[e("strong",null,"2º Prioridad:"),ee(" Membrete global de imagen para PDF del usuario (este)")]),e("div",null,[e("strong",null,"3º Prioridad:"),ee(" Sin membrete")])])],-1)),Yg=Le(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"📐 Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"2550 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"3300 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporción:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta, 300 DPI)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"±10%")])])])],-1)),Xg=Le(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🎨 Distribución Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"⚠️ ZONA CRÍTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mantén semi-transparente. El texto del documento se superpone aquí.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, teléfonos, emails, información de contacto.")])])])])])],-1)),e0=Le(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🔧 Consideraciones Técnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Posicionamiento:"),ee(" La imagen se centra automáticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Transparencia:"),ee(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Márgenes:"),ee(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Resolución:"),ee(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"⚠️"),e("span",null,[e("strong",null,"Zona crítica:"),ee(" Evita elementos gráficos densos en el centro (300-400px de altura)")])])])])],-1)),t0=Le(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"💡 Tips de Diseño Rápido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"• Si solo tienes header, ubícalo en los primeros 120-150px"),e("div",null,"• El resto de la imagen debe ser transparente o blanco"),e("div",null,"• Para footer, usa los últimos 80-120px"),e("div",null,"• El texto se superpone en toda la imagen, mantén el centro claro")])],-1)),s0={key:3,class:"space-y-2"},o0={class:"flex"},n0={class:"text-sm text-yellow-700"},r0={__name:"GlobalLetterheadModal",props:{isVisible:{type:Boolean,default:!1}},emits:["close","uploaded","deleted"],setup(l,{emit:v}){const c=l,u=v;we(()=>c.isVisible,R=>{});const S=qe(),C=y(!1),m=y(""),D=y(!1),_=y(!1),T=y(null),te=y(null),Q=y(null),K=y([]),Y=y(null),le=y(!1),G=y(!1),x=y(null),d=y(!1),h=y(null),p=y(""),oe=y(null),k=y(!1),g=y(!1),A=y(null),B=()=>{ae(),u("close")},E=R=>{const I=R.target.files[0];if(!I)return;if(!I.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(I.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}T.value=I,K.value=[];const W=new FileReader;W.onload=P=>{te.value=P.target.result;const r=new Image;r.onload=()=>{j(r.width,r.height)},r.src=P.target.result},W.readAsDataURL(I)},j=(R,I)=>{const s=R/I,a=2550/3300,z=Math.abs(s-a)/a;if(R===2550&&I===3300){K.value.push("✅ Dimensiones perfectas: 2550 × 3300 píxeles");return}z<=.1?(K.value.push(`ℹ️ Buenas proporciones detectadas: ${R} × ${I} píxeles (${s.toFixed(3)})`),(R!==2550||I!==3300)&&K.value.push('💡 Para mejores resultados, usa exactamente 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI)')):(K.value.push(`⚠️ Proporciones no ideales: ${R} × ${I} píxeles (${s.toFixed(3)})`),K.value.push(`🎯 Proporciones recomendadas: ${a.toFixed(3)} (8.5:11, tamaño carta)`),K.value.push("📐 Considera redimensionar tu imagen a 2550 × 3300 píxeles (tamaño carta)")),(R<1200||I<1600)&&K.value.push("⚠️ Imagen muy pequeña - puede verse pixelada en documentos PDF tamaño carta"),(R>4e3||I>5e3)&&K.value.push("ℹ️ Imagen muy grande - se redimensionará automáticamente para ajustarse al tamaño carta")},ae=()=>{T.value=null,te.value=null,K.value=[],le.value=!1,Y.value&&(Y.value.value="")},se=async()=>{var R;if(T.value){D.value=!0,K.value=[];try{const I=await S.uploadGlobalLetterheadImage(T.value);(R=I.data)!=null&&R.warnings&&I.data.warnings.length>0&&(K.value=I.data.warnings),G.value=!1,await O(),ae(),u("uploaded",I.data)}catch(I){console.error("Error uploading global letterhead:",I),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{D.value=!1}}},O=async()=>{if(!(Q.value===null&&G.value)){G.value=!0;try{const R=await S.getGlobalLetterheadImage();R.data&&(Q.value=URL.createObjectURL(R.data))}catch{Q.value=null}}},ce=async()=>{await Nt("¿Estás seguro de que deseas eliminar la imagen de membrete global?")&&ye()},ye=async()=>{_.value=!0;try{await S.deleteGlobalLetterheadImage(),Q.value&&URL.revokeObjectURL(Q.value),Q.value=null,G.value=!0,u("deleted")}catch(R){console.error("Error deleting global letterhead:",R),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{_.value=!1}},ve=R=>{const I=R.target.files[0];if(I){if(!I.name.toLowerCase().endsWith(".docx")){alert("Solo se permiten archivos .docx para la plantilla Word");return}if(I.size>10*1024*1024){alert("El archivo de plantilla no puede ser mayor a 10MB");return}x.value=I}},U=()=>{x.value=null,A.value&&(A.value.value="")},J=async()=>{var R;if(x.value){k.value=!0;try{const W=(R=(await S.uploadGlobalLetterheadWordTemplate(x.value)).data)==null?void 0:R.template_info;d.value=!0,p.value=(W==null?void 0:W.filename)||x.value.name,oe.value=(W==null?void 0:W.size_bytes)||x.value.size,await q(),U()}catch(I){console.error("Error uploading global Word template:",I),alert("Error al subir la plantilla Word. Por favor intenta nuevamente.")}finally{k.value=!1}}},q=async()=>{var R,I,W;try{const P=await S.getGlobalLetterheadWordTemplate("blob");if(P&&P.data){d.value=!0,h.value&&URL.revokeObjectURL(h.value),h.value=URL.createObjectURL(P.data);const r=((R=P.headers)==null?void 0:R["content-disposition"])||((I=P.headers)==null?void 0:I["Content-Disposition"]);let s="plantilla_word.docx";if(r){const a=r.match(/filename="?([^";]+)"?/i);a&&a[1]&&(s=a[1])}p.value=s,oe.value=P.data.size||null}}catch(P){((W=P.response)==null?void 0:W.status)===404?(d.value=!1,h.value&&URL.revokeObjectURL(h.value),h.value=null,p.value="",oe.value=null):console.error("Error loading global Word template:",P)}},ne=async()=>{await Nt("¿Estás seguro de que deseas eliminar la plantilla Word de membrete global?")&&ge()},ge=async()=>{g.value=!0;try{await S.deleteGlobalLetterheadWordTemplate(),h.value&&URL.revokeObjectURL(h.value),h.value=null,p.value="",oe.value=null,d.value=!1}catch(R){console.error("Error deleting global Word template:",R),alert("Error al eliminar la plantilla Word. Por favor intenta nuevamente.")}finally{g.value=!1}},he=()=>{if(h.value){const R=document.createElement("a");R.href=h.value,R.download=p.value||"membrete-word.docx",document.body.appendChild(R),R.click(),document.body.removeChild(R)}},xe=()=>{if(Q.value){const R=document.createElement("a");R.href=Q.value,R.download="membrete-global.png",document.body.appendChild(R),R.click(),document.body.removeChild(R)}},je=()=>{Q.value=null},Ee=R=>{if(R===0)return"0 Bytes";const I=1024,W=["Bytes","KB","MB","GB"],P=Math.floor(Math.log(R)/Math.log(I));return parseFloat((R/Math.pow(I,P)).toFixed(2))+" "+W[P]};we(()=>c.isVisible,R=>{R&&(O(),q())});const Be=()=>{Q.value&&URL.revokeObjectURL(Q.value),te.value&&URL.revokeObjectURL(te.value),h.value&&URL.revokeObjectURL(h.value)};return Oe(()=>{c.isVisible&&O()}),ut(Be),(R,I)=>Pe((n(),re(Ke,null,{default:w(()=>[e("div",Wm,[e("div",Gm,[Hm,Zm,e("button",{onClick:B,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[o(t(Ue),{class:"h-6 w-6"})])]),e("div",Jm,[C.value?(n(),i("div",Km,[Ym,e("p",Xm,f(m.value),1)])):(n(),i("div",eg,[Q.value?(n(),i("div",tg,[sg,e("div",og,[e("img",{src:Q.value,alt:"Membrete de imagen para PDF actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:je},null,40,ng),e("div",rg,[e("button",{onClick:xe,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[o(t(tt),{class:"h-4 w-4 mr-2"}),ee(" Descargar ")]),e("button",{onClick:ce,disabled:_.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[o(t(Pt),{class:"h-4 w-4 mr-2"}),ee(" "+f(_.value?"Eliminando...":"Eliminar"),1)],8,ag)])])])):(n(),i("div",lg,[o(t(rt),{class:"mx-auto h-12 w-12 text-gray-400"}),ig,dg,cg])),e("div",ug,[e("h3",mg,f(Q.value?"Reemplazar Membrete de imagen para PDF":"Subir Membrete de imagen para PDF"),1),e("div",gg,[e("input",{ref_key:"fileInput",ref:Y,type:"file",accept:".png",onChange:E,class:"hidden"},null,544),T.value?(n(),i("div",bg,[e("div",yg,[o(t(Lt),{class:"h-5 w-5 text-green-500"}),e("span",null,f(T.value.name),1),e("span",xg,"("+f(Ee(T.value.size))+")",1)]),te.value?(n(),i("div",_g,[e("img",{src:te.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,wg)])):F("",!0),e("div",$g,[e("button",{onClick:ae,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:se,disabled:D.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[D.value?(n(),i("div",Cg)):(n(),re(t(Qt),{key:0,class:"h-4 w-4 mr-2"})),ee(" "+f(D.value?"Subiendo...":"Subir Imagen para PDF"),1)],8,kg)])])):(n(),i("div",pg,[o(t(Kt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",hg,[e("button",{onClick:I[0]||(I[0]=W=>R.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG para PDF "),e("button",{onClick:I[1]||(I[1]=W=>le.value=!le.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[o(t(Vt),{class:"h-4 w-4 mr-2"}),ee(" "+f(le.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),fg,vg]))])]),e("div",Dg,[Sg,Fg,d.value?(n(),i("div",Eg,[e("div",Tg,[Ag,e("div",Mg,[e("span",Pg,f(p.value||"plantilla_word.docx"),1),oe.value?(n(),i("span",Lg,"("+f(Ee(oe.value))+")",1)):F("",!0)])]),e("div",Ig,[h.value?(n(),i("button",{key:0,onClick:he,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[o(t(tt),{class:"h-4 w-4 mr-2"}),ee(" Descargar ")])):F("",!0),e("button",{onClick:ne,disabled:g.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[o(t(Pt),{class:"h-4 w-4 mr-2"}),ee(" "+f(g.value?"Eliminando...":"Eliminar"),1)],8,jg)])])):(n(),i("div",Bg," No tienes una plantilla Word configurada. Puedes subir un archivo .docx con tu membrete. ")),e("div",Ug,[e("input",{ref_key:"wordTemplateInput",ref:A,type:"file",accept:".docx",onChange:ve,class:"hidden"},null,544),x.value?(n(),i("div",Rg,[e("div",qg,[o(t(Lt),{class:"h-5 w-5 text-green-500"}),e("span",null,f(x.value.name),1),e("span",Vg,"("+f(Ee(x.value.size))+")",1)]),e("div",Qg,[e("button",{onClick:U,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:J,disabled:k.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[k.value?(n(),i("div",Gg)):(n(),re(t(Qt),{key:0,class:"h-4 w-4 mr-2"})),ee(" "+f(k.value?"Subiendo...":"Subir Plantilla"),1)],8,Wg)])])):(n(),i("div",zg,[o(t(rt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Ng,[e("button",{onClick:I[2]||(I[2]=W=>R.$refs.wordTemplateInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Plantilla .docx (Word) ")]),Og]))])]),le.value?(n(),i("div",Hg,[e("div",Zg,[o(t(Vt),{class:"h-6 w-6 text-blue-600"}),Jg]),Kg,Yg,Xg,e0,t0])):F("",!0),K.value.length>0?(n(),i("div",s0,[(n(!0),i(de,null,me(K.value,(W,P)=>(n(),i("div",{key:P,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",o0,[o(t(_s),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",n0,f(W),1)])]))),128))])):F("",!0)]))])])]),_:1},512)),[[mt,l.isVisible]])}},a0=xt(r0,[["__scopeId","data-v-4d444b98"]]),l0={class:"min-h-screen bg-gray-50"},i0={class:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8"},d0={class:"p-4 sm:p-6 lg:p-8"},c0={key:0},u0={class:"mb-6 border-b border-gray-200 pb-4"},m0={class:"hidden md:block"},g0={class:"flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8 mb-4","aria-label":"Tabs"},p0=["onClick"],h0={class:"flex gap-3"},f0=["disabled"],v0=e("span",null,"Firma Electrónica",-1),b0=e("span",null,"Membrete Global",-1),y0=e("span",null,"Nueva Minuta",-1),x0={class:"md:hidden space-y-3 relative"},_0=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),w0=[_0],$0={key:0,class:"absolute z-20 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden w-full"},k0=["onClick"],C0={class:"grid grid-cols-3 gap-2"},D0=["disabled"],S0=e("span",{class:"font-medium text-xs leading-tight"},"Firma",-1),F0=e("span",{class:"font-medium text-xs leading-tight"},"Membrete",-1),E0=e("span",{class:"font-medium text-xs leading-tight"},"Nueva",-1),T0={key:0},A0={key:1},M0={key:2},P0={key:3},L0={key:4},I0={key:5,class:"mt-6 text-center text-gray-400 font-regular"},j0=e("p",null,"No hay documentos disponibles para mostrar.",-1),B0=[j0],U0={key:1},z0={class:"mb-6 border-b border-gray-200"},N0={class:"hidden md:flex items-center justify-between"},O0={class:"-mb-px flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},R0=["onClick"],q0={class:"flex items-center gap-2 mb-4"},V0={class:"relative"},Q0={class:"relative group"},W0=["disabled"],G0={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},H0=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),Z0={class:"md:hidden relative"},J0=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),K0=[J0],Y0={key:0,class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},X0=["onClick"],ep={class:"md:hidden mt-4 mb-4 flex flex-col gap-2"},tp={class:"relative"},sp={class:"relative group"},op=["disabled"],np={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},rp=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),ap={key:0},lp={key:1},ip={class:"p-4 sm:p-6"},dp={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},cp={class:"flex justify-between items-center p-4 border-b"},up=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),mp={class:"p-4 sm:p-6"},gp={class:"p-4 sm:p-6"},pp={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},hp={class:"flex justify-between items-center p-4 border-b"},fp=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),vp={class:"p-4 sm:p-6"},Wp={__name:"Dashboard",setup(l){const v=Je(),c=qe(),u=Bt(),S=et(),C=cs(),{isBasicUser:m,handleFeatureAccess:D}=Ut(),_=y(""),T=y("default"),te=y(!1),Q=y("folders"),K=y("legal-documents"),Y=y(!1),le=y(!1),G=y(!1),x=y(!1),d=y(!1),h=y(null),p=y([]),oe=y("recent");we(K,(I,W)=>{},{immediate:!0}),L(()=>[]),L(()=>oe.value==="recent"?"Más recientes":"Nombre (A-Z)");const k=L(()=>v.currentUser),g=L(()=>k.value?k.value.role:(S.push("/login"),null)),A=L(()=>{let I=[];g.value==="lawyer"?I=c.draftAndPublishedDocumentsUnassigned:(g.value==="client"||g.value==="basic"||g.value==="corporate_client")&&(I=c.progressAndCompletedDocumentsByClient(k.value.id));const W=p.value&&Array.isArray(p.value)?p.value.map(P=>P.id):[];return c.filteredDocumentsBySearchAndTags(_.value,v,W).filter(P=>I.some(r=>r.id===P.id))}),B=async I=>{T.value=I,c.selectedDocument=null;try{await c.init(!0)}catch(W){console.error("Error loading documents for useDocument section:",W)}},E=()=>{te.value=!1,T.value="default",c.selectedDocument=null},j=async()=>{await c.init(!0)},ae=()=>{if(!k.value){console.error("Cannot open signature modal: currentUser is not loaded");return}le.value=!0},se=()=>{if(!k.value){console.error("Cannot open signature modal: currentUser is not loaded");return}Y.value=!0},O=()=>{if(!k.value){console.error("Cannot open signature modal: currentUser is not loaded");return}Y.value=!0},ce=async I=>{K.value="signed-documents"},ye=async I=>{Q.value="signed-documents"},ve=()=>{if(!k.value){console.error("Cannot open letterhead modal: currentUser is not loaded");return}D("Membrete Global",()=>{G.value=!0})},U=I=>{De("Membrete global subido correctamente","success")},J=()=>{De("Membrete global eliminado correctamente","success")},q=async()=>{if(T.value==="useDocument"){T.value="default",Q.value="my-documents";return}Q.value="folders";try{await new Promise(I=>setTimeout(I,100)),await u.fetchFolders(!0)}catch{}};we(()=>c.lastUpdatedDocumentId,(I,W)=>{if(I&&I!==W&&T.value==="default"){const P=Date.now();(!we.lastExecutionTime||P-we.lastExecutionTime>100)&&(we.lastExecutionTime=P,T.value="default")}},{immediate:!1}),we(x,I=>{}),we(d,I=>{}),we(h,I=>{}),we(()=>C.path,(I,W)=>{I==="/dynamic_document_dashboard"&&W&&W.includes("/document/use/")&&c.init()}),we(()=>C.query,I=>{I.lawyerTab&&(K.value=I.lawyerTab),I.tab&&(Q.value=I.tab)},{immediate:!0});const ne=[{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"}],ge=[{name:"legal-documents",label:"Minutas"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"finished-documents",label:"Dcs. Clientes"},{name:"in-progress-documents",label:"Dcs. Clientes en Progreso"}],he=y(!1),xe=y(!1),je=()=>{he.value=!1,xe.value=!1},Ee=I=>{K.value=I,he.value=!1,je()},Be=I=>{T.value="default",Q.value=I,xe.value=!1,je()};Oe(async()=>{await v.init(),await c.init(),await u.init(),c.selectedDocument=null,T.value="default";const I=localStorage.getItem("lastUpdatedDocumentId");I&&c.documents.some(P=>P.id.toString()===I)&&(c.lastUpdatedDocumentId=parseInt(I))});const R=async I=>{v.currentUser&&(v.currentUser.has_signature=!0),De("Firma electrónica guardada correctamente","success"),setTimeout(()=>{le.value=!1,Y.value=!1},500)};return(I,W)=>{var P,r;return n(),i(de,null,[e("div",l0,[e("div",i0,[Ht(I.$slots,"default")]),e("div",d0,[g.value==="lawyer"?(n(),i("div",c0,[e("div",u0,[e("div",m0,[e("nav",g0,[(n(),i(de,null,me(ge,s=>e("button",{key:s.name,onClick:fe(a=>Ee(s.name),["stop"]),class:$([K.value===s.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},f(s.label),11,p0)),64))]),e("div",h0,[e("button",{onClick:fe(ae,["stop"]),disabled:!k.value,class:$(["inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-purple-200 text-sm font-medium transition-all duration-200",k.value?"bg-white text-gray-700 hover:bg-purple-50 hover:border-purple-300":"bg-gray-50 text-gray-400 cursor-not-allowed opacity-60"])},[o(t($t),{class:"size-5 text-purple-500"}),v0],10,f0),e("button",{onClick:W[0]||(W[0]=fe(s=>G.value=!0,["stop"])),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-green-200 bg-white text-sm font-medium text-gray-700 hover:bg-green-50 hover:border-green-300 transition-all duration-200"},[o(t(Qe),{class:"size-5 text-green-500"}),b0]),e("button",{onClick:W[1]||(W[1]=fe(s=>te.value=!0,["stop"])),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-secondary bg-secondary text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200"},[o(t(Xe),{class:"size-5"}),y0])])]),e("div",x0,[e("button",{onClick:W[2]||(W[2]=fe(s=>he.value=!he.value,["stop"])),class:"dropdown-button w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,f(((P=ge.find(s=>s.name===K.value))==null?void 0:P.label)||"Seleccionar sección"),1),(n(),i("svg",{class:$(["ml-2 h-5 w-5 transition-transform duration-200",he.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},w0,2))]),he.value?(n(),i("div",$0,[(n(),i(de,null,me(ge,s=>e("button",{key:s.name,onClick:fe(a=>Ee(s.name),["stop"]),class:$(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",K.value===s.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},f(s.label),11,k0)),64))])):F("",!0),e("div",C0,[e("button",{onClick:fe(ae,["stop"]),disabled:!k.value,class:$(["flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-purple-200 text-center transition-all duration-200",k.value?"bg-white hover:bg-purple-50":"bg-gray-50 cursor-not-allowed opacity-60"])},[o(t($t),{class:"size-6 text-purple-500 mb-1"}),S0],10,D0),e("button",{onClick:W[3]||(W[3]=fe(s=>G.value=!0,["stop"])),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-green-200 bg-white text-center transition-all duration-200 hover:bg-green-50"},[o(t(Qe),{class:"size-6 text-green-500 mb-1"}),F0]),e("button",{onClick:W[4]||(W[4]=fe(s=>te.value=!0,["stop"])),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-secondary bg-secondary text-white text-center transition-all duration-200 hover:bg-blue-700"},[o(t(Xe),{class:"size-6 mb-1"}),E0])])])]),K.value==="legal-documents"?(n(),i("div",T0,[o(ld,{searchQuery:_.value,selectedTags:p.value},null,8,["searchQuery","selectedTags"])])):F("",!0),K.value==="pending-signatures"?(n(),i("div",A0,[o(kt,{state:"PendingSignatures",searchQuery:_.value,selectedTags:p.value,onOpenElectronicSignature:ae,onDocumentFullySigned:ce},null,8,["searchQuery","selectedTags"])])):F("",!0),K.value==="signed-documents"?(n(),i("div",M0,[o(kt,{state:"FullySigned",searchQuery:_.value,selectedTags:p.value,onOpenElectronicSignature:ae},null,8,["searchQuery","selectedTags"])])):F("",!0),K.value==="finished-documents"?(n(),i("div",P0,[o(hc,{searchQuery:_.value,selectedTags:p.value},null,8,["searchQuery","selectedTags"])])):F("",!0),K.value==="in-progress-documents"?(n(),i("div",L0,[o($u,{searchQuery:_.value,selectedTags:p.value},null,8,["searchQuery","selectedTags"])])):F("",!0),A.value.length===0?(n(),i("div",I0,B0)):F("",!0)])):F("",!0),g.value==="client"||g.value==="basic"||g.value==="corporate_client"?(n(),i("div",U0,[e("div",z0,[e("div",N0,[e("nav",O0,[(n(),i(de,null,me(ne,s=>e("button",{key:s.name,onClick:fe(a=>Be(s.name),["stop"]),class:$([Q.value===s.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},f(s.label),11,R0)),64))]),e("div",q0,[e("div",V0,[e("button",{onClick:fe(se,["stop"]),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border text-purple-600 hover:bg-purple-50 border-purple-200"},[o(t($t),{class:"h-4 w-4"}),ee(" Firma Electrónica ")])]),e("div",Q0,[e("button",{onClick:fe(ve,["stop"]),disabled:t(m),class:$(["inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border",t(m)?"text-green-400 bg-gray-50 border-gray-200 cursor-not-allowed opacity-60":"text-green-600 hover:bg-green-50 border-green-200"])},[o(t(Qe),{class:"h-4 w-4"}),ee(" Membrete Global ")],10,W0),t(m)?(n(),i("div",G0,[ee(" Actualiza tu suscripción para usar esta funcionalidad "),H0])):F("",!0)]),e("button",{onClick:W[5]||(W[5]=fe(s=>B("useDocument"),["stop"])),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[o(t(Xe),{class:"h-4 w-4"}),ee(" Nuevo Documento ")])])]),e("div",Z0,[e("button",{onClick:W[6]||(W[6]=fe(s=>xe.value=!xe.value,["stop"])),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,f(((r=ne.find(s=>s.name===Q.value))==null?void 0:r.label)||"Seleccionar sección"),1),(n(),i("svg",{class:$(["ml-2 h-5 w-5 transition-transform duration-200",xe.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},K0,2))]),xe.value?(n(),i("div",Y0,[(n(),i(de,null,me(ne,s=>e("button",{key:s.name,onClick:fe(a=>Be(s.name),["stop"]),class:$(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",Q.value===s.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},f(s.label),11,X0)),64))])):F("",!0)]),e("div",ep,[e("div",tp,[e("button",{onClick:fe(se,["stop"]),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-purple-600 bg-purple-50 hover:bg-purple-100"},[o(t($t),{class:"h-5 w-5"}),ee(" Firma Electrónica ")])]),e("div",sp,[e("button",{onClick:fe(ve,["stop"]),disabled:t(m),class:$(["w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors",t(m)?"text-green-400 bg-gray-50 cursor-not-allowed opacity-60":"text-green-600 bg-green-50 hover:bg-green-100"])},[o(t(Qe),{class:"h-5 w-5"}),ee(" Membrete Global ")],10,op),t(m)?(n(),i("div",np,[ee(" Actualiza tu suscripción para usar esta funcionalidad "),rp])):F("",!0)]),e("button",{onClick:W[7]||(W[7]=fe(s=>B("useDocument"),["stop"])),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[o(t(Xe),{class:"h-5 w-5"}),ee(" Nuevo Documento ")])])]),T.value==="useDocument"?(n(),i("div",ap,[o(Gl,{searchQuery:_.value,selectedTags:p.value,onGoBack:q},null,8,["searchQuery","selectedTags"])])):(n(),i("div",lp,[Q.value==="folders"?(n(),re(Hr,{key:0,searchQuery:_.value,selectedTags:p.value,onRefresh:j,onNavigateToMain:q},null,8,["searchQuery","selectedTags"])):Q.value==="my-documents"?(n(),re(cl,{key:1,searchQuery:_.value,selectedTags:p.value,onRefresh:j},null,8,["searchQuery","selectedTags"])):Q.value==="pending-signatures"?(n(),re(kt,{key:2,state:"PendingSignatures",searchQuery:_.value,selectedTags:p.value,onRefresh:j,onOpenElectronicSignature:O,onDocumentFullySigned:ye},null,8,["searchQuery","selectedTags"])):Q.value==="signed-documents"?(n(),re(kt,{key:3,state:"FullySigned",searchQuery:_.value,selectedTags:p.value,onRefresh:j,onOpenElectronicSignature:O},null,8,["searchQuery","selectedTags"])):F("",!0)]))])):F("",!0)])]),te.value?(n(),re(Ke,{key:0},{default:w(()=>[o(Qm,{onClose:E})]),_:1})):F("",!0),le.value&&k.value?(n(),re(Ke,{key:1},{default:w(()=>[e("div",ip,[e("div",dp,[e("div",cp,[up,e("button",{onClick:W[8]||(W[8]=s=>le.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[o(t(Ue),{class:"h-6 w-6"})])]),e("div",mp,[o(zt,{"user-id":k.value.id,"initial-show-options":!k.value.has_signature,onSignatureSaved:R,onCancel:W[9]||(W[9]=s=>le.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):F("",!0),Y.value&&k.value?(n(),re(Ke,{key:2},{default:w(()=>[e("div",gp,[e("div",pp,[e("div",hp,[fp,e("button",{onClick:W[10]||(W[10]=s=>Y.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[o(t(Ue),{class:"h-6 w-6"})])]),e("div",vp,[o(zt,{"user-id":k.value.id,"initial-show-options":!k.value.has_signature,onSignatureSaved:R,onCancel:W[11]||(W[11]=s=>Y.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):F("",!0),o(jt,{isVisible:t(nt),documentData:t(It),onClose:W[12]||(W[12]=s=>nt.value=!1)},null,8,["isVisible","documentData"]),o(a0,{isVisible:G.value,onClose:W[13]||(W[13]=s=>G.value=!1),onUploaded:U,onDeleted:J},null,8,["isVisible"])],64)}}};export{Wp as default};
