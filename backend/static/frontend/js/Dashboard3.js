import{e as s,f as r,g as e,u as Je,r as x,aK as as,o as Qe,as as mt,c as B,h as a,j as t,G as Ee,w as Te,v as Ie,n as j,l as f,t as p,m as pe,p as te,s as Ce,b5 as hs,i as M,ac as Ve,a9 as rs,b6 as fs,Q as gt,k as oe,a2 as He,F as ue,D as Zt,E as ns,b7 as vs,a0 as ys,C as bs,T as Se,N as he,I as Ze,a1 as Ue,ag as je,ad as Pe,ae as Le,af as ye,b8 as xs,O as $t,P as kt,a5 as _s,ah as st,aY as ws,ai as Ct,am as qt,an as $s,ao as ks,ab as Cs,b9 as bt,ba as Kt}from"./index.js";import{u as Ne,o as Ds,s as et,p as Vt}from"./index2.js";import{g as ct,a as ut}from"./DocumentPermissionsManager.js";import{r as Ss,_ as Qt,a as Dt}from"./DocumentRelationshipsModal.js";import{_ as St}from"./_plugin-vue_export-helper.js";import{B as Fs,r as Es,a as Ft,b as Et,_ as Wt,c as Gt,D as ls,d as Ts,L as Tt,s as Yt}from"./index3.js";import{r as _t}from"./FolderIcon.js";import{r as Ke}from"./PlusIcon.js";import{r as rt}from"./EllipsisVerticalIcon.js";import{r as ot}from"./DocumentIcon.js";import{_ as As}from"./DocumentCard.js";import{r as is}from"./EyeIcon.js";import{r as pt}from"./ChevronRightIcon.js";import{_ as Jt}from"./SignatureDocumentCard.js";import{r as Ot,a as Ms,b as js}from"./TagIcon.js";import{r as Oe}from"./ChevronDownIcon.js";import{r as Ge}from"./MagnifyingGlassIcon.js";import{r as wt}from"./CheckCircleIcon.js";import{r as Xt}from"./PencilIcon.js";import{r as Nt}from"./TrashIcon.js";import{a as ds,r as es}from"./LinkIcon.js";import{r as cs}from"./PhotoIcon.js";import{r as tt,a as Ps}from"./FunnelIcon.js";import{r as Ls}from"./ArrowLeftIcon.js";import{r as At}from"./CubeTransparentIcon.js";import{r as ts}from"./CloudArrowUpIcon.js";import{r as Bs}from"./ExclamationTriangleIcon.js";import"./useRecentViews.js";import"./loading_message.js";function ss(o,_){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})])}function Rs(o,_){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})])}function zs(o,_){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})])}function Is(o,_){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const Us={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Os={class:"flex justify-end"},Ns=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[te(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),qs={class:"mt-2"},Vs={class:"flex gap-2 mt-2.5"},Qs=["disabled"],Ws=e("span",null,"Actualizar nombre",-1),Gs=[Ws],Hs=["disabled"],us={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(o,{emit:_}){const l=o,u=Je(),D=Ne(),b=_,h=x(""),k=x(""),v=()=>{b("close")};as(()=>{var K,S;D.selectedDocument?(h.value=((K=D.selectedDocument)==null?void 0:K.title)||"",k.value=((S=D.selectedDocument)==null?void 0:S.title)||""):(h.value="",k.value="")});const F=K=>{K.key==="Escape"&&v()};Qe(()=>{document.addEventListener("keydown",F)}),mt(()=>{document.removeEventListener("keydown",F)});const q=B(()=>h.value.trim().length>0),O=B(()=>{var K;return!!((K=D.selectedDocument)!=null&&K.id)}),W=B(()=>O.value&&h.value.trim()!==k.value.trim()&&h.value.trim().length>0);async function Y(){if(O.value&&W.value)try{const K={title:h.value.trim()};await D.updateDocument(D.selectedDocument.id,K),k.value=h.value.trim(),D.selectedDocument.title=h.value.trim();const S=D.selectedDocument.id;Ce("Document name successfully updated.","success"),b("close",{updatedDocId:S});const C=window.location.pathname;C==="/dynamic_document_dashboard"||C==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(K){console.error("Error updating document name:",K),Ce("Error updating document name.","error")}}function ae(){const K=encodeURIComponent(h.value.trim());l.documentId&&!D.selectedDocument?u.push(`/dynamic_document_dashboard/document/use/creator/${l.documentId}/${K}`):D.selectedDocument?(D.selectedDocument.title=h.value.trim(),u.push(`/dynamic_document_dashboard/document/use/editor/${D.selectedDocument.id}/${K}`)):Ce("Error: No se pudo continuar. Documento no seleccionado.","error")}return(K,S)=>(s(),r("div",Us,[e("div",Os,[e("button",{onClick:v},[a(t(Ee),{class:"size-6"})])]),e("form",{onSubmit:pe(ae,["prevent"])},[e("div",null,[Ns,e("div",qs,[Te(e("input",{"onUpdate:modelValue":S[0]||(S[0]=i=>h.value=i),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[Ie,h.value]])])]),e("div",Vs,[O.value?(s(),r("button",{key:0,type:"button",onClick:Y,disabled:!W.value,class:j(["p-2.5 text-sm font-medium rounded-md flex gap-2",W.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Gs,10,Qs)):f("",!0),e("button",{type:"submit",class:j(["p-2.5 text-sm font-medium rounded-md flex gap-2",q.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!q.value},[e("span",null,p(O.value?"Editar Documento":"Continuar"),1)],10,Hs)])],32)]))}},Zs={class:"mt-3 pt-2 border-t border-gray-100"},Ks={class:"flex items-center gap-2 text-xs text-gray-500"},Ys=e("span",null,"Hacer clic para usar este documento",-1),Js={__name:"UseDocumentCard",props:{document:{type:Object,required:!0},showTags:{type:Boolean,default:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null},additionalClasses:{type:String,default:""}},emits:["click","remove-from-folder","document-created"],setup(o,{emit:_}){const l=o,u=_,D=x(!1),b=x(null),h=ct(9),k=B(()=>"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium !bg-purple-100 !text-purple-700 !border !border-purple-200"),v=B(()=>h.dark),F=B(()=>{const S="group !border-purple-400 !bg-purple-50/50 !shadow-purple-100";return l.additionalClasses?`${S} ${l.additionalClasses}`:S}),q=B(()=>l.menuOptions!==null?l.menuOptions:[{label:"Usar",action:"use",icon:Rs,iconClasses:"w-4 h-4 text-purple-600"},{label:"Previsualización",action:"preview",icon:is,iconClasses:"w-4 h-4 text-gray-600"}]),O=B(()=>!1),W=(S,i)=>{l.disableInternalActions?u("click",S,i):ae(S.id)},Y=(S,i)=>{switch(S){case"use":ae(i.id);break;case"preview":Ds(i);break;default:console.warn("Unknown menu action:",S)}};function ae(S){S?(b.value=S,D.value=!0):console.error("Document ID is required:",S)}function K(S){if(D.value=!1,b.value=null,S&&S.updatedDocId){u("document-created",S);const i=window.location.pathname;i==="/dynamic_document_dashboard"||i==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(S.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}}return(S,i)=>(s(),r(ue,null,[a(Fs,{document:o.document,"card-type":o.cardType,"card-context":o.cardContext,"status-icon":t(fs),"status-text":"Disponible","status-badge-classes":k.value,"menu-options":q.value,"highlighted-doc-id":null,"show-tags":o.showTags,"document-store":o.documentStore,"user-store":o.userStore,"additional-classes":F.value,"disable-internal-actions":o.disableInternalActions,"show-menu-options":o.showMenuOptions,onClick:W,onMenuAction:Y,onRemoveFromFolder:i[0]||(i[0]=C=>S.$emit("remove-from-folder",C))},hs({"additional-actions":M(()=>[rs(S.$slots,"additional-actions")]),_:2},[O.value?{name:"right-action",fn:M(()=>[a(t(pt),{class:"w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors"})]),key:"0"}:void 0,o.disableInternalActions?void 0:{name:"footer",fn:M(()=>[e("div",Zs,[e("div",Ks,[e("div",{class:"w-2 h-2 rounded-full",style:Ve({backgroundColor:v.value})},null,4),Ys])])]),key:"1"}]),1032,["document","card-type","card-context","status-icon","status-badge-classes","menu-options","show-tags","document-store","user-store","additional-classes","disable-internal-actions","show-menu-options"]),Te(a(He,null,{default:M(()=>[b.value!==null?(s(),oe(us,{key:0,"document-id":b.value,onClose:K},null,8,["document-id"])):f("",!0)]),_:1},512),[[gt,D.value]])],64))}},Xs=()=>({folders:[],currentFolder:null,isLoading:!1,error:null,lastUpdatedFolderId:null}),eo={sortedFolders:o=>[...o.folders].sort((_,l)=>new Date(l.created_at)-new Date(_.created_at)),getFolderById:o=>_=>o.folders.find(l=>l.id===_),getFoldersByColor:o=>_=>o.folders.filter(l=>l.color_id===_),getFolderWithColor:o=>_=>{const l=o.folders.find(u=>u.id===_);return l?{...l,color:ct(l.color_id)}:null},getFoldersContainingDocument:o=>_=>o.folders.filter(l=>l.document_ids&&l.document_ids.includes(_)),totalDocumentsInFolders:o=>o.folders.reduce((_,l)=>_+(l.document_ids?l.document_ids.length:0),0),hasFolders:o=>o.folders.length>0,availableColors:()=>ut()},to={async init(o=!1){if(!(this.folders.length>0&&!o)){this.isLoading=!0,this.error=null;try{await this.fetchFolders()}catch(_){console.error("Error initializing document folder store:",_),this.error="Error al inicializar las carpetas"}finally{this.isLoading=!1}}},async fetchFolders(){try{const o=await Zt("dynamic-documents/folders/");if(o.status===200)return this.folders=o.data,o.data;throw new Error(`Error fetching folders: ${o.status}`)}catch(o){throw console.error("Error fetching folders:",o),this.error="Error al obtener las carpetas",o}},async fetchFolder(o){this.isLoading=!0,this.error=null;try{const _=await Zt(`dynamic-documents/folders/${o}/`);if(_.status===200){const l=_.data,u=this.folders.findIndex(D=>D.id===l.id);return u!==-1?this.folders[u]=l:this.folders.push(l),this.currentFolder=l,l}else throw new Error(`Error fetching folder: ${_.status}`)}catch(_){throw console.error("Error fetching folder:",_),this.error="Error al obtener la carpeta",_}finally{this.isLoading=!1}},async createFolder(o){this.isLoading=!0,this.error=null;try{if(!o.name||o.name.trim()==="")throw new Error("El nombre de la carpeta es requerido");const _=o.color_id??0;if(_<0||_>=ut().length)throw new Error("Color de carpeta no válido");const l={name:o.name.trim(),color_id:_,...o.document_ids&&{document_ids:o.document_ids}},u=await ns("dynamic-documents/folders/create/",l);if(u.status===200||u.status===201){const D=u.data;return this.folders.push(D),this.lastUpdatedFolderId=D.id,Ce("Carpeta creada exitosamente","success"),D}else throw new Error(`Error creating folder: ${u.status}`)}catch(_){throw console.error("Error creating folder:",_),this.error=_.message||"Error al crear la carpeta",Ce(this.error,"error"),_}finally{this.isLoading=!1}},async updateFolder(o,_){this.isLoading=!0,this.error=null;try{if(_.name&&_.name.trim()==="")throw new Error("El nombre de la carpeta no puede estar vacío");if(_.color_id!==void 0){const D=_.color_id;if(D<0||D>=ut().length)throw new Error("Color de carpeta no válido")}const l={};_.name&&(l.name=_.name.trim()),_.color_id!==void 0&&(l.color_id=_.color_id),_.document_ids!==void 0&&(l.document_ids=_.document_ids);const u=await vs(`dynamic-documents/folders/${o}/update/`,l);if(u.status===200){const D=u.data,b=this.folders.findIndex(h=>h.id===o);return b!==-1&&(this.folders[b]=D),this.currentFolder&&this.currentFolder.id===o&&(this.currentFolder=D),this.lastUpdatedFolderId=o,Ce("Carpeta actualizada exitosamente","success"),D}else throw new Error(`Error updating folder: ${u.status}`)}catch(l){throw console.error("Error updating folder:",l),this.error=l.message||"Error al actualizar la carpeta",Ce(this.error,"error"),l}finally{this.isLoading=!1}},async deleteFolder(o){this.isLoading=!0,this.error=null;try{const _=await ys(`dynamic-documents/folders/${o}/delete/`);if(_.status===204||_.status===200)return this.folders=this.folders.filter(l=>l.id!==o),this.currentFolder&&this.currentFolder.id===o&&(this.currentFolder=null),await Ce("Carpeta eliminada exitosamente","success"),!0;throw new Error(`Error deleting folder: ${_.status}`)}catch(_){throw console.error("Error deleting folder:",_),this.error=_.message||"Error al eliminar la carpeta",await Ce(this.error,"error"),_}finally{this.isLoading=!1}},setCurrentFolder(o){this.currentFolder=o},clearCurrentFolder(){this.currentFolder=null},reset(){this.folders=[],this.currentFolder=null,this.isLoading=!1,this.error=null,this.lastUpdatedFolderId=null}},so={async addDocumentsToFolder(o,_){const l=this.getFolderById(o);if(!l)throw new Error("Carpeta no encontrada");const u=l.document_ids||[],D=[...new Set([...u,..._])];return await this.updateFolder(o,{document_ids:D})},async removeDocumentsFromFolder(o,_){const l=this.getFolderById(o);if(!l)throw new Error("Carpeta no encontrada");const D=(l.document_ids||[]).filter(b=>!_.includes(b));return await this.updateFolder(o,{document_ids:D})},async moveDocumentsBetweenFolders(o,_,l){try{_&&await this.removeDocumentsFromFolder(_,o),l&&await this.addDocumentsToFolder(l,o),await Ce("Documentos movidos exitosamente","success")}catch(u){throw console.error("Error moving documents between folders:",u),await Ce("Error al mover documentos","error"),u}},getFolderColor(o){const _=this.getFolderById(o);return _?ct(_.color_id):ct(0)},validateFolderData(o){const _=[];if((!o.name||o.name.trim()==="")&&_.push("El nombre de la carpeta es requerido"),o.name&&o.name.length>100&&_.push("El nombre de la carpeta no puede exceder 100 caracteres"),o.color_id!==void 0){const l=o.color_id;(l<0||l>=ut().length)&&_.push("Color de carpeta no válido")}return o.document_ids&&!Array.isArray(o.document_ids)&&_.push("Los IDs de documentos deben ser un array"),{isValid:_.length===0,errors:_}}},Ht=bs("documentFolder",{state:Xs,getters:eo,actions:{...to,...so}}),oo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ao={class:"bg-white rounded-xl shadow-xl max-w-md w-full"},ro={class:"flex justify-between items-center p-6 border-b"},no={class:"text-lg font-semibold text-gray-900"},lo={class:"mb-4"},io=e("label",{for:"folderName",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la carpeta ",-1),co={class:"mb-6"},uo=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Color de la carpeta ",-1),mo={class:"grid grid-cols-8 gap-2"},go=["onClick","title"],po={class:"flex gap-3"},ho=["disabled"],fo={__name:"CreateEditFolderModal",props:{isVisible:{type:Boolean,required:!0},editingFolder:{type:Object,default:null}},emits:["close","success"],setup(o,{emit:_}){const l=o,u=_,D=Ht(),b=x(!1),h=x({name:"",color_id:0}),k=B(()=>ut()),v=()=>{h.value={name:"",color_id:0}};Se(()=>l.editingFolder,O=>{O?h.value={name:O.name,color_id:O.color_id}:v()},{immediate:!0}),Se(()=>l.isVisible,O=>{O||v()});const F=()=>{u("close")},q=async()=>{if(h.value.name.trim()){b.value=!0;try{l.editingFolder?await D.updateFolder(l.editingFolder.id,h.value):await D.createFolder(h.value),b.value=!1,u("success")}catch{b.value=!1}}};return(O,W)=>o.isVisible?(s(),oe(He,{key:0},{default:M(()=>[e("div",oo,[e("div",ao,[e("div",ro,[e("h3",no,p(o.editingFolder?"Editar Carpeta":"Nueva Carpeta"),1),e("button",{onClick:F,class:"text-gray-400 hover:text-gray-500"},[a(t(Ee),{class:"w-6 h-6"})])]),e("form",{onSubmit:pe(q,["prevent"]),class:"p-6"},[e("div",lo,[io,Te(e("input",{id:"folderName","onUpdate:modelValue":W[0]||(W[0]=Y=>h.value.name=Y),type:"text",required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ej: Contratos Laborales"},null,512),[[Ie,h.value.name]])]),e("div",co,[uo,e("div",mo,[(s(!0),r(ue,null,he(k.value,Y=>(s(),r("button",{key:Y.id,type:"button",onClick:ae=>h.value.color_id=Y.id,class:j(["w-8 h-8 rounded-full border-2 transition-all",h.value.color_id===Y.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"]),style:Ve({backgroundColor:Y.hex}),title:Y.name},null,14,go))),128))])]),e("div",po,[e("button",{type:"button",onClick:F,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:!h.value.name.trim()||b.value,class:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},p(b.value?"Guardando...":o.editingFolder?"Actualizar":"Crear"),9,ho)])],32)])])]),_:1})):f("",!0)}},vo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},yo={class:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col"},bo={class:"border-b px-6 py-4 flex-shrink-0"},xo={class:"flex justify-between items-center"},_o={class:"flex items-center gap-3"},wo={class:"text-xl font-semibold text-gray-900"},$o={class:"text-sm text-gray-600"},ko={class:"flex items-center gap-2"},Co={class:"flex-1 overflow-y-auto p-6"},Do={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},So={class:"min-w-full divide-y divide-gray-200"},Fo=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tipo "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),Eo={class:"bg-white divide-y divide-gray-200"},To=["onClick"],Ao={class:"px-6 py-4 whitespace-nowrap"},Mo={class:"flex items-center"},jo={class:"flex-shrink-0 h-10 w-10"},Po={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Lo={class:"ml-4"},Bo={class:"text-sm font-medium text-gray-900"},Ro={class:"px-6 py-4 whitespace-nowrap"},zo={class:"text-sm text-gray-600"},Io={class:"px-6 py-4 whitespace-nowrap"},Uo={class:"px-6 py-4 whitespace-nowrap"},Oo={class:"flex flex-wrap gap-1"},No={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},qo={key:1,class:"text-sm text-gray-400"},Vo={class:"py-1"},Qo=["onClick"],Wo=["onClick"],Go={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Ho=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"Esta carpeta está vacía",-1),Zo=e("p",{class:"text-gray-600 mb-4"},"Agrega documentos para organizar tu trabajo",-1),Ko={__name:"FolderDetailsModalTable",props:{folder:{type:Object,default:null}},emits:["close","add-documents","remove-document","view-document","use-document","document-action"],setup(o,{emit:_}){const l=o,u=_;Ze(),Ne();const D=x({}),b=x({}),h=x(!1),k=x(-1),v=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],F=B(()=>{if(!l.folder)return v[0];if(l.folder.color)return v.find(N=>N.name===l.folder.color)||v[0];const E=l.folder.id%v.length;return v[E]}),q=E=>E.state==="Published"||E.state==="Draft"?"Formato":E.state==="PendingSignatures"||E.state==="FullySigned"?"Para Firmar":E.state==="Progress"||E.state==="Completed"?"Mis Documentos":"Documento",O=E=>({Published:"Publicado",Draft:"Borrador",Progress:"En Progreso",Completed:"Completado",PendingSignatures:"Pendiente Firma",FullySigned:"Firmado"})[E.state]||E.state,W=E=>({Published:"bg-green-100 text-green-700 border border-green-200",Draft:"bg-gray-100 text-gray-700 border border-gray-200",Progress:"bg-blue-100 text-blue-700 border border-blue-200",Completed:"bg-green-100 text-green-700 border border-green-200",PendingSignatures:"bg-yellow-100 text-yellow-700 border border-yellow-200",FullySigned:"bg-green-100 text-green-700 border border-green-200"})[E.state]||"bg-gray-100 text-gray-700 border border-gray-200",Y=E=>{const N=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],G=E.id%N.length;return N[G]},ae=()=>{u("close")},K=()=>{u("add-documents",l.folder)},S=E=>{u("remove-document",{folderId:l.folder.id,documentId:E.id})},i=E=>{const N=q(E);u(N==="Formato"?"use-document":"view-document",E)},C=()=>!h.value||!l.folder?"auto":l.folder.documents.length===1?"280px":l.folder.documents.length===2&&k.value===1?"340px":"280px",y=(E,N)=>{E&&(D.value[N]=E)},X=(E,N)=>{E&&(b.value[N]=E)},P=(E,N)=>{h.value=!N,k.value=N?-1:E,N||setTimeout(()=>{const G=b.value[E];if(G){const re=G.$el||G;if(re&&re.getBoundingClientRect){const le=re.getBoundingClientRect(),Z=window.innerHeight;if(E===0){if(le.bottom>Z-20){const V=le.bottom-Z+40;window.scrollBy({top:V,behavior:"smooth"})}}else if(le.bottom>Z-10){const V=le.bottom-Z+30;window.scrollBy({top:V,behavior:"smooth"})}else if(le.top<80){const V=le.top-100;window.scrollBy({top:V,behavior:"smooth"})}}}},100)};return(E,N)=>o.folder?(s(),oe(He,{key:0},{default:M(()=>[e("div",vo,[e("div",yo,[e("div",bo,[e("div",xo,[e("div",_o,[e("div",{class:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:Ve({backgroundColor:F.value.hex+"20"})},[a(t(_t),{class:"h-6 w-6",style:Ve({color:F.value.hex})},null,8,["style"])],4),e("div",null,[e("h3",wo,p(o.folder.name),1),e("p",$o,p(o.folder.documents.length)+" documento"+p(o.folder.documents.length!==1?"s":""),1)])]),e("div",ko,[e("button",{onClick:K,class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"},[a(t(Ke),{class:"w-5 h-5"}),te(" Agregar documentos ")]),e("button",{onClick:ae,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[a(t(Ee),{class:"w-6 h-6"})])])])]),e("div",Co,[o.folder.documents.length>0?(s(),r("div",Do,[e("div",{class:"overflow-x-auto",style:Ve({minHeight:C()})},[e("table",So,[Fo,e("tbody",Eo,[(s(!0),r(ue,null,he(o.folder.documents,(G,re)=>{var le;return s(),r("tr",{key:G.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:Z=>i(G)},[e("td",Ao,[e("div",Mo,[e("div",jo,[e("div",Po,[a(t(Ue),{class:"h-5 w-5 text-blue-600"})])]),e("div",Lo,[e("div",Bo,p(G.title),1)])])]),e("td",Ro,[e("span",zo,p(q(G)),1)]),e("td",Io,[e("span",{class:j(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",W(G)])},p(O(G)),3)]),e("td",Uo,[e("div",Oo,[(s(!0),r(ue,null,he((le=G.tags)==null?void 0:le.slice(0,2),Z=>(s(),r("span",{key:Z.id,class:j(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",Y(Z)])},p(Z.name),3))),128)),G.tags&&G.tags.length>2?(s(),r("span",No," +"+p(G.tags.length-2),1)):f("",!0),!G.tags||G.tags.length===0?(s(),r("span",qo,"-")):f("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:N[0]||(N[0]=pe(()=>{},["stop"]))},[a(t(je),{as:"div",class:"relative inline-block text-left"},{default:M(({open:Z})=>[a(t(Pe),{ref_for:!0,ref:V=>y(V,re),onClick:V=>P(re,Z),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:M(()=>[a(t(rt),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),a(t(Le),{ref_for:!0,ref:V=>X(V,re),class:j([o.folder.documents.length>2&&re>0&&re>=o.folder.documents.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:M(()=>[e("div",Vo,[a(t(ye),null,{default:M(({active:V})=>[e("a",{onClick:R=>i(G),class:j([V?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver documento ",10,Qo)]),_:2},1024),a(t(ye),null,{default:M(({active:V})=>[e("a",{onClick:R=>S(G),class:j([V?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Quitar de carpeta ",10,Wo)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,To)}),128))])])],4)])):(s(),r("div",Go,[a(t(ot),{class:"w-12 h-12 text-gray-300 mx-auto mb-4"}),Ho,Zo,e("button",{onClick:K,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},[a(t(Ke),{class:"w-5 h-5"}),te(" Agregar documentos ")])]))])])])]),_:1})):f("",!0)}},ht=o=>($t("data-v-d403a707"),o=o(),kt(),o),Yo={class:"tag-filter-container"},Jo={class:"relative"},Xo={class:"flex items-center"},ea={key:0,class:"ml-2 inline-flex items-center justify-center h-5 w-5 bg-primary text-white text-xs rounded-full font-medium"},ta={key:0,class:"absolute left-0 mt-2 w-full sm:w-80 bg-white rounded-xl shadow-xl ring-1 ring-black ring-opacity-5 border border-gray-100 z-50 overflow-hidden"},sa={class:"bg-gray-50 p-4 border-b border-gray-200"},oa={class:"flex items-center justify-between mb-3"},aa=ht(()=>e("h3",{class:"text-sm font-semibold text-gray-900"},"Filtrar por etiquetas",-1)),ra={key:0,class:"text-xs text-gray-500"},na={class:"relative"},la={key:0,class:"px-4 py-2 bg-blue-50 border-b border-blue-100"},ia={class:"flex items-center justify-between"},da={class:"text-xs font-medium text-blue-700"},ca={class:"max-h-52 overflow-y-auto"},ua={key:0,class:"px-4 py-8 text-center"},ma=ht(()=>e("p",{class:"text-gray-500 text-sm"},"No hay etiquetas disponibles",-1)),ga={key:1,class:"px-4 py-8 text-center"},pa={class:"text-gray-500 text-sm"},ha={key:2,class:"px-4 py-8 text-center"},fa=ht(()=>e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"}),e("span",{class:"ml-3 text-sm text-gray-600"},"Cargando etiquetas...")],-1)),va=[fa],ya={key:3,class:"py-2"},ba=["onClick"],xa={class:"flex items-center h-5"},_a={class:"relative"},wa=["id","checked","onChange"],$a={key:0,class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},ka=ht(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),Ca=[ka],Da={class:"ml-3 flex items-center flex-1 min-w-0"},Sa={class:"text-sm font-medium text-gray-900 truncate"},Fa={key:0,class:"mt-4"},Ea={class:"flex items-start gap-2"},Ta=ht(()=>e("span",{class:"text-xs font-medium text-gray-500 mt-1.5 flex-shrink-0"},"Activos:",-1)),Aa={class:"flex flex-wrap gap-2"},Ma=["onClick"],ja={class:"mr-1"},Pa={class:"ml-1 p-0.5 rounded-full hover:bg-white/50 transition-colors duration-150"},La={__name:"TagFilter",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(o,{emit:_}){const l=o,u=_,D=Ne(),b=x(!1),h=x([]),k=x(!1),v=x(""),F=B(()=>D.sortedTags),q=B(()=>{if(!v.value.trim())return F.value;const i=v.value.toLowerCase().trim();return F.value.filter(C=>C.name.toLowerCase().includes(i))}),O=i=>{const C=ct(i.color_id);return{hex:C&&C.hex?C.hex:"#9CA3AF",dark:C&&C.dark?C.dark:"#374151"}},W=()=>{b.value=!b.value,b.value&&(v.value="")},Y=i=>h.value.some(C=>C.id===i.id),ae=i=>{const C=h.value.findIndex(y=>y.id===i.id);C>=0?h.value.splice(C,1):h.value.push(i),u("update:modelValue",h.value)},K=()=>{h.value=[],u("update:modelValue",[])},S=i=>{i.target.closest(".tag-filter-container")||(b.value=!1,v.value="")};return Qe(async()=>{try{k.value=!0,await D.initTags()}catch(i){console.error("Error loading tags:",i)}finally{k.value=!1}document.addEventListener("click",S)}),Se(()=>l.modelValue,i=>{h.value=i||[]},{immediate:!0}),mt(()=>{document.removeEventListener("click",S)}),(i,C)=>(s(),r("div",Yo,[e("div",Jo,[e("button",{onClick:W,class:j(["group inline-flex items-center justify-between w-full sm:w-auto sm:min-w-[200px] px-4 py-3 border border-gray-200 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-primary transition-all duration-200",{"ring-2 ring-primary border-primary bg-blue-50":b.value,"border-primary bg-primary/5":h.value.length>0&&!b.value}])},[e("div",Xo,[a(t(Ot),{class:j(["h-5 w-5 mr-2.5 text-gray-500 group-hover:text-gray-600",{"text-primary":h.value.length>0||b.value}])},null,8,["class"]),e("span",{class:j(["text-gray-700",{"text-primary font-semibold":h.value.length>0||b.value}])}," Filtrar por etiquetas ",2),h.value.length>0?(s(),r("span",ea,p(h.value.length),1)):f("",!0)]),a(t(Oe),{class:j(["ml-3 h-4 w-4 text-gray-400 transition-all duration-200 group-hover:text-gray-600",{"rotate-180 text-primary":b.value,"text-primary":h.value.length>0&&!b.value}])},null,8,["class"])],2),a(xs,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:M(()=>[b.value?(s(),r("div",ta,[e("div",sa,[e("div",oa,[aa,F.value.length>0?(s(),r("span",ra,p(F.value.length)+" disponibles ",1)):f("",!0)]),e("div",na,[a(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Te(e("input",{"onUpdate:modelValue":C[0]||(C[0]=y=>v.value=y),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"},null,512),[[Ie,v.value]])])]),h.value.length>0?(s(),r("div",la,[e("div",ia,[e("span",da,p(h.value.length)+" etiqueta"+p(h.value.length!==1?"s":"")+" seleccionada"+p(h.value.length!==1?"s":""),1),e("button",{onClick:K,class:"text-xs text-red-600 hover:text-red-700 font-medium px-2 py-1 rounded-md hover:bg-red-50 transition-all duration-200"}," Limpiar todo ")])])):f("",!0),e("div",ca,[!k.value&&q.value.length===0&&v.value.trim()===""?(s(),r("div",ua,[a(t(Ot),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),ma])):f("",!0),!k.value&&q.value.length===0&&v.value.trim()!==""?(s(),r("div",ga,[a(t(Ge),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e("p",pa,'Sin resultados para "'+p(v.value)+'"',1),e("button",{onClick:C[1]||(C[1]=y=>v.value=""),class:"text-xs text-primary hover:text-primary-dark mt-2 font-medium"}," Ver todas las etiquetas ")])):f("",!0),k.value?(s(),r("div",ha,va)):f("",!0),!k.value&&q.value.length>0?(s(),r("div",ya,[(s(!0),r(ue,null,he(q.value,y=>(s(),r("div",{key:y.id,class:"group flex items-center px-4 py-2.5 hover:bg-gray-50 cursor-pointer transition-colors duration-150",onClick:X=>ae(y)},[e("div",xa,[e("div",_a,[e("input",{id:`tag-${y.id}`,type:"checkbox",checked:Y(y),onChange:X=>ae(y),class:"sr-only"},null,40,wa),e("div",{class:j(["w-4 h-4 border-2 rounded transition-all duration-200 flex items-center justify-center",Y(y)?"bg-primary border-primary":"border-gray-300 group-hover:border-gray-400"])},[Y(y)?(s(),r("svg",$a,Ca)):f("",!0)],2)])]),e("div",Da,[e("div",{class:"w-3 h-3 rounded-full mr-2.5 border flex-shrink-0 shadow-sm",style:Ve({backgroundColor:O(y).hex})},null,4),e("span",Sa,p(y.name),1)])],8,ba))),128))])):f("",!0)])])):f("",!0)]),_:1})]),h.value.length>0?(s(),r("div",Fa,[e("div",Ea,[Ta,e("div",Aa,[(s(!0),r(ue,null,he(h.value,y=>(s(),r("div",{key:y.id,class:"group inline-flex items-center pl-2.5 pr-1.5 py-1.5 rounded-lg text-xs font-medium border shadow-sm cursor-pointer transition-all duration-200 hover:shadow-md",style:Ve({backgroundColor:O(y).hex+"20",borderColor:O(y).hex+"40",color:O(y).dark}),onClick:X=>ae(y)},[e("div",{class:"w-2 h-2 rounded-full mr-2 flex-shrink-0",style:Ve({backgroundColor:O(y).hex})},null,4),e("span",ja,p(y.name),1),e("div",Pa,[a(t(Ee),{class:"h-3 w-3 opacity-60 group-hover:opacity-100"})])],12,Ma))),128))])])])):f("",!0)]))}},Ba=St(La,[["__scopeId","data-v-d403a707"]]),Ra={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},za={class:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden"},Ia={class:"border-b"},Ua={class:"hidden sm:flex justify-between items-center p-6"},Oa=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Na={class:"text-sm text-gray-600"},qa={class:"sm:hidden p-4"},Va={class:"flex justify-between items-start mb-2"},Qa={class:"flex-1 min-w-0 mr-3"},Wa=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Ga={class:"text-sm text-gray-600 truncate"},Ha={class:"border-b"},Za={class:"hidden sm:flex space-x-8 px-6","aria-label":"Tabs"},Ka=["onClick"],Ya={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},Ja={class:"sm:hidden relative px-4 py-3"},Xa={class:"flex items-center"},er={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},tr=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),sr=[tr],or={class:"absolute top-full left-4 right-4 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},ar=["onClick"],rr={class:"border-b bg-gray-50 p-4 sm:p-6"},nr={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},lr={class:"flex-1"},ir={key:0,class:"flex items-center gap-3"},dr={class:"text-sm text-gray-600"},cr={class:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-350px)]"},ur={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},mr=["onClick"],gr=e("span",null,"Etiquetas",-1),pr=[gr],hr={key:5,class:"absolute top-2 left-2 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center shadow-sm"},fr={key:0,class:"text-center py-8 sm:py-12"},vr={class:"text-lg font-medium text-gray-900 mb-2"},yr={class:"text-gray-600 text-sm sm:text-base"},br={class:"border-t bg-gray-50"},xr={class:"hidden sm:flex justify-between items-center p-6"},_r={class:"text-sm text-gray-600"},wr={class:"flex gap-3"},$r=["disabled"],kr={class:"sm:hidden p-4 space-y-3"},Cr={class:"text-center text-sm text-gray-600"},Dr={class:"flex gap-3"},Sr=["disabled"],Fr={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 p-4"},Er={class:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] flex flex-col"},Tr={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},Ar={class:"flex items-center gap-2"},Mr=e("h2",{class:"text-sm font-semibold text-gray-900"},"Etiquetas del documento",-1),jr={class:"px-4 py-3 border-b border-gray-100 text-xs text-gray-500"},Pr=e("span",{class:"font-medium text-gray-700"},"Documento:",-1),Lr={class:"ml-1"},Br={class:"px-4 py-3 overflow-y-auto"},Rr={key:0,class:"text-sm text-gray-500"},zr={key:1,class:"space-y-2 text-sm"},Ir={class:"flex items-center gap-2 min-w-0"},Ur={key:0,class:"text-xs text-gray-500 truncate max-w-[8rem]"},Or={__name:"AddDocumentsModal",props:{isVisible:{type:Boolean,required:!0},folder:{type:Object,default:null}},emits:["close","add-documents"],setup(o,{emit:_}){const l=o,u=_,D=Ne(),b=Ze(),h=x([]),k=x([]),v=x("my-documents"),F=x(!1),q=x(!1),O=x(!1),W=x(null),Y=[{name:"my-documents",label:"Mis Documentos"},{name:"use-documents",label:"Minutas"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Documentos Firmados"}],ae=B(()=>b.currentUser);Se(()=>l.isVisible,Z=>{Z&&(h.value=[],k.value=[],v.value="my-documents")}),Se(v,()=>{h.value=[]}),Se(k,()=>{h.value=[]},{deep:!0});const K=B(()=>{const Z=i(v.value);return Z.length===0?!1:Z.every(V=>h.value.includes(V.id))}),S=Z=>{var L;if(!l.folder)return[];const V=l.folder.documents.map(de=>de.id);let R=[];switch(Z){case"my-documents":R=D.progressAndCompletedDocumentsByClient((L=ae.value)==null?void 0:L.id);break;case"use-documents":R=D.publishedDocumentsUnassigned;break;case"pending-signatures":R=D.documents.filter(de=>{var ve,z;return de.state==="PendingSignatures"&&(de.assigned_to===((ve=ae.value)==null?void 0:ve.id)||((z=de.signatures)==null?void 0:z.some(Q=>{var I;return Q.signer_email===((I=ae.value)==null?void 0:I.email)})))});break;case"signed-documents":R=D.documents.filter(de=>{var ve,z;return de.state==="FullySigned"&&(de.assigned_to===((ve=ae.value)==null?void 0:ve.id)||((z=de.signatures)==null?void 0:z.some(Q=>{var I;return Q.signer_email===((I=ae.value)==null?void 0:I.email)})))});break;default:R=[]}return R.filter(de=>!V.includes(de.id))},i=Z=>{const V=S(Z);if(!k.value||k.value.length===0)return V;const R=k.value.map(L=>L.id);return V.filter(L=>!L.tags||L.tags.length===0?!1:L.tags.some(de=>R.includes(de.id)))},C=Z=>{const V=h.value.indexOf(Z);V>-1?h.value.splice(V,1):h.value.push(Z)},y=()=>{const V=i(v.value).map(R=>R.id);if(K.value)h.value=h.value.filter(R=>!V.includes(R));else{const R=V.filter(L=>!h.value.includes(L));h.value.push(...R)}},X=()=>{u("close")},P=async()=>{if(h.value.length!==0){F.value=!0;try{await u("add-documents",h.value)}finally{F.value=!1}}},E=Z=>{v.value=Z,q.value=!1},N=Z=>{Z.target.closest(".relative")||(q.value=!1)};Qe(()=>{document.addEventListener("click",N)}),mt(()=>{document.removeEventListener("click",N)});const G=Z=>{const V=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],R=Z.id%V.length;return V[R]},re=Z=>{W.value=Z,O.value=!0},le=()=>{O.value=!1,W.value=null};return(Z,V)=>o.isVisible&&o.folder?(s(),oe(He,{key:0},{default:M(()=>{var R;return[e("div",Ra,[e("div",za,[e("div",Ia,[e("div",Ua,[e("div",null,[Oa,e("p",Na,'Selecciona documentos para agregar a "'+p(o.folder.name)+'"',1)]),e("button",{onClick:X,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors"},[a(t(Ee),{class:"w-5 h-5"})])]),e("div",qa,[e("div",Va,[e("div",Qa,[Wa,e("p",Ga,'Para "'+p(o.folder.name)+'"',1)]),e("button",{onClick:X,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors flex-shrink-0"},[a(t(Ee),{class:"w-5 h-5"})])])])]),e("div",Ha,[e("nav",Za,[(s(),r(ue,null,he(Y,L=>e("button",{key:L.name,onClick:de=>v.value=L.name,class:j([v.value===L.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[te(p(L.label)+" ",1),e("span",Ya,p(i(L.name).length),1)],10,Ka)),64))]),e("div",Ja,[e("button",{onClick:V[0]||(V[0]=L=>q.value=!q.value),class:"w-full flex items-center justify-between py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("div",Xa,[e("span",null,p(((R=Y.find(L=>L.name===v.value))==null?void 0:R.label)||"Seleccionar categoría"),1),e("span",er,p(i(v.value).length),1)]),(s(),r("svg",{class:j(["ml-2 h-5 w-5 transition-transform duration-200",q.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},sr,2))]),Te(e("div",or,[(s(),r(ue,null,he(Y,L=>e("button",{key:L.name,onClick:de=>E(L.name),class:j(["w-full text-left px-4 py-3 text-sm transition-colors duration-150 flex items-center justify-between",v.value===L.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},[e("span",null,p(L.label),1),e("span",{class:j(["py-0.5 px-2 rounded-full text-xs",v.value===L.name?"bg-white/20 text-white":"bg-gray-100 text-gray-600"])},p(i(L.name).length),3)],10,ar)),64))],512),[[gt,q.value]])])]),e("div",rr,[e("div",nr,[e("div",lr,[a(Ba,{modelValue:k.value,"onUpdate:modelValue":V[1]||(V[1]=L=>k.value=L),class:"max-w-md"},null,8,["modelValue"])]),i(v.value).length>0?(s(),r("div",ir,[e("span",dr,p(i(v.value).length)+" documento(s) disponible(s) ",1),e("button",{onClick:y,class:j(["px-4 py-2 rounded-lg border font-medium text-sm transition-colors",K.value?"bg-red-50 border-red-200 text-red-700 hover:bg-red-100":"bg-primary text-white border-primary hover:bg-primary-dark"])},p(K.value?"Deseleccionar todos":"Seleccionar todos"),3)])):f("",!0)])]),e("div",cr,[e("div",ur,[(s(!0),r(ue,null,he(i(v.value),L=>(s(),r("div",{key:L.id,class:"relative"},[v.value==="my-documents"?(s(),oe(t(As),{key:0,document:L,"highlighted-doc-id":null,"show-tags":!1,"show-client-name":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":h.value.includes(L.id)?"ring-2 ring-primary bg-primary-50":"",onClick:de=>C(L.id)},null,8,["document","additional-classes","onClick"])):f("",!0),v.value==="use-documents"?(s(),oe(t(Js),{key:1,document:L,"show-tags":!1,"menu-options":[],"show-menu-options":!1,"disable-internal-actions":!0,"additional-classes":h.value.includes(L.id)?"ring-2 ring-primary bg-primary-50":"",onClick:de=>C(L.id)},null,8,["document","additional-classes","onClick"])):f("",!0),v.value==="pending-signatures"?(s(),oe(t(Jt),{key:2,document:L,"highlighted-doc-id":null,"show-tags":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":h.value.includes(L.id)?"ring-2 ring-primary bg-primary-50":"",onClick:de=>C(L.id)},null,8,["document","additional-classes","onClick"])):f("",!0),v.value==="signed-documents"?(s(),oe(t(Jt),{key:3,document:L,"highlighted-doc-id":null,"show-tags":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":h.value.includes(L.id)?"ring-2 ring-primary bg-primary-50":"",onClick:de=>C(L.id)},null,8,["document","additional-classes","onClick"])):f("",!0),L.tags&&L.tags.length>0?(s(),r("button",{key:4,type:"button",class:"absolute bottom-2 right-2 px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 inline-flex items-center gap-1",onClick:pe(de=>re(L),["stop"])},pr,8,mr)):f("",!0),h.value.includes(L.id)?(s(),r("div",hr,[a(t(Ms),{class:"w-4 h-4"})])):f("",!0)]))),128))]),i(v.value).length===0?(s(),r("div",fr,[a(t(ot),{class:"w-12 h-12 sm:w-16 sm:h-16 text-gray-300 mx-auto mb-4"}),e("h4",vr,p(k.value.length>0?"No hay documentos que coincidan con el filtro":"No hay documentos disponibles"),1),e("p",yr,p(k.value.length>0?"Intenta ajustar los filtros de etiquetas o selecciona otra categoría":"No tienes documentos de esta categoría que no estén ya en la carpeta"),1)])):f("",!0)]),e("div",br,[e("div",xr,[e("div",_r,p(h.value.length)+" documento(s) seleccionado(s) ",1),e("div",wr,[e("button",{onClick:X,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{onClick:P,disabled:h.value.length===0||F.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},p(F.value?"Agregando...":`Agregar ${h.value.length} documento(s)`),9,$r)])]),e("div",kr,[e("div",Cr,p(h.value.length)+" documento(s) seleccionado(s) ",1),e("div",Dr,[e("button",{onClick:X,class:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center font-medium"}," Cancelar "),e("button",{onClick:P,disabled:h.value.length===0||F.value,class:"flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-center font-medium"},p(F.value?"Agregando...":"Agregar"),9,Sr)])])]),O.value&&W.value?(s(),r("div",Fr,[e("div",Er,[e("div",Tr,[e("div",Ar,[a(t(ot),{class:"h-5 w-5 text-gray-500"}),Mr]),e("button",{type:"button",class:"text-gray-400 hover:text-gray-600 p-1 rounded-md hover:bg-gray-100",onClick:le},[a(t(Ee),{class:"h-5 w-5"})])]),e("div",jr,[Pr,e("span",Lr,p(W.value.title||"Sin título"),1)]),e("div",Br,[!W.value.tags||W.value.tags.length===0?(s(),r("div",Rr," Este documento no tiene etiquetas. ")):(s(),r("ul",zr,[(s(!0),r(ue,null,he(W.value.tags,L=>(s(),r("li",{key:L.id,class:"flex items-center justify-between gap-2"},[e("div",Ir,[e("span",{class:j(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",G(L)])},p(L.name),3)]),L.description?(s(),r("span",Ur,p(L.description),1)):f("",!0)]))),128))]))]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end"},[e("button",{type:"button",class:"px-4 py-2 text-sm font-medium rounded-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-50",onClick:le}," Cerrar ")])])])):f("",!0)])])]}),_:1})):f("",!0)}},nt=o=>($t("data-v-d9a5a89f"),o=o(),kt(),o),Nr={class:"folders-table"},qr={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200",style:{"overflow-x":"visible","overflow-y":"hidden"}},Vr={class:"min-w-full divide-y divide-gray-200"},Qr=nt(()=>e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Carpeta "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documentos "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Creada "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1)),Wr={class:"bg-white divide-y divide-gray-200"},Gr=["onClick"],Hr={class:"px-6 py-4 whitespace-nowrap"},Zr={class:"flex items-center"},Kr={class:"flex-shrink-0 h-10 w-10"},Yr={class:"ml-4"},Jr={class:"text-sm font-medium text-gray-900"},Xr={class:"px-6 py-4 whitespace-nowrap"},en={class:"flex items-center gap-2"},tn={class:"text-sm text-gray-900"},sn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},on={class:"py-1"},an=["onClick"],rn=["onClick"],nn=["onClick"],ln=["onClick"],dn={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},cn=nt(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No tienes carpetas aún",-1)),un=nt(()=>e("p",{class:"text-gray-600 mb-6"},"Crea tu primera carpeta para organizar tus documentos",-1)),mn={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},gn=nt(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No se encontraron carpetas",-1)),pn=nt(()=>e("p",{class:"text-gray-600"},"No hay carpetas que coincidan con tu búsqueda",-1)),hn={key:3,class:"flex justify-center items-center py-12"},fn=nt(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)),vn=[fn],yn={__name:"FoldersTable",props:{sortedFolders:{type:Array,required:!0},searchQuery:{type:String,default:""},isLoading:{type:Boolean,default:!1}},emits:["folder-click","edit-folder","delete-folder","add-documents","create-folder"],setup(o,{emit:_}){const l=o,u=_,D=x({}),b=x({}),h=x(!1),k=x(-1),v=B(()=>{if(!l.searchQuery.trim())return l.sortedFolders;const P=l.searchQuery.toLowerCase();return l.sortedFolders.filter(E=>E.name.toLowerCase().includes(P))}),F=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],q=P=>{if(P.color)return F.find(N=>N.name===P.color)||F[0];const E=P.id%F.length;return F[E]},O=P=>{if(!P)return"-";const E=new Date(P),G=Math.abs(new Date-E),re=Math.ceil(G/(1e3*60*60*24));return re===0?"Hoy":re===1?"Ayer":re<7?`Hace ${re} días`:re<30?`Hace ${Math.floor(re/7)} semanas`:re<365?`Hace ${Math.floor(re/30)} meses`:E.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},W=P=>{u("folder-click",P)},Y=P=>{u("edit-folder",P)},ae=P=>{u("delete-folder",P)},K=P=>{u("add-documents",P)},S=()=>{u("create-folder")},i=()=>h.value?v.value.length===1?"280px":v.value.length===2&&k.value===1?"340px":"280px":"auto",C=(P,E)=>{P&&(D.value[E]=P)},y=(P,E)=>{P&&(b.value[E]=P)},X=(P,E)=>{h.value=!E,k.value=E?-1:P,E||setTimeout(()=>{const N=b.value[P];if(N){const G=N.$el||N;if(G&&G.getBoundingClientRect){const re=G.getBoundingClientRect(),le=window.innerHeight;if(P===0){if(re.bottom>le-20){const Z=re.bottom-le+40;window.scrollBy({top:Z,behavior:"smooth"})}}else if(re.bottom>le-10){const Z=re.bottom-le+30;window.scrollBy({top:Z,behavior:"smooth"})}else if(re.top<80){const Z=re.top-100;window.scrollBy({top:Z,behavior:"smooth"})}}}},100)};return(P,E)=>(s(),r("div",Nr,[!o.isLoading&&v.value.length>0?(s(),r("div",qr,[e("div",{class:"overflow-x-auto",style:Ve({minHeight:i(),overflowY:"visible"})},[e("table",Vr,[Qr,e("tbody",Wr,[(s(!0),r(ue,null,he(v.value,(N,G)=>{var re,le;return s(),r("tr",{key:N.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:Z=>W(N)},[e("td",Hr,[e("div",Zr,[e("div",Kr,[e("div",{class:"h-10 w-10 rounded-lg flex items-center justify-center",style:Ve({backgroundColor:q(N).hex+"20"})},[a(t(_t),{class:"h-6 w-6",style:Ve({color:q(N).hex})},null,8,["style"])],4)]),e("div",Yr,[e("div",Jr,p(N.name),1)])])]),e("td",Xr,[e("div",en,[a(t(Ue),{class:"h-5 w-5 text-gray-400"}),e("span",tn,p(((re=N.documents)==null?void 0:re.length)||0)+" documento"+p((((le=N.documents)==null?void 0:le.length)||0)!==1?"s":""),1)])]),e("td",sn,p(O(N.created_at)),1),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:E[0]||(E[0]=pe(()=>{},["stop"]))},[a(t(je),{as:"div",class:"relative inline-block text-left"},{default:M(({open:Z})=>[a(t(Pe),{ref_for:!0,ref:V=>C(V,G),onClick:V=>X(G,Z),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:M(()=>[a(t(rt),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),a(t(Le),{ref_for:!0,ref:V=>y(V,G),class:j([v.value.length>2&&G>0&&G>=v.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:M(()=>[e("div",on,[a(t(ye),null,{default:M(({active:V})=>[e("a",{onClick:R=>W(N),class:j([V?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver carpeta ",10,an)]),_:2},1024),a(t(ye),null,{default:M(({active:V})=>[e("a",{onClick:R=>K(N),class:j([V?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Agregar documentos ",10,rn)]),_:2},1024),a(t(ye),null,{default:M(({active:V})=>[e("a",{onClick:R=>Y(N),class:j([V?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Editar ",10,nn)]),_:2},1024),a(t(ye),null,{default:M(({active:V})=>[e("a",{onClick:R=>ae(N),class:j([V?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Eliminar ",10,ln)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,Gr)}),128))])])],4)])):!o.isLoading&&o.sortedFolders.length===0?(s(),r("div",dn,[a(t(_t),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),cn,un,e("button",{onClick:S,class:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"},[a(t(Ke),{class:"w-5 h-5"}),te(" Crear Primera Carpeta ")])])):!o.isLoading&&o.sortedFolders.length>0&&v.value.length===0?(s(),r("div",mn,[a(t(_t),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),gn,pn])):f("",!0),o.isLoading?(s(),r("div",hn,vn)):f("",!0)]))}},bn=St(yn,[["__scopeId","data-v-d9a5a89f"]]),ms=o=>($t("data-v-810ea6af"),o=o(),kt(),o),xn={class:"folder-management"},_n={class:"mb-6"},wn={class:"hidden sm:flex justify-between items-center"},$n=ms(()=>e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),kn={class:"sm:hidden"},Cn=ms(()=>e("div",{class:"text-center mb-4"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1 px-2"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Dn={__name:"FolderManagement",props:{searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","navigate-to-main"],setup(o,{emit:_}){const l=o,u=_,D=Ht(),b=Ne(),h=Ze(),k=x(!1),v=x(null),F=x(null),q=x(!1),O=x(null),W=B(()=>D.isLoading),Y=B(()=>D.sortedFolders);B(()=>h.currentUser),Qe(async()=>{await D.init(),await b.init()}),Se(()=>l.searchQuery,()=>{}),Se(()=>D.folders,R=>{var L,de;if(F.value&&R&&R.length>0){const ve=R.find(z=>z.id===F.value.id);if(ve){const z=((L=F.value.documents)==null?void 0:L.length)||0,Q=((de=ve.documents)==null?void 0:de.length)||0;JSON.stringify(F.value)!==JSON.stringify(ve)&&(F.value={...ve},console.log(`🔄 FolderManagement: Synced selectedFolder "${ve.name}" with store. Documents: ${z} → ${Q}`))}}},{deep:!0});const ae=()=>{v.value=null,k.value=!0},K=R=>{v.value=R,k.value=!0},S=()=>{k.value=!1,v.value=null},i=()=>{S()},C=R=>{F.value=R},y=()=>{F.value=null},X=async R=>{if(confirm(`¿Estás seguro de que quieres eliminar la carpeta "${R.name}"?`))try{await D.deleteFolder(R.id),Ce(`Carpeta "${R.name}" eliminada correctamente`,"success")}catch(L){Ce("Error al eliminar la carpeta","error"),console.error("Error deleting folder:",L)}},P=R=>{O.value=R,q.value=!0},E=async(R=!1)=>{if(q.value=!1,O.value=null,R&&F.value)try{await N()}catch(L){console.warn("Error refreshing folder after adding documents:",L)}},N=async()=>{if(F.value)try{await D.fetchFolder(F.value.id);const R=D.getFolderById(F.value.id);R&&(F.value={...R},console.log("✅ Selected folder refreshed successfully"))}catch(R){throw console.error("❌ Error refreshing selected folder:",R),R}},G=async R=>{var L,de,ve;if(!(!O.value||R.length===0))try{const z=O.value.documents.map(J=>J.id).filter(J=>J!=null&&!isNaN(parseInt(J))).map(J=>parseInt(J)),Q=R.filter(J=>J!=null&&!isNaN(parseInt(J))).map(J=>parseInt(J)),I=[...new Set([...z,...Q])];if(console.log("Current document IDs:",z),console.log("Selected document IDs:",Q),console.log("Updated document IDs:",I),I.some(J=>!Number.isInteger(J)||J<=0))throw new Error("IDs de documentos inválidos detectados");await D.updateFolder(O.value.id,{document_ids:I}),await E(!0),Ce(`${Q.length} documento(s) agregado(s) a la carpeta`,"success"),u("navigate-to-main")}catch(z){console.error("Error adding documents to folder:",z),console.error("Error details:",((L=z.response)==null?void 0:L.data)||z.message),(de=z.response)!=null&&de.status?Ce(`Error al agregar documentos: ${((ve=z.response.data)==null?void 0:ve.detail)||z.message}`,"error"):Ce("Error al agregar documentos a la carpeta","error")}},re=async R=>{var L,de,ve;if(F.value)try{const z=parseInt(R);if(!Number.isInteger(z)||z<=0)throw new Error("ID de documento inválido");const Q=F.value.documents.map(I=>I.id).filter(I=>I!=null&&!isNaN(parseInt(I))).map(I=>parseInt(I)).filter(I=>I!==z);console.log("Removing document ID:",z),console.log("Updated document IDs after removal:",Q),await D.updateFolder(F.value.id,{document_ids:Q}),Ce("Documento removido de la carpeta","success"),F.value=null,u("navigate-to-main")}catch(z){console.error("Error removing document from folder:",z),console.error("Error details:",((L=z.response)==null?void 0:L.data)||z.message),(de=z.response)!=null&&de.status?Ce(`Error al remover documento: ${((ve=z.response.data)==null?void 0:ve.detail)||z.message}`,"error"):Ce("Error al remover el documento de la carpeta","error")}},le=R=>{console.log("View document:",R)},Z=R=>{console.log("Use document:",R)},V=(R,L)=>{console.log("Document action:",R,L)};return(R,L)=>(s(),r("div",xn,[e("div",_n,[e("div",wn,[$n,e("button",{onClick:ae,class:"inline-flex items-center gap-2 px-4 py-2.5 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md"},[a(t(Ke),{class:"w-5 h-5"}),te(" Nueva Carpeta ")])]),e("div",kn,[Cn,e("button",{onClick:ae,class:"w-full flex items-center justify-center gap-3 px-4 py-4 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium text-base"},[a(t(Ke),{class:"w-6 h-6"}),te(" Nueva Carpeta ")])])]),a(t(bn),{"sorted-folders":Y.value,"search-query":o.searchQuery,"is-loading":W.value,onFolderClick:C,onEditFolder:K,onDeleteFolder:X,onAddDocuments:P,onCreateFolder:ae},null,8,["sorted-folders","search-query","is-loading"]),a(t(fo),{"is-visible":k.value,"editing-folder":v.value,onClose:S,onSuccess:i},null,8,["is-visible","editing-folder"]),a(t(Ko),{folder:F.value,onClose:y,onAddDocuments:P,onRemoveDocument:re,onViewDocument:le,onUseDocument:Z,onDocumentAction:V},null,8,["folder"]),a(t(Or),{"is-visible":q.value,folder:O.value,onClose:E,onAddDocuments:G},null,8,["is-visible","folder"])]))}},os=St(Dn,[["__scopeId","data-v-810ea6af"]]);function Sn(o){return!o.variables||o.variables.length===0?!0:o.variables.every(_=>_.name_es&&_.name_es.trim().length>0)}function xt(o,_){var D;if(!o.requires_signature||o.state!=="PendingSignatures"||!o.signatures||o.signatures.length===0)return!1;const l=(D=_==null?void 0:_.currentUser)==null?void 0:D.email,u=o.signatures.find(b=>b.signer_email===l);return!(!u||u.signed)}const Fn={lawyer:{getMenuOptions:(o,_,l)=>{let u;return _==="legal-documents"&&(o.state==="Draft"||o.state==="Published")?u=[{label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Actualizar nombre",action:"edit"},{label:"Editar documento",action:"editDocument"},{label:"Editar configuración de variables",action:"editForm"}]},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}]:u=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}],o.state!=="Draft"&&o.state!=="Published"&&u.splice(2,0,{label:"Administrar Asociaciones",action:"relationships"}),o.state==="Draft"?u.push({label:"Publicar",action:"publish",disabled:!Sn(o)}):o.state==="Published"&&u.push({label:"Mover a Borrador",action:"draft"}),(o.state==="Completed"||o.state==="Published")&&u.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),o.requires_signature&&(o.state==="PendingSignatures"||o.state==="FullySigned")&&(u.push({label:"Ver Firmas",action:"viewSignatures"}),xt(o,l)&&u.push({label:"Firmar documento",action:"sign"})),u}},signatures:{getMenuOptions:(o,_,l)=>{const u=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}],D=o.relationships_count&&o.relationships_count>0;return u.push({label:"Administrar Asociaciones",action:"relationships",disabled:!D}),o.requires_signature&&["PendingSignatures","FullySigned","Rejected","Expired"].includes(o.state)&&u.push({label:"Estado de las firmas",action:"viewSignatures"}),xt(o,l)&&u.push({label:"Firmar documento",action:"sign"}),o.state==="PendingSignatures"&&xt(o,l)&&u.push({label:"Rechazar documento",action:"reject"}),o.state==="FullySigned"&&u.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),o.state==="PendingSignatures"&&u.push({label:"Descargar PDF",action:"downloadPDF"}),o.state==="Rejected"&&Array.isArray(o.signatures)&&o.signatures.some(h=>h.rejection_comment)&&u.push({label:"Ver motivo del rechazo",action:"viewRejectionReason"}),u}},client:{getMenuOptions:(o,_,l)=>{var v,F,q,O;const u=[],D=((v=l==null?void 0:l.currentUser)==null?void 0:v.role)==="basic",b=((F=l==null?void 0:l.currentUser)==null?void 0:F.role)==="corporate_client"||((q=l==null?void 0:l.currentUser)==null?void 0:q.role)==="client",h=((O=l==null?void 0:l.currentUser)==null?void 0:O.role)==="lawyer",k=o.state==="Progress";if(o.state==="Completed"?(u.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Editar Formulario",action:"editForm"}]}),(b||D||h)&&u.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:D})):o.state==="Progress"?(u.push({label:"Completar",action:"editForm"}),(b||D||h)&&u.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:!0})):u.push({label:"Completar",action:"editForm"}),(o.state==="Completed"||o.state==="Progress")&&u.push({label:"Previsualizar",action:"preview"}),u.push({label:"Eliminar",action:"delete"}),D?u.push({label:"Gestionar Membrete",action:"letterhead",disabled:!0}):u.push({label:"Gestionar Membrete",action:"letterhead"}),u.push({label:"Administrar Asociaciones",action:"relationships",disabled:D||k}),o.requires_signature){const Y=["PendingSignatures","FullySigned","Rejected","Expired"].includes(o.state);_!=="my-documents"&&Y&&(u.push({label:"Ver Firmas",action:"viewSignatures"}),xt(o,l)&&u.push({label:"Firmar documento",action:"sign"}))}return o.state==="Completed"&&u.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord",disabled:D},{label:"Enviar",action:"email",disabled:D}),u}}};function En(o,_,l="list",u=null){const D=Fn[o];return D?D.getMenuOptions(_,l,u):[]}function gs(){const o=Ze(),_=B(()=>{var b;return((b=o.currentUser)==null?void 0:b.role)==="basic"}),l=b=>{Ce("Esta funcionalidad está restringida para usuarios básicos. Por favor, contacta a tu abogado para obtener acceso completo.","warning")};return{isBasicUser:_,showRestrictionNotification:l,handleFeatureAccess:(b,h)=>_.value?(l(),!1):(h&&h(),!0),getRestrictedButtonClasses:b=>b?"opacity-60 cursor-not-allowed":""}}const Tn={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},An={class:"px-6 py-4 border-b border-gray-200"},Mn=e("h2",{class:"text-xl font-semibold text-gray-800"},"Acciones del Documento",-1),jn={class:"text-sm text-gray-500 mt-1"},Pn={class:"p-6 overflow-y-auto flex-grow"},Ln={class:"space-y-4"},Bn={key:0,class:"text-sm font-semibold text-gray-700 uppercase tracking-wide px-2"},Rn={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},zn=["onClick","disabled"],In={class:"text-sm font-medium"},Un={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},On=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Nn={key:1,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},qn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Vn={key:2,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Qn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Wn={key:3,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Gn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Hn={key:1,class:"border-t border-gray-200 my-4"},Zn={key:0,class:"text-center py-12"},Kn=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay acciones disponibles",-1),Yn=e("p",{class:"mt-1 text-sm text-gray-500"}," No hay opciones disponibles para este documento. ",-1),Mt={__name:"DocumentActionsModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null},cardType:{type:String,required:!0,validator:o=>["lawyer","client","signatures"].includes(o)},context:{type:String,default:"table"},userStore:{type:Object,default:null}},emits:["close","action"],setup(o,{emit:_}){const l=o,u=_,D=B(()=>l.document?En(l.cardType,l.document,l.context,l.userStore):[]),b=B(()=>{const S=D.value;if(!S||S.length===0)return[];const i=[],C={edit:"Edición",view:"Visualización",share:"Compartir",manage:"Gestión",signatures:"Firmas",delete:"Eliminación"},y={edit:[],view:[],share:[],manage:[],signatures:[],delete:[]};return S.forEach(X=>{if(X.children&&Array.isArray(X.children))X.children.forEach(P=>{const E=P.action.toLowerCase();h(P,E,y)});else{const P=X.action.toLowerCase();h(X,P,y)}}),y.edit.length>0&&i.push({title:C.edit,options:y.edit}),y.view.length>0&&i.push({title:C.view,options:y.view}),y.share.length>0&&i.push({title:C.share,options:y.share}),y.signatures.length>0&&i.push({title:C.signatures,options:y.signatures}),y.manage.length>0&&i.push({title:C.manage,options:y.manage}),y.delete.length>0&&i.push({title:C.delete,options:y.delete}),i}),h=(S,i,C)=>{i.includes("edit")||i.includes("editar")||i==="copy"||i==="draft"||i==="publish"||i==="completar"?C.edit.push(S):i.includes("signature")||i.includes("firma")||i.includes("sign")||i==="reject"?C.signatures.push(S):i.includes("view")||i.includes("preview")||i.includes("ver")||i.includes("previsualización")?C.view.push(S):i.includes("download")||i.includes("email")||i.includes("enviar")||i.includes("descargar")?C.share.push(S):i.includes("permission")||i.includes("relationship")||i.includes("letterhead")||i.includes("permiso")||i.includes("asociación")||i.includes("membrete")||i==="formalize"?C.manage.push(S):i.includes("delete")||i.includes("eliminar")?C.delete.push(S):C.manage.push(S)},k=S=>{const i=S.toLowerCase();return i==="sign"||i.includes("firmar")?wt:i==="editform"||i.includes("completar")?ss:i==="editdocument"||i.includes("editar documento")?Xt:i.includes("edit")||i==="editar"?Xt:i.includes("delete")||i==="eliminar"?Nt:i.includes("preview")||i.includes("ver")||i.includes("previsualización")?is:i==="copy"||i.includes("copia")?Ss:i.includes("download")||i.includes("descargar")?st:i.includes("email")||i.includes("enviar")?ws:i.includes("permission")||i.includes("permiso")?js:i.includes("relationship")||i.includes("asociación")?ds:i.includes("letterhead")||i.includes("membrete")?cs:i==="reject"||i.includes("rechazar")?Is:i.includes("signature")||i.includes("firma")?wt:i==="publish"||i.includes("publicar")?zs:i==="draft"||i.includes("borrador")?Ue:i==="formalize"||i.includes("formalizar")?ss:ot},v=S=>{const i=S.toLowerCase();return i.includes("delete")||i==="eliminar"||i==="reject"||i.includes("rechazar")?"text-red-600":i==="sign"||i.includes("firmar")?"text-green-600":i.includes("download")||i.includes("descargar")?"text-blue-600":i.includes("email")||i.includes("enviar")?"text-green-600":i.includes("signature")||i.includes("firma")?"text-purple-600":"text-gray-600"},F=S=>{const i=S.toLowerCase();return i.includes("delete")||i==="eliminar"||i==="reject"||i.includes("rechazar")?"border-red-200 bg-red-50 text-red-700 hover:bg-red-100 hover:border-red-300":i==="sign"||i.includes("firmar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":i.includes("download")||i.includes("descargar")?"border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 hover:border-blue-300":i.includes("email")||i.includes("enviar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":i.includes("signature")||i.includes("firma")?"border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-100 hover:border-purple-300":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-300"},{isBasicUser:q,handleFeatureAccess:O}=gs(),W=["formalize","letterhead","relationships","downloadWord","email"],Y=S=>{const i=S.toLowerCase();return W.some(C=>i===C.toLowerCase())},ae=S=>{const i=D.value.find(y=>y.action===S?y:y.children?y.children.find(X=>X.action===S):null),C=i!=null&&i.children?i.children.find(y=>y.action===S):i;if(C!=null&&C.disabled){O("Esta funcionalidad",null);return}u("action",S,l.document)},K=()=>{u("close")};return(S,i)=>Te((s(),oe(He,null,{default:M(()=>{var C;return[e("div",Tn,[e("div",An,[Mn,e("p",jn,p(((C=o.document)==null?void 0:C.title)||"Cargando..."),1),e("button",{onClick:K,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500 transition-colors"},[a(t(Ee),{class:"h-6 w-6"})])]),e("div",Pn,[e("div",Ln,[(s(!0),r(ue,null,he(b.value,(y,X)=>(s(),r("div",{key:X,class:"space-y-2"},[y.title?(s(),r("h3",Bn,p(y.title),1)):f("",!0),e("div",Rn,[(s(!0),r(ue,null,he(y.options,P=>{var E,N;return s(),r("div",{key:P.action,class:"relative group"},[e("button",{onClick:G=>ae(P.action),disabled:P.disabled,class:j(["flex items-center justify-start w-full px-4 py-3 rounded-lg border transition-all duration-200",P.disabled?"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed opacity-60":F(P.action),"hover:shadow-md hover:scale-[1.02]"])},[(s(),oe(_s(k(P.action)),{class:j(["h-5 w-5 mr-3 flex-shrink-0",P.disabled?"text-gray-400":v(P.action)])},null,8,["class"])),e("span",In,p(P.label),1),P.disabled?(s(),oe(t(Es),{key:0,class:"h-4 w-4 ml-auto text-gray-400"})):f("",!0)],10,zn),P.disabled&&P.action==="relationships"&&!t(q)&&((E=o.document)==null?void 0:E.state)==="Progress"?(s(),r("div",Un,[te(" Solo puedes administrar asociaciones cuando el documento está completado. "),On])):P.disabled&&P.action==="relationships"&&!t(q)?(s(),r("div",Nn,[te(" Este documento no tiene documentos asociados. "),qn])):P.disabled&&P.action==="formalize"&&((N=o.document)==null?void 0:N.state)!=="Completed"?(s(),r("div",Vn,[te(" Solo puedes formalizar y agregar firmas cuando el documento está completado. "),Qn])):P.disabled&&t(q)&&Y(P.action)?(s(),r("div",Wn,[te(" Actualiza tu suscripción para usar esta funcionalidad "),Gn])):f("",!0)])}),128))]),X<b.value.length-1?(s(),r("div",Hn)):f("",!0)]))),128)),b.value.length===0?(s(),r("div",Zn,[a(t(ot),{class:"mx-auto h-12 w-12 text-gray-400"}),Kn,Yn])):f("",!0)])])])]}),_:1},512)),[[gt,o.isVisible]])}},Jn={class:"bg-white rounded-xl shadow-xl max-w-lg w-full mx-4"},Xn={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},el=e("h2",{class:"text-sm font-semibold text-gray-900"}," Información clave del documento ",-1),tl=e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.8",d:"M6 6l8 8M6 14L14 6"})],-1),sl=[tl],ol={class:"px-4 py-4 space-y-4 text-sm text-gray-800 max-h-[70vh] overflow-y-auto"},al={key:0},rl=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Usuario / Contraparte ",-1),nl={class:"text-gray-900 break-words"},ll={key:1},il=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Objeto ",-1),dl={class:"text-gray-900 whitespace-pre-line"},cl={key:2},ul=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Valor ",-1),ml={class:"text-gray-900 font-medium text-base"},gl={key:3},pl=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Plazo ",-1),hl={class:"text-gray-900"},fl={key:4},vl=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Fechas ",-1),yl={class:"space-y-1 text-gray-900"},bl={key:0},xl=e("span",{class:"font-medium"},"Suscripción:",-1),_l={class:"ml-1"},wl={key:1},$l=e("span",{class:"font-medium"},"Vigencia:",-1),kl={class:"ml-1"},Cl={key:0},Dl={key:1},Sl={key:2},Fl={key:5,class:"text-gray-400 text-sm"},El={class:"px-4 py-3 border-t border-gray-100 flex justify-end"},ps={__name:"DocumentSummaryModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close"],setup(o,{emit:_}){const l=o,u=B(()=>l.document&&l.document.summary_counterparty||""),D=B(()=>{if(!l.document||!l.document.summary_value)return"";const v=l.document.summary_value,F=l.document.summary_value_currency||"",q=new Intl.NumberFormat("es-CO",{minimumFractionDigits:0,maximumFractionDigits:2}).format(v);return F==="USD"?`USD $${q}`:F==="EUR"?`€${q}`:F==="COP"?`$${q} COP`:F?`${F} ${q}`:`$${q}`}),b=B(()=>l.document?!!(l.document.summary_subscription_date||l.document.summary_start_date||l.document.summary_end_date):!1),h=B(()=>l.document?!!(u.value||l.document.summary_object||D.value||l.document.summary_term||b.value):!1),k=v=>v?typeof v=="string"?v.split("T")[0]:v:"";return(v,F)=>o.isVisible&&o.document?(s(),r("div",{key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",onClick:F[2]||(F[2]=pe(q=>v.$emit("close"),["self"]))},[e("div",Jn,[e("div",Xn,[el,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:F[0]||(F[0]=q=>v.$emit("close"))},sl)]),e("div",ol,[u.value?(s(),r("div",al,[rl,e("div",nl,p(u.value),1)])):f("",!0),o.document.summary_object?(s(),r("div",ll,[il,e("div",dl,p(o.document.summary_object),1)])):f("",!0),D.value?(s(),r("div",cl,[ul,e("div",ml,p(D.value),1)])):f("",!0),o.document.summary_term?(s(),r("div",gl,[pl,e("div",hl,p(o.document.summary_term),1)])):f("",!0),b.value?(s(),r("div",fl,[vl,e("div",yl,[o.document.summary_subscription_date?(s(),r("div",bl,[xl,e("span",_l,p(k(o.document.summary_subscription_date)),1)])):f("",!0),o.document.summary_start_date||o.document.summary_end_date?(s(),r("div",wl,[$l,e("span",kl,[o.document.summary_start_date?(s(),r("span",Cl,p(k(o.document.summary_start_date)),1)):f("",!0),o.document.summary_start_date&&o.document.summary_end_date?(s(),r("span",Dl," → ")):f("",!0),o.document.summary_end_date?(s(),r("span",Sl,p(k(o.document.summary_end_date)),1)):f("",!0)])])):f("",!0)])])):f("",!0),h.value?f("",!0):(s(),r("div",Fl," Este documento aún no tiene campos clasificados para mostrar. "))]),e("div",El,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-md text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200",onClick:F[1]||(F[1]=q=>v.$emit("close"))}," Cerrar ")])])])):f("",!0)}},Tl={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},Al={class:"mb-4"},Ml={class:"relative w-full"},jl={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},Pl={class:"flex items-center gap-2 min-w-0"},Ll={class:"truncate"},Bl={class:"py-1"},Rl=["onClick"],zl={class:"flex items-center gap-2 min-w-0"},Il={class:"truncate"},Ul={class:"p-2"},Ol={class:"relative mb-2"},Nl={class:"max-h-60 overflow-y-auto"},ql=["onClick"],Vl={class:"truncate"},Ql={class:"flex items-center gap-2 min-w-0"},Wl={class:"truncate"},Gl={class:"p-2"},Hl={class:"relative mb-2"},Zl={class:"max-h-60 overflow-y-auto"},Kl=["onClick"],Yl={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Jl={class:"py-1"},Xl=["onClick"],ei={class:"flex gap-2 w-full sm:w-auto"},ti={key:0,class:"flex justify-center items-center py-12 bg-white rounded-lg shadow-sm border border-gray-200"},si=e("div",{class:"text-center"},[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e("p",{class:"text-sm text-gray-500"},"Cargando documentos...")],-1),oi=[si],ai={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},ri={class:"overflow-x-auto"},ni={class:"min-w-full divide-y divide-gray-200"},li={class:"bg-gray-50"},ii={key:0,scope:"col",class:"w-12 px-3 py-3"},di=["checked"],ci=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento ",-1),ui=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),mi=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Información clave ",-1),gi={key:1,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},pi=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas ",-1),hi={class:"bg-white divide-y divide-gray-200"},fi=["onClick"],vi={key:0,class:"px-3 py-4"},yi=["checked","onChange"],bi={class:"px-6 py-4"},xi={class:"flex items-center gap-3"},_i={class:"min-w-0"},wi=["onClick"],$i={class:"px-6 py-4 whitespace-nowrap"},ki={class:"px-6 py-4 whitespace-nowrap"},Ci={class:"flex items-center gap-2"},Di=["onClick"],Si={key:1,class:"text-gray-400 text-xs"},Fi={key:1,class:"px-6 py-4 whitespace-nowrap"},Ei=["onClick"],Ti={key:1,class:"text-sm text-gray-400"},Ai={class:"px-6 py-4"},Mi={class:"flex flex-wrap gap-1"},ji=["onClick"],Pi={key:0,class:"bg-gray-50 px-4 py-3 border-t border-gray-200 sm:px-6"},Li={class:"flex items-center justify-between"},Bi={class:"flex-1 flex justify-between sm:hidden"},Ri=["disabled"],zi=["disabled"],Ii={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},Ui={class:"text-sm text-gray-700"},Oi={class:"font-medium"},Ni={class:"font-medium"},qi={class:"font-medium"},Vi={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},Qi=["disabled"],Wi=["onClick"],Gi=["disabled"],Hi={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Zi=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos",-1),Ki={class:"mt-1 text-sm text-gray-500"},Yi={key:12,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4"},Ji={class:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] flex flex-col"},Xi={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},ed={class:"flex items-center gap-2"},td=e("h2",{class:"text-sm font-semibold text-gray-900"},"Etiquetas del documento",-1),sd={class:"px-4 py-3 border-b border-gray-100 text-xs text-gray-500"},od=e("span",{class:"font-medium text-gray-700"},"Documento:",-1),ad={class:"ml-1"},rd={class:"px-4 py-3 overflow-y-auto"},nd={key:0,class:"text-sm text-gray-500"},ld={key:1,class:"space-y-2 text-sm"},id={class:"flex items-center gap-2 min-w-0"},dd={key:0,class:"text-xs text-gray-500 truncate max-w-[8rem]"},Ut={__name:"DocumentListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null},cardType:{type:String,default:"lawyer",validator:o=>["lawyer","client"].includes(o)},showStateFilter:{type:Boolean,default:!0},showClientFilter:{type:Boolean,default:!1},showAssociationsColumn:{type:Boolean,default:!0},availableStates:{type:Array,default:()=>["Draft","Published","Progress","PendingSignatures","Completed","FullySigned","Rejected","Expired"]},context:{type:String,default:"legal-documents"},isLoading:{type:Boolean,default:!1}},emits:["refresh","open-electronic-signature"],setup(o,{emit:_}){const l=Ne(),u=Ze(),D=Je(),b=o,h=_,{activeModals:k,openModal:v,closeModal:F}=Ft(l,u),q=B(()=>(k==null?void 0:k.value)||k||{}),O=B(()=>{const g=q.value;return(g==null?void 0:g.relationships)||{isOpen:!1,document:null}}),{handlePreviewDocument:W,deleteDocument:Y,downloadPDFDocument:ae,downloadWordDocument:K,copyDocument:S,publishDocument:i,moveToDraft:C,formalizeDocument:y,signDocument:X,downloadSignedDocument:P}=Et(l,u,h),E=x(""),N=x(""),G=x(""),re=x(null),le=x(null),Z=x(null),V=x("recent"),R=x([]),L=x(!1),de=x(null),ve=x(!1),z=x(null),Q=x(!1),I=x(null),J=x(1),be=x(20),_e=B(()=>b.cardType==="lawyer"&&b.context==="legal-documents");B(()=>!1);const we=B(()=>{if(b.promptDocuments)return b.promptDocuments;const g=u.currentUser;return b.cardType==="lawyer"&&b.context==="legal-documents"?!(g!=null&&g.id)||typeof l.getDocumentsByLawyerId!="function"?[]:l.getDocumentsByLawyerId(g.id)||[]:b.cardType==="client"&&b.context==="my-documents"?!(g!=null&&g.id)||typeof l.progressAndCompletedDocumentsByClient!="function"?[]:l.progressAndCompletedDocumentsByClient(g.id)||[]:l.documents||[]}),Fe=B(()=>{const g=new Map;return we.value.forEach(m=>{var ie;(ie=m.tags)==null||ie.forEach($=>{g.has($.id)||g.set($.id,$)})}),Array.from(g.values())}),Me=B(()=>{if(!N.value)return Fe.value;const g=N.value.toLowerCase();return Fe.value.filter(m=>m.name.toLowerCase().includes(g))}),qe=B(()=>{if(!le.value)return null;const g=Fe.value.find(m=>m.id===le.value);return(g==null?void 0:g.name)||null}),H=B(()=>{if(b.cardType!=="lawyer")return[];const g=new Map;return we.value.forEach(m=>{m.client&&g.set(m.client.id,m.client)}),Array.from(g.values())}),ne=B(()=>{if(!G.value)return H.value;const g=G.value.toLowerCase();return H.value.filter(m=>`${m.first_name} ${m.last_name}`.toLowerCase().includes(g))}),fe=B(()=>{if(!Z.value)return null;const g=H.value.find(m=>m.id===Z.value);return g?`${g.first_name} ${g.last_name}`:null}),se=B(()=>!b.selectedTags||!b.selectedTags.length?[]:b.selectedTags.map(g=>typeof g=="object"?g.id:g)),d=B(()=>{let g=we.value;const m=(b.searchQuery||E.value||"").toLowerCase();return m&&(g=g.filter(ie=>{var $,$e;return(($=ie.title)==null?void 0:$.toLowerCase().includes(m))||(($e=ie.code)==null?void 0:$e.toLowerCase().includes(m))})),re.value&&(g=g.filter(ie=>ie.state===re.value)),le.value&&(g=g.filter(ie=>{var $;return($=ie.tags)==null?void 0:$.some($e=>$e.id===le.value)})),se.value.length>0&&(g=g.filter(ie=>{var $;return($=ie.tags)==null?void 0:$.some($e=>se.value.includes($e.id))})),Z.value&&b.cardType==="lawyer"&&(g=g.filter(ie=>{var $;return(($=ie.client)==null?void 0:$.id)===Z.value})),g}),c=B(()=>{if(b.cardType!=="lawyer"||b.context!=="legal-documents")return!1;const g=d.value;return g.length?g.every(m=>m.state==="Draft"||m.state==="Published"):!1}),n=B(()=>{const g=[...d.value];switch(V.value){case"recent":return g.sort((m,ie)=>new Date(ie.updated_at)-new Date(m.updated_at));case"oldest":return g.sort((m,ie)=>new Date(m.updated_at)-new Date(ie.updated_at));case"name-asc":return g.sort((m,ie)=>(m.title||"").localeCompare(ie.title||""));case"name-desc":return g.sort((m,ie)=>(ie.title||"").localeCompare(m.title||""));default:return g}}),w=B(()=>{const g=(J.value-1)*be.value,m=g+be.value;return n.value.slice(g,m)}),ce=B(()=>Math.ceil(n.value.length/be.value)),ge=B(()=>{const g=ce.value,m=J.value,ie=[];if(g<=7)for(let $=1;$<=g;$++)ie.push($);else if(m<=4){for(let $=1;$<=5;$++)ie.push($);ie.push("..."),ie.push(g)}else if(m>=g-3){ie.push(1),ie.push("...");for(let $=g-4;$<=g;$++)ie.push($)}else ie.push(1),ie.push("..."),ie.push(m-1),ie.push(m),ie.push(m+1),ie.push("..."),ie.push(g);return ie}),Be=B(()=>w.value.length>0&&w.value.every(g=>R.value.includes(g.id))),De=[{value:"recent",label:"Más recientes"},{value:"oldest",label:"Más antiguos"},{value:"name-asc",label:"Nombre (A-Z)"},{value:"name-desc",label:"Nombre (Z-A)"}],Re=g=>{var m;return((m=De.find(ie=>ie.value===g))==null?void 0:m.label)||"Ordenar"},Xe=g=>({Draft:"Borrador",Published:"Publicado",Progress:"En Progreso",PendingSignatures:"Pendiente de Firmas",Completed:"Completado",FullySigned:"Firmado",Rejected:"Rechazado",Expired:"Expirado"})[g]||g,lt=g=>Xe(g.state),jt=g=>({Draft:"bg-gray-100 text-gray-800",Published:"bg-blue-100 text-blue-800",Progress:"bg-yellow-100 text-yellow-800",PendingSignatures:"bg-orange-100 text-orange-800",Completed:"bg-green-100 text-green-800",FullySigned:"bg-purple-100 text-purple-800",Rejected:"bg-red-100 text-red-800",Expired:"bg-gray-100 text-gray-800"})[g.state]||"bg-gray-100 text-gray-800",Pt=g=>({Draft:"text-gray-500",Published:"text-blue-600",Progress:"text-yellow-600",PendingSignatures:"text-orange-600",Completed:"text-green-600",FullySigned:"text-purple-600",Rejected:"text-red-600",Expired:"text-gray-500"})[g.state]||"text-gray-400",it=g=>{if(g&&g.color)return{red:"bg-red-100 text-red-800",blue:"bg-blue-100 text-blue-800",green:"bg-green-100 text-green-800",yellow:"bg-yellow-100 text-yellow-800",purple:"bg-purple-100 text-purple-800",pink:"bg-pink-100 text-pink-800",indigo:"bg-indigo-100 text-indigo-800"}[g.color]||"bg-gray-100 text-gray-800";const m=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],ie=g&&typeof g.id=="number"?g.id%m.length:0;return m[ie]},dt=g=>g.summary_counterparty||"",Lt=g=>{if(!g.summary_value)return"";const m=g.summary_value_currency||"";return m?`${m} ${g.summary_value}`:g.summary_value},ft=g=>!!(dt(g)||g.summary_object||Lt(g)||g.summary_term||g.summary_subscription_date||g.summary_start_date||g.summary_end_date),vt=g=>["Completed","FullySigned"].includes(g.state),Bt=g=>String(l.lastUpdatedDocumentId)===String(g),Rt=g=>{const m=R.value.indexOf(g);m>-1?R.value.splice(m,1):R.value.push(g)},zt=g=>{I.value=g,Q.value=!0},yt=()=>{Q.value=!1,I.value=null},U=()=>{if(Be.value)R.value=R.value.filter(g=>!w.value.some(m=>m.id===g));else{const g=w.value.map(m=>m.id).filter(m=>!R.value.includes(m));R.value.push(...g)}},T=g=>{de.value=g,L.value=!0},ee=g=>{z.value=g,ve.value=!0},A=()=>{const g=R.value.length>0?n.value.filter(Ye=>R.value.includes(Ye.id)):n.value,m=["Nombre Minuta","Estado","Etiquetas"],ie=g.map(Ye=>[Ye.title||"",lt(Ye),Ye.tags?Ye.tags.map(It=>It.name).join(", "):""]),$=[m.join(","),...ie.map(Ye=>Ye.map(It=>`"${It}"`).join(","))].join(`
`),$e=new Blob([$],{type:"text/csv;charset=utf-8;"}),ze=document.createElement("a"),We=URL.createObjectURL($e);ze.setAttribute("href",We),ze.setAttribute("download",`documentos_${new Date().toISOString().split("T")[0]}.csv`),ze.style.visibility="hidden",document.body.appendChild(ze),ze.click(),document.body.removeChild(ze)},me=async(g,m)=>{var ie,$;switch(g){case"preview":await W(m);break;case"edit":{const $e=((ie=u.currentUser)==null?void 0:ie.role)||"client";b.cardType==="lawyer"&&b.context==="legal-documents"?v("edit",m,{userRole:$e,renameOnly:!0}):v("edit",m,{userRole:$e})}break;case"editForm":if(b.cardType==="lawyer"&&b.context==="legal-documents")try{const $e=await l.fetchDocumentById(m.id,!0);l.selectedDocument=$e,D.push("/dynamic_document_dashboard/lawyer/variables-config")}catch($e){console.error("Error al abrir la configuración de variables:",$e)}else v("edit",m,{userRole:"client"});break;case"editDocument":((($=u.currentUser)==null?void 0:$.role)||"client")==="lawyer"&&b.cardType==="lawyer"?D.push(`/dynamic_document_dashboard/lawyer/editor/edit/${m.id}`):D.push(`/dynamic_document_dashboard/client/editor/edit/${m.id}`);break;case"permissions":v("permissions",m);break;case"relationships":v("relationships",m);break;case"letterhead":v("letterhead",m);break;case"viewSignatures":case"signatures":v("signatures",m);break;case"publish":await i(m);break;case"draft":case"move-to-draft":await C(m);break;case"formalize":await y(m);break;case"sign":await X(m);break;case"delete":await Y(m);break;case"downloadPDF":case"download-pdf":await ae(m);break;case"downloadWord":case"download-word":await K(m);break;case"downloadSignedDocument":case"download-signed":await P(m);break;case"email":case"send":v("email",m);break;case"copy":await S(m);break;default:console.warn("Unknown action:",g)}},xe=async(g,m)=>{ve.value=!1,await me(g,m)},ke=({documentId:g,count:m})=>{const ie=l.documents.find($=>$.id===g);ie&&(ie.relationships_count=m)};return Se(()=>n.value.length,()=>{J.value>ce.value&&(J.value=Math.max(1,ce.value))}),Qe(async()=>{b.promptDocuments||await l.init(),await u.init()}),(g,m)=>{var ie;return s(),r("div",null,[e("div",Tl,[e("div",Al,[e("div",Ml,[a(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Te(e("input",{"onUpdate:modelValue":m[0]||(m[0]=$=>E.value=$),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Ie,E.value]])])]),e("div",jl,[o.showStateFilter?(s(),oe(t(je),{key:0,as:"div",class:"relative"},{default:M(()=>[a(t(Pe),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[e("div",Pl,[a(t(tt),{class:"h-4 w-4 flex-shrink-0"}),e("span",Ll,p(re.value||"Estado"),1)]),a(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),a(t(Le),{class:"absolute left-0 z-10 mt-2 w-full min-w-[14rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",Bl,[a(t(ye),null,{default:M(({active:$})=>[e("a",{onClick:m[1]||(m[1]=$e=>re.value=null),class:j([$?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),r(ue,null,he(o.availableStates,$=>(s(),oe(t(ye),{key:$},{default:M(({active:$e})=>[e("a",{onClick:ze=>re.value=$,class:j([$e?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},p(Xe($)),11,Rl)]),_:2},1024))),128))])]),_:1})]),_:1})):f("",!0),a(t(je),{as:"div",class:"relative"},{default:M(()=>[a(t(Pe),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[e("div",zl,[a(t(tt),{class:"h-4 w-4 flex-shrink-0"}),e("span",Il,p(qe.value||"Etiqueta"),1)]),a(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),a(t(Le),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",Ul,[e("div",Ol,[a(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Te(e("input",{"onUpdate:modelValue":m[2]||(m[2]=$=>N.value=$),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:m[3]||(m[3]=pe(()=>{},["stop"]))},null,512),[[Ie,N.value]])]),e("div",Nl,[a(t(ye),null,{default:M(({active:$})=>[e("a",{onClick:m[4]||(m[4]=$e=>le.value=null),class:j([$?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),r(ue,null,he(Me.value,$=>(s(),oe(t(ye),{key:$.id},{default:M(({active:$e})=>[e("a",{onClick:ze=>le.value=$.id,class:j([$e?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:j(["w-3 h-3 rounded-full flex-shrink-0",it($)])},null,2),e("span",Vl,p($.name),1)],10,ql)]),_:2},1024))),128))])])]),_:1})]),_:1}),o.showClientFilter?(s(),oe(t(je),{key:1,as:"div",class:"relative"},{default:M(()=>[a(t(Pe),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[e("div",Ql,[a(t(tt),{class:"h-4 w-4 flex-shrink-0"}),e("span",Wl,p(fe.value||"Cliente"),1)]),a(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),a(t(Le),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",Gl,[e("div",Hl,[a(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Te(e("input",{"onUpdate:modelValue":m[5]||(m[5]=$=>G.value=$),type:"text",placeholder:"Buscar clientes...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:m[6]||(m[6]=pe(()=>{},["stop"]))},null,512),[[Ie,G.value]])]),e("div",Zl,[a(t(ye),null,{default:M(({active:$})=>[e("a",{onClick:m[7]||(m[7]=$e=>Z.value=null),class:j([$?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),r(ue,null,he(ne.value,$=>(s(),oe(t(ye),{key:$.id},{default:M(({active:$e})=>[e("a",{onClick:ze=>Z.value=$.id,class:j([$e?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])},p($.first_name)+" "+p($.last_name),11,Kl)]),_:2},1024))),128))])])]),_:1})]),_:1})):f("",!0)]),e("div",Yl,[a(t(je),{as:"div",class:"relative w-full sm:w-auto"},{default:M(()=>[a(t(Pe),{class:"w-full sm:w-auto inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[a(t(Ps),{class:"h-4 w-4"}),e("span",null,p(Re(V.value)),1),a(t(Oe),{class:"h-4 w-4"})]),_:1}),a(t(Le),{class:"absolute left-0 z-10 mt-2 w-56 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",Jl,[(s(),r(ue,null,he(De,$=>a(t(ye),{key:$.value},{default:M(({active:$e})=>[e("a",{onClick:ze=>V.value=$.value,class:j([$e?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},p($.label),11,Xl)]),_:2},1024)),64))])]),_:1})]),_:1}),e("div",ei,[R.value.length>0?(s(),r("button",{key:0,onClick:A,class:"flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[a(t(st),{class:"h-4 w-4"}),e("span",null,"Exportar ("+p(R.value.length)+")",1)])):f("",!0)])])]),o.isLoading?(s(),r("div",ti,oi)):!o.isLoading&&w.value.length>0?(s(),r("div",ai,[e("div",ri,[e("table",ni,[e("thead",li,[e("tr",null,[_e.value?(s(),r("th",ii,[e("input",{type:"checkbox",checked:Be.value,onChange:U,class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded cursor-pointer"},null,40,di)])):f("",!0),ci,ui,mi,o.showAssociationsColumn&&!c.value?(s(),r("th",gi," Asociaciones ")):f("",!0),pi])]),e("tbody",hi,[(s(!0),r(ue,null,he(w.value,$=>{var $e,ze;return s(),r("tr",{key:$.id,class:j(["hover:bg-gray-50 cursor-pointer transition-colors duration-150",Bt($.id)?"bg-yellow-50":""]),onClick:We=>ee($)},[_e.value?(s(),r("td",vi,[e("input",{type:"checkbox",checked:R.value.includes($.id),onChange:pe(We=>Rt($.id),["stop"]),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded cursor-pointer"},null,40,yi)])):f("",!0),e("td",bi,[e("div",xi,[a(t(Ue),{class:j(["h-5 w-5 flex-shrink-0",Pt($)])},null,8,["class"]),e("div",_i,[e("button",{onClick:pe(We=>T($),["stop"]),class:"text-sm font-medium text-gray-900 hover:text-secondary truncate block max-w-xs text-left"},p($.title||"Sin título"),9,wi)])])]),e("td",$i,[e("span",{class:j([jt($),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},p(lt($)),3)]),e("td",ki,[e("div",Ci,[ft($)?(s(),r("button",{key:0,type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border border-blue-200 text-blue-700 bg-blue-50 hover:bg-blue-100",onClick:pe(We=>T($),["stop"])}," Ver detalle ",8,Di)):(s(),r("span",Si," Sin clasificación "))])]),o.showAssociationsColumn&&!c.value?(s(),r("td",Fi,[vt($)?(s(),r("button",{key:0,onClick:pe(We=>t(v)("relationships",$),["stop"]),class:"inline-flex items-center gap-1 text-sm text-secondary hover:text-blue-700"},[a(t(ds),{class:"h-4 w-4"}),e("span",null,p($.relationships_count||0),1)],8,Ei)):(s(),r("span",Ti,p($.relationships_count||0),1))])):f("",!0),e("td",Ai,[e("div",Mi,[(s(!0),r(ue,null,he(($e=$.tags)==null?void 0:$e.slice(0,2),We=>(s(),r("span",{key:We.id,class:j([it(We),"px-2 py-1 text-xs rounded-full"])},p(We.name),3))),128)),((ze=$.tags)==null?void 0:ze.length)>2?(s(),r("button",{key:0,type:"button",class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 inline-flex items-center gap-1",onClick:pe(We=>zt($),["stop"])},[e("span",null,"+"+p($.tags.length-2),1)],8,ji)):f("",!0)])])],10,fi)}),128))])])]),ce.value>1?(s(),r("div",Pi,[e("div",Li,[e("div",Bi,[e("button",{onClick:m[8]||(m[8]=$=>J.value--),disabled:J.value===1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Anterior ",8,Ri),e("button",{onClick:m[9]||(m[9]=$=>J.value++),disabled:J.value===ce.value,class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Siguiente ",8,zi)]),e("div",Ii,[e("div",null,[e("p",Ui,[te(" Mostrando "),e("span",Oi,p((J.value-1)*be.value+1),1),te(" a "),e("span",Ni,p(Math.min(J.value*be.value,n.value.length)),1),te(" de "),e("span",qi,p(n.value.length),1),te(" resultados ")])]),e("div",null,[e("nav",Vi,[e("button",{onClick:m[10]||(m[10]=$=>J.value--),disabled:J.value===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[a(t(Ct),{class:"h-5 w-5"})],8,Qi),(s(!0),r(ue,null,he(ge.value,$=>(s(),r("button",{key:$,onClick:$e=>typeof $=="number"?J.value=$:null,class:j([$===J.value?"z-10 bg-secondary border-secondary text-white":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50",typeof $=="string"?"cursor-default":"cursor-pointer","relative inline-flex items-center px-4 py-2 border text-sm font-medium"])},p($),11,Wi))),128)),e("button",{onClick:m[11]||(m[11]=$=>J.value++),disabled:J.value===ce.value,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[a(t(pt),{class:"h-5 w-5"})],8,Gi)])])])])])):f("",!0)])):!o.isLoading&&w.value.length===0?(s(),r("div",Hi,[a(t(Ue),{class:"mx-auto h-12 w-12 text-gray-400"}),Zi,e("p",Ki,p(b.promptDocuments?"No se encontraron documentos":"Comienza creando un nuevo documento"),1)])):f("",!0),t(et)?(s(),oe(Qt,{key:3,"is-open":t(et),document:t(Vt),onClose:m[12]||(m[12]=$=>et.value=!1)},null,8,["is-open","document"])):f("",!0),t(k).edit.isOpen?(s(),oe(t(Wt),{key:4,"is-open":t(k).edit.isOpen,document:t(k).edit.document,"user-role":t(k).edit.userRole||((ie=t(u).currentUser)==null?void 0:ie.role)||"client","show-editor-button":!t(k).edit.renameOnly,onClose:m[13]||(m[13]=$=>t(F)("edit")),onRefresh:m[14]||(m[14]=$=>h("refresh"))},null,8,["is-open","document","user-role","show-editor-button"])):f("",!0),q.value.email.isOpen?(s(),oe(t(Gt),{key:5,"is-open":q.value.email.isOpen,document:q.value.email.document,onClose:m[15]||(m[15]=$=>t(F)("email")),onRefresh:m[16]||(m[16]=$=>h("refresh"))},null,8,["is-open","document"])):f("",!0),t(k).signatures.isOpen?(s(),oe(t(ls),{key:6,"is-open":t(k).signatures.isOpen,document:t(k).signatures.document,onClose:m[17]||(m[17]=$=>t(F)("signatures")),onRefresh:m[18]||(m[18]=$=>h("refresh"))},null,8,["is-open","document"])):f("",!0),t(k).permissions.isOpen?(s(),oe(t(Ts),{key:7,"is-open":t(k).permissions.isOpen,document:t(k).permissions.document,onClose:m[19]||(m[19]=$=>t(F)("permissions")),onRefresh:m[20]||(m[20]=$=>h("refresh"))},null,8,["is-open","document"])):f("",!0),t(k).letterhead.isOpen?(s(),oe(Tt,{key:8,"is-visible":t(k).letterhead.isOpen,document:t(k).letterhead.document,onClose:m[21]||(m[21]=$=>t(F)("letterhead")),onRefresh:m[22]||(m[22]=$=>h("refresh"))},null,8,["is-visible","document"])):f("",!0),O.value.isOpen?(s(),oe(Dt,{key:9,"is-open":O.value.isOpen,document:O.value.document,onClose:m[23]||(m[23]=$=>t(F)("relationships")),onUpdateCount:ke},null,8,["is-open","document"])):f("",!0),ve.value?(s(),oe(Mt,{key:10,"is-visible":ve.value,document:z.value,"card-type":o.cardType,context:b.context||"list","user-store":t(u),onClose:m[24]||(m[24]=$=>ve.value=!1),onRefresh:m[25]||(m[25]=$=>h("refresh")),onAction:xe},null,8,["is-visible","document","card-type","context","user-store"])):f("",!0),L.value?(s(),oe(ps,{key:11,"is-visible":L.value,document:de.value,onClose:m[26]||(m[26]=$=>L.value=!1)},null,8,["is-visible","document"])):f("",!0),Q.value&&I.value?(s(),r("div",Yi,[e("div",Ji,[e("div",Xi,[e("div",ed,[a(t(Ot),{class:"h-5 w-5 text-gray-500"}),td]),e("button",{type:"button",class:"text-gray-400 hover:text-gray-600 p-1 rounded-md hover:bg-gray-100",onClick:yt},[a(t(Ee),{class:"h-5 w-5"})])]),e("div",sd,[od,e("span",ad,p(I.value.title||"Sin título"),1)]),e("div",rd,[!I.value.tags||I.value.tags.length===0?(s(),r("div",nd," Este documento no tiene etiquetas. ")):(s(),r("ul",ld,[(s(!0),r(ue,null,he(I.value.tags,$=>(s(),r("li",{key:$.id,class:"flex items-center justify-between gap-2"},[e("div",id,[e("span",{class:j(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",it($)])},p($.name),3)]),$.description?(s(),r("span",dd,p($.description),1)):f("",!0)]))),128))]))]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end"},[e("button",{type:"button",class:"px-4 py-2 text-sm font-medium rounded-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-50",onClick:yt}," Cerrar ")])])])):f("",!0)])}}},cd={class:"mb-4"},ud={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},md={class:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"},gd={class:"flex flex-col sm:flex-row gap-3 flex-1 w-full lg:w-auto"},pd={class:"relative flex-1 min-w-[200px]"},hd={class:"max-w-[120px] truncate"},fd={class:"p-2"},vd={class:"relative mb-2"},yd={class:"max-h-60 overflow-y-auto"},bd=["onClick"],xd={class:"truncate"},_d={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},wd={class:"flex items-center gap-3 w-full lg:w-auto"},$d={class:"text-sm text-gray-500 whitespace-nowrap"},kd={class:"py-1"},Cd={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},Dd={class:"min-w-full divide-y divide-gray-200"},Sd=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plantilla "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),Fd={class:"bg-white divide-y divide-gray-200"},Ed=["onClick"],Td={class:"px-6 py-4 whitespace-nowrap"},Ad={class:"flex items-center"},Md={class:"flex-shrink-0 h-10 w-10"},jd={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},Pd={class:"ml-4"},Ld={class:"text-sm font-medium text-gray-900"},Bd=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-700 border border-purple-200"}," Disponible ")],-1),Rd={class:"px-6 py-4 whitespace-nowrap"},zd={class:"flex flex-wrap gap-1"},Id={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},Ud={key:1,class:"text-sm text-gray-400"},Od={class:"py-1"},Nd=["onClick"],qd={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Vd=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay plantillas disponibles",-1),Qd={class:"mt-1 text-sm text-gray-500"},Wd=e("div",{class:"mt-4"},[e("div",{class:"text-xs text-gray-400 bg-gray-100 px-3 py-2 rounded-lg inline-block"},[te(" 💡 "),e("strong",null,"Tip:"),te(" Las plantillas son creadas por los abogados ")])],-1),Gd={__name:"UseDocumentTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["go-back"],setup(o,{emit:_}){const l=Ne();Ze();const u=Je(),D=_,b=x(""),h=x(""),k=x(null),v=x("recent"),F=x(!1),q=x(null),O=x({}),W=x({}),Y=x(!1),ae=x(-1),K=B(()=>l.publishedDocumentsUnassigned||[]),S=B(()=>{let z=[...K.value];const Q=b.value.toLowerCase();return Q&&(z=z.filter(I=>{var J,be;return((J=I.title)==null?void 0:J.toLowerCase().includes(Q))||((be=I.tags)==null?void 0:be.some(_e=>{var we;return(we=_e.name)==null?void 0:we.toLowerCase().includes(Q)}))})),k.value&&(z=z.filter(I=>I.tags&&I.tags.some(J=>J.id===k.value))),v.value==="name"?z.sort((I,J)=>{const be=(I.title||"").toLowerCase(),_e=(J.title||"").toLowerCase();return be.localeCompare(_e)}):v.value==="recent"&&z.sort((I,J)=>J.id-I.id),z}),i=B(()=>{const z=new Map;return K.value.forEach(Q=>{Q.tags&&Q.tags.length>0&&Q.tags.forEach(I=>{z.has(I.id)||z.set(I.id,I)})}),Array.from(z.values()).sort((Q,I)=>Q.name.localeCompare(I.name))}),C=B(()=>{if(!h.value)return i.value;const z=h.value.toLowerCase();return i.value.filter(Q=>Q.name.toLowerCase().includes(z))}),y=B(()=>{if(!k.value)return null;const z=i.value.find(Q=>Q.id===k.value);return z?z.name:null}),X=B(()=>{switch(v.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),P=B(()=>{const z=b.value&&b.value.trim().length>0,Q=k.value!==null;return z&&Q?"No se encontraron plantillas que coincidan con tu búsqueda y filtros":z?"No se encontraron plantillas que coincidan con tu búsqueda":Q?"No se encontraron plantillas con la etiqueta seleccionada":"Aún no hay plantillas disponibles para usar"}),E=z=>{const Q=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],I=z.id%Q.length;return Q[I]},N=z=>{const Q=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],I=z.id%Q.length;return Q[I]},G=()=>{k.value=null},re=z=>{z&&(l.selectedDocument=null,q.value=z,F.value=!0)},le=()=>{F.value=!1,q.value=null},Z=z=>{if(z.state==="Published"&&!z.assigned_to)re(z.id);else{const I=`/dynamic_document_dashboard/document/use/editor/${z.id}/${encodeURIComponent(z.title.trim())}`;u.push(I)}},V=()=>{D("go-back")};Qe(async()=>{(!l.documents||l.documents.length===0)&&await l.init(!0)});const R=()=>Y.value?S.value.length===1?"280px":S.value.length===2&&ae.value===1?"340px":"280px":"auto",L=(z,Q)=>{z&&(O.value[Q]=z)},de=(z,Q)=>{z&&(W.value[Q]=z)},ve=(z,Q)=>{Y.value=!Q,ae.value=Q?-1:z,Q||setTimeout(()=>{const I=W.value[z];if(I){const J=I.$el||I;if(J&&J.getBoundingClientRect){const be=J.getBoundingClientRect(),_e=window.innerHeight;if(z===0){if(be.bottom>_e-20){const we=be.bottom-_e+40;window.scrollBy({top:we,behavior:"smooth"})}}else if(be.bottom>_e-10){const we=be.bottom-_e+30;window.scrollBy({top:we,behavior:"smooth"})}else if(be.top<80){const we=be.top-100;window.scrollBy({top:we,behavior:"smooth"})}}}},100)};return(z,Q)=>(s(),r("div",null,[e("div",cd,[e("button",{onClick:V,class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors border border-gray-300"},[a(t(Ls),{class:"h-4 w-4"}),te(" Volver a Mis Documentos ")])]),e("div",ud,[e("div",md,[e("div",gd,[e("div",pd,[a(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Te(e("input",{"onUpdate:modelValue":Q[0]||(Q[0]=I=>b.value=I),type:"text",placeholder:"Buscar plantillas...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent"},null,512),[[Ie,b.value]])]),a(t(je),{as:"div",class:"relative"},{default:M(()=>[a(t(Pe),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[a(t(tt),{class:"h-4 w-4"}),e("span",hd,p(y.value||"Etiqueta"),1),a(t(Oe),{class:"h-4 w-4"})]),_:1}),a(t(Le),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",fd,[e("div",vd,[a(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Te(e("input",{"onUpdate:modelValue":Q[1]||(Q[1]=I=>h.value=I),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:Q[2]||(Q[2]=pe(()=>{},["stop"]))},null,512),[[Ie,h.value]])]),e("div",yd,[a(t(ye),null,{default:M(({active:I})=>[e("a",{onClick:Q[3]||(Q[3]=J=>k.value=null),class:j([I?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),r(ue,null,he(C.value,I=>(s(),oe(t(ye),{key:I.id},{default:M(({active:J})=>[e("a",{onClick:be=>k.value=I.id,class:j([J?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:j(["w-3 h-3 rounded-full flex-shrink-0",N(I)])},null,2),e("span",xd,p(I.name),1)],10,bd)]),_:2},1024))),128)),C.value.length===0?(s(),r("div",_d," No se encontraron etiquetas ")):f("",!0)])])]),_:1})]),_:1}),k.value?(s(),r("button",{key:0,onClick:G,class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[a(t(Ee),{class:"h-4 w-4"}),te(" Limpiar ")])):f("",!0)]),e("div",wd,[e("span",$d," Mostrando "+p(S.value.length)+" plantillas ",1),a(t(je),{as:"div",class:"relative"},{default:M(()=>[a(t(Pe),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[te(" Ordenar: "+p(X.value)+" ",1),a(t(Oe),{class:"h-4 w-4"})]),_:1}),a(t(Le),{class:"absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",kd,[a(t(ye),null,{default:M(({active:I})=>[e("a",{onClick:Q[4]||(Q[4]=J=>v.value="recent"),class:j([I?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),a(t(ye),null,{default:M(({active:I})=>[e("a",{onClick:Q[5]||(Q[5]=J=>v.value="name"),class:j([I?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),S.value.length>0?(s(),r("div",Cd,[e("div",{class:"overflow-x-auto",style:Ve({minHeight:R()})},[e("table",Dd,[Sd,e("tbody",Fd,[(s(!0),r(ue,null,he(S.value,(I,J)=>{var be;return s(),r("tr",{key:I.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:_e=>Z(I)},[e("td",Td,[e("div",Ad,[e("div",Md,[e("div",jd,[a(t(Ue),{class:"h-5 w-5 text-purple-600"})])]),e("div",Pd,[e("div",Ld,p(I.title),1)])])]),Bd,e("td",Rd,[e("div",zd,[(s(!0),r(ue,null,he((be=I.tags)==null?void 0:be.slice(0,2),_e=>(s(),r("span",{key:_e.id,class:j(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",E(_e)])},p(_e.name),3))),128)),I.tags&&I.tags.length>2?(s(),r("span",Id," +"+p(I.tags.length-2),1)):f("",!0),!I.tags||I.tags.length===0?(s(),r("span",Ud,"-")):f("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:Q[6]||(Q[6]=pe(()=>{},["stop"]))},[a(t(je),{as:"div",class:"relative inline-block text-left"},{default:M(({open:_e})=>[a(t(Pe),{ref_for:!0,ref:we=>L(we,J),onClick:we=>ve(J,_e),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:M(()=>[a(t(rt),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),a(t(Le),{ref_for:!0,ref:we=>de(we,J),class:j([S.value.length>2&&J>0&&J>=S.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:M(()=>[e("div",Od,[a(t(ye),null,{default:M(({active:we})=>[e("a",{onClick:Fe=>Z(I),class:j([we?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Usar plantilla ",10,Nd)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,Ed)}),128))])])],4)])):(s(),r("div",qd,[a(t(At),{class:"mx-auto h-12 w-12 text-gray-400"}),Vd,e("p",Qd,p(P.value),1),Wd])),Te(a(He,null,{default:M(()=>[q.value!==null?(s(),oe(us,{key:0,"document-id":q.value,onClose:le},null,8,["document-id"])):f("",!0)]),_:1},512),[[gt,F.value]])]))}},Hd={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},Zd={class:"mb-4"},Kd={class:"relative w-full"},Yd={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},Jd={class:"flex items-center gap-2 min-w-0"},Xd={class:"truncate"},ec={class:"py-1"},tc=["onClick"],sc={class:"flex items-center justify-stretch"},oc=e("span",null,"Limpiar",-1),ac={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},rc={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},nc={class:"flex items-center gap-2"},lc=e("span",{class:"hidden sm:inline"},"Exportar",-1),ic={class:"py-1"},dc=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),cc={class:"py-1"},uc={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},mc={class:"overflow-x-auto",style:{"overflow-y":"visible"}},gc={class:"min-w-full divide-y divide-gray-200"},pc={class:"bg-gray-50"},hc={scope:"col",class:"w-12 px-6 py-3"},fc=["checked"],vc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),yc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),bc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),xc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Docs. Asociados ",-1),_c=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),wc={class:"bg-white divide-y divide-gray-200"},$c=["onClick"],kc=["checked","onChange"],Cc={class:"px-6 py-4 whitespace-nowrap"},Dc={class:"flex items-center"},Sc={class:"flex-shrink-0 h-10 w-10"},Fc={class:"h-10 w-10 rounded-lg bg-green-100 flex items-center justify-center"},Ec={class:"ml-4"},Tc={class:"text-sm font-medium text-gray-900"},Ac={class:"px-6 py-4 whitespace-nowrap"},Mc={class:"text-sm text-gray-900"},jc=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-700 border border-green-200"}," Completado ")],-1),Pc={class:"px-6 py-4 whitespace-nowrap"},Lc=["onClick"],Bc={class:"px-6 py-4 whitespace-nowrap"},Rc={class:"flex flex-wrap gap-1"},zc={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},Ic={key:1,class:"text-sm text-gray-400"},Uc={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Oc={class:"flex flex-1 justify-between sm:hidden"},Nc=["disabled"],qc=["disabled"],Vc={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Qc={class:"text-sm text-gray-700"},Wc={class:"font-medium"},Gc={class:"font-medium"},Hc={class:"font-medium"},Zc={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Kc=["disabled"],Yc=e("span",{class:"sr-only"},"Anterior",-1),Jc=["onClick"],Xc={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},eu=["disabled"],tu=e("span",{class:"sr-only"},"Siguiente",-1),su={key:0,class:"text-center py-12"},ou=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos completados",-1),au=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos completados por clientes aparecerán aquí.",-1),ru={__name:"DocumentFinishedByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(o,{emit:_}){const l=Ne(),u=Ze(),D=Je(),b=o,h=_,{activeModals:k,openModal:v,closeModal:F,getUserRole:q}=Ft(l,u),{handlePreviewDocument:O,deleteDocument:W,downloadPDFDocument:Y,downloadWordDocument:ae}=Et(l,u,h),K=x(""),S=x(null),i=x("recent"),C=x([]),y=x(1),X=x(10);Qe(()=>{l.init(),u.init()});const P=B(()=>{const d=l.completedDocumentsByClient,c=b.selectedTags?b.selectedTags.map(w=>w.id):[];return l.filteredDocumentsBySearchAndTags(b.searchQuery,u,c).filter(w=>d.some(ce=>ce.id===w.id))}),E=B(()=>{let d=[...P.value];const c=K.value.toLowerCase();return c&&(d=d.filter(n=>{var w,ce;return((w=n.title)==null?void 0:w.toLowerCase().includes(c))||((ce=n.tags)==null?void 0:ce.some(ge=>{var Be;return(Be=ge.name)==null?void 0:Be.toLowerCase().includes(c)}))})),S.value&&(d=d.filter(n=>n.tags&&n.tags.some(w=>w.id===S.value))),i.value==="name"?d.sort((n,w)=>{const ce=(n.title||"").toLowerCase(),ge=(w.title||"").toLowerCase();return ce.localeCompare(ge)}):i.value==="recent"&&d.sort((n,w)=>{const ce=new Date(n.updated_at||n.created_at);return new Date(w.updated_at||w.created_at)-ce}),d}),N=B(()=>{const d=(y.value-1)*X.value,c=d+X.value;return E.value.slice(d,c)}),G=B(()=>Math.ceil(E.value.length/X.value)),re=B(()=>{const d=(y.value-1)*X.value+1,c=Math.min(y.value*X.value,E.value.length);return{start:d,end:c,total:E.value.length}});Se([K,S],()=>{y.value=1});const le=B(()=>{const d=new Map;return P.value.forEach(c=>{c.tags&&c.tags.length>0&&c.tags.forEach(n=>{d.has(n.id)||d.set(n.id,n)})}),Array.from(d.values()).sort((c,n)=>c.name.localeCompare(n.name))}),Z=B(()=>{if(!S.value)return null;const d=le.value.find(c=>c.id===S.value);return d?d.name:null}),V=B(()=>{switch(i.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),R=d=>d.summary_counterparty?d.summary_counterparty:"Cliente",L=d=>{const c=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],n=d.id%c.length;return c[n]},de=B(()=>E.value.length>0&&C.value.length===E.value.length),ve=()=>{de.value?C.value=[]:C.value=E.value.map(d=>d.id)},z=d=>{const c=C.value.indexOf(d);c>-1?C.value.splice(c,1):C.value.push(d)},Q=()=>{C.value=E.value.map(d=>d.id)},I=()=>{C.value=[]},J=()=>{S.value=null},be=()=>{y.value>1&&y.value--},_e=()=>{y.value<G.value&&y.value++},we=d=>{d>=1&&d<=G.value&&(y.value=d)},Fe=B(()=>{const d=G.value,c=y.value,n=[];if(d<=7)for(let w=1;w<=d;w++)n.push(w);else if(c<=4){for(let w=1;w<=5;w++)n.push(w);n.push("..."),n.push(d)}else if(c>=d-3){n.push(1),n.push("...");for(let w=d-4;w<=d;w++)n.push(w)}else n.push(1),n.push("..."),n.push(c-1),n.push(c),n.push(c+1),n.push("..."),n.push(d);return n}),Me=()=>{const d=C.value.length>0?E.value.filter(De=>C.value.includes(De.id)):E.value,c=["Nombre Documento","Cliente","Estado","Etiquetas"],n=d.map(De=>[De.title||"",R(De),"Completado",De.tags?De.tags.map(Re=>Re.name).join(", "):""]),w=[c.join(","),...n.map(De=>De.map(Re=>`"${Re}"`).join(","))].join(`
`),ce=new Blob([w],{type:"text/csv;charset=utf-8;"}),ge=document.createElement("a"),Be=URL.createObjectURL(ce);ge.setAttribute("href",Be),ge.setAttribute("download",`documentos_completados_${new Date().toISOString().split("T")[0]}.csv`),ge.style.visibility="hidden",document.body.appendChild(ge),ge.click(),document.body.removeChild(ge)},qe=async(d,c)=>{try{switch(d){case"editForm":v("edit",c,{userRole:q()});break;case"editDocument":D.push(`/dynamic_document_dashboard/client/editor/edit/${c.id}`);break;case"preview":await O(c);break;case"delete":await W(c);break;case"letterhead":v("letterhead",c);break;case"relationships":v("relationships",c);break;case"downloadPDF":await Y(c);break;case"downloadWord":await ae(c);break;case"email":v("email",c);break;default:console.warn("Unknown action:",d)}}catch(n){console.error(`Error executing action ${d}:`,n)}},H=x(!1),ne=x(null),fe=d=>{ne.value=d,H.value=!0},se=async(d,c)=>{H.value=!1,await qe(d,c)};return(d,c)=>(s(),r("div",null,[e("div",Hd,[e("div",Zd,[e("div",Kd,[a(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Te(e("input",{"onUpdate:modelValue":c[0]||(c[0]=n=>K.value=n),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Ie,K.value]])])]),e("div",Yd,[a(t(je),{as:"div",class:"relative"},{default:M(()=>[a(t(Pe),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[e("div",Jd,[a(t(tt),{class:"h-4 w-4 flex-shrink-0"}),e("span",Xd,p(Z.value||"Etiqueta"),1)]),a(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),a(t(Le),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:M(()=>[e("div",ec,[a(t(ye),null,{default:M(({active:n})=>[e("a",{onClick:c[1]||(c[1]=w=>S.value=null),class:j([n?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),r(ue,null,he(le.value,n=>(s(),oe(t(ye),{key:n.id},{default:M(({active:w})=>[e("a",{onClick:ce=>S.value=n.id,class:j([w?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},p(n.name),11,tc)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",sc,[S.value?(s(),r("button",{key:0,onClick:J,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[a(t(Ee),{class:"h-4 w-4 flex-shrink-0"}),oc])):f("",!0)])]),e("div",ac,[e("div",rc,[e("div",nc,[e("button",{onClick:Me,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[a(t(st),{class:"h-4 w-4"}),lc]),a(t(je),{as:"div",class:"relative"},{default:M(()=>[a(t(Pe),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:M(()=>[a(t(rt),{class:"h-5 w-5 text-gray-500"})]),_:1}),a(t(Le),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",ic,[a(t(ye),null,{default:M(({active:n})=>[e("a",{onClick:Q,class:j([n?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),a(t(ye),null,{default:M(({active:n})=>[e("a",{onClick:I,class:j([n?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),a(t(je),{as:"div",class:"relative"},{default:M(()=>[a(t(Pe),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[dc,te(" "+p(V.value)+" ",1),a(t(Oe),{class:"h-4 w-4"})]),_:1}),a(t(Le),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",cc,[a(t(ye),null,{default:M(({active:n})=>[e("a",{onClick:c[2]||(c[2]=w=>i.value="recent"),class:j([n?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),a(t(ye),null,{default:M(({active:n})=>[e("a",{onClick:c[3]||(c[3]=w=>i.value="name"),class:j([n?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",uc,[e("div",mc,[e("table",gc,[e("thead",pc,[e("tr",null,[e("th",hc,[e("input",{type:"checkbox",checked:de.value,onChange:ve,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,fc)]),vc,yc,bc,xc,_c])]),e("tbody",wc,[(s(!0),r(ue,null,he(N.value,(n,w)=>{var ce;return s(),r("tr",{key:n.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:ge=>fe(n)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:c[4]||(c[4]=pe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:C.value.includes(n.id),onChange:ge=>z(n.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,kc)]),e("td",Cc,[e("div",Dc,[e("div",Sc,[e("div",Fc,[a(t(Ue),{class:"h-5 w-5 text-green-600"})])]),e("div",Ec,[e("div",Tc,p(n.title),1)])])]),e("td",Ac,[e("div",Mc,p(R(n)),1)]),jc,e("td",Pc,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100",onClick:pe(ge=>t(v)("relationships",n),["stop"])}," Ver asociaciones ",8,Lc)]),e("td",Bc,[e("div",Rc,[(s(!0),r(ue,null,he((ce=n.tags)==null?void 0:ce.slice(0,2),ge=>(s(),r("span",{key:ge.id,class:j(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",L(ge)])},p(ge.name),3))),128)),n.tags&&n.tags.length>2?(s(),r("span",zc," +"+p(n.tags.length-2),1)):f("",!0),!n.tags||n.tags.length===0?(s(),r("span",Ic,"-")):f("",!0)])])],8,$c)}),128))])])]),G.value>1?(s(),r("div",Uc,[e("div",Oc,[e("button",{onClick:be,disabled:y.value===1,class:j(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",y.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,Nc),e("button",{onClick:_e,disabled:y.value===G.value,class:j(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",y.value===G.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,qc)]),e("div",Vc,[e("div",null,[e("p",Qc,[te(" Mostrando "),e("span",Wc,p(re.value.start),1),te(" a "),e("span",Gc,p(re.value.end),1),te(" de "),e("span",Hc,p(re.value.total),1),te(" resultados ")])]),e("div",null,[e("nav",Zc,[e("button",{onClick:be,disabled:y.value===1,class:j(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",y.value===1?"opacity-50 cursor-not-allowed":""])},[Yc,a(t(Ct),{class:"h-5 w-5","aria-hidden":"true"})],10,Kc),(s(!0),r(ue,null,he(Fe.value,n=>(s(),r(ue,{key:n},[n!=="..."?(s(),r("button",{key:0,onClick:w=>we(n),class:j(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",y.value===n?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},p(n),11,Jc)):(s(),r("span",Xc," ... "))],64))),128)),e("button",{onClick:_e,disabled:y.value===G.value,class:j(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",y.value===G.value?"opacity-50 cursor-not-allowed":""])},[tu,a(t(pt),{class:"h-5 w-5","aria-hidden":"true"})],10,eu)])])])])):f("",!0)]),E.value.length===0?(s(),r("div",su,[a(t(At),{class:"mx-auto h-12 w-12 text-gray-400"}),ou,au])):f("",!0),(s(),oe(qt,{to:"body"},[t(k).edit.isOpen?(s(),oe(t(Wt),{key:0,document:t(k).edit.document,"user-role":t(q)(),onClose:c[5]||(c[5]=n=>t(F)("edit")),onRefresh:c[6]||(c[6]=n=>h("refresh"))},null,8,["document","user-role"])):f("",!0),t(k).email.isOpen?(s(),oe(t(Gt),{key:1,document:t(k).email.document,onClose:c[7]||(c[7]=n=>t(F)("email"))},null,8,["document"])):f("",!0),t(k).letterhead.isOpen?(s(),oe(Tt,{key:2,"is-visible":t(k).letterhead.isOpen,document:t(k).letterhead.document,onClose:c[8]||(c[8]=n=>t(F)("letterhead")),onUploaded:c[9]||(c[9]=n=>h("refresh")),onDeleted:c[10]||(c[10]=n=>h("refresh"))},null,8,["is-visible","document"])):f("",!0),t(k).relationships.isOpen?(s(),oe(Dt,{key:3,"is-open":t(k).relationships.isOpen,document:t(k).relationships.document,onClose:c[11]||(c[11]=n=>t(F)("relationships")),onRefresh:c[12]||(c[12]=n=>h("refresh"))},null,8,["is-open","document"])):f("",!0),H.value?(s(),oe(Mt,{key:4,"is-visible":H.value,document:ne.value,"card-type":"client",context:"table","user-store":t(u),onClose:c[13]||(c[13]=n=>H.value=!1),onAction:se},null,8,["is-visible","document","user-store"])):f("",!0)]))]))}},nu={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},lu={class:"mb-4"},iu={class:"relative w-full"},du={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},cu={class:"flex items-center gap-2 min-w-0"},uu={class:"truncate"},mu={class:"py-1"},gu=["onClick"],pu={class:"flex items-center justify-stretch"},hu=e("span",null,"Limpiar",-1),fu={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},vu={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},yu={class:"flex items-center gap-2"},bu=e("span",{class:"hidden sm:inline"},"Exportar",-1),xu={class:"py-1"},_u=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),wu={class:"py-1"},$u={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},ku={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Cu={class:"min-w-full divide-y divide-gray-200"},Du={class:"bg-gray-50"},Su={scope:"col",class:"w-12 px-6 py-3"},Fu=["checked"],Eu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Tu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),Au=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),Mu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Docs. Asociados ",-1),ju=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),Pu={class:"bg-white divide-y divide-gray-200"},Lu=["onClick"],Bu=["checked","onChange"],Ru={class:"px-6 py-4 whitespace-nowrap"},zu={class:"flex items-center"},Iu={class:"flex-shrink-0 h-10 w-10"},Uu={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Ou={class:"ml-4"},Nu={class:"text-sm font-medium text-gray-900"},qu={class:"px-6 py-4 whitespace-nowrap"},Vu={class:"text-sm text-gray-900"},Qu=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-700 border border-blue-200"}," En Progreso ")],-1),Wu={class:"px-6 py-4 whitespace-nowrap"},Gu=["onClick"],Hu={class:"px-6 py-4 whitespace-nowrap"},Zu={class:"flex flex-wrap gap-1"},Ku={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},Yu={key:1,class:"text-sm text-gray-400"},Ju={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Xu={class:"flex flex-1 justify-between sm:hidden"},em=["disabled"],tm=["disabled"],sm={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},om={class:"text-sm text-gray-700"},am={class:"font-medium"},rm={class:"font-medium"},nm={class:"font-medium"},lm={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},im=["disabled"],dm=e("span",{class:"sr-only"},"Anterior",-1),cm=["onClick"],um={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},mm=["disabled"],gm=e("span",{class:"sr-only"},"Siguiente",-1),pm={key:0,class:"text-center py-12"},hm=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos en progreso",-1),fm=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos en progreso por clientes aparecerán aquí.",-1),vm={__name:"DocumentInProgressByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(o,{emit:_}){const l=Ne(),u=Ze(),D=Je(),b=o,h=_,{activeModals:k,openModal:v,closeModal:F,getUserRole:q}=Ft(l,u),{handlePreviewDocument:O,deleteDocument:W,downloadPDFDocument:Y,downloadWordDocument:ae}=Et(l,u,h),K=x(""),S=x(null),i=x("recent"),C=x([]),y=x(1),X=x(10);Qe(()=>{l.init(),u.init()});const P=B(()=>{const d=l.progressDocumentsByClient,c=b.selectedTags?b.selectedTags.map(w=>w.id):[];return l.filteredDocumentsBySearchAndTags(b.searchQuery,u,c).filter(w=>d.some(ce=>ce.id===w.id))}),E=B(()=>{let d=[...P.value];const c=K.value.toLowerCase();return c&&(d=d.filter(n=>{var w,ce;return((w=n.title)==null?void 0:w.toLowerCase().includes(c))||((ce=n.tags)==null?void 0:ce.some(ge=>{var Be;return(Be=ge.name)==null?void 0:Be.toLowerCase().includes(c)}))})),S.value&&(d=d.filter(n=>n.tags&&n.tags.some(w=>w.id===S.value))),i.value==="name"?d.sort((n,w)=>{const ce=(n.title||"").toLowerCase(),ge=(w.title||"").toLowerCase();return ce.localeCompare(ge)}):i.value==="recent"&&d.sort((n,w)=>{const ce=new Date(n.updated_at||n.created_at);return new Date(w.updated_at||w.created_at)-ce}),d}),N=B(()=>{const d=(y.value-1)*X.value,c=d+X.value;return E.value.slice(d,c)}),G=B(()=>Math.ceil(E.value.length/X.value)),re=B(()=>{const d=(y.value-1)*X.value+1,c=Math.min(y.value*X.value,E.value.length);return{start:d,end:c,total:E.value.length}});Se([K,S],()=>{y.value=1});const le=B(()=>{const d=new Map;return P.value.forEach(c=>{c.tags&&c.tags.length>0&&c.tags.forEach(n=>{d.has(n.id)||d.set(n.id,n)})}),Array.from(d.values()).sort((c,n)=>c.name.localeCompare(n.name))}),Z=B(()=>{if(!S.value)return null;const d=le.value.find(c=>c.id===S.value);return d?d.name:null}),V=B(()=>{switch(i.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),R=d=>d.summary_counterparty?d.summary_counterparty:"Cliente",L=d=>{const c=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],n=d.id%c.length;return c[n]},de=B(()=>E.value.length>0&&C.value.length===E.value.length),ve=()=>{de.value?C.value=[]:C.value=E.value.map(d=>d.id)},z=d=>{const c=C.value.indexOf(d);c>-1?C.value.splice(c,1):C.value.push(d)},Q=()=>{C.value=E.value.map(d=>d.id)},I=()=>{C.value=[]},J=()=>{S.value=null},be=()=>{y.value>1&&y.value--},_e=()=>{y.value<G.value&&y.value++},we=d=>{d>=1&&d<=G.value&&(y.value=d)},Fe=B(()=>{const d=G.value,c=y.value,n=[];if(d<=7)for(let w=1;w<=d;w++)n.push(w);else if(c<=4){for(let w=1;w<=5;w++)n.push(w);n.push("..."),n.push(d)}else if(c>=d-3){n.push(1),n.push("...");for(let w=d-4;w<=d;w++)n.push(w)}else n.push(1),n.push("..."),n.push(c-1),n.push(c),n.push(c+1),n.push("..."),n.push(d);return n}),Me=()=>{const d=C.value.length>0?E.value.filter(De=>C.value.includes(De.id)):E.value,c=["Nombre Documento","Cliente","Estado","Etiquetas"],n=d.map(De=>[De.title||"",R(De),"En Progreso",De.tags?De.tags.map(Re=>Re.name).join(", "):""]),w=[c.join(","),...n.map(De=>De.map(Re=>`"${Re}"`).join(","))].join(`
`),ce=new Blob([w],{type:"text/csv;charset=utf-8;"}),ge=document.createElement("a"),Be=URL.createObjectURL(ce);ge.setAttribute("href",Be),ge.setAttribute("download",`documentos_en_progreso_${new Date().toISOString().split("T")[0]}.csv`),ge.style.visibility="hidden",document.body.appendChild(ge),ge.click(),document.body.removeChild(ge)},qe=async(d,c)=>{try{switch(d){case"editForm":v("edit",c,{userRole:q()});break;case"editDocument":D.push(`/dynamic_document_dashboard/client/editor/edit/${c.id}`);break;case"preview":await O(c);break;case"delete":await W(c);break;case"letterhead":v("letterhead",c);break;case"relationships":v("relationships",c);break;case"downloadPDF":await Y(c);break;case"downloadWord":await ae(c);break;case"email":v("email",c);break;default:console.warn("Unknown action:",d)}}catch(n){console.error(`Error executing action ${d}:`,n)}},H=x(!1),ne=x(null),fe=d=>{ne.value=d,H.value=!0},se=async(d,c)=>{H.value=!1,await qe(d,c)};return(d,c)=>(s(),r("div",null,[e("div",nu,[e("div",lu,[e("div",iu,[a(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Te(e("input",{"onUpdate:modelValue":c[0]||(c[0]=n=>K.value=n),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Ie,K.value]])])]),e("div",du,[a(t(je),{as:"div",class:"relative"},{default:M(()=>[a(t(Pe),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[e("div",cu,[a(t(tt),{class:"h-4 w-4 flex-shrink-0"}),e("span",uu,p(Z.value||"Etiqueta"),1)]),a(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),a(t(Le),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:M(()=>[e("div",mu,[a(t(ye),null,{default:M(({active:n})=>[e("a",{onClick:c[1]||(c[1]=w=>S.value=null),class:j([n?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),r(ue,null,he(le.value,n=>(s(),oe(t(ye),{key:n.id},{default:M(({active:w})=>[e("a",{onClick:ce=>S.value=n.id,class:j([w?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},p(n.name),11,gu)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",pu,[S.value?(s(),r("button",{key:0,onClick:J,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[a(t(Ee),{class:"h-4 w-4 flex-shrink-0"}),hu])):f("",!0)])]),e("div",fu,[e("div",vu,[e("div",yu,[e("button",{onClick:Me,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[a(t(st),{class:"h-4 w-4"}),bu]),a(t(je),{as:"div",class:"relative"},{default:M(()=>[a(t(Pe),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:M(()=>[a(t(rt),{class:"h-5 w-5 text-gray-500"})]),_:1}),a(t(Le),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",xu,[a(t(ye),null,{default:M(({active:n})=>[e("a",{onClick:Q,class:j([n?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),a(t(ye),null,{default:M(({active:n})=>[e("a",{onClick:I,class:j([n?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),a(t(je),{as:"div",class:"relative"},{default:M(()=>[a(t(Pe),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[_u,te(" "+p(V.value)+" ",1),a(t(Oe),{class:"h-4 w-4"})]),_:1}),a(t(Le),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",wu,[a(t(ye),null,{default:M(({active:n})=>[e("a",{onClick:c[2]||(c[2]=w=>i.value="recent"),class:j([n?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),a(t(ye),null,{default:M(({active:n})=>[e("a",{onClick:c[3]||(c[3]=w=>i.value="name"),class:j([n?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",$u,[e("div",ku,[e("table",Cu,[e("thead",Du,[e("tr",null,[e("th",Su,[e("input",{type:"checkbox",checked:de.value,onChange:ve,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Fu)]),Eu,Tu,Au,Mu,ju])]),e("tbody",Pu,[(s(!0),r(ue,null,he(N.value,(n,w)=>{var ce;return s(),r("tr",{key:n.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:ge=>fe(n)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:c[4]||(c[4]=pe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:C.value.includes(n.id),onChange:ge=>z(n.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Bu)]),e("td",Ru,[e("div",zu,[e("div",Iu,[e("div",Uu,[a(t(Ue),{class:"h-5 w-5 text-blue-600"})])]),e("div",Ou,[e("div",Nu,p(n.title),1)])])]),e("td",qu,[e("div",Vu,p(R(n)),1)]),Qu,e("td",Wu,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100",onClick:pe(ge=>t(v)("relationships",n),["stop"])}," Ver asociaciones ",8,Gu)]),e("td",Hu,[e("div",Zu,[(s(!0),r(ue,null,he((ce=n.tags)==null?void 0:ce.slice(0,2),ge=>(s(),r("span",{key:ge.id,class:j(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",L(ge)])},p(ge.name),3))),128)),n.tags&&n.tags.length>2?(s(),r("span",Ku," +"+p(n.tags.length-2),1)):f("",!0),!n.tags||n.tags.length===0?(s(),r("span",Yu,"-")):f("",!0)])])],8,Lu)}),128))])])]),G.value>1?(s(),r("div",Ju,[e("div",Xu,[e("button",{onClick:be,disabled:y.value===1,class:j(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",y.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,em),e("button",{onClick:_e,disabled:y.value===G.value,class:j(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",y.value===G.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,tm)]),e("div",sm,[e("div",null,[e("p",om,[te(" Mostrando "),e("span",am,p(re.value.start),1),te(" a "),e("span",rm,p(re.value.end),1),te(" de "),e("span",nm,p(re.value.total),1),te(" resultados ")])]),e("div",null,[e("nav",lm,[e("button",{onClick:be,disabled:y.value===1,class:j(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",y.value===1?"opacity-50 cursor-not-allowed":""])},[dm,a(t(Ct),{class:"h-5 w-5","aria-hidden":"true"})],10,im),(s(!0),r(ue,null,he(Fe.value,n=>(s(),r(ue,{key:n},[n!=="..."?(s(),r("button",{key:0,onClick:w=>we(n),class:j(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",y.value===n?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},p(n),11,cm)):(s(),r("span",um," ... "))],64))),128)),e("button",{onClick:_e,disabled:y.value===G.value,class:j(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",y.value===G.value?"opacity-50 cursor-not-allowed":""])},[gm,a(t(pt),{class:"h-5 w-5","aria-hidden":"true"})],10,mm)])])])])):f("",!0)]),E.value.length===0?(s(),r("div",pm,[a(t(At),{class:"mx-auto h-12 w-12 text-gray-400"}),hm,fm])):f("",!0),(s(),oe(qt,{to:"body"},[t(k).edit.isOpen?(s(),oe(t(Wt),{key:0,document:t(k).edit.document,"user-role":t(q)(),onClose:c[5]||(c[5]=n=>t(F)("edit")),onRefresh:c[6]||(c[6]=n=>h("refresh"))},null,8,["document","user-role"])):f("",!0),t(k).email.isOpen?(s(),oe(t(Gt),{key:1,document:t(k).email.document,onClose:c[7]||(c[7]=n=>t(F)("email"))},null,8,["document"])):f("",!0),t(k).letterhead.isOpen?(s(),oe(Tt,{key:2,"is-visible":t(k).letterhead.isOpen,document:t(k).letterhead.document,onClose:c[8]||(c[8]=n=>t(F)("letterhead")),onUploaded:c[9]||(c[9]=n=>h("refresh")),onDeleted:c[10]||(c[10]=n=>h("refresh"))},null,8,["is-visible","document"])):f("",!0),t(k).relationships.isOpen?(s(),oe(Dt,{key:3,"is-open":t(k).relationships.isOpen,document:t(k).relationships.document,onClose:c[11]||(c[11]=n=>t(F)("relationships")),onRefresh:c[12]||(c[12]=n=>h("refresh"))},null,8,["is-open","document"])):f("",!0),H.value?(s(),oe(Mt,{key:4,"is-visible":H.value,document:ne.value,"card-type":"client",context:"table","user-store":t(u),onClose:c[13]||(c[13]=n=>H.value=!1),onAction:se},null,8,["is-visible","document","user-store"])):f("",!0)]))]))}},ym={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},bm={class:"mb-4"},xm={class:"relative w-full"},_m={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},wm={class:"flex items-center gap-2 min-w-0"},$m={class:"truncate"},km={class:"p-2"},Cm={class:"relative mb-2"},Dm={class:"max-h-60 overflow-y-auto"},Sm=["onClick"],Fm={class:"truncate"},Em={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},Tm={class:"flex items-center justify-stretch"},Am=e("span",null,"Limpiar",-1),Mm={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},jm={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Pm={class:"flex items-center gap-2"},Lm=e("span",{class:"hidden sm:inline"},"Exportar",-1),Bm={class:"py-1"},Rm=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),zm={class:"py-1"},Im={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Um={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Om={class:"min-w-full divide-y divide-gray-200"},Nm={class:"bg-gray-50"},qm={scope:"col",class:"w-12 px-6 py-3"},Vm=["checked"],Qm=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Wm=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado Firma ",-1),Gm=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Información clave ",-1),Hm={key:0,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Zm=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),Km={class:"bg-white divide-y divide-gray-200"},Ym=["onClick"],Jm=["checked","onChange"],Xm={class:"px-6 py-4 whitespace-nowrap"},e0={class:"flex items-center"},t0={class:"flex-shrink-0 h-10 w-10"},s0={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},o0={class:"ml-4"},a0={class:"text-sm font-medium text-gray-900"},r0={class:"px-6 py-4 whitespace-nowrap"},n0={class:"px-6 py-4 whitespace-nowrap"},l0={class:"flex items-center gap-2"},i0=["onClick"],d0={key:1,class:"text-gray-400 text-xs"},c0={key:0,class:"px-6 py-4 whitespace-nowrap"},u0=["disabled","onClick"],m0={key:0},g0={key:1},p0={class:"px-6 py-4 whitespace-nowrap"},h0={class:"flex flex-wrap gap-1"},f0={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},v0={key:1,class:"text-sm text-gray-400"},y0={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},b0={class:"flex flex-1 justify-between sm:hidden"},x0=["disabled"],_0=["disabled"],w0={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},$0={class:"text-sm text-gray-700"},k0={class:"font-medium"},C0={class:"font-medium"},D0={class:"font-medium"},S0={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},F0=["disabled"],E0=e("span",{class:"sr-only"},"Anterior",-1),T0=["onClick"],A0={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},M0=["disabled"],j0=e("span",{class:"sr-only"},"Siguiente",-1),P0={key:0,class:"text-center py-12"},L0={class:"mt-2 text-sm font-medium text-gray-900"},B0={class:"mt-1 text-sm text-gray-500"},R0={key:1,class:"text-center py-12"},z0=e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-secondary"},null,-1),I0=e("p",{class:"mt-2 text-sm text-gray-500"},"Cargando documentos...",-1),U0=[z0,I0],O0={key:5,class:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40"},N0={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4"},q0={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},V0=e("h2",{class:"text-sm font-semibold text-gray-900"},"Rechazar documento",-1),Q0={class:"px-4 py-4 space-y-3 text-sm text-gray-700"},W0={class:"font-semibold"},G0=e("p",{class:"text-xs text-gray-500"}," El rechazo devolverá el documento al abogado creador para que pueda revisarlo, editarlo o archivarlo. ",-1),H0=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Motivo del rechazo (opcional) ",-1),Z0={key:6,class:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40"},K0={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4"},Y0={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},J0=e("h2",{class:"text-sm font-semibold text-gray-900"},"Motivo del rechazo",-1),X0={class:"px-4 py-4 text-sm text-gray-700 whitespace-pre-line"},eg={class:"px-4 py-3 border-t border-gray-100 flex justify-end bg-gray-50"},at={__name:"SignaturesListTable",props:{state:{type:String,required:!0,validator:o=>["PendingSignatures","FullySigned","Archived"].includes(o)},searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","document-fully-signed","document-rejected","open-electronic-signature"],setup(o,{expose:_,emit:l}){const u=o,D=l,b=Ze(),h=Ne();Je();const{activeModals:k,openModal:v,closeModal:F,getUserRole:q}=Ft(h,b),{handlePreviewDocument:O,downloadPDFDocument:W,signDocument:Y,downloadSignedDocument:ae}=Et(h,b,D);x([]);const K=x(!1),S=x(""),i=x(""),C=x(null),y=x("recent"),X=x([]),P=x(!1),E=x(null),N=x(1),G=x(10),re=B(()=>u.state==="PendingSignatures"?"No tienes documentos pendientes por firmar":u.state==="FullySigned"?"No tienes documentos firmados":"No tienes documentos archivados"),le=B(()=>u.state==="PendingSignatures"?"Cuando tengas documentos que requieran tu firma electrónica aparecerán aquí.":u.state==="FullySigned"?"Una vez que firmes documentos electrónicamente, aparecerán aquí.":"Aquí aparecerán los documentos rechazados o expirados relacionados contigo."),Z=B(()=>{const U=b.currentUser.role,T=b.currentUser.id,ee=b.currentUser.email;let A=[];return U==="lawyer"?u.state==="PendingSignatures"?A=h.pendingSignatureDocuments.filter(me=>{var g;const xe=me.created_by===T,ke=(g=me.signatures)==null?void 0:g.some(m=>m.signer_email===ee);return xe||ke}):u.state==="FullySigned"?A=h.fullySignedDocuments.filter(me=>{var g;const xe=me.created_by===T,ke=(g=me.signatures)==null?void 0:g.some(m=>m.signer_email===ee&&m.signed);return xe||ke}):u.state==="Archived"&&(A=h.documents.filter(me=>{var g;if(me.state!=="Rejected"&&me.state!=="Expired")return!1;const xe=me.created_by===T,ke=(g=me.signatures)==null?void 0:g.some(m=>m.signer_email===ee);return xe||ke})):u.state==="PendingSignatures"?A=h.documents.filter(me=>{var g;if(me.state!=="PendingSignatures")return!1;const xe=(g=me.signatures)==null?void 0:g.some(m=>m.signer_email===ee),ke=me.created_by===T;return xe||ke}):u.state==="FullySigned"?A=h.documents.filter(me=>{var g;if(me.state!=="FullySigned")return!1;const xe=(g=me.signatures)==null?void 0:g.some(m=>m.signer_email===ee&&m.signed),ke=me.created_by===T;return xe||ke}):u.state==="Archived"&&(A=h.documents.filter(me=>{var g;if(me.state!=="Rejected"&&me.state!=="Expired")return!1;const xe=(g=me.signatures)==null?void 0:g.some(m=>m.signer_email===ee),ke=me.created_by===T;return xe||ke})),A}),V=B(()=>{let U=[...Z.value];const T=S.value.toLowerCase();return T&&(U=U.filter(ee=>{var A,me;return((A=ee.title)==null?void 0:A.toLowerCase().includes(T))||((me=ee.tags)==null?void 0:me.some(xe=>{var ke;return(ke=xe.name)==null?void 0:ke.toLowerCase().includes(T)}))})),C.value&&(U=U.filter(ee=>ee.tags&&ee.tags.some(A=>A.id===C.value))),y.value==="name"?U.sort((ee,A)=>{const me=(ee.title||"").toLowerCase(),xe=(A.title||"").toLowerCase();return me.localeCompare(xe)}):y.value==="recent"&&U.sort((ee,A)=>{const me=new Date(ee.updated_at||ee.created_at);return new Date(A.updated_at||A.created_at)-me}),U}),R=B(()=>{const U=(N.value-1)*G.value,T=U+G.value;return V.value.slice(U,T)}),L=B(()=>Math.ceil(V.value.length/G.value)),de=B(()=>{const U=(N.value-1)*G.value+1,T=Math.min(N.value*G.value,V.value.length);return{start:U,end:T,total:V.value.length}});Se([S,C],()=>{N.value=1});const ve=B(()=>{const U=new Map;return Z.value.forEach(T=>{T.tags&&T.tags.length>0&&T.tags.forEach(ee=>{U.has(ee.id)||U.set(ee.id,ee)})}),Array.from(U.values()).sort((T,ee)=>T.name.localeCompare(ee.name))}),z=B(()=>{if(!i.value)return ve.value;const U=i.value.toLowerCase();return ve.value.filter(T=>T.name.toLowerCase().includes(U))}),Q=B(()=>{if(!C.value)return null;const U=ve.value.find(T=>T.id===C.value);return U?U.name:null}),I=U=>{const T=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],ee=U.id%T.length;return T[ee]},J=B(()=>{switch(y.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),be=U=>{const T=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],ee=U.id%T.length;return T[ee]},_e=U=>u.state==="FullySigned"?"bg-green-100 text-green-700 border border-green-200":u.state==="Archived"?U.state==="Rejected"?"bg-red-100 text-red-700 border border-red-200":(U.state==="Expired","bg-gray-100 text-gray-700 border border-gray-200"):"bg-yellow-100 text-yellow-700 border border-yellow-200",we=U=>u.state==="FullySigned"?"Firmado":u.state==="Archived"?U.state==="Rejected"?"Rechazado":U.state==="Expired"?"Expirado":"Archivado":"Pendiente",Fe=B(()=>V.value.length>0&&X.value.length===V.value.length),Me=()=>{Fe.value?X.value=[]:X.value=V.value.map(U=>U.id)},qe=U=>{const T=X.value.indexOf(U);T>-1?X.value.splice(T,1):X.value.push(U)},H=()=>{X.value=V.value.map(U=>U.id)},ne=()=>{X.value=[]},fe=()=>{C.value=null},se=()=>{N.value>1&&N.value--},d=()=>{N.value<L.value&&N.value++},c=U=>{U>=1&&U<=L.value&&(N.value=U)},n=B(()=>{const U=L.value,T=N.value,ee=[];if(U<=7)for(let A=1;A<=U;A++)ee.push(A);else if(T<=4){for(let A=1;A<=5;A++)ee.push(A);ee.push("..."),ee.push(U)}else if(T>=U-3){ee.push(1),ee.push("...");for(let A=U-4;A<=U;A++)ee.push(A)}else ee.push(1),ee.push("..."),ee.push(T-1),ee.push(T),ee.push(T+1),ee.push("..."),ee.push(U);return ee}),w=()=>{const U=X.value.length>0?V.value.filter(g=>X.value.includes(g.id)):V.value,T=["Nombre Documento","Estado Firma","Etiquetas"],ee=U.map(g=>[g.title||"",we(g),g.tags?g.tags.map(m=>m.name).join(", "):""]),A=[T.join(","),...ee.map(g=>g.map(m=>`"${m}"`).join(","))].join(`
`),me=new Blob([A],{type:"text/csv;charset=utf-8;"}),xe=document.createElement("a"),ke=URL.createObjectURL(me);xe.setAttribute("href",ke),xe.setAttribute("download",`documentos_firmas_${new Date().toISOString().split("T")[0]}.csv`),xe.style.visibility="hidden",document.body.appendChild(xe),xe.click(),document.body.removeChild(xe)},ce=x(!1),ge=x(null),Be=x(!1),De=x(null),Re=x(""),Xe=x(!1),lt=x(""),jt=U=>{ge.value=U,ce.value=!0},Pt=async(U,T)=>{ce.value=!1,await it(U,T)},it=async(U,T)=>{try{switch(U){case"preview":await O(T);break;case"letterhead":v("letterhead",T);break;case"relationships":v("relationships",T);break;case"viewSignatures":v("signatures",T);break;case"sign":await Y(T,v);break;case"reject":De.value=T,Re.value="",Be.value=!0;break;case"viewRejectionReason":{const ee=(T.signatures||[]).find(A=>A.rejection_comment);ee&&ee.rejection_comment?(lt.value=ee.rejection_comment,Xe.value=!0):await Ce("Este documento no tiene un motivo de rechazo registrado.","info");break}case"downloadSignedDocument":await ae(T);break;case"downloadPDF":await W(T);break;default:console.warn("Unknown action:",U)}}catch(ee){console.error(`Error executing action ${U}:`,ee)}},dt=()=>{Be.value=!1,De.value=null,Re.value=""},Lt=async()=>{if(!De.value)return;const U=De.value,T=U.id,ee=b.currentUser.id;try{const A=`dynamic-documents/${T}/reject/${ee}/`,me=Re.value?{comment:Re.value}:{},xe=await ns(A,me);xe&&(xe.status===200||xe.status===201)?(dt(),D("document-rejected",U),Promise.all([Ce("Documento rechazado correctamente.","success"),$s(ks.FINISH,`Rechazaste el documento "${U.title}"`).catch(ke=>console.warn("No se pudo registrar la actividad de rechazo:",ke)),h.init(!0)]).then(()=>{D("refresh")})):await Ce("Error al rechazar el documento.","error")}catch(A){console.error("Error rejecting document:",A),await Ce("Error al rechazar el documento.","error")}},ft=async()=>{K.value=!0;try{await h.init(!0)}catch(U){console.error("Error refreshing documents:",U),Ce("Error al actualizar documentos","error")}finally{K.value=!1}},vt=async()=>{await ft(),D("refresh")};Qe(async()=>{await ft()}),_({refresh:vt});const Bt=U=>{E.value=U,P.value=!0},Rt=U=>{var ee;if(!U.summary_counterparty)return null;const T=(ee=U.variables)==null?void 0:ee.find(A=>A.summary_field==="counterparty");return(T==null?void 0:T.value)||U.summary_counterparty},zt=U=>{if(!U.summary_value)return null;const T=parseFloat(U.summary_value);return isNaN(T)?null:T},yt=U=>!!(Rt(U)||U.summary_object||zt(U)||U.summary_term||U.summary_subscription_date||U.summary_start_date||U.summary_end_date);return Se(()=>b.currentUser,()=>{vt()}),(U,T)=>{var ee;return s(),r("div",null,[e("div",ym,[e("div",bm,[e("div",xm,[a(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Te(e("input",{"onUpdate:modelValue":T[0]||(T[0]=A=>S.value=A),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Ie,S.value]])])]),e("div",_m,[a(t(je),{as:"div",class:"relative"},{default:M(()=>[a(t(Pe),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[e("div",wm,[a(t(tt),{class:"h-4 w-4 flex-shrink-0"}),e("span",$m,p(Q.value||"Etiqueta"),1)]),a(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),a(t(Le),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",km,[e("div",Cm,[a(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Te(e("input",{"onUpdate:modelValue":T[1]||(T[1]=A=>i.value=A),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:T[2]||(T[2]=pe(()=>{},["stop"]))},null,512),[[Ie,i.value]])]),e("div",Dm,[a(t(ye),null,{default:M(({active:A})=>[e("a",{onClick:T[3]||(T[3]=me=>C.value=null),class:j([A?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),r(ue,null,he(z.value,A=>(s(),oe(t(ye),{key:A.id},{default:M(({active:me})=>[e("a",{onClick:xe=>C.value=A.id,class:j([me?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:j(["w-3 h-3 rounded-full flex-shrink-0",I(A)])},null,2),e("span",Fm,p(A.name),1)],10,Sm)]),_:2},1024))),128)),z.value.length===0?(s(),r("div",Em," No se encontraron etiquetas ")):f("",!0)])])]),_:1})]),_:1}),e("div",Tm,[C.value?(s(),r("button",{key:0,onClick:fe,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[a(t(Ee),{class:"h-4 w-4 flex-shrink-0"}),Am])):f("",!0)])]),e("div",Mm,[e("div",jm,[e("div",Pm,[e("button",{onClick:w,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[a(t(st),{class:"h-4 w-4"}),Lm]),a(t(je),{as:"div",class:"relative"},{default:M(()=>[a(t(Pe),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:M(()=>[a(t(rt),{class:"h-5 w-5 text-gray-500"})]),_:1}),a(t(Le),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",Bm,[a(t(ye),null,{default:M(({active:A})=>[e("a",{onClick:H,class:j([A?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),a(t(ye),null,{default:M(({active:A})=>[e("a",{onClick:ne,class:j([A?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),a(t(je),{as:"div",class:"relative"},{default:M(()=>[a(t(Pe),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[Rm,te(" "+p(J.value)+" ",1),a(t(Oe),{class:"h-4 w-4"})]),_:1}),a(t(Le),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",zm,[a(t(ye),null,{default:M(({active:A})=>[e("a",{onClick:T[4]||(T[4]=me=>y.value="recent"),class:j([A?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),a(t(ye),null,{default:M(({active:A})=>[e("a",{onClick:T[5]||(T[5]=me=>y.value="name"),class:j([A?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Im,[e("div",Um,[e("table",Om,[e("thead",Nm,[e("tr",null,[e("th",qm,[e("input",{type:"checkbox",checked:Fe.value,onChange:Me,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Vm)]),Qm,Wm,Gm,u.state==="PendingSignatures"||u.state==="FullySigned"?(s(),r("th",Hm," Docs. Asociados ")):f("",!0),Zm])]),e("tbody",Km,[(s(!0),r(ue,null,he(R.value,(A,me)=>{var xe;return s(),r("tr",{key:A.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:ke=>jt(A)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:T[6]||(T[6]=pe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:X.value.includes(A.id),onChange:ke=>qe(A.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Jm)]),e("td",Xm,[e("div",e0,[e("div",t0,[e("div",s0,[a(t(Ue),{class:"h-5 w-5 text-purple-600"})])]),e("div",o0,[e("div",a0,p(A.title),1)])])]),e("td",r0,[e("span",{class:j(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",_e(A)])},p(we(A)),3)]),e("td",n0,[e("div",l0,[yt(A)?(s(),r("button",{key:0,type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border border-blue-200 text-blue-700 bg-blue-50 hover:bg-blue-100",onClick:pe(ke=>Bt(A),["stop"])}," Ver detalle ",8,i0)):(s(),r("span",d0," Sin clasificación "))])]),u.state==="PendingSignatures"||u.state==="FullySigned"?(s(),r("td",c0,[e("button",{type:"button",disabled:!A.relationships_count||A.relationships_count===0,class:j(["inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border transition-colors",A.relationships_count&&A.relationships_count>0?"border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100 cursor-pointer":"border-gray-200 text-gray-400 bg-gray-50 cursor-not-allowed opacity-60"]),onClick:pe(ke=>t(v)("relationships",A),["stop"])},[A.relationships_count&&A.relationships_count>0?(s(),r("span",m0," Ver asociaciones ("+p(A.relationships_count)+") ",1)):(s(),r("span",g0," Sin asociaciones "))],10,u0)])):f("",!0),e("td",p0,[e("div",h0,[(s(!0),r(ue,null,he((xe=A.tags)==null?void 0:xe.slice(0,2),ke=>(s(),r("span",{key:ke.id,class:j(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",be(ke)])},p(ke.name),3))),128)),A.tags&&A.tags.length>2?(s(),r("span",f0," +"+p(A.tags.length-2),1)):f("",!0),!A.tags||A.tags.length===0?(s(),r("span",v0,"-")):f("",!0)])])],8,Ym)}),128))])])]),L.value>1?(s(),r("div",y0,[e("div",b0,[e("button",{onClick:se,disabled:N.value===1,class:j(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",N.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,x0),e("button",{onClick:d,disabled:N.value===L.value,class:j(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",N.value===L.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,_0)]),e("div",w0,[e("div",null,[e("p",$0,[te(" Mostrando "),e("span",k0,p(de.value.start),1),te(" a "),e("span",C0,p(de.value.end),1),te(" de "),e("span",D0,p(de.value.total),1),te(" resultados ")])]),e("div",null,[e("nav",S0,[e("button",{onClick:se,disabled:N.value===1,class:j(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",N.value===1?"opacity-50 cursor-not-allowed":""])},[E0,a(t(Ct),{class:"h-5 w-5","aria-hidden":"true"})],10,F0),(s(!0),r(ue,null,he(n.value,A=>(s(),r(ue,{key:A},[A!=="..."?(s(),r("button",{key:0,onClick:me=>c(A),class:j(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",N.value===A?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},p(A),11,T0)):(s(),r("span",A0," ... "))],64))),128)),e("button",{onClick:d,disabled:N.value===L.value,class:j(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",N.value===L.value?"opacity-50 cursor-not-allowed":""])},[j0,a(t(pt),{class:"h-5 w-5","aria-hidden":"true"})],10,M0)])])])])):f("",!0)]),V.value.length===0&&!K.value?(s(),r("div",P0,[a(t(At),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",L0,p(re.value),1),e("p",B0,p(le.value),1)])):f("",!0),K.value?(s(),r("div",R0,U0)):f("",!0),a(Qt,{isVisible:t(et),documentData:t(Vt),onClose:T[7]||(T[7]=A=>et.value=!1)},null,8,["isVisible","documentData"]),(s(),oe(qt,{to:"body"},[t(k).signatures.isOpen?(s(),oe(t(ls),{key:0,"document-id":(ee=t(k).signatures.document)==null?void 0:ee.id,onClose:T[8]||(T[8]=A=>t(F)("signatures")),onRefresh:T[9]||(T[9]=A=>D("refresh")),onOpenElectronicSignature:T[10]||(T[10]=A=>D("open-electronic-signature"))},null,8,["document-id"])):f("",!0),t(k).letterhead.isOpen?(s(),oe(Tt,{key:1,"is-visible":t(k).letterhead.isOpen,document:t(k).letterhead.document,onClose:T[11]||(T[11]=A=>t(F)("letterhead")),onRefresh:T[12]||(T[12]=A=>D("refresh"))},null,8,["is-visible","document"])):f("",!0),ce.value?(s(),oe(Mt,{key:2,"is-visible":ce.value,document:ge.value,"card-type":"signatures",context:"table","user-store":t(b),onClose:T[13]||(T[13]=A=>ce.value=!1),onAction:Pt},null,8,["is-visible","document","user-store"])):f("",!0),t(k).relationships.isOpen?(s(),oe(Dt,{key:3,"is-open":t(k).relationships.isOpen,document:t(k).relationships.document,readonly:u.state==="PendingSignatures"||u.state==="FullySigned",onClose:T[14]||(T[14]=A=>t(F)("relationships")),onRefresh:T[15]||(T[15]=A=>D("refresh"))},null,8,["is-open","document","readonly"])):f("",!0),P.value?(s(),oe(ps,{key:4,"is-visible":P.value,document:E.value,onClose:T[16]||(T[16]=A=>P.value=!1)},null,8,["is-visible","document"])):f("",!0),Be.value&&De.value?(s(),r("div",O0,[e("div",N0,[e("div",q0,[V0,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:dt},[a(t(Ee),{class:"h-5 w-5"})])]),e("div",Q0,[e("p",null,[te(" Estás a punto de rechazar el documento "),e("span",W0,'"'+p(De.value.title)+'"',1),te(". ")]),G0,e("div",null,[H0,Te(e("textarea",{"onUpdate:modelValue":T[17]||(T[17]=A=>Re.value=A),rows:"4",class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-secondary focus:border-transparent resize-none",placeholder:"Describe brevemente por qué no estás de acuerdo con el documento..."},null,512),[[Ie,Re.value]])])]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end gap-2 bg-gray-50"},[e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100",onClick:dt}," Cancelar "),e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700",onClick:Lt}," Rechazar documento ")])])])):f("",!0),Xe.value?(s(),r("div",Z0,[e("div",K0,[e("div",Y0,[J0,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:T[18]||(T[18]=A=>Xe.value=!1)},[a(t(Ee),{class:"h-5 w-5"})])]),e("div",X0,p(lt.value||"No se encontró un motivo de rechazo para este documento."),1),e("div",eg,[e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100",onClick:T[19]||(T[19]=A=>Xe.value=!1)}," Cerrar ")])])])):f("",!0)]))])}}},tg={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},sg={class:"flex justify-end"},og=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[te(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),ag={class:"mt-2"},rg={class:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t border-gray-200"},ng=["disabled"],lg=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),ig=e("span",null,"Actualizar nombre",-1),dg=[lg,ig],cg=["disabled"],ug=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1),mg={__name:"CreateDocumentByLawyer",emits:["close"],setup(o,{emit:_}){const l=Je(),u=Ne(),D=_,b=x(""),h=x("");as(()=>{var Y;(Y=u.selectedDocument)!=null&&Y.title?(b.value=u.selectedDocument.title,h.value=u.selectedDocument.title):(b.value="",h.value="")});const k=Y=>{Y.key==="Escape"&&D("close")};Qe(()=>{document.addEventListener("keydown",k)}),mt(()=>{document.removeEventListener("keydown",k)});const v=B(()=>b.value.trim().length>0),F=B(()=>{var Y;return!!((Y=u.selectedDocument)!=null&&Y.id)}),q=B(()=>F.value&&b.value.trim()!==h.value.trim()&&b.value.trim().length>0);async function O(){if(F.value&&q.value)try{const Y={title:b.value.trim()};await u.updateDocument(u.selectedDocument.id,Y),h.value=b.value.trim(),u.selectedDocument.title=b.value.trim(),u.lastUpdatedDocumentId=u.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",u.selectedDocument.id);const ae=u.selectedDocument.id;D("close",{updatedDocId:ae});const K=window.location.pathname;K==="/dynamic_document_dashboard"||K==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(ae)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(Y){console.error("Error updating document name:",Y)}}const W=async()=>{if(!v.value)return;const Y=encodeURIComponent(b.value.trim());F.value?(u.selectedDocument.title=b.value,u.selectedDocument.id&&(u.lastUpdatedDocumentId=u.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",u.selectedDocument.id.toString())),l.push(`/dynamic_document_dashboard/lawyer/editor/edit/${u.selectedDocument.id}`)):(u.selectedDocument={title:b.value.trim()},l.push(`/dynamic_document_dashboard/lawyer/editor/create/${Y}`))};return(Y,ae)=>(s(),r("div",tg,[e("div",sg,[e("button",{onClick:ae[0]||(ae[0]=K=>D("close"))},[a(t(Ee),{class:"size-6"})])]),e("form",{onSubmit:pe(W,["prevent"])},[e("div",null,[og,e("div",ag,[Te(e("input",{"onUpdate:modelValue":ae[1]||(ae[1]=K=>b.value=K),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[Ie,b.value]])])]),e("div",rg,[F.value?(s(),r("button",{key:0,type:"button",onClick:O,disabled:!q.value,class:j(["inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm transition-all duration-200",q.value?"bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500":"bg-gray-100 text-gray-400 border-2 border-dashed border-gray-300 cursor-not-allowed"])},dg,10,ng)):f("",!0),e("button",{type:"submit",class:j(["inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm transition-all duration-200",v.value?"bg-green-600 text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500":"bg-gray-100 text-gray-400 border-2 border-dashed border-gray-300 cursor-not-allowed"]),disabled:!v.value},[ug,e("span",null,p(F.value?"Editar Documento":"Continuar"),1)],10,cg)])],32)]))}},Ae=o=>($t("data-v-857c746d"),o=o(),kt(),o),gg={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},pg={class:"px-6 py-4 border-b border-gray-200"},hg=Ae(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gestión de Membrete Global para PDF",-1)),fg=Ae(()=>e("p",{class:"text-sm text-gray-500 mt-1"}," La imagen de membrete se usará por defecto solo al generar documentos en PDF. Para documentos Word, se utiliza la plantilla .docx configurada más abajo. ",-1)),vg={class:"p-6 overflow-y-auto flex-grow"},yg={key:0,class:"text-center py-10"},bg=Ae(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),xg={class:"mt-4 text-gray-500"},_g={key:1,class:"space-y-6"},wg={key:0,class:"space-y-4"},$g=Ae(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete de imagen para PDF actual",-1)),kg={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Cg=["src"],Dg={class:"mt-4 flex justify-center space-x-3"},Sg=["disabled"],Fg={key:1,class:"text-center py-8"},Eg=Ae(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete para PDF",-1)),Tg=Ae(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," No tienes una imagen de membrete global configurada para los documentos PDF. ",-1)),Ag=Ae(()=>e("p",{class:"mt-1 text-xs text-gray-400"}," Este membrete de imagen se aplicará solo a los PDF que no tengan un membrete específico. ",-1)),Mg={class:"space-y-4"},jg={class:"text-lg font-medium text-gray-900"},Pg={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},Lg={key:0},Bg={class:"mt-4"},Rg=Ae(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, máximo 10MB. Se usa únicamente para los PDF. ",-1)),zg=Ae(()=>e("p",{class:"text-xs text-gray-400 mt-1"},' Dimensiones ideales: 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI) ',-1)),Ig={key:1,class:"space-y-4"},Ug={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Og={class:"text-gray-400"},Ng={key:0,class:"mt-4"},qg=["src"],Vg={class:"flex justify-center space-x-3"},Qg=["disabled"],Wg={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Gg={class:"space-y-4 border-t border-gray-200 pt-6"},Hg=Ae(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Plantilla Word para documentos (.docx)",-1)),Zg=Ae(()=>e("p",{class:"text-sm text-gray-500"}," Esta plantilla se usará al descargar documentos en Word. Debe ser un archivo .docx con tu membrete configurado (header, footer o watermark). El contenido del documento se añadirá sobre esa plantilla. ",-1)),Kg={key:0,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Yg={class:"text-sm text-gray-700"},Jg=Ae(()=>e("div",{class:"font-medium"},"Plantilla actual:",-1)),Xg={class:"mt-1 break-words"},ep={class:"font-mono break-all"},tp={key:0,class:"text-gray-400 ml-2"},sp={class:"mt-3 flex flex-wrap gap-3"},op=["disabled"],ap={key:1,class:"text-sm text-gray-500"},rp={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},np={key:0},lp={class:"mt-4"},ip=Ae(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos .docx, máximo 10MB. ",-1)),dp={key:1,class:"space-y-4"},cp={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},up={class:"text-gray-400"},mp={class:"flex justify-center space-x-3"},gp=["disabled"],pp={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},hp={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},fp={class:"flex items-center space-x-2"},vp=Ae(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete para PDF",-1)),yp=Ae(()=>e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-yellow-800 mb-2"},"🔄 Prioridad de Membrete"),e("div",{class:"text-sm text-yellow-700 space-y-1"},[e("div",null,[e("strong",null,"1º Prioridad:"),te(" Membrete específico del documento")]),e("div",null,[e("strong",null,"2º Prioridad:"),te(" Membrete global de imagen para PDF del usuario (este)")]),e("div",null,[e("strong",null,"3º Prioridad:"),te(" Sin membrete")])])],-1)),bp=Ae(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"📐 Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"2550 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"3300 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporción:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta, 300 DPI)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"±10%")])])])],-1)),xp=Ae(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🎨 Distribución Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"⚠️ ZONA CRÍTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mantén semi-transparente. El texto del documento se superpone aquí.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, teléfonos, emails, información de contacto.")])])])])])],-1)),_p=Ae(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🔧 Consideraciones Técnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Posicionamiento:"),te(" La imagen se centra automáticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Transparencia:"),te(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Márgenes:"),te(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Resolución:"),te(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"⚠️"),e("span",null,[e("strong",null,"Zona crítica:"),te(" Evita elementos gráficos densos en el centro (300-400px de altura)")])])])])],-1)),wp=Ae(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"💡 Tips de Diseño Rápido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"• Si solo tienes header, ubícalo en los primeros 120-150px"),e("div",null,"• El resto de la imagen debe ser transparente o blanco"),e("div",null,"• Para footer, usa los últimos 80-120px"),e("div",null,"• El texto se superpone en toda la imagen, mantén el centro claro")])],-1)),$p={key:3,class:"space-y-2"},kp={class:"flex"},Cp={class:"text-sm text-yellow-700"},Dp={__name:"GlobalLetterheadModal",props:{isVisible:{type:Boolean,default:!1}},emits:["close","uploaded","deleted"],setup(o,{emit:_}){const l=o,u=_;Se(()=>l.isVisible,H=>{});const D=Ne(),b=x(!1),h=x(""),k=x(!1),v=x(!1),F=x(null),q=x(null),O=x(null),W=x([]),Y=x(null),ae=x(!1),K=x(!1),S=x(null),i=x(!1),C=x(null),y=x(""),X=x(null),P=x(!1),E=x(!1),N=x(null),G=()=>{Z(),u("close")},re=H=>{const ne=H.target.files[0];if(!ne)return;if(!ne.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(ne.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}F.value=ne,W.value=[];const fe=new FileReader;fe.onload=se=>{q.value=se.target.result;const d=new Image;d.onload=()=>{le(d.width,d.height)},d.src=se.target.result},fe.readAsDataURL(ne)},le=(H,ne)=>{const c=H/ne,n=2550/3300,w=Math.abs(c-n)/n;if(H===2550&&ne===3300){W.value.push("✅ Dimensiones perfectas: 2550 × 3300 píxeles");return}w<=.1?(W.value.push(`ℹ️ Buenas proporciones detectadas: ${H} × ${ne} píxeles (${c.toFixed(3)})`),(H!==2550||ne!==3300)&&W.value.push('💡 Para mejores resultados, usa exactamente 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI)')):(W.value.push(`⚠️ Proporciones no ideales: ${H} × ${ne} píxeles (${c.toFixed(3)})`),W.value.push(`🎯 Proporciones recomendadas: ${n.toFixed(3)} (8.5:11, tamaño carta)`),W.value.push("📐 Considera redimensionar tu imagen a 2550 × 3300 píxeles (tamaño carta)")),(H<1200||ne<1600)&&W.value.push("⚠️ Imagen muy pequeña - puede verse pixelada en documentos PDF tamaño carta"),(H>4e3||ne>5e3)&&W.value.push("ℹ️ Imagen muy grande - se redimensionará automáticamente para ajustarse al tamaño carta")},Z=()=>{F.value=null,q.value=null,W.value=[],ae.value=!1,Y.value&&(Y.value.value="")},V=async()=>{var H;if(F.value){k.value=!0,W.value=[];try{const ne=await D.uploadGlobalLetterheadImage(F.value);(H=ne.data)!=null&&H.warnings&&ne.data.warnings.length>0&&(W.value=ne.data.warnings),K.value=!1,await R(),Z(),u("uploaded",ne.data)}catch(ne){console.error("Error uploading global letterhead:",ne),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{k.value=!1}}},R=async()=>{if(!(O.value===null&&K.value)){K.value=!0;try{const H=await D.getGlobalLetterheadImage();H.data&&(O.value=URL.createObjectURL(H.data))}catch{O.value=null}}},L=async()=>{await Yt("¿Estás seguro de que deseas eliminar la imagen de membrete global?")&&de()},de=async()=>{v.value=!0;try{await D.deleteGlobalLetterheadImage(),O.value&&URL.revokeObjectURL(O.value),O.value=null,K.value=!0,u("deleted")}catch(H){console.error("Error deleting global letterhead:",H),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{v.value=!1}},ve=H=>{const ne=H.target.files[0];if(ne){if(!ne.name.toLowerCase().endsWith(".docx")){alert("Solo se permiten archivos .docx para la plantilla Word");return}if(ne.size>10*1024*1024){alert("El archivo de plantilla no puede ser mayor a 10MB");return}S.value=ne}},z=()=>{S.value=null,N.value&&(N.value.value="")},Q=async()=>{var H;if(S.value){P.value=!0;try{const fe=(H=(await D.uploadGlobalLetterheadWordTemplate(S.value)).data)==null?void 0:H.template_info;i.value=!0,y.value=(fe==null?void 0:fe.filename)||S.value.name,X.value=(fe==null?void 0:fe.size_bytes)||S.value.size,await I(),z()}catch(ne){console.error("Error uploading global Word template:",ne),alert("Error al subir la plantilla Word. Por favor intenta nuevamente.")}finally{P.value=!1}}},I=async()=>{var H,ne;try{const fe=await D.getGlobalLetterheadWordTemplate("blob");if(!fe){i.value=!1,C.value&&URL.revokeObjectURL(C.value),C.value=null,y.value="",X.value=null;return}if(fe&&fe.data){i.value=!0,C.value&&URL.revokeObjectURL(C.value),C.value=URL.createObjectURL(fe.data);const se=((H=fe.headers)==null?void 0:H["content-disposition"])||((ne=fe.headers)==null?void 0:ne["Content-Disposition"]);let d="plantilla_word.docx";if(se){const c=se.match(/filename="?([^";]+)"?/i);c&&c[1]&&(d=c[1])}y.value=d,X.value=fe.data.size||null}}catch(fe){console.error("Error loading global Word template:",fe)}},J=async()=>{await Yt("¿Estás seguro de que deseas eliminar la plantilla Word de membrete global?")&&be()},be=async()=>{E.value=!0;try{await D.deleteGlobalLetterheadWordTemplate(),C.value&&URL.revokeObjectURL(C.value),C.value=null,y.value="",X.value=null,i.value=!1}catch(H){console.error("Error deleting global Word template:",H),alert("Error al eliminar la plantilla Word. Por favor intenta nuevamente.")}finally{E.value=!1}},_e=()=>{if(C.value){const H=document.createElement("a");H.href=C.value,H.download=y.value||"membrete-word.docx",document.body.appendChild(H),H.click(),document.body.removeChild(H)}},we=()=>{if(O.value){const H=document.createElement("a");H.href=O.value,H.download="membrete-global.png",document.body.appendChild(H),H.click(),document.body.removeChild(H)}},Fe=()=>{O.value=null},Me=H=>{if(H===0)return"0 Bytes";const ne=1024,fe=["Bytes","KB","MB","GB"],se=Math.floor(Math.log(H)/Math.log(ne));return parseFloat((H/Math.pow(ne,se)).toFixed(2))+" "+fe[se]};Se(()=>l.isVisible,H=>{H&&(R(),I())});const qe=()=>{O.value&&URL.revokeObjectURL(O.value),q.value&&URL.revokeObjectURL(q.value),C.value&&URL.revokeObjectURL(C.value)};return Qe(()=>{l.isVisible&&R()}),mt(qe),(H,ne)=>Te((s(),oe(He,null,{default:M(()=>[e("div",gg,[e("div",pg,[hg,fg,e("button",{onClick:G,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[a(t(Ee),{class:"h-6 w-6"})])]),e("div",vg,[b.value?(s(),r("div",yg,[bg,e("p",xg,p(h.value),1)])):(s(),r("div",_g,[O.value?(s(),r("div",wg,[$g,e("div",kg,[e("img",{src:O.value,alt:"Membrete de imagen para PDF actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:Fe},null,40,Cg),e("div",Dg,[e("button",{onClick:we,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[a(t(st),{class:"h-4 w-4 mr-2"}),te(" Descargar ")]),e("button",{onClick:L,disabled:v.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[a(t(Nt),{class:"h-4 w-4 mr-2"}),te(" "+p(v.value?"Eliminando...":"Eliminar"),1)],8,Sg)])])])):(s(),r("div",Fg,[a(t(ot),{class:"mx-auto h-12 w-12 text-gray-400"}),Eg,Tg,Ag])),e("div",Mg,[e("h3",jg,p(O.value?"Reemplazar Membrete de imagen para PDF":"Subir Membrete de imagen para PDF"),1),e("div",Pg,[e("input",{ref_key:"fileInput",ref:Y,type:"file",accept:".png",onChange:re,class:"hidden"},null,544),F.value?(s(),r("div",Ig,[e("div",Ug,[a(t(wt),{class:"h-5 w-5 text-green-500"}),e("span",null,p(F.value.name),1),e("span",Og,"("+p(Me(F.value.size))+")",1)]),q.value?(s(),r("div",Ng,[e("img",{src:q.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,qg)])):f("",!0),e("div",Vg,[e("button",{onClick:Z,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:V,disabled:k.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[k.value?(s(),r("div",Wg)):(s(),oe(t(ts),{key:0,class:"h-4 w-4 mr-2"})),te(" "+p(k.value?"Subiendo...":"Subir Imagen para PDF"),1)],8,Qg)])])):(s(),r("div",Lg,[a(t(cs),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Bg,[e("button",{onClick:ne[0]||(ne[0]=fe=>H.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG para PDF "),e("button",{onClick:ne[1]||(ne[1]=fe=>ae.value=!ae.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[a(t(es),{class:"h-4 w-4 mr-2"}),te(" "+p(ae.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),Rg,zg]))])]),e("div",Gg,[Hg,Zg,i.value?(s(),r("div",Kg,[e("div",Yg,[Jg,e("div",Xg,[e("span",ep,p(y.value||"plantilla_word.docx"),1),X.value?(s(),r("span",tp,"("+p(Me(X.value))+")",1)):f("",!0)])]),e("div",sp,[C.value?(s(),r("button",{key:0,onClick:_e,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[a(t(st),{class:"h-4 w-4 mr-2"}),te(" Descargar ")])):f("",!0),e("button",{onClick:J,disabled:E.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[a(t(Nt),{class:"h-4 w-4 mr-2"}),te(" "+p(E.value?"Eliminando...":"Eliminar"),1)],8,op)])])):(s(),r("div",ap," No tienes una plantilla Word configurada. Puedes subir un archivo .docx con tu membrete. ")),e("div",rp,[e("input",{ref_key:"wordTemplateInput",ref:N,type:"file",accept:".docx",onChange:ve,class:"hidden"},null,544),S.value?(s(),r("div",dp,[e("div",cp,[a(t(wt),{class:"h-5 w-5 text-green-500"}),e("span",null,p(S.value.name),1),e("span",up,"("+p(Me(S.value.size))+")",1)]),e("div",mp,[e("button",{onClick:z,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:Q,disabled:P.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[P.value?(s(),r("div",pp)):(s(),oe(t(ts),{key:0,class:"h-4 w-4 mr-2"})),te(" "+p(P.value?"Subiendo...":"Subir Plantilla"),1)],8,gp)])])):(s(),r("div",np,[a(t(ot),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",lp,[e("button",{onClick:ne[2]||(ne[2]=fe=>H.$refs.wordTemplateInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Plantilla .docx (Word) ")]),ip]))])]),ae.value?(s(),r("div",hp,[e("div",fp,[a(t(es),{class:"h-6 w-6 text-blue-600"}),vp]),yp,bp,xp,_p,wp])):f("",!0),W.value.length>0?(s(),r("div",$p,[(s(!0),r(ue,null,he(W.value,(fe,se)=>(s(),r("div",{key:se,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",kp,[a(t(Bs),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",Cp,p(fe),1)])]))),128))])):f("",!0)]))])])]),_:1},512)),[[gt,o.isVisible]])}},Sp=St(Dp,[["__scopeId","data-v-857c746d"]]),Fp={class:"min-h-screen bg-gray-50"},Ep={class:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8"},Tp={class:"p-4 sm:p-6 lg:p-8"},Ap={key:0},Mp={class:"mb-6 border-b border-gray-200 pb-4"},jp={class:"hidden md:block"},Pp={class:"flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8 mb-4","aria-label":"Tabs"},Lp=["onClick"],Bp={class:"flex gap-3"},Rp=["disabled"],zp=e("span",null,"Firma Electrónica",-1),Ip=e("span",null,"Membrete Global",-1),Up=e("span",null,"Nueva Minuta",-1),Op={class:"md:hidden space-y-3 relative"},Np=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),qp=[Np],Vp={key:0,class:"absolute z-20 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden w-full"},Qp=["onClick"],Wp={class:"grid grid-cols-3 gap-2"},Gp=["disabled"],Hp=e("span",{class:"font-medium text-xs leading-tight"},"Firma",-1),Zp=e("span",{class:"font-medium text-xs leading-tight"},"Membrete",-1),Kp=e("span",{class:"font-medium text-xs leading-tight"},"Nueva",-1),Yp={key:0},Jp={key:1},Xp={key:2},eh={key:3},th={key:4},sh={key:5},oh={key:6},ah={key:7},rh={key:8,class:"mt-6 text-center text-gray-400 font-regular"},nh=e("p",null,"No hay documentos disponibles para mostrar.",-1),lh=[nh],ih={key:1},dh={class:"mb-6 border-b border-gray-200"},ch={class:"hidden md:flex items-center justify-between"},uh={class:"-mb-px flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},mh=["onClick"],gh={class:"flex items-center gap-2 mb-4"},ph={class:"relative"},hh={class:"relative group"},fh=["disabled"],vh={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},yh=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),bh={class:"md:hidden relative"},xh=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),_h=[xh],wh={key:0,class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},$h=["onClick"],kh={class:"md:hidden mt-4 mb-4 flex flex-col gap-2"},Ch={class:"relative"},Dh={class:"relative group"},Sh=["disabled"],Fh={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},Eh=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),Th={key:0},Ah={key:1},Mh={class:"p-4 sm:p-6"},jh={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},Ph={class:"flex justify-between items-center p-4 border-b"},Lh=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),Bh={class:"p-4 sm:p-6"},Rh={class:"p-4 sm:p-6"},zh={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},Ih={class:"flex justify-between items-center p-4 border-b"},Uh=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),Oh={class:"p-4 sm:p-6"},yf={__name:"Dashboard",setup(o){const _=Ze(),l=Ne(),u=Ht(),D=Je(),b=Cs(),{isBasicUser:h,handleFeatureAccess:k}=gs(),v=x(""),F=x("default"),q=x(!1),O=x("folders"),W=x("legal-documents"),Y=x(!1),ae=x(!1),K=x(!1),S=x(!1),i=x(!1),C=x(null),y=x([]),X=x("recent");Se(W,(se,d)=>{},{immediate:!0}),B(()=>[]),B(()=>X.value==="recent"?"Más recientes":"Nombre (A-Z)");const P=B(()=>_.currentUser),E=B(()=>P.value?P.value.role:(D.push("/login"),null)),N=B(()=>{let se=[];E.value==="lawyer"?se=l.draftAndPublishedDocumentsUnassigned:(E.value==="client"||E.value==="basic"||E.value==="corporate_client")&&(se=l.progressAndCompletedDocumentsByClient(P.value.id));const d=y.value&&Array.isArray(y.value)?y.value.map(c=>c.id):[];return l.filteredDocumentsBySearchAndTags(v.value,_,d).filter(c=>se.some(n=>n.id===c.id))}),G=async se=>{F.value=se,l.selectedDocument=null;try{await l.init(!0)}catch(d){console.error("Error loading documents for useDocument section:",d)}},re=()=>{q.value=!1,F.value="default",l.selectedDocument=null},le=async()=>{await l.init(!0)},Z=()=>{if(!P.value){console.error("Cannot open signature modal: currentUser is not loaded");return}ae.value=!0},V=()=>{if(!P.value){console.error("Cannot open signature modal: currentUser is not loaded");return}Y.value=!0},R=()=>{if(!P.value){console.error("Cannot open signature modal: currentUser is not loaded");return}Y.value=!0},L=async se=>{W.value="signed-documents"},de=async se=>{O.value="signed-documents"},ve=async se=>{W.value="archived-documents"},z=async se=>{O.value="archived-documents"},Q=()=>{if(!P.value){console.error("Cannot open letterhead modal: currentUser is not loaded");return}k("Membrete Global",()=>{K.value=!0})},I=se=>{Ce("Membrete global subido correctamente","success")},J=()=>{Ce("Membrete global eliminado correctamente","success")},be=async()=>{if(F.value==="useDocument"){F.value="default",O.value="my-documents";return}O.value="folders";try{await new Promise(se=>setTimeout(se,100)),await u.fetchFolders(!0)}catch{}};Se(()=>l.lastUpdatedDocumentId,(se,d)=>{if(se&&se!==d&&F.value==="default"){const c=Date.now();(!Se.lastExecutionTime||c-Se.lastExecutionTime>100)&&(Se.lastExecutionTime=c,F.value="default")}},{immediate:!1}),Se(S,se=>{}),Se(i,se=>{}),Se(C,se=>{}),Se(()=>b.path,(se,d)=>{se==="/dynamic_document_dashboard"&&d&&d.includes("/document/use/")&&l.init()}),Se(()=>b.query,se=>{se.lawyerTab&&(W.value=se.lawyerTab),se.tab&&(O.value=se.tab)},{immediate:!0});const _e=[{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"archived-documents",label:"Dcs. Archivados"}],we=[{name:"legal-documents",label:"Minutas"},{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"archived-documents",label:"Dcs. Archivados"},{name:"finished-documents",label:"Dcs. Clientes"},{name:"in-progress-documents",label:"Dcs. Clientes en Progreso"}],Fe=x(!1),Me=x(!1),qe=()=>{Fe.value=!1,Me.value=!1},H=se=>{W.value=se,Fe.value=!1,qe()},ne=se=>{F.value="default",O.value=se,Me.value=!1,qe()};Qe(async()=>{try{await Promise.all([_.init(),l.init(),u.init()])}catch(d){console.error("Error initializing dynamic document dashboard:",d)}l.selectedDocument=null,F.value="default";const se=localStorage.getItem("lastUpdatedDocumentId");se&&l.documents.some(c=>c.id.toString()===se)&&(l.lastUpdatedDocumentId=parseInt(se))});const fe=async se=>{_.currentUser&&(_.currentUser.has_signature=!0),Ce("Firma electrónica guardada correctamente","success"),setTimeout(()=>{ae.value=!1,Y.value=!1},500)};return(se,d)=>{var c,n;return s(),r(ue,null,[e("div",Fp,[e("div",Ep,[rs(se.$slots,"default")]),e("div",Tp,[E.value==="lawyer"?(s(),r("div",Ap,[e("div",Mp,[e("div",jp,[e("nav",Pp,[(s(),r(ue,null,he(we,w=>e("button",{key:w.name,onClick:pe(ce=>H(w.name),["stop"]),class:j([W.value===w.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},p(w.label),11,Lp)),64))]),e("div",Bp,[e("button",{onClick:pe(Z,["stop"]),disabled:!P.value,class:j(["inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-purple-200 text-sm font-medium transition-all duration-200",P.value?"bg-white text-gray-700 hover:bg-purple-50 hover:border-purple-300":"bg-gray-50 text-gray-400 cursor-not-allowed opacity-60"])},[a(t(bt),{class:"size-5 text-purple-500"}),zp],10,Rp),e("button",{onClick:d[0]||(d[0]=pe(w=>K.value=!0,["stop"])),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-green-200 bg-white text-sm font-medium text-gray-700 hover:bg-green-50 hover:border-green-300 transition-all duration-200"},[a(t(Ue),{class:"size-5 text-green-500"}),Ip]),e("button",{onClick:d[1]||(d[1]=pe(w=>q.value=!0,["stop"])),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-secondary bg-secondary text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200"},[a(t(Ke),{class:"size-5"}),Up])])]),e("div",Op,[e("button",{onClick:d[2]||(d[2]=pe(w=>Fe.value=!Fe.value,["stop"])),class:"dropdown-button w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,p(((c=we.find(w=>w.name===W.value))==null?void 0:c.label)||"Seleccionar sección"),1),(s(),r("svg",{class:j(["ml-2 h-5 w-5 transition-transform duration-200",Fe.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},qp,2))]),Fe.value?(s(),r("div",Vp,[(s(),r(ue,null,he(we,w=>e("button",{key:w.name,onClick:pe(ce=>H(w.name),["stop"]),class:j(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",W.value===w.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},p(w.label),11,Qp)),64))])):f("",!0),e("div",Wp,[e("button",{onClick:pe(Z,["stop"]),disabled:!P.value,class:j(["flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-purple-200 text-center transition-all duration-200",P.value?"bg-white hover:bg-purple-50":"bg-gray-50 cursor-not-allowed opacity-60"])},[a(t(bt),{class:"size-6 text-purple-500 mb-1"}),Hp],10,Gp),e("button",{onClick:d[3]||(d[3]=pe(w=>K.value=!0,["stop"])),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-green-200 bg-white text-center transition-all duration-200 hover:bg-green-50"},[a(t(Ue),{class:"size-6 text-green-500 mb-1"}),Zp]),e("button",{onClick:d[4]||(d[4]=pe(w=>q.value=!0,["stop"])),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-secondary bg-secondary text-white text-center transition-all duration-200 hover:bg-blue-700"},[a(t(Ke),{class:"size-6 mb-1"}),Kp])])])]),W.value==="legal-documents"?(s(),r("div",Yp,[a(Ut,{searchQuery:v.value,selectedTags:y.value,"is-loading":t(l).isLoading,"card-type":"lawyer","show-state-filter":!0,"show-client-filter":!0,"show-associations-column":!0,context:"legal-documents",onRefresh:le},null,8,["searchQuery","selectedTags","is-loading"])])):f("",!0),W.value==="my-documents"?(s(),r("div",Jp,[a(Ut,{searchQuery:v.value,selectedTags:y.value,"is-loading":t(l).isLoading,"card-type":"client","show-state-filter":!0,"show-client-filter":!1,"show-associations-column":!0,context:"my-documents",onRefresh:le},null,8,["searchQuery","selectedTags","is-loading"])])):f("",!0),W.value==="folders"?(s(),r("div",Xp,[a(os,{searchQuery:v.value,selectedTags:y.value,onRefresh:le,onNavigateToMain:be},null,8,["searchQuery","selectedTags"])])):f("",!0),W.value==="pending-signatures"?(s(),r("div",eh,[a(at,{state:"PendingSignatures",searchQuery:v.value,selectedTags:y.value,onRefresh:le,onOpenElectronicSignature:Z,onDocumentFullySigned:L,onDocumentRejected:ve},null,8,["searchQuery","selectedTags"])])):f("",!0),W.value==="signed-documents"?(s(),r("div",th,[a(at,{state:"FullySigned",searchQuery:v.value,selectedTags:y.value,onRefresh:le,onOpenElectronicSignature:Z},null,8,["searchQuery","selectedTags"])])):f("",!0),W.value==="archived-documents"?(s(),r("div",sh,[a(at,{state:"Archived",searchQuery:v.value,selectedTags:y.value,onRefresh:le,onOpenElectronicSignature:Z},null,8,["searchQuery","selectedTags"])])):f("",!0),W.value==="finished-documents"?(s(),r("div",oh,[a(ru,{searchQuery:v.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])])):f("",!0),W.value==="in-progress-documents"?(s(),r("div",ah,[a(vm,{searchQuery:v.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])])):f("",!0),N.value.length===0?(s(),r("div",rh,lh)):f("",!0)])):f("",!0),E.value==="client"||E.value==="basic"||E.value==="corporate_client"?(s(),r("div",ih,[e("div",dh,[e("div",ch,[e("nav",uh,[(s(),r(ue,null,he(_e,w=>e("button",{key:w.name,onClick:pe(ce=>ne(w.name),["stop"]),class:j([O.value===w.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},p(w.label),11,mh)),64))]),e("div",gh,[e("div",ph,[e("button",{onClick:pe(V,["stop"]),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border text-purple-600 hover:bg-purple-50 border-purple-200"},[a(t(bt),{class:"h-4 w-4"}),te(" Firma Electrónica ")])]),e("div",hh,[e("button",{onClick:pe(Q,["stop"]),disabled:t(h),class:j(["inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border",t(h)?"text-green-400 bg-gray-50 border-gray-200 cursor-not-allowed opacity-60":"text-green-600 hover:bg-green-50 border-green-200"])},[a(t(Ue),{class:"h-4 w-4"}),te(" Membrete Global ")],10,fh),t(h)?(s(),r("div",vh,[te(" Actualiza tu suscripción para usar esta funcionalidad "),yh])):f("",!0)]),e("button",{onClick:d[5]||(d[5]=pe(w=>G("useDocument"),["stop"])),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[a(t(Ke),{class:"h-4 w-4"}),te(" Nuevo Documento ")])])]),e("div",bh,[e("button",{onClick:d[6]||(d[6]=pe(w=>Me.value=!Me.value,["stop"])),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,p(((n=_e.find(w=>w.name===O.value))==null?void 0:n.label)||"Seleccionar sección"),1),(s(),r("svg",{class:j(["ml-2 h-5 w-5 transition-transform duration-200",Me.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_h,2))]),Me.value?(s(),r("div",wh,[(s(),r(ue,null,he(_e,w=>e("button",{key:w.name,onClick:pe(ce=>ne(w.name),["stop"]),class:j(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",O.value===w.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},p(w.label),11,$h)),64))])):f("",!0)]),e("div",kh,[e("div",Ch,[e("button",{onClick:pe(V,["stop"]),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-purple-600 bg-purple-50 hover:bg-purple-100"},[a(t(bt),{class:"h-5 w-5"}),te(" Firma Electrónica ")])]),e("div",Dh,[e("button",{onClick:pe(Q,["stop"]),disabled:t(h),class:j(["w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors",t(h)?"text-green-400 bg-gray-50 cursor-not-allowed opacity-60":"text-green-600 bg-green-50 hover:bg-green-100"])},[a(t(Ue),{class:"h-5 w-5"}),te(" Membrete Global ")],10,Sh),t(h)?(s(),r("div",Fh,[te(" Actualiza tu suscripción para usar esta funcionalidad "),Eh])):f("",!0)]),e("button",{onClick:d[7]||(d[7]=pe(w=>G("useDocument"),["stop"])),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[a(t(Ke),{class:"h-5 w-5"}),te(" Nuevo Documento ")])])]),F.value==="useDocument"?(s(),r("div",Th,[a(Gd,{searchQuery:v.value,selectedTags:y.value,onGoBack:be},null,8,["searchQuery","selectedTags"])])):(s(),r("div",Ah,[O.value==="folders"?(s(),oe(os,{key:0,searchQuery:v.value,selectedTags:y.value,onRefresh:le,onNavigateToMain:be},null,8,["searchQuery","selectedTags"])):O.value==="my-documents"?(s(),oe(Ut,{key:1,searchQuery:v.value,selectedTags:y.value,"is-loading":t(l).isLoading,"card-type":"client","show-state-filter":!0,"show-client-filter":!1,"show-associations-column":!0,context:"my-documents",onRefresh:le},null,8,["searchQuery","selectedTags","is-loading"])):O.value==="pending-signatures"?(s(),oe(at,{key:2,state:"PendingSignatures",searchQuery:v.value,selectedTags:y.value,onRefresh:le,onOpenElectronicSignature:R,onDocumentFullySigned:de,onDocumentRejected:z},null,8,["searchQuery","selectedTags"])):O.value==="signed-documents"?(s(),oe(at,{key:3,state:"FullySigned",searchQuery:v.value,selectedTags:y.value,onRefresh:le,onOpenElectronicSignature:R},null,8,["searchQuery","selectedTags"])):O.value==="archived-documents"?(s(),oe(at,{key:4,state:"Archived",searchQuery:v.value,selectedTags:y.value,onRefresh:le,onOpenElectronicSignature:R},null,8,["searchQuery","selectedTags"])):f("",!0)]))])):f("",!0)])]),q.value?(s(),oe(He,{key:0},{default:M(()=>[a(mg,{onClose:re})]),_:1})):f("",!0),ae.value&&P.value?(s(),oe(He,{key:1},{default:M(()=>[e("div",Mh,[e("div",jh,[e("div",Ph,[Lh,e("button",{onClick:d[8]||(d[8]=w=>ae.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[a(t(Ee),{class:"h-6 w-6"})])]),e("div",Bh,[a(Kt,{"user-id":P.value.id,"initial-show-options":!P.value.has_signature,onSignatureSaved:fe,onCancel:d[9]||(d[9]=w=>ae.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):f("",!0),Y.value&&P.value?(s(),oe(He,{key:2},{default:M(()=>[e("div",Rh,[e("div",zh,[e("div",Ih,[Uh,e("button",{onClick:d[10]||(d[10]=w=>Y.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[a(t(Ee),{class:"h-6 w-6"})])]),e("div",Oh,[a(Kt,{"user-id":P.value.id,"initial-show-options":!P.value.has_signature,onSignatureSaved:fe,onCancel:d[11]||(d[11]=w=>Y.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):f("",!0),a(Qt,{isVisible:t(et),documentData:t(Vt),onClose:d[12]||(d[12]=w=>et.value=!1)},null,8,["isVisible","documentData"]),a(Sp,{isVisible:K.value,onClose:d[13]||(d[13]=w=>K.value=!1),onUploaded:I,onDeleted:J},null,8,["isVisible"])],64)}}};export{yf as default};
