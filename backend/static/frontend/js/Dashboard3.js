import{e as s,f as r,g as e,u as st,r as b,aL as is,o as He,at as ft,c as B,h as n,j as t,B as je,w as De,v as Ee,n as P,l as h,t as g,m as me,p as re,s as $e,b6 as vs,i as j,ae as We,ac as ds,b7 as bs,U as yt,k as le,a5 as Je,F as pe,D as Yt,E as cs,G as xs,a3 as _s,C as ws,W as we,J as he,I as Ke,a4 as qe,ai as Be,af as Re,ag as ze,ah as ye,b8 as $s,Q as St,T as Ft,a8 as ks,aj as nt,aZ as Cs,ak as Et,an as Qt,ao as Ds,ap as Ss,H as Fs,b9 as $t,ba as Xt}from"./index.js";import{u as Qe,o as Es,s as at,p as Wt}from"./index2.js";import{g as pt,a as ht}from"./DocumentPermissionsManager.js";import{r as Ts,_ as Ht,a as Tt}from"./DocumentRelationshipsModal.js";import{_ as At}from"./_plugin-vue_export-helper.js";import{B as As,r as js,a as jt,b as Mt,_ as Gt,c as Zt,D as us,d as Ms,L as Pt,s as es}from"./index3.js";import{r as Ct}from"./FolderIcon.js";import{r as Ge}from"./PlusIcon.js";import{r as dt}from"./EllipsisVerticalIcon.js";import{r as lt}from"./DocumentIcon.js";import{_ as Ps}from"./DocumentCard.js";import{r as ms}from"./EyeIcon.js";import{r as vt}from"./ChevronRightIcon.js";import{_ as ts}from"./SignatureDocumentCard.js";import{r as qt,a as Ls,b as Bs}from"./TagIcon.js";import{r as Ve}from"./ChevronDownIcon.js";import{r as Ze}from"./MagnifyingGlassIcon.js";import{r as Dt}from"./CheckCircleIcon.js";import{r as ss}from"./PencilIcon.js";import{r as Vt}from"./TrashIcon.js";import{a as gs,r as os}from"./LinkIcon.js";import{r as ps}from"./PhotoIcon.js";import{r as rt,a as Rs}from"./FunnelIcon.js";import{r as zs}from"./ArrowLeftIcon.js";import{r as Lt}from"./CubeTransparentIcon.js";import{r as as}from"./CloudArrowUpIcon.js";import{r as Is}from"./ExclamationTriangleIcon.js";import"./useRecentViews.js";import"./loading_message.js";function rs(o,w){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})])}function Us(o,w){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})])}function Ns(o,w){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})])}function Os(o,w){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const qs={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Vs={class:"flex justify-end"},Qs=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[re(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),Ws={class:"mt-2"},Hs={class:"flex gap-2 mt-2.5"},Gs=["disabled"],Zs=e("span",null,"Actualizar nombre",-1),Js=[Zs],Ks=["disabled"],hs={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(o,{emit:w}){const i=o,c=st(),D=Qe(),p=w,f=b(""),F=b(""),v=()=>{p("close")};is(()=>{var Z,k;D.selectedDocument?(f.value=((Z=D.selectedDocument)==null?void 0:Z.title)||"",F.value=((k=D.selectedDocument)==null?void 0:k.title)||""):(f.value="",F.value="")});const C=Z=>{Z.key==="Escape"&&v()};He(()=>{document.addEventListener("keydown",C)}),ft(()=>{document.removeEventListener("keydown",C)});const X=B(()=>f.value.trim().length>0),ee=B(()=>{var Z;return!!((Z=D.selectedDocument)!=null&&Z.id)}),Y=B(()=>ee.value&&f.value.trim()!==F.value.trim()&&f.value.trim().length>0);async function O(){if(ee.value&&Y.value)try{const Z={title:f.value.trim()};await D.updateDocument(D.selectedDocument.id,Z),F.value=f.value.trim(),D.selectedDocument.title=f.value.trim();const k=D.selectedDocument.id;$e("Document name successfully updated.","success"),p("close",{updatedDocId:k});const A=window.location.pathname;A==="/dynamic_document_dashboard"||A==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(Z){console.error("Error updating document name:",Z),$e("Error updating document name.","error")}}function ne(){const Z=encodeURIComponent(f.value.trim());i.documentId&&!D.selectedDocument?c.push(`/dynamic_document_dashboard/document/use/creator/${i.documentId}/${Z}`):D.selectedDocument?(D.selectedDocument.title=f.value.trim(),c.push(`/dynamic_document_dashboard/document/use/editor/${D.selectedDocument.id}/${Z}`)):$e("Error: No se pudo continuar. Documento no seleccionado.","error")}return(Z,k)=>(s(),r("div",qs,[e("div",Vs,[e("button",{onClick:v},[n(t(je),{class:"size-6"})])]),e("form",{onSubmit:me(ne,["prevent"])},[e("div",null,[Qs,e("div",Ws,[De(e("input",{"onUpdate:modelValue":k[0]||(k[0]=d=>f.value=d),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[Ee,f.value]])])]),e("div",Hs,[ee.value?(s(),r("button",{key:0,type:"button",onClick:O,disabled:!Y.value,class:P(["p-2.5 text-sm font-medium rounded-md flex gap-2",Y.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Js,10,Gs)):h("",!0),e("button",{type:"submit",class:P(["p-2.5 text-sm font-medium rounded-md flex gap-2",X.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!X.value},[e("span",null,g(ee.value?"Editar Documento":"Continuar"),1)],10,Ks)])],32)]))}},Ys={class:"mt-3 pt-2 border-t border-gray-100"},Xs={class:"flex items-center gap-2 text-xs text-gray-500"},eo=e("span",null,"Hacer clic para usar este documento",-1),to={__name:"UseDocumentCard",props:{document:{type:Object,required:!0},showTags:{type:Boolean,default:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null},additionalClasses:{type:String,default:""}},emits:["click","remove-from-folder","document-created"],setup(o,{emit:w}){const i=o,c=w,D=b(!1),p=b(null),f=pt(9),F=B(()=>"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium !bg-purple-100 !text-purple-700 !border !border-purple-200"),v=B(()=>f.dark),C=B(()=>{const k="group !border-purple-400 !bg-purple-50/50 !shadow-purple-100";return i.additionalClasses?`${k} ${i.additionalClasses}`:k}),X=B(()=>i.menuOptions!==null?i.menuOptions:[{label:"Usar",action:"use",icon:Us,iconClasses:"w-4 h-4 text-purple-600"},{label:"Previsualización",action:"preview",icon:ms,iconClasses:"w-4 h-4 text-gray-600"}]),ee=B(()=>!1),Y=(k,d)=>{i.disableInternalActions?c("click",k,d):ne(k.id)},O=(k,d)=>{switch(k){case"use":ne(d.id);break;case"preview":Es(d);break;default:console.warn("Unknown menu action:",k)}};function ne(k){k?(p.value=k,D.value=!0):console.error("Document ID is required:",k)}function Z(k){if(D.value=!1,p.value=null,k&&k.updatedDocId){c("document-created",k);const d=window.location.pathname;d==="/dynamic_document_dashboard"||d==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(k.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}}return(k,d)=>(s(),r(pe,null,[n(As,{document:o.document,"card-type":o.cardType,"card-context":o.cardContext,"status-icon":t(bs),"status-text":"Disponible","status-badge-classes":F.value,"menu-options":X.value,"highlighted-doc-id":null,"show-tags":o.showTags,"document-store":o.documentStore,"user-store":o.userStore,"additional-classes":C.value,"disable-internal-actions":o.disableInternalActions,"show-menu-options":o.showMenuOptions,onClick:Y,onMenuAction:O,onRemoveFromFolder:d[0]||(d[0]=A=>k.$emit("remove-from-folder",A))},vs({"additional-actions":j(()=>[ds(k.$slots,"additional-actions")]),_:2},[ee.value?{name:"right-action",fn:j(()=>[n(t(vt),{class:"w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors"})]),key:"0"}:void 0,o.disableInternalActions?void 0:{name:"footer",fn:j(()=>[e("div",Ys,[e("div",Xs,[e("div",{class:"w-2 h-2 rounded-full",style:We({backgroundColor:v.value})},null,4),eo])])]),key:"1"}]),1032,["document","card-type","card-context","status-icon","status-badge-classes","menu-options","show-tags","document-store","user-store","additional-classes","disable-internal-actions","show-menu-options"]),De(n(Je,null,{default:j(()=>[p.value!==null?(s(),le(hs,{key:0,"document-id":p.value,onClose:Z},null,8,["document-id"])):h("",!0)]),_:1},512),[[yt,D.value]])],64))}},so=()=>({folders:[],currentFolder:null,isLoading:!1,error:null,lastUpdatedFolderId:null}),oo={sortedFolders:o=>[...o.folders].sort((w,i)=>new Date(i.created_at)-new Date(w.created_at)),getFolderById:o=>w=>o.folders.find(i=>i.id===w),getFoldersByColor:o=>w=>o.folders.filter(i=>i.color_id===w),getFolderWithColor:o=>w=>{const i=o.folders.find(c=>c.id===w);return i?{...i,color:pt(i.color_id)}:null},getFoldersContainingDocument:o=>w=>o.folders.filter(i=>i.document_ids&&i.document_ids.includes(w)),totalDocumentsInFolders:o=>o.folders.reduce((w,i)=>w+(i.document_ids?i.document_ids.length:0),0),hasFolders:o=>o.folders.length>0,availableColors:()=>ht()},ao={async init(o=!1){if(!(this.folders.length>0&&!o)){this.isLoading=!0,this.error=null;try{await this.fetchFolders()}catch(w){console.error("Error initializing document folder store:",w),this.error="Error al inicializar las carpetas"}finally{this.isLoading=!1}}},async fetchFolders(){try{const o=await Yt("dynamic-documents/folders/");if(o.status===200)return this.folders=o.data,o.data;throw new Error(`Error fetching folders: ${o.status}`)}catch(o){throw console.error("Error fetching folders:",o),this.error="Error al obtener las carpetas",o}},async fetchFolder(o){this.isLoading=!0,this.error=null;try{const w=await Yt(`dynamic-documents/folders/${o}/`);if(w.status===200){const i=w.data,c=this.folders.findIndex(D=>D.id===i.id);return c!==-1?this.folders[c]=i:this.folders.push(i),this.currentFolder=i,i}else throw new Error(`Error fetching folder: ${w.status}`)}catch(w){throw console.error("Error fetching folder:",w),this.error="Error al obtener la carpeta",w}finally{this.isLoading=!1}},async createFolder(o){this.isLoading=!0,this.error=null;try{if(!o.name||o.name.trim()==="")throw new Error("El nombre de la carpeta es requerido");const w=o.color_id??0;if(w<0||w>=ht().length)throw new Error("Color de carpeta no válido");const i={name:o.name.trim(),color_id:w,...o.document_ids&&{document_ids:o.document_ids}},c=await cs("dynamic-documents/folders/create/",i);if(c.status===200||c.status===201){const D=c.data;return this.folders.push(D),this.lastUpdatedFolderId=D.id,$e("Carpeta creada exitosamente","success"),D}else throw new Error(`Error creating folder: ${c.status}`)}catch(w){throw console.error("Error creating folder:",w),this.error=w.message||"Error al crear la carpeta",$e(this.error,"error"),w}finally{this.isLoading=!1}},async updateFolder(o,w){this.isLoading=!0,this.error=null;try{if(w.name&&w.name.trim()==="")throw new Error("El nombre de la carpeta no puede estar vacío");if(w.color_id!==void 0){const D=w.color_id;if(D<0||D>=ht().length)throw new Error("Color de carpeta no válido")}const i={};w.name&&(i.name=w.name.trim()),w.color_id!==void 0&&(i.color_id=w.color_id),w.document_ids!==void 0&&(i.document_ids=w.document_ids);const c=await xs(`dynamic-documents/folders/${o}/update/`,i);if(c.status===200){const D=c.data,p=this.folders.findIndex(f=>f.id===o);return p!==-1&&(this.folders[p]=D),this.currentFolder&&this.currentFolder.id===o&&(this.currentFolder=D),this.lastUpdatedFolderId=o,$e("Carpeta actualizada exitosamente","success"),D}else throw new Error(`Error updating folder: ${c.status}`)}catch(i){throw console.error("Error updating folder:",i),this.error=i.message||"Error al actualizar la carpeta",$e(this.error,"error"),i}finally{this.isLoading=!1}},async deleteFolder(o){this.isLoading=!0,this.error=null;try{const w=await _s(`dynamic-documents/folders/${o}/delete/`);if(w.status===204||w.status===200)return this.folders=this.folders.filter(i=>i.id!==o),this.currentFolder&&this.currentFolder.id===o&&(this.currentFolder=null),await $e("Carpeta eliminada exitosamente","success"),!0;throw new Error(`Error deleting folder: ${w.status}`)}catch(w){throw console.error("Error deleting folder:",w),this.error=w.message||"Error al eliminar la carpeta",await $e(this.error,"error"),w}finally{this.isLoading=!1}},setCurrentFolder(o){this.currentFolder=o},clearCurrentFolder(){this.currentFolder=null},reset(){this.folders=[],this.currentFolder=null,this.isLoading=!1,this.error=null,this.lastUpdatedFolderId=null}},ro={async addDocumentsToFolder(o,w){const i=this.getFolderById(o);if(!i)throw new Error("Carpeta no encontrada");const c=i.document_ids||[],D=[...new Set([...c,...w])];return await this.updateFolder(o,{document_ids:D})},async removeDocumentsFromFolder(o,w){const i=this.getFolderById(o);if(!i)throw new Error("Carpeta no encontrada");const D=(i.document_ids||[]).filter(p=>!w.includes(p));return await this.updateFolder(o,{document_ids:D})},async moveDocumentsBetweenFolders(o,w,i){try{w&&await this.removeDocumentsFromFolder(w,o),i&&await this.addDocumentsToFolder(i,o),await $e("Documentos movidos exitosamente","success")}catch(c){throw console.error("Error moving documents between folders:",c),await $e("Error al mover documentos","error"),c}},getFolderColor(o){const w=this.getFolderById(o);return w?pt(w.color_id):pt(0)},validateFolderData(o){const w=[];if((!o.name||o.name.trim()==="")&&w.push("El nombre de la carpeta es requerido"),o.name&&o.name.length>100&&w.push("El nombre de la carpeta no puede exceder 100 caracteres"),o.color_id!==void 0){const i=o.color_id;(i<0||i>=ht().length)&&w.push("Color de carpeta no válido")}return o.document_ids&&!Array.isArray(o.document_ids)&&w.push("Los IDs de documentos deben ser un array"),{isValid:w.length===0,errors:w}}},Jt=ws("documentFolder",{state:so,getters:oo,actions:{...ao,...ro}}),no={class:"bg-white rounded-xl shadow-xl max-w-md w-full"},lo={class:"flex justify-between items-center p-6 border-b"},io={class:"text-lg font-semibold text-gray-900"},co={class:"mb-4"},uo=e("label",{for:"folderName",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la carpeta ",-1),mo={class:"mb-6"},go=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Color de la carpeta ",-1),po={class:"grid grid-cols-8 gap-2"},ho=["onClick","title"],fo={class:"flex gap-3"},yo=["disabled"],vo={__name:"CreateEditFolderModal",props:{isVisible:{type:Boolean,required:!0},editingFolder:{type:Object,default:null}},emits:["close","success"],setup(o,{emit:w}){const i=o,c=w,D=Jt(),p=b(!1),f=b({name:"",color_id:0}),F=B(()=>ht()),v=()=>{f.value={name:"",color_id:0}};we(()=>i.editingFolder,ee=>{ee?f.value={name:ee.name,color_id:ee.color_id}:v()},{immediate:!0}),we(()=>i.isVisible,ee=>{ee||v()});const C=()=>{c("close")},X=async()=>{if(f.value.name.trim()){p.value=!0;try{i.editingFolder?await D.updateFolder(i.editingFolder.id,f.value):await D.createFolder(f.value),p.value=!1,c("success")}catch{p.value=!1}}};return(ee,Y)=>o.isVisible?(s(),le(Je,{key:0},{default:j(()=>[e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:me(C,["self"])},[e("div",no,[e("div",lo,[e("h3",io,g(o.editingFolder?"Editar Carpeta":"Nueva Carpeta"),1),e("button",{onClick:C,class:"text-gray-400 hover:text-gray-500"},[n(t(je),{class:"w-6 h-6"})])]),e("form",{onSubmit:me(X,["prevent"]),class:"p-6"},[e("div",co,[uo,De(e("input",{id:"folderName","onUpdate:modelValue":Y[0]||(Y[0]=O=>f.value.name=O),type:"text",required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ej: Contratos Laborales"},null,512),[[Ee,f.value.name]])]),e("div",mo,[go,e("div",po,[(s(!0),r(pe,null,he(F.value,O=>(s(),r("button",{key:O.id,type:"button",onClick:ne=>f.value.color_id=O.id,class:P(["w-8 h-8 rounded-full border-2 transition-all",f.value.color_id===O.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"]),style:We({backgroundColor:O.hex}),title:O.name},null,14,ho))),128))])]),e("div",fo,[e("button",{type:"button",onClick:C,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:!f.value.name.trim()||p.value,class:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},g(p.value?"Guardando...":o.editingFolder?"Actualizar":"Crear"),9,yo)])],32)])])]),_:1})):h("",!0)}},bo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},xo={class:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col"},_o={class:"border-b px-6 py-4 flex-shrink-0"},wo={class:"flex justify-between items-center"},$o={class:"flex items-center gap-3"},ko={class:"text-xl font-semibold text-gray-900"},Co={class:"text-sm text-gray-600"},Do={class:"flex items-center gap-2"},So={class:"flex-1 overflow-y-auto p-6"},Fo={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},Eo={class:"min-w-full divide-y divide-gray-200"},To=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tipo "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),Ao={class:"bg-white divide-y divide-gray-200"},jo=["onClick"],Mo={class:"px-6 py-4 whitespace-nowrap"},Po={class:"flex items-center"},Lo={class:"flex-shrink-0 h-10 w-10"},Bo={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Ro={class:"ml-4"},zo={class:"text-sm font-medium text-gray-900"},Io={class:"px-6 py-4 whitespace-nowrap"},Uo={class:"text-sm text-gray-600"},No={class:"px-6 py-4 whitespace-nowrap"},Oo={class:"px-6 py-4 whitespace-nowrap"},qo={class:"flex flex-wrap gap-1"},Vo={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},Qo={key:1,class:"text-sm text-gray-400"},Wo={class:"py-1"},Ho=["onClick"],Go=["onClick"],Zo={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Jo=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"Esta carpeta está vacía",-1),Ko=e("p",{class:"text-gray-600 mb-4"},"Agrega documentos para organizar tu trabajo",-1),Yo={__name:"FolderDetailsModalTable",props:{folder:{type:Object,default:null}},emits:["close","add-documents","remove-document","view-document","use-document","document-action"],setup(o,{emit:w}){const i=o,c=w;Ke(),Qe();const D=b({}),p=b({}),f=b(!1),F=b(-1),v=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],C=B(()=>{if(!i.folder)return v[0];if(i.folder.color)return v.find(U=>U.name===i.folder.color)||v[0];const E=i.folder.id%v.length;return v[E]}),X=E=>E.state==="Published"||E.state==="Draft"?"Formato":E.state==="PendingSignatures"||E.state==="FullySigned"?"Para Firmar":E.state==="Progress"||E.state==="Completed"?"Mis Documentos":"Documento",ee=E=>({Published:"Publicado",Draft:"Borrador",Progress:"En Progreso",Completed:"Completado",PendingSignatures:"Pendiente Firma",FullySigned:"Firmado"})[E.state]||E.state,Y=E=>({Published:"bg-green-100 text-green-700 border border-green-200",Draft:"bg-gray-100 text-gray-700 border border-gray-200",Progress:"bg-blue-100 text-blue-700 border border-blue-200",Completed:"bg-green-100 text-green-700 border border-green-200",PendingSignatures:"bg-yellow-100 text-yellow-700 border border-yellow-200",FullySigned:"bg-green-100 text-green-700 border border-green-200"})[E.state]||"bg-gray-100 text-gray-700 border border-gray-200",O=E=>{const U=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],H=E.id%U.length;return U[H]},ne=()=>{c("close")},Z=()=>{c("add-documents",i.folder)},k=E=>{c("remove-document",{folderId:i.folder.id,documentId:E.id})},d=E=>{const U=X(E);c(U==="Formato"?"use-document":"view-document",E)},A=()=>!f.value||!i.folder?"auto":i.folder.documents.length===1?"280px":i.folder.documents.length===2&&F.value===1?"340px":"280px",z=(E,U)=>{E&&(D.value[U]=E)},I=(E,U)=>{E&&(p.value[U]=E)},$=(E,U)=>{f.value=!U,F.value=U?-1:E,U||setTimeout(()=>{const H=p.value[E];if(H){const de=H.$el||H;if(de&&de.getBoundingClientRect){const J=de.getBoundingClientRect(),q=window.innerHeight;if(E===0){if(J.bottom>q-20){const K=J.bottom-q+40;window.scrollBy({top:K,behavior:"smooth"})}}else if(J.bottom>q-10){const K=J.bottom-q+30;window.scrollBy({top:K,behavior:"smooth"})}else if(J.top<80){const K=J.top-100;window.scrollBy({top:K,behavior:"smooth"})}}}},100)};return(E,U)=>o.folder?(s(),le(Je,{key:0},{default:j(()=>[e("div",bo,[e("div",xo,[e("div",_o,[e("div",wo,[e("div",$o,[e("div",{class:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:We({backgroundColor:C.value.hex+"20"})},[n(t(Ct),{class:"h-6 w-6",style:We({color:C.value.hex})},null,8,["style"])],4),e("div",null,[e("h3",ko,g(o.folder.name),1),e("p",Co,g(o.folder.documents.length)+" documento"+g(o.folder.documents.length!==1?"s":""),1)])]),e("div",Do,[e("button",{onClick:Z,class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"},[n(t(Ge),{class:"w-5 h-5"}),re(" Agregar documentos ")]),e("button",{onClick:ne,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[n(t(je),{class:"w-6 h-6"})])])])]),e("div",So,[o.folder.documents.length>0?(s(),r("div",Fo,[e("div",{class:"overflow-x-auto",style:We({minHeight:A()})},[e("table",Eo,[To,e("tbody",Ao,[(s(!0),r(pe,null,he(o.folder.documents,(H,de)=>{var J;return s(),r("tr",{key:H.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:q=>d(H)},[e("td",Mo,[e("div",Po,[e("div",Lo,[e("div",Bo,[n(t(qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",Ro,[e("div",zo,g(H.title),1)])])]),e("td",Io,[e("span",Uo,g(X(H)),1)]),e("td",No,[e("span",{class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",Y(H)])},g(ee(H)),3)]),e("td",Oo,[e("div",qo,[(s(!0),r(pe,null,he((J=H.tags)==null?void 0:J.slice(0,2),q=>(s(),r("span",{key:q.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",O(q)])},g(q.name),3))),128)),H.tags&&H.tags.length>2?(s(),r("span",Vo," +"+g(H.tags.length-2),1)):h("",!0),!H.tags||H.tags.length===0?(s(),r("span",Qo,"-")):h("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:U[0]||(U[0]=me(()=>{},["stop"]))},[n(t(Be),{as:"div",class:"relative inline-block text-left"},{default:j(({open:q})=>[n(t(Re),{ref_for:!0,ref:K=>z(K,de),onClick:K=>$(de,q),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:j(()=>[n(t(dt),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),n(t(ze),{ref_for:!0,ref:K=>I(K,de),class:P([o.folder.documents.length>2&&de>0&&de>=o.folder.documents.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:j(()=>[e("div",Wo,[n(t(ye),null,{default:j(({active:K})=>[e("a",{onClick:L=>d(H),class:P([K?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver documento ",10,Ho)]),_:2},1024),n(t(ye),null,{default:j(({active:K})=>[e("a",{onClick:L=>k(H),class:P([K?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Quitar de carpeta ",10,Go)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,jo)}),128))])])],4)])):(s(),r("div",Zo,[n(t(lt),{class:"w-12 h-12 text-gray-300 mx-auto mb-4"}),Jo,Ko,e("button",{onClick:Z,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},[n(t(Ge),{class:"w-5 h-5"}),re(" Agregar documentos ")])]))])])])]),_:1})):h("",!0)}},bt=o=>(St("data-v-d403a707"),o=o(),Ft(),o),Xo={class:"tag-filter-container"},ea={class:"relative"},ta={class:"flex items-center"},sa={key:0,class:"ml-2 inline-flex items-center justify-center h-5 w-5 bg-primary text-white text-xs rounded-full font-medium"},oa={key:0,class:"absolute left-0 mt-2 w-full sm:w-80 bg-white rounded-xl shadow-xl ring-1 ring-black ring-opacity-5 border border-gray-100 z-50 overflow-hidden"},aa={class:"bg-gray-50 p-4 border-b border-gray-200"},ra={class:"flex items-center justify-between mb-3"},na=bt(()=>e("h3",{class:"text-sm font-semibold text-gray-900"},"Filtrar por etiquetas",-1)),la={key:0,class:"text-xs text-gray-500"},ia={class:"relative"},da={key:0,class:"px-4 py-2 bg-blue-50 border-b border-blue-100"},ca={class:"flex items-center justify-between"},ua={class:"text-xs font-medium text-blue-700"},ma={class:"max-h-52 overflow-y-auto"},ga={key:0,class:"px-4 py-8 text-center"},pa=bt(()=>e("p",{class:"text-gray-500 text-sm"},"No hay etiquetas disponibles",-1)),ha={key:1,class:"px-4 py-8 text-center"},fa={class:"text-gray-500 text-sm"},ya={key:2,class:"px-4 py-8 text-center"},va=bt(()=>e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"}),e("span",{class:"ml-3 text-sm text-gray-600"},"Cargando etiquetas...")],-1)),ba=[va],xa={key:3,class:"py-2"},_a=["onClick"],wa={class:"flex items-center h-5"},$a={class:"relative"},ka=["id","checked","onChange"],Ca={key:0,class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},Da=bt(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),Sa=[Da],Fa={class:"ml-3 flex items-center flex-1 min-w-0"},Ea={class:"text-sm font-medium text-gray-900 truncate"},Ta={key:0,class:"mt-4"},Aa={class:"flex items-start gap-2"},ja=bt(()=>e("span",{class:"text-xs font-medium text-gray-500 mt-1.5 flex-shrink-0"},"Activos:",-1)),Ma={class:"flex flex-wrap gap-2"},Pa=["onClick"],La={class:"mr-1"},Ba={class:"ml-1 p-0.5 rounded-full hover:bg-white/50 transition-colors duration-150"},Ra={__name:"TagFilter",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(o,{emit:w}){const i=o,c=w,D=Qe(),p=b(!1),f=b([]),F=b(!1),v=b(""),C=B(()=>D.sortedTags),X=B(()=>{if(!v.value.trim())return C.value;const d=v.value.toLowerCase().trim();return C.value.filter(A=>A.name.toLowerCase().includes(d))}),ee=d=>{const A=pt(d.color_id);return{hex:A&&A.hex?A.hex:"#9CA3AF",dark:A&&A.dark?A.dark:"#374151"}},Y=()=>{p.value=!p.value,p.value&&(v.value="")},O=d=>f.value.some(A=>A.id===d.id),ne=d=>{const A=f.value.findIndex(z=>z.id===d.id);A>=0?f.value.splice(A,1):f.value.push(d),c("update:modelValue",f.value)},Z=()=>{f.value=[],c("update:modelValue",[])},k=d=>{d.target.closest(".tag-filter-container")||(p.value=!1,v.value="")};return He(async()=>{try{F.value=!0,await D.initTags()}catch(d){console.error("Error loading tags:",d)}finally{F.value=!1}document.addEventListener("click",k)}),we(()=>i.modelValue,d=>{f.value=d||[]},{immediate:!0}),ft(()=>{document.removeEventListener("click",k)}),(d,A)=>(s(),r("div",Xo,[e("div",ea,[e("button",{onClick:Y,class:P(["group inline-flex items-center justify-between w-full sm:w-auto sm:min-w-[200px] px-4 py-3 border border-gray-200 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-primary transition-all duration-200",{"ring-2 ring-primary border-primary bg-blue-50":p.value,"border-primary bg-primary/5":f.value.length>0&&!p.value}])},[e("div",ta,[n(t(qt),{class:P(["h-5 w-5 mr-2.5 text-gray-500 group-hover:text-gray-600",{"text-primary":f.value.length>0||p.value}])},null,8,["class"]),e("span",{class:P(["text-gray-700",{"text-primary font-semibold":f.value.length>0||p.value}])}," Filtrar por etiquetas ",2),f.value.length>0?(s(),r("span",sa,g(f.value.length),1)):h("",!0)]),n(t(Ve),{class:P(["ml-3 h-4 w-4 text-gray-400 transition-all duration-200 group-hover:text-gray-600",{"rotate-180 text-primary":p.value,"text-primary":f.value.length>0&&!p.value}])},null,8,["class"])],2),n($s,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:j(()=>[p.value?(s(),r("div",oa,[e("div",aa,[e("div",ra,[na,C.value.length>0?(s(),r("span",la,g(C.value.length)+" disponibles ",1)):h("",!0)]),e("div",ia,[n(t(Ze),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),De(e("input",{"onUpdate:modelValue":A[0]||(A[0]=z=>v.value=z),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"},null,512),[[Ee,v.value]])])]),f.value.length>0?(s(),r("div",da,[e("div",ca,[e("span",ua,g(f.value.length)+" etiqueta"+g(f.value.length!==1?"s":"")+" seleccionada"+g(f.value.length!==1?"s":""),1),e("button",{onClick:Z,class:"text-xs text-red-600 hover:text-red-700 font-medium px-2 py-1 rounded-md hover:bg-red-50 transition-all duration-200"}," Limpiar todo ")])])):h("",!0),e("div",ma,[!F.value&&X.value.length===0&&v.value.trim()===""?(s(),r("div",ga,[n(t(qt),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),pa])):h("",!0),!F.value&&X.value.length===0&&v.value.trim()!==""?(s(),r("div",ha,[n(t(Ze),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e("p",fa,'Sin resultados para "'+g(v.value)+'"',1),e("button",{onClick:A[1]||(A[1]=z=>v.value=""),class:"text-xs text-primary hover:text-primary-dark mt-2 font-medium"}," Ver todas las etiquetas ")])):h("",!0),F.value?(s(),r("div",ya,ba)):h("",!0),!F.value&&X.value.length>0?(s(),r("div",xa,[(s(!0),r(pe,null,he(X.value,z=>(s(),r("div",{key:z.id,class:"group flex items-center px-4 py-2.5 hover:bg-gray-50 cursor-pointer transition-colors duration-150",onClick:I=>ne(z)},[e("div",wa,[e("div",$a,[e("input",{id:`tag-${z.id}`,type:"checkbox",checked:O(z),onChange:I=>ne(z),class:"sr-only"},null,40,ka),e("div",{class:P(["w-4 h-4 border-2 rounded transition-all duration-200 flex items-center justify-center",O(z)?"bg-primary border-primary":"border-gray-300 group-hover:border-gray-400"])},[O(z)?(s(),r("svg",Ca,Sa)):h("",!0)],2)])]),e("div",Fa,[e("div",{class:"w-3 h-3 rounded-full mr-2.5 border flex-shrink-0 shadow-sm",style:We({backgroundColor:ee(z).hex})},null,4),e("span",Ea,g(z.name),1)])],8,_a))),128))])):h("",!0)])])):h("",!0)]),_:1})]),f.value.length>0?(s(),r("div",Ta,[e("div",Aa,[ja,e("div",Ma,[(s(!0),r(pe,null,he(f.value,z=>(s(),r("div",{key:z.id,class:"group inline-flex items-center pl-2.5 pr-1.5 py-1.5 rounded-lg text-xs font-medium border shadow-sm cursor-pointer transition-all duration-200 hover:shadow-md",style:We({backgroundColor:ee(z).hex+"20",borderColor:ee(z).hex+"40",color:ee(z).dark}),onClick:I=>ne(z)},[e("div",{class:"w-2 h-2 rounded-full mr-2 flex-shrink-0",style:We({backgroundColor:ee(z).hex})},null,4),e("span",La,g(z.name),1),e("div",Ba,[n(t(je),{class:"h-3 w-3 opacity-60 group-hover:opacity-100"})])],12,Pa))),128))])])])):h("",!0)]))}},za=At(Ra,[["__scopeId","data-v-d403a707"]]),Ia={class:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden"},Ua={class:"border-b"},Na={class:"hidden sm:flex justify-between items-center p-6"},Oa=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),qa={class:"text-sm text-gray-600"},Va={class:"sm:hidden p-4"},Qa={class:"flex justify-between items-start mb-2"},Wa={class:"flex-1 min-w-0 mr-3"},Ha=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Ga={class:"text-sm text-gray-600 truncate"},Za={class:"border-b"},Ja={class:"hidden sm:flex space-x-8 px-6","aria-label":"Tabs"},Ka=["onClick"],Ya={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},Xa={class:"sm:hidden relative px-4 py-3"},er={class:"flex items-center"},tr={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},sr=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),or=[sr],ar={class:"absolute top-full left-4 right-4 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},rr=["onClick"],nr={class:"border-b bg-gray-50 p-4 sm:p-6"},lr={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},ir={class:"flex-1"},dr={key:0,class:"flex items-center gap-3"},cr={class:"text-sm text-gray-600"},ur={class:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-350px)]"},mr={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},gr=["onClick"],pr=e("span",null,"Etiquetas",-1),hr=[pr],fr={key:5,class:"absolute top-2 left-2 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center shadow-sm"},yr={key:0,class:"text-center py-8 sm:py-12"},vr={class:"text-lg font-medium text-gray-900 mb-2"},br={class:"text-gray-600 text-sm sm:text-base"},xr={class:"border-t bg-gray-50"},_r={class:"hidden sm:flex justify-between items-center p-6"},wr={class:"text-sm text-gray-600"},$r={class:"flex gap-3"},kr=["disabled"],Cr={class:"sm:hidden p-4 space-y-3"},Dr={class:"text-center text-sm text-gray-600"},Sr={class:"flex gap-3"},Fr=["disabled"],Er={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 p-4"},Tr={class:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] flex flex-col"},Ar={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},jr={class:"flex items-center gap-2"},Mr=e("h2",{class:"text-sm font-semibold text-gray-900"},"Etiquetas del documento",-1),Pr={class:"px-4 py-3 border-b border-gray-100 text-xs text-gray-500"},Lr=e("span",{class:"font-medium text-gray-700"},"Documento:",-1),Br={class:"ml-1"},Rr={class:"px-4 py-3 overflow-y-auto"},zr={key:0,class:"text-sm text-gray-500"},Ir={key:1,class:"space-y-2 text-sm"},Ur={class:"flex items-center gap-2 min-w-0"},Nr={key:0,class:"text-xs text-gray-500 truncate max-w-[8rem]"},Or={__name:"AddDocumentsModal",props:{isVisible:{type:Boolean,required:!0},folder:{type:Object,default:null}},emits:["close","add-documents"],setup(o,{emit:w}){const i=o,c=w,D=Qe(),p=Ke(),f=b([]),F=b([]),v=b("my-documents"),C=b(!1),X=b(!1),ee=b(!1),Y=b(null),O=[{name:"my-documents",label:"Mis Documentos"},{name:"use-documents",label:"Minutas"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Documentos Firmados"}],ne=B(()=>p.currentUser);we(()=>i.isVisible,q=>{q&&(f.value=[],F.value=[],v.value="my-documents")}),we(v,()=>{f.value=[]}),we(F,()=>{f.value=[]},{deep:!0});const Z=B(()=>{const q=d(v.value);return q.length===0?!1:q.every(K=>f.value.includes(K.id))}),k=q=>{var R;if(!i.folder)return[];const K=i.folder.documents.map(te=>te.id);let L=[];switch(q){case"my-documents":L=D.progressAndCompletedDocumentsByClient((R=ne.value)==null?void 0:R.id);break;case"use-documents":L=D.publishedDocumentsUnassigned;break;case"pending-signatures":L=D.documents.filter(te=>{var ve,N;return te.state==="PendingSignatures"&&(te.assigned_to===((ve=ne.value)==null?void 0:ve.id)||((N=te.signatures)==null?void 0:N.some(W=>{var V;return W.signer_email===((V=ne.value)==null?void 0:V.email)})))});break;case"signed-documents":L=D.documents.filter(te=>{var ve,N;return te.state==="FullySigned"&&(te.assigned_to===((ve=ne.value)==null?void 0:ve.id)||((N=te.signatures)==null?void 0:N.some(W=>{var V;return W.signer_email===((V=ne.value)==null?void 0:V.email)})))});break;default:L=[]}return L.filter(te=>!K.includes(te.id))},d=q=>{const K=k(q);if(!F.value||F.value.length===0)return K;const L=F.value.map(R=>R.id);return K.filter(R=>!R.tags||R.tags.length===0?!1:R.tags.some(te=>L.includes(te.id)))},A=q=>{const K=f.value.indexOf(q);K>-1?f.value.splice(K,1):f.value.push(q)},z=()=>{const K=d(v.value).map(L=>L.id);if(Z.value)f.value=f.value.filter(L=>!K.includes(L));else{const L=K.filter(R=>!f.value.includes(R));f.value.push(...L)}},I=()=>{c("close")},$=async()=>{if(f.value.length!==0){C.value=!0;try{await c("add-documents",f.value)}finally{C.value=!1}}},E=q=>{v.value=q,X.value=!1},U=q=>{q.target.closest(".relative")||(X.value=!1)};He(()=>{document.addEventListener("click",U)}),ft(()=>{document.removeEventListener("click",U)});const H=q=>{const K=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],L=q.id%K.length;return K[L]},de=q=>{Y.value=q,ee.value=!0},J=()=>{ee.value=!1,Y.value=null};return(q,K)=>o.isVisible&&o.folder?(s(),le(Je,{key:0},{default:j(()=>{var L;return[e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:me(I,["self"])},[e("div",Ia,[e("div",Ua,[e("div",Na,[e("div",null,[Oa,e("p",qa,'Selecciona documentos para agregar a "'+g(o.folder.name)+'"',1)]),e("button",{onClick:I,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors"},[n(t(je),{class:"w-5 h-5"})])]),e("div",Va,[e("div",Qa,[e("div",Wa,[Ha,e("p",Ga,'Para "'+g(o.folder.name)+'"',1)]),e("button",{onClick:I,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors flex-shrink-0"},[n(t(je),{class:"w-5 h-5"})])])])]),e("div",Za,[e("nav",Ja,[(s(),r(pe,null,he(O,R=>e("button",{key:R.name,onClick:te=>v.value=R.name,class:P([v.value===R.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[re(g(R.label)+" ",1),e("span",Ya,g(d(R.name).length),1)],10,Ka)),64))]),e("div",Xa,[e("button",{onClick:K[0]||(K[0]=R=>X.value=!X.value),class:"w-full flex items-center justify-between py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("div",er,[e("span",null,g(((L=O.find(R=>R.name===v.value))==null?void 0:L.label)||"Seleccionar categoría"),1),e("span",tr,g(d(v.value).length),1)]),(s(),r("svg",{class:P(["ml-2 h-5 w-5 transition-transform duration-200",X.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},or,2))]),De(e("div",ar,[(s(),r(pe,null,he(O,R=>e("button",{key:R.name,onClick:te=>E(R.name),class:P(["w-full text-left px-4 py-3 text-sm transition-colors duration-150 flex items-center justify-between",v.value===R.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},[e("span",null,g(R.label),1),e("span",{class:P(["py-0.5 px-2 rounded-full text-xs",v.value===R.name?"bg-white/20 text-white":"bg-gray-100 text-gray-600"])},g(d(R.name).length),3)],10,rr)),64))],512),[[yt,X.value]])])]),e("div",nr,[e("div",lr,[e("div",ir,[n(za,{modelValue:F.value,"onUpdate:modelValue":K[1]||(K[1]=R=>F.value=R),class:"max-w-md"},null,8,["modelValue"])]),d(v.value).length>0?(s(),r("div",dr,[e("span",cr,g(d(v.value).length)+" documento(s) disponible(s) ",1),e("button",{onClick:z,class:P(["px-4 py-2 rounded-lg border font-medium text-sm transition-colors",Z.value?"bg-red-50 border-red-200 text-red-700 hover:bg-red-100":"bg-primary text-white border-primary hover:bg-primary-dark"])},g(Z.value?"Deseleccionar todos":"Seleccionar todos"),3)])):h("",!0)])]),e("div",ur,[e("div",mr,[(s(!0),r(pe,null,he(d(v.value),R=>(s(),r("div",{key:R.id,class:"relative"},[v.value==="my-documents"?(s(),le(t(Ps),{key:0,document:R,"highlighted-doc-id":null,"show-tags":!1,"show-client-name":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":f.value.includes(R.id)?"ring-2 ring-primary bg-primary-50":"",onClick:te=>A(R.id)},null,8,["document","additional-classes","onClick"])):h("",!0),v.value==="use-documents"?(s(),le(t(to),{key:1,document:R,"show-tags":!1,"menu-options":[],"show-menu-options":!1,"disable-internal-actions":!0,"additional-classes":f.value.includes(R.id)?"ring-2 ring-primary bg-primary-50":"",onClick:te=>A(R.id)},null,8,["document","additional-classes","onClick"])):h("",!0),v.value==="pending-signatures"?(s(),le(t(ts),{key:2,document:R,"highlighted-doc-id":null,"show-tags":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":f.value.includes(R.id)?"ring-2 ring-primary bg-primary-50":"",onClick:te=>A(R.id)},null,8,["document","additional-classes","onClick"])):h("",!0),v.value==="signed-documents"?(s(),le(t(ts),{key:3,document:R,"highlighted-doc-id":null,"show-tags":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":f.value.includes(R.id)?"ring-2 ring-primary bg-primary-50":"",onClick:te=>A(R.id)},null,8,["document","additional-classes","onClick"])):h("",!0),R.tags&&R.tags.length>0?(s(),r("button",{key:4,type:"button",class:"absolute bottom-2 right-2 px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 inline-flex items-center gap-1",onClick:me(te=>de(R),["stop"])},hr,8,gr)):h("",!0),f.value.includes(R.id)?(s(),r("div",fr,[n(t(Ls),{class:"w-4 h-4"})])):h("",!0)]))),128))]),d(v.value).length===0?(s(),r("div",yr,[n(t(lt),{class:"w-12 h-12 sm:w-16 sm:h-16 text-gray-300 mx-auto mb-4"}),e("h4",vr,g(F.value.length>0?"No hay documentos que coincidan con el filtro":"No hay documentos disponibles"),1),e("p",br,g(F.value.length>0?"Intenta ajustar los filtros de etiquetas o selecciona otra categoría":"No tienes documentos de esta categoría que no estén ya en la carpeta"),1)])):h("",!0)]),e("div",xr,[e("div",_r,[e("div",wr,g(f.value.length)+" documento(s) seleccionado(s) ",1),e("div",$r,[e("button",{onClick:I,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{onClick:$,disabled:f.value.length===0||C.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},g(C.value?"Agregando...":`Agregar ${f.value.length} documento(s)`),9,kr)])]),e("div",Cr,[e("div",Dr,g(f.value.length)+" documento(s) seleccionado(s) ",1),e("div",Sr,[e("button",{onClick:I,class:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center font-medium"}," Cancelar "),e("button",{onClick:$,disabled:f.value.length===0||C.value,class:"flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-center font-medium"},g(C.value?"Agregando...":"Agregar"),9,Fr)])])]),ee.value&&Y.value?(s(),r("div",Er,[e("div",Tr,[e("div",Ar,[e("div",jr,[n(t(lt),{class:"h-5 w-5 text-gray-500"}),Mr]),e("button",{type:"button",class:"text-gray-400 hover:text-gray-600 p-1 rounded-md hover:bg-gray-100",onClick:J},[n(t(je),{class:"h-5 w-5"})])]),e("div",Pr,[Lr,e("span",Br,g(Y.value.title||"Sin título"),1)]),e("div",Rr,[!Y.value.tags||Y.value.tags.length===0?(s(),r("div",zr," Este documento no tiene etiquetas. ")):(s(),r("ul",Ir,[(s(!0),r(pe,null,he(Y.value.tags,R=>(s(),r("li",{key:R.id,class:"flex items-center justify-between gap-2"},[e("div",Ur,[e("span",{class:P(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",H(R)])},g(R.name),3)]),R.description?(s(),r("span",Nr,g(R.description),1)):h("",!0)]))),128))]))]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end"},[e("button",{type:"button",class:"px-4 py-2 text-sm font-medium rounded-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-50",onClick:J}," Cerrar ")])])])):h("",!0)])])]}),_:1})):h("",!0)}},ct=o=>(St("data-v-d9a5a89f"),o=o(),Ft(),o),qr={class:"folders-table"},Vr={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200",style:{"overflow-x":"visible","overflow-y":"hidden"}},Qr={class:"min-w-full divide-y divide-gray-200"},Wr=ct(()=>e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Carpeta "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documentos "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Creada "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1)),Hr={class:"bg-white divide-y divide-gray-200"},Gr=["onClick"],Zr={class:"px-6 py-4 whitespace-nowrap"},Jr={class:"flex items-center"},Kr={class:"flex-shrink-0 h-10 w-10"},Yr={class:"ml-4"},Xr={class:"text-sm font-medium text-gray-900"},en={class:"px-6 py-4 whitespace-nowrap"},tn={class:"flex items-center gap-2"},sn={class:"text-sm text-gray-900"},on={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},an={class:"py-1"},rn=["onClick"],nn=["onClick"],ln=["onClick"],dn=["onClick"],cn={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},un=ct(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No tienes carpetas aún",-1)),mn=ct(()=>e("p",{class:"text-gray-600 mb-6"},"Crea tu primera carpeta para organizar tus documentos",-1)),gn={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},pn=ct(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No se encontraron carpetas",-1)),hn=ct(()=>e("p",{class:"text-gray-600"},"No hay carpetas que coincidan con tu búsqueda",-1)),fn={key:3,class:"flex justify-center items-center py-12"},yn=ct(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)),vn=[yn],bn={__name:"FoldersTable",props:{sortedFolders:{type:Array,required:!0},searchQuery:{type:String,default:""},isLoading:{type:Boolean,default:!1}},emits:["folder-click","edit-folder","delete-folder","add-documents","create-folder"],setup(o,{emit:w}){const i=o,c=w,D=b({}),p=b({}),f=b(!1),F=b(-1),v=B(()=>{if(!i.searchQuery.trim())return i.sortedFolders;const $=i.searchQuery.toLowerCase();return i.sortedFolders.filter(E=>E.name.toLowerCase().includes($))}),C=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],X=$=>{if($.color)return C.find(U=>U.name===$.color)||C[0];const E=$.id%C.length;return C[E]},ee=$=>{if(!$)return"-";const E=new Date($),H=Math.abs(new Date-E),de=Math.ceil(H/(1e3*60*60*24));return de===0?"Hoy":de===1?"Ayer":de<7?`Hace ${de} días`:de<30?`Hace ${Math.floor(de/7)} semanas`:de<365?`Hace ${Math.floor(de/30)} meses`:E.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},Y=$=>{c("folder-click",$)},O=$=>{c("edit-folder",$)},ne=$=>{c("delete-folder",$)},Z=$=>{c("add-documents",$)},k=()=>{c("create-folder")},d=()=>f.value?v.value.length===1?"280px":v.value.length===2&&F.value===1?"340px":"280px":"auto",A=($,E)=>{$&&(D.value[E]=$)},z=($,E)=>{$&&(p.value[E]=$)},I=($,E)=>{f.value=!E,F.value=E?-1:$,E||setTimeout(()=>{const U=p.value[$];if(U){const H=U.$el||U;if(H&&H.getBoundingClientRect){const de=H.getBoundingClientRect(),J=window.innerHeight;if($===0){if(de.bottom>J-20){const q=de.bottom-J+40;window.scrollBy({top:q,behavior:"smooth"})}}else if(de.bottom>J-10){const q=de.bottom-J+30;window.scrollBy({top:q,behavior:"smooth"})}else if(de.top<80){const q=de.top-100;window.scrollBy({top:q,behavior:"smooth"})}}}},100)};return($,E)=>(s(),r("div",qr,[!o.isLoading&&v.value.length>0?(s(),r("div",Vr,[e("div",{class:"overflow-x-auto",style:We({minHeight:d(),overflowY:"visible"})},[e("table",Qr,[Wr,e("tbody",Hr,[(s(!0),r(pe,null,he(v.value,(U,H)=>{var de,J;return s(),r("tr",{key:U.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:q=>Y(U)},[e("td",Zr,[e("div",Jr,[e("div",Kr,[e("div",{class:"h-10 w-10 rounded-lg flex items-center justify-center",style:We({backgroundColor:X(U).hex+"20"})},[n(t(Ct),{class:"h-6 w-6",style:We({color:X(U).hex})},null,8,["style"])],4)]),e("div",Yr,[e("div",Xr,g(U.name),1)])])]),e("td",en,[e("div",tn,[n(t(qe),{class:"h-5 w-5 text-gray-400"}),e("span",sn,g(((de=U.documents)==null?void 0:de.length)||0)+" documento"+g((((J=U.documents)==null?void 0:J.length)||0)!==1?"s":""),1)])]),e("td",on,g(ee(U.created_at)),1),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:E[0]||(E[0]=me(()=>{},["stop"]))},[n(t(Be),{as:"div",class:"relative inline-block text-left"},{default:j(({open:q})=>[n(t(Re),{ref_for:!0,ref:K=>A(K,H),onClick:K=>I(H,q),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:j(()=>[n(t(dt),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),n(t(ze),{ref_for:!0,ref:K=>z(K,H),class:P([v.value.length>2&&H>0&&H>=v.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:j(()=>[e("div",an,[n(t(ye),null,{default:j(({active:K})=>[e("a",{onClick:L=>Y(U),class:P([K?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver carpeta ",10,rn)]),_:2},1024),n(t(ye),null,{default:j(({active:K})=>[e("a",{onClick:L=>Z(U),class:P([K?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Agregar documentos ",10,nn)]),_:2},1024),n(t(ye),null,{default:j(({active:K})=>[e("a",{onClick:L=>O(U),class:P([K?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Editar ",10,ln)]),_:2},1024),n(t(ye),null,{default:j(({active:K})=>[e("a",{onClick:L=>ne(U),class:P([K?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Eliminar ",10,dn)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,Gr)}),128))])])],4)])):!o.isLoading&&o.sortedFolders.length===0?(s(),r("div",cn,[n(t(Ct),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),un,mn,e("button",{onClick:k,class:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"},[n(t(Ge),{class:"w-5 h-5"}),re(" Crear Primera Carpeta ")])])):!o.isLoading&&o.sortedFolders.length>0&&v.value.length===0?(s(),r("div",gn,[n(t(Ct),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),pn,hn])):h("",!0),o.isLoading?(s(),r("div",fn,vn)):h("",!0)]))}},xn=At(bn,[["__scopeId","data-v-d9a5a89f"]]),fs=o=>(St("data-v-e3f57445"),o=o(),Ft(),o),_n={class:"folder-management"},wn={class:"mb-6"},$n={class:"hidden sm:flex justify-between items-center"},kn=fs(()=>e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Cn={class:"sm:hidden"},Dn=fs(()=>e("div",{class:"text-center mb-4"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1 px-2"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Sn={__name:"FolderManagement",props:{searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","navigate-to-main","navigate-to-document"],setup(o,{emit:w}){const i=o,c=w,D=Jt(),p=Qe(),f=Ke(),F=b(!1),v=b(null),C=b(null),X=b(!1),ee=b(null),Y=B(()=>D.isLoading),O=B(()=>D.sortedFolders);B(()=>f.currentUser),He(async()=>{await D.init(),await p.init()}),we(()=>i.searchQuery,()=>{}),we(()=>D.folders,L=>{var R,te;if(C.value&&L&&L.length>0){const ve=L.find(N=>N.id===C.value.id);ve&&((R=C.value.documents)!=null&&R.length,(te=ve.documents)!=null&&te.length,JSON.stringify(C.value)!==JSON.stringify(ve)&&(C.value={...ve}))}},{deep:!0});const ne=()=>{v.value=null,F.value=!0},Z=L=>{v.value=L,F.value=!0},k=()=>{F.value=!1,v.value=null},d=()=>{k()},A=L=>{C.value=L},z=()=>{C.value=null},I=async L=>{if(confirm(`¿Estás seguro de que quieres eliminar la carpeta "${L.name}"?`))try{await D.deleteFolder(L.id),$e(`Carpeta "${L.name}" eliminada correctamente`,"success")}catch(R){$e("Error al eliminar la carpeta","error"),console.error("Error deleting folder:",R)}},$=L=>{ee.value=L,X.value=!0},E=async(L=!1)=>{if(X.value=!1,ee.value=null,L&&C.value)try{await U()}catch(R){console.warn("Error refreshing folder after adding documents:",R)}},U=async()=>{if(C.value)try{await D.fetchFolder(C.value.id);const L=D.getFolderById(C.value.id);L&&(C.value={...L},console.log("✅ Selected folder refreshed successfully"))}catch(L){throw console.error("❌ Error refreshing selected folder:",L),L}},H=async L=>{var R,te,ve;if(!(!ee.value||L.length===0))try{const N=ee.value.documents.map(G=>G.id).filter(G=>G!=null&&!isNaN(parseInt(G))).map(G=>parseInt(G)),W=L.filter(G=>G!=null&&!isNaN(parseInt(G))).map(G=>parseInt(G)),V=[...new Set([...N,...W])];if(console.log("Current document IDs:",N),console.log("Selected document IDs:",W),console.log("Updated document IDs:",V),V.some(G=>!Number.isInteger(G)||G<=0))throw new Error("IDs de documentos inválidos detectados");await D.updateFolder(ee.value.id,{document_ids:V}),await E(!0),$e(`${W.length} documento(s) agregado(s) a la carpeta`,"success"),c("navigate-to-main")}catch(N){console.error("Error adding documents to folder:",N),console.error("Error details:",((R=N.response)==null?void 0:R.data)||N.message),(te=N.response)!=null&&te.status?$e(`Error al agregar documentos: ${((ve=N.response.data)==null?void 0:ve.detail)||N.message}`,"error"):$e("Error al agregar documentos a la carpeta","error")}},de=async L=>{var te,ve,N;if(!C.value)return;const R=typeof L=="object"&&L!==null?L.documentId:L;try{const W=parseInt(R);if(!Number.isInteger(W)||W<=0)throw new Error("ID de documento inválido");const V=C.value.documents.map(G=>G.id).filter(G=>G!=null&&!isNaN(parseInt(G))).map(G=>parseInt(G)).filter(G=>G!==W);await D.updateFolder(C.value.id,{document_ids:V}),$e("Documento removido de la carpeta","success"),C.value=null,c("navigate-to-main")}catch(W){console.error("Error removing document from folder:",W),console.error("Error details:",((te=W.response)==null?void 0:te.data)||W.message),(ve=W.response)!=null&&ve.status?$e(`Error al remover documento: ${((N=W.response.data)==null?void 0:N.detail)||W.message}`,"error"):$e("Error al remover el documento de la carpeta","error")}},J=L=>{let R="legal-documents";L.state==="Published"||L.state==="Draft"?R="legal-documents":L.state==="PendingSignatures"?R="pending-signatures":L.state==="FullySigned"?R="signed-documents":L.state==="Progress"||L.state==="Completed"?R="my-documents":(L.state==="Rejected"||L.state==="Expired"||L.state==="Archived")&&(R="archived-documents"),C.value=null,c("navigate-to-document",{tab:R,searchQuery:L.title})},q=L=>{C.value=null,c("navigate-to-document",{tab:"legal-documents",searchQuery:L.title})},K=(L,R)=>{console.log("Document action:",L,R)};return(L,R)=>(s(),r("div",_n,[e("div",wn,[e("div",$n,[kn,e("button",{onClick:ne,class:"inline-flex items-center gap-2 px-4 py-2.5 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md"},[n(t(Ge),{class:"w-5 h-5"}),re(" Nueva Carpeta ")])]),e("div",Cn,[Dn,e("button",{onClick:ne,class:"w-full flex items-center justify-center gap-3 px-4 py-4 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium text-base"},[n(t(Ge),{class:"w-6 h-6"}),re(" Nueva Carpeta ")])])]),n(t(xn),{"sorted-folders":O.value,"search-query":o.searchQuery,"is-loading":Y.value,onFolderClick:A,onEditFolder:Z,onDeleteFolder:I,onAddDocuments:$,onCreateFolder:ne},null,8,["sorted-folders","search-query","is-loading"]),n(t(vo),{"is-visible":F.value,"editing-folder":v.value,onClose:k,onSuccess:d},null,8,["is-visible","editing-folder"]),n(t(Yo),{folder:C.value,onClose:z,onAddDocuments:$,onRemoveDocument:de,onViewDocument:J,onUseDocument:q,onDocumentAction:K},null,8,["folder"]),n(t(Or),{"is-visible":X.value,folder:ee.value,onClose:E,onAddDocuments:H},null,8,["is-visible","folder"])]))}},ns=At(Sn,[["__scopeId","data-v-e3f57445"]]);function Fn(o){return!o.variables||o.variables.length===0?!0:o.variables.every(w=>w.name_es&&w.name_es.trim().length>0)}function kt(o,w){var D;if(!o.requires_signature||o.state!=="PendingSignatures"||!o.signatures||o.signatures.length===0)return!1;const i=(D=w==null?void 0:w.currentUser)==null?void 0:D.email,c=o.signatures.find(p=>p.signer_email===i);return!(!c||c.signed)}const En={lawyer:{getMenuOptions:(o,w,i)=>{let c;return w==="legal-documents"&&(o.state==="Draft"||o.state==="Published")?c=[{label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Actualizar nombre",action:"edit"},{label:"Editar documento",action:"editDocument"},{label:"Editar configuración de variables",action:"editForm"}]},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}]:c=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}],o.state!=="Draft"&&o.state!=="Published"&&c.splice(2,0,{label:"Administrar Asociaciones",action:"relationships"}),o.state==="Draft"?c.push({label:"Publicar",action:"publish",disabled:!Fn(o)}):o.state==="Published"&&c.push({label:"Mover a Borrador",action:"draft"}),(o.state==="Completed"||o.state==="Published")&&c.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),o.requires_signature&&(o.state==="PendingSignatures"||o.state==="FullySigned")&&(c.push({label:"Ver Firmas",action:"viewSignatures"}),kt(o,i)&&c.push({label:"Firmar documento",action:"sign"})),c}},signatures:{getMenuOptions:(o,w,i)=>{const c=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}],D=o.relationships_count&&o.relationships_count>0;if(c.push({label:"Administrar Asociaciones",action:"relationships",disabled:!D}),o.requires_signature&&["PendingSignatures","FullySigned","Rejected","Expired"].includes(o.state)&&c.push({label:"Estado de las firmas",action:"viewSignatures"}),kt(o,i)&&c.push({label:"Firmar documento",action:"sign"}),o.state==="PendingSignatures"&&kt(o,i)&&c.push({label:"Rechazar documento",action:"reject"}),o.state==="FullySigned"&&c.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),o.state==="PendingSignatures"&&c.push({label:"Descargar PDF",action:"downloadPDF"}),o.state==="Rejected"){const p=i==null?void 0:i.currentUser,f=(p==null?void 0:p.role)==="lawyer",F=o.created_by===(p==null?void 0:p.id);(f||F)&&c.push({label:"Editar y reenviar para firma",action:"editAndResend"}),Array.isArray(o.signatures)&&o.signatures.some(C=>C.rejection_comment)&&c.push({label:"Ver motivo del rechazo",action:"viewRejectionReason"})}return c}},client:{getMenuOptions:(o,w,i)=>{var ee,Y,O,ne;const c=[],D=((ee=i==null?void 0:i.currentUser)==null?void 0:ee.role)==="basic",p=((Y=i==null?void 0:i.currentUser)==null?void 0:Y.role)==="corporate_client"||((O=i==null?void 0:i.currentUser)==null?void 0:O.role)==="client",f=((ne=i==null?void 0:i.currentUser)==null?void 0:ne.role)==="lawyer",F=o.state==="Progress",v=w==="my-documents",X=["PendingSignatures","FullySigned","Rejected","Expired"].includes(o.state);if(v&&o.requires_signature&&X&&(o.state==="PendingSignatures"||o.state==="FullySigned"||o.state==="Expired"))return c.push({label:"Previsualizar",action:"preview"}),c.push({label:"Descargar PDF",action:"downloadPDF"}),D?c.push({label:"Descargar Word",action:"downloadWord",disabled:!0}):c.push({label:"Descargar Word",action:"downloadWord"}),o.state==="FullySigned"&&c.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),c;if(o.state==="Completed"){const Z=[{label:"Editar Formulario",action:"editForm"}];D||Z.push({label:"Editar Documento",action:"editDocument"}),c.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:Z}),(p||D||f)&&c.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:D})}else o.state==="Progress"?(c.push({label:"Completar",action:"editForm"}),(p||D||f)&&c.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:!0})):c.push({label:"Completar",action:"editForm"});if((o.state==="Completed"||o.state==="Progress")&&c.push({label:"Previsualizar",action:"preview"}),c.push({label:"Eliminar",action:"delete"}),D?c.push({label:"Gestionar Membrete",action:"letterhead",disabled:!0}):c.push({label:"Gestionar Membrete",action:"letterhead"}),c.push({label:"Administrar Asociaciones",action:"relationships",disabled:D||F}),o.requires_signature){const k=["PendingSignatures","FullySigned","Rejected","Expired"].includes(o.state);w!=="my-documents"&&k&&(c.push({label:"Ver Firmas",action:"viewSignatures"}),kt(o,i)&&c.push({label:"Firmar documento",action:"sign"}))}if(o.state==="Completed"||o.state==="Progress"){const Z=o.state==="Completed";c.push({label:"Descargar PDF",action:"downloadPDF",disabled:!Z},{label:"Descargar Word",action:"downloadWord",disabled:D||!Z},{label:"Enviar",action:"email",disabled:D||!Z})}return c}}};function Tn(o,w,i="list",c=null){const D=En[o];return D?D.getMenuOptions(w,i,c):[]}function ys(){const o=Ke(),w=B(()=>{var p;return((p=o.currentUser)==null?void 0:p.role)==="basic"}),i=p=>{$e("Esta funcionalidad está restringida para usuarios básicos. Por favor, contacta a tu abogado para obtener acceso completo.","warning")};return{isBasicUser:w,showRestrictionNotification:i,handleFeatureAccess:(p,f)=>w.value?(i(),!1):(f&&f(),!0),getRestrictedButtonClasses:p=>p?"opacity-60 cursor-not-allowed":""}}const An={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},jn={class:"px-6 py-4 border-b border-gray-200"},Mn=e("h2",{class:"text-xl font-semibold text-gray-800"},"Acciones del Documento",-1),Pn={class:"text-sm text-gray-500 mt-1"},Ln={class:"p-6 overflow-y-auto flex-grow"},Bn={class:"space-y-4"},Rn={key:0,class:"text-sm font-semibold text-gray-700 uppercase tracking-wide px-2"},zn={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},In=["onClick","disabled"],Un={class:"text-sm font-medium"},Nn={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},On=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),qn={key:1,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Vn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Qn={key:2,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Wn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Hn={key:3,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Gn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Zn={key:4,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Jn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Kn={key:1,class:"border-t border-gray-200 my-4"},Yn={key:0,class:"text-center py-12"},Xn=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay acciones disponibles",-1),el=e("p",{class:"mt-1 text-sm text-gray-500"}," No hay opciones disponibles para este documento. ",-1),Bt={__name:"DocumentActionsModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null},cardType:{type:String,required:!0,validator:o=>["lawyer","client","signatures"].includes(o)},context:{type:String,default:"table"},userStore:{type:Object,default:null}},emits:["close","action"],setup(o,{emit:w}){const i=o,c=w,D=B(()=>i.document?Tn(i.cardType,i.document,i.context,i.userStore):[]),p=B(()=>{const k=D.value;if(!k||k.length===0)return[];const d=[],A={edit:"Edición",view:"Visualización",share:"Compartir",manage:"Gestión",signatures:"Firmas",delete:"Eliminación"},z={edit:[],view:[],share:[],manage:[],signatures:[],delete:[]};return k.forEach(I=>{if(I.children&&Array.isArray(I.children))I.children.forEach($=>{const E=$.action.toLowerCase();f($,E,z)});else{const $=I.action.toLowerCase();f(I,$,z)}}),z.edit.length>0&&d.push({title:A.edit,options:z.edit}),z.view.length>0&&d.push({title:A.view,options:z.view}),z.share.length>0&&d.push({title:A.share,options:z.share}),z.signatures.length>0&&d.push({title:A.signatures,options:z.signatures}),z.manage.length>0&&d.push({title:A.manage,options:z.manage}),z.delete.length>0&&d.push({title:A.delete,options:z.delete}),d}),f=(k,d,A)=>{d.includes("edit")||d.includes("editar")||d==="copy"||d==="draft"||d==="publish"||d==="completar"?A.edit.push(k):d.includes("signature")||d.includes("firma")||d.includes("sign")||d==="reject"?A.signatures.push(k):d.includes("view")||d.includes("preview")||d.includes("ver")||d.includes("previsualización")?A.view.push(k):d.includes("download")||d.includes("email")||d.includes("enviar")||d.includes("descargar")?A.share.push(k):d.includes("permission")||d.includes("relationship")||d.includes("letterhead")||d.includes("permiso")||d.includes("asociación")||d.includes("membrete")||d==="formalize"?A.manage.push(k):d.includes("delete")||d.includes("eliminar")?A.delete.push(k):A.manage.push(k)},F=k=>{const d=k.toLowerCase();return d==="sign"||d.includes("firmar")?Dt:d==="editform"||d.includes("completar")?rs:d==="editdocument"||d.includes("editar documento")?ss:d.includes("edit")||d==="editar"?ss:d.includes("delete")||d==="eliminar"?Vt:d.includes("preview")||d.includes("ver")||d.includes("previsualización")?ms:d==="copy"||d.includes("copia")?Ts:d.includes("download")||d.includes("descargar")?nt:d.includes("email")||d.includes("enviar")?Cs:d.includes("permission")||d.includes("permiso")?Bs:d.includes("relationship")||d.includes("asociación")?gs:d.includes("letterhead")||d.includes("membrete")?ps:d==="reject"||d.includes("rechazar")?Os:d.includes("signature")||d.includes("firma")?Dt:d==="publish"||d.includes("publicar")?Ns:d==="draft"||d.includes("borrador")?qe:d==="formalize"||d.includes("formalizar")?rs:lt},v=k=>{const d=k.toLowerCase();return d.includes("delete")||d==="eliminar"||d==="reject"||d.includes("rechazar")?"text-red-600":d==="sign"||d.includes("firmar")?"text-green-600":d.includes("download")||d.includes("descargar")?"text-blue-600":d.includes("email")||d.includes("enviar")?"text-green-600":d.includes("signature")||d.includes("firma")?"text-purple-600":"text-gray-600"},C=k=>{const d=k.toLowerCase();return d.includes("delete")||d==="eliminar"||d==="reject"||d.includes("rechazar")?"border-red-200 bg-red-50 text-red-700 hover:bg-red-100 hover:border-red-300":d==="sign"||d.includes("firmar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":d.includes("download")||d.includes("descargar")?"border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 hover:border-blue-300":d.includes("email")||d.includes("enviar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":d.includes("signature")||d.includes("firma")?"border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-100 hover:border-purple-300":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-300"},{isBasicUser:X,handleFeatureAccess:ee}=ys(),Y=["formalize","letterhead","relationships","downloadWord","email"],O=k=>{const d=k.toLowerCase();return Y.some(A=>d===A.toLowerCase())},ne=k=>{const d=D.value.find(z=>z.action===k?z:z.children?z.children.find(I=>I.action===k):null),A=d!=null&&d.children?d.children.find(z=>z.action===k):d;if(A!=null&&A.disabled){ee("Esta funcionalidad",null);return}c("action",k,i.document)},Z=()=>{c("close")};return(k,d)=>De((s(),le(Je,null,{default:j(()=>{var A;return[e("div",{class:"w-full h-full flex items-center justify-center p-4",onClick:me(Z,["self"])},[e("div",An,[e("div",jn,[Mn,e("p",Pn,g(((A=o.document)==null?void 0:A.title)||"Cargando..."),1),e("button",{onClick:Z,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500 transition-colors"},[n(t(je),{class:"h-6 w-6"})])]),e("div",Ln,[e("div",Bn,[(s(!0),r(pe,null,he(p.value,(z,I)=>(s(),r("div",{key:I,class:"space-y-2"},[z.title?(s(),r("h3",Rn,g(z.title),1)):h("",!0),e("div",zn,[(s(!0),r(pe,null,he(z.options,$=>{var E,U,H;return s(),r("div",{key:$.action,class:"relative group"},[e("button",{onClick:de=>ne($.action),disabled:$.disabled,class:P(["flex items-center justify-start w-full px-4 py-3 rounded-lg border transition-all duration-200",$.disabled?"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed opacity-60":C($.action),"hover:shadow-md hover:scale-[1.02]"])},[(s(),le(ks(F($.action)),{class:P(["h-5 w-5 mr-3 flex-shrink-0",$.disabled?"text-gray-400":v($.action)])},null,8,["class"])),e("span",Un,g($.label),1),$.disabled?(s(),le(t(js),{key:0,class:"h-4 w-4 ml-auto text-gray-400"})):h("",!0)],10,In),$.disabled&&$.action==="relationships"&&!t(X)&&((E=o.document)==null?void 0:E.state)==="Progress"?(s(),r("div",Nn,[re(" Solo puedes administrar asociaciones cuando el documento está completado. "),On])):$.disabled&&$.action==="relationships"&&!t(X)?(s(),r("div",qn,[re(" Este documento no tiene documentos asociados. "),Vn])):$.disabled&&$.action==="formalize"&&((U=o.document)==null?void 0:U.state)!=="Completed"?(s(),r("div",Qn,[re(" Solo puedes formalizar y agregar firmas cuando el documento está completado. "),Wn])):$.disabled&&["downloadPDF","downloadWord","email"].includes($.action)&&((H=o.document)==null?void 0:H.state)!=="Completed"?(s(),r("div",Hn,[re(" Solo puedes usar esta acción cuando el documento está completado. "),Gn])):$.disabled&&t(X)&&O($.action)?(s(),r("div",Zn,[re(" Actualiza tu suscripción para usar esta funcionalidad "),Jn])):h("",!0)])}),128))]),I<p.value.length-1?(s(),r("div",Kn)):h("",!0)]))),128)),p.value.length===0?(s(),r("div",Yn,[n(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),Xn,el])):h("",!0)])])])])]}),_:1},512)),[[yt,o.isVisible]])}};function Kt(o){if(o.summary_value===null||o.summary_value===void 0||o.summary_value==="")return"";const w=Number(String(o.summary_value).replace(/[^0-9.,-]/g,"").replace(/\./g,"").replace(",","."));if(Number.isNaN(w))return o.summary_value;const i=w.toLocaleString("es-CO",{maximumFractionDigits:2}),c=o.summary_value_currency||"",p={COP:"COP $",USD:"USD $",EUR:"EUR €"}[c]||c||"";return p?`${p} ${i}`:i}const tl={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},sl={class:"mb-4"},ol={class:"relative w-full"},al={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},rl={class:"flex items-center gap-2 min-w-0"},nl={class:"truncate"},ll={class:"py-1"},il=["onClick"],dl={class:"flex items-center gap-2 min-w-0"},cl={class:"truncate"},ul={class:"p-2"},ml={class:"relative mb-2"},gl={class:"max-h-60 overflow-y-auto"},pl=["onClick"],hl={class:"truncate"},fl={class:"flex items-center gap-2 min-w-0"},yl={class:"truncate"},vl={class:"p-2"},bl={class:"relative mb-2"},xl={class:"max-h-60 overflow-y-auto"},_l=["onClick"],wl={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},$l={class:"flex flex-col gap-1"},kl=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),Cl={class:"flex flex-col gap-1"},Dl=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),Sl={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Fl={class:"py-1"},El=["onClick"],Tl={class:"flex gap-2 w-full sm:w-auto"},Al=e("span",null,"Limpiar filtros",-1),jl={key:0,class:"flex justify-center items-center py-12 bg-white rounded-lg shadow-sm border border-gray-200"},Ml=e("div",{class:"text-center"},[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e("p",{class:"text-sm text-gray-500"},"Cargando documentos...")],-1),Pl=[Ml],Ll={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},Bl={class:"overflow-x-auto"},Rl={class:"min-w-full divide-y divide-gray-200"},zl={class:"bg-gray-50"},Il={key:0,scope:"col",class:"w-12 px-3 py-3"},Ul=["checked"],Nl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento ",-1),Ol=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),ql=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Contraparte ",-1),Vl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Objeto ",-1),Ql=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Valor ",-1),Wl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plazo ",-1),Hl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha Suscripción ",-1),Gl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha Inicio ",-1),Zl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha Terminación ",-1),Jl={key:1,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Kl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas ",-1),Yl={class:"bg-white divide-y divide-gray-200"},Xl=["onClick"],ei={key:0,class:"px-3 py-4"},ti=["checked","onChange"],si={class:"px-6 py-4"},oi={class:"flex items-center gap-3"},ai={class:"min-w-0"},ri={class:"text-sm font-medium text-gray-900 hover:text-secondary truncate block max-w-xs text-left"},ni={class:"px-6 py-4 whitespace-nowrap"},li={class:"px-6 py-4 whitespace-nowrap"},ii={class:"text-sm text-gray-900"},di={class:"px-6 py-4 whitespace-nowrap"},ci={class:"text-sm text-gray-900 line-clamp-2 max-w-xs"},ui={class:"px-6 py-4 whitespace-nowrap"},mi={class:"text-sm text-gray-900"},gi={class:"px-6 py-4 whitespace-nowrap"},pi={class:"text-sm text-gray-900"},hi={class:"px-6 py-4 whitespace-nowrap text-xs text-gray-900"},fi={key:0},yi={key:1,class:"text-gray-400"},vi={class:"px-6 py-4 whitespace-nowrap text-xs text-gray-900"},bi={key:0},xi={key:1,class:"text-gray-400"},_i={class:"px-6 py-4 whitespace-nowrap text-xs text-gray-900"},wi={key:0},$i={key:1,class:"text-gray-400"},ki={key:1,class:"px-6 py-4 whitespace-nowrap"},Ci=["onClick"],Di={key:1,class:"text-sm text-gray-400"},Si={class:"px-6 py-4"},Fi={class:"flex flex-wrap gap-1"},Ei=["onClick"],Ti={key:0,class:"bg-gray-50 px-4 py-3 border-t border-gray-200 sm:px-6"},Ai={class:"flex items-center justify-between"},ji={class:"flex-1 flex justify-between sm:hidden"},Mi=["disabled"],Pi=["disabled"],Li={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},Bi={key:0,class:"text-sm text-gray-700"},Ri={class:"font-medium"},zi={class:"font-medium"},Ii={class:"font-medium"},Ui={key:1,class:"text-sm text-gray-700"},Ni={class:"font-medium"},Oi={class:"font-medium"},qi={class:"font-medium"},Vi={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},Qi=["disabled"],Wi=["onClick"],Hi=["disabled"],Gi={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Zi=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos",-1),Ji={class:"mt-1 text-sm text-gray-500"},Ki={key:11,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4"},Yi={class:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] flex flex-col"},Xi={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},ed={class:"flex items-center gap-2"},td=e("h2",{class:"text-sm font-semibold text-gray-900"},"Etiquetas del documento",-1),sd={class:"px-4 py-3 border-b border-gray-100 text-xs text-gray-500"},od=e("span",{class:"font-medium text-gray-700"},"Documento:",-1),ad={class:"ml-1"},rd={class:"px-4 py-3 overflow-y-auto"},nd={key:0,class:"text-sm text-gray-500"},ld={key:1,class:"space-y-2 text-sm"},id={class:"flex items-center gap-2 min-w-0"},dd={key:0,class:"text-xs text-gray-500 truncate max-w-[8rem]"},Ot={__name:"DocumentListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null},cardType:{type:String,default:"lawyer",validator:o=>["lawyer","client"].includes(o)},showStateFilter:{type:Boolean,default:!0},showClientFilter:{type:Boolean,default:!1},showAssociationsColumn:{type:Boolean,default:!0},availableStates:{type:Array,default:()=>["Draft","Published","Progress","PendingSignatures","Completed","FullySigned","Rejected","Expired"]},context:{type:String,default:"legal-documents"},isLoading:{type:Boolean,default:!1}},emits:["refresh","open-electronic-signature","update:searchQuery"],setup(o,{emit:w}){const i=Qe(),c=Ke(),D=st(),p=o,f=w,{activeModals:F,openModal:v,closeModal:C}=jt(i,c),X=B(()=>(F==null?void 0:F.value)||F||{}),ee=B(()=>{const u=X.value;return(u==null?void 0:u.relationships)||{isOpen:!1,document:null}}),{handlePreviewDocument:Y,deleteDocument:O,downloadPDFDocument:ne,downloadWordDocument:Z,copyDocument:k,publishDocument:d,moveToDraft:A,formalizeDocument:z,signDocument:I,downloadSignedDocument:$}=Mt(i,c,f),E=b(""),U=b(""),H=b(""),de=b(null),J=b(null),q=b(null),K=b(""),L=b(""),R=b("recent"),te=b([]),ve=b(!1),N=b(null),W=b(!1),V=b(null),G=b(1),be=b(10),_e=B(()=>p.cardType==="lawyer"&&p.context==="legal-documents");B(()=>!1);const xe=B(()=>{if(p.promptDocuments)return p.promptDocuments;const u=c.currentUser;return p.cardType==="lawyer"&&p.context==="legal-documents"?!(u!=null&&u.id)||typeof i.getDocumentsByLawyerId!="function"?[]:i.getDocumentsByLawyerId(u.id)||[]:p.cardType==="client"&&p.context==="my-documents"?!(u!=null&&u.id)||typeof i.progressAndCompletedDocumentsByClient!="function"?[]:i.progressAndCompletedDocumentsByClient(u.id)||[]:i.documents||[]}),Ie=B(()=>{const u=new Map;return xe.value.forEach(m=>{var ae;(ae=m.tags)==null||ae.forEach(y=>{u.has(y.id)||u.set(y.id,y)})}),Array.from(u.values())}),Ue=B(()=>{if(!U.value)return Ie.value;const u=U.value.toLowerCase();return Ie.value.filter(m=>m.name.toLowerCase().includes(u))}),Ne=B(()=>{if(!J.value)return null;const u=Ie.value.find(m=>m.id===J.value);return(u==null?void 0:u.name)||null}),se=B(()=>{if(p.cardType!=="lawyer")return[];const u=new Map;return xe.value.forEach(m=>{m.client&&u.set(m.client.id,m.client)}),Array.from(u.values())}),ie=B(()=>{if(!H.value)return se.value;const u=H.value.toLowerCase();return se.value.filter(m=>`${m.first_name} ${m.last_name}`.toLowerCase().includes(u))}),ue=B(()=>{if(!q.value)return null;const u=se.value.find(m=>m.id===q.value);return u?`${u.first_name} ${u.last_name}`:null}),Se=B(()=>!p.selectedTags||!p.selectedTags.length?[]:p.selectedTags.map(u=>typeof u=="object"?u.id:u)),Ae=B(()=>{let u=xe.value;const m=(E.value||"").toLowerCase();return m&&(u=u.filter(ae=>{var y,Ce;return((y=ae.title)==null?void 0:y.toLowerCase().includes(m))||((Ce=ae.code)==null?void 0:Ce.toLowerCase().includes(m))})),de.value&&(u=u.filter(ae=>ae.state===de.value)),(K.value||L.value)&&(u=u.filter(ae=>{const y=ae.summary_subscription_date||ae.created_at||ae.updated_at;if(!y)return!1;const Ce=new Date(y);if(isNaN(Ce.getTime()))return!1;if(K.value){const Le=new Date(K.value);if(Ce<Le)return!1}if(L.value){const Le=new Date(L.value);if(Le.setHours(23,59,59,999),Ce>Le)return!1}return!0})),J.value&&(u=u.filter(ae=>{var y;return(y=ae.tags)==null?void 0:y.some(Ce=>Ce.id===J.value)})),Se.value.length>0&&(u=u.filter(ae=>{var y;return(y=ae.tags)==null?void 0:y.some(Ce=>Se.value.includes(Ce.id))})),q.value&&p.cardType==="lawyer"&&(u=u.filter(ae=>{var y;return((y=ae.client)==null?void 0:y.id)===q.value})),u}),Pe=()=>{de.value=null,J.value=null,q.value=null,K.value="",L.value=""},x=B(()=>{if(p.cardType!=="lawyer"||p.context!=="legal-documents")return!1;const u=Ae.value;return u.length?u.every(m=>m.state==="Draft"||m.state==="Published"):!1}),l=B(()=>p.cardType==="lawyer"&&p.context==="legal-documents"),a=B(()=>p.cardType==="client"&&p.context==="my-documents"),T=B(()=>{const u=[...Ae.value];switch(R.value){case"recent":return u.sort((m,ae)=>new Date(ae.updated_at)-new Date(m.updated_at));case"oldest":return u.sort((m,ae)=>new Date(m.updated_at)-new Date(ae.updated_at));case"name-asc":return u.sort((m,ae)=>(m.title||"").localeCompare(ae.title||""));case"name-desc":return u.sort((m,ae)=>(ae.title||"").localeCompare(m.title||""));default:return u}}),ce=B(()=>{if(p.promptDocuments){const u=(G.value-1)*be.value,m=u+be.value;return T.value.slice(u,m)}return T.value}),M=B(()=>{var u;return p.promptDocuments?Math.ceil(T.value.length/be.value):((u=i.pagination)==null?void 0:u.totalPages)||1}),Te=B(()=>{const u=M.value,m=G.value,ae=[];if(u<=7)for(let y=1;y<=u;y++)ae.push(y);else if(m<=4){for(let y=1;y<=5;y++)ae.push(y);ae.push("..."),ae.push(u)}else if(m>=u-3){ae.push(1),ae.push("...");for(let y=u-4;y<=u;y++)ae.push(y)}else ae.push(1),ae.push("..."),ae.push(m-1),ae.push(m),ae.push(m+1),ae.push("..."),ae.push(u);return ae}),Fe=B(()=>ce.value.length>0&&ce.value.every(u=>te.value.includes(u.id))),Oe=[{value:"recent",label:"Más recientes"},{value:"oldest",label:"Más antiguos"},{value:"name-asc",label:"Nombre (A-Z)"},{value:"name-desc",label:"Nombre (Z-A)"}],et=u=>{var m;return((m=Oe.find(ae=>ae.value===u))==null?void 0:m.label)||"Ordenar"},Ye=u=>({Draft:"Borrador",Published:"Publicado",Progress:"En Progreso",PendingSignatures:"Pendiente de Firmas",Completed:"Completado",FullySigned:"Firmado",Rejected:"Rechazado",Expired:"Expirado"})[u]||u,ot=u=>Ye(u.state),xt=u=>({Draft:"bg-gray-100 text-gray-800",Published:"bg-blue-100 text-blue-800",Progress:"bg-yellow-100 text-yellow-800",PendingSignatures:"bg-orange-100 text-orange-800",Completed:"bg-green-100 text-green-800",FullySigned:"bg-purple-100 text-purple-800",Rejected:"bg-red-100 text-red-800",Expired:"bg-gray-100 text-gray-800"})[u.state]||"bg-gray-100 text-gray-800",Rt=u=>({Draft:"text-gray-500",Published:"text-blue-600",Progress:"text-yellow-600",PendingSignatures:"text-orange-600",Completed:"text-green-600",FullySigned:"text-purple-600",Rejected:"text-red-600",Expired:"text-gray-500"})[u.state]||"text-gray-400",ut=u=>{if(u&&u.color)return{red:"bg-red-100 text-red-800",blue:"bg-blue-100 text-blue-800",green:"bg-green-100 text-green-800",yellow:"bg-yellow-100 text-yellow-800",purple:"bg-purple-100 text-purple-800",pink:"bg-pink-100 text-pink-800",indigo:"bg-indigo-100 text-indigo-800"}[u.color]||"bg-gray-100 text-gray-800";const m=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],ae=u&&typeof u.id=="number"?u.id%m.length:0;return m[ae]},mt=u=>u?new Date(u).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"-",gt=u=>u.summary_counterparty||"",zt=u=>Kt(u),_t=u=>["Completed","FullySigned"].includes(u.state),wt=u=>String(i.lastUpdatedDocumentId)===String(u),It=u=>{const m=te.value.indexOf(u);m>-1?te.value.splice(m,1):te.value.push(u)},Ut=u=>{V.value=u,W.value=!0},Q=()=>{W.value=!1,V.value=null},S=()=>{if(Fe.value)te.value=te.value.filter(u=>!ce.value.some(m=>m.id===u));else{const u=ce.value.map(m=>m.id).filter(m=>!te.value.includes(m));te.value.push(...u)}},oe=u=>{N.value=u,ve.value=!0},_=()=>{const u=te.value.length>0?T.value.filter(tt=>te.value.includes(tt.id)):T.value,m=["Nombre Minuta","Estado","Etiquetas"],ae=u.map(tt=>[tt.title||"",ot(tt),tt.tags?tt.tags.map(Nt=>Nt.name).join(", "):""]),y=[m.join(","),...ae.map(tt=>tt.map(Nt=>`"${Nt}"`).join(","))].join(`
`),Ce=new Blob([y],{type:"text/csv;charset=utf-8;"}),Le=document.createElement("a"),Xe=URL.createObjectURL(Ce);Le.setAttribute("href",Xe),Le.setAttribute("download",`documentos_${new Date().toISOString().split("T")[0]}.csv`),Le.style.visibility="hidden",document.body.appendChild(Le),Le.click(),document.body.removeChild(Le)},ge=async(u,m)=>{var ae;switch(u){case"preview":await Y(m);break;case"edit":{const y=((ae=c.currentUser)==null?void 0:ae.role)||"client";p.cardType==="lawyer"&&p.context==="legal-documents"?v("edit",m,{userRole:y,renameOnly:!0}):v("edit",m,{userRole:y})}break;case"editForm":if(p.cardType==="lawyer"&&p.context==="legal-documents")try{const y=await i.fetchDocumentById(m.id,!0);i.selectedDocument=y,D.push("/dynamic_document_dashboard/lawyer/variables-config")}catch(y){console.error("Error al abrir la configuración de variables:",y)}else v("edit",m,{userRole:"client"});break;case"editDocument":p.cardType==="lawyer"&&p.context==="legal-documents"?D.push(`/dynamic_document_dashboard/lawyer/editor/edit/${m.id}`):D.push(`/dynamic_document_dashboard/client/editor/edit/${m.id}`);break;case"permissions":v("permissions",m);break;case"relationships":v("relationships",m);break;case"letterhead":v("letterhead",m);break;case"viewSignatures":case"signatures":v("signatures",m);break;case"publish":await d(m);break;case"draft":case"move-to-draft":await A(m);break;case"formalize":await z(m);break;case"sign":await I(m);break;case"delete":await O(m);break;case"downloadPDF":case"download-pdf":await ne(m);break;case"downloadWord":case"download-word":await Z(m);break;case"downloadSignedDocument":case"download-signed":await $(m);break;case"email":case"send":v("email",m);break;case"copy":await k(m);break;default:console.warn("Unknown action:",u)}},fe=async(u,m)=>{ve.value=!1,await ge(u,m)},ke=({documentId:u,count:m})=>{const ae=i.documents.find(y=>y.id===u);ae&&(ae.relationships_count=m)};return we(G,async(u,m)=>{if(!p.promptDocuments&&!(u===m||!u))try{const ae=c.currentUser,y={page:u,limit:be.value,forceRefresh:!0};l.value&&(ae!=null&&ae.id)&&(y.lawyerId=ae.id,y.states=["Draft","Published"]),a.value&&(ae!=null&&ae.id)&&(y.clientId=ae.id,y.states=["Progress","Completed"]),await i.fetchDocuments(y)}catch(ae){console.error("Error fetching documents for page change:",ae)}}),we(()=>T.value.length,()=>{G.value>M.value&&(G.value=Math.max(1,M.value))}),we(E,u=>{f("update:searchQuery",u??"")}),we(()=>p.searchQuery,u=>{u!=null&&(E.value=u)},{immediate:!0}),He(async()=>{if(await c.init(),!p.promptDocuments)try{const u=c.currentUser,m={page:1,limit:be.value,forceRefresh:!0};l.value&&(u!=null&&u.id)&&(m.lawyerId=u.id,m.states=["Draft","Published"]),a.value&&(u!=null&&u.id)&&(m.clientId=u.id,m.states=["Progress","Completed"]),await i.fetchDocuments(m)}catch(u){console.error("Error initializing documents for table:",u)}}),(u,m)=>{var ae;return s(),r("div",null,[e("div",tl,[e("div",sl,[e("div",ol,[n(t(Ze),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),De(e("input",{"onUpdate:modelValue":m[0]||(m[0]=y=>E.value=y),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Ee,E.value]])])]),e("div",al,[o.showStateFilter?(s(),le(t(Be),{key:0,as:"div",class:"relative"},{default:j(()=>[n(t(Re),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[e("div",rl,[n(t(rt),{class:"h-4 w-4 flex-shrink-0"}),e("span",nl,g(de.value||"Estado"),1)]),n(t(Ve),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),n(t(ze),{class:"absolute left-0 z-10 mt-2 w-full min-w-[14rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",ll,[n(t(ye),null,{default:j(({active:y})=>[e("a",{onClick:m[1]||(m[1]=Ce=>de.value=null),class:P([y?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),r(pe,null,he(o.availableStates,y=>(s(),le(t(ye),{key:y},{default:j(({active:Ce})=>[e("a",{onClick:Le=>de.value=y,class:P([Ce?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},g(Ye(y)),11,il)]),_:2},1024))),128))])]),_:1})]),_:1})):h("",!0),n(t(Be),{as:"div",class:"relative"},{default:j(()=>[n(t(Re),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[e("div",dl,[n(t(rt),{class:"h-4 w-4 flex-shrink-0"}),e("span",cl,g(Ne.value||"Etiqueta"),1)]),n(t(Ve),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),n(t(ze),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",ul,[e("div",ml,[n(t(Ze),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),De(e("input",{"onUpdate:modelValue":m[2]||(m[2]=y=>U.value=y),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:m[3]||(m[3]=me(()=>{},["stop"]))},null,512),[[Ee,U.value]])]),e("div",gl,[n(t(ye),null,{default:j(({active:y})=>[e("a",{onClick:m[4]||(m[4]=Ce=>J.value=null),class:P([y?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),r(pe,null,he(Ue.value,y=>(s(),le(t(ye),{key:y.id},{default:j(({active:Ce})=>[e("a",{onClick:Le=>J.value=y.id,class:P([Ce?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:P(["w-3 h-3 rounded-full flex-shrink-0",ut(y)])},null,2),e("span",hl,g(y.name),1)],10,pl)]),_:2},1024))),128))])])]),_:1})]),_:1}),o.showClientFilter?(s(),le(t(Be),{key:1,as:"div",class:"relative"},{default:j(()=>[n(t(Re),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[e("div",fl,[n(t(rt),{class:"h-4 w-4 flex-shrink-0"}),e("span",yl,g(ue.value||"Cliente"),1)]),n(t(Ve),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),n(t(ze),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",vl,[e("div",bl,[n(t(Ze),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),De(e("input",{"onUpdate:modelValue":m[5]||(m[5]=y=>H.value=y),type:"text",placeholder:"Buscar clientes...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:m[6]||(m[6]=me(()=>{},["stop"]))},null,512),[[Ee,H.value]])]),e("div",xl,[n(t(ye),null,{default:j(({active:y})=>[e("a",{onClick:m[7]||(m[7]=Ce=>q.value=null),class:P([y?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),r(pe,null,he(ie.value,y=>(s(),le(t(ye),{key:y.id},{default:j(({active:Ce})=>[e("a",{onClick:Le=>q.value=y.id,class:P([Ce?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])},g(y.first_name)+" "+g(y.last_name),11,_l)]),_:2},1024))),128))])])]),_:1})]),_:1})):h("",!0)]),e("div",wl,[e("div",$l,[kl,De(e("input",{"onUpdate:modelValue":m[8]||(m[8]=y=>K.value=y),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Ee,K.value]])]),e("div",Cl,[Dl,De(e("input",{"onUpdate:modelValue":m[9]||(m[9]=y=>L.value=y),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Ee,L.value]])])]),e("div",Sl,[n(t(Be),{as:"div",class:"relative w-full sm:w-auto"},{default:j(()=>[n(t(Re),{class:"w-full sm:w-auto inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[n(t(Rs),{class:"h-4 w-4"}),e("span",null,g(et(R.value)),1),n(t(Ve),{class:"h-4 w-4"})]),_:1}),n(t(ze),{class:"absolute left-0 z-10 mt-2 w-56 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",Fl,[(s(),r(pe,null,he(Oe,y=>n(t(ye),{key:y.value},{default:j(({active:Ce})=>[e("a",{onClick:Le=>R.value=y.value,class:P([Ce?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},g(y.label),11,El)]),_:2},1024)),64))])]),_:1})]),_:1}),e("div",Tl,[te.value.length>0?(s(),r("button",{key:0,onClick:_,class:"flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[n(t(nt),{class:"h-4 w-4"}),e("span",null,"Exportar ("+g(te.value.length)+")",1)])):h("",!0),de.value||J.value||q.value||K.value||L.value?(s(),r("button",{key:1,onClick:Pe,class:"flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-200 rounded-md bg-white text-xs font-medium text-gray-500 hover:bg-gray-50",title:"Limpiar filtros",type:"button"},[n(t(je),{class:"h-4 w-4 flex-shrink-0"}),Al])):h("",!0)])])]),o.isLoading?(s(),r("div",jl,Pl)):!o.isLoading&&ce.value.length>0?(s(),r("div",Ll,[e("div",Bl,[e("table",Rl,[e("thead",zl,[e("tr",null,[_e.value?(s(),r("th",Il,[e("input",{type:"checkbox",checked:Fe.value,onChange:S,class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded cursor-pointer"},null,40,Ul)])):h("",!0),Nl,Ol,ql,Vl,Ql,Wl,Hl,Gl,Zl,o.showAssociationsColumn&&!x.value?(s(),r("th",Jl," Asociaciones ")):h("",!0),Kl])]),e("tbody",Yl,[(s(!0),r(pe,null,he(ce.value,y=>{var Ce,Le;return s(),r("tr",{key:y.id,class:P(["hover:bg-gray-50 cursor-pointer transition-colors duration-150",wt(y.id)?"bg-yellow-50":""]),onClick:Xe=>oe(y)},[_e.value?(s(),r("td",ei,[e("input",{type:"checkbox",checked:te.value.includes(y.id),onChange:me(Xe=>It(y.id),["stop"]),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded cursor-pointer"},null,40,ti)])):h("",!0),e("td",si,[e("div",oi,[n(t(qe),{class:P(["h-5 w-5 flex-shrink-0",Rt(y)])},null,8,["class"]),e("div",ai,[e("span",ri,g(y.title||"Sin título"),1)])])]),e("td",ni,[e("span",{class:P([xt(y),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},g(ot(y)),3)]),e("td",li,[e("span",ii,g(gt(y)||"-"),1)]),e("td",di,[e("span",ci,g(y.summary_object||"-"),1)]),e("td",ui,[e("span",mi,g(zt(y)||"-"),1)]),e("td",gi,[e("span",pi,g(y.summary_term||"-"),1)]),e("td",hi,[y.summary_subscription_date?(s(),r("span",fi,g(mt(y.summary_subscription_date)),1)):(s(),r("span",yi,"-"))]),e("td",vi,[y.summary_start_date?(s(),r("span",bi,g(mt(y.summary_start_date)),1)):(s(),r("span",xi,"-"))]),e("td",_i,[y.summary_end_date?(s(),r("span",wi,g(mt(y.summary_end_date)),1)):(s(),r("span",$i,"-"))]),o.showAssociationsColumn&&!x.value?(s(),r("td",ki,[_t(y)?(s(),r("button",{key:0,onClick:me(Xe=>t(v)("relationships",y),["stop"]),class:"inline-flex items-center gap-1 text-sm text-secondary hover:text-blue-700"},[n(t(gs),{class:"h-4 w-4"}),e("span",null,g(y.relationships_count||0),1)],8,Ci)):(s(),r("span",Di,g(y.relationships_count||0),1))])):h("",!0),e("td",Si,[e("div",Fi,[(s(!0),r(pe,null,he((Ce=y.tags)==null?void 0:Ce.slice(0,2),Xe=>(s(),r("span",{key:Xe.id,class:P([ut(Xe),"px-2 py-1 text-xs rounded-full"])},g(Xe.name),3))),128)),((Le=y.tags)==null?void 0:Le.length)>2?(s(),r("button",{key:0,type:"button",class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 inline-flex items-center gap-1",onClick:me(Xe=>Ut(y),["stop"])},[e("span",null,"+"+g(y.tags.length-2),1)],8,Ei)):h("",!0)])])],10,Xl)}),128))])])]),M.value>1?(s(),r("div",Ti,[e("div",Ai,[e("div",ji,[e("button",{onClick:m[10]||(m[10]=y=>G.value--),disabled:G.value===1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Anterior ",8,Mi),e("button",{onClick:m[11]||(m[11]=y=>G.value++),disabled:G.value===M.value,class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Siguiente ",8,Pi)]),e("div",Li,[e("div",null,[p.promptDocuments?(s(),r("p",Bi,[re(" Mostrando "),e("span",Ri,g((G.value-1)*be.value+1),1),re(" a "),e("span",zi,g(Math.min(G.value*be.value,T.value.length)),1),re(" de "),e("span",Ii,g(T.value.length),1),re(" resultados ")])):(s(),r("p",Ui,[re(" Mostrando "),e("span",Ni,g(T.value.length===0?0:(t(i).pagination.currentPage-1)*t(i).pagination.itemsPerPage+1),1),re(" a "),e("span",Oi,g((t(i).pagination.currentPage-1)*t(i).pagination.itemsPerPage+T.value.length),1),re(" de "),e("span",qi,g(t(i).pagination.totalItems),1),re(" resultados ")]))]),e("div",null,[e("nav",Vi,[e("button",{onClick:m[12]||(m[12]=y=>G.value--),disabled:G.value===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[n(t(Et),{class:"h-5 w-5"})],8,Qi),(s(!0),r(pe,null,he(Te.value,y=>(s(),r("button",{key:y,onClick:Ce=>typeof y=="number"?G.value=y:null,class:P([y===G.value?"z-10 bg-secondary border-secondary text-white":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50",typeof y=="string"?"cursor-default":"cursor-pointer","relative inline-flex items-center px-4 py-2 border text-sm font-medium"])},g(y),11,Wi))),128)),e("button",{onClick:m[13]||(m[13]=y=>G.value++),disabled:G.value===M.value,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[n(t(vt),{class:"h-5 w-5"})],8,Hi)])])])])])):h("",!0)])):!o.isLoading&&ce.value.length===0?(s(),r("div",Gi,[n(t(qe),{class:"mx-auto h-12 w-12 text-gray-400"}),Zi,e("p",Ji,g(p.promptDocuments?"No se encontraron documentos":"Comienza creando un nuevo documento"),1)])):h("",!0),t(at)?(s(),le(Ht,{key:3,"is-open":t(at),document:t(Wt),onClose:m[14]||(m[14]=y=>at.value=!1)},null,8,["is-open","document"])):h("",!0),t(F).edit.isOpen?(s(),le(t(Gt),{key:4,"is-open":t(F).edit.isOpen,document:t(F).edit.document,"user-role":t(F).edit.userRole||((ae=t(c).currentUser)==null?void 0:ae.role)||"client","show-editor-button":!t(F).edit.renameOnly,onClose:m[15]||(m[15]=y=>t(C)("edit")),onRefresh:m[16]||(m[16]=y=>f("refresh"))},null,8,["is-open","document","user-role","show-editor-button"])):h("",!0),X.value.email.isOpen?(s(),le(t(Zt),{key:5,"is-open":X.value.email.isOpen,document:X.value.email.document,onClose:m[17]||(m[17]=y=>t(C)("email")),onRefresh:m[18]||(m[18]=y=>f("refresh"))},null,8,["is-open","document"])):h("",!0),t(F).signatures.isOpen?(s(),le(t(us),{key:6,"is-open":t(F).signatures.isOpen,document:t(F).signatures.document,onClose:m[19]||(m[19]=y=>t(C)("signatures")),onRefresh:m[20]||(m[20]=y=>f("refresh"))},null,8,["is-open","document"])):h("",!0),t(F).permissions.isOpen?(s(),le(t(Ms),{key:7,"is-open":t(F).permissions.isOpen,document:t(F).permissions.document,onClose:m[21]||(m[21]=y=>t(C)("permissions")),onRefresh:m[22]||(m[22]=y=>f("refresh"))},null,8,["is-open","document"])):h("",!0),t(F).letterhead.isOpen?(s(),le(Pt,{key:8,"is-visible":t(F).letterhead.isOpen,document:t(F).letterhead.document,onClose:m[23]||(m[23]=y=>t(C)("letterhead")),onRefresh:m[24]||(m[24]=y=>f("refresh"))},null,8,["is-visible","document"])):h("",!0),ee.value.isOpen?(s(),le(Tt,{key:9,"is-open":ee.value.isOpen,document:ee.value.document,onClose:m[25]||(m[25]=y=>t(C)("relationships")),onUpdateCount:ke},null,8,["is-open","document"])):h("",!0),ve.value?(s(),le(Bt,{key:10,"is-visible":ve.value,document:N.value,"card-type":o.cardType,context:p.context||"list","user-store":t(c),onClose:m[26]||(m[26]=y=>ve.value=!1),onRefresh:m[27]||(m[27]=y=>f("refresh")),onAction:fe},null,8,["is-visible","document","card-type","context","user-store"])):h("",!0),W.value&&V.value?(s(),r("div",Ki,[e("div",Yi,[e("div",Xi,[e("div",ed,[n(t(qt),{class:"h-5 w-5 text-gray-500"}),td]),e("button",{type:"button",class:"text-gray-400 hover:text-gray-600 p-1 rounded-md hover:bg-gray-100",onClick:Q},[n(t(je),{class:"h-5 w-5"})])]),e("div",sd,[od,e("span",ad,g(V.value.title||"Sin título"),1)]),e("div",rd,[!V.value.tags||V.value.tags.length===0?(s(),r("div",nd," Este documento no tiene etiquetas. ")):(s(),r("ul",ld,[(s(!0),r(pe,null,he(V.value.tags,y=>(s(),r("li",{key:y.id,class:"flex items-center justify-between gap-2"},[e("div",id,[e("span",{class:P(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",ut(y)])},g(y.name),3)]),y.description?(s(),r("span",dd,g(y.description),1)):h("",!0)]))),128))]))]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end"},[e("button",{type:"button",class:"px-4 py-2 text-sm font-medium rounded-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-50",onClick:Q}," Cerrar ")])])])):h("",!0)])}}},cd={class:"mb-4"},ud={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},md={class:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"},gd={class:"flex flex-col sm:flex-row gap-3 flex-1 w-full lg:w-auto"},pd={class:"relative flex-1 min-w-[200px]"},hd={class:"max-w-[120px] truncate"},fd={class:"p-2"},yd={class:"relative mb-2"},vd={class:"max-h-60 overflow-y-auto"},bd=["onClick"],xd={class:"truncate"},_d={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},wd={class:"flex items-center gap-3 w-full lg:w-auto"},$d={class:"text-sm text-gray-500 whitespace-nowrap"},kd={class:"py-1"},Cd={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},Dd={class:"min-w-full divide-y divide-gray-200"},Sd=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plantilla "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),Fd={class:"bg-white divide-y divide-gray-200"},Ed=["onClick"],Td={class:"px-6 py-4 whitespace-nowrap"},Ad={class:"flex items-center"},jd={class:"flex-shrink-0 h-10 w-10"},Md={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},Pd={class:"ml-4"},Ld={class:"text-sm font-medium text-gray-900"},Bd=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-700 border border-purple-200"}," Disponible ")],-1),Rd={class:"px-6 py-4 whitespace-nowrap"},zd={class:"flex flex-wrap gap-1"},Id={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},Ud={key:1,class:"text-sm text-gray-400"},Nd={class:"py-1"},Od=["onClick"],qd={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Vd=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay plantillas disponibles",-1),Qd={class:"mt-1 text-sm text-gray-500"},Wd=e("div",{class:"mt-4"},[e("div",{class:"text-xs text-gray-400 bg-gray-100 px-3 py-2 rounded-lg inline-block"},[re(" 💡 "),e("strong",null,"Tip:"),re(" Las plantillas son creadas por los abogados ")])],-1),ls={__name:"UseDocumentTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["go-back"],setup(o,{emit:w}){const i=Qe();Ke();const c=st(),D=w,p=b(""),f=b(""),F=b(null),v=b("recent"),C=b(!1),X=b(null),ee=b({}),Y=b({}),O=b(!1),ne=b(-1),Z=B(()=>i.publishedDocumentsUnassigned||[]),k=B(()=>{let N=[...Z.value];const W=p.value.toLowerCase();return W&&(N=N.filter(V=>{var G,be;return((G=V.title)==null?void 0:G.toLowerCase().includes(W))||((be=V.tags)==null?void 0:be.some(_e=>{var xe;return(xe=_e.name)==null?void 0:xe.toLowerCase().includes(W)}))})),F.value&&(N=N.filter(V=>V.tags&&V.tags.some(G=>G.id===F.value))),v.value==="name"?N.sort((V,G)=>{const be=(V.title||"").toLowerCase(),_e=(G.title||"").toLowerCase();return be.localeCompare(_e)}):v.value==="recent"&&N.sort((V,G)=>G.id-V.id),N}),d=B(()=>{const N=new Map;return Z.value.forEach(W=>{W.tags&&W.tags.length>0&&W.tags.forEach(V=>{N.has(V.id)||N.set(V.id,V)})}),Array.from(N.values()).sort((W,V)=>W.name.localeCompare(V.name))}),A=B(()=>{if(!f.value)return d.value;const N=f.value.toLowerCase();return d.value.filter(W=>W.name.toLowerCase().includes(N))}),z=B(()=>{if(!F.value)return null;const N=d.value.find(W=>W.id===F.value);return N?N.name:null}),I=B(()=>{switch(v.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),$=B(()=>{const N=p.value&&p.value.trim().length>0,W=F.value!==null;return N&&W?"No se encontraron plantillas que coincidan con tu búsqueda y filtros":N?"No se encontraron plantillas que coincidan con tu búsqueda":W?"No se encontraron plantillas con la etiqueta seleccionada":"Aún no hay plantillas disponibles para usar"}),E=N=>{const W=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],V=N.id%W.length;return W[V]},U=N=>{const W=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],V=N.id%W.length;return W[V]},H=()=>{F.value=null},de=N=>{N&&(i.selectedDocument=null,X.value=N,C.value=!0)},J=()=>{C.value=!1,X.value=null},q=N=>{if(N.state==="Published"&&!N.assigned_to)de(N.id);else{const V=`/dynamic_document_dashboard/document/use/editor/${N.id}/${encodeURIComponent(N.title.trim())}`;c.push(V)}},K=()=>{D("go-back")};He(async()=>{(!i.documents||i.documents.length===0)&&await i.init(!0)});const L=()=>O.value?k.value.length===1?"280px":k.value.length===2&&ne.value===1?"340px":"280px":"auto",R=(N,W)=>{N&&(ee.value[W]=N)},te=(N,W)=>{N&&(Y.value[W]=N)},ve=(N,W)=>{O.value=!W,ne.value=W?-1:N,W||setTimeout(()=>{const V=Y.value[N];if(V){const G=V.$el||V;if(G&&G.getBoundingClientRect){const be=G.getBoundingClientRect(),_e=window.innerHeight;if(N===0){if(be.bottom>_e-20){const xe=be.bottom-_e+40;window.scrollBy({top:xe,behavior:"smooth"})}}else if(be.bottom>_e-10){const xe=be.bottom-_e+30;window.scrollBy({top:xe,behavior:"smooth"})}else if(be.top<80){const xe=be.top-100;window.scrollBy({top:xe,behavior:"smooth"})}}}},100)};return(N,W)=>(s(),r("div",null,[e("div",cd,[e("button",{onClick:K,class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors border border-gray-300"},[n(t(zs),{class:"h-4 w-4"}),re(" Volver a Mis Documentos ")])]),e("div",ud,[e("div",md,[e("div",gd,[e("div",pd,[n(t(Ze),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),De(e("input",{"onUpdate:modelValue":W[0]||(W[0]=V=>p.value=V),type:"text",placeholder:"Buscar plantillas...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent"},null,512),[[Ee,p.value]])]),n(t(Be),{as:"div",class:"relative"},{default:j(()=>[n(t(Re),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[n(t(rt),{class:"h-4 w-4"}),e("span",hd,g(z.value||"Etiqueta"),1),n(t(Ve),{class:"h-4 w-4"})]),_:1}),n(t(ze),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",fd,[e("div",yd,[n(t(Ze),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),De(e("input",{"onUpdate:modelValue":W[1]||(W[1]=V=>f.value=V),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:W[2]||(W[2]=me(()=>{},["stop"]))},null,512),[[Ee,f.value]])]),e("div",vd,[n(t(ye),null,{default:j(({active:V})=>[e("a",{onClick:W[3]||(W[3]=G=>F.value=null),class:P([V?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),r(pe,null,he(A.value,V=>(s(),le(t(ye),{key:V.id},{default:j(({active:G})=>[e("a",{onClick:be=>F.value=V.id,class:P([G?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:P(["w-3 h-3 rounded-full flex-shrink-0",U(V)])},null,2),e("span",xd,g(V.name),1)],10,bd)]),_:2},1024))),128)),A.value.length===0?(s(),r("div",_d," No se encontraron etiquetas ")):h("",!0)])])]),_:1})]),_:1}),F.value?(s(),r("button",{key:0,onClick:H,class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[n(t(je),{class:"h-4 w-4"}),re(" Limpiar ")])):h("",!0)]),e("div",wd,[e("span",$d," Mostrando "+g(k.value.length)+" plantillas ",1),n(t(Be),{as:"div",class:"relative"},{default:j(()=>[n(t(Re),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[re(" Ordenar: "+g(I.value)+" ",1),n(t(Ve),{class:"h-4 w-4"})]),_:1}),n(t(ze),{class:"absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",kd,[n(t(ye),null,{default:j(({active:V})=>[e("a",{onClick:W[4]||(W[4]=G=>v.value="recent"),class:P([V?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),n(t(ye),null,{default:j(({active:V})=>[e("a",{onClick:W[5]||(W[5]=G=>v.value="name"),class:P([V?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),k.value.length>0?(s(),r("div",Cd,[e("div",{class:"overflow-x-auto",style:We({minHeight:L()})},[e("table",Dd,[Sd,e("tbody",Fd,[(s(!0),r(pe,null,he(k.value,(V,G)=>{var be;return s(),r("tr",{key:V.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:_e=>q(V)},[e("td",Td,[e("div",Ad,[e("div",jd,[e("div",Md,[n(t(qe),{class:"h-5 w-5 text-purple-600"})])]),e("div",Pd,[e("div",Ld,g(V.title),1)])])]),Bd,e("td",Rd,[e("div",zd,[(s(!0),r(pe,null,he((be=V.tags)==null?void 0:be.slice(0,2),_e=>(s(),r("span",{key:_e.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",E(_e)])},g(_e.name),3))),128)),V.tags&&V.tags.length>2?(s(),r("span",Id," +"+g(V.tags.length-2),1)):h("",!0),!V.tags||V.tags.length===0?(s(),r("span",Ud,"-")):h("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:W[6]||(W[6]=me(()=>{},["stop"]))},[n(t(Be),{as:"div",class:"relative inline-block text-left"},{default:j(({open:_e})=>[n(t(Re),{ref_for:!0,ref:xe=>R(xe,G),onClick:xe=>ve(G,_e),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:j(()=>[n(t(dt),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),n(t(ze),{ref_for:!0,ref:xe=>te(xe,G),class:P([k.value.length>2&&G>0&&G>=k.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:j(()=>[e("div",Nd,[n(t(ye),null,{default:j(({active:xe})=>[e("a",{onClick:Ie=>q(V),class:P([xe?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Usar plantilla ",10,Od)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,Ed)}),128))])])],4)])):(s(),r("div",qd,[n(t(Lt),{class:"mx-auto h-12 w-12 text-gray-400"}),Vd,e("p",Qd,g($.value),1),Wd])),De(n(Je,null,{default:j(()=>[X.value!==null?(s(),le(hs,{key:0,"document-id":X.value,onClose:J},null,8,["document-id"])):h("",!0)]),_:1},512),[[yt,C.value]])]))}},Hd={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},Gd={class:"mb-4"},Zd={class:"relative w-full"},Jd={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},Kd={class:"flex items-center gap-2 min-w-0"},Yd={class:"truncate"},Xd={class:"py-1"},ec=["onClick"],tc={class:"flex items-center justify-stretch"},sc=e("span",null,"Limpiar",-1),oc={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},ac={class:"flex flex-col gap-1"},rc=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),nc={class:"flex flex-col gap-1"},lc=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),ic={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},dc={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},cc={class:"flex items-center gap-2"},uc=e("span",{class:"hidden sm:inline"},"Exportar",-1),mc={class:"py-1"},gc=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),pc={class:"py-1"},hc={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},fc={class:"overflow-x-auto",style:{"overflow-y":"visible"}},yc={class:"min-w-full divide-y divide-gray-200"},vc={class:"bg-gray-50"},bc={scope:"col",class:"w-12 px-6 py-3"},xc=["checked"],_c=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),wc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),$c=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),kc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Docs. Asociados ",-1),Cc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),Dc={class:"bg-white divide-y divide-gray-200"},Sc=["onClick"],Fc=["checked","onChange"],Ec={class:"px-6 py-4 whitespace-nowrap"},Tc={class:"flex items-center"},Ac={class:"flex-shrink-0 h-10 w-10"},jc={class:"h-10 w-10 rounded-lg bg-green-100 flex items-center justify-center"},Mc={class:"ml-4"},Pc={class:"text-sm font-medium text-gray-900"},Lc={class:"px-6 py-4 whitespace-nowrap"},Bc={class:"text-sm text-gray-900"},Rc=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-700 border border-green-200"}," Completado ")],-1),zc={class:"px-6 py-4 whitespace-nowrap"},Ic=["onClick"],Uc={class:"px-6 py-4 whitespace-nowrap"},Nc={class:"flex flex-wrap gap-1"},Oc={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},qc={key:1,class:"text-sm text-gray-400"},Vc={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Qc={class:"flex flex-1 justify-between sm:hidden"},Wc=["disabled"],Hc=["disabled"],Gc={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Zc={class:"text-sm text-gray-700"},Jc={class:"font-medium"},Kc={class:"font-medium"},Yc={class:"font-medium"},Xc={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},eu=["disabled"],tu=e("span",{class:"sr-only"},"Anterior",-1),su=["onClick"],ou={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},au=["disabled"],ru=e("span",{class:"sr-only"},"Siguiente",-1),nu={key:0,class:"text-center py-12"},lu=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos completados",-1),iu=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos completados por clientes aparecerán aquí.",-1),du={__name:"DocumentFinishedByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(o,{emit:w}){const i=Qe(),c=Ke(),D=st(),p=o,f=w,{activeModals:F,openModal:v,closeModal:C,getUserRole:X}=jt(i,c),{handlePreviewDocument:ee,deleteDocument:Y,downloadPDFDocument:O,downloadWordDocument:ne}=Mt(i,c,f),Z=b(""),k=b(null),d=b(""),A=b(""),z=b("recent"),I=b([]),$=b(1),E=b(10);He(()=>{i.init(),c.init()});const U=B(()=>{const x=i.completedDocumentsByClient,l=p.selectedTags?p.selectedTags.map(T=>T.id):[];return i.filteredDocumentsBySearchAndTags(p.searchQuery,c,l).filter(T=>x.some(ce=>ce.id===T.id))}),H=B(()=>{let x=[...U.value];const l=Z.value.toLowerCase();return l&&(x=x.filter(a=>{var T,ce;return((T=a.title)==null?void 0:T.toLowerCase().includes(l))||((ce=a.tags)==null?void 0:ce.some(M=>{var Te;return(Te=M.name)==null?void 0:Te.toLowerCase().includes(l)}))})),k.value&&(x=x.filter(a=>a.tags&&a.tags.some(T=>T.id===k.value))),(d.value||A.value)&&(x=x.filter(a=>{const T=a.summary_subscription_date||a.created_at||a.updated_at;if(!T)return!1;const ce=new Date(T);if(isNaN(ce.getTime()))return!1;if(d.value){const M=new Date(d.value);if(ce<M)return!1}if(A.value){const M=new Date(A.value);if(M.setHours(23,59,59,999),ce>M)return!1}return!0})),z.value==="name"?x.sort((a,T)=>{const ce=(a.title||"").toLowerCase(),M=(T.title||"").toLowerCase();return ce.localeCompare(M)}):z.value==="recent"&&x.sort((a,T)=>{const ce=new Date(a.updated_at||a.created_at);return new Date(T.updated_at||T.created_at)-ce}),x}),de=B(()=>{const x=($.value-1)*E.value,l=x+E.value;return H.value.slice(x,l)}),J=B(()=>Math.ceil(H.value.length/E.value)),q=B(()=>{const x=($.value-1)*E.value+1,l=Math.min($.value*E.value,H.value.length);return{start:x,end:l,total:H.value.length}});we([Z,k,d,A],()=>{$.value=1});const K=B(()=>{const x=new Map;return U.value.forEach(l=>{l.tags&&l.tags.length>0&&l.tags.forEach(a=>{x.has(a.id)||x.set(a.id,a)})}),Array.from(x.values()).sort((l,a)=>l.name.localeCompare(a.name))}),L=B(()=>{if(!k.value)return null;const x=K.value.find(l=>l.id===k.value);return x?x.name:null}),R=B(()=>{switch(z.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),te=x=>x.summary_counterparty?x.summary_counterparty:"Cliente",ve=x=>{const l=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],a=x.id%l.length;return l[a]},N=B(()=>H.value.length>0&&I.value.length===H.value.length),W=()=>{N.value?I.value=[]:I.value=H.value.map(x=>x.id)},V=x=>{const l=I.value.indexOf(x);l>-1?I.value.splice(l,1):I.value.push(x)},G=()=>{I.value=H.value.map(x=>x.id)},be=()=>{I.value=[]},_e=()=>{k.value=null,d.value="",A.value=""},xe=()=>{$.value>1&&$.value--},Ie=()=>{$.value<J.value&&$.value++},Ue=x=>{x>=1&&x<=J.value&&($.value=x)},Ne=B(()=>{const x=J.value,l=$.value,a=[];if(x<=7)for(let T=1;T<=x;T++)a.push(T);else if(l<=4){for(let T=1;T<=5;T++)a.push(T);a.push("..."),a.push(x)}else if(l>=x-3){a.push(1),a.push("...");for(let T=x-4;T<=x;T++)a.push(T)}else a.push(1),a.push("..."),a.push(l-1),a.push(l),a.push(l+1),a.push("..."),a.push(x);return a}),se=()=>{const x=I.value.length>0?H.value.filter(Fe=>I.value.includes(Fe.id)):H.value,l=["Nombre Documento","Cliente","Estado","Etiquetas"],a=x.map(Fe=>[Fe.title||"",te(Fe),"Completado",Fe.tags?Fe.tags.map(Oe=>Oe.name).join(", "):""]),T=[l.join(","),...a.map(Fe=>Fe.map(Oe=>`"${Oe}"`).join(","))].join(`
`),ce=new Blob([T],{type:"text/csv;charset=utf-8;"}),M=document.createElement("a"),Te=URL.createObjectURL(ce);M.setAttribute("href",Te),M.setAttribute("download",`documentos_completados_${new Date().toISOString().split("T")[0]}.csv`),M.style.visibility="hidden",document.body.appendChild(M),M.click(),document.body.removeChild(M)},ie=async(x,l)=>{try{switch(x){case"editForm":v("edit",l,{userRole:X()});break;case"editDocument":D.push(`/dynamic_document_dashboard/client/editor/edit/${l.id}`);break;case"preview":await ee(l);break;case"delete":await Y(l);break;case"letterhead":v("letterhead",l);break;case"relationships":v("relationships",l);break;case"downloadPDF":await O(l);break;case"downloadWord":await ne(l);break;case"email":v("email",l);break;default:console.warn("Unknown action:",x)}}catch(a){console.error(`Error executing action ${x}:`,a)}},ue=b(!1),Se=b(null),Ae=x=>{Se.value=x,ue.value=!0},Pe=async(x,l)=>{ue.value=!1,await ie(x,l)};return(x,l)=>(s(),r("div",null,[e("div",Hd,[e("div",Gd,[e("div",Zd,[n(t(Ze),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),De(e("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>Z.value=a),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Ee,Z.value]])])]),e("div",Jd,[n(t(Be),{as:"div",class:"relative"},{default:j(()=>[n(t(Re),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[e("div",Kd,[n(t(rt),{class:"h-4 w-4 flex-shrink-0"}),e("span",Yd,g(L.value||"Etiqueta"),1)]),n(t(Ve),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),n(t(ze),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:j(()=>[e("div",Xd,[n(t(ye),null,{default:j(({active:a})=>[e("a",{onClick:l[1]||(l[1]=T=>k.value=null),class:P([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),r(pe,null,he(K.value,a=>(s(),le(t(ye),{key:a.id},{default:j(({active:T})=>[e("a",{onClick:ce=>k.value=a.id,class:P([T?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},g(a.name),11,ec)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",tc,[k.value||d.value||A.value?(s(),r("button",{key:0,onClick:_e,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[n(t(je),{class:"h-4 w-4 flex-shrink-0"}),sc])):h("",!0)])]),e("div",oc,[e("div",ac,[rc,De(e("input",{"onUpdate:modelValue":l[2]||(l[2]=a=>d.value=a),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Ee,d.value]])]),e("div",nc,[lc,De(e("input",{"onUpdate:modelValue":l[3]||(l[3]=a=>A.value=a),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Ee,A.value]])])]),e("div",ic,[e("div",dc,[e("div",cc,[e("button",{onClick:se,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[n(t(nt),{class:"h-4 w-4"}),uc]),n(t(Be),{as:"div",class:"relative"},{default:j(()=>[n(t(Re),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:j(()=>[n(t(dt),{class:"h-5 w-5 text-gray-500"})]),_:1}),n(t(ze),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",mc,[n(t(ye),null,{default:j(({active:a})=>[e("a",{onClick:G,class:P([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),n(t(ye),null,{default:j(({active:a})=>[e("a",{onClick:be,class:P([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),n(t(Be),{as:"div",class:"relative"},{default:j(()=>[n(t(Re),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[gc,re(" "+g(R.value)+" ",1),n(t(Ve),{class:"h-4 w-4"})]),_:1}),n(t(ze),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",pc,[n(t(ye),null,{default:j(({active:a})=>[e("a",{onClick:l[4]||(l[4]=T=>z.value="recent"),class:P([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),n(t(ye),null,{default:j(({active:a})=>[e("a",{onClick:l[5]||(l[5]=T=>z.value="name"),class:P([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",hc,[e("div",fc,[e("table",yc,[e("thead",vc,[e("tr",null,[e("th",bc,[e("input",{type:"checkbox",checked:N.value,onChange:W,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,xc)]),_c,wc,$c,kc,Cc])]),e("tbody",Dc,[(s(!0),r(pe,null,he(de.value,(a,T)=>{var ce;return s(),r("tr",{key:a.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:M=>Ae(a)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:l[6]||(l[6]=me(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:I.value.includes(a.id),onChange:M=>V(a.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Fc)]),e("td",Ec,[e("div",Tc,[e("div",Ac,[e("div",jc,[n(t(qe),{class:"h-5 w-5 text-green-600"})])]),e("div",Mc,[e("div",Pc,g(a.title),1)])])]),e("td",Lc,[e("div",Bc,g(te(a)),1)]),Rc,e("td",zc,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100",onClick:me(M=>t(v)("relationships",a),["stop"])}," Ver asociaciones ",8,Ic)]),e("td",Uc,[e("div",Nc,[(s(!0),r(pe,null,he((ce=a.tags)==null?void 0:ce.slice(0,2),M=>(s(),r("span",{key:M.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ve(M)])},g(M.name),3))),128)),a.tags&&a.tags.length>2?(s(),r("span",Oc," +"+g(a.tags.length-2),1)):h("",!0),!a.tags||a.tags.length===0?(s(),r("span",qc,"-")):h("",!0)])])],8,Sc)}),128))])])]),J.value>1?(s(),r("div",Vc,[e("div",Qc,[e("button",{onClick:xe,disabled:$.value===1,class:P(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",$.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,Wc),e("button",{onClick:Ie,disabled:$.value===J.value,class:P(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",$.value===J.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Hc)]),e("div",Gc,[e("div",null,[e("p",Zc,[re(" Mostrando "),e("span",Jc,g(q.value.start),1),re(" a "),e("span",Kc,g(q.value.end),1),re(" de "),e("span",Yc,g(q.value.total),1),re(" resultados ")])]),e("div",null,[e("nav",Xc,[e("button",{onClick:xe,disabled:$.value===1,class:P(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",$.value===1?"opacity-50 cursor-not-allowed":""])},[tu,n(t(Et),{class:"h-5 w-5","aria-hidden":"true"})],10,eu),(s(!0),r(pe,null,he(Ne.value,a=>(s(),r(pe,{key:a},[a!=="..."?(s(),r("button",{key:0,onClick:T=>Ue(a),class:P(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",$.value===a?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},g(a),11,su)):(s(),r("span",ou," ... "))],64))),128)),e("button",{onClick:Ie,disabled:$.value===J.value,class:P(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",$.value===J.value?"opacity-50 cursor-not-allowed":""])},[ru,n(t(vt),{class:"h-5 w-5","aria-hidden":"true"})],10,au)])])])])):h("",!0)]),H.value.length===0?(s(),r("div",nu,[n(t(Lt),{class:"mx-auto h-12 w-12 text-gray-400"}),lu,iu])):h("",!0),(s(),le(Qt,{to:"body"},[t(F).edit.isOpen?(s(),le(t(Gt),{key:0,document:t(F).edit.document,"user-role":t(X)(),onClose:l[7]||(l[7]=a=>t(C)("edit")),onRefresh:l[8]||(l[8]=a=>f("refresh"))},null,8,["document","user-role"])):h("",!0),t(F).email.isOpen?(s(),le(t(Zt),{key:1,document:t(F).email.document,onClose:l[9]||(l[9]=a=>t(C)("email"))},null,8,["document"])):h("",!0),t(F).letterhead.isOpen?(s(),le(Pt,{key:2,"is-visible":t(F).letterhead.isOpen,document:t(F).letterhead.document,onClose:l[10]||(l[10]=a=>t(C)("letterhead")),onUploaded:l[11]||(l[11]=a=>f("refresh")),onDeleted:l[12]||(l[12]=a=>f("refresh"))},null,8,["is-visible","document"])):h("",!0),t(F).relationships.isOpen?(s(),le(Tt,{key:3,"is-open":t(F).relationships.isOpen,document:t(F).relationships.document,onClose:l[13]||(l[13]=a=>t(C)("relationships")),onRefresh:l[14]||(l[14]=a=>f("refresh"))},null,8,["is-open","document"])):h("",!0),ue.value?(s(),le(Bt,{key:4,"is-visible":ue.value,document:Se.value,"card-type":"client",context:"table","user-store":t(c),onClose:l[15]||(l[15]=a=>ue.value=!1),onAction:Pe},null,8,["is-visible","document","user-store"])):h("",!0)]))]))}},cu={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},uu={class:"mb-4"},mu={class:"relative w-full"},gu={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},pu={class:"flex items-center gap-2 min-w-0"},hu={class:"truncate"},fu={class:"py-1"},yu=["onClick"],vu={class:"flex items-center justify-stretch"},bu=e("span",null,"Limpiar",-1),xu={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},_u={class:"flex flex-col gap-1"},wu=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),$u={class:"flex flex-col gap-1"},ku=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),Cu={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},Du={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Su={class:"flex items-center gap-2"},Fu=e("span",{class:"hidden sm:inline"},"Exportar",-1),Eu={class:"py-1"},Tu=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),Au={class:"py-1"},ju={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Mu={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Pu={class:"min-w-full divide-y divide-gray-200"},Lu={class:"bg-gray-50"},Bu={scope:"col",class:"w-12 px-6 py-3"},Ru=["checked"],zu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Iu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),Uu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),Nu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Docs. Asociados ",-1),Ou=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),qu={class:"bg-white divide-y divide-gray-200"},Vu=["onClick"],Qu=["checked","onChange"],Wu={class:"px-6 py-4 whitespace-nowrap"},Hu={class:"flex items-center"},Gu={class:"flex-shrink-0 h-10 w-10"},Zu={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Ju={class:"ml-4"},Ku={class:"text-sm font-medium text-gray-900"},Yu={class:"px-6 py-4 whitespace-nowrap"},Xu={class:"text-sm text-gray-900"},em=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-700 border border-blue-200"}," En Progreso ")],-1),tm={class:"px-6 py-4 whitespace-nowrap"},sm=["onClick"],om={class:"px-6 py-4 whitespace-nowrap"},am={class:"flex flex-wrap gap-1"},rm={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},nm={key:1,class:"text-sm text-gray-400"},lm={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},im={class:"flex flex-1 justify-between sm:hidden"},dm=["disabled"],cm=["disabled"],um={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},mm={class:"text-sm text-gray-700"},gm={class:"font-medium"},pm={class:"font-medium"},hm={class:"font-medium"},fm={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},ym=["disabled"],vm=e("span",{class:"sr-only"},"Anterior",-1),bm=["onClick"],xm={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},_m=["disabled"],wm=e("span",{class:"sr-only"},"Siguiente",-1),$m={key:0,class:"text-center py-12"},km=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos en progreso",-1),Cm=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos en progreso por clientes aparecerán aquí.",-1),Dm={__name:"DocumentInProgressByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(o,{emit:w}){const i=Qe(),c=Ke(),D=st(),p=o,f=w,{activeModals:F,openModal:v,closeModal:C,getUserRole:X}=jt(i,c),{handlePreviewDocument:ee,deleteDocument:Y,downloadPDFDocument:O,downloadWordDocument:ne}=Mt(i,c,f),Z=b(""),k=b(null),d=b(""),A=b(""),z=b("recent"),I=b([]),$=b(1),E=b(10);He(()=>{i.init(),c.init()});const U=B(()=>{const x=i.progressDocumentsByClient,l=p.selectedTags?p.selectedTags.map(T=>T.id):[];return i.filteredDocumentsBySearchAndTags(p.searchQuery,c,l).filter(T=>x.some(ce=>ce.id===T.id))}),H=B(()=>{let x=[...U.value];const l=Z.value.toLowerCase();return l&&(x=x.filter(a=>{var T,ce;return((T=a.title)==null?void 0:T.toLowerCase().includes(l))||((ce=a.tags)==null?void 0:ce.some(M=>{var Te;return(Te=M.name)==null?void 0:Te.toLowerCase().includes(l)}))})),k.value&&(x=x.filter(a=>a.tags&&a.tags.some(T=>T.id===k.value))),(d.value||A.value)&&(x=x.filter(a=>{const T=a.summary_subscription_date||a.created_at||a.updated_at;if(!T)return!1;const ce=new Date(T);if(isNaN(ce.getTime()))return!1;if(d.value){const M=new Date(d.value);if(ce<M)return!1}if(A.value){const M=new Date(A.value);if(M.setHours(23,59,59,999),ce>M)return!1}return!0})),z.value==="name"?x.sort((a,T)=>{const ce=(a.title||"").toLowerCase(),M=(T.title||"").toLowerCase();return ce.localeCompare(M)}):z.value==="recent"&&x.sort((a,T)=>{const ce=new Date(a.updated_at||a.created_at);return new Date(T.updated_at||T.created_at)-ce}),x}),de=B(()=>{const x=($.value-1)*E.value,l=x+E.value;return H.value.slice(x,l)}),J=B(()=>Math.ceil(H.value.length/E.value)),q=B(()=>{const x=($.value-1)*E.value+1,l=Math.min($.value*E.value,H.value.length);return{start:x,end:l,total:H.value.length}});we([Z,k,d,A],()=>{$.value=1});const K=B(()=>{const x=new Map;return U.value.forEach(l=>{l.tags&&l.tags.length>0&&l.tags.forEach(a=>{x.has(a.id)||x.set(a.id,a)})}),Array.from(x.values()).sort((l,a)=>l.name.localeCompare(a.name))}),L=B(()=>{if(!k.value)return null;const x=K.value.find(l=>l.id===k.value);return x?x.name:null}),R=B(()=>{switch(z.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),te=x=>x.summary_counterparty?x.summary_counterparty:"Cliente",ve=x=>{const l=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],a=x.id%l.length;return l[a]},N=B(()=>H.value.length>0&&I.value.length===H.value.length),W=()=>{N.value?I.value=[]:I.value=H.value.map(x=>x.id)},V=x=>{const l=I.value.indexOf(x);l>-1?I.value.splice(l,1):I.value.push(x)},G=()=>{I.value=H.value.map(x=>x.id)},be=()=>{I.value=[]},_e=()=>{k.value=null,d.value="",A.value=""},xe=()=>{$.value>1&&$.value--},Ie=()=>{$.value<J.value&&$.value++},Ue=x=>{x>=1&&x<=J.value&&($.value=x)},Ne=B(()=>{const x=J.value,l=$.value,a=[];if(x<=7)for(let T=1;T<=x;T++)a.push(T);else if(l<=4){for(let T=1;T<=5;T++)a.push(T);a.push("..."),a.push(x)}else if(l>=x-3){a.push(1),a.push("...");for(let T=x-4;T<=x;T++)a.push(T)}else a.push(1),a.push("..."),a.push(l-1),a.push(l),a.push(l+1),a.push("..."),a.push(x);return a}),se=()=>{const x=I.value.length>0?H.value.filter(Fe=>I.value.includes(Fe.id)):H.value,l=["Nombre Documento","Cliente","Estado","Etiquetas"],a=x.map(Fe=>[Fe.title||"",te(Fe),"En Progreso",Fe.tags?Fe.tags.map(Oe=>Oe.name).join(", "):""]),T=[l.join(","),...a.map(Fe=>Fe.map(Oe=>`"${Oe}"`).join(","))].join(`
`),ce=new Blob([T],{type:"text/csv;charset=utf-8;"}),M=document.createElement("a"),Te=URL.createObjectURL(ce);M.setAttribute("href",Te),M.setAttribute("download",`documentos_en_progreso_${new Date().toISOString().split("T")[0]}.csv`),M.style.visibility="hidden",document.body.appendChild(M),M.click(),document.body.removeChild(M)},ie=async(x,l)=>{try{switch(x){case"editForm":v("edit",l,{userRole:X()});break;case"editDocument":D.push(`/dynamic_document_dashboard/client/editor/edit/${l.id}`);break;case"preview":await ee(l);break;case"delete":await Y(l);break;case"letterhead":v("letterhead",l);break;case"relationships":v("relationships",l);break;case"downloadPDF":await O(l);break;case"downloadWord":await ne(l);break;case"email":v("email",l);break;default:console.warn("Unknown action:",x)}}catch(a){console.error(`Error executing action ${x}:`,a)}},ue=b(!1),Se=b(null),Ae=x=>{Se.value=x,ue.value=!0},Pe=async(x,l)=>{ue.value=!1,await ie(x,l)};return(x,l)=>(s(),r("div",null,[e("div",cu,[e("div",uu,[e("div",mu,[n(t(Ze),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),De(e("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>Z.value=a),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Ee,Z.value]])])]),e("div",gu,[n(t(Be),{as:"div",class:"relative"},{default:j(()=>[n(t(Re),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[e("div",pu,[n(t(rt),{class:"h-4 w-4 flex-shrink-0"}),e("span",hu,g(L.value||"Etiqueta"),1)]),n(t(Ve),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),n(t(ze),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:j(()=>[e("div",fu,[n(t(ye),null,{default:j(({active:a})=>[e("a",{onClick:l[1]||(l[1]=T=>k.value=null),class:P([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),r(pe,null,he(K.value,a=>(s(),le(t(ye),{key:a.id},{default:j(({active:T})=>[e("a",{onClick:ce=>k.value=a.id,class:P([T?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},g(a.name),11,yu)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",vu,[k.value||d.value||A.value?(s(),r("button",{key:0,onClick:_e,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[n(t(je),{class:"h-4 w-4 flex-shrink-0"}),bu])):h("",!0)])]),e("div",xu,[e("div",_u,[wu,De(e("input",{"onUpdate:modelValue":l[2]||(l[2]=a=>d.value=a),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Ee,d.value]])]),e("div",$u,[ku,De(e("input",{"onUpdate:modelValue":l[3]||(l[3]=a=>A.value=a),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Ee,A.value]])])]),e("div",Cu,[e("div",Du,[e("div",Su,[e("button",{onClick:se,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[n(t(nt),{class:"h-4 w-4"}),Fu]),n(t(Be),{as:"div",class:"relative"},{default:j(()=>[n(t(Re),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:j(()=>[n(t(dt),{class:"h-5 w-5 text-gray-500"})]),_:1}),n(t(ze),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",Eu,[n(t(ye),null,{default:j(({active:a})=>[e("a",{onClick:G,class:P([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),n(t(ye),null,{default:j(({active:a})=>[e("a",{onClick:be,class:P([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),n(t(Be),{as:"div",class:"relative"},{default:j(()=>[n(t(Re),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[Tu,re(" "+g(R.value)+" ",1),n(t(Ve),{class:"h-4 w-4"})]),_:1}),n(t(ze),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",Au,[n(t(ye),null,{default:j(({active:a})=>[e("a",{onClick:l[4]||(l[4]=T=>z.value="recent"),class:P([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),n(t(ye),null,{default:j(({active:a})=>[e("a",{onClick:l[5]||(l[5]=T=>z.value="name"),class:P([a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",ju,[e("div",Mu,[e("table",Pu,[e("thead",Lu,[e("tr",null,[e("th",Bu,[e("input",{type:"checkbox",checked:N.value,onChange:W,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Ru)]),zu,Iu,Uu,Nu,Ou])]),e("tbody",qu,[(s(!0),r(pe,null,he(de.value,(a,T)=>{var ce;return s(),r("tr",{key:a.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:M=>Ae(a)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:l[6]||(l[6]=me(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:I.value.includes(a.id),onChange:M=>V(a.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Qu)]),e("td",Wu,[e("div",Hu,[e("div",Gu,[e("div",Zu,[n(t(qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",Ju,[e("div",Ku,g(a.title),1)])])]),e("td",Yu,[e("div",Xu,g(te(a)),1)]),em,e("td",tm,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100",onClick:me(M=>t(v)("relationships",a),["stop"])}," Ver asociaciones ",8,sm)]),e("td",om,[e("div",am,[(s(!0),r(pe,null,he((ce=a.tags)==null?void 0:ce.slice(0,2),M=>(s(),r("span",{key:M.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ve(M)])},g(M.name),3))),128)),a.tags&&a.tags.length>2?(s(),r("span",rm," +"+g(a.tags.length-2),1)):h("",!0),!a.tags||a.tags.length===0?(s(),r("span",nm,"-")):h("",!0)])])],8,Vu)}),128))])])]),J.value>1?(s(),r("div",lm,[e("div",im,[e("button",{onClick:xe,disabled:$.value===1,class:P(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",$.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,dm),e("button",{onClick:Ie,disabled:$.value===J.value,class:P(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",$.value===J.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,cm)]),e("div",um,[e("div",null,[e("p",mm,[re(" Mostrando "),e("span",gm,g(q.value.start),1),re(" a "),e("span",pm,g(q.value.end),1),re(" de "),e("span",hm,g(q.value.total),1),re(" resultados ")])]),e("div",null,[e("nav",fm,[e("button",{onClick:xe,disabled:$.value===1,class:P(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",$.value===1?"opacity-50 cursor-not-allowed":""])},[vm,n(t(Et),{class:"h-5 w-5","aria-hidden":"true"})],10,ym),(s(!0),r(pe,null,he(Ne.value,a=>(s(),r(pe,{key:a},[a!=="..."?(s(),r("button",{key:0,onClick:T=>Ue(a),class:P(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",$.value===a?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},g(a),11,bm)):(s(),r("span",xm," ... "))],64))),128)),e("button",{onClick:Ie,disabled:$.value===J.value,class:P(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",$.value===J.value?"opacity-50 cursor-not-allowed":""])},[wm,n(t(vt),{class:"h-5 w-5","aria-hidden":"true"})],10,_m)])])])])):h("",!0)]),H.value.length===0?(s(),r("div",$m,[n(t(Lt),{class:"mx-auto h-12 w-12 text-gray-400"}),km,Cm])):h("",!0),(s(),le(Qt,{to:"body"},[t(F).edit.isOpen?(s(),le(t(Gt),{key:0,document:t(F).edit.document,"user-role":t(X)(),onClose:l[7]||(l[7]=a=>t(C)("edit")),onRefresh:l[8]||(l[8]=a=>f("refresh"))},null,8,["document","user-role"])):h("",!0),t(F).email.isOpen?(s(),le(t(Zt),{key:1,document:t(F).email.document,onClose:l[9]||(l[9]=a=>t(C)("email"))},null,8,["document"])):h("",!0),t(F).letterhead.isOpen?(s(),le(Pt,{key:2,"is-visible":t(F).letterhead.isOpen,document:t(F).letterhead.document,onClose:l[10]||(l[10]=a=>t(C)("letterhead")),onUploaded:l[11]||(l[11]=a=>f("refresh")),onDeleted:l[12]||(l[12]=a=>f("refresh"))},null,8,["is-visible","document"])):h("",!0),t(F).relationships.isOpen?(s(),le(Tt,{key:3,"is-open":t(F).relationships.isOpen,document:t(F).relationships.document,onClose:l[13]||(l[13]=a=>t(C)("relationships")),onRefresh:l[14]||(l[14]=a=>f("refresh"))},null,8,["is-open","document"])):h("",!0),ue.value?(s(),le(Bt,{key:4,"is-visible":ue.value,document:Se.value,"card-type":"client",context:"table","user-store":t(c),onClose:l[15]||(l[15]=a=>ue.value=!1),onAction:Pe},null,8,["is-visible","document","user-store"])):h("",!0)]))]))}},Sm={class:"bg-white rounded-xl shadow-xl max-w-lg w-full mx-4"},Fm={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},Em=e("h2",{class:"text-sm font-semibold text-gray-900"}," Información clave del documento ",-1),Tm=e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.8",d:"M6 6l8 8M6 14L14 6"})],-1),Am=[Tm],jm={class:"px-4 py-4 space-y-4 text-sm text-gray-800 max-h-[70vh] overflow-y-auto"},Mm={key:0},Pm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Usuario / Contraparte ",-1),Lm={class:"text-gray-900 break-words"},Bm={key:1},Rm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Objeto ",-1),zm={class:"text-gray-900 whitespace-pre-line"},Im={key:2},Um=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Valor ",-1),Nm={class:"text-gray-900 font-medium text-base"},Om={key:3},qm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Plazo ",-1),Vm={class:"text-gray-900"},Qm={key:4},Wm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Fechas ",-1),Hm={class:"space-y-1 text-gray-900"},Gm={key:0},Zm=e("span",{class:"font-medium"},"Suscripción:",-1),Jm={class:"ml-1"},Km={key:1},Ym=e("span",{class:"font-medium"},"Vigencia:",-1),Xm={class:"ml-1"},eg={key:0},tg={key:1},sg={key:2},og={key:5,class:"text-gray-400 text-sm"},ag={class:"px-4 py-3 border-t border-gray-100 flex justify-end"},rg={__name:"DocumentSummaryModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close"],setup(o,{emit:w}){const i=o,c=B(()=>i.document&&i.document.summary_counterparty||""),D=B(()=>i.document?Kt(i.document):""),p=B(()=>i.document?!!(i.document.summary_subscription_date||i.document.summary_start_date||i.document.summary_end_date):!1),f=B(()=>i.document?!!(c.value||i.document.summary_object||D.value||i.document.summary_term||p.value):!1),F=v=>v?typeof v=="string"?v.split("T")[0]:v:"";return(v,C)=>o.isVisible&&o.document?(s(),r("div",{key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",onClick:C[2]||(C[2]=me(X=>v.$emit("close"),["self"]))},[e("div",Sm,[e("div",Fm,[Em,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:C[0]||(C[0]=X=>v.$emit("close"))},Am)]),e("div",jm,[c.value?(s(),r("div",Mm,[Pm,e("div",Lm,g(c.value),1)])):h("",!0),o.document.summary_object?(s(),r("div",Bm,[Rm,e("div",zm,g(o.document.summary_object),1)])):h("",!0),D.value?(s(),r("div",Im,[Um,e("div",Nm,g(D.value),1)])):h("",!0),o.document.summary_term?(s(),r("div",Om,[qm,e("div",Vm,g(o.document.summary_term),1)])):h("",!0),p.value?(s(),r("div",Qm,[Wm,e("div",Hm,[o.document.summary_subscription_date?(s(),r("div",Gm,[Zm,e("span",Jm,g(F(o.document.summary_subscription_date)),1)])):h("",!0),o.document.summary_start_date||o.document.summary_end_date?(s(),r("div",Km,[Ym,e("span",Xm,[o.document.summary_start_date?(s(),r("span",eg,g(F(o.document.summary_start_date)),1)):h("",!0),o.document.summary_start_date&&o.document.summary_end_date?(s(),r("span",tg," → ")):h("",!0),o.document.summary_end_date?(s(),r("span",sg,g(F(o.document.summary_end_date)),1)):h("",!0)])])):h("",!0)])])):h("",!0),f.value?h("",!0):(s(),r("div",og," Este documento aún no tiene campos clasificados para mostrar. "))]),e("div",ag,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-md text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200",onClick:C[1]||(C[1]=X=>v.$emit("close"))}," Cerrar ")])])])):h("",!0)}},ng={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},lg={class:"mb-4"},ig={class:"relative w-full"},dg={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},cg={class:"flex items-center gap-2 min-w-0"},ug={class:"truncate"},mg={class:"p-2"},gg={class:"relative mb-2"},pg={class:"max-h-60 overflow-y-auto"},hg=["onClick"],fg={class:"truncate"},yg={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},vg={class:"flex items-center justify-stretch"},bg=e("span",null,"Limpiar",-1),xg={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},_g={class:"flex flex-col gap-1"},wg=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),$g={class:"flex flex-col gap-1"},kg=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),Cg={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},Dg={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Sg={class:"flex items-center gap-2"},Fg=e("span",{class:"hidden sm:inline"},"Exportar",-1),Eg={class:"py-1"},Tg=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),Ag={class:"py-1"},jg={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Mg={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Pg={class:"min-w-full divide-y divide-gray-200"},Lg={class:"bg-gray-50"},Bg={scope:"col",class:"w-12 px-6 py-3"},Rg=["checked"],zg=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Ig=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado Firma ",-1),Ug=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Contraparte ",-1),Ng=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Objeto ",-1),Og=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Valor ",-1),qg=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plazo ",-1),Vg=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fechas ",-1),Qg={key:0,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Wg={key:1,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Hg=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),Gg={class:"bg-white divide-y divide-gray-200"},Zg=["onClick"],Jg=["checked","onChange"],Kg={class:"px-6 py-4 whitespace-nowrap"},Yg={class:"flex items-center"},Xg={class:"flex-shrink-0 h-10 w-10"},e0={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},t0={class:"ml-4"},s0={class:"text-sm font-medium text-gray-900"},o0={class:"px-6 py-4 whitespace-nowrap"},a0={class:"px-6 py-4 whitespace-nowrap"},r0={class:"text-sm text-gray-900"},n0={class:"px-6 py-4 whitespace-nowrap"},l0={class:"text-sm text-gray-900 line-clamp-2 max-w-xs"},i0={class:"px-6 py-4 whitespace-nowrap"},d0={class:"text-sm text-gray-900"},c0={class:"px-6 py-4 whitespace-nowrap"},u0={class:"text-sm text-gray-900"},m0={class:"px-6 py-4 whitespace-nowrap"},g0={class:"text-xs text-gray-900 space-y-0.5"},p0={key:0},h0=e("span",{class:"font-medium"},"Suscripción:",-1),f0={class:"ml-1"},y0={key:1},v0=e("span",{class:"font-medium"},"Vigencia:",-1),b0={class:"ml-1"},x0={key:0},_0={key:1},w0={key:2},$0={key:2,class:"text-gray-400"},k0={key:0,class:"px-6 py-4 whitespace-nowrap"},C0={key:0,class:"text-sm text-gray-900"},D0={key:1,class:"text-sm text-gray-400"},S0={key:1,class:"px-6 py-4 whitespace-nowrap"},F0=["disabled","onClick"],E0={key:0},T0={key:1},A0={class:"px-6 py-4 whitespace-nowrap"},j0={class:"flex flex-wrap gap-1"},M0={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},P0={key:1,class:"text-sm text-gray-400"},L0={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},B0={class:"flex flex-1 justify-between sm:hidden"},R0=["disabled"],z0=["disabled"],I0={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},U0={class:"text-sm text-gray-700"},N0={class:"font-medium"},O0={class:"font-medium"},q0={class:"font-medium"},V0={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Q0=["disabled"],W0=e("span",{class:"sr-only"},"Anterior",-1),H0=["onClick"],G0={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},Z0=["disabled"],J0=e("span",{class:"sr-only"},"Siguiente",-1),K0={key:0,class:"text-center py-12"},Y0={class:"mt-2 text-sm font-medium text-gray-900"},X0={class:"mt-1 text-sm text-gray-500"},ep={key:1,class:"text-center py-12"},tp=e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-secondary"},null,-1),sp=e("p",{class:"mt-2 text-sm text-gray-500"},"Cargando documentos...",-1),op=[tp,sp],ap={key:5,class:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40"},rp={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4"},np={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},lp=e("h2",{class:"text-sm font-semibold text-gray-900"},"Rechazar documento",-1),ip={class:"px-4 py-4 space-y-3 text-sm text-gray-700"},dp={class:"font-semibold"},cp=e("p",{class:"text-xs text-gray-500"}," El rechazo devolverá el documento al abogado creador para que pueda revisarlo, editarlo o archivarlo. ",-1),up=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Motivo del rechazo (opcional) ",-1),mp={key:6,class:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40"},gp={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4"},pp={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},hp=e("h2",{class:"text-sm font-semibold text-gray-900"},"Motivo del rechazo",-1),fp={class:"px-4 py-4 text-sm text-gray-700 whitespace-pre-line"},yp={class:"px-4 py-3 border-t border-gray-100 flex justify-end bg-gray-50"},it={__name:"SignaturesListTable",props:{state:{type:String,required:!0,validator:o=>["PendingSignatures","FullySigned","Archived"].includes(o)},searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","document-fully-signed","document-rejected","open-electronic-signature"],setup(o,{expose:w,emit:i}){const c=o,D=i,p=Ke(),f=Qe(),F=st(),{activeModals:v,openModal:C,closeModal:X,getUserRole:ee}=jt(f,p),{handlePreviewDocument:Y,downloadPDFDocument:O,signDocument:ne,downloadSignedDocument:Z}=Mt(f,p,D);b([]);const k=b(!1),d=b(""),A=b(""),z=b(null),I=b(""),$=b(""),E=b("recent"),U=b([]),H=b(!1),de=b(null),J=b(1),q=b(10),K=B(()=>c.state==="PendingSignatures"?"No tienes documentos pendientes por firmar":c.state==="FullySigned"?"No tienes documentos firmados":"No tienes documentos archivados"),L=B(()=>c.state==="PendingSignatures"?"Cuando tengas documentos que requieran tu firma electrónica aparecerán aquí.":c.state==="FullySigned"?"Una vez que firmes documentos electrónicamente, aparecerán aquí.":"Aquí aparecerán los documentos rechazados o expirados relacionados contigo."),R=B(()=>{const Q=p.currentUser.role,S=p.currentUser.id,oe=p.currentUser.email;let _=[];return Q==="lawyer"?c.state==="PendingSignatures"?_=f.pendingSignatureDocuments.filter(ge=>{var u;const fe=ge.created_by===S,ke=(u=ge.signatures)==null?void 0:u.some(m=>m.signer_email===oe);return fe||ke}):c.state==="FullySigned"?_=f.fullySignedDocuments.filter(ge=>{var u;const fe=ge.created_by===S,ke=(u=ge.signatures)==null?void 0:u.some(m=>m.signer_email===oe&&m.signed);return fe||ke}):c.state==="Archived"&&(_=f.documents.filter(ge=>{var u;if(ge.state!=="Rejected"&&ge.state!=="Expired")return!1;const fe=ge.created_by===S,ke=(u=ge.signatures)==null?void 0:u.some(m=>m.signer_email===oe);return fe||ke})):c.state==="PendingSignatures"?_=f.documents.filter(ge=>{var u;if(ge.state!=="PendingSignatures")return!1;const fe=(u=ge.signatures)==null?void 0:u.some(m=>m.signer_email===oe),ke=ge.created_by===S;return fe||ke}):c.state==="FullySigned"?_=f.documents.filter(ge=>{var u;if(ge.state!=="FullySigned")return!1;const fe=(u=ge.signatures)==null?void 0:u.some(m=>m.signer_email===oe&&m.signed),ke=ge.created_by===S;return fe||ke}):c.state==="Archived"&&(_=f.documents.filter(ge=>{var u;if(ge.state!=="Rejected"&&ge.state!=="Expired")return!1;const fe=(u=ge.signatures)==null?void 0:u.some(m=>m.signer_email===oe),ke=ge.created_by===S;return fe||ke})),_}),te=B(()=>{let Q=[...R.value];const S=d.value.toLowerCase();return S&&(Q=Q.filter(oe=>{var _,ge;return((_=oe.title)==null?void 0:_.toLowerCase().includes(S))||((ge=oe.tags)==null?void 0:ge.some(fe=>{var ke;return(ke=fe.name)==null?void 0:ke.toLowerCase().includes(S)}))})),z.value&&(Q=Q.filter(oe=>oe.tags&&oe.tags.some(_=>_.id===z.value))),(I.value||$.value)&&(Q=Q.filter(oe=>{const _=oe.summary_subscription_date||oe.created_at||oe.updated_at;if(!_)return!1;const ge=new Date(_);if(isNaN(ge.getTime()))return!1;if(I.value){const fe=new Date(I.value);if(ge<fe)return!1}if($.value){const fe=new Date($.value);if(fe.setHours(23,59,59,999),ge>fe)return!1}return!0})),E.value==="name"?Q.sort((oe,_)=>{const ge=(oe.title||"").toLowerCase(),fe=(_.title||"").toLowerCase();return ge.localeCompare(fe)}):E.value==="recent"&&Q.sort((oe,_)=>{const ge=new Date(oe.updated_at||oe.created_at);return new Date(_.updated_at||_.created_at)-ge}),Q}),ve=B(()=>{const Q=(J.value-1)*q.value,S=Q+q.value;return te.value.slice(Q,S)}),N=B(()=>Math.ceil(te.value.length/q.value)),W=B(()=>{const Q=(J.value-1)*q.value+1,S=Math.min(J.value*q.value,te.value.length);return{start:Q,end:S,total:te.value.length}});we([d,z,I,$],()=>{J.value=1});const V=B(()=>{const Q=new Map;return R.value.forEach(S=>{S.tags&&S.tags.length>0&&S.tags.forEach(oe=>{Q.has(oe.id)||Q.set(oe.id,oe)})}),Array.from(Q.values()).sort((S,oe)=>S.name.localeCompare(oe.name))}),G=B(()=>{if(!A.value)return V.value;const Q=A.value.toLowerCase();return V.value.filter(S=>S.name.toLowerCase().includes(Q))}),be=B(()=>{if(!z.value)return null;const Q=V.value.find(S=>S.id===z.value);return Q?Q.name:null}),_e=Q=>{const S=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],oe=Q.id%S.length;return S[oe]},xe=B(()=>{switch(E.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),Ie=Q=>{const S=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],oe=Q.id%S.length;return S[oe]},Ue=Q=>c.state==="FullySigned"?"bg-green-100 text-green-700 border border-green-200":c.state==="Archived"?Q.state==="Rejected"?"bg-red-100 text-red-700 border border-red-200":(Q.state==="Expired","bg-gray-100 text-gray-700 border border-gray-200"):"bg-yellow-100 text-yellow-700 border border-yellow-200",Ne=Q=>c.state==="FullySigned"?"Firmado":c.state==="Archived"?Q.state==="Rejected"?"Rechazado":Q.state==="Expired"?"Expirado":"Archivado":"Pendiente",se=B(()=>te.value.length>0&&U.value.length===te.value.length),ie=()=>{se.value?U.value=[]:U.value=te.value.map(Q=>Q.id)},ue=Q=>{const S=U.value.indexOf(Q);S>-1?U.value.splice(S,1):U.value.push(Q)},Se=()=>{U.value=te.value.map(Q=>Q.id)},Ae=()=>{U.value=[]},Pe=()=>{z.value=null,I.value="",$.value=""},x=()=>{J.value>1&&J.value--},l=()=>{J.value<N.value&&J.value++},a=Q=>{Q>=1&&Q<=N.value&&(J.value=Q)},T=Q=>Q?typeof Q=="string"?Q.split("T")[0]:Q:"",ce=B(()=>{const Q=N.value,S=J.value,oe=[];if(Q<=7)for(let _=1;_<=Q;_++)oe.push(_);else if(S<=4){for(let _=1;_<=5;_++)oe.push(_);oe.push("..."),oe.push(Q)}else if(S>=Q-3){oe.push(1),oe.push("...");for(let _=Q-4;_<=Q;_++)oe.push(_)}else oe.push(1),oe.push("..."),oe.push(S-1),oe.push(S),oe.push(S+1),oe.push("..."),oe.push(Q);return oe}),M=()=>{const Q=U.value.length>0?te.value.filter(u=>U.value.includes(u.id)):te.value,S=["Nombre Documento","Estado Firma","Etiquetas"],oe=Q.map(u=>[u.title||"",Ne(u),u.tags?u.tags.map(m=>m.name).join(", "):""]),_=[S.join(","),...oe.map(u=>u.map(m=>`"${m}"`).join(","))].join(`
`),ge=new Blob([_],{type:"text/csv;charset=utf-8;"}),fe=document.createElement("a"),ke=URL.createObjectURL(ge);fe.setAttribute("href",ke),fe.setAttribute("download",`documentos_firmas_${new Date().toISOString().split("T")[0]}.csv`),fe.style.visibility="hidden",document.body.appendChild(fe),fe.click(),document.body.removeChild(fe)},Te=b(!1),Fe=b(null),Oe=b(!1),et=b(null),Ye=b(""),ot=b(!1),xt=b(""),Rt=Q=>{Fe.value=Q,Te.value=!0},ut=async(Q,S)=>{Te.value=!1,await mt(Q,S)},mt=async(Q,S)=>{try{switch(Q){case"preview":await Y(S);break;case"letterhead":C("letterhead",S);break;case"relationships":C("relationships",S);break;case"viewSignatures":C("signatures",S);break;case"sign":await ne(S,C);break;case"reject":et.value=S,Ye.value="",Oe.value=!0;break;case"viewRejectionReason":{const oe=(S.signatures||[]).find(_=>_.rejection_comment);oe&&oe.rejection_comment?(xt.value=oe.rejection_comment,ot.value=!0):await $e("Este documento no tiene un motivo de rechazo registrado.","info");break}case"downloadSignedDocument":await Z(S);break;case"downloadPDF":await O(S);break;case"editAndResend":{if(S&&S.id&&S.title){const oe=encodeURIComponent(S.title.trim()),_=`/dynamic_document_dashboard/document/use/correction/${S.id}/${oe}`;F.push(_)}else console.warn("Cannot navigate to correction mode: invalid document data",S);break}default:console.warn("Unknown action:",Q)}}catch(oe){console.error(`Error executing action ${Q}:`,oe)}},gt=()=>{Oe.value=!1,et.value=null,Ye.value=""},zt=async()=>{if(!et.value)return;const Q=et.value,S=Q.id,oe=p.currentUser.id;try{const _=`dynamic-documents/${S}/reject/${oe}/`,ge=Ye.value?{comment:Ye.value}:{},fe=await cs(_,ge);fe&&(fe.status===200||fe.status===201)?(gt(),D("document-rejected",Q),Promise.all([$e("Documento rechazado correctamente.","success"),Ds(Ss.FINISH,`Rechazaste el documento "${Q.title}"`).catch(ke=>console.warn("No se pudo registrar la actividad de rechazo:",ke)),f.init(!0)]).then(()=>{D("refresh")})):await $e("Error al rechazar el documento.","error")}catch(_){console.error("Error rejecting document:",_),await $e("Error al rechazar el documento.","error")}},_t=async()=>{k.value=!0;try{await f.init(!0)}catch(Q){console.error("Error refreshing documents:",Q),$e("Error al actualizar documentos","error")}finally{k.value=!1}},wt=async()=>{await _t(),D("refresh")};He(async()=>{await _t()}),w({refresh:wt});const It=Q=>{var oe;if(!Q.summary_counterparty)return null;const S=(oe=Q.variables)==null?void 0:oe.find(_=>_.summary_field==="counterparty");return(S==null?void 0:S.value)||Q.summary_counterparty},Ut=Q=>Kt(Q)||null;return we(()=>p.currentUser,()=>{wt()}),(Q,S)=>{var oe;return s(),r("div",null,[e("div",ng,[e("div",lg,[e("div",ig,[n(t(Ze),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),De(e("input",{"onUpdate:modelValue":S[0]||(S[0]=_=>d.value=_),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Ee,d.value]])])]),e("div",dg,[n(t(Be),{as:"div",class:"relative"},{default:j(()=>[n(t(Re),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[e("div",cg,[n(t(rt),{class:"h-4 w-4 flex-shrink-0"}),e("span",ug,g(be.value||"Etiqueta"),1)]),n(t(Ve),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),n(t(ze),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",mg,[e("div",gg,[n(t(Ze),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),De(e("input",{"onUpdate:modelValue":S[1]||(S[1]=_=>A.value=_),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:S[2]||(S[2]=me(()=>{},["stop"]))},null,512),[[Ee,A.value]])]),e("div",pg,[n(t(ye),null,{default:j(({active:_})=>[e("a",{onClick:S[3]||(S[3]=ge=>z.value=null),class:P([_?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),r(pe,null,he(G.value,_=>(s(),le(t(ye),{key:_.id},{default:j(({active:ge})=>[e("a",{onClick:fe=>z.value=_.id,class:P([ge?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:P(["w-3 h-3 rounded-full flex-shrink-0",_e(_)])},null,2),e("span",fg,g(_.name),1)],10,hg)]),_:2},1024))),128)),G.value.length===0?(s(),r("div",yg," No se encontraron etiquetas ")):h("",!0)])])]),_:1})]),_:1}),e("div",vg,[z.value||I.value||$.value?(s(),r("button",{key:0,onClick:Pe,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[n(t(je),{class:"h-4 w-4 flex-shrink-0"}),bg])):h("",!0)])]),e("div",xg,[e("div",_g,[wg,De(e("input",{"onUpdate:modelValue":S[4]||(S[4]=_=>I.value=_),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Ee,I.value]])]),e("div",$g,[kg,De(e("input",{"onUpdate:modelValue":S[5]||(S[5]=_=>$.value=_),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Ee,$.value]])])]),e("div",Cg,[e("div",Dg,[e("div",Sg,[e("button",{onClick:M,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[n(t(nt),{class:"h-4 w-4"}),Fg]),n(t(Be),{as:"div",class:"relative"},{default:j(()=>[n(t(Re),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:j(()=>[n(t(dt),{class:"h-5 w-5 text-gray-500"})]),_:1}),n(t(ze),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",Eg,[n(t(ye),null,{default:j(({active:_})=>[e("a",{onClick:Se,class:P([_?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),n(t(ye),null,{default:j(({active:_})=>[e("a",{onClick:Ae,class:P([_?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),n(t(Be),{as:"div",class:"relative"},{default:j(()=>[n(t(Re),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[Tg,re(" "+g(xe.value)+" ",1),n(t(Ve),{class:"h-4 w-4"})]),_:1}),n(t(ze),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",Ag,[n(t(ye),null,{default:j(({active:_})=>[e("a",{onClick:S[6]||(S[6]=ge=>E.value="recent"),class:P([_?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),n(t(ye),null,{default:j(({active:_})=>[e("a",{onClick:S[7]||(S[7]=ge=>E.value="name"),class:P([_?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",jg,[e("div",Mg,[e("table",Pg,[e("thead",Lg,[e("tr",null,[e("th",Bg,[e("input",{type:"checkbox",checked:se.value,onChange:ie,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Rg)]),zg,Ig,Ug,Ng,Og,qg,Vg,c.state==="PendingSignatures"?(s(),r("th",Qg," Fecha Expiración ")):h("",!0),c.state==="PendingSignatures"||c.state==="FullySigned"?(s(),r("th",Wg," Docs. Asociados ")):h("",!0),Hg])]),e("tbody",Gg,[(s(!0),r(pe,null,he(ve.value,(_,ge)=>{var fe;return s(),r("tr",{key:_.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:ke=>Rt(_)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:S[8]||(S[8]=me(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:U.value.includes(_.id),onChange:ke=>ue(_.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Jg)]),e("td",Kg,[e("div",Yg,[e("div",Xg,[e("div",e0,[n(t(qe),{class:"h-5 w-5 text-purple-600"})])]),e("div",t0,[e("div",s0,g(_.title),1)])])]),e("td",o0,[e("span",{class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",Ue(_)])},g(Ne(_)),3)]),e("td",a0,[e("span",r0,g(It(_)||"-"),1)]),e("td",n0,[e("span",l0,g(_.summary_object||"-"),1)]),e("td",i0,[e("span",d0,g(Ut(_)||"-"),1)]),e("td",c0,[e("span",u0,g(_.summary_term||"-"),1)]),e("td",m0,[e("div",g0,[_.summary_subscription_date?(s(),r("div",p0,[h0,e("span",f0,g(T(_.summary_subscription_date)),1)])):h("",!0),_.summary_start_date||_.summary_end_date?(s(),r("div",y0,[v0,e("span",b0,[_.summary_start_date?(s(),r("span",x0,g(T(_.summary_start_date)),1)):h("",!0),_.summary_start_date&&_.summary_end_date?(s(),r("span",_0," → ")):h("",!0),_.summary_end_date?(s(),r("span",w0,g(T(_.summary_end_date)),1)):h("",!0)])])):h("",!0),!_.summary_subscription_date&&!_.summary_start_date&&!_.summary_end_date?(s(),r("span",$0," - ")):h("",!0)])]),c.state==="PendingSignatures"?(s(),r("td",k0,[_.signature_due_date?(s(),r("span",C0,g(T(_.signature_due_date)),1)):(s(),r("span",D0," - "))])):h("",!0),c.state==="PendingSignatures"||c.state==="FullySigned"?(s(),r("td",S0,[e("button",{type:"button",disabled:!_.relationships_count||_.relationships_count===0,class:P(["inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border transition-colors",_.relationships_count&&_.relationships_count>0?"border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100 cursor-pointer":"border-gray-200 text-gray-400 bg-gray-50 cursor-not-allowed opacity-60"]),onClick:me(ke=>t(C)("relationships",_),["stop"])},[_.relationships_count&&_.relationships_count>0?(s(),r("span",E0," Ver asociaciones ("+g(_.relationships_count)+") ",1)):(s(),r("span",T0," Sin asociaciones "))],10,F0)])):h("",!0),e("td",A0,[e("div",j0,[(s(!0),r(pe,null,he((fe=_.tags)==null?void 0:fe.slice(0,2),ke=>(s(),r("span",{key:ke.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",Ie(ke)])},g(ke.name),3))),128)),_.tags&&_.tags.length>2?(s(),r("span",M0," +"+g(_.tags.length-2),1)):h("",!0),!_.tags||_.tags.length===0?(s(),r("span",P0,"-")):h("",!0)])])],8,Zg)}),128))])])]),N.value>1?(s(),r("div",L0,[e("div",B0,[e("button",{onClick:x,disabled:J.value===1,class:P(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",J.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,R0),e("button",{onClick:l,disabled:J.value===N.value,class:P(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",J.value===N.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,z0)]),e("div",I0,[e("div",null,[e("p",U0,[re(" Mostrando "),e("span",N0,g(W.value.start),1),re(" a "),e("span",O0,g(W.value.end),1),re(" de "),e("span",q0,g(W.value.total),1),re(" resultados ")])]),e("div",null,[e("nav",V0,[e("button",{onClick:x,disabled:J.value===1,class:P(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",J.value===1?"opacity-50 cursor-not-allowed":""])},[W0,n(t(Et),{class:"h-5 w-5","aria-hidden":"true"})],10,Q0),(s(!0),r(pe,null,he(ce.value,_=>(s(),r(pe,{key:_},[_!=="..."?(s(),r("button",{key:0,onClick:ge=>a(_),class:P(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",J.value===_?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},g(_),11,H0)):(s(),r("span",G0," ... "))],64))),128)),e("button",{onClick:l,disabled:J.value===N.value,class:P(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",J.value===N.value?"opacity-50 cursor-not-allowed":""])},[J0,n(t(vt),{class:"h-5 w-5","aria-hidden":"true"})],10,Z0)])])])])):h("",!0)]),te.value.length===0&&!k.value?(s(),r("div",K0,[n(t(Lt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",Y0,g(K.value),1),e("p",X0,g(L.value),1)])):h("",!0),k.value?(s(),r("div",ep,op)):h("",!0),n(Ht,{isVisible:t(at),documentData:t(Wt),onClose:S[9]||(S[9]=_=>at.value=!1)},null,8,["isVisible","documentData"]),(s(),le(Qt,{to:"body"},[t(v).signatures.isOpen?(s(),le(t(us),{key:0,"document-id":(oe=t(v).signatures.document)==null?void 0:oe.id,onClose:S[10]||(S[10]=_=>t(X)("signatures")),onRefresh:S[11]||(S[11]=_=>D("refresh")),onOpenElectronicSignature:S[12]||(S[12]=_=>D("open-electronic-signature"))},null,8,["document-id"])):h("",!0),t(v).letterhead.isOpen?(s(),le(Pt,{key:1,"is-visible":t(v).letterhead.isOpen,document:t(v).letterhead.document,onClose:S[13]||(S[13]=_=>t(X)("letterhead")),onRefresh:S[14]||(S[14]=_=>D("refresh"))},null,8,["is-visible","document"])):h("",!0),Te.value?(s(),le(Bt,{key:2,"is-visible":Te.value,document:Fe.value,"card-type":"signatures",context:"table","user-store":t(p),onClose:S[15]||(S[15]=_=>Te.value=!1),onAction:ut},null,8,["is-visible","document","user-store"])):h("",!0),t(v).relationships.isOpen?(s(),le(Tt,{key:3,"is-open":t(v).relationships.isOpen,document:t(v).relationships.document,readonly:c.state==="PendingSignatures"||c.state==="FullySigned",onClose:S[16]||(S[16]=_=>t(X)("relationships")),onRefresh:S[17]||(S[17]=_=>D("refresh"))},null,8,["is-open","document","readonly"])):h("",!0),H.value?(s(),le(rg,{key:4,"is-visible":H.value,document:de.value,onClose:S[18]||(S[18]=_=>H.value=!1)},null,8,["is-visible","document"])):h("",!0),Oe.value&&et.value?(s(),r("div",ap,[e("div",rp,[e("div",np,[lp,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:gt},[n(t(je),{class:"h-5 w-5"})])]),e("div",ip,[e("p",null,[re(" Estás a punto de rechazar el documento "),e("span",dp,'"'+g(et.value.title)+'"',1),re(". ")]),cp,e("div",null,[up,De(e("textarea",{"onUpdate:modelValue":S[19]||(S[19]=_=>Ye.value=_),rows:"4",class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-secondary focus:border-transparent resize-none",placeholder:"Describe brevemente por qué no estás de acuerdo con el documento..."},null,512),[[Ee,Ye.value]])])]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end gap-2 bg-gray-50"},[e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100",onClick:gt}," Cancelar "),e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700",onClick:zt}," Rechazar documento ")])])])):h("",!0),ot.value?(s(),r("div",mp,[e("div",gp,[e("div",pp,[hp,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:S[20]||(S[20]=_=>ot.value=!1)},[n(t(je),{class:"h-5 w-5"})])]),e("div",fp,g(xt.value||"No se encontró un motivo de rechazo para este documento."),1),e("div",yp,[e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100",onClick:S[21]||(S[21]=_=>ot.value=!1)}," Cerrar ")])])])):h("",!0)]))])}}},vp={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},bp={class:"flex justify-end"},xp=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[re(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),_p={class:"mt-2"},wp={class:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t border-gray-200"},$p=["disabled"],kp=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),Cp=e("span",null,"Actualizar nombre",-1),Dp=[kp,Cp],Sp=["disabled"],Fp=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1),Ep={__name:"CreateDocumentByLawyer",emits:["close"],setup(o,{emit:w}){const i=st(),c=Qe(),D=w,p=b(""),f=b("");is(()=>{var O;(O=c.selectedDocument)!=null&&O.title?(p.value=c.selectedDocument.title,f.value=c.selectedDocument.title):(p.value="",f.value="")});const F=O=>{O.key==="Escape"&&D("close")};He(()=>{document.addEventListener("keydown",F)}),ft(()=>{document.removeEventListener("keydown",F)});const v=B(()=>p.value.trim().length>0),C=B(()=>{var O;return!!((O=c.selectedDocument)!=null&&O.id)}),X=B(()=>C.value&&p.value.trim()!==f.value.trim()&&p.value.trim().length>0);async function ee(){if(C.value&&X.value)try{const O={title:p.value.trim()};await c.updateDocument(c.selectedDocument.id,O),f.value=p.value.trim(),c.selectedDocument.title=p.value.trim(),c.lastUpdatedDocumentId=c.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",c.selectedDocument.id);const ne=c.selectedDocument.id;D("close",{updatedDocId:ne});const Z=window.location.pathname;Z==="/dynamic_document_dashboard"||Z==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(ne)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(O){console.error("Error updating document name:",O)}}const Y=async()=>{if(!v.value)return;const O=encodeURIComponent(p.value.trim());C.value?(c.selectedDocument.title=p.value,c.selectedDocument.id&&(c.lastUpdatedDocumentId=c.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",c.selectedDocument.id.toString())),i.push(`/dynamic_document_dashboard/lawyer/editor/edit/${c.selectedDocument.id}`)):(c.selectedDocument={title:p.value.trim()},i.push(`/dynamic_document_dashboard/lawyer/editor/create/${O}`))};return(O,ne)=>(s(),r("div",vp,[e("div",bp,[e("button",{onClick:ne[0]||(ne[0]=Z=>D("close"))},[n(t(je),{class:"size-6"})])]),e("form",{onSubmit:me(Y,["prevent"])},[e("div",null,[xp,e("div",_p,[De(e("input",{"onUpdate:modelValue":ne[1]||(ne[1]=Z=>p.value=Z),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[Ee,p.value]])])]),e("div",wp,[C.value?(s(),r("button",{key:0,type:"button",onClick:ee,disabled:!X.value,class:P(["inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm transition-all duration-200",X.value?"bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500":"bg-gray-100 text-gray-400 border-2 border-dashed border-gray-300 cursor-not-allowed"])},Dp,10,$p)):h("",!0),e("button",{type:"submit",class:P(["inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm transition-all duration-200",v.value?"bg-green-600 text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500":"bg-gray-100 text-gray-400 border-2 border-dashed border-gray-300 cursor-not-allowed"]),disabled:!v.value},[Fp,e("span",null,g(C.value?"Editar Documento":"Continuar"),1)],10,Sp)])],32)]))}},Me=o=>(St("data-v-60420c9d"),o=o(),Ft(),o),Tp={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Ap={class:"px-6 py-4 border-b border-gray-200"},jp=Me(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gestión de Membrete Global para PDF",-1)),Mp=Me(()=>e("p",{class:"text-sm text-gray-500 mt-1"}," La imagen de membrete se usará por defecto solo al generar documentos en PDF. Para documentos Word, se utiliza la plantilla .docx configurada más abajo. ",-1)),Pp={class:"p-6 overflow-y-auto flex-grow"},Lp={key:0,class:"text-center py-10"},Bp=Me(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),Rp={class:"mt-4 text-gray-500"},zp={key:1,class:"space-y-6"},Ip={key:0,class:"space-y-4"},Up=Me(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete de imagen para PDF actual",-1)),Np={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Op=["src"],qp={class:"mt-4 flex justify-center space-x-3"},Vp=["disabled"],Qp={key:1,class:"text-center py-8"},Wp=Me(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete para PDF",-1)),Hp=Me(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," No tienes una imagen de membrete global configurada para los documentos PDF. ",-1)),Gp=Me(()=>e("p",{class:"mt-1 text-xs text-gray-400"}," Este membrete de imagen se aplicará solo a los PDF que no tengan un membrete específico. ",-1)),Zp={class:"space-y-4"},Jp={class:"text-lg font-medium text-gray-900"},Kp={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},Yp={key:0},Xp={class:"mt-4"},eh=Me(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, máximo 10MB. Se usa únicamente para los PDF. ",-1)),th=Me(()=>e("p",{class:"text-xs text-gray-400 mt-1"},' Dimensiones ideales: 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI) ',-1)),sh={key:1,class:"space-y-4"},oh={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},ah={class:"text-gray-400"},rh={key:0,class:"mt-4"},nh=["src"],lh={class:"flex justify-center space-x-3"},ih=["disabled"],dh={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},ch={class:"space-y-4 border-t border-gray-200 pt-6"},uh=Me(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Plantilla Word para documentos (.docx)",-1)),mh=Me(()=>e("p",{class:"text-sm text-gray-500"}," Esta plantilla se usará al descargar documentos en Word. Debe ser un archivo .docx con tu membrete configurado (header, footer o watermark). El contenido del documento se añadirá sobre esa plantilla. ",-1)),gh={key:0,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},ph={class:"text-sm text-gray-700"},hh=Me(()=>e("div",{class:"font-medium"},"Plantilla actual:",-1)),fh={class:"mt-1 break-words"},yh={class:"font-mono break-all"},vh={key:0,class:"text-gray-400 ml-2"},bh={class:"mt-3 flex flex-wrap gap-3"},xh=["disabled"],_h={key:1,class:"text-sm text-gray-500"},wh={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},$h={key:0},kh={class:"mt-4"},Ch=Me(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos .docx, máximo 10MB. ",-1)),Dh={key:1,class:"space-y-4"},Sh={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Fh={class:"text-gray-400"},Eh={class:"flex justify-center space-x-3"},Th=["disabled"],Ah={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},jh={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},Mh={class:"flex items-center space-x-2"},Ph=Me(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete para PDF",-1)),Lh=Me(()=>e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-yellow-800 mb-2"},"🔄 Prioridad de Membrete"),e("div",{class:"text-sm text-yellow-700 space-y-1"},[e("div",null,[e("strong",null,"1º Prioridad:"),re(" Membrete específico del documento")]),e("div",null,[e("strong",null,"2º Prioridad:"),re(" Membrete global de imagen para PDF del usuario (este)")]),e("div",null,[e("strong",null,"3º Prioridad:"),re(" Sin membrete")])])],-1)),Bh=Me(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"📐 Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"2550 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"3300 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporción:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta, 300 DPI)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"±10%")])])])],-1)),Rh=Me(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🎨 Distribución Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"⚠️ ZONA CRÍTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mantén semi-transparente. El texto del documento se superpone aquí.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, teléfonos, emails, información de contacto.")])])])])])],-1)),zh=Me(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🔧 Consideraciones Técnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Posicionamiento:"),re(" La imagen se centra automáticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Transparencia:"),re(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Márgenes:"),re(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Resolución:"),re(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"⚠️"),e("span",null,[e("strong",null,"Zona crítica:"),re(" Evita elementos gráficos densos en el centro (300-400px de altura)")])])])])],-1)),Ih=Me(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"💡 Tips de Diseño Rápido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"• Si solo tienes header, ubícalo en los primeros 120-150px"),e("div",null,"• El resto de la imagen debe ser transparente o blanco"),e("div",null,"• Para footer, usa los últimos 80-120px"),e("div",null,"• El texto se superpone en toda la imagen, mantén el centro claro")])],-1)),Uh={key:3,class:"space-y-2"},Nh={class:"flex"},Oh={class:"text-sm text-yellow-700"},qh={__name:"GlobalLetterheadModal",props:{isVisible:{type:Boolean,default:!1}},emits:["close","uploaded","deleted"],setup(o,{emit:w}){const i=o,c=w;we(()=>i.isVisible,se=>{});const D=Qe(),p=b(!1),f=b(""),F=b(!1),v=b(!1),C=b(null),X=b(null),ee=b(null),Y=b([]),O=b(null),ne=b(!1),Z=b(!1),k=b(null),d=b(!1),A=b(null),z=b(""),I=b(null),$=b(!1),E=b(!1),U=b(null),H=()=>{q(),c("close")},de=se=>{const ie=se.target.files[0];if(!ie)return;if(!ie.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(ie.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}C.value=ie,Y.value=[];const ue=new FileReader;ue.onload=Se=>{X.value=Se.target.result;const Ae=new Image;Ae.onload=()=>{J(Ae.width,Ae.height)},Ae.src=Se.target.result},ue.readAsDataURL(ie)},J=(se,ie)=>{const Pe=se/ie,x=2550/3300,l=Math.abs(Pe-x)/x;if(se===2550&&ie===3300){Y.value.push("✅ Dimensiones perfectas: 2550 × 3300 píxeles");return}l<=.1?(Y.value.push(`ℹ️ Buenas proporciones detectadas: ${se} × ${ie} píxeles (${Pe.toFixed(3)})`),(se!==2550||ie!==3300)&&Y.value.push('💡 Para mejores resultados, usa exactamente 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI)')):(Y.value.push(`⚠️ Proporciones no ideales: ${se} × ${ie} píxeles (${Pe.toFixed(3)})`),Y.value.push(`🎯 Proporciones recomendadas: ${x.toFixed(3)} (8.5:11, tamaño carta)`),Y.value.push("📐 Considera redimensionar tu imagen a 2550 × 3300 píxeles (tamaño carta)")),(se<1200||ie<1600)&&Y.value.push("⚠️ Imagen muy pequeña - puede verse pixelada en documentos PDF tamaño carta"),(se>4e3||ie>5e3)&&Y.value.push("ℹ️ Imagen muy grande - se redimensionará automáticamente para ajustarse al tamaño carta")},q=()=>{C.value=null,X.value=null,Y.value=[],ne.value=!1,O.value&&(O.value.value="")},K=async()=>{var se;if(C.value){F.value=!0,Y.value=[];try{const ie=await D.uploadGlobalLetterheadImage(C.value);(se=ie.data)!=null&&se.warnings&&ie.data.warnings.length>0&&(Y.value=ie.data.warnings),Z.value=!1,await L(),q(),c("uploaded",ie.data)}catch(ie){console.error("Error uploading global letterhead:",ie),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{F.value=!1}}},L=async()=>{if(!(ee.value===null&&Z.value)){Z.value=!0;try{const se=await D.getGlobalLetterheadImage();se.data&&(ee.value=URL.createObjectURL(se.data))}catch{ee.value=null}}},R=async()=>{await es("¿Estás seguro de que deseas eliminar la imagen de membrete global?")&&te()},te=async()=>{v.value=!0;try{await D.deleteGlobalLetterheadImage(),ee.value&&URL.revokeObjectURL(ee.value),ee.value=null,Z.value=!0,c("deleted")}catch(se){console.error("Error deleting global letterhead:",se),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{v.value=!1}},ve=se=>{const ie=se.target.files[0];if(ie){if(!ie.name.toLowerCase().endsWith(".docx")){alert("Solo se permiten archivos .docx para la plantilla Word");return}if(ie.size>10*1024*1024){alert("El archivo de plantilla no puede ser mayor a 10MB");return}k.value=ie}},N=()=>{k.value=null,U.value&&(U.value.value="")},W=async()=>{var se;if(k.value){$.value=!0;try{const ue=(se=(await D.uploadGlobalLetterheadWordTemplate(k.value)).data)==null?void 0:se.template_info;d.value=!0,z.value=(ue==null?void 0:ue.filename)||k.value.name,I.value=(ue==null?void 0:ue.size_bytes)||k.value.size,await V(),N()}catch(ie){console.error("Error uploading global Word template:",ie),alert("Error al subir la plantilla Word. Por favor intenta nuevamente.")}finally{$.value=!1}}},V=async()=>{var se,ie;try{const ue=await D.getGlobalLetterheadWordTemplate("blob");if(!ue){d.value=!1,A.value&&URL.revokeObjectURL(A.value),A.value=null,z.value="",I.value=null;return}if(ue&&ue.data){d.value=!0,A.value&&URL.revokeObjectURL(A.value),A.value=URL.createObjectURL(ue.data);const Se=((se=ue.headers)==null?void 0:se["content-disposition"])||((ie=ue.headers)==null?void 0:ie["Content-Disposition"]);let Ae="plantilla_word.docx";if(Se){const Pe=Se.match(/filename="?([^";]+)"?/i);Pe&&Pe[1]&&(Ae=Pe[1])}z.value=Ae,I.value=ue.data.size||null}}catch(ue){console.error("Error loading global Word template:",ue)}},G=async()=>{await es("¿Estás seguro de que deseas eliminar la plantilla Word de membrete global?")&&be()},be=async()=>{E.value=!0;try{await D.deleteGlobalLetterheadWordTemplate(),A.value&&URL.revokeObjectURL(A.value),A.value=null,z.value="",I.value=null,d.value=!1}catch(se){console.error("Error deleting global Word template:",se),alert("Error al eliminar la plantilla Word. Por favor intenta nuevamente.")}finally{E.value=!1}},_e=()=>{if(A.value){const se=document.createElement("a");se.href=A.value,se.download=z.value||"membrete-word.docx",document.body.appendChild(se),se.click(),document.body.removeChild(se)}},xe=()=>{if(ee.value){const se=document.createElement("a");se.href=ee.value,se.download="membrete-global.png",document.body.appendChild(se),se.click(),document.body.removeChild(se)}},Ie=()=>{ee.value=null},Ue=se=>{if(se===0)return"0 Bytes";const ie=1024,ue=["Bytes","KB","MB","GB"],Se=Math.floor(Math.log(se)/Math.log(ie));return parseFloat((se/Math.pow(ie,Se)).toFixed(2))+" "+ue[Se]};we(()=>i.isVisible,se=>{se&&(L(),V())});const Ne=()=>{ee.value&&URL.revokeObjectURL(ee.value),X.value&&URL.revokeObjectURL(X.value),A.value&&URL.revokeObjectURL(A.value)};return He(()=>{i.isVisible&&L()}),ft(Ne),(se,ie)=>De((s(),le(Je,null,{default:j(()=>[e("div",{class:"w-full h-full flex items-center justify-center p-4",onClick:me(H,["self"])},[e("div",Tp,[e("div",Ap,[jp,Mp,e("button",{onClick:H,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[n(t(je),{class:"h-6 w-6"})])]),e("div",Pp,[p.value?(s(),r("div",Lp,[Bp,e("p",Rp,g(f.value),1)])):(s(),r("div",zp,[ee.value?(s(),r("div",Ip,[Up,e("div",Np,[e("img",{src:ee.value,alt:"Membrete de imagen para PDF actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:Ie},null,40,Op),e("div",qp,[e("button",{onClick:xe,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[n(t(nt),{class:"h-4 w-4 mr-2"}),re(" Descargar ")]),e("button",{onClick:R,disabled:v.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[n(t(Vt),{class:"h-4 w-4 mr-2"}),re(" "+g(v.value?"Eliminando...":"Eliminar"),1)],8,Vp)])])])):(s(),r("div",Qp,[n(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),Wp,Hp,Gp])),e("div",Zp,[e("h3",Jp,g(ee.value?"Reemplazar Membrete de imagen para PDF":"Subir Membrete de imagen para PDF"),1),e("div",Kp,[e("input",{ref_key:"fileInput",ref:O,type:"file",accept:".png",onChange:de,class:"hidden"},null,544),C.value?(s(),r("div",sh,[e("div",oh,[n(t(Dt),{class:"h-5 w-5 text-green-500"}),e("span",null,g(C.value.name),1),e("span",ah,"("+g(Ue(C.value.size))+")",1)]),X.value?(s(),r("div",rh,[e("img",{src:X.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,nh)])):h("",!0),e("div",lh,[e("button",{onClick:q,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:K,disabled:F.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[F.value?(s(),r("div",dh)):(s(),le(t(as),{key:0,class:"h-4 w-4 mr-2"})),re(" "+g(F.value?"Subiendo...":"Subir Imagen para PDF"),1)],8,ih)])])):(s(),r("div",Yp,[n(t(ps),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Xp,[e("button",{onClick:ie[0]||(ie[0]=ue=>se.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG para PDF "),e("button",{onClick:ie[1]||(ie[1]=ue=>ne.value=!ne.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[n(t(os),{class:"h-4 w-4 mr-2"}),re(" "+g(ne.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),eh,th]))])]),e("div",ch,[uh,mh,d.value?(s(),r("div",gh,[e("div",ph,[hh,e("div",fh,[e("span",yh,g(z.value||"plantilla_word.docx"),1),I.value?(s(),r("span",vh,"("+g(Ue(I.value))+")",1)):h("",!0)])]),e("div",bh,[A.value?(s(),r("button",{key:0,onClick:_e,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[n(t(nt),{class:"h-4 w-4 mr-2"}),re(" Descargar ")])):h("",!0),e("button",{onClick:G,disabled:E.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[n(t(Vt),{class:"h-4 w-4 mr-2"}),re(" "+g(E.value?"Eliminando...":"Eliminar"),1)],8,xh)])])):(s(),r("div",_h," No tienes una plantilla Word configurada. Puedes subir un archivo .docx con tu membrete. ")),e("div",wh,[e("input",{ref_key:"wordTemplateInput",ref:U,type:"file",accept:".docx",onChange:ve,class:"hidden"},null,544),k.value?(s(),r("div",Dh,[e("div",Sh,[n(t(Dt),{class:"h-5 w-5 text-green-500"}),e("span",null,g(k.value.name),1),e("span",Fh,"("+g(Ue(k.value.size))+")",1)]),e("div",Eh,[e("button",{onClick:N,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:W,disabled:$.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[$.value?(s(),r("div",Ah)):(s(),le(t(as),{key:0,class:"h-4 w-4 mr-2"})),re(" "+g($.value?"Subiendo...":"Subir Plantilla"),1)],8,Th)])])):(s(),r("div",$h,[n(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",kh,[e("button",{onClick:ie[2]||(ie[2]=ue=>se.$refs.wordTemplateInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Plantilla .docx (Word) ")]),Ch]))])]),ne.value?(s(),r("div",jh,[e("div",Mh,[n(t(os),{class:"h-6 w-6 text-blue-600"}),Ph]),Lh,Bh,Rh,zh,Ih])):h("",!0),Y.value.length>0?(s(),r("div",Uh,[(s(!0),r(pe,null,he(Y.value,(ue,Se)=>(s(),r("div",{key:Se,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",Nh,[n(t(Is),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",Oh,g(ue),1)])]))),128))])):h("",!0)]))])])])]),_:1},512)),[[yt,o.isVisible]])}},Vh=At(qh,[["__scopeId","data-v-60420c9d"]]),Qh={class:"min-h-screen bg-gray-50"},Wh={class:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8"},Hh={class:"p-4 sm:p-6 lg:p-8"},Gh={key:0},Zh={key:0},Jh={key:1},Kh={class:"mb-6 border-b border-gray-200 pb-4"},Yh={class:"hidden md:block"},Xh={class:"flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8 mb-4","aria-label":"Tabs"},ef=["onClick"],tf={class:"flex gap-3"},sf=["disabled"],of=e("span",null,"Firma Electrónica",-1),af=e("span",null,"Membrete Global",-1),rf=e("span",null,"Nueva Minuta",-1),nf=e("span",null,"Nuevo Documento",-1),lf={class:"md:hidden space-y-3 relative"},df=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),cf=[df],uf={key:0,class:"absolute z-20 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden w-full"},mf=["onClick"],gf=["disabled"],pf=e("span",{class:"font-medium text-xs leading-tight"},"Firma",-1),hf=e("span",{class:"font-medium text-xs leading-tight"},"Membrete",-1),ff=e("span",{class:"font-medium text-xs leading-tight"},"Nueva Minuta",-1),yf=e("span",{class:"font-medium text-xs leading-tight"},"Nuevo Doc.",-1),vf={key:0},bf={key:1},xf={key:2},_f={key:3},wf={key:4},$f={key:5},kf={key:6},Cf={key:7},Df={key:8,class:"mt-6 text-center text-gray-400 font-regular"},Sf=e("p",null,"No hay documentos disponibles para mostrar.",-1),Ff=[Sf],Ef={key:1},Tf={class:"mb-6 border-b border-gray-200"},Af={class:"hidden md:flex md:flex-col"},jf={class:"-mb-px flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},Mf=["onClick"],Pf={class:"flex flex-wrap items-center gap-2 mt-3 mb-4 md:justify-end"},Lf={class:"relative"},Bf={class:"relative group"},Rf=["disabled"],zf={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},If=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),Uf={class:"md:hidden relative"},Nf=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),Of=[Nf],qf={key:0,class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},Vf=["onClick"],Qf={class:"md:hidden mt-4 mb-4 flex flex-col gap-2"},Wf={class:"relative"},Hf={class:"relative group"},Gf=["disabled"],Zf={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},Jf=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),Kf={key:0},Yf={key:1},Xf={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},ey={class:"flex justify-between items-center p-4 border-b"},ty=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),sy={class:"p-4 sm:p-6"},oy={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},ay={class:"flex justify-between items-center p-4 border-b"},ry=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),ny={class:"p-4 sm:p-6"},By={__name:"Dashboard",setup(o){const w=Ke(),i=Qe(),c=Jt(),D=st(),p=Fs(),{isBasicUser:f,handleFeatureAccess:F}=ys(),v=b(""),C=b("default"),X=b(!1);we(C,(l,a)=>{});const ee=b(!1),Y=b("folders"),O=b("legal-documents"),ne=b(!1),Z=b(!1),k=b(!1),d=b(!1),A=b(!1),z=b(null),I=b([]),$=b("recent");we(O,(l,a)=>{},{immediate:!0}),B(()=>[]),B(()=>$.value==="recent"?"Más recientes":"Nombre (A-Z)");const E=B(()=>w.currentUser),U=B(()=>E.value?E.value.role:(D.push("/login"),null)),H=B(()=>{let l=[];U.value==="lawyer"?l=i.draftAndPublishedDocumentsUnassigned:(U.value==="client"||U.value==="basic"||U.value==="corporate_client")&&(l=i.progressAndCompletedDocumentsByClient(E.value.id));const a=I.value&&Array.isArray(I.value)?I.value.map(T=>T.id):[];return i.filteredDocumentsBySearchAndTags(v.value,w,a).filter(T=>l.some(ce=>ce.id===T.id))}),de=async l=>{C.value=l,X.value=!0,U.value!=="lawyer"&&(Y.value=null),i.selectedDocument=null;try{await i.init(!0)}catch(a){console.error("Error loading documents for useDocument section:",a)}finally{X.value=!1}},J=()=>{ee.value=!1,C.value!=="useDocument"&&(C.value="default"),i.selectedDocument=null},q=async()=>{await i.init(!0)},K=()=>{if(!E.value){console.error("Cannot open signature modal: currentUser is not loaded");return}Z.value=!0},L=()=>{if(!E.value){console.error("Cannot open signature modal: currentUser is not loaded");return}ne.value=!0},R=()=>{if(!E.value){console.error("Cannot open signature modal: currentUser is not loaded");return}ne.value=!0},te=async l=>{O.value="signed-documents"},ve=async l=>{Y.value="signed-documents"},N=async l=>{try{l&&l.id?await i.fetchDocumentById(l.id,!0):await i.init(!0)}catch(a){console.error("Error refreshing rejected document for lawyer:",a)}O.value="archived-documents"},W=async l=>{try{l&&l.id?await i.fetchDocumentById(l.id,!0):await i.init(!0)}catch(a){console.error("Error refreshing rejected document for client:",a)}Y.value="archived-documents"},V=()=>{i.selectedDocument=null,ee.value=!0},G=()=>{de("useDocument")},be=l=>{const{tab:a,searchQuery:T}=l;O.value=a,v.value=T,setTimeout(()=>{},100)},_e=()=>{if(!E.value){console.error("Cannot open letterhead modal: currentUser is not loaded");return}F("Membrete Global",()=>{k.value=!0})},xe=l=>{$e("Membrete global subido correctamente","success")},Ie=()=>{$e("Membrete global eliminado correctamente","success")},Ue=async()=>{if(C.value==="useDocument"){C.value="default",U.value==="lawyer"?O.value="my-documents":Y.value="my-documents";return}if(!X.value){U.value==="lawyer"?O.value="folders":Y.value="folders";try{await new Promise(l=>setTimeout(l,100)),await c.fetchFolders(!0)}catch{}}};we(()=>i.lastUpdatedDocumentId,(l,a)=>{if(l&&l!==a&&C.value==="default"){const T=Date.now();(!we.lastExecutionTime||T-we.lastExecutionTime>100)&&(we.lastExecutionTime=T,C.value)}},{immediate:!1}),we(d,l=>{}),we(A,l=>{}),we(z,l=>{}),we(()=>p.path,(l,a)=>{l==="/dynamic_document_dashboard"&&a&&a.includes("/document/use/")&&i.init()}),we(()=>p.query,l=>{l.lawyerTab&&(O.value=l.lawyerTab),l.tab&&(Y.value=l.tab)},{immediate:!0});const Ne=[{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"archived-documents",label:"Dcs. Archivados"}],se=[{name:"legal-documents",label:"Minutas"},{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"archived-documents",label:"Dcs. Archivados"},{name:"finished-documents",label:"Dcs. Clientes"},{name:"in-progress-documents",label:"Dcs. Clientes en Progreso"}],ie=b(!1),ue=b(!1),Se=()=>{ie.value=!1,ue.value=!1},Ae=l=>{v.value="",O.value=l,ie.value=!1,C.value==="useDocument"&&(C.value="default"),Se()},Pe=l=>{v.value="",Y.value=l,ue.value=!1,C.value==="useDocument"&&(C.value="default"),Se()};He(async()=>{try{await Promise.all([w.init(),c.init()])}catch(a){console.error("Error initializing dynamic document dashboard:",a)}i.selectedDocument=null,C.value!=="useDocument"&&(C.value="default");const l=localStorage.getItem("lastUpdatedDocumentId");l&&i.documents.some(T=>T.id.toString()===l)&&(i.lastUpdatedDocumentId=parseInt(l))});const x=async l=>{w.currentUser&&(w.currentUser.has_signature=!0),$e("Firma electrónica guardada correctamente","success"),setTimeout(()=>{Z.value=!1,ne.value=!1},500)};return(l,a)=>{var T,ce;return s(),r(pe,null,[e("div",Qh,[e("div",Wh,[ds(l.$slots,"default")]),e("div",Hh,[U.value==="lawyer"?(s(),r("div",Gh,[C.value==="useDocument"?(s(),r("div",Zh,[n(ls,{searchQuery:v.value,selectedTags:I.value,onGoBack:Ue},null,8,["searchQuery","selectedTags"])])):(s(),r("div",Jh,[e("div",Kh,[e("div",Yh,[e("nav",Xh,[(s(),r(pe,null,he(se,M=>e("button",{key:M.name,onClick:me(Te=>Ae(M.name),["stop"]),class:P([O.value===M.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},g(M.label),11,ef)),64))]),e("div",tf,[e("button",{onClick:me(K,["stop"]),disabled:!E.value,class:P(["inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-purple-200 text-sm font-medium transition-all duration-200",E.value?"bg-white text-gray-700 hover:bg-purple-50 hover:border-purple-300":"bg-gray-50 text-gray-400 cursor-not-allowed opacity-60"])},[n(t($t),{class:"size-5 text-purple-500"}),of],10,sf),e("button",{onClick:a[0]||(a[0]=me(M=>k.value=!0,["stop"])),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-green-200 bg-white text-sm font-medium text-gray-700 hover:bg-green-50 hover:border-green-300 transition-all duration-200"},[n(t(qe),{class:"size-5 text-green-500"}),af]),O.value==="legal-documents"?(s(),r("button",{key:0,onClick:me(V,["stop"]),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-secondary bg-secondary text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200"},[n(t(Ge),{class:"size-5"}),rf])):h("",!0),O.value==="my-documents"?(s(),r("button",{key:1,onClick:me(G,["stop"]),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-secondary bg-secondary text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200"},[n(t(Ge),{class:"size-5"}),nf])):h("",!0)])]),e("div",lf,[e("button",{onClick:a[1]||(a[1]=me(M=>ie.value=!ie.value,["stop"])),class:"dropdown-button w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,g(((T=se.find(M=>M.name===O.value))==null?void 0:T.label)||"Seleccionar sección"),1),(s(),r("svg",{class:P(["ml-2 h-5 w-5 transition-transform duration-200",ie.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},cf,2))]),ie.value?(s(),r("div",uf,[(s(),r(pe,null,he(se,M=>e("button",{key:M.name,onClick:me(Te=>Ae(M.name),["stop"]),class:P(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",O.value===M.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},g(M.label),11,mf)),64))])):h("",!0),e("div",{class:P(["grid gap-2",O.value==="legal-documents"||O.value==="my-documents"?"grid-cols-3":"grid-cols-2"])},[e("button",{onClick:me(K,["stop"]),disabled:!E.value,class:P(["flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-purple-200 text-center transition-all duration-200",E.value?"bg-white hover:bg-purple-50":"bg-gray-50 cursor-not-allowed opacity-60"])},[n(t($t),{class:"size-6 text-purple-500 mb-1"}),pf],10,gf),e("button",{onClick:a[2]||(a[2]=me(M=>k.value=!0,["stop"])),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-green-200 bg-white text-center transition-all duration-200 hover:bg-green-50"},[n(t(qe),{class:"size-6 text-green-500 mb-1"}),hf]),O.value==="legal-documents"?(s(),r("button",{key:0,onClick:me(V,["stop"]),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-secondary bg-secondary text-white text-center transition-all duration-200 hover:bg-blue-700"},[n(t(Ge),{class:"size-6 mb-1"}),ff])):h("",!0),O.value==="my-documents"?(s(),r("button",{key:1,onClick:me(G,["stop"]),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-secondary bg-secondary text-white text-center transition-all duration-200 hover:bg-blue-700"},[n(t(Ge),{class:"size-6 mb-1"}),yf])):h("",!0)],2)])]),O.value==="legal-documents"?(s(),r("div",vf,[n(Ot,{searchQuery:v.value,"onUpdate:searchQuery":a[3]||(a[3]=M=>v.value=M),selectedTags:I.value,"is-loading":t(i).isLoading,"card-type":"lawyer","show-state-filter":!0,"show-client-filter":!0,"show-associations-column":!0,context:"legal-documents",onRefresh:q},null,8,["searchQuery","selectedTags","is-loading"])])):h("",!0),O.value==="my-documents"?(s(),r("div",bf,[n(Ot,{searchQuery:v.value,"onUpdate:searchQuery":a[4]||(a[4]=M=>v.value=M),selectedTags:I.value,"is-loading":t(i).isLoading,"card-type":"client","show-state-filter":!0,"show-client-filter":!1,"show-associations-column":!0,context:"my-documents",onRefresh:q},null,8,["searchQuery","selectedTags","is-loading"])])):h("",!0),O.value==="folders"?(s(),r("div",xf,[n(ns,{searchQuery:v.value,selectedTags:I.value,onRefresh:q,onNavigateToMain:Ue,onNavigateToDocument:be},null,8,["searchQuery","selectedTags"])])):h("",!0),O.value==="pending-signatures"?(s(),r("div",_f,[n(it,{state:"PendingSignatures",searchQuery:v.value,selectedTags:I.value,onRefresh:q,onOpenElectronicSignature:K,onDocumentFullySigned:te,onDocumentRejected:N},null,8,["searchQuery","selectedTags"])])):h("",!0),O.value==="signed-documents"?(s(),r("div",wf,[n(it,{state:"FullySigned",searchQuery:v.value,selectedTags:I.value,onRefresh:q,onOpenElectronicSignature:K},null,8,["searchQuery","selectedTags"])])):h("",!0),O.value==="archived-documents"?(s(),r("div",$f,[n(it,{state:"Archived",searchQuery:v.value,selectedTags:I.value,onRefresh:q,onOpenElectronicSignature:K},null,8,["searchQuery","selectedTags"])])):h("",!0),O.value==="finished-documents"?(s(),r("div",kf,[n(du,{searchQuery:v.value,selectedTags:I.value},null,8,["searchQuery","selectedTags"])])):h("",!0),O.value==="in-progress-documents"?(s(),r("div",Cf,[n(Dm,{searchQuery:v.value,selectedTags:I.value},null,8,["searchQuery","selectedTags"])])):h("",!0),H.value.length===0?(s(),r("div",Df,Ff)):h("",!0)]))])):h("",!0),U.value==="client"||U.value==="basic"||U.value==="corporate_client"?(s(),r("div",Ef,[e("div",Tf,[e("div",Af,[e("nav",jf,[(s(),r(pe,null,he(Ne,M=>e("button",{key:M.name,onClick:me(Te=>Pe(M.name),["stop"]),class:P([Y.value===M.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},g(M.label),11,Mf)),64))]),e("div",Pf,[e("div",Lf,[e("button",{onClick:me(L,["stop"]),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border text-purple-600 hover:bg-purple-50 border-purple-200"},[n(t($t),{class:"h-4 w-4"}),re(" Firma Electrónica ")])]),e("div",Bf,[e("button",{onClick:me(_e,["stop"]),disabled:t(f),class:P(["inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border",t(f)?"text-green-400 bg-gray-50 border-gray-200 cursor-not-allowed opacity-60":"text-green-600 hover:bg-green-50 border-green-200"])},[n(t(qe),{class:"h-4 w-4"}),re(" Membrete Global ")],10,Rf),t(f)?(s(),r("div",zf,[re(" Actualiza tu suscripción para usar esta funcionalidad "),If])):h("",!0)]),e("button",{onClick:a[5]||(a[5]=me(M=>de("useDocument"),["stop"])),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[n(t(Ge),{class:"h-4 w-4"}),re(" Nuevo Documento ")])])]),e("div",Uf,[e("button",{onClick:a[6]||(a[6]=me(M=>ue.value=!ue.value,["stop"])),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,g(((ce=Ne.find(M=>M.name===Y.value))==null?void 0:ce.label)||"Seleccionar sección"),1),(s(),r("svg",{class:P(["ml-2 h-5 w-5 transition-transform duration-200",ue.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Of,2))]),ue.value?(s(),r("div",qf,[(s(),r(pe,null,he(Ne,M=>e("button",{key:M.name,onClick:me(Te=>Pe(M.name),["stop"]),class:P(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",Y.value===M.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},g(M.label),11,Vf)),64))])):h("",!0)]),e("div",Qf,[e("div",Wf,[e("button",{onClick:me(L,["stop"]),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-purple-600 bg-purple-50 hover:bg-purple-100"},[n(t($t),{class:"h-5 w-5"}),re(" Firma Electrónica ")])]),e("div",Hf,[e("button",{onClick:me(_e,["stop"]),disabled:t(f),class:P(["w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors",t(f)?"text-green-400 bg-gray-50 cursor-not-allowed opacity-60":"text-green-600 bg-green-50 hover:bg-green-100"])},[n(t(qe),{class:"h-5 w-5"}),re(" Membrete Global ")],10,Gf),t(f)?(s(),r("div",Zf,[re(" Actualiza tu suscripción para usar esta funcionalidad "),Jf])):h("",!0)]),e("button",{onClick:a[7]||(a[7]=me(M=>de("useDocument"),["stop"])),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[n(t(Ge),{class:"h-5 w-5"}),re(" Nuevo Documento ")])])]),C.value==="useDocument"?(s(),r("div",Kf,[n(ls,{searchQuery:v.value,selectedTags:I.value,onGoBack:Ue},null,8,["searchQuery","selectedTags"])])):(s(),r("div",Yf,[Y.value==="folders"?(s(),le(ns,{key:0,searchQuery:v.value,selectedTags:I.value,onRefresh:q,onNavigateToMain:Ue},null,8,["searchQuery","selectedTags"])):Y.value==="my-documents"?(s(),le(Ot,{key:1,searchQuery:v.value,"onUpdate:searchQuery":a[8]||(a[8]=M=>v.value=M),selectedTags:I.value,"is-loading":t(i).isLoading,"card-type":"client","show-state-filter":!0,"show-client-filter":!1,"show-associations-column":!0,context:"my-documents",onRefresh:q},null,8,["searchQuery","selectedTags","is-loading"])):Y.value==="pending-signatures"?(s(),le(it,{key:2,state:"PendingSignatures",searchQuery:v.value,selectedTags:I.value,onRefresh:q,onOpenElectronicSignature:R,onDocumentFullySigned:ve,onDocumentRejected:W},null,8,["searchQuery","selectedTags"])):Y.value==="signed-documents"?(s(),le(it,{key:3,state:"FullySigned",searchQuery:v.value,selectedTags:I.value,onRefresh:q,onOpenElectronicSignature:R},null,8,["searchQuery","selectedTags"])):Y.value==="archived-documents"?(s(),le(it,{key:4,state:"Archived",searchQuery:v.value,selectedTags:I.value,onRefresh:q,onOpenElectronicSignature:R},null,8,["searchQuery","selectedTags"])):h("",!0)]))])):h("",!0)])]),ee.value?(s(),le(Je,{key:0},{default:j(()=>[e("div",{class:"w-full h-full flex items-center justify-center p-4",onClick:me(J,["self"])},[n(Ep,{onClose:J})])]),_:1})):h("",!0),Z.value&&E.value?(s(),le(Je,{key:1},{default:j(()=>[e("div",{class:"w-full h-full flex items-center justify-center p-4 sm:p-6",onClick:a[11]||(a[11]=me(M=>Z.value=!1,["self"]))},[e("div",Xf,[e("div",ey,[ty,e("button",{onClick:a[9]||(a[9]=M=>Z.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[n(t(je),{class:"h-6 w-6"})])]),e("div",sy,[n(Xt,{"user-id":E.value.id,"initial-show-options":!E.value.has_signature,onSignatureSaved:x,onCancel:a[10]||(a[10]=M=>Z.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):h("",!0),ne.value&&E.value?(s(),le(Je,{key:2},{default:j(()=>[e("div",{class:"w-full h-full flex items-center justify-center p-4 sm:p-6",onClick:a[14]||(a[14]=me(M=>ne.value=!1,["self"]))},[e("div",oy,[e("div",ay,[ry,e("button",{onClick:a[12]||(a[12]=M=>ne.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[n(t(je),{class:"h-6 w-6"})])]),e("div",ny,[n(Xt,{"user-id":E.value.id,"initial-show-options":!E.value.has_signature,onSignatureSaved:x,onCancel:a[13]||(a[13]=M=>ne.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):h("",!0),n(Ht,{isVisible:t(at),documentData:t(Wt),onClose:a[15]||(a[15]=M=>at.value=!1)},null,8,["isVisible","documentData"]),n(Vh,{isVisible:k.value,onClose:a[16]||(a[16]=M=>k.value=!1),onUploaded:xe,onDeleted:Ie},null,8,["isVisible"])],64)}}};export{By as default};
