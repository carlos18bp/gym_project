import{e as s,f as r,g as e,u as et,r as b,aL as rs,o as Qe,at as pt,c as z,h as n,j as t,B as Ae,w as ke,v as Ee,n as j,l as h,t as g,m as pe,p as re,s as $e,b6 as hs,i as A,ae as Ve,ac as ns,b7 as fs,U as ht,k as le,a5 as Ge,F as ge,D as Zt,E as ls,G as ys,a3 as vs,C as bs,W as we,J as he,I as Ze,a4 as Ne,ai as Pe,af as Le,ag as Be,ah as ye,b8 as xs,Q as Ct,T as Dt,a8 as _s,aj as ot,aZ as ws,ak as St,an as qt,ao as $s,ap as ks,H as Cs,b9 as _t,ba as Jt}from"./index.js";import{u as qe,o as Ds,s as tt,p as Vt}from"./index2.js";import{g as mt,a as gt}from"./DocumentPermissionsManager.js";import{r as Ss,_ as Qt,a as Ft}from"./DocumentRelationshipsModal.js";import{_ as Et}from"./_plugin-vue_export-helper.js";import{B as Fs,r as Es,a as Tt,b as At,_ as Wt,c as Ht,D as is,d as Ts,L as Mt,s as Kt}from"./index3.js";import{r as $t}from"./FolderIcon.js";import{r as We}from"./PlusIcon.js";import{r as it}from"./EllipsisVerticalIcon.js";import{r as at}from"./DocumentIcon.js";import{_ as As}from"./DocumentCard.js";import{r as ds}from"./EyeIcon.js";import{r as ft}from"./ChevronRightIcon.js";import{_ as Yt}from"./SignatureDocumentCard.js";import{r as Nt,a as Ms,b as js}from"./TagIcon.js";import{r as Oe}from"./ChevronDownIcon.js";import{r as He}from"./MagnifyingGlassIcon.js";import{r as kt}from"./CheckCircleIcon.js";import{r as Xt}from"./PencilIcon.js";import{r as Ot}from"./TrashIcon.js";import{a as cs,r as es}from"./LinkIcon.js";import{r as us}from"./PhotoIcon.js";import{r as st,a as Ps}from"./FunnelIcon.js";import{r as Ls}from"./ArrowLeftIcon.js";import{r as jt}from"./CubeTransparentIcon.js";import{r as ts}from"./CloudArrowUpIcon.js";import{r as Bs}from"./ExclamationTriangleIcon.js";import"./useRecentViews.js";import"./loading_message.js";function ss(a,w){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})])}function Rs(a,w){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})])}function zs(a,w){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})])}function Us(a,w){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const Is={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Ns={class:"flex justify-end"},Os=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[re(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),qs={class:"mt-2"},Vs={class:"flex gap-2 mt-2.5"},Qs=["disabled"],Ws=e("span",null,"Actualizar nombre",-1),Hs=[Ws],Gs=["disabled"],ms={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(a,{emit:w}){const i=a,c=et(),D=qe(),v=w,f=b(""),F=b(""),y=()=>{v("close")};rs(()=>{var X,k;D.selectedDocument?(f.value=((X=D.selectedDocument)==null?void 0:X.title)||"",F.value=((k=D.selectedDocument)==null?void 0:k.title)||""):(f.value="",F.value="")});const C=X=>{X.key==="Escape"&&y()};Qe(()=>{document.addEventListener("keydown",C)}),pt(()=>{document.removeEventListener("keydown",C)});const G=z(()=>f.value.trim().length>0),te=z(()=>{var X;return!!((X=D.selectedDocument)!=null&&X.id)}),ee=z(()=>te.value&&f.value.trim()!==F.value.trim()&&f.value.trim().length>0);async function O(){if(te.value&&ee.value)try{const X={title:f.value.trim()};await D.updateDocument(D.selectedDocument.id,X),F.value=f.value.trim(),D.selectedDocument.title=f.value.trim();const k=D.selectedDocument.id;$e("Document name successfully updated.","success"),v("close",{updatedDocId:k});const T=window.location.pathname;T==="/dynamic_document_dashboard"||T==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(X){console.error("Error updating document name:",X),$e("Error updating document name.","error")}}function ne(){const X=encodeURIComponent(f.value.trim());i.documentId&&!D.selectedDocument?c.push(`/dynamic_document_dashboard/document/use/creator/${i.documentId}/${X}`):D.selectedDocument?(D.selectedDocument.title=f.value.trim(),c.push(`/dynamic_document_dashboard/document/use/editor/${D.selectedDocument.id}/${X}`)):$e("Error: No se pudo continuar. Documento no seleccionado.","error")}return(X,k)=>(s(),r("div",Is,[e("div",Ns,[e("button",{onClick:y},[n(t(Ae),{class:"size-6"})])]),e("form",{onSubmit:pe(ne,["prevent"])},[e("div",null,[Os,e("div",qs,[ke(e("input",{"onUpdate:modelValue":k[0]||(k[0]=d=>f.value=d),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[Ee,f.value]])])]),e("div",Vs,[te.value?(s(),r("button",{key:0,type:"button",onClick:O,disabled:!ee.value,class:j(["p-2.5 text-sm font-medium rounded-md flex gap-2",ee.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Hs,10,Qs)):h("",!0),e("button",{type:"submit",class:j(["p-2.5 text-sm font-medium rounded-md flex gap-2",G.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!G.value},[e("span",null,g(te.value?"Editar Documento":"Continuar"),1)],10,Gs)])],32)]))}},Zs={class:"mt-3 pt-2 border-t border-gray-100"},Js={class:"flex items-center gap-2 text-xs text-gray-500"},Ks=e("span",null,"Hacer clic para usar este documento",-1),Ys={__name:"UseDocumentCard",props:{document:{type:Object,required:!0},showTags:{type:Boolean,default:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null},additionalClasses:{type:String,default:""}},emits:["click","remove-from-folder","document-created"],setup(a,{emit:w}){const i=a,c=w,D=b(!1),v=b(null),f=mt(9),F=z(()=>"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium !bg-purple-100 !text-purple-700 !border !border-purple-200"),y=z(()=>f.dark),C=z(()=>{const k="group !border-purple-400 !bg-purple-50/50 !shadow-purple-100";return i.additionalClasses?`${k} ${i.additionalClasses}`:k}),G=z(()=>i.menuOptions!==null?i.menuOptions:[{label:"Usar",action:"use",icon:Rs,iconClasses:"w-4 h-4 text-purple-600"},{label:"Previsualización",action:"preview",icon:ds,iconClasses:"w-4 h-4 text-gray-600"}]),te=z(()=>!1),ee=(k,d)=>{i.disableInternalActions?c("click",k,d):ne(k.id)},O=(k,d)=>{switch(k){case"use":ne(d.id);break;case"preview":Ds(d);break;default:console.warn("Unknown menu action:",k)}};function ne(k){k?(v.value=k,D.value=!0):console.error("Document ID is required:",k)}function X(k){if(D.value=!1,v.value=null,k&&k.updatedDocId){c("document-created",k);const d=window.location.pathname;d==="/dynamic_document_dashboard"||d==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(k.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}}return(k,d)=>(s(),r(ge,null,[n(Fs,{document:a.document,"card-type":a.cardType,"card-context":a.cardContext,"status-icon":t(fs),"status-text":"Disponible","status-badge-classes":F.value,"menu-options":G.value,"highlighted-doc-id":null,"show-tags":a.showTags,"document-store":a.documentStore,"user-store":a.userStore,"additional-classes":C.value,"disable-internal-actions":a.disableInternalActions,"show-menu-options":a.showMenuOptions,onClick:ee,onMenuAction:O,onRemoveFromFolder:d[0]||(d[0]=T=>k.$emit("remove-from-folder",T))},hs({"additional-actions":A(()=>[ns(k.$slots,"additional-actions")]),_:2},[te.value?{name:"right-action",fn:A(()=>[n(t(ft),{class:"w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors"})]),key:"0"}:void 0,a.disableInternalActions?void 0:{name:"footer",fn:A(()=>[e("div",Zs,[e("div",Js,[e("div",{class:"w-2 h-2 rounded-full",style:Ve({backgroundColor:y.value})},null,4),Ks])])]),key:"1"}]),1032,["document","card-type","card-context","status-icon","status-badge-classes","menu-options","show-tags","document-store","user-store","additional-classes","disable-internal-actions","show-menu-options"]),ke(n(Ge,null,{default:A(()=>[v.value!==null?(s(),le(ms,{key:0,"document-id":v.value,onClose:X},null,8,["document-id"])):h("",!0)]),_:1},512),[[ht,D.value]])],64))}},Xs=()=>({folders:[],currentFolder:null,isLoading:!1,error:null,lastUpdatedFolderId:null}),eo={sortedFolders:a=>[...a.folders].sort((w,i)=>new Date(i.created_at)-new Date(w.created_at)),getFolderById:a=>w=>a.folders.find(i=>i.id===w),getFoldersByColor:a=>w=>a.folders.filter(i=>i.color_id===w),getFolderWithColor:a=>w=>{const i=a.folders.find(c=>c.id===w);return i?{...i,color:mt(i.color_id)}:null},getFoldersContainingDocument:a=>w=>a.folders.filter(i=>i.document_ids&&i.document_ids.includes(w)),totalDocumentsInFolders:a=>a.folders.reduce((w,i)=>w+(i.document_ids?i.document_ids.length:0),0),hasFolders:a=>a.folders.length>0,availableColors:()=>gt()},to={async init(a=!1){if(!(this.folders.length>0&&!a)){this.isLoading=!0,this.error=null;try{await this.fetchFolders()}catch(w){console.error("Error initializing document folder store:",w),this.error="Error al inicializar las carpetas"}finally{this.isLoading=!1}}},async fetchFolders(){try{const a=await Zt("dynamic-documents/folders/");if(a.status===200)return this.folders=a.data,a.data;throw new Error(`Error fetching folders: ${a.status}`)}catch(a){throw console.error("Error fetching folders:",a),this.error="Error al obtener las carpetas",a}},async fetchFolder(a){this.isLoading=!0,this.error=null;try{const w=await Zt(`dynamic-documents/folders/${a}/`);if(w.status===200){const i=w.data,c=this.folders.findIndex(D=>D.id===i.id);return c!==-1?this.folders[c]=i:this.folders.push(i),this.currentFolder=i,i}else throw new Error(`Error fetching folder: ${w.status}`)}catch(w){throw console.error("Error fetching folder:",w),this.error="Error al obtener la carpeta",w}finally{this.isLoading=!1}},async createFolder(a){this.isLoading=!0,this.error=null;try{if(!a.name||a.name.trim()==="")throw new Error("El nombre de la carpeta es requerido");const w=a.color_id??0;if(w<0||w>=gt().length)throw new Error("Color de carpeta no válido");const i={name:a.name.trim(),color_id:w,...a.document_ids&&{document_ids:a.document_ids}},c=await ls("dynamic-documents/folders/create/",i);if(c.status===200||c.status===201){const D=c.data;return this.folders.push(D),this.lastUpdatedFolderId=D.id,$e("Carpeta creada exitosamente","success"),D}else throw new Error(`Error creating folder: ${c.status}`)}catch(w){throw console.error("Error creating folder:",w),this.error=w.message||"Error al crear la carpeta",$e(this.error,"error"),w}finally{this.isLoading=!1}},async updateFolder(a,w){this.isLoading=!0,this.error=null;try{if(w.name&&w.name.trim()==="")throw new Error("El nombre de la carpeta no puede estar vacío");if(w.color_id!==void 0){const D=w.color_id;if(D<0||D>=gt().length)throw new Error("Color de carpeta no válido")}const i={};w.name&&(i.name=w.name.trim()),w.color_id!==void 0&&(i.color_id=w.color_id),w.document_ids!==void 0&&(i.document_ids=w.document_ids);const c=await ys(`dynamic-documents/folders/${a}/update/`,i);if(c.status===200){const D=c.data,v=this.folders.findIndex(f=>f.id===a);return v!==-1&&(this.folders[v]=D),this.currentFolder&&this.currentFolder.id===a&&(this.currentFolder=D),this.lastUpdatedFolderId=a,$e("Carpeta actualizada exitosamente","success"),D}else throw new Error(`Error updating folder: ${c.status}`)}catch(i){throw console.error("Error updating folder:",i),this.error=i.message||"Error al actualizar la carpeta",$e(this.error,"error"),i}finally{this.isLoading=!1}},async deleteFolder(a){this.isLoading=!0,this.error=null;try{const w=await vs(`dynamic-documents/folders/${a}/delete/`);if(w.status===204||w.status===200)return this.folders=this.folders.filter(i=>i.id!==a),this.currentFolder&&this.currentFolder.id===a&&(this.currentFolder=null),await $e("Carpeta eliminada exitosamente","success"),!0;throw new Error(`Error deleting folder: ${w.status}`)}catch(w){throw console.error("Error deleting folder:",w),this.error=w.message||"Error al eliminar la carpeta",await $e(this.error,"error"),w}finally{this.isLoading=!1}},setCurrentFolder(a){this.currentFolder=a},clearCurrentFolder(){this.currentFolder=null},reset(){this.folders=[],this.currentFolder=null,this.isLoading=!1,this.error=null,this.lastUpdatedFolderId=null}},so={async addDocumentsToFolder(a,w){const i=this.getFolderById(a);if(!i)throw new Error("Carpeta no encontrada");const c=i.document_ids||[],D=[...new Set([...c,...w])];return await this.updateFolder(a,{document_ids:D})},async removeDocumentsFromFolder(a,w){const i=this.getFolderById(a);if(!i)throw new Error("Carpeta no encontrada");const D=(i.document_ids||[]).filter(v=>!w.includes(v));return await this.updateFolder(a,{document_ids:D})},async moveDocumentsBetweenFolders(a,w,i){try{w&&await this.removeDocumentsFromFolder(w,a),i&&await this.addDocumentsToFolder(i,a),await $e("Documentos movidos exitosamente","success")}catch(c){throw console.error("Error moving documents between folders:",c),await $e("Error al mover documentos","error"),c}},getFolderColor(a){const w=this.getFolderById(a);return w?mt(w.color_id):mt(0)},validateFolderData(a){const w=[];if((!a.name||a.name.trim()==="")&&w.push("El nombre de la carpeta es requerido"),a.name&&a.name.length>100&&w.push("El nombre de la carpeta no puede exceder 100 caracteres"),a.color_id!==void 0){const i=a.color_id;(i<0||i>=gt().length)&&w.push("Color de carpeta no válido")}return a.document_ids&&!Array.isArray(a.document_ids)&&w.push("Los IDs de documentos deben ser un array"),{isValid:w.length===0,errors:w}}},Gt=bs("documentFolder",{state:Xs,getters:eo,actions:{...to,...so}}),oo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ao={class:"bg-white rounded-xl shadow-xl max-w-md w-full"},ro={class:"flex justify-between items-center p-6 border-b"},no={class:"text-lg font-semibold text-gray-900"},lo={class:"mb-4"},io=e("label",{for:"folderName",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la carpeta ",-1),co={class:"mb-6"},uo=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Color de la carpeta ",-1),mo={class:"grid grid-cols-8 gap-2"},go=["onClick","title"],po={class:"flex gap-3"},ho=["disabled"],fo={__name:"CreateEditFolderModal",props:{isVisible:{type:Boolean,required:!0},editingFolder:{type:Object,default:null}},emits:["close","success"],setup(a,{emit:w}){const i=a,c=w,D=Gt(),v=b(!1),f=b({name:"",color_id:0}),F=z(()=>gt()),y=()=>{f.value={name:"",color_id:0}};we(()=>i.editingFolder,te=>{te?f.value={name:te.name,color_id:te.color_id}:y()},{immediate:!0}),we(()=>i.isVisible,te=>{te||y()});const C=()=>{c("close")},G=async()=>{if(f.value.name.trim()){v.value=!0;try{i.editingFolder?await D.updateFolder(i.editingFolder.id,f.value):await D.createFolder(f.value),v.value=!1,c("success")}catch{v.value=!1}}};return(te,ee)=>a.isVisible?(s(),le(Ge,{key:0},{default:A(()=>[e("div",oo,[e("div",ao,[e("div",ro,[e("h3",no,g(a.editingFolder?"Editar Carpeta":"Nueva Carpeta"),1),e("button",{onClick:C,class:"text-gray-400 hover:text-gray-500"},[n(t(Ae),{class:"w-6 h-6"})])]),e("form",{onSubmit:pe(G,["prevent"]),class:"p-6"},[e("div",lo,[io,ke(e("input",{id:"folderName","onUpdate:modelValue":ee[0]||(ee[0]=O=>f.value.name=O),type:"text",required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ej: Contratos Laborales"},null,512),[[Ee,f.value.name]])]),e("div",co,[uo,e("div",mo,[(s(!0),r(ge,null,he(F.value,O=>(s(),r("button",{key:O.id,type:"button",onClick:ne=>f.value.color_id=O.id,class:j(["w-8 h-8 rounded-full border-2 transition-all",f.value.color_id===O.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"]),style:Ve({backgroundColor:O.hex}),title:O.name},null,14,go))),128))])]),e("div",po,[e("button",{type:"button",onClick:C,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:!f.value.name.trim()||v.value,class:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},g(v.value?"Guardando...":a.editingFolder?"Actualizar":"Crear"),9,ho)])],32)])])]),_:1})):h("",!0)}},yo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},vo={class:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col"},bo={class:"border-b px-6 py-4 flex-shrink-0"},xo={class:"flex justify-between items-center"},_o={class:"flex items-center gap-3"},wo={class:"text-xl font-semibold text-gray-900"},$o={class:"text-sm text-gray-600"},ko={class:"flex items-center gap-2"},Co={class:"flex-1 overflow-y-auto p-6"},Do={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},So={class:"min-w-full divide-y divide-gray-200"},Fo=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tipo "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),Eo={class:"bg-white divide-y divide-gray-200"},To=["onClick"],Ao={class:"px-6 py-4 whitespace-nowrap"},Mo={class:"flex items-center"},jo={class:"flex-shrink-0 h-10 w-10"},Po={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Lo={class:"ml-4"},Bo={class:"text-sm font-medium text-gray-900"},Ro={class:"px-6 py-4 whitespace-nowrap"},zo={class:"text-sm text-gray-600"},Uo={class:"px-6 py-4 whitespace-nowrap"},Io={class:"px-6 py-4 whitespace-nowrap"},No={class:"flex flex-wrap gap-1"},Oo={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},qo={key:1,class:"text-sm text-gray-400"},Vo={class:"py-1"},Qo=["onClick"],Wo=["onClick"],Ho={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Go=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"Esta carpeta está vacía",-1),Zo=e("p",{class:"text-gray-600 mb-4"},"Agrega documentos para organizar tu trabajo",-1),Jo={__name:"FolderDetailsModalTable",props:{folder:{type:Object,default:null}},emits:["close","add-documents","remove-document","view-document","use-document","document-action"],setup(a,{emit:w}){const i=a,c=w;Ze(),qe();const D=b({}),v=b({}),f=b(!1),F=b(-1),y=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],C=z(()=>{if(!i.folder)return y[0];if(i.folder.color)return y.find(I=>I.name===i.folder.color)||y[0];const E=i.folder.id%y.length;return y[E]}),G=E=>E.state==="Published"||E.state==="Draft"?"Formato":E.state==="PendingSignatures"||E.state==="FullySigned"?"Para Firmar":E.state==="Progress"||E.state==="Completed"?"Mis Documentos":"Documento",te=E=>({Published:"Publicado",Draft:"Borrador",Progress:"En Progreso",Completed:"Completado",PendingSignatures:"Pendiente Firma",FullySigned:"Firmado"})[E.state]||E.state,ee=E=>({Published:"bg-green-100 text-green-700 border border-green-200",Draft:"bg-gray-100 text-gray-700 border border-gray-200",Progress:"bg-blue-100 text-blue-700 border border-blue-200",Completed:"bg-green-100 text-green-700 border border-green-200",PendingSignatures:"bg-yellow-100 text-yellow-700 border border-yellow-200",FullySigned:"bg-green-100 text-green-700 border border-green-200"})[E.state]||"bg-gray-100 text-gray-700 border border-gray-200",O=E=>{const I=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],Z=E.id%I.length;return I[Z]},ne=()=>{c("close")},X=()=>{c("add-documents",i.folder)},k=E=>{c("remove-document",{folderId:i.folder.id,documentId:E.id})},d=E=>{const I=G(E);c(I==="Formato"?"use-document":"view-document",E)},T=()=>!f.value||!i.folder?"auto":i.folder.documents.length===1?"280px":i.folder.documents.length===2&&F.value===1?"340px":"280px",R=(E,I)=>{E&&(D.value[I]=E)},U=(E,I)=>{E&&(v.value[I]=E)},$=(E,I)=>{f.value=!I,F.value=I?-1:E,I||setTimeout(()=>{const Z=v.value[E];if(Z){const de=Z.$el||Z;if(de&&de.getBoundingClientRect){const Y=de.getBoundingClientRect(),q=window.innerHeight;if(E===0){if(Y.bottom>q-20){const J=Y.bottom-q+40;window.scrollBy({top:J,behavior:"smooth"})}}else if(Y.bottom>q-10){const J=Y.bottom-q+30;window.scrollBy({top:J,behavior:"smooth"})}else if(Y.top<80){const J=Y.top-100;window.scrollBy({top:J,behavior:"smooth"})}}}},100)};return(E,I)=>a.folder?(s(),le(Ge,{key:0},{default:A(()=>[e("div",yo,[e("div",vo,[e("div",bo,[e("div",xo,[e("div",_o,[e("div",{class:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:Ve({backgroundColor:C.value.hex+"20"})},[n(t($t),{class:"h-6 w-6",style:Ve({color:C.value.hex})},null,8,["style"])],4),e("div",null,[e("h3",wo,g(a.folder.name),1),e("p",$o,g(a.folder.documents.length)+" documento"+g(a.folder.documents.length!==1?"s":""),1)])]),e("div",ko,[e("button",{onClick:X,class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"},[n(t(We),{class:"w-5 h-5"}),re(" Agregar documentos ")]),e("button",{onClick:ne,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[n(t(Ae),{class:"w-6 h-6"})])])])]),e("div",Co,[a.folder.documents.length>0?(s(),r("div",Do,[e("div",{class:"overflow-x-auto",style:Ve({minHeight:T()})},[e("table",So,[Fo,e("tbody",Eo,[(s(!0),r(ge,null,he(a.folder.documents,(Z,de)=>{var Y;return s(),r("tr",{key:Z.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:q=>d(Z)},[e("td",Ao,[e("div",Mo,[e("div",jo,[e("div",Po,[n(t(Ne),{class:"h-5 w-5 text-blue-600"})])]),e("div",Lo,[e("div",Bo,g(Z.title),1)])])]),e("td",Ro,[e("span",zo,g(G(Z)),1)]),e("td",Uo,[e("span",{class:j(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ee(Z)])},g(te(Z)),3)]),e("td",Io,[e("div",No,[(s(!0),r(ge,null,he((Y=Z.tags)==null?void 0:Y.slice(0,2),q=>(s(),r("span",{key:q.id,class:j(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",O(q)])},g(q.name),3))),128)),Z.tags&&Z.tags.length>2?(s(),r("span",Oo," +"+g(Z.tags.length-2),1)):h("",!0),!Z.tags||Z.tags.length===0?(s(),r("span",qo,"-")):h("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:I[0]||(I[0]=pe(()=>{},["stop"]))},[n(t(Pe),{as:"div",class:"relative inline-block text-left"},{default:A(({open:q})=>[n(t(Le),{ref_for:!0,ref:J=>R(J,de),onClick:J=>$(de,q),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:A(()=>[n(t(it),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),n(t(Be),{ref_for:!0,ref:J=>U(J,de),class:j([a.folder.documents.length>2&&de>0&&de>=a.folder.documents.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:A(()=>[e("div",Vo,[n(t(ye),null,{default:A(({active:J})=>[e("a",{onClick:P=>d(Z),class:j([J?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver documento ",10,Qo)]),_:2},1024),n(t(ye),null,{default:A(({active:J})=>[e("a",{onClick:P=>k(Z),class:j([J?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Quitar de carpeta ",10,Wo)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,To)}),128))])])],4)])):(s(),r("div",Ho,[n(t(at),{class:"w-12 h-12 text-gray-300 mx-auto mb-4"}),Go,Zo,e("button",{onClick:X,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},[n(t(We),{class:"w-5 h-5"}),re(" Agregar documentos ")])]))])])])]),_:1})):h("",!0)}},yt=a=>(Ct("data-v-d403a707"),a=a(),Dt(),a),Ko={class:"tag-filter-container"},Yo={class:"relative"},Xo={class:"flex items-center"},ea={key:0,class:"ml-2 inline-flex items-center justify-center h-5 w-5 bg-primary text-white text-xs rounded-full font-medium"},ta={key:0,class:"absolute left-0 mt-2 w-full sm:w-80 bg-white rounded-xl shadow-xl ring-1 ring-black ring-opacity-5 border border-gray-100 z-50 overflow-hidden"},sa={class:"bg-gray-50 p-4 border-b border-gray-200"},oa={class:"flex items-center justify-between mb-3"},aa=yt(()=>e("h3",{class:"text-sm font-semibold text-gray-900"},"Filtrar por etiquetas",-1)),ra={key:0,class:"text-xs text-gray-500"},na={class:"relative"},la={key:0,class:"px-4 py-2 bg-blue-50 border-b border-blue-100"},ia={class:"flex items-center justify-between"},da={class:"text-xs font-medium text-blue-700"},ca={class:"max-h-52 overflow-y-auto"},ua={key:0,class:"px-4 py-8 text-center"},ma=yt(()=>e("p",{class:"text-gray-500 text-sm"},"No hay etiquetas disponibles",-1)),ga={key:1,class:"px-4 py-8 text-center"},pa={class:"text-gray-500 text-sm"},ha={key:2,class:"px-4 py-8 text-center"},fa=yt(()=>e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"}),e("span",{class:"ml-3 text-sm text-gray-600"},"Cargando etiquetas...")],-1)),ya=[fa],va={key:3,class:"py-2"},ba=["onClick"],xa={class:"flex items-center h-5"},_a={class:"relative"},wa=["id","checked","onChange"],$a={key:0,class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},ka=yt(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),Ca=[ka],Da={class:"ml-3 flex items-center flex-1 min-w-0"},Sa={class:"text-sm font-medium text-gray-900 truncate"},Fa={key:0,class:"mt-4"},Ea={class:"flex items-start gap-2"},Ta=yt(()=>e("span",{class:"text-xs font-medium text-gray-500 mt-1.5 flex-shrink-0"},"Activos:",-1)),Aa={class:"flex flex-wrap gap-2"},Ma=["onClick"],ja={class:"mr-1"},Pa={class:"ml-1 p-0.5 rounded-full hover:bg-white/50 transition-colors duration-150"},La={__name:"TagFilter",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(a,{emit:w}){const i=a,c=w,D=qe(),v=b(!1),f=b([]),F=b(!1),y=b(""),C=z(()=>D.sortedTags),G=z(()=>{if(!y.value.trim())return C.value;const d=y.value.toLowerCase().trim();return C.value.filter(T=>T.name.toLowerCase().includes(d))}),te=d=>{const T=mt(d.color_id);return{hex:T&&T.hex?T.hex:"#9CA3AF",dark:T&&T.dark?T.dark:"#374151"}},ee=()=>{v.value=!v.value,v.value&&(y.value="")},O=d=>f.value.some(T=>T.id===d.id),ne=d=>{const T=f.value.findIndex(R=>R.id===d.id);T>=0?f.value.splice(T,1):f.value.push(d),c("update:modelValue",f.value)},X=()=>{f.value=[],c("update:modelValue",[])},k=d=>{d.target.closest(".tag-filter-container")||(v.value=!1,y.value="")};return Qe(async()=>{try{F.value=!0,await D.initTags()}catch(d){console.error("Error loading tags:",d)}finally{F.value=!1}document.addEventListener("click",k)}),we(()=>i.modelValue,d=>{f.value=d||[]},{immediate:!0}),pt(()=>{document.removeEventListener("click",k)}),(d,T)=>(s(),r("div",Ko,[e("div",Yo,[e("button",{onClick:ee,class:j(["group inline-flex items-center justify-between w-full sm:w-auto sm:min-w-[200px] px-4 py-3 border border-gray-200 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-primary transition-all duration-200",{"ring-2 ring-primary border-primary bg-blue-50":v.value,"border-primary bg-primary/5":f.value.length>0&&!v.value}])},[e("div",Xo,[n(t(Nt),{class:j(["h-5 w-5 mr-2.5 text-gray-500 group-hover:text-gray-600",{"text-primary":f.value.length>0||v.value}])},null,8,["class"]),e("span",{class:j(["text-gray-700",{"text-primary font-semibold":f.value.length>0||v.value}])}," Filtrar por etiquetas ",2),f.value.length>0?(s(),r("span",ea,g(f.value.length),1)):h("",!0)]),n(t(Oe),{class:j(["ml-3 h-4 w-4 text-gray-400 transition-all duration-200 group-hover:text-gray-600",{"rotate-180 text-primary":v.value,"text-primary":f.value.length>0&&!v.value}])},null,8,["class"])],2),n(xs,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:A(()=>[v.value?(s(),r("div",ta,[e("div",sa,[e("div",oa,[aa,C.value.length>0?(s(),r("span",ra,g(C.value.length)+" disponibles ",1)):h("",!0)]),e("div",na,[n(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":T[0]||(T[0]=R=>y.value=R),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"},null,512),[[Ee,y.value]])])]),f.value.length>0?(s(),r("div",la,[e("div",ia,[e("span",da,g(f.value.length)+" etiqueta"+g(f.value.length!==1?"s":"")+" seleccionada"+g(f.value.length!==1?"s":""),1),e("button",{onClick:X,class:"text-xs text-red-600 hover:text-red-700 font-medium px-2 py-1 rounded-md hover:bg-red-50 transition-all duration-200"}," Limpiar todo ")])])):h("",!0),e("div",ca,[!F.value&&G.value.length===0&&y.value.trim()===""?(s(),r("div",ua,[n(t(Nt),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),ma])):h("",!0),!F.value&&G.value.length===0&&y.value.trim()!==""?(s(),r("div",ga,[n(t(He),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e("p",pa,'Sin resultados para "'+g(y.value)+'"',1),e("button",{onClick:T[1]||(T[1]=R=>y.value=""),class:"text-xs text-primary hover:text-primary-dark mt-2 font-medium"}," Ver todas las etiquetas ")])):h("",!0),F.value?(s(),r("div",ha,ya)):h("",!0),!F.value&&G.value.length>0?(s(),r("div",va,[(s(!0),r(ge,null,he(G.value,R=>(s(),r("div",{key:R.id,class:"group flex items-center px-4 py-2.5 hover:bg-gray-50 cursor-pointer transition-colors duration-150",onClick:U=>ne(R)},[e("div",xa,[e("div",_a,[e("input",{id:`tag-${R.id}`,type:"checkbox",checked:O(R),onChange:U=>ne(R),class:"sr-only"},null,40,wa),e("div",{class:j(["w-4 h-4 border-2 rounded transition-all duration-200 flex items-center justify-center",O(R)?"bg-primary border-primary":"border-gray-300 group-hover:border-gray-400"])},[O(R)?(s(),r("svg",$a,Ca)):h("",!0)],2)])]),e("div",Da,[e("div",{class:"w-3 h-3 rounded-full mr-2.5 border flex-shrink-0 shadow-sm",style:Ve({backgroundColor:te(R).hex})},null,4),e("span",Sa,g(R.name),1)])],8,ba))),128))])):h("",!0)])])):h("",!0)]),_:1})]),f.value.length>0?(s(),r("div",Fa,[e("div",Ea,[Ta,e("div",Aa,[(s(!0),r(ge,null,he(f.value,R=>(s(),r("div",{key:R.id,class:"group inline-flex items-center pl-2.5 pr-1.5 py-1.5 rounded-lg text-xs font-medium border shadow-sm cursor-pointer transition-all duration-200 hover:shadow-md",style:Ve({backgroundColor:te(R).hex+"20",borderColor:te(R).hex+"40",color:te(R).dark}),onClick:U=>ne(R)},[e("div",{class:"w-2 h-2 rounded-full mr-2 flex-shrink-0",style:Ve({backgroundColor:te(R).hex})},null,4),e("span",ja,g(R.name),1),e("div",Pa,[n(t(Ae),{class:"h-3 w-3 opacity-60 group-hover:opacity-100"})])],12,Ma))),128))])])])):h("",!0)]))}},Ba=Et(La,[["__scopeId","data-v-d403a707"]]),Ra={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},za={class:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden"},Ua={class:"border-b"},Ia={class:"hidden sm:flex justify-between items-center p-6"},Na=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Oa={class:"text-sm text-gray-600"},qa={class:"sm:hidden p-4"},Va={class:"flex justify-between items-start mb-2"},Qa={class:"flex-1 min-w-0 mr-3"},Wa=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Ha={class:"text-sm text-gray-600 truncate"},Ga={class:"border-b"},Za={class:"hidden sm:flex space-x-8 px-6","aria-label":"Tabs"},Ja=["onClick"],Ka={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},Ya={class:"sm:hidden relative px-4 py-3"},Xa={class:"flex items-center"},er={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},tr=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),sr=[tr],or={class:"absolute top-full left-4 right-4 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},ar=["onClick"],rr={class:"border-b bg-gray-50 p-4 sm:p-6"},nr={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},lr={class:"flex-1"},ir={key:0,class:"flex items-center gap-3"},dr={class:"text-sm text-gray-600"},cr={class:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-350px)]"},ur={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},mr=["onClick"],gr=e("span",null,"Etiquetas",-1),pr=[gr],hr={key:5,class:"absolute top-2 left-2 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center shadow-sm"},fr={key:0,class:"text-center py-8 sm:py-12"},yr={class:"text-lg font-medium text-gray-900 mb-2"},vr={class:"text-gray-600 text-sm sm:text-base"},br={class:"border-t bg-gray-50"},xr={class:"hidden sm:flex justify-between items-center p-6"},_r={class:"text-sm text-gray-600"},wr={class:"flex gap-3"},$r=["disabled"],kr={class:"sm:hidden p-4 space-y-3"},Cr={class:"text-center text-sm text-gray-600"},Dr={class:"flex gap-3"},Sr=["disabled"],Fr={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 p-4"},Er={class:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] flex flex-col"},Tr={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},Ar={class:"flex items-center gap-2"},Mr=e("h2",{class:"text-sm font-semibold text-gray-900"},"Etiquetas del documento",-1),jr={class:"px-4 py-3 border-b border-gray-100 text-xs text-gray-500"},Pr=e("span",{class:"font-medium text-gray-700"},"Documento:",-1),Lr={class:"ml-1"},Br={class:"px-4 py-3 overflow-y-auto"},Rr={key:0,class:"text-sm text-gray-500"},zr={key:1,class:"space-y-2 text-sm"},Ur={class:"flex items-center gap-2 min-w-0"},Ir={key:0,class:"text-xs text-gray-500 truncate max-w-[8rem]"},Nr={__name:"AddDocumentsModal",props:{isVisible:{type:Boolean,required:!0},folder:{type:Object,default:null}},emits:["close","add-documents"],setup(a,{emit:w}){const i=a,c=w,D=qe(),v=Ze(),f=b([]),F=b([]),y=b("my-documents"),C=b(!1),G=b(!1),te=b(!1),ee=b(null),O=[{name:"my-documents",label:"Mis Documentos"},{name:"use-documents",label:"Minutas"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Documentos Firmados"}],ne=z(()=>v.currentUser);we(()=>i.isVisible,q=>{q&&(f.value=[],F.value=[],y.value="my-documents")}),we(y,()=>{f.value=[]}),we(F,()=>{f.value=[]},{deep:!0});const X=z(()=>{const q=d(y.value);return q.length===0?!1:q.every(J=>f.value.includes(J.id))}),k=q=>{var B;if(!i.folder)return[];const J=i.folder.documents.map(se=>se.id);let P=[];switch(q){case"my-documents":P=D.progressAndCompletedDocumentsByClient((B=ne.value)==null?void 0:B.id);break;case"use-documents":P=D.publishedDocumentsUnassigned;break;case"pending-signatures":P=D.documents.filter(se=>{var ve,N;return se.state==="PendingSignatures"&&(se.assigned_to===((ve=ne.value)==null?void 0:ve.id)||((N=se.signatures)==null?void 0:N.some(H=>{var Q;return H.signer_email===((Q=ne.value)==null?void 0:Q.email)})))});break;case"signed-documents":P=D.documents.filter(se=>{var ve,N;return se.state==="FullySigned"&&(se.assigned_to===((ve=ne.value)==null?void 0:ve.id)||((N=se.signatures)==null?void 0:N.some(H=>{var Q;return H.signer_email===((Q=ne.value)==null?void 0:Q.email)})))});break;default:P=[]}return P.filter(se=>!J.includes(se.id))},d=q=>{const J=k(q);if(!F.value||F.value.length===0)return J;const P=F.value.map(B=>B.id);return J.filter(B=>!B.tags||B.tags.length===0?!1:B.tags.some(se=>P.includes(se.id)))},T=q=>{const J=f.value.indexOf(q);J>-1?f.value.splice(J,1):f.value.push(q)},R=()=>{const J=d(y.value).map(P=>P.id);if(X.value)f.value=f.value.filter(P=>!J.includes(P));else{const P=J.filter(B=>!f.value.includes(B));f.value.push(...P)}},U=()=>{c("close")},$=async()=>{if(f.value.length!==0){C.value=!0;try{await c("add-documents",f.value)}finally{C.value=!1}}},E=q=>{y.value=q,G.value=!1},I=q=>{q.target.closest(".relative")||(G.value=!1)};Qe(()=>{document.addEventListener("click",I)}),pt(()=>{document.removeEventListener("click",I)});const Z=q=>{const J=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],P=q.id%J.length;return J[P]},de=q=>{ee.value=q,te.value=!0},Y=()=>{te.value=!1,ee.value=null};return(q,J)=>a.isVisible&&a.folder?(s(),le(Ge,{key:0},{default:A(()=>{var P;return[e("div",Ra,[e("div",za,[e("div",Ua,[e("div",Ia,[e("div",null,[Na,e("p",Oa,'Selecciona documentos para agregar a "'+g(a.folder.name)+'"',1)]),e("button",{onClick:U,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors"},[n(t(Ae),{class:"w-5 h-5"})])]),e("div",qa,[e("div",Va,[e("div",Qa,[Wa,e("p",Ha,'Para "'+g(a.folder.name)+'"',1)]),e("button",{onClick:U,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors flex-shrink-0"},[n(t(Ae),{class:"w-5 h-5"})])])])]),e("div",Ga,[e("nav",Za,[(s(),r(ge,null,he(O,B=>e("button",{key:B.name,onClick:se=>y.value=B.name,class:j([y.value===B.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[re(g(B.label)+" ",1),e("span",Ka,g(d(B.name).length),1)],10,Ja)),64))]),e("div",Ya,[e("button",{onClick:J[0]||(J[0]=B=>G.value=!G.value),class:"w-full flex items-center justify-between py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("div",Xa,[e("span",null,g(((P=O.find(B=>B.name===y.value))==null?void 0:P.label)||"Seleccionar categoría"),1),e("span",er,g(d(y.value).length),1)]),(s(),r("svg",{class:j(["ml-2 h-5 w-5 transition-transform duration-200",G.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},sr,2))]),ke(e("div",or,[(s(),r(ge,null,he(O,B=>e("button",{key:B.name,onClick:se=>E(B.name),class:j(["w-full text-left px-4 py-3 text-sm transition-colors duration-150 flex items-center justify-between",y.value===B.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},[e("span",null,g(B.label),1),e("span",{class:j(["py-0.5 px-2 rounded-full text-xs",y.value===B.name?"bg-white/20 text-white":"bg-gray-100 text-gray-600"])},g(d(B.name).length),3)],10,ar)),64))],512),[[ht,G.value]])])]),e("div",rr,[e("div",nr,[e("div",lr,[n(Ba,{modelValue:F.value,"onUpdate:modelValue":J[1]||(J[1]=B=>F.value=B),class:"max-w-md"},null,8,["modelValue"])]),d(y.value).length>0?(s(),r("div",ir,[e("span",dr,g(d(y.value).length)+" documento(s) disponible(s) ",1),e("button",{onClick:R,class:j(["px-4 py-2 rounded-lg border font-medium text-sm transition-colors",X.value?"bg-red-50 border-red-200 text-red-700 hover:bg-red-100":"bg-primary text-white border-primary hover:bg-primary-dark"])},g(X.value?"Deseleccionar todos":"Seleccionar todos"),3)])):h("",!0)])]),e("div",cr,[e("div",ur,[(s(!0),r(ge,null,he(d(y.value),B=>(s(),r("div",{key:B.id,class:"relative"},[y.value==="my-documents"?(s(),le(t(As),{key:0,document:B,"highlighted-doc-id":null,"show-tags":!1,"show-client-name":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":f.value.includes(B.id)?"ring-2 ring-primary bg-primary-50":"",onClick:se=>T(B.id)},null,8,["document","additional-classes","onClick"])):h("",!0),y.value==="use-documents"?(s(),le(t(Ys),{key:1,document:B,"show-tags":!1,"menu-options":[],"show-menu-options":!1,"disable-internal-actions":!0,"additional-classes":f.value.includes(B.id)?"ring-2 ring-primary bg-primary-50":"",onClick:se=>T(B.id)},null,8,["document","additional-classes","onClick"])):h("",!0),y.value==="pending-signatures"?(s(),le(t(Yt),{key:2,document:B,"highlighted-doc-id":null,"show-tags":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":f.value.includes(B.id)?"ring-2 ring-primary bg-primary-50":"",onClick:se=>T(B.id)},null,8,["document","additional-classes","onClick"])):h("",!0),y.value==="signed-documents"?(s(),le(t(Yt),{key:3,document:B,"highlighted-doc-id":null,"show-tags":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":f.value.includes(B.id)?"ring-2 ring-primary bg-primary-50":"",onClick:se=>T(B.id)},null,8,["document","additional-classes","onClick"])):h("",!0),B.tags&&B.tags.length>0?(s(),r("button",{key:4,type:"button",class:"absolute bottom-2 right-2 px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 inline-flex items-center gap-1",onClick:pe(se=>de(B),["stop"])},pr,8,mr)):h("",!0),f.value.includes(B.id)?(s(),r("div",hr,[n(t(Ms),{class:"w-4 h-4"})])):h("",!0)]))),128))]),d(y.value).length===0?(s(),r("div",fr,[n(t(at),{class:"w-12 h-12 sm:w-16 sm:h-16 text-gray-300 mx-auto mb-4"}),e("h4",yr,g(F.value.length>0?"No hay documentos que coincidan con el filtro":"No hay documentos disponibles"),1),e("p",vr,g(F.value.length>0?"Intenta ajustar los filtros de etiquetas o selecciona otra categoría":"No tienes documentos de esta categoría que no estén ya en la carpeta"),1)])):h("",!0)]),e("div",br,[e("div",xr,[e("div",_r,g(f.value.length)+" documento(s) seleccionado(s) ",1),e("div",wr,[e("button",{onClick:U,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{onClick:$,disabled:f.value.length===0||C.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},g(C.value?"Agregando...":`Agregar ${f.value.length} documento(s)`),9,$r)])]),e("div",kr,[e("div",Cr,g(f.value.length)+" documento(s) seleccionado(s) ",1),e("div",Dr,[e("button",{onClick:U,class:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center font-medium"}," Cancelar "),e("button",{onClick:$,disabled:f.value.length===0||C.value,class:"flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-center font-medium"},g(C.value?"Agregando...":"Agregar"),9,Sr)])])]),te.value&&ee.value?(s(),r("div",Fr,[e("div",Er,[e("div",Tr,[e("div",Ar,[n(t(at),{class:"h-5 w-5 text-gray-500"}),Mr]),e("button",{type:"button",class:"text-gray-400 hover:text-gray-600 p-1 rounded-md hover:bg-gray-100",onClick:Y},[n(t(Ae),{class:"h-5 w-5"})])]),e("div",jr,[Pr,e("span",Lr,g(ee.value.title||"Sin título"),1)]),e("div",Br,[!ee.value.tags||ee.value.tags.length===0?(s(),r("div",Rr," Este documento no tiene etiquetas. ")):(s(),r("ul",zr,[(s(!0),r(ge,null,he(ee.value.tags,B=>(s(),r("li",{key:B.id,class:"flex items-center justify-between gap-2"},[e("div",Ur,[e("span",{class:j(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",Z(B)])},g(B.name),3)]),B.description?(s(),r("span",Ir,g(B.description),1)):h("",!0)]))),128))]))]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end"},[e("button",{type:"button",class:"px-4 py-2 text-sm font-medium rounded-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-50",onClick:Y}," Cerrar ")])])])):h("",!0)])])]}),_:1})):h("",!0)}},dt=a=>(Ct("data-v-d9a5a89f"),a=a(),Dt(),a),Or={class:"folders-table"},qr={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200",style:{"overflow-x":"visible","overflow-y":"hidden"}},Vr={class:"min-w-full divide-y divide-gray-200"},Qr=dt(()=>e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Carpeta "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documentos "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Creada "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1)),Wr={class:"bg-white divide-y divide-gray-200"},Hr=["onClick"],Gr={class:"px-6 py-4 whitespace-nowrap"},Zr={class:"flex items-center"},Jr={class:"flex-shrink-0 h-10 w-10"},Kr={class:"ml-4"},Yr={class:"text-sm font-medium text-gray-900"},Xr={class:"px-6 py-4 whitespace-nowrap"},en={class:"flex items-center gap-2"},tn={class:"text-sm text-gray-900"},sn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},on={class:"py-1"},an=["onClick"],rn=["onClick"],nn=["onClick"],ln=["onClick"],dn={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},cn=dt(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No tienes carpetas aún",-1)),un=dt(()=>e("p",{class:"text-gray-600 mb-6"},"Crea tu primera carpeta para organizar tus documentos",-1)),mn={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},gn=dt(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No se encontraron carpetas",-1)),pn=dt(()=>e("p",{class:"text-gray-600"},"No hay carpetas que coincidan con tu búsqueda",-1)),hn={key:3,class:"flex justify-center items-center py-12"},fn=dt(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)),yn=[fn],vn={__name:"FoldersTable",props:{sortedFolders:{type:Array,required:!0},searchQuery:{type:String,default:""},isLoading:{type:Boolean,default:!1}},emits:["folder-click","edit-folder","delete-folder","add-documents","create-folder"],setup(a,{emit:w}){const i=a,c=w,D=b({}),v=b({}),f=b(!1),F=b(-1),y=z(()=>{if(!i.searchQuery.trim())return i.sortedFolders;const $=i.searchQuery.toLowerCase();return i.sortedFolders.filter(E=>E.name.toLowerCase().includes($))}),C=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],G=$=>{if($.color)return C.find(I=>I.name===$.color)||C[0];const E=$.id%C.length;return C[E]},te=$=>{if(!$)return"-";const E=new Date($),Z=Math.abs(new Date-E),de=Math.ceil(Z/(1e3*60*60*24));return de===0?"Hoy":de===1?"Ayer":de<7?`Hace ${de} días`:de<30?`Hace ${Math.floor(de/7)} semanas`:de<365?`Hace ${Math.floor(de/30)} meses`:E.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},ee=$=>{c("folder-click",$)},O=$=>{c("edit-folder",$)},ne=$=>{c("delete-folder",$)},X=$=>{c("add-documents",$)},k=()=>{c("create-folder")},d=()=>f.value?y.value.length===1?"280px":y.value.length===2&&F.value===1?"340px":"280px":"auto",T=($,E)=>{$&&(D.value[E]=$)},R=($,E)=>{$&&(v.value[E]=$)},U=($,E)=>{f.value=!E,F.value=E?-1:$,E||setTimeout(()=>{const I=v.value[$];if(I){const Z=I.$el||I;if(Z&&Z.getBoundingClientRect){const de=Z.getBoundingClientRect(),Y=window.innerHeight;if($===0){if(de.bottom>Y-20){const q=de.bottom-Y+40;window.scrollBy({top:q,behavior:"smooth"})}}else if(de.bottom>Y-10){const q=de.bottom-Y+30;window.scrollBy({top:q,behavior:"smooth"})}else if(de.top<80){const q=de.top-100;window.scrollBy({top:q,behavior:"smooth"})}}}},100)};return($,E)=>(s(),r("div",Or,[!a.isLoading&&y.value.length>0?(s(),r("div",qr,[e("div",{class:"overflow-x-auto",style:Ve({minHeight:d(),overflowY:"visible"})},[e("table",Vr,[Qr,e("tbody",Wr,[(s(!0),r(ge,null,he(y.value,(I,Z)=>{var de,Y;return s(),r("tr",{key:I.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:q=>ee(I)},[e("td",Gr,[e("div",Zr,[e("div",Jr,[e("div",{class:"h-10 w-10 rounded-lg flex items-center justify-center",style:Ve({backgroundColor:G(I).hex+"20"})},[n(t($t),{class:"h-6 w-6",style:Ve({color:G(I).hex})},null,8,["style"])],4)]),e("div",Kr,[e("div",Yr,g(I.name),1)])])]),e("td",Xr,[e("div",en,[n(t(Ne),{class:"h-5 w-5 text-gray-400"}),e("span",tn,g(((de=I.documents)==null?void 0:de.length)||0)+" documento"+g((((Y=I.documents)==null?void 0:Y.length)||0)!==1?"s":""),1)])]),e("td",sn,g(te(I.created_at)),1),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:E[0]||(E[0]=pe(()=>{},["stop"]))},[n(t(Pe),{as:"div",class:"relative inline-block text-left"},{default:A(({open:q})=>[n(t(Le),{ref_for:!0,ref:J=>T(J,Z),onClick:J=>U(Z,q),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:A(()=>[n(t(it),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),n(t(Be),{ref_for:!0,ref:J=>R(J,Z),class:j([y.value.length>2&&Z>0&&Z>=y.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:A(()=>[e("div",on,[n(t(ye),null,{default:A(({active:J})=>[e("a",{onClick:P=>ee(I),class:j([J?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver carpeta ",10,an)]),_:2},1024),n(t(ye),null,{default:A(({active:J})=>[e("a",{onClick:P=>X(I),class:j([J?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Agregar documentos ",10,rn)]),_:2},1024),n(t(ye),null,{default:A(({active:J})=>[e("a",{onClick:P=>O(I),class:j([J?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Editar ",10,nn)]),_:2},1024),n(t(ye),null,{default:A(({active:J})=>[e("a",{onClick:P=>ne(I),class:j([J?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Eliminar ",10,ln)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,Hr)}),128))])])],4)])):!a.isLoading&&a.sortedFolders.length===0?(s(),r("div",dn,[n(t($t),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),cn,un,e("button",{onClick:k,class:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"},[n(t(We),{class:"w-5 h-5"}),re(" Crear Primera Carpeta ")])])):!a.isLoading&&a.sortedFolders.length>0&&y.value.length===0?(s(),r("div",mn,[n(t($t),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),gn,pn])):h("",!0),a.isLoading?(s(),r("div",hn,yn)):h("",!0)]))}},bn=Et(vn,[["__scopeId","data-v-d9a5a89f"]]),gs=a=>(Ct("data-v-e3f57445"),a=a(),Dt(),a),xn={class:"folder-management"},_n={class:"mb-6"},wn={class:"hidden sm:flex justify-between items-center"},$n=gs(()=>e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),kn={class:"sm:hidden"},Cn=gs(()=>e("div",{class:"text-center mb-4"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1 px-2"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Dn={__name:"FolderManagement",props:{searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","navigate-to-main","navigate-to-document"],setup(a,{emit:w}){const i=a,c=w,D=Gt(),v=qe(),f=Ze(),F=b(!1),y=b(null),C=b(null),G=b(!1),te=b(null),ee=z(()=>D.isLoading),O=z(()=>D.sortedFolders);z(()=>f.currentUser),Qe(async()=>{await D.init(),await v.init()}),we(()=>i.searchQuery,()=>{}),we(()=>D.folders,P=>{var B,se;if(C.value&&P&&P.length>0){const ve=P.find(N=>N.id===C.value.id);ve&&((B=C.value.documents)!=null&&B.length,(se=ve.documents)!=null&&se.length,JSON.stringify(C.value)!==JSON.stringify(ve)&&(C.value={...ve}))}},{deep:!0});const ne=()=>{y.value=null,F.value=!0},X=P=>{y.value=P,F.value=!0},k=()=>{F.value=!1,y.value=null},d=()=>{k()},T=P=>{C.value=P},R=()=>{C.value=null},U=async P=>{if(confirm(`¿Estás seguro de que quieres eliminar la carpeta "${P.name}"?`))try{await D.deleteFolder(P.id),$e(`Carpeta "${P.name}" eliminada correctamente`,"success")}catch(B){$e("Error al eliminar la carpeta","error"),console.error("Error deleting folder:",B)}},$=P=>{te.value=P,G.value=!0},E=async(P=!1)=>{if(G.value=!1,te.value=null,P&&C.value)try{await I()}catch(B){console.warn("Error refreshing folder after adding documents:",B)}},I=async()=>{if(C.value)try{await D.fetchFolder(C.value.id);const P=D.getFolderById(C.value.id);P&&(C.value={...P},console.log("✅ Selected folder refreshed successfully"))}catch(P){throw console.error("❌ Error refreshing selected folder:",P),P}},Z=async P=>{var B,se,ve;if(!(!te.value||P.length===0))try{const N=te.value.documents.map(K=>K.id).filter(K=>K!=null&&!isNaN(parseInt(K))).map(K=>parseInt(K)),H=P.filter(K=>K!=null&&!isNaN(parseInt(K))).map(K=>parseInt(K)),Q=[...new Set([...N,...H])];if(console.log("Current document IDs:",N),console.log("Selected document IDs:",H),console.log("Updated document IDs:",Q),Q.some(K=>!Number.isInteger(K)||K<=0))throw new Error("IDs de documentos inválidos detectados");await D.updateFolder(te.value.id,{document_ids:Q}),await E(!0),$e(`${H.length} documento(s) agregado(s) a la carpeta`,"success"),c("navigate-to-main")}catch(N){console.error("Error adding documents to folder:",N),console.error("Error details:",((B=N.response)==null?void 0:B.data)||N.message),(se=N.response)!=null&&se.status?$e(`Error al agregar documentos: ${((ve=N.response.data)==null?void 0:ve.detail)||N.message}`,"error"):$e("Error al agregar documentos a la carpeta","error")}},de=async P=>{var se,ve,N;if(!C.value)return;const B=typeof P=="object"&&P!==null?P.documentId:P;try{const H=parseInt(B);if(!Number.isInteger(H)||H<=0)throw new Error("ID de documento inválido");const Q=C.value.documents.map(K=>K.id).filter(K=>K!=null&&!isNaN(parseInt(K))).map(K=>parseInt(K)).filter(K=>K!==H);await D.updateFolder(C.value.id,{document_ids:Q}),$e("Documento removido de la carpeta","success"),C.value=null,c("navigate-to-main")}catch(H){console.error("Error removing document from folder:",H),console.error("Error details:",((se=H.response)==null?void 0:se.data)||H.message),(ve=H.response)!=null&&ve.status?$e(`Error al remover documento: ${((N=H.response.data)==null?void 0:N.detail)||H.message}`,"error"):$e("Error al remover el documento de la carpeta","error")}},Y=P=>{let B="legal-documents";P.state==="Published"||P.state==="Draft"?B="legal-documents":P.state==="PendingSignatures"?B="pending-signatures":P.state==="FullySigned"?B="signed-documents":P.state==="Progress"||P.state==="Completed"?B="my-documents":(P.state==="Rejected"||P.state==="Expired"||P.state==="Archived")&&(B="archived-documents"),C.value=null,c("navigate-to-document",{tab:B,searchQuery:P.title})},q=P=>{C.value=null,c("navigate-to-document",{tab:"legal-documents",searchQuery:P.title})},J=(P,B)=>{console.log("Document action:",P,B)};return(P,B)=>(s(),r("div",xn,[e("div",_n,[e("div",wn,[$n,e("button",{onClick:ne,class:"inline-flex items-center gap-2 px-4 py-2.5 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md"},[n(t(We),{class:"w-5 h-5"}),re(" Nueva Carpeta ")])]),e("div",kn,[Cn,e("button",{onClick:ne,class:"w-full flex items-center justify-center gap-3 px-4 py-4 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium text-base"},[n(t(We),{class:"w-6 h-6"}),re(" Nueva Carpeta ")])])]),n(t(bn),{"sorted-folders":O.value,"search-query":a.searchQuery,"is-loading":ee.value,onFolderClick:T,onEditFolder:X,onDeleteFolder:U,onAddDocuments:$,onCreateFolder:ne},null,8,["sorted-folders","search-query","is-loading"]),n(t(fo),{"is-visible":F.value,"editing-folder":y.value,onClose:k,onSuccess:d},null,8,["is-visible","editing-folder"]),n(t(Jo),{folder:C.value,onClose:R,onAddDocuments:$,onRemoveDocument:de,onViewDocument:Y,onUseDocument:q,onDocumentAction:J},null,8,["folder"]),n(t(Nr),{"is-visible":G.value,folder:te.value,onClose:E,onAddDocuments:Z},null,8,["is-visible","folder"])]))}},os=Et(Dn,[["__scopeId","data-v-e3f57445"]]);function Sn(a){return!a.variables||a.variables.length===0?!0:a.variables.every(w=>w.name_es&&w.name_es.trim().length>0)}function wt(a,w){var D;if(!a.requires_signature||a.state!=="PendingSignatures"||!a.signatures||a.signatures.length===0)return!1;const i=(D=w==null?void 0:w.currentUser)==null?void 0:D.email,c=a.signatures.find(v=>v.signer_email===i);return!(!c||c.signed)}const Fn={lawyer:{getMenuOptions:(a,w,i)=>{let c;return w==="legal-documents"&&(a.state==="Draft"||a.state==="Published")?c=[{label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Actualizar nombre",action:"edit"},{label:"Editar documento",action:"editDocument"},{label:"Editar configuración de variables",action:"editForm"}]},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}]:c=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}],a.state!=="Draft"&&a.state!=="Published"&&c.splice(2,0,{label:"Administrar Asociaciones",action:"relationships"}),a.state==="Draft"?c.push({label:"Publicar",action:"publish",disabled:!Sn(a)}):a.state==="Published"&&c.push({label:"Mover a Borrador",action:"draft"}),(a.state==="Completed"||a.state==="Published")&&c.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),a.requires_signature&&(a.state==="PendingSignatures"||a.state==="FullySigned")&&(c.push({label:"Ver Firmas",action:"viewSignatures"}),wt(a,i)&&c.push({label:"Firmar documento",action:"sign"})),c}},signatures:{getMenuOptions:(a,w,i)=>{const c=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}],D=a.relationships_count&&a.relationships_count>0;if(c.push({label:"Administrar Asociaciones",action:"relationships",disabled:!D}),a.requires_signature&&["PendingSignatures","FullySigned","Rejected","Expired"].includes(a.state)&&c.push({label:"Estado de las firmas",action:"viewSignatures"}),wt(a,i)&&c.push({label:"Firmar documento",action:"sign"}),a.state==="PendingSignatures"&&wt(a,i)&&c.push({label:"Rechazar documento",action:"reject"}),a.state==="FullySigned"&&c.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),a.state==="PendingSignatures"&&c.push({label:"Descargar PDF",action:"downloadPDF"}),a.state==="Rejected"){const v=i==null?void 0:i.currentUser,f=(v==null?void 0:v.role)==="lawyer",F=a.created_by===(v==null?void 0:v.id);(f||F)&&c.push({label:"Editar y reenviar para firma",action:"editAndResend"}),Array.isArray(a.signatures)&&a.signatures.some(C=>C.rejection_comment)&&c.push({label:"Ver motivo del rechazo",action:"viewRejectionReason"})}return c}},client:{getMenuOptions:(a,w,i)=>{var te,ee,O,ne;const c=[],D=((te=i==null?void 0:i.currentUser)==null?void 0:te.role)==="basic",v=((ee=i==null?void 0:i.currentUser)==null?void 0:ee.role)==="corporate_client"||((O=i==null?void 0:i.currentUser)==null?void 0:O.role)==="client",f=((ne=i==null?void 0:i.currentUser)==null?void 0:ne.role)==="lawyer",F=a.state==="Progress",y=w==="my-documents",G=["PendingSignatures","FullySigned","Rejected","Expired"].includes(a.state);if(y&&a.requires_signature&&G&&(a.state==="PendingSignatures"||a.state==="FullySigned"||a.state==="Expired"))return c.push({label:"Previsualizar",action:"preview"}),c.push({label:"Descargar PDF",action:"downloadPDF"}),D?c.push({label:"Descargar Word",action:"downloadWord",disabled:!0}):c.push({label:"Descargar Word",action:"downloadWord"}),a.state==="FullySigned"&&c.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),c;if(a.state==="Completed"){const X=[{label:"Editar Formulario",action:"editForm"}];D||X.push({label:"Editar Documento",action:"editDocument"}),c.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:X}),(v||D||f)&&c.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:D})}else a.state==="Progress"?(c.push({label:"Completar",action:"editForm"}),(v||D||f)&&c.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:!0})):c.push({label:"Completar",action:"editForm"});if((a.state==="Completed"||a.state==="Progress")&&c.push({label:"Previsualizar",action:"preview"}),c.push({label:"Eliminar",action:"delete"}),D?c.push({label:"Gestionar Membrete",action:"letterhead",disabled:!0}):c.push({label:"Gestionar Membrete",action:"letterhead"}),c.push({label:"Administrar Asociaciones",action:"relationships",disabled:D||F}),a.requires_signature){const k=["PendingSignatures","FullySigned","Rejected","Expired"].includes(a.state);w!=="my-documents"&&k&&(c.push({label:"Ver Firmas",action:"viewSignatures"}),wt(a,i)&&c.push({label:"Firmar documento",action:"sign"}))}if(a.state==="Completed"||a.state==="Progress"){const X=a.state==="Completed";c.push({label:"Descargar PDF",action:"downloadPDF",disabled:!X},{label:"Descargar Word",action:"downloadWord",disabled:D||!X},{label:"Enviar",action:"email",disabled:D||!X})}return c}}};function En(a,w,i="list",c=null){const D=Fn[a];return D?D.getMenuOptions(w,i,c):[]}function ps(){const a=Ze(),w=z(()=>{var v;return((v=a.currentUser)==null?void 0:v.role)==="basic"}),i=v=>{$e("Esta funcionalidad está restringida para usuarios básicos. Por favor, contacta a tu abogado para obtener acceso completo.","warning")};return{isBasicUser:w,showRestrictionNotification:i,handleFeatureAccess:(v,f)=>w.value?(i(),!1):(f&&f(),!0),getRestrictedButtonClasses:v=>v?"opacity-60 cursor-not-allowed":""}}const Tn={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},An={class:"px-6 py-4 border-b border-gray-200"},Mn=e("h2",{class:"text-xl font-semibold text-gray-800"},"Acciones del Documento",-1),jn={class:"text-sm text-gray-500 mt-1"},Pn={class:"p-6 overflow-y-auto flex-grow"},Ln={class:"space-y-4"},Bn={key:0,class:"text-sm font-semibold text-gray-700 uppercase tracking-wide px-2"},Rn={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},zn=["onClick","disabled"],Un={class:"text-sm font-medium"},In={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Nn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),On={key:1,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},qn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Vn={key:2,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Qn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Wn={key:3,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Hn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Gn={key:4,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Zn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Jn={key:1,class:"border-t border-gray-200 my-4"},Kn={key:0,class:"text-center py-12"},Yn=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay acciones disponibles",-1),Xn=e("p",{class:"mt-1 text-sm text-gray-500"}," No hay opciones disponibles para este documento. ",-1),Pt={__name:"DocumentActionsModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null},cardType:{type:String,required:!0,validator:a=>["lawyer","client","signatures"].includes(a)},context:{type:String,default:"table"},userStore:{type:Object,default:null}},emits:["close","action"],setup(a,{emit:w}){const i=a,c=w,D=z(()=>i.document?En(i.cardType,i.document,i.context,i.userStore):[]),v=z(()=>{const k=D.value;if(!k||k.length===0)return[];const d=[],T={edit:"Edición",view:"Visualización",share:"Compartir",manage:"Gestión",signatures:"Firmas",delete:"Eliminación"},R={edit:[],view:[],share:[],manage:[],signatures:[],delete:[]};return k.forEach(U=>{if(U.children&&Array.isArray(U.children))U.children.forEach($=>{const E=$.action.toLowerCase();f($,E,R)});else{const $=U.action.toLowerCase();f(U,$,R)}}),R.edit.length>0&&d.push({title:T.edit,options:R.edit}),R.view.length>0&&d.push({title:T.view,options:R.view}),R.share.length>0&&d.push({title:T.share,options:R.share}),R.signatures.length>0&&d.push({title:T.signatures,options:R.signatures}),R.manage.length>0&&d.push({title:T.manage,options:R.manage}),R.delete.length>0&&d.push({title:T.delete,options:R.delete}),d}),f=(k,d,T)=>{d.includes("edit")||d.includes("editar")||d==="copy"||d==="draft"||d==="publish"||d==="completar"?T.edit.push(k):d.includes("signature")||d.includes("firma")||d.includes("sign")||d==="reject"?T.signatures.push(k):d.includes("view")||d.includes("preview")||d.includes("ver")||d.includes("previsualización")?T.view.push(k):d.includes("download")||d.includes("email")||d.includes("enviar")||d.includes("descargar")?T.share.push(k):d.includes("permission")||d.includes("relationship")||d.includes("letterhead")||d.includes("permiso")||d.includes("asociación")||d.includes("membrete")||d==="formalize"?T.manage.push(k):d.includes("delete")||d.includes("eliminar")?T.delete.push(k):T.manage.push(k)},F=k=>{const d=k.toLowerCase();return d==="sign"||d.includes("firmar")?kt:d==="editform"||d.includes("completar")?ss:d==="editdocument"||d.includes("editar documento")?Xt:d.includes("edit")||d==="editar"?Xt:d.includes("delete")||d==="eliminar"?Ot:d.includes("preview")||d.includes("ver")||d.includes("previsualización")?ds:d==="copy"||d.includes("copia")?Ss:d.includes("download")||d.includes("descargar")?ot:d.includes("email")||d.includes("enviar")?ws:d.includes("permission")||d.includes("permiso")?js:d.includes("relationship")||d.includes("asociación")?cs:d.includes("letterhead")||d.includes("membrete")?us:d==="reject"||d.includes("rechazar")?Us:d.includes("signature")||d.includes("firma")?kt:d==="publish"||d.includes("publicar")?zs:d==="draft"||d.includes("borrador")?Ne:d==="formalize"||d.includes("formalizar")?ss:at},y=k=>{const d=k.toLowerCase();return d.includes("delete")||d==="eliminar"||d==="reject"||d.includes("rechazar")?"text-red-600":d==="sign"||d.includes("firmar")?"text-green-600":d.includes("download")||d.includes("descargar")?"text-blue-600":d.includes("email")||d.includes("enviar")?"text-green-600":d.includes("signature")||d.includes("firma")?"text-purple-600":"text-gray-600"},C=k=>{const d=k.toLowerCase();return d.includes("delete")||d==="eliminar"||d==="reject"||d.includes("rechazar")?"border-red-200 bg-red-50 text-red-700 hover:bg-red-100 hover:border-red-300":d==="sign"||d.includes("firmar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":d.includes("download")||d.includes("descargar")?"border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 hover:border-blue-300":d.includes("email")||d.includes("enviar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":d.includes("signature")||d.includes("firma")?"border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-100 hover:border-purple-300":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-300"},{isBasicUser:G,handleFeatureAccess:te}=ps(),ee=["formalize","letterhead","relationships","downloadWord","email"],O=k=>{const d=k.toLowerCase();return ee.some(T=>d===T.toLowerCase())},ne=k=>{const d=D.value.find(R=>R.action===k?R:R.children?R.children.find(U=>U.action===k):null),T=d!=null&&d.children?d.children.find(R=>R.action===k):d;if(T!=null&&T.disabled){te("Esta funcionalidad",null);return}c("action",k,i.document)},X=()=>{c("close")};return(k,d)=>ke((s(),le(Ge,null,{default:A(()=>{var T;return[e("div",Tn,[e("div",An,[Mn,e("p",jn,g(((T=a.document)==null?void 0:T.title)||"Cargando..."),1),e("button",{onClick:X,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500 transition-colors"},[n(t(Ae),{class:"h-6 w-6"})])]),e("div",Pn,[e("div",Ln,[(s(!0),r(ge,null,he(v.value,(R,U)=>(s(),r("div",{key:U,class:"space-y-2"},[R.title?(s(),r("h3",Bn,g(R.title),1)):h("",!0),e("div",Rn,[(s(!0),r(ge,null,he(R.options,$=>{var E,I,Z;return s(),r("div",{key:$.action,class:"relative group"},[e("button",{onClick:de=>ne($.action),disabled:$.disabled,class:j(["flex items-center justify-start w-full px-4 py-3 rounded-lg border transition-all duration-200",$.disabled?"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed opacity-60":C($.action),"hover:shadow-md hover:scale-[1.02]"])},[(s(),le(_s(F($.action)),{class:j(["h-5 w-5 mr-3 flex-shrink-0",$.disabled?"text-gray-400":y($.action)])},null,8,["class"])),e("span",Un,g($.label),1),$.disabled?(s(),le(t(Es),{key:0,class:"h-4 w-4 ml-auto text-gray-400"})):h("",!0)],10,zn),$.disabled&&$.action==="relationships"&&!t(G)&&((E=a.document)==null?void 0:E.state)==="Progress"?(s(),r("div",In,[re(" Solo puedes administrar asociaciones cuando el documento está completado. "),Nn])):$.disabled&&$.action==="relationships"&&!t(G)?(s(),r("div",On,[re(" Este documento no tiene documentos asociados. "),qn])):$.disabled&&$.action==="formalize"&&((I=a.document)==null?void 0:I.state)!=="Completed"?(s(),r("div",Vn,[re(" Solo puedes formalizar y agregar firmas cuando el documento está completado. "),Qn])):$.disabled&&["downloadPDF","downloadWord","email"].includes($.action)&&((Z=a.document)==null?void 0:Z.state)!=="Completed"?(s(),r("div",Wn,[re(" Solo puedes usar esta acción cuando el documento está completado. "),Hn])):$.disabled&&t(G)&&O($.action)?(s(),r("div",Gn,[re(" Actualiza tu suscripción para usar esta funcionalidad "),Zn])):h("",!0)])}),128))]),U<v.value.length-1?(s(),r("div",Jn)):h("",!0)]))),128)),v.value.length===0?(s(),r("div",Kn,[n(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),Yn,Xn])):h("",!0)])])])]}),_:1},512)),[[ht,a.isVisible]])}},el={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},tl={class:"mb-4"},sl={class:"relative w-full"},ol={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},al={class:"flex items-center gap-2 min-w-0"},rl={class:"truncate"},nl={class:"py-1"},ll=["onClick"],il={class:"flex items-center gap-2 min-w-0"},dl={class:"truncate"},cl={class:"p-2"},ul={class:"relative mb-2"},ml={class:"max-h-60 overflow-y-auto"},gl=["onClick"],pl={class:"truncate"},hl={class:"flex items-center gap-2 min-w-0"},fl={class:"truncate"},yl={class:"p-2"},vl={class:"relative mb-2"},bl={class:"max-h-60 overflow-y-auto"},xl=["onClick"],_l={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},wl={class:"flex flex-col gap-1"},$l=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),kl={class:"flex flex-col gap-1"},Cl=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),Dl={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Sl={class:"py-1"},Fl=["onClick"],El={class:"flex gap-2 w-full sm:w-auto"},Tl=e("span",null,"Limpiar filtros",-1),Al={key:0,class:"flex justify-center items-center py-12 bg-white rounded-lg shadow-sm border border-gray-200"},Ml=e("div",{class:"text-center"},[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e("p",{class:"text-sm text-gray-500"},"Cargando documentos...")],-1),jl=[Ml],Pl={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},Ll={class:"overflow-x-auto"},Bl={class:"min-w-full divide-y divide-gray-200"},Rl={class:"bg-gray-50"},zl={key:0,scope:"col",class:"w-12 px-3 py-3"},Ul=["checked"],Il=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento ",-1),Nl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),Ol=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Contraparte ",-1),ql=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Objeto ",-1),Vl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Valor ",-1),Ql=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plazo ",-1),Wl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha Suscripción ",-1),Hl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha Inicio ",-1),Gl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha Terminación ",-1),Zl={key:1,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Jl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas ",-1),Kl={class:"bg-white divide-y divide-gray-200"},Yl=["onClick"],Xl={key:0,class:"px-3 py-4"},ei=["checked","onChange"],ti={class:"px-6 py-4"},si={class:"flex items-center gap-3"},oi={class:"min-w-0"},ai={class:"text-sm font-medium text-gray-900 hover:text-secondary truncate block max-w-xs text-left"},ri={class:"px-6 py-4 whitespace-nowrap"},ni={class:"px-6 py-4 whitespace-nowrap"},li={class:"text-sm text-gray-900"},ii={class:"px-6 py-4 whitespace-nowrap"},di={class:"text-sm text-gray-900 line-clamp-2 max-w-xs"},ci={class:"px-6 py-4 whitespace-nowrap"},ui={class:"text-sm text-gray-900"},mi={class:"px-6 py-4 whitespace-nowrap"},gi={class:"text-sm text-gray-900"},pi={class:"px-6 py-4 whitespace-nowrap text-xs text-gray-900"},hi={key:0},fi={key:1,class:"text-gray-400"},yi={class:"px-6 py-4 whitespace-nowrap text-xs text-gray-900"},vi={key:0},bi={key:1,class:"text-gray-400"},xi={class:"px-6 py-4 whitespace-nowrap text-xs text-gray-900"},_i={key:0},wi={key:1,class:"text-gray-400"},$i={key:1,class:"px-6 py-4 whitespace-nowrap"},ki=["onClick"],Ci={key:1,class:"text-sm text-gray-400"},Di={class:"px-6 py-4"},Si={class:"flex flex-wrap gap-1"},Fi=["onClick"],Ei={key:0,class:"bg-gray-50 px-4 py-3 border-t border-gray-200 sm:px-6"},Ti={class:"flex items-center justify-between"},Ai={class:"flex-1 flex justify-between sm:hidden"},Mi=["disabled"],ji=["disabled"],Pi={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},Li={class:"text-sm text-gray-700"},Bi={class:"font-medium"},Ri={class:"font-medium"},zi={class:"font-medium"},Ui={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},Ii=["disabled"],Ni=["onClick"],Oi=["disabled"],qi={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Vi=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos",-1),Qi={class:"mt-1 text-sm text-gray-500"},Wi={key:11,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4"},Hi={class:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] flex flex-col"},Gi={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},Zi={class:"flex items-center gap-2"},Ji=e("h2",{class:"text-sm font-semibold text-gray-900"},"Etiquetas del documento",-1),Ki={class:"px-4 py-3 border-b border-gray-100 text-xs text-gray-500"},Yi=e("span",{class:"font-medium text-gray-700"},"Documento:",-1),Xi={class:"ml-1"},ed={class:"px-4 py-3 overflow-y-auto"},td={key:0,class:"text-sm text-gray-500"},sd={key:1,class:"space-y-2 text-sm"},od={class:"flex items-center gap-2 min-w-0"},ad={key:0,class:"text-xs text-gray-500 truncate max-w-[8rem]"},It={__name:"DocumentListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null},cardType:{type:String,default:"lawyer",validator:a=>["lawyer","client"].includes(a)},showStateFilter:{type:Boolean,default:!0},showClientFilter:{type:Boolean,default:!1},showAssociationsColumn:{type:Boolean,default:!0},availableStates:{type:Array,default:()=>["Draft","Published","Progress","PendingSignatures","Completed","FullySigned","Rejected","Expired"]},context:{type:String,default:"legal-documents"},isLoading:{type:Boolean,default:!1}},emits:["refresh","open-electronic-signature","update:searchQuery"],setup(a,{emit:w}){const i=qe(),c=Ze(),D=et(),v=a,f=w,{activeModals:F,openModal:y,closeModal:C}=Tt(i,c),G=z(()=>(F==null?void 0:F.value)||F||{}),te=z(()=>{const m=G.value;return(m==null?void 0:m.relationships)||{isOpen:!1,document:null}}),{handlePreviewDocument:ee,deleteDocument:O,downloadPDFDocument:ne,downloadWordDocument:X,copyDocument:k,publishDocument:d,moveToDraft:T,formalizeDocument:R,signDocument:U,downloadSignedDocument:$}=At(i,c,f),E=b(""),I=b(""),Z=b(""),de=b(null),Y=b(null),q=b(null),J=b(""),P=b(""),B=b("recent"),se=b([]),ve=b(!1),N=b(null),H=b(!1),Q=b(null),K=b(1),be=b(20),_e=z(()=>v.cardType==="lawyer"&&v.context==="legal-documents");z(()=>!1);const xe=z(()=>{if(v.promptDocuments)return v.promptDocuments;const m=c.currentUser;return v.cardType==="lawyer"&&v.context==="legal-documents"?!(m!=null&&m.id)||typeof i.getDocumentsByLawyerId!="function"?[]:i.getDocumentsByLawyerId(m.id)||[]:v.cardType==="client"&&v.context==="my-documents"?!(m!=null&&m.id)||typeof i.progressAndCompletedDocumentsByClient!="function"?[]:i.progressAndCompletedDocumentsByClient(m.id)||[]:i.documents||[]}),Re=z(()=>{const m=new Map;return xe.value.forEach(u=>{var V;(V=u.tags)==null||V.forEach(p=>{m.has(p.id)||m.set(p.id,p)})}),Array.from(m.values())}),ze=z(()=>{if(!I.value)return Re.value;const m=I.value.toLowerCase();return Re.value.filter(u=>u.name.toLowerCase().includes(m))}),Ue=z(()=>{if(!Y.value)return null;const m=Re.value.find(u=>u.id===Y.value);return(m==null?void 0:m.name)||null}),oe=z(()=>{if(v.cardType!=="lawyer")return[];const m=new Map;return xe.value.forEach(u=>{u.client&&m.set(u.client.id,u.client)}),Array.from(m.values())}),ie=z(()=>{if(!Z.value)return oe.value;const m=Z.value.toLowerCase();return oe.value.filter(u=>`${u.first_name} ${u.last_name}`.toLowerCase().includes(m))}),ce=z(()=>{if(!q.value)return null;const m=oe.value.find(u=>u.id===q.value);return m?`${m.first_name} ${m.last_name}`:null}),Ce=z(()=>!v.selectedTags||!v.selectedTags.length?[]:v.selectedTags.map(m=>typeof m=="object"?m.id:m)),Te=z(()=>{let m=xe.value;const u=(E.value||"").toLowerCase();return u&&(m=m.filter(V=>{var p,fe;return((p=V.title)==null?void 0:p.toLowerCase().includes(u))||((fe=V.code)==null?void 0:fe.toLowerCase().includes(u))})),de.value&&(m=m.filter(V=>V.state===de.value)),(J.value||P.value)&&(m=m.filter(V=>{const p=V.summary_subscription_date||V.created_at||V.updated_at;if(!p)return!1;const fe=new Date(p);if(isNaN(fe.getTime()))return!1;if(J.value){const Fe=new Date(J.value);if(fe<Fe)return!1}if(P.value){const Fe=new Date(P.value);if(Fe.setHours(23,59,59,999),fe>Fe)return!1}return!0})),Y.value&&(m=m.filter(V=>{var p;return(p=V.tags)==null?void 0:p.some(fe=>fe.id===Y.value)})),Ce.value.length>0&&(m=m.filter(V=>{var p;return(p=V.tags)==null?void 0:p.some(fe=>Ce.value.includes(fe.id))})),q.value&&v.cardType==="lawyer"&&(m=m.filter(V=>{var p;return((p=V.client)==null?void 0:p.id)===q.value})),m}),je=()=>{de.value=null,Y.value=null,q.value=null,J.value="",P.value=""},x=z(()=>{if(v.cardType!=="lawyer"||v.context!=="legal-documents")return!1;const m=Te.value;return m.length?m.every(u=>u.state==="Draft"||u.state==="Published"):!1}),l=z(()=>{const m=[...Te.value];switch(B.value){case"recent":return m.sort((u,V)=>new Date(V.updated_at)-new Date(u.updated_at));case"oldest":return m.sort((u,V)=>new Date(u.updated_at)-new Date(V.updated_at));case"name-asc":return m.sort((u,V)=>(u.title||"").localeCompare(V.title||""));case"name-desc":return m.sort((u,V)=>(V.title||"").localeCompare(u.title||""));default:return m}}),o=z(()=>{const m=(K.value-1)*be.value,u=m+be.value;return l.value.slice(m,u)}),M=z(()=>Math.ceil(l.value.length/be.value)),me=z(()=>{const m=M.value,u=K.value,V=[];if(m<=7)for(let p=1;p<=m;p++)V.push(p);else if(u<=4){for(let p=1;p<=5;p++)V.push(p);V.push("..."),V.push(m)}else if(u>=m-3){V.push(1),V.push("...");for(let p=m-4;p<=m;p++)V.push(p)}else V.push(1),V.push("..."),V.push(u-1),V.push(u),V.push(u+1),V.push("..."),V.push(m);return V}),L=z(()=>o.value.length>0&&o.value.every(m=>se.value.includes(m.id))),De=[{value:"recent",label:"Más recientes"},{value:"oldest",label:"Más antiguos"},{value:"name-asc",label:"Nombre (A-Z)"},{value:"name-desc",label:"Nombre (Z-A)"}],Se=m=>{var u;return((u=De.find(V=>V.value===m))==null?void 0:u.label)||"Ordenar"},Ie=m=>({Draft:"Borrador",Published:"Publicado",Progress:"En Progreso",PendingSignatures:"Pendiente de Firmas",Completed:"Completado",FullySigned:"Firmado",Rejected:"Rechazado",Expired:"Expirado"})[m]||m,Je=m=>Ie(m.state),Ye=m=>({Draft:"bg-gray-100 text-gray-800",Published:"bg-blue-100 text-blue-800",Progress:"bg-yellow-100 text-yellow-800",PendingSignatures:"bg-orange-100 text-orange-800",Completed:"bg-green-100 text-green-800",FullySigned:"bg-purple-100 text-purple-800",Rejected:"bg-red-100 text-red-800",Expired:"bg-gray-100 text-gray-800"})[m.state]||"bg-gray-100 text-gray-800",rt=m=>({Draft:"text-gray-500",Published:"text-blue-600",Progress:"text-yellow-600",PendingSignatures:"text-orange-600",Completed:"text-green-600",FullySigned:"text-purple-600",Rejected:"text-red-600",Expired:"text-gray-500"})[m.state]||"text-gray-400",nt=m=>{if(m&&m.color)return{red:"bg-red-100 text-red-800",blue:"bg-blue-100 text-blue-800",green:"bg-green-100 text-green-800",yellow:"bg-yellow-100 text-yellow-800",purple:"bg-purple-100 text-purple-800",pink:"bg-pink-100 text-pink-800",indigo:"bg-indigo-100 text-indigo-800"}[m.color]||"bg-gray-100 text-gray-800";const u=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],V=m&&typeof m.id=="number"?m.id%u.length:0;return u[V]},ct=m=>m?new Date(m).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"-",Lt=m=>m.summary_counterparty||"",Bt=m=>{if(m.summary_value===null||m.summary_value===void 0||m.summary_value==="")return"";const u=Number(String(m.summary_value).replace(/[^0-9.,-]/g,"").replace(/\./g,"").replace(",","."));if(Number.isNaN(u))return m.summary_value;const V=u.toLocaleString("es-CO",{maximumFractionDigits:2}),p=m.summary_value_currency||"",Fe={COP:"COP $",USD:"US $",EUR:"EUR €"}[p]||p||"";return Fe?`${Fe} ${V}`:V},ut=m=>["Completed","FullySigned"].includes(m.state),Rt=m=>String(i.lastUpdatedDocumentId)===String(m),vt=m=>{const u=se.value.indexOf(m);u>-1?se.value.splice(u,1):se.value.push(m)},bt=m=>{Q.value=m,H.value=!0},xt=()=>{H.value=!1,Q.value=null},zt=()=>{if(L.value)se.value=se.value.filter(m=>!o.value.some(u=>u.id===m));else{const m=o.value.map(u=>u.id).filter(u=>!se.value.includes(u));se.value.push(...m)}},W=m=>{N.value=m,ve.value=!0},S=()=>{const m=se.value.length>0?l.value.filter(Xe=>se.value.includes(Xe.id)):l.value,u=["Nombre Minuta","Estado","Etiquetas"],V=m.map(Xe=>[Xe.title||"",Je(Xe),Xe.tags?Xe.tags.map(Ut=>Ut.name).join(", "):""]),p=[u.join(","),...V.map(Xe=>Xe.map(Ut=>`"${Ut}"`).join(","))].join(`
`),fe=new Blob([p],{type:"text/csv;charset=utf-8;"}),Fe=document.createElement("a"),Ke=URL.createObjectURL(fe);Fe.setAttribute("href",Ke),Fe.setAttribute("download",`documentos_${new Date().toISOString().split("T")[0]}.csv`),Fe.style.visibility="hidden",document.body.appendChild(Fe),Fe.click(),document.body.removeChild(Fe)},ae=async(m,u)=>{var V,p;switch(m){case"preview":await ee(u);break;case"edit":{const fe=((V=c.currentUser)==null?void 0:V.role)||"client";v.cardType==="lawyer"&&v.context==="legal-documents"?y("edit",u,{userRole:fe,renameOnly:!0}):y("edit",u,{userRole:fe})}break;case"editForm":if(v.cardType==="lawyer"&&v.context==="legal-documents")try{const fe=await i.fetchDocumentById(u.id,!0);i.selectedDocument=fe,D.push("/dynamic_document_dashboard/lawyer/variables-config")}catch(fe){console.error("Error al abrir la configuración de variables:",fe)}else y("edit",u,{userRole:"client"});break;case"editDocument":(((p=c.currentUser)==null?void 0:p.role)||"client")==="lawyer"&&v.cardType==="lawyer"?D.push(`/dynamic_document_dashboard/lawyer/editor/edit/${u.id}`):D.push(`/dynamic_document_dashboard/client/editor/edit/${u.id}`);break;case"permissions":y("permissions",u);break;case"relationships":y("relationships",u);break;case"letterhead":y("letterhead",u);break;case"viewSignatures":case"signatures":y("signatures",u);break;case"publish":await d(u);break;case"draft":case"move-to-draft":await T(u);break;case"formalize":await R(u);break;case"sign":await U(u);break;case"delete":await O(u);break;case"downloadPDF":case"download-pdf":await ne(u);break;case"downloadWord":case"download-word":await X(u);break;case"downloadSignedDocument":case"download-signed":await $(u);break;case"email":case"send":y("email",u);break;case"copy":await k(u);break;default:console.warn("Unknown action:",m)}},_=async(m,u)=>{ve.value=!1,await ae(m,u)},ue=({documentId:m,count:u})=>{const V=i.documents.find(p=>p.id===m);V&&(V.relationships_count=u)};return we(()=>l.value.length,()=>{K.value>M.value&&(K.value=Math.max(1,M.value))}),we(E,m=>{f("update:searchQuery",m??"")}),we(()=>v.searchQuery,m=>{m!=null&&(E.value=m)},{immediate:!0}),Qe(async()=>{v.promptDocuments||await i.init(),await c.init()}),(m,u)=>{var V;return s(),r("div",null,[e("div",el,[e("div",tl,[e("div",sl,[n(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":u[0]||(u[0]=p=>E.value=p),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Ee,E.value]])])]),e("div",ol,[a.showStateFilter?(s(),le(t(Pe),{key:0,as:"div",class:"relative"},{default:A(()=>[n(t(Le),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[e("div",al,[n(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",rl,g(de.value||"Estado"),1)]),n(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),n(t(Be),{class:"absolute left-0 z-10 mt-2 w-full min-w-[14rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",nl,[n(t(ye),null,{default:A(({active:p})=>[e("a",{onClick:u[1]||(u[1]=fe=>de.value=null),class:j([p?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),r(ge,null,he(a.availableStates,p=>(s(),le(t(ye),{key:p},{default:A(({active:fe})=>[e("a",{onClick:Fe=>de.value=p,class:j([fe?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},g(Ie(p)),11,ll)]),_:2},1024))),128))])]),_:1})]),_:1})):h("",!0),n(t(Pe),{as:"div",class:"relative"},{default:A(()=>[n(t(Le),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[e("div",il,[n(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",dl,g(Ue.value||"Etiqueta"),1)]),n(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),n(t(Be),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",cl,[e("div",ul,[n(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":u[2]||(u[2]=p=>I.value=p),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:u[3]||(u[3]=pe(()=>{},["stop"]))},null,512),[[Ee,I.value]])]),e("div",ml,[n(t(ye),null,{default:A(({active:p})=>[e("a",{onClick:u[4]||(u[4]=fe=>Y.value=null),class:j([p?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),r(ge,null,he(ze.value,p=>(s(),le(t(ye),{key:p.id},{default:A(({active:fe})=>[e("a",{onClick:Fe=>Y.value=p.id,class:j([fe?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:j(["w-3 h-3 rounded-full flex-shrink-0",nt(p)])},null,2),e("span",pl,g(p.name),1)],10,gl)]),_:2},1024))),128))])])]),_:1})]),_:1}),a.showClientFilter?(s(),le(t(Pe),{key:1,as:"div",class:"relative"},{default:A(()=>[n(t(Le),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[e("div",hl,[n(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",fl,g(ce.value||"Cliente"),1)]),n(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),n(t(Be),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",yl,[e("div",vl,[n(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":u[5]||(u[5]=p=>Z.value=p),type:"text",placeholder:"Buscar clientes...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:u[6]||(u[6]=pe(()=>{},["stop"]))},null,512),[[Ee,Z.value]])]),e("div",bl,[n(t(ye),null,{default:A(({active:p})=>[e("a",{onClick:u[7]||(u[7]=fe=>q.value=null),class:j([p?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),r(ge,null,he(ie.value,p=>(s(),le(t(ye),{key:p.id},{default:A(({active:fe})=>[e("a",{onClick:Fe=>q.value=p.id,class:j([fe?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])},g(p.first_name)+" "+g(p.last_name),11,xl)]),_:2},1024))),128))])])]),_:1})]),_:1})):h("",!0)]),e("div",_l,[e("div",wl,[$l,ke(e("input",{"onUpdate:modelValue":u[8]||(u[8]=p=>J.value=p),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Ee,J.value]])]),e("div",kl,[Cl,ke(e("input",{"onUpdate:modelValue":u[9]||(u[9]=p=>P.value=p),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Ee,P.value]])])]),e("div",Dl,[n(t(Pe),{as:"div",class:"relative w-full sm:w-auto"},{default:A(()=>[n(t(Le),{class:"w-full sm:w-auto inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[n(t(Ps),{class:"h-4 w-4"}),e("span",null,g(Se(B.value)),1),n(t(Oe),{class:"h-4 w-4"})]),_:1}),n(t(Be),{class:"absolute left-0 z-10 mt-2 w-56 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",Sl,[(s(),r(ge,null,he(De,p=>n(t(ye),{key:p.value},{default:A(({active:fe})=>[e("a",{onClick:Fe=>B.value=p.value,class:j([fe?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},g(p.label),11,Fl)]),_:2},1024)),64))])]),_:1})]),_:1}),e("div",El,[se.value.length>0?(s(),r("button",{key:0,onClick:S,class:"flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[n(t(ot),{class:"h-4 w-4"}),e("span",null,"Exportar ("+g(se.value.length)+")",1)])):h("",!0),de.value||Y.value||q.value||J.value||P.value?(s(),r("button",{key:1,onClick:je,class:"flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-200 rounded-md bg-white text-xs font-medium text-gray-500 hover:bg-gray-50",title:"Limpiar filtros",type:"button"},[n(t(Ae),{class:"h-4 w-4 flex-shrink-0"}),Tl])):h("",!0)])])]),a.isLoading?(s(),r("div",Al,jl)):!a.isLoading&&o.value.length>0?(s(),r("div",Pl,[e("div",Ll,[e("table",Bl,[e("thead",Rl,[e("tr",null,[_e.value?(s(),r("th",zl,[e("input",{type:"checkbox",checked:L.value,onChange:zt,class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded cursor-pointer"},null,40,Ul)])):h("",!0),Il,Nl,Ol,ql,Vl,Ql,Wl,Hl,Gl,a.showAssociationsColumn&&!x.value?(s(),r("th",Zl," Asociaciones ")):h("",!0),Jl])]),e("tbody",Kl,[(s(!0),r(ge,null,he(o.value,p=>{var fe,Fe;return s(),r("tr",{key:p.id,class:j(["hover:bg-gray-50 cursor-pointer transition-colors duration-150",Rt(p.id)?"bg-yellow-50":""]),onClick:Ke=>W(p)},[_e.value?(s(),r("td",Xl,[e("input",{type:"checkbox",checked:se.value.includes(p.id),onChange:pe(Ke=>vt(p.id),["stop"]),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded cursor-pointer"},null,40,ei)])):h("",!0),e("td",ti,[e("div",si,[n(t(Ne),{class:j(["h-5 w-5 flex-shrink-0",rt(p)])},null,8,["class"]),e("div",oi,[e("span",ai,g(p.title||"Sin título"),1)])])]),e("td",ri,[e("span",{class:j([Ye(p),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},g(Je(p)),3)]),e("td",ni,[e("span",li,g(Lt(p)||"-"),1)]),e("td",ii,[e("span",di,g(p.summary_object||"-"),1)]),e("td",ci,[e("span",ui,g(Bt(p)||"-"),1)]),e("td",mi,[e("span",gi,g(p.summary_term||"-"),1)]),e("td",pi,[p.summary_subscription_date?(s(),r("span",hi,g(ct(p.summary_subscription_date)),1)):(s(),r("span",fi,"-"))]),e("td",yi,[p.summary_start_date?(s(),r("span",vi,g(ct(p.summary_start_date)),1)):(s(),r("span",bi,"-"))]),e("td",xi,[p.summary_end_date?(s(),r("span",_i,g(ct(p.summary_end_date)),1)):(s(),r("span",wi,"-"))]),a.showAssociationsColumn&&!x.value?(s(),r("td",$i,[ut(p)?(s(),r("button",{key:0,onClick:pe(Ke=>t(y)("relationships",p),["stop"]),class:"inline-flex items-center gap-1 text-sm text-secondary hover:text-blue-700"},[n(t(cs),{class:"h-4 w-4"}),e("span",null,g(p.relationships_count||0),1)],8,ki)):(s(),r("span",Ci,g(p.relationships_count||0),1))])):h("",!0),e("td",Di,[e("div",Si,[(s(!0),r(ge,null,he((fe=p.tags)==null?void 0:fe.slice(0,2),Ke=>(s(),r("span",{key:Ke.id,class:j([nt(Ke),"px-2 py-1 text-xs rounded-full"])},g(Ke.name),3))),128)),((Fe=p.tags)==null?void 0:Fe.length)>2?(s(),r("button",{key:0,type:"button",class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 inline-flex items-center gap-1",onClick:pe(Ke=>bt(p),["stop"])},[e("span",null,"+"+g(p.tags.length-2),1)],8,Fi)):h("",!0)])])],10,Yl)}),128))])])]),M.value>1?(s(),r("div",Ei,[e("div",Ti,[e("div",Ai,[e("button",{onClick:u[10]||(u[10]=p=>K.value--),disabled:K.value===1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Anterior ",8,Mi),e("button",{onClick:u[11]||(u[11]=p=>K.value++),disabled:K.value===M.value,class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Siguiente ",8,ji)]),e("div",Pi,[e("div",null,[e("p",Li,[re(" Mostrando "),e("span",Bi,g((K.value-1)*be.value+1),1),re(" a "),e("span",Ri,g(Math.min(K.value*be.value,l.value.length)),1),re(" de "),e("span",zi,g(l.value.length),1),re(" resultados ")])]),e("div",null,[e("nav",Ui,[e("button",{onClick:u[12]||(u[12]=p=>K.value--),disabled:K.value===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[n(t(St),{class:"h-5 w-5"})],8,Ii),(s(!0),r(ge,null,he(me.value,p=>(s(),r("button",{key:p,onClick:fe=>typeof p=="number"?K.value=p:null,class:j([p===K.value?"z-10 bg-secondary border-secondary text-white":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50",typeof p=="string"?"cursor-default":"cursor-pointer","relative inline-flex items-center px-4 py-2 border text-sm font-medium"])},g(p),11,Ni))),128)),e("button",{onClick:u[13]||(u[13]=p=>K.value++),disabled:K.value===M.value,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[n(t(ft),{class:"h-5 w-5"})],8,Oi)])])])])])):h("",!0)])):!a.isLoading&&o.value.length===0?(s(),r("div",qi,[n(t(Ne),{class:"mx-auto h-12 w-12 text-gray-400"}),Vi,e("p",Qi,g(v.promptDocuments?"No se encontraron documentos":"Comienza creando un nuevo documento"),1)])):h("",!0),t(tt)?(s(),le(Qt,{key:3,"is-open":t(tt),document:t(Vt),onClose:u[14]||(u[14]=p=>tt.value=!1)},null,8,["is-open","document"])):h("",!0),t(F).edit.isOpen?(s(),le(t(Wt),{key:4,"is-open":t(F).edit.isOpen,document:t(F).edit.document,"user-role":t(F).edit.userRole||((V=t(c).currentUser)==null?void 0:V.role)||"client","show-editor-button":!t(F).edit.renameOnly,onClose:u[15]||(u[15]=p=>t(C)("edit")),onRefresh:u[16]||(u[16]=p=>f("refresh"))},null,8,["is-open","document","user-role","show-editor-button"])):h("",!0),G.value.email.isOpen?(s(),le(t(Ht),{key:5,"is-open":G.value.email.isOpen,document:G.value.email.document,onClose:u[17]||(u[17]=p=>t(C)("email")),onRefresh:u[18]||(u[18]=p=>f("refresh"))},null,8,["is-open","document"])):h("",!0),t(F).signatures.isOpen?(s(),le(t(is),{key:6,"is-open":t(F).signatures.isOpen,document:t(F).signatures.document,onClose:u[19]||(u[19]=p=>t(C)("signatures")),onRefresh:u[20]||(u[20]=p=>f("refresh"))},null,8,["is-open","document"])):h("",!0),t(F).permissions.isOpen?(s(),le(t(Ts),{key:7,"is-open":t(F).permissions.isOpen,document:t(F).permissions.document,onClose:u[21]||(u[21]=p=>t(C)("permissions")),onRefresh:u[22]||(u[22]=p=>f("refresh"))},null,8,["is-open","document"])):h("",!0),t(F).letterhead.isOpen?(s(),le(Mt,{key:8,"is-visible":t(F).letterhead.isOpen,document:t(F).letterhead.document,onClose:u[23]||(u[23]=p=>t(C)("letterhead")),onRefresh:u[24]||(u[24]=p=>f("refresh"))},null,8,["is-visible","document"])):h("",!0),te.value.isOpen?(s(),le(Ft,{key:9,"is-open":te.value.isOpen,document:te.value.document,onClose:u[25]||(u[25]=p=>t(C)("relationships")),onUpdateCount:ue},null,8,["is-open","document"])):h("",!0),ve.value?(s(),le(Pt,{key:10,"is-visible":ve.value,document:N.value,"card-type":a.cardType,context:v.context||"list","user-store":t(c),onClose:u[26]||(u[26]=p=>ve.value=!1),onRefresh:u[27]||(u[27]=p=>f("refresh")),onAction:_},null,8,["is-visible","document","card-type","context","user-store"])):h("",!0),H.value&&Q.value?(s(),r("div",Wi,[e("div",Hi,[e("div",Gi,[e("div",Zi,[n(t(Nt),{class:"h-5 w-5 text-gray-500"}),Ji]),e("button",{type:"button",class:"text-gray-400 hover:text-gray-600 p-1 rounded-md hover:bg-gray-100",onClick:xt},[n(t(Ae),{class:"h-5 w-5"})])]),e("div",Ki,[Yi,e("span",Xi,g(Q.value.title||"Sin título"),1)]),e("div",ed,[!Q.value.tags||Q.value.tags.length===0?(s(),r("div",td," Este documento no tiene etiquetas. ")):(s(),r("ul",sd,[(s(!0),r(ge,null,he(Q.value.tags,p=>(s(),r("li",{key:p.id,class:"flex items-center justify-between gap-2"},[e("div",od,[e("span",{class:j(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",nt(p)])},g(p.name),3)]),p.description?(s(),r("span",ad,g(p.description),1)):h("",!0)]))),128))]))]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end"},[e("button",{type:"button",class:"px-4 py-2 text-sm font-medium rounded-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-50",onClick:xt}," Cerrar ")])])])):h("",!0)])}}},rd={class:"mb-4"},nd={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},ld={class:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"},id={class:"flex flex-col sm:flex-row gap-3 flex-1 w-full lg:w-auto"},dd={class:"relative flex-1 min-w-[200px]"},cd={class:"max-w-[120px] truncate"},ud={class:"p-2"},md={class:"relative mb-2"},gd={class:"max-h-60 overflow-y-auto"},pd=["onClick"],hd={class:"truncate"},fd={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},yd={class:"flex items-center gap-3 w-full lg:w-auto"},vd={class:"text-sm text-gray-500 whitespace-nowrap"},bd={class:"py-1"},xd={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},_d={class:"min-w-full divide-y divide-gray-200"},wd=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plantilla "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),$d={class:"bg-white divide-y divide-gray-200"},kd=["onClick"],Cd={class:"px-6 py-4 whitespace-nowrap"},Dd={class:"flex items-center"},Sd={class:"flex-shrink-0 h-10 w-10"},Fd={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},Ed={class:"ml-4"},Td={class:"text-sm font-medium text-gray-900"},Ad=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-700 border border-purple-200"}," Disponible ")],-1),Md={class:"px-6 py-4 whitespace-nowrap"},jd={class:"flex flex-wrap gap-1"},Pd={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},Ld={key:1,class:"text-sm text-gray-400"},Bd={class:"py-1"},Rd=["onClick"],zd={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Ud=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay plantillas disponibles",-1),Id={class:"mt-1 text-sm text-gray-500"},Nd=e("div",{class:"mt-4"},[e("div",{class:"text-xs text-gray-400 bg-gray-100 px-3 py-2 rounded-lg inline-block"},[re(" 💡 "),e("strong",null,"Tip:"),re(" Las plantillas son creadas por los abogados ")])],-1),as={__name:"UseDocumentTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["go-back"],setup(a,{emit:w}){const i=qe();Ze();const c=et(),D=w,v=b(""),f=b(""),F=b(null),y=b("recent"),C=b(!1),G=b(null),te=b({}),ee=b({}),O=b(!1),ne=b(-1),X=z(()=>i.publishedDocumentsUnassigned||[]),k=z(()=>{let N=[...X.value];const H=v.value.toLowerCase();return H&&(N=N.filter(Q=>{var K,be;return((K=Q.title)==null?void 0:K.toLowerCase().includes(H))||((be=Q.tags)==null?void 0:be.some(_e=>{var xe;return(xe=_e.name)==null?void 0:xe.toLowerCase().includes(H)}))})),F.value&&(N=N.filter(Q=>Q.tags&&Q.tags.some(K=>K.id===F.value))),y.value==="name"?N.sort((Q,K)=>{const be=(Q.title||"").toLowerCase(),_e=(K.title||"").toLowerCase();return be.localeCompare(_e)}):y.value==="recent"&&N.sort((Q,K)=>K.id-Q.id),N}),d=z(()=>{const N=new Map;return X.value.forEach(H=>{H.tags&&H.tags.length>0&&H.tags.forEach(Q=>{N.has(Q.id)||N.set(Q.id,Q)})}),Array.from(N.values()).sort((H,Q)=>H.name.localeCompare(Q.name))}),T=z(()=>{if(!f.value)return d.value;const N=f.value.toLowerCase();return d.value.filter(H=>H.name.toLowerCase().includes(N))}),R=z(()=>{if(!F.value)return null;const N=d.value.find(H=>H.id===F.value);return N?N.name:null}),U=z(()=>{switch(y.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),$=z(()=>{const N=v.value&&v.value.trim().length>0,H=F.value!==null;return N&&H?"No se encontraron plantillas que coincidan con tu búsqueda y filtros":N?"No se encontraron plantillas que coincidan con tu búsqueda":H?"No se encontraron plantillas con la etiqueta seleccionada":"Aún no hay plantillas disponibles para usar"}),E=N=>{const H=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],Q=N.id%H.length;return H[Q]},I=N=>{const H=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],Q=N.id%H.length;return H[Q]},Z=()=>{F.value=null},de=N=>{N&&(i.selectedDocument=null,G.value=N,C.value=!0)},Y=()=>{C.value=!1,G.value=null},q=N=>{if(N.state==="Published"&&!N.assigned_to)de(N.id);else{const Q=`/dynamic_document_dashboard/document/use/editor/${N.id}/${encodeURIComponent(N.title.trim())}`;c.push(Q)}},J=()=>{D("go-back")};Qe(async()=>{(!i.documents||i.documents.length===0)&&await i.init(!0)});const P=()=>O.value?k.value.length===1?"280px":k.value.length===2&&ne.value===1?"340px":"280px":"auto",B=(N,H)=>{N&&(te.value[H]=N)},se=(N,H)=>{N&&(ee.value[H]=N)},ve=(N,H)=>{O.value=!H,ne.value=H?-1:N,H||setTimeout(()=>{const Q=ee.value[N];if(Q){const K=Q.$el||Q;if(K&&K.getBoundingClientRect){const be=K.getBoundingClientRect(),_e=window.innerHeight;if(N===0){if(be.bottom>_e-20){const xe=be.bottom-_e+40;window.scrollBy({top:xe,behavior:"smooth"})}}else if(be.bottom>_e-10){const xe=be.bottom-_e+30;window.scrollBy({top:xe,behavior:"smooth"})}else if(be.top<80){const xe=be.top-100;window.scrollBy({top:xe,behavior:"smooth"})}}}},100)};return(N,H)=>(s(),r("div",null,[e("div",rd,[e("button",{onClick:J,class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors border border-gray-300"},[n(t(Ls),{class:"h-4 w-4"}),re(" Volver a Mis Documentos ")])]),e("div",nd,[e("div",ld,[e("div",id,[e("div",dd,[n(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":H[0]||(H[0]=Q=>v.value=Q),type:"text",placeholder:"Buscar plantillas...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent"},null,512),[[Ee,v.value]])]),n(t(Pe),{as:"div",class:"relative"},{default:A(()=>[n(t(Le),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[n(t(st),{class:"h-4 w-4"}),e("span",cd,g(R.value||"Etiqueta"),1),n(t(Oe),{class:"h-4 w-4"})]),_:1}),n(t(Be),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",ud,[e("div",md,[n(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":H[1]||(H[1]=Q=>f.value=Q),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:H[2]||(H[2]=pe(()=>{},["stop"]))},null,512),[[Ee,f.value]])]),e("div",gd,[n(t(ye),null,{default:A(({active:Q})=>[e("a",{onClick:H[3]||(H[3]=K=>F.value=null),class:j([Q?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),r(ge,null,he(T.value,Q=>(s(),le(t(ye),{key:Q.id},{default:A(({active:K})=>[e("a",{onClick:be=>F.value=Q.id,class:j([K?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:j(["w-3 h-3 rounded-full flex-shrink-0",I(Q)])},null,2),e("span",hd,g(Q.name),1)],10,pd)]),_:2},1024))),128)),T.value.length===0?(s(),r("div",fd," No se encontraron etiquetas ")):h("",!0)])])]),_:1})]),_:1}),F.value?(s(),r("button",{key:0,onClick:Z,class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[n(t(Ae),{class:"h-4 w-4"}),re(" Limpiar ")])):h("",!0)]),e("div",yd,[e("span",vd," Mostrando "+g(k.value.length)+" plantillas ",1),n(t(Pe),{as:"div",class:"relative"},{default:A(()=>[n(t(Le),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[re(" Ordenar: "+g(U.value)+" ",1),n(t(Oe),{class:"h-4 w-4"})]),_:1}),n(t(Be),{class:"absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",bd,[n(t(ye),null,{default:A(({active:Q})=>[e("a",{onClick:H[4]||(H[4]=K=>y.value="recent"),class:j([Q?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),n(t(ye),null,{default:A(({active:Q})=>[e("a",{onClick:H[5]||(H[5]=K=>y.value="name"),class:j([Q?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),k.value.length>0?(s(),r("div",xd,[e("div",{class:"overflow-x-auto",style:Ve({minHeight:P()})},[e("table",_d,[wd,e("tbody",$d,[(s(!0),r(ge,null,he(k.value,(Q,K)=>{var be;return s(),r("tr",{key:Q.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:_e=>q(Q)},[e("td",Cd,[e("div",Dd,[e("div",Sd,[e("div",Fd,[n(t(Ne),{class:"h-5 w-5 text-purple-600"})])]),e("div",Ed,[e("div",Td,g(Q.title),1)])])]),Ad,e("td",Md,[e("div",jd,[(s(!0),r(ge,null,he((be=Q.tags)==null?void 0:be.slice(0,2),_e=>(s(),r("span",{key:_e.id,class:j(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",E(_e)])},g(_e.name),3))),128)),Q.tags&&Q.tags.length>2?(s(),r("span",Pd," +"+g(Q.tags.length-2),1)):h("",!0),!Q.tags||Q.tags.length===0?(s(),r("span",Ld,"-")):h("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:H[6]||(H[6]=pe(()=>{},["stop"]))},[n(t(Pe),{as:"div",class:"relative inline-block text-left"},{default:A(({open:_e})=>[n(t(Le),{ref_for:!0,ref:xe=>B(xe,K),onClick:xe=>ve(K,_e),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:A(()=>[n(t(it),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),n(t(Be),{ref_for:!0,ref:xe=>se(xe,K),class:j([k.value.length>2&&K>0&&K>=k.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:A(()=>[e("div",Bd,[n(t(ye),null,{default:A(({active:xe})=>[e("a",{onClick:Re=>q(Q),class:j([xe?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Usar plantilla ",10,Rd)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,kd)}),128))])])],4)])):(s(),r("div",zd,[n(t(jt),{class:"mx-auto h-12 w-12 text-gray-400"}),Ud,e("p",Id,g($.value),1),Nd])),ke(n(Ge,null,{default:A(()=>[G.value!==null?(s(),le(ms,{key:0,"document-id":G.value,onClose:Y},null,8,["document-id"])):h("",!0)]),_:1},512),[[ht,C.value]])]))}},Od={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},qd={class:"mb-4"},Vd={class:"relative w-full"},Qd={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},Wd={class:"flex items-center gap-2 min-w-0"},Hd={class:"truncate"},Gd={class:"py-1"},Zd=["onClick"],Jd={class:"flex items-center justify-stretch"},Kd=e("span",null,"Limpiar",-1),Yd={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},Xd={class:"flex flex-col gap-1"},ec=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),tc={class:"flex flex-col gap-1"},sc=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),oc={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},ac={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},rc={class:"flex items-center gap-2"},nc=e("span",{class:"hidden sm:inline"},"Exportar",-1),lc={class:"py-1"},ic=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),dc={class:"py-1"},cc={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},uc={class:"overflow-x-auto",style:{"overflow-y":"visible"}},mc={class:"min-w-full divide-y divide-gray-200"},gc={class:"bg-gray-50"},pc={scope:"col",class:"w-12 px-6 py-3"},hc=["checked"],fc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),yc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),vc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),bc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Docs. Asociados ",-1),xc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),_c={class:"bg-white divide-y divide-gray-200"},wc=["onClick"],$c=["checked","onChange"],kc={class:"px-6 py-4 whitespace-nowrap"},Cc={class:"flex items-center"},Dc={class:"flex-shrink-0 h-10 w-10"},Sc={class:"h-10 w-10 rounded-lg bg-green-100 flex items-center justify-center"},Fc={class:"ml-4"},Ec={class:"text-sm font-medium text-gray-900"},Tc={class:"px-6 py-4 whitespace-nowrap"},Ac={class:"text-sm text-gray-900"},Mc=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-700 border border-green-200"}," Completado ")],-1),jc={class:"px-6 py-4 whitespace-nowrap"},Pc=["onClick"],Lc={class:"px-6 py-4 whitespace-nowrap"},Bc={class:"flex flex-wrap gap-1"},Rc={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},zc={key:1,class:"text-sm text-gray-400"},Uc={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Ic={class:"flex flex-1 justify-between sm:hidden"},Nc=["disabled"],Oc=["disabled"],qc={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Vc={class:"text-sm text-gray-700"},Qc={class:"font-medium"},Wc={class:"font-medium"},Hc={class:"font-medium"},Gc={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Zc=["disabled"],Jc=e("span",{class:"sr-only"},"Anterior",-1),Kc=["onClick"],Yc={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},Xc=["disabled"],eu=e("span",{class:"sr-only"},"Siguiente",-1),tu={key:0,class:"text-center py-12"},su=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos completados",-1),ou=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos completados por clientes aparecerán aquí.",-1),au={__name:"DocumentFinishedByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(a,{emit:w}){const i=qe(),c=Ze(),D=et(),v=a,f=w,{activeModals:F,openModal:y,closeModal:C,getUserRole:G}=Tt(i,c),{handlePreviewDocument:te,deleteDocument:ee,downloadPDFDocument:O,downloadWordDocument:ne}=At(i,c,f),X=b(""),k=b(null),d=b(""),T=b(""),R=b("recent"),U=b([]),$=b(1),E=b(10);Qe(()=>{i.init(),c.init()});const I=z(()=>{const x=i.completedDocumentsByClient,l=v.selectedTags?v.selectedTags.map(M=>M.id):[];return i.filteredDocumentsBySearchAndTags(v.searchQuery,c,l).filter(M=>x.some(me=>me.id===M.id))}),Z=z(()=>{let x=[...I.value];const l=X.value.toLowerCase();return l&&(x=x.filter(o=>{var M,me;return((M=o.title)==null?void 0:M.toLowerCase().includes(l))||((me=o.tags)==null?void 0:me.some(L=>{var De;return(De=L.name)==null?void 0:De.toLowerCase().includes(l)}))})),k.value&&(x=x.filter(o=>o.tags&&o.tags.some(M=>M.id===k.value))),(d.value||T.value)&&(x=x.filter(o=>{const M=o.summary_subscription_date||o.created_at||o.updated_at;if(!M)return!1;const me=new Date(M);if(isNaN(me.getTime()))return!1;if(d.value){const L=new Date(d.value);if(me<L)return!1}if(T.value){const L=new Date(T.value);if(L.setHours(23,59,59,999),me>L)return!1}return!0})),R.value==="name"?x.sort((o,M)=>{const me=(o.title||"").toLowerCase(),L=(M.title||"").toLowerCase();return me.localeCompare(L)}):R.value==="recent"&&x.sort((o,M)=>{const me=new Date(o.updated_at||o.created_at);return new Date(M.updated_at||M.created_at)-me}),x}),de=z(()=>{const x=($.value-1)*E.value,l=x+E.value;return Z.value.slice(x,l)}),Y=z(()=>Math.ceil(Z.value.length/E.value)),q=z(()=>{const x=($.value-1)*E.value+1,l=Math.min($.value*E.value,Z.value.length);return{start:x,end:l,total:Z.value.length}});we([X,k,d,T],()=>{$.value=1});const J=z(()=>{const x=new Map;return I.value.forEach(l=>{l.tags&&l.tags.length>0&&l.tags.forEach(o=>{x.has(o.id)||x.set(o.id,o)})}),Array.from(x.values()).sort((l,o)=>l.name.localeCompare(o.name))}),P=z(()=>{if(!k.value)return null;const x=J.value.find(l=>l.id===k.value);return x?x.name:null}),B=z(()=>{switch(R.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),se=x=>x.summary_counterparty?x.summary_counterparty:"Cliente",ve=x=>{const l=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],o=x.id%l.length;return l[o]},N=z(()=>Z.value.length>0&&U.value.length===Z.value.length),H=()=>{N.value?U.value=[]:U.value=Z.value.map(x=>x.id)},Q=x=>{const l=U.value.indexOf(x);l>-1?U.value.splice(l,1):U.value.push(x)},K=()=>{U.value=Z.value.map(x=>x.id)},be=()=>{U.value=[]},_e=()=>{k.value=null,d.value="",T.value=""},xe=()=>{$.value>1&&$.value--},Re=()=>{$.value<Y.value&&$.value++},ze=x=>{x>=1&&x<=Y.value&&($.value=x)},Ue=z(()=>{const x=Y.value,l=$.value,o=[];if(x<=7)for(let M=1;M<=x;M++)o.push(M);else if(l<=4){for(let M=1;M<=5;M++)o.push(M);o.push("..."),o.push(x)}else if(l>=x-3){o.push(1),o.push("...");for(let M=x-4;M<=x;M++)o.push(M)}else o.push(1),o.push("..."),o.push(l-1),o.push(l),o.push(l+1),o.push("..."),o.push(x);return o}),oe=()=>{const x=U.value.length>0?Z.value.filter(Se=>U.value.includes(Se.id)):Z.value,l=["Nombre Documento","Cliente","Estado","Etiquetas"],o=x.map(Se=>[Se.title||"",se(Se),"Completado",Se.tags?Se.tags.map(Ie=>Ie.name).join(", "):""]),M=[l.join(","),...o.map(Se=>Se.map(Ie=>`"${Ie}"`).join(","))].join(`
`),me=new Blob([M],{type:"text/csv;charset=utf-8;"}),L=document.createElement("a"),De=URL.createObjectURL(me);L.setAttribute("href",De),L.setAttribute("download",`documentos_completados_${new Date().toISOString().split("T")[0]}.csv`),L.style.visibility="hidden",document.body.appendChild(L),L.click(),document.body.removeChild(L)},ie=async(x,l)=>{try{switch(x){case"editForm":y("edit",l,{userRole:G()});break;case"editDocument":D.push(`/dynamic_document_dashboard/client/editor/edit/${l.id}`);break;case"preview":await te(l);break;case"delete":await ee(l);break;case"letterhead":y("letterhead",l);break;case"relationships":y("relationships",l);break;case"downloadPDF":await O(l);break;case"downloadWord":await ne(l);break;case"email":y("email",l);break;default:console.warn("Unknown action:",x)}}catch(o){console.error(`Error executing action ${x}:`,o)}},ce=b(!1),Ce=b(null),Te=x=>{Ce.value=x,ce.value=!0},je=async(x,l)=>{ce.value=!1,await ie(x,l)};return(x,l)=>(s(),r("div",null,[e("div",Od,[e("div",qd,[e("div",Vd,[n(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":l[0]||(l[0]=o=>X.value=o),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Ee,X.value]])])]),e("div",Qd,[n(t(Pe),{as:"div",class:"relative"},{default:A(()=>[n(t(Le),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[e("div",Wd,[n(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",Hd,g(P.value||"Etiqueta"),1)]),n(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),n(t(Be),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:A(()=>[e("div",Gd,[n(t(ye),null,{default:A(({active:o})=>[e("a",{onClick:l[1]||(l[1]=M=>k.value=null),class:j([o?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),r(ge,null,he(J.value,o=>(s(),le(t(ye),{key:o.id},{default:A(({active:M})=>[e("a",{onClick:me=>k.value=o.id,class:j([M?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},g(o.name),11,Zd)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",Jd,[k.value||d.value||T.value?(s(),r("button",{key:0,onClick:_e,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[n(t(Ae),{class:"h-4 w-4 flex-shrink-0"}),Kd])):h("",!0)])]),e("div",Yd,[e("div",Xd,[ec,ke(e("input",{"onUpdate:modelValue":l[2]||(l[2]=o=>d.value=o),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Ee,d.value]])]),e("div",tc,[sc,ke(e("input",{"onUpdate:modelValue":l[3]||(l[3]=o=>T.value=o),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Ee,T.value]])])]),e("div",oc,[e("div",ac,[e("div",rc,[e("button",{onClick:oe,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[n(t(ot),{class:"h-4 w-4"}),nc]),n(t(Pe),{as:"div",class:"relative"},{default:A(()=>[n(t(Le),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:A(()=>[n(t(it),{class:"h-5 w-5 text-gray-500"})]),_:1}),n(t(Be),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",lc,[n(t(ye),null,{default:A(({active:o})=>[e("a",{onClick:K,class:j([o?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),n(t(ye),null,{default:A(({active:o})=>[e("a",{onClick:be,class:j([o?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),n(t(Pe),{as:"div",class:"relative"},{default:A(()=>[n(t(Le),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[ic,re(" "+g(B.value)+" ",1),n(t(Oe),{class:"h-4 w-4"})]),_:1}),n(t(Be),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",dc,[n(t(ye),null,{default:A(({active:o})=>[e("a",{onClick:l[4]||(l[4]=M=>R.value="recent"),class:j([o?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),n(t(ye),null,{default:A(({active:o})=>[e("a",{onClick:l[5]||(l[5]=M=>R.value="name"),class:j([o?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",cc,[e("div",uc,[e("table",mc,[e("thead",gc,[e("tr",null,[e("th",pc,[e("input",{type:"checkbox",checked:N.value,onChange:H,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,hc)]),fc,yc,vc,bc,xc])]),e("tbody",_c,[(s(!0),r(ge,null,he(de.value,(o,M)=>{var me;return s(),r("tr",{key:o.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:L=>Te(o)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:l[6]||(l[6]=pe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:U.value.includes(o.id),onChange:L=>Q(o.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,$c)]),e("td",kc,[e("div",Cc,[e("div",Dc,[e("div",Sc,[n(t(Ne),{class:"h-5 w-5 text-green-600"})])]),e("div",Fc,[e("div",Ec,g(o.title),1)])])]),e("td",Tc,[e("div",Ac,g(se(o)),1)]),Mc,e("td",jc,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100",onClick:pe(L=>t(y)("relationships",o),["stop"])}," Ver asociaciones ",8,Pc)]),e("td",Lc,[e("div",Bc,[(s(!0),r(ge,null,he((me=o.tags)==null?void 0:me.slice(0,2),L=>(s(),r("span",{key:L.id,class:j(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ve(L)])},g(L.name),3))),128)),o.tags&&o.tags.length>2?(s(),r("span",Rc," +"+g(o.tags.length-2),1)):h("",!0),!o.tags||o.tags.length===0?(s(),r("span",zc,"-")):h("",!0)])])],8,wc)}),128))])])]),Y.value>1?(s(),r("div",Uc,[e("div",Ic,[e("button",{onClick:xe,disabled:$.value===1,class:j(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",$.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,Nc),e("button",{onClick:Re,disabled:$.value===Y.value,class:j(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",$.value===Y.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Oc)]),e("div",qc,[e("div",null,[e("p",Vc,[re(" Mostrando "),e("span",Qc,g(q.value.start),1),re(" a "),e("span",Wc,g(q.value.end),1),re(" de "),e("span",Hc,g(q.value.total),1),re(" resultados ")])]),e("div",null,[e("nav",Gc,[e("button",{onClick:xe,disabled:$.value===1,class:j(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",$.value===1?"opacity-50 cursor-not-allowed":""])},[Jc,n(t(St),{class:"h-5 w-5","aria-hidden":"true"})],10,Zc),(s(!0),r(ge,null,he(Ue.value,o=>(s(),r(ge,{key:o},[o!=="..."?(s(),r("button",{key:0,onClick:M=>ze(o),class:j(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",$.value===o?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},g(o),11,Kc)):(s(),r("span",Yc," ... "))],64))),128)),e("button",{onClick:Re,disabled:$.value===Y.value,class:j(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",$.value===Y.value?"opacity-50 cursor-not-allowed":""])},[eu,n(t(ft),{class:"h-5 w-5","aria-hidden":"true"})],10,Xc)])])])])):h("",!0)]),Z.value.length===0?(s(),r("div",tu,[n(t(jt),{class:"mx-auto h-12 w-12 text-gray-400"}),su,ou])):h("",!0),(s(),le(qt,{to:"body"},[t(F).edit.isOpen?(s(),le(t(Wt),{key:0,document:t(F).edit.document,"user-role":t(G)(),onClose:l[7]||(l[7]=o=>t(C)("edit")),onRefresh:l[8]||(l[8]=o=>f("refresh"))},null,8,["document","user-role"])):h("",!0),t(F).email.isOpen?(s(),le(t(Ht),{key:1,document:t(F).email.document,onClose:l[9]||(l[9]=o=>t(C)("email"))},null,8,["document"])):h("",!0),t(F).letterhead.isOpen?(s(),le(Mt,{key:2,"is-visible":t(F).letterhead.isOpen,document:t(F).letterhead.document,onClose:l[10]||(l[10]=o=>t(C)("letterhead")),onUploaded:l[11]||(l[11]=o=>f("refresh")),onDeleted:l[12]||(l[12]=o=>f("refresh"))},null,8,["is-visible","document"])):h("",!0),t(F).relationships.isOpen?(s(),le(Ft,{key:3,"is-open":t(F).relationships.isOpen,document:t(F).relationships.document,onClose:l[13]||(l[13]=o=>t(C)("relationships")),onRefresh:l[14]||(l[14]=o=>f("refresh"))},null,8,["is-open","document"])):h("",!0),ce.value?(s(),le(Pt,{key:4,"is-visible":ce.value,document:Ce.value,"card-type":"client",context:"table","user-store":t(c),onClose:l[15]||(l[15]=o=>ce.value=!1),onAction:je},null,8,["is-visible","document","user-store"])):h("",!0)]))]))}},ru={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},nu={class:"mb-4"},lu={class:"relative w-full"},iu={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},du={class:"flex items-center gap-2 min-w-0"},cu={class:"truncate"},uu={class:"py-1"},mu=["onClick"],gu={class:"flex items-center justify-stretch"},pu=e("span",null,"Limpiar",-1),hu={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},fu={class:"flex flex-col gap-1"},yu=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),vu={class:"flex flex-col gap-1"},bu=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),xu={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},_u={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},wu={class:"flex items-center gap-2"},$u=e("span",{class:"hidden sm:inline"},"Exportar",-1),ku={class:"py-1"},Cu=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),Du={class:"py-1"},Su={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Fu={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Eu={class:"min-w-full divide-y divide-gray-200"},Tu={class:"bg-gray-50"},Au={scope:"col",class:"w-12 px-6 py-3"},Mu=["checked"],ju=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Pu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),Lu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),Bu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Docs. Asociados ",-1),Ru=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),zu={class:"bg-white divide-y divide-gray-200"},Uu=["onClick"],Iu=["checked","onChange"],Nu={class:"px-6 py-4 whitespace-nowrap"},Ou={class:"flex items-center"},qu={class:"flex-shrink-0 h-10 w-10"},Vu={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Qu={class:"ml-4"},Wu={class:"text-sm font-medium text-gray-900"},Hu={class:"px-6 py-4 whitespace-nowrap"},Gu={class:"text-sm text-gray-900"},Zu=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-700 border border-blue-200"}," En Progreso ")],-1),Ju={class:"px-6 py-4 whitespace-nowrap"},Ku=["onClick"],Yu={class:"px-6 py-4 whitespace-nowrap"},Xu={class:"flex flex-wrap gap-1"},em={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},tm={key:1,class:"text-sm text-gray-400"},sm={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},om={class:"flex flex-1 justify-between sm:hidden"},am=["disabled"],rm=["disabled"],nm={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},lm={class:"text-sm text-gray-700"},im={class:"font-medium"},dm={class:"font-medium"},cm={class:"font-medium"},um={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},mm=["disabled"],gm=e("span",{class:"sr-only"},"Anterior",-1),pm=["onClick"],hm={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},fm=["disabled"],ym=e("span",{class:"sr-only"},"Siguiente",-1),vm={key:0,class:"text-center py-12"},bm=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos en progreso",-1),xm=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos en progreso por clientes aparecerán aquí.",-1),_m={__name:"DocumentInProgressByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(a,{emit:w}){const i=qe(),c=Ze(),D=et(),v=a,f=w,{activeModals:F,openModal:y,closeModal:C,getUserRole:G}=Tt(i,c),{handlePreviewDocument:te,deleteDocument:ee,downloadPDFDocument:O,downloadWordDocument:ne}=At(i,c,f),X=b(""),k=b(null),d=b(""),T=b(""),R=b("recent"),U=b([]),$=b(1),E=b(10);Qe(()=>{i.init(),c.init()});const I=z(()=>{const x=i.progressDocumentsByClient,l=v.selectedTags?v.selectedTags.map(M=>M.id):[];return i.filteredDocumentsBySearchAndTags(v.searchQuery,c,l).filter(M=>x.some(me=>me.id===M.id))}),Z=z(()=>{let x=[...I.value];const l=X.value.toLowerCase();return l&&(x=x.filter(o=>{var M,me;return((M=o.title)==null?void 0:M.toLowerCase().includes(l))||((me=o.tags)==null?void 0:me.some(L=>{var De;return(De=L.name)==null?void 0:De.toLowerCase().includes(l)}))})),k.value&&(x=x.filter(o=>o.tags&&o.tags.some(M=>M.id===k.value))),(d.value||T.value)&&(x=x.filter(o=>{const M=o.summary_subscription_date||o.created_at||o.updated_at;if(!M)return!1;const me=new Date(M);if(isNaN(me.getTime()))return!1;if(d.value){const L=new Date(d.value);if(me<L)return!1}if(T.value){const L=new Date(T.value);if(L.setHours(23,59,59,999),me>L)return!1}return!0})),R.value==="name"?x.sort((o,M)=>{const me=(o.title||"").toLowerCase(),L=(M.title||"").toLowerCase();return me.localeCompare(L)}):R.value==="recent"&&x.sort((o,M)=>{const me=new Date(o.updated_at||o.created_at);return new Date(M.updated_at||M.created_at)-me}),x}),de=z(()=>{const x=($.value-1)*E.value,l=x+E.value;return Z.value.slice(x,l)}),Y=z(()=>Math.ceil(Z.value.length/E.value)),q=z(()=>{const x=($.value-1)*E.value+1,l=Math.min($.value*E.value,Z.value.length);return{start:x,end:l,total:Z.value.length}});we([X,k,d,T],()=>{$.value=1});const J=z(()=>{const x=new Map;return I.value.forEach(l=>{l.tags&&l.tags.length>0&&l.tags.forEach(o=>{x.has(o.id)||x.set(o.id,o)})}),Array.from(x.values()).sort((l,o)=>l.name.localeCompare(o.name))}),P=z(()=>{if(!k.value)return null;const x=J.value.find(l=>l.id===k.value);return x?x.name:null}),B=z(()=>{switch(R.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),se=x=>x.summary_counterparty?x.summary_counterparty:"Cliente",ve=x=>{const l=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],o=x.id%l.length;return l[o]},N=z(()=>Z.value.length>0&&U.value.length===Z.value.length),H=()=>{N.value?U.value=[]:U.value=Z.value.map(x=>x.id)},Q=x=>{const l=U.value.indexOf(x);l>-1?U.value.splice(l,1):U.value.push(x)},K=()=>{U.value=Z.value.map(x=>x.id)},be=()=>{U.value=[]},_e=()=>{k.value=null,d.value="",T.value=""},xe=()=>{$.value>1&&$.value--},Re=()=>{$.value<Y.value&&$.value++},ze=x=>{x>=1&&x<=Y.value&&($.value=x)},Ue=z(()=>{const x=Y.value,l=$.value,o=[];if(x<=7)for(let M=1;M<=x;M++)o.push(M);else if(l<=4){for(let M=1;M<=5;M++)o.push(M);o.push("..."),o.push(x)}else if(l>=x-3){o.push(1),o.push("...");for(let M=x-4;M<=x;M++)o.push(M)}else o.push(1),o.push("..."),o.push(l-1),o.push(l),o.push(l+1),o.push("..."),o.push(x);return o}),oe=()=>{const x=U.value.length>0?Z.value.filter(Se=>U.value.includes(Se.id)):Z.value,l=["Nombre Documento","Cliente","Estado","Etiquetas"],o=x.map(Se=>[Se.title||"",se(Se),"En Progreso",Se.tags?Se.tags.map(Ie=>Ie.name).join(", "):""]),M=[l.join(","),...o.map(Se=>Se.map(Ie=>`"${Ie}"`).join(","))].join(`
`),me=new Blob([M],{type:"text/csv;charset=utf-8;"}),L=document.createElement("a"),De=URL.createObjectURL(me);L.setAttribute("href",De),L.setAttribute("download",`documentos_en_progreso_${new Date().toISOString().split("T")[0]}.csv`),L.style.visibility="hidden",document.body.appendChild(L),L.click(),document.body.removeChild(L)},ie=async(x,l)=>{try{switch(x){case"editForm":y("edit",l,{userRole:G()});break;case"editDocument":D.push(`/dynamic_document_dashboard/client/editor/edit/${l.id}`);break;case"preview":await te(l);break;case"delete":await ee(l);break;case"letterhead":y("letterhead",l);break;case"relationships":y("relationships",l);break;case"downloadPDF":await O(l);break;case"downloadWord":await ne(l);break;case"email":y("email",l);break;default:console.warn("Unknown action:",x)}}catch(o){console.error(`Error executing action ${x}:`,o)}},ce=b(!1),Ce=b(null),Te=x=>{Ce.value=x,ce.value=!0},je=async(x,l)=>{ce.value=!1,await ie(x,l)};return(x,l)=>(s(),r("div",null,[e("div",ru,[e("div",nu,[e("div",lu,[n(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":l[0]||(l[0]=o=>X.value=o),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Ee,X.value]])])]),e("div",iu,[n(t(Pe),{as:"div",class:"relative"},{default:A(()=>[n(t(Le),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[e("div",du,[n(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",cu,g(P.value||"Etiqueta"),1)]),n(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),n(t(Be),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:A(()=>[e("div",uu,[n(t(ye),null,{default:A(({active:o})=>[e("a",{onClick:l[1]||(l[1]=M=>k.value=null),class:j([o?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),r(ge,null,he(J.value,o=>(s(),le(t(ye),{key:o.id},{default:A(({active:M})=>[e("a",{onClick:me=>k.value=o.id,class:j([M?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},g(o.name),11,mu)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",gu,[k.value||d.value||T.value?(s(),r("button",{key:0,onClick:_e,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[n(t(Ae),{class:"h-4 w-4 flex-shrink-0"}),pu])):h("",!0)])]),e("div",hu,[e("div",fu,[yu,ke(e("input",{"onUpdate:modelValue":l[2]||(l[2]=o=>d.value=o),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Ee,d.value]])]),e("div",vu,[bu,ke(e("input",{"onUpdate:modelValue":l[3]||(l[3]=o=>T.value=o),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Ee,T.value]])])]),e("div",xu,[e("div",_u,[e("div",wu,[e("button",{onClick:oe,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[n(t(ot),{class:"h-4 w-4"}),$u]),n(t(Pe),{as:"div",class:"relative"},{default:A(()=>[n(t(Le),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:A(()=>[n(t(it),{class:"h-5 w-5 text-gray-500"})]),_:1}),n(t(Be),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",ku,[n(t(ye),null,{default:A(({active:o})=>[e("a",{onClick:K,class:j([o?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),n(t(ye),null,{default:A(({active:o})=>[e("a",{onClick:be,class:j([o?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),n(t(Pe),{as:"div",class:"relative"},{default:A(()=>[n(t(Le),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[Cu,re(" "+g(B.value)+" ",1),n(t(Oe),{class:"h-4 w-4"})]),_:1}),n(t(Be),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",Du,[n(t(ye),null,{default:A(({active:o})=>[e("a",{onClick:l[4]||(l[4]=M=>R.value="recent"),class:j([o?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),n(t(ye),null,{default:A(({active:o})=>[e("a",{onClick:l[5]||(l[5]=M=>R.value="name"),class:j([o?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Su,[e("div",Fu,[e("table",Eu,[e("thead",Tu,[e("tr",null,[e("th",Au,[e("input",{type:"checkbox",checked:N.value,onChange:H,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Mu)]),ju,Pu,Lu,Bu,Ru])]),e("tbody",zu,[(s(!0),r(ge,null,he(de.value,(o,M)=>{var me;return s(),r("tr",{key:o.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:L=>Te(o)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:l[6]||(l[6]=pe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:U.value.includes(o.id),onChange:L=>Q(o.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Iu)]),e("td",Nu,[e("div",Ou,[e("div",qu,[e("div",Vu,[n(t(Ne),{class:"h-5 w-5 text-blue-600"})])]),e("div",Qu,[e("div",Wu,g(o.title),1)])])]),e("td",Hu,[e("div",Gu,g(se(o)),1)]),Zu,e("td",Ju,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100",onClick:pe(L=>t(y)("relationships",o),["stop"])}," Ver asociaciones ",8,Ku)]),e("td",Yu,[e("div",Xu,[(s(!0),r(ge,null,he((me=o.tags)==null?void 0:me.slice(0,2),L=>(s(),r("span",{key:L.id,class:j(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ve(L)])},g(L.name),3))),128)),o.tags&&o.tags.length>2?(s(),r("span",em," +"+g(o.tags.length-2),1)):h("",!0),!o.tags||o.tags.length===0?(s(),r("span",tm,"-")):h("",!0)])])],8,Uu)}),128))])])]),Y.value>1?(s(),r("div",sm,[e("div",om,[e("button",{onClick:xe,disabled:$.value===1,class:j(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",$.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,am),e("button",{onClick:Re,disabled:$.value===Y.value,class:j(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",$.value===Y.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,rm)]),e("div",nm,[e("div",null,[e("p",lm,[re(" Mostrando "),e("span",im,g(q.value.start),1),re(" a "),e("span",dm,g(q.value.end),1),re(" de "),e("span",cm,g(q.value.total),1),re(" resultados ")])]),e("div",null,[e("nav",um,[e("button",{onClick:xe,disabled:$.value===1,class:j(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",$.value===1?"opacity-50 cursor-not-allowed":""])},[gm,n(t(St),{class:"h-5 w-5","aria-hidden":"true"})],10,mm),(s(!0),r(ge,null,he(Ue.value,o=>(s(),r(ge,{key:o},[o!=="..."?(s(),r("button",{key:0,onClick:M=>ze(o),class:j(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",$.value===o?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},g(o),11,pm)):(s(),r("span",hm," ... "))],64))),128)),e("button",{onClick:Re,disabled:$.value===Y.value,class:j(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",$.value===Y.value?"opacity-50 cursor-not-allowed":""])},[ym,n(t(ft),{class:"h-5 w-5","aria-hidden":"true"})],10,fm)])])])])):h("",!0)]),Z.value.length===0?(s(),r("div",vm,[n(t(jt),{class:"mx-auto h-12 w-12 text-gray-400"}),bm,xm])):h("",!0),(s(),le(qt,{to:"body"},[t(F).edit.isOpen?(s(),le(t(Wt),{key:0,document:t(F).edit.document,"user-role":t(G)(),onClose:l[7]||(l[7]=o=>t(C)("edit")),onRefresh:l[8]||(l[8]=o=>f("refresh"))},null,8,["document","user-role"])):h("",!0),t(F).email.isOpen?(s(),le(t(Ht),{key:1,document:t(F).email.document,onClose:l[9]||(l[9]=o=>t(C)("email"))},null,8,["document"])):h("",!0),t(F).letterhead.isOpen?(s(),le(Mt,{key:2,"is-visible":t(F).letterhead.isOpen,document:t(F).letterhead.document,onClose:l[10]||(l[10]=o=>t(C)("letterhead")),onUploaded:l[11]||(l[11]=o=>f("refresh")),onDeleted:l[12]||(l[12]=o=>f("refresh"))},null,8,["is-visible","document"])):h("",!0),t(F).relationships.isOpen?(s(),le(Ft,{key:3,"is-open":t(F).relationships.isOpen,document:t(F).relationships.document,onClose:l[13]||(l[13]=o=>t(C)("relationships")),onRefresh:l[14]||(l[14]=o=>f("refresh"))},null,8,["is-open","document"])):h("",!0),ce.value?(s(),le(Pt,{key:4,"is-visible":ce.value,document:Ce.value,"card-type":"client",context:"table","user-store":t(c),onClose:l[15]||(l[15]=o=>ce.value=!1),onAction:je},null,8,["is-visible","document","user-store"])):h("",!0)]))]))}},wm={class:"bg-white rounded-xl shadow-xl max-w-lg w-full mx-4"},$m={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},km=e("h2",{class:"text-sm font-semibold text-gray-900"}," Información clave del documento ",-1),Cm=e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.8",d:"M6 6l8 8M6 14L14 6"})],-1),Dm=[Cm],Sm={class:"px-4 py-4 space-y-4 text-sm text-gray-800 max-h-[70vh] overflow-y-auto"},Fm={key:0},Em=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Usuario / Contraparte ",-1),Tm={class:"text-gray-900 break-words"},Am={key:1},Mm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Objeto ",-1),jm={class:"text-gray-900 whitespace-pre-line"},Pm={key:2},Lm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Valor ",-1),Bm={class:"text-gray-900 font-medium text-base"},Rm={key:3},zm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Plazo ",-1),Um={class:"text-gray-900"},Im={key:4},Nm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Fechas ",-1),Om={class:"space-y-1 text-gray-900"},qm={key:0},Vm=e("span",{class:"font-medium"},"Suscripción:",-1),Qm={class:"ml-1"},Wm={key:1},Hm=e("span",{class:"font-medium"},"Vigencia:",-1),Gm={class:"ml-1"},Zm={key:0},Jm={key:1},Km={key:2},Ym={key:5,class:"text-gray-400 text-sm"},Xm={class:"px-4 py-3 border-t border-gray-100 flex justify-end"},eg={__name:"DocumentSummaryModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close"],setup(a,{emit:w}){const i=a,c=z(()=>i.document&&i.document.summary_counterparty||""),D=z(()=>{if(!i.document||!i.document.summary_value)return"";const y=i.document.summary_value,C=i.document.summary_value_currency||"",G=new Intl.NumberFormat("es-CO",{minimumFractionDigits:0,maximumFractionDigits:2}).format(y);return C==="USD"?`USD $${G}`:C==="EUR"?`€${G}`:C==="COP"?`$${G} COP`:C?`${C} ${G}`:`$${G}`}),v=z(()=>i.document?!!(i.document.summary_subscription_date||i.document.summary_start_date||i.document.summary_end_date):!1),f=z(()=>i.document?!!(c.value||i.document.summary_object||D.value||i.document.summary_term||v.value):!1),F=y=>y?typeof y=="string"?y.split("T")[0]:y:"";return(y,C)=>a.isVisible&&a.document?(s(),r("div",{key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",onClick:C[2]||(C[2]=pe(G=>y.$emit("close"),["self"]))},[e("div",wm,[e("div",$m,[km,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:C[0]||(C[0]=G=>y.$emit("close"))},Dm)]),e("div",Sm,[c.value?(s(),r("div",Fm,[Em,e("div",Tm,g(c.value),1)])):h("",!0),a.document.summary_object?(s(),r("div",Am,[Mm,e("div",jm,g(a.document.summary_object),1)])):h("",!0),D.value?(s(),r("div",Pm,[Lm,e("div",Bm,g(D.value),1)])):h("",!0),a.document.summary_term?(s(),r("div",Rm,[zm,e("div",Um,g(a.document.summary_term),1)])):h("",!0),v.value?(s(),r("div",Im,[Nm,e("div",Om,[a.document.summary_subscription_date?(s(),r("div",qm,[Vm,e("span",Qm,g(F(a.document.summary_subscription_date)),1)])):h("",!0),a.document.summary_start_date||a.document.summary_end_date?(s(),r("div",Wm,[Hm,e("span",Gm,[a.document.summary_start_date?(s(),r("span",Zm,g(F(a.document.summary_start_date)),1)):h("",!0),a.document.summary_start_date&&a.document.summary_end_date?(s(),r("span",Jm," → ")):h("",!0),a.document.summary_end_date?(s(),r("span",Km,g(F(a.document.summary_end_date)),1)):h("",!0)])])):h("",!0)])])):h("",!0),f.value?h("",!0):(s(),r("div",Ym," Este documento aún no tiene campos clasificados para mostrar. "))]),e("div",Xm,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-md text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200",onClick:C[1]||(C[1]=G=>y.$emit("close"))}," Cerrar ")])])])):h("",!0)}},tg={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},sg={class:"mb-4"},og={class:"relative w-full"},ag={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},rg={class:"flex items-center gap-2 min-w-0"},ng={class:"truncate"},lg={class:"p-2"},ig={class:"relative mb-2"},dg={class:"max-h-60 overflow-y-auto"},cg=["onClick"],ug={class:"truncate"},mg={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},gg={class:"flex items-center justify-stretch"},pg=e("span",null,"Limpiar",-1),hg={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},fg={class:"flex flex-col gap-1"},yg=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),vg={class:"flex flex-col gap-1"},bg=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),xg={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},_g={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},wg={class:"flex items-center gap-2"},$g=e("span",{class:"hidden sm:inline"},"Exportar",-1),kg={class:"py-1"},Cg=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),Dg={class:"py-1"},Sg={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Fg={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Eg={class:"min-w-full divide-y divide-gray-200"},Tg={class:"bg-gray-50"},Ag={scope:"col",class:"w-12 px-6 py-3"},Mg=["checked"],jg=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Pg=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado Firma ",-1),Lg=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Contraparte ",-1),Bg=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Objeto ",-1),Rg=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Valor ",-1),zg=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plazo ",-1),Ug=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fechas ",-1),Ig={key:0,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Ng={key:1,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Og=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),qg={class:"bg-white divide-y divide-gray-200"},Vg=["onClick"],Qg=["checked","onChange"],Wg={class:"px-6 py-4 whitespace-nowrap"},Hg={class:"flex items-center"},Gg={class:"flex-shrink-0 h-10 w-10"},Zg={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},Jg={class:"ml-4"},Kg={class:"text-sm font-medium text-gray-900"},Yg={class:"px-6 py-4 whitespace-nowrap"},Xg={class:"px-6 py-4 whitespace-nowrap"},e0={class:"text-sm text-gray-900"},t0={class:"px-6 py-4 whitespace-nowrap"},s0={class:"text-sm text-gray-900 line-clamp-2 max-w-xs"},o0={class:"px-6 py-4 whitespace-nowrap"},a0={class:"text-sm text-gray-900"},r0={class:"px-6 py-4 whitespace-nowrap"},n0={class:"text-sm text-gray-900"},l0={class:"px-6 py-4 whitespace-nowrap"},i0={class:"text-xs text-gray-900 space-y-0.5"},d0={key:0},c0=e("span",{class:"font-medium"},"Suscripción:",-1),u0={class:"ml-1"},m0={key:1},g0=e("span",{class:"font-medium"},"Vigencia:",-1),p0={class:"ml-1"},h0={key:0},f0={key:1},y0={key:2},v0={key:2,class:"text-gray-400"},b0={key:0,class:"px-6 py-4 whitespace-nowrap"},x0={key:0,class:"text-sm text-gray-900"},_0={key:1,class:"text-sm text-gray-400"},w0={key:1,class:"px-6 py-4 whitespace-nowrap"},$0=["disabled","onClick"],k0={key:0},C0={key:1},D0={class:"px-6 py-4 whitespace-nowrap"},S0={class:"flex flex-wrap gap-1"},F0={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},E0={key:1,class:"text-sm text-gray-400"},T0={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},A0={class:"flex flex-1 justify-between sm:hidden"},M0=["disabled"],j0=["disabled"],P0={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},L0={class:"text-sm text-gray-700"},B0={class:"font-medium"},R0={class:"font-medium"},z0={class:"font-medium"},U0={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},I0=["disabled"],N0=e("span",{class:"sr-only"},"Anterior",-1),O0=["onClick"],q0={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},V0=["disabled"],Q0=e("span",{class:"sr-only"},"Siguiente",-1),W0={key:0,class:"text-center py-12"},H0={class:"mt-2 text-sm font-medium text-gray-900"},G0={class:"mt-1 text-sm text-gray-500"},Z0={key:1,class:"text-center py-12"},J0=e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-secondary"},null,-1),K0=e("p",{class:"mt-2 text-sm text-gray-500"},"Cargando documentos...",-1),Y0=[J0,K0],X0={key:5,class:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40"},ep={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4"},tp={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},sp=e("h2",{class:"text-sm font-semibold text-gray-900"},"Rechazar documento",-1),op={class:"px-4 py-4 space-y-3 text-sm text-gray-700"},ap={class:"font-semibold"},rp=e("p",{class:"text-xs text-gray-500"}," El rechazo devolverá el documento al abogado creador para que pueda revisarlo, editarlo o archivarlo. ",-1),np=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Motivo del rechazo (opcional) ",-1),lp={key:6,class:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40"},ip={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4"},dp={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},cp=e("h2",{class:"text-sm font-semibold text-gray-900"},"Motivo del rechazo",-1),up={class:"px-4 py-4 text-sm text-gray-700 whitespace-pre-line"},mp={class:"px-4 py-3 border-t border-gray-100 flex justify-end bg-gray-50"},lt={__name:"SignaturesListTable",props:{state:{type:String,required:!0,validator:a=>["PendingSignatures","FullySigned","Archived"].includes(a)},searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","document-fully-signed","document-rejected","open-electronic-signature"],setup(a,{expose:w,emit:i}){const c=a,D=i,v=Ze(),f=qe(),F=et(),{activeModals:y,openModal:C,closeModal:G,getUserRole:te}=Tt(f,v),{handlePreviewDocument:ee,downloadPDFDocument:O,signDocument:ne,downloadSignedDocument:X}=At(f,v,D);b([]);const k=b(!1),d=b(""),T=b(""),R=b(null),U=b(""),$=b(""),E=b("recent"),I=b([]),Z=b(!1),de=b(null),Y=b(1),q=b(10),J=z(()=>c.state==="PendingSignatures"?"No tienes documentos pendientes por firmar":c.state==="FullySigned"?"No tienes documentos firmados":"No tienes documentos archivados"),P=z(()=>c.state==="PendingSignatures"?"Cuando tengas documentos que requieran tu firma electrónica aparecerán aquí.":c.state==="FullySigned"?"Una vez que firmes documentos electrónicamente, aparecerán aquí.":"Aquí aparecerán los documentos rechazados o expirados relacionados contigo."),B=z(()=>{const W=v.currentUser.role,S=v.currentUser.id,ae=v.currentUser.email;let _=[];return W==="lawyer"?c.state==="PendingSignatures"?_=f.pendingSignatureDocuments.filter(ue=>{var V;const m=ue.created_by===S,u=(V=ue.signatures)==null?void 0:V.some(p=>p.signer_email===ae);return m||u}):c.state==="FullySigned"?_=f.fullySignedDocuments.filter(ue=>{var V;const m=ue.created_by===S,u=(V=ue.signatures)==null?void 0:V.some(p=>p.signer_email===ae&&p.signed);return m||u}):c.state==="Archived"&&(_=f.documents.filter(ue=>{var V;if(ue.state!=="Rejected"&&ue.state!=="Expired")return!1;const m=ue.created_by===S,u=(V=ue.signatures)==null?void 0:V.some(p=>p.signer_email===ae);return m||u})):c.state==="PendingSignatures"?_=f.documents.filter(ue=>{var V;if(ue.state!=="PendingSignatures")return!1;const m=(V=ue.signatures)==null?void 0:V.some(p=>p.signer_email===ae),u=ue.created_by===S;return m||u}):c.state==="FullySigned"?_=f.documents.filter(ue=>{var V;if(ue.state!=="FullySigned")return!1;const m=(V=ue.signatures)==null?void 0:V.some(p=>p.signer_email===ae&&p.signed),u=ue.created_by===S;return m||u}):c.state==="Archived"&&(_=f.documents.filter(ue=>{var V;if(ue.state!=="Rejected"&&ue.state!=="Expired")return!1;const m=(V=ue.signatures)==null?void 0:V.some(p=>p.signer_email===ae),u=ue.created_by===S;return m||u})),_}),se=z(()=>{let W=[...B.value];const S=d.value.toLowerCase();return S&&(W=W.filter(ae=>{var _,ue;return((_=ae.title)==null?void 0:_.toLowerCase().includes(S))||((ue=ae.tags)==null?void 0:ue.some(m=>{var u;return(u=m.name)==null?void 0:u.toLowerCase().includes(S)}))})),R.value&&(W=W.filter(ae=>ae.tags&&ae.tags.some(_=>_.id===R.value))),(U.value||$.value)&&(W=W.filter(ae=>{const _=ae.summary_subscription_date||ae.created_at||ae.updated_at;if(!_)return!1;const ue=new Date(_);if(isNaN(ue.getTime()))return!1;if(U.value){const m=new Date(U.value);if(ue<m)return!1}if($.value){const m=new Date($.value);if(m.setHours(23,59,59,999),ue>m)return!1}return!0})),E.value==="name"?W.sort((ae,_)=>{const ue=(ae.title||"").toLowerCase(),m=(_.title||"").toLowerCase();return ue.localeCompare(m)}):E.value==="recent"&&W.sort((ae,_)=>{const ue=new Date(ae.updated_at||ae.created_at);return new Date(_.updated_at||_.created_at)-ue}),W}),ve=z(()=>{const W=(Y.value-1)*q.value,S=W+q.value;return se.value.slice(W,S)}),N=z(()=>Math.ceil(se.value.length/q.value)),H=z(()=>{const W=(Y.value-1)*q.value+1,S=Math.min(Y.value*q.value,se.value.length);return{start:W,end:S,total:se.value.length}});we([d,R,U,$],()=>{Y.value=1});const Q=z(()=>{const W=new Map;return B.value.forEach(S=>{S.tags&&S.tags.length>0&&S.tags.forEach(ae=>{W.has(ae.id)||W.set(ae.id,ae)})}),Array.from(W.values()).sort((S,ae)=>S.name.localeCompare(ae.name))}),K=z(()=>{if(!T.value)return Q.value;const W=T.value.toLowerCase();return Q.value.filter(S=>S.name.toLowerCase().includes(W))}),be=z(()=>{if(!R.value)return null;const W=Q.value.find(S=>S.id===R.value);return W?W.name:null}),_e=W=>{const S=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],ae=W.id%S.length;return S[ae]},xe=z(()=>{switch(E.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),Re=W=>{const S=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],ae=W.id%S.length;return S[ae]},ze=W=>c.state==="FullySigned"?"bg-green-100 text-green-700 border border-green-200":c.state==="Archived"?W.state==="Rejected"?"bg-red-100 text-red-700 border border-red-200":(W.state==="Expired","bg-gray-100 text-gray-700 border border-gray-200"):"bg-yellow-100 text-yellow-700 border border-yellow-200",Ue=W=>c.state==="FullySigned"?"Firmado":c.state==="Archived"?W.state==="Rejected"?"Rechazado":W.state==="Expired"?"Expirado":"Archivado":"Pendiente",oe=z(()=>se.value.length>0&&I.value.length===se.value.length),ie=()=>{oe.value?I.value=[]:I.value=se.value.map(W=>W.id)},ce=W=>{const S=I.value.indexOf(W);S>-1?I.value.splice(S,1):I.value.push(W)},Ce=()=>{I.value=se.value.map(W=>W.id)},Te=()=>{I.value=[]},je=()=>{R.value=null,U.value="",$.value=""},x=()=>{Y.value>1&&Y.value--},l=()=>{Y.value<N.value&&Y.value++},o=W=>{W>=1&&W<=N.value&&(Y.value=W)},M=W=>W?typeof W=="string"?W.split("T")[0]:W:"",me=z(()=>{const W=N.value,S=Y.value,ae=[];if(W<=7)for(let _=1;_<=W;_++)ae.push(_);else if(S<=4){for(let _=1;_<=5;_++)ae.push(_);ae.push("..."),ae.push(W)}else if(S>=W-3){ae.push(1),ae.push("...");for(let _=W-4;_<=W;_++)ae.push(_)}else ae.push(1),ae.push("..."),ae.push(S-1),ae.push(S),ae.push(S+1),ae.push("..."),ae.push(W);return ae}),L=()=>{const W=I.value.length>0?se.value.filter(V=>I.value.includes(V.id)):se.value,S=["Nombre Documento","Estado Firma","Etiquetas"],ae=W.map(V=>[V.title||"",Ue(V),V.tags?V.tags.map(p=>p.name).join(", "):""]),_=[S.join(","),...ae.map(V=>V.map(p=>`"${p}"`).join(","))].join(`
`),ue=new Blob([_],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),u=URL.createObjectURL(ue);m.setAttribute("href",u),m.setAttribute("download",`documentos_firmas_${new Date().toISOString().split("T")[0]}.csv`),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m)},De=b(!1),Se=b(null),Ie=b(!1),Je=b(null),Ye=b(""),rt=b(!1),nt=b(""),ct=W=>{Se.value=W,De.value=!0},Lt=async(W,S)=>{De.value=!1,await Bt(W,S)},Bt=async(W,S)=>{try{switch(W){case"preview":await ee(S);break;case"letterhead":C("letterhead",S);break;case"relationships":C("relationships",S);break;case"viewSignatures":C("signatures",S);break;case"sign":await ne(S,C);break;case"reject":Je.value=S,Ye.value="",Ie.value=!0;break;case"viewRejectionReason":{const ae=(S.signatures||[]).find(_=>_.rejection_comment);ae&&ae.rejection_comment?(nt.value=ae.rejection_comment,rt.value=!0):await $e("Este documento no tiene un motivo de rechazo registrado.","info");break}case"downloadSignedDocument":await X(S);break;case"downloadPDF":await O(S);break;case"editAndResend":{if(S&&S.id&&S.title){const ae=encodeURIComponent(S.title.trim()),_=`/dynamic_document_dashboard/document/use/correction/${S.id}/${ae}`;F.push(_)}else console.warn("Cannot navigate to correction mode: invalid document data",S);break}default:console.warn("Unknown action:",W)}}catch(ae){console.error(`Error executing action ${W}:`,ae)}},ut=()=>{Ie.value=!1,Je.value=null,Ye.value=""},Rt=async()=>{if(!Je.value)return;const W=Je.value,S=W.id,ae=v.currentUser.id;try{const _=`dynamic-documents/${S}/reject/${ae}/`,ue=Ye.value?{comment:Ye.value}:{},m=await ls(_,ue);m&&(m.status===200||m.status===201)?(ut(),D("document-rejected",W),Promise.all([$e("Documento rechazado correctamente.","success"),$s(ks.FINISH,`Rechazaste el documento "${W.title}"`).catch(u=>console.warn("No se pudo registrar la actividad de rechazo:",u)),f.init(!0)]).then(()=>{D("refresh")})):await $e("Error al rechazar el documento.","error")}catch(_){console.error("Error rejecting document:",_),await $e("Error al rechazar el documento.","error")}},vt=async()=>{k.value=!0;try{await f.init(!0)}catch(W){console.error("Error refreshing documents:",W),$e("Error al actualizar documentos","error")}finally{k.value=!1}},bt=async()=>{await vt(),D("refresh")};Qe(async()=>{await vt()}),w({refresh:bt});const xt=W=>{var ae;if(!W.summary_counterparty)return null;const S=(ae=W.variables)==null?void 0:ae.find(_=>_.summary_field==="counterparty");return(S==null?void 0:S.value)||W.summary_counterparty},zt=W=>{if(!W.summary_value)return null;const S=parseFloat(W.summary_value);return isNaN(S)?null:S};return we(()=>v.currentUser,()=>{bt()}),(W,S)=>{var ae;return s(),r("div",null,[e("div",tg,[e("div",sg,[e("div",og,[n(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":S[0]||(S[0]=_=>d.value=_),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Ee,d.value]])])]),e("div",ag,[n(t(Pe),{as:"div",class:"relative"},{default:A(()=>[n(t(Le),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[e("div",rg,[n(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",ng,g(be.value||"Etiqueta"),1)]),n(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),n(t(Be),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",lg,[e("div",ig,[n(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":S[1]||(S[1]=_=>T.value=_),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:S[2]||(S[2]=pe(()=>{},["stop"]))},null,512),[[Ee,T.value]])]),e("div",dg,[n(t(ye),null,{default:A(({active:_})=>[e("a",{onClick:S[3]||(S[3]=ue=>R.value=null),class:j([_?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),r(ge,null,he(K.value,_=>(s(),le(t(ye),{key:_.id},{default:A(({active:ue})=>[e("a",{onClick:m=>R.value=_.id,class:j([ue?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:j(["w-3 h-3 rounded-full flex-shrink-0",_e(_)])},null,2),e("span",ug,g(_.name),1)],10,cg)]),_:2},1024))),128)),K.value.length===0?(s(),r("div",mg," No se encontraron etiquetas ")):h("",!0)])])]),_:1})]),_:1}),e("div",gg,[R.value||U.value||$.value?(s(),r("button",{key:0,onClick:je,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[n(t(Ae),{class:"h-4 w-4 flex-shrink-0"}),pg])):h("",!0)])]),e("div",hg,[e("div",fg,[yg,ke(e("input",{"onUpdate:modelValue":S[4]||(S[4]=_=>U.value=_),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Ee,U.value]])]),e("div",vg,[bg,ke(e("input",{"onUpdate:modelValue":S[5]||(S[5]=_=>$.value=_),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Ee,$.value]])])]),e("div",xg,[e("div",_g,[e("div",wg,[e("button",{onClick:L,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[n(t(ot),{class:"h-4 w-4"}),$g]),n(t(Pe),{as:"div",class:"relative"},{default:A(()=>[n(t(Le),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:A(()=>[n(t(it),{class:"h-5 w-5 text-gray-500"})]),_:1}),n(t(Be),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",kg,[n(t(ye),null,{default:A(({active:_})=>[e("a",{onClick:Ce,class:j([_?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),n(t(ye),null,{default:A(({active:_})=>[e("a",{onClick:Te,class:j([_?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),n(t(Pe),{as:"div",class:"relative"},{default:A(()=>[n(t(Le),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[Cg,re(" "+g(xe.value)+" ",1),n(t(Oe),{class:"h-4 w-4"})]),_:1}),n(t(Be),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",Dg,[n(t(ye),null,{default:A(({active:_})=>[e("a",{onClick:S[6]||(S[6]=ue=>E.value="recent"),class:j([_?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),n(t(ye),null,{default:A(({active:_})=>[e("a",{onClick:S[7]||(S[7]=ue=>E.value="name"),class:j([_?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Sg,[e("div",Fg,[e("table",Eg,[e("thead",Tg,[e("tr",null,[e("th",Ag,[e("input",{type:"checkbox",checked:oe.value,onChange:ie,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Mg)]),jg,Pg,Lg,Bg,Rg,zg,Ug,c.state==="PendingSignatures"?(s(),r("th",Ig," Fecha Expiración ")):h("",!0),c.state==="PendingSignatures"||c.state==="FullySigned"?(s(),r("th",Ng," Docs. Asociados ")):h("",!0),Og])]),e("tbody",qg,[(s(!0),r(ge,null,he(ve.value,(_,ue)=>{var m;return s(),r("tr",{key:_.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:u=>ct(_)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:S[8]||(S[8]=pe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:I.value.includes(_.id),onChange:u=>ce(_.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Qg)]),e("td",Wg,[e("div",Hg,[e("div",Gg,[e("div",Zg,[n(t(Ne),{class:"h-5 w-5 text-purple-600"})])]),e("div",Jg,[e("div",Kg,g(_.title),1)])])]),e("td",Yg,[e("span",{class:j(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ze(_)])},g(Ue(_)),3)]),e("td",Xg,[e("span",e0,g(xt(_)||"-"),1)]),e("td",t0,[e("span",s0,g(_.summary_object||"-"),1)]),e("td",o0,[e("span",a0,g(zt(_)||"-"),1)]),e("td",r0,[e("span",n0,g(_.summary_term||"-"),1)]),e("td",l0,[e("div",i0,[_.summary_subscription_date?(s(),r("div",d0,[c0,e("span",u0,g(M(_.summary_subscription_date)),1)])):h("",!0),_.summary_start_date||_.summary_end_date?(s(),r("div",m0,[g0,e("span",p0,[_.summary_start_date?(s(),r("span",h0,g(M(_.summary_start_date)),1)):h("",!0),_.summary_start_date&&_.summary_end_date?(s(),r("span",f0," → ")):h("",!0),_.summary_end_date?(s(),r("span",y0,g(M(_.summary_end_date)),1)):h("",!0)])])):h("",!0),!_.summary_subscription_date&&!_.summary_start_date&&!_.summary_end_date?(s(),r("span",v0," - ")):h("",!0)])]),c.state==="PendingSignatures"?(s(),r("td",b0,[_.signature_due_date?(s(),r("span",x0,g(M(_.signature_due_date)),1)):(s(),r("span",_0," - "))])):h("",!0),c.state==="PendingSignatures"||c.state==="FullySigned"?(s(),r("td",w0,[e("button",{type:"button",disabled:!_.relationships_count||_.relationships_count===0,class:j(["inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border transition-colors",_.relationships_count&&_.relationships_count>0?"border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100 cursor-pointer":"border-gray-200 text-gray-400 bg-gray-50 cursor-not-allowed opacity-60"]),onClick:pe(u=>t(C)("relationships",_),["stop"])},[_.relationships_count&&_.relationships_count>0?(s(),r("span",k0," Ver asociaciones ("+g(_.relationships_count)+") ",1)):(s(),r("span",C0," Sin asociaciones "))],10,$0)])):h("",!0),e("td",D0,[e("div",S0,[(s(!0),r(ge,null,he((m=_.tags)==null?void 0:m.slice(0,2),u=>(s(),r("span",{key:u.id,class:j(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",Re(u)])},g(u.name),3))),128)),_.tags&&_.tags.length>2?(s(),r("span",F0," +"+g(_.tags.length-2),1)):h("",!0),!_.tags||_.tags.length===0?(s(),r("span",E0,"-")):h("",!0)])])],8,Vg)}),128))])])]),N.value>1?(s(),r("div",T0,[e("div",A0,[e("button",{onClick:x,disabled:Y.value===1,class:j(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",Y.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,M0),e("button",{onClick:l,disabled:Y.value===N.value,class:j(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",Y.value===N.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,j0)]),e("div",P0,[e("div",null,[e("p",L0,[re(" Mostrando "),e("span",B0,g(H.value.start),1),re(" a "),e("span",R0,g(H.value.end),1),re(" de "),e("span",z0,g(H.value.total),1),re(" resultados ")])]),e("div",null,[e("nav",U0,[e("button",{onClick:x,disabled:Y.value===1,class:j(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",Y.value===1?"opacity-50 cursor-not-allowed":""])},[N0,n(t(St),{class:"h-5 w-5","aria-hidden":"true"})],10,I0),(s(!0),r(ge,null,he(me.value,_=>(s(),r(ge,{key:_},[_!=="..."?(s(),r("button",{key:0,onClick:ue=>o(_),class:j(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",Y.value===_?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},g(_),11,O0)):(s(),r("span",q0," ... "))],64))),128)),e("button",{onClick:l,disabled:Y.value===N.value,class:j(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",Y.value===N.value?"opacity-50 cursor-not-allowed":""])},[Q0,n(t(ft),{class:"h-5 w-5","aria-hidden":"true"})],10,V0)])])])])):h("",!0)]),se.value.length===0&&!k.value?(s(),r("div",W0,[n(t(jt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",H0,g(J.value),1),e("p",G0,g(P.value),1)])):h("",!0),k.value?(s(),r("div",Z0,Y0)):h("",!0),n(Qt,{isVisible:t(tt),documentData:t(Vt),onClose:S[9]||(S[9]=_=>tt.value=!1)},null,8,["isVisible","documentData"]),(s(),le(qt,{to:"body"},[t(y).signatures.isOpen?(s(),le(t(is),{key:0,"document-id":(ae=t(y).signatures.document)==null?void 0:ae.id,onClose:S[10]||(S[10]=_=>t(G)("signatures")),onRefresh:S[11]||(S[11]=_=>D("refresh")),onOpenElectronicSignature:S[12]||(S[12]=_=>D("open-electronic-signature"))},null,8,["document-id"])):h("",!0),t(y).letterhead.isOpen?(s(),le(Mt,{key:1,"is-visible":t(y).letterhead.isOpen,document:t(y).letterhead.document,onClose:S[13]||(S[13]=_=>t(G)("letterhead")),onRefresh:S[14]||(S[14]=_=>D("refresh"))},null,8,["is-visible","document"])):h("",!0),De.value?(s(),le(Pt,{key:2,"is-visible":De.value,document:Se.value,"card-type":"signatures",context:"table","user-store":t(v),onClose:S[15]||(S[15]=_=>De.value=!1),onAction:Lt},null,8,["is-visible","document","user-store"])):h("",!0),t(y).relationships.isOpen?(s(),le(Ft,{key:3,"is-open":t(y).relationships.isOpen,document:t(y).relationships.document,readonly:c.state==="PendingSignatures"||c.state==="FullySigned",onClose:S[16]||(S[16]=_=>t(G)("relationships")),onRefresh:S[17]||(S[17]=_=>D("refresh"))},null,8,["is-open","document","readonly"])):h("",!0),Z.value?(s(),le(eg,{key:4,"is-visible":Z.value,document:de.value,onClose:S[18]||(S[18]=_=>Z.value=!1)},null,8,["is-visible","document"])):h("",!0),Ie.value&&Je.value?(s(),r("div",X0,[e("div",ep,[e("div",tp,[sp,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:ut},[n(t(Ae),{class:"h-5 w-5"})])]),e("div",op,[e("p",null,[re(" Estás a punto de rechazar el documento "),e("span",ap,'"'+g(Je.value.title)+'"',1),re(". ")]),rp,e("div",null,[np,ke(e("textarea",{"onUpdate:modelValue":S[19]||(S[19]=_=>Ye.value=_),rows:"4",class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-secondary focus:border-transparent resize-none",placeholder:"Describe brevemente por qué no estás de acuerdo con el documento..."},null,512),[[Ee,Ye.value]])])]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end gap-2 bg-gray-50"},[e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100",onClick:ut}," Cancelar "),e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700",onClick:Rt}," Rechazar documento ")])])])):h("",!0),rt.value?(s(),r("div",lp,[e("div",ip,[e("div",dp,[cp,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:S[20]||(S[20]=_=>rt.value=!1)},[n(t(Ae),{class:"h-5 w-5"})])]),e("div",up,g(nt.value||"No se encontró un motivo de rechazo para este documento."),1),e("div",mp,[e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100",onClick:S[21]||(S[21]=_=>rt.value=!1)}," Cerrar ")])])])):h("",!0)]))])}}},gp={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},pp={class:"flex justify-end"},hp=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[re(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),fp={class:"mt-2"},yp={class:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t border-gray-200"},vp=["disabled"],bp=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),xp=e("span",null,"Actualizar nombre",-1),_p=[bp,xp],wp=["disabled"],$p=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1),kp={__name:"CreateDocumentByLawyer",emits:["close"],setup(a,{emit:w}){const i=et(),c=qe(),D=w,v=b(""),f=b("");rs(()=>{var O;(O=c.selectedDocument)!=null&&O.title?(v.value=c.selectedDocument.title,f.value=c.selectedDocument.title):(v.value="",f.value="")});const F=O=>{O.key==="Escape"&&D("close")};Qe(()=>{document.addEventListener("keydown",F)}),pt(()=>{document.removeEventListener("keydown",F)});const y=z(()=>v.value.trim().length>0),C=z(()=>{var O;return!!((O=c.selectedDocument)!=null&&O.id)}),G=z(()=>C.value&&v.value.trim()!==f.value.trim()&&v.value.trim().length>0);async function te(){if(C.value&&G.value)try{const O={title:v.value.trim()};await c.updateDocument(c.selectedDocument.id,O),f.value=v.value.trim(),c.selectedDocument.title=v.value.trim(),c.lastUpdatedDocumentId=c.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",c.selectedDocument.id);const ne=c.selectedDocument.id;D("close",{updatedDocId:ne});const X=window.location.pathname;X==="/dynamic_document_dashboard"||X==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(ne)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(O){console.error("Error updating document name:",O)}}const ee=async()=>{if(!y.value)return;const O=encodeURIComponent(v.value.trim());C.value?(c.selectedDocument.title=v.value,c.selectedDocument.id&&(c.lastUpdatedDocumentId=c.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",c.selectedDocument.id.toString())),i.push(`/dynamic_document_dashboard/lawyer/editor/edit/${c.selectedDocument.id}`)):(c.selectedDocument={title:v.value.trim()},i.push(`/dynamic_document_dashboard/lawyer/editor/create/${O}`))};return(O,ne)=>(s(),r("div",gp,[e("div",pp,[e("button",{onClick:ne[0]||(ne[0]=X=>D("close"))},[n(t(Ae),{class:"size-6"})])]),e("form",{onSubmit:pe(ee,["prevent"])},[e("div",null,[hp,e("div",fp,[ke(e("input",{"onUpdate:modelValue":ne[1]||(ne[1]=X=>v.value=X),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[Ee,v.value]])])]),e("div",yp,[C.value?(s(),r("button",{key:0,type:"button",onClick:te,disabled:!G.value,class:j(["inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm transition-all duration-200",G.value?"bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500":"bg-gray-100 text-gray-400 border-2 border-dashed border-gray-300 cursor-not-allowed"])},_p,10,vp)):h("",!0),e("button",{type:"submit",class:j(["inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm transition-all duration-200",y.value?"bg-green-600 text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500":"bg-gray-100 text-gray-400 border-2 border-dashed border-gray-300 cursor-not-allowed"]),disabled:!y.value},[$p,e("span",null,g(C.value?"Editar Documento":"Continuar"),1)],10,wp)])],32)]))}},Me=a=>(Ct("data-v-857c746d"),a=a(),Dt(),a),Cp={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Dp={class:"px-6 py-4 border-b border-gray-200"},Sp=Me(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gestión de Membrete Global para PDF",-1)),Fp=Me(()=>e("p",{class:"text-sm text-gray-500 mt-1"}," La imagen de membrete se usará por defecto solo al generar documentos en PDF. Para documentos Word, se utiliza la plantilla .docx configurada más abajo. ",-1)),Ep={class:"p-6 overflow-y-auto flex-grow"},Tp={key:0,class:"text-center py-10"},Ap=Me(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),Mp={class:"mt-4 text-gray-500"},jp={key:1,class:"space-y-6"},Pp={key:0,class:"space-y-4"},Lp=Me(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete de imagen para PDF actual",-1)),Bp={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Rp=["src"],zp={class:"mt-4 flex justify-center space-x-3"},Up=["disabled"],Ip={key:1,class:"text-center py-8"},Np=Me(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete para PDF",-1)),Op=Me(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," No tienes una imagen de membrete global configurada para los documentos PDF. ",-1)),qp=Me(()=>e("p",{class:"mt-1 text-xs text-gray-400"}," Este membrete de imagen se aplicará solo a los PDF que no tengan un membrete específico. ",-1)),Vp={class:"space-y-4"},Qp={class:"text-lg font-medium text-gray-900"},Wp={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},Hp={key:0},Gp={class:"mt-4"},Zp=Me(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, máximo 10MB. Se usa únicamente para los PDF. ",-1)),Jp=Me(()=>e("p",{class:"text-xs text-gray-400 mt-1"},' Dimensiones ideales: 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI) ',-1)),Kp={key:1,class:"space-y-4"},Yp={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Xp={class:"text-gray-400"},eh={key:0,class:"mt-4"},th=["src"],sh={class:"flex justify-center space-x-3"},oh=["disabled"],ah={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},rh={class:"space-y-4 border-t border-gray-200 pt-6"},nh=Me(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Plantilla Word para documentos (.docx)",-1)),lh=Me(()=>e("p",{class:"text-sm text-gray-500"}," Esta plantilla se usará al descargar documentos en Word. Debe ser un archivo .docx con tu membrete configurado (header, footer o watermark). El contenido del documento se añadirá sobre esa plantilla. ",-1)),ih={key:0,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},dh={class:"text-sm text-gray-700"},ch=Me(()=>e("div",{class:"font-medium"},"Plantilla actual:",-1)),uh={class:"mt-1 break-words"},mh={class:"font-mono break-all"},gh={key:0,class:"text-gray-400 ml-2"},ph={class:"mt-3 flex flex-wrap gap-3"},hh=["disabled"],fh={key:1,class:"text-sm text-gray-500"},yh={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},vh={key:0},bh={class:"mt-4"},xh=Me(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos .docx, máximo 10MB. ",-1)),_h={key:1,class:"space-y-4"},wh={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},$h={class:"text-gray-400"},kh={class:"flex justify-center space-x-3"},Ch=["disabled"],Dh={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Sh={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},Fh={class:"flex items-center space-x-2"},Eh=Me(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete para PDF",-1)),Th=Me(()=>e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-yellow-800 mb-2"},"🔄 Prioridad de Membrete"),e("div",{class:"text-sm text-yellow-700 space-y-1"},[e("div",null,[e("strong",null,"1º Prioridad:"),re(" Membrete específico del documento")]),e("div",null,[e("strong",null,"2º Prioridad:"),re(" Membrete global de imagen para PDF del usuario (este)")]),e("div",null,[e("strong",null,"3º Prioridad:"),re(" Sin membrete")])])],-1)),Ah=Me(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"📐 Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"2550 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"3300 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporción:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta, 300 DPI)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"±10%")])])])],-1)),Mh=Me(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🎨 Distribución Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"⚠️ ZONA CRÍTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mantén semi-transparente. El texto del documento se superpone aquí.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, teléfonos, emails, información de contacto.")])])])])])],-1)),jh=Me(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🔧 Consideraciones Técnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Posicionamiento:"),re(" La imagen se centra automáticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Transparencia:"),re(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Márgenes:"),re(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Resolución:"),re(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"⚠️"),e("span",null,[e("strong",null,"Zona crítica:"),re(" Evita elementos gráficos densos en el centro (300-400px de altura)")])])])])],-1)),Ph=Me(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"💡 Tips de Diseño Rápido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"• Si solo tienes header, ubícalo en los primeros 120-150px"),e("div",null,"• El resto de la imagen debe ser transparente o blanco"),e("div",null,"• Para footer, usa los últimos 80-120px"),e("div",null,"• El texto se superpone en toda la imagen, mantén el centro claro")])],-1)),Lh={key:3,class:"space-y-2"},Bh={class:"flex"},Rh={class:"text-sm text-yellow-700"},zh={__name:"GlobalLetterheadModal",props:{isVisible:{type:Boolean,default:!1}},emits:["close","uploaded","deleted"],setup(a,{emit:w}){const i=a,c=w;we(()=>i.isVisible,oe=>{});const D=qe(),v=b(!1),f=b(""),F=b(!1),y=b(!1),C=b(null),G=b(null),te=b(null),ee=b([]),O=b(null),ne=b(!1),X=b(!1),k=b(null),d=b(!1),T=b(null),R=b(""),U=b(null),$=b(!1),E=b(!1),I=b(null),Z=()=>{q(),c("close")},de=oe=>{const ie=oe.target.files[0];if(!ie)return;if(!ie.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(ie.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}C.value=ie,ee.value=[];const ce=new FileReader;ce.onload=Ce=>{G.value=Ce.target.result;const Te=new Image;Te.onload=()=>{Y(Te.width,Te.height)},Te.src=Ce.target.result},ce.readAsDataURL(ie)},Y=(oe,ie)=>{const je=oe/ie,x=2550/3300,l=Math.abs(je-x)/x;if(oe===2550&&ie===3300){ee.value.push("✅ Dimensiones perfectas: 2550 × 3300 píxeles");return}l<=.1?(ee.value.push(`ℹ️ Buenas proporciones detectadas: ${oe} × ${ie} píxeles (${je.toFixed(3)})`),(oe!==2550||ie!==3300)&&ee.value.push('💡 Para mejores resultados, usa exactamente 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI)')):(ee.value.push(`⚠️ Proporciones no ideales: ${oe} × ${ie} píxeles (${je.toFixed(3)})`),ee.value.push(`🎯 Proporciones recomendadas: ${x.toFixed(3)} (8.5:11, tamaño carta)`),ee.value.push("📐 Considera redimensionar tu imagen a 2550 × 3300 píxeles (tamaño carta)")),(oe<1200||ie<1600)&&ee.value.push("⚠️ Imagen muy pequeña - puede verse pixelada en documentos PDF tamaño carta"),(oe>4e3||ie>5e3)&&ee.value.push("ℹ️ Imagen muy grande - se redimensionará automáticamente para ajustarse al tamaño carta")},q=()=>{C.value=null,G.value=null,ee.value=[],ne.value=!1,O.value&&(O.value.value="")},J=async()=>{var oe;if(C.value){F.value=!0,ee.value=[];try{const ie=await D.uploadGlobalLetterheadImage(C.value);(oe=ie.data)!=null&&oe.warnings&&ie.data.warnings.length>0&&(ee.value=ie.data.warnings),X.value=!1,await P(),q(),c("uploaded",ie.data)}catch(ie){console.error("Error uploading global letterhead:",ie),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{F.value=!1}}},P=async()=>{if(!(te.value===null&&X.value)){X.value=!0;try{const oe=await D.getGlobalLetterheadImage();oe.data&&(te.value=URL.createObjectURL(oe.data))}catch{te.value=null}}},B=async()=>{await Kt("¿Estás seguro de que deseas eliminar la imagen de membrete global?")&&se()},se=async()=>{y.value=!0;try{await D.deleteGlobalLetterheadImage(),te.value&&URL.revokeObjectURL(te.value),te.value=null,X.value=!0,c("deleted")}catch(oe){console.error("Error deleting global letterhead:",oe),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{y.value=!1}},ve=oe=>{const ie=oe.target.files[0];if(ie){if(!ie.name.toLowerCase().endsWith(".docx")){alert("Solo se permiten archivos .docx para la plantilla Word");return}if(ie.size>10*1024*1024){alert("El archivo de plantilla no puede ser mayor a 10MB");return}k.value=ie}},N=()=>{k.value=null,I.value&&(I.value.value="")},H=async()=>{var oe;if(k.value){$.value=!0;try{const ce=(oe=(await D.uploadGlobalLetterheadWordTemplate(k.value)).data)==null?void 0:oe.template_info;d.value=!0,R.value=(ce==null?void 0:ce.filename)||k.value.name,U.value=(ce==null?void 0:ce.size_bytes)||k.value.size,await Q(),N()}catch(ie){console.error("Error uploading global Word template:",ie),alert("Error al subir la plantilla Word. Por favor intenta nuevamente.")}finally{$.value=!1}}},Q=async()=>{var oe,ie;try{const ce=await D.getGlobalLetterheadWordTemplate("blob");if(!ce){d.value=!1,T.value&&URL.revokeObjectURL(T.value),T.value=null,R.value="",U.value=null;return}if(ce&&ce.data){d.value=!0,T.value&&URL.revokeObjectURL(T.value),T.value=URL.createObjectURL(ce.data);const Ce=((oe=ce.headers)==null?void 0:oe["content-disposition"])||((ie=ce.headers)==null?void 0:ie["Content-Disposition"]);let Te="plantilla_word.docx";if(Ce){const je=Ce.match(/filename="?([^";]+)"?/i);je&&je[1]&&(Te=je[1])}R.value=Te,U.value=ce.data.size||null}}catch(ce){console.error("Error loading global Word template:",ce)}},K=async()=>{await Kt("¿Estás seguro de que deseas eliminar la plantilla Word de membrete global?")&&be()},be=async()=>{E.value=!0;try{await D.deleteGlobalLetterheadWordTemplate(),T.value&&URL.revokeObjectURL(T.value),T.value=null,R.value="",U.value=null,d.value=!1}catch(oe){console.error("Error deleting global Word template:",oe),alert("Error al eliminar la plantilla Word. Por favor intenta nuevamente.")}finally{E.value=!1}},_e=()=>{if(T.value){const oe=document.createElement("a");oe.href=T.value,oe.download=R.value||"membrete-word.docx",document.body.appendChild(oe),oe.click(),document.body.removeChild(oe)}},xe=()=>{if(te.value){const oe=document.createElement("a");oe.href=te.value,oe.download="membrete-global.png",document.body.appendChild(oe),oe.click(),document.body.removeChild(oe)}},Re=()=>{te.value=null},ze=oe=>{if(oe===0)return"0 Bytes";const ie=1024,ce=["Bytes","KB","MB","GB"],Ce=Math.floor(Math.log(oe)/Math.log(ie));return parseFloat((oe/Math.pow(ie,Ce)).toFixed(2))+" "+ce[Ce]};we(()=>i.isVisible,oe=>{oe&&(P(),Q())});const Ue=()=>{te.value&&URL.revokeObjectURL(te.value),G.value&&URL.revokeObjectURL(G.value),T.value&&URL.revokeObjectURL(T.value)};return Qe(()=>{i.isVisible&&P()}),pt(Ue),(oe,ie)=>ke((s(),le(Ge,null,{default:A(()=>[e("div",Cp,[e("div",Dp,[Sp,Fp,e("button",{onClick:Z,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[n(t(Ae),{class:"h-6 w-6"})])]),e("div",Ep,[v.value?(s(),r("div",Tp,[Ap,e("p",Mp,g(f.value),1)])):(s(),r("div",jp,[te.value?(s(),r("div",Pp,[Lp,e("div",Bp,[e("img",{src:te.value,alt:"Membrete de imagen para PDF actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:Re},null,40,Rp),e("div",zp,[e("button",{onClick:xe,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[n(t(ot),{class:"h-4 w-4 mr-2"}),re(" Descargar ")]),e("button",{onClick:B,disabled:y.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[n(t(Ot),{class:"h-4 w-4 mr-2"}),re(" "+g(y.value?"Eliminando...":"Eliminar"),1)],8,Up)])])])):(s(),r("div",Ip,[n(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),Np,Op,qp])),e("div",Vp,[e("h3",Qp,g(te.value?"Reemplazar Membrete de imagen para PDF":"Subir Membrete de imagen para PDF"),1),e("div",Wp,[e("input",{ref_key:"fileInput",ref:O,type:"file",accept:".png",onChange:de,class:"hidden"},null,544),C.value?(s(),r("div",Kp,[e("div",Yp,[n(t(kt),{class:"h-5 w-5 text-green-500"}),e("span",null,g(C.value.name),1),e("span",Xp,"("+g(ze(C.value.size))+")",1)]),G.value?(s(),r("div",eh,[e("img",{src:G.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,th)])):h("",!0),e("div",sh,[e("button",{onClick:q,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:J,disabled:F.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[F.value?(s(),r("div",ah)):(s(),le(t(ts),{key:0,class:"h-4 w-4 mr-2"})),re(" "+g(F.value?"Subiendo...":"Subir Imagen para PDF"),1)],8,oh)])])):(s(),r("div",Hp,[n(t(us),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Gp,[e("button",{onClick:ie[0]||(ie[0]=ce=>oe.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG para PDF "),e("button",{onClick:ie[1]||(ie[1]=ce=>ne.value=!ne.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[n(t(es),{class:"h-4 w-4 mr-2"}),re(" "+g(ne.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),Zp,Jp]))])]),e("div",rh,[nh,lh,d.value?(s(),r("div",ih,[e("div",dh,[ch,e("div",uh,[e("span",mh,g(R.value||"plantilla_word.docx"),1),U.value?(s(),r("span",gh,"("+g(ze(U.value))+")",1)):h("",!0)])]),e("div",ph,[T.value?(s(),r("button",{key:0,onClick:_e,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[n(t(ot),{class:"h-4 w-4 mr-2"}),re(" Descargar ")])):h("",!0),e("button",{onClick:K,disabled:E.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[n(t(Ot),{class:"h-4 w-4 mr-2"}),re(" "+g(E.value?"Eliminando...":"Eliminar"),1)],8,hh)])])):(s(),r("div",fh," No tienes una plantilla Word configurada. Puedes subir un archivo .docx con tu membrete. ")),e("div",yh,[e("input",{ref_key:"wordTemplateInput",ref:I,type:"file",accept:".docx",onChange:ve,class:"hidden"},null,544),k.value?(s(),r("div",_h,[e("div",wh,[n(t(kt),{class:"h-5 w-5 text-green-500"}),e("span",null,g(k.value.name),1),e("span",$h,"("+g(ze(k.value.size))+")",1)]),e("div",kh,[e("button",{onClick:N,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:H,disabled:$.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[$.value?(s(),r("div",Dh)):(s(),le(t(ts),{key:0,class:"h-4 w-4 mr-2"})),re(" "+g($.value?"Subiendo...":"Subir Plantilla"),1)],8,Ch)])])):(s(),r("div",vh,[n(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",bh,[e("button",{onClick:ie[2]||(ie[2]=ce=>oe.$refs.wordTemplateInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Plantilla .docx (Word) ")]),xh]))])]),ne.value?(s(),r("div",Sh,[e("div",Fh,[n(t(es),{class:"h-6 w-6 text-blue-600"}),Eh]),Th,Ah,Mh,jh,Ph])):h("",!0),ee.value.length>0?(s(),r("div",Lh,[(s(!0),r(ge,null,he(ee.value,(ce,Ce)=>(s(),r("div",{key:Ce,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",Bh,[n(t(Bs),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",Rh,g(ce),1)])]))),128))])):h("",!0)]))])])]),_:1},512)),[[ht,a.isVisible]])}},Uh=Et(zh,[["__scopeId","data-v-857c746d"]]),Ih={class:"min-h-screen bg-gray-50"},Nh={class:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8"},Oh={class:"p-4 sm:p-6 lg:p-8"},qh={key:0},Vh={key:0},Qh={key:1},Wh={class:"mb-6 border-b border-gray-200 pb-4"},Hh={class:"hidden md:block"},Gh={class:"flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8 mb-4","aria-label":"Tabs"},Zh=["onClick"],Jh={class:"flex gap-3"},Kh=["disabled"],Yh=e("span",null,"Firma Electrónica",-1),Xh=e("span",null,"Membrete Global",-1),ef=e("span",null,"Nueva Minuta",-1),tf=e("span",null,"Nuevo Documento",-1),sf={class:"md:hidden space-y-3 relative"},of=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),af=[of],rf={key:0,class:"absolute z-20 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden w-full"},nf=["onClick"],lf=["disabled"],df=e("span",{class:"font-medium text-xs leading-tight"},"Firma",-1),cf=e("span",{class:"font-medium text-xs leading-tight"},"Membrete",-1),uf=e("span",{class:"font-medium text-xs leading-tight"},"Nueva Minuta",-1),mf=e("span",{class:"font-medium text-xs leading-tight"},"Nuevo Doc.",-1),gf={key:0},pf={key:1},hf={key:2},ff={key:3},yf={key:4},vf={key:5},bf={key:6},xf={key:7},_f={key:8,class:"mt-6 text-center text-gray-400 font-regular"},wf=e("p",null,"No hay documentos disponibles para mostrar.",-1),$f=[wf],kf={key:1},Cf={class:"mb-6 border-b border-gray-200"},Df={class:"hidden md:flex md:flex-col"},Sf={class:"-mb-px flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},Ff=["onClick"],Ef={class:"flex flex-wrap items-center gap-2 mt-3 mb-4 md:justify-end"},Tf={class:"relative"},Af={class:"relative group"},Mf=["disabled"],jf={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},Pf=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),Lf={class:"md:hidden relative"},Bf=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),Rf=[Bf],zf={key:0,class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},Uf=["onClick"],If={class:"md:hidden mt-4 mb-4 flex flex-col gap-2"},Nf={class:"relative"},Of={class:"relative group"},qf=["disabled"],Vf={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},Qf=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),Wf={key:0},Hf={key:1},Gf={class:"p-4 sm:p-6"},Zf={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},Jf={class:"flex justify-between items-center p-4 border-b"},Kf=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),Yf={class:"p-4 sm:p-6"},Xf={class:"p-4 sm:p-6"},ey={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},ty={class:"flex justify-between items-center p-4 border-b"},sy=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),oy={class:"p-4 sm:p-6"},jy={__name:"Dashboard",setup(a){const w=Ze(),i=qe(),c=Gt(),D=et(),v=Cs(),{isBasicUser:f,handleFeatureAccess:F}=ps(),y=b(""),C=b("default"),G=b(!1);we(C,(l,o)=>{});const te=b(!1),ee=b("folders"),O=b("legal-documents"),ne=b(!1),X=b(!1),k=b(!1),d=b(!1),T=b(!1),R=b(null),U=b([]),$=b("recent");we(O,(l,o)=>{},{immediate:!0}),z(()=>[]),z(()=>$.value==="recent"?"Más recientes":"Nombre (A-Z)");const E=z(()=>w.currentUser),I=z(()=>E.value?E.value.role:(D.push("/login"),null)),Z=z(()=>{let l=[];I.value==="lawyer"?l=i.draftAndPublishedDocumentsUnassigned:(I.value==="client"||I.value==="basic"||I.value==="corporate_client")&&(l=i.progressAndCompletedDocumentsByClient(E.value.id));const o=U.value&&Array.isArray(U.value)?U.value.map(M=>M.id):[];return i.filteredDocumentsBySearchAndTags(y.value,w,o).filter(M=>l.some(me=>me.id===M.id))}),de=async l=>{C.value=l,G.value=!0,i.selectedDocument=null;try{await i.init(!0)}catch(o){console.error("Error loading documents for useDocument section:",o)}finally{G.value=!1}},Y=()=>{te.value=!1,C.value!=="useDocument"&&(C.value="default"),i.selectedDocument=null},q=async()=>{await i.init(!0)},J=()=>{if(!E.value){console.error("Cannot open signature modal: currentUser is not loaded");return}X.value=!0},P=()=>{if(!E.value){console.error("Cannot open signature modal: currentUser is not loaded");return}ne.value=!0},B=()=>{if(!E.value){console.error("Cannot open signature modal: currentUser is not loaded");return}ne.value=!0},se=async l=>{O.value="signed-documents"},ve=async l=>{ee.value="signed-documents"},N=async l=>{try{l&&l.id?await i.fetchDocumentById(l.id,!0):await i.init(!0)}catch(o){console.error("Error refreshing rejected document for lawyer:",o)}O.value="archived-documents"},H=async l=>{try{l&&l.id?await i.fetchDocumentById(l.id,!0):await i.init(!0)}catch(o){console.error("Error refreshing rejected document for client:",o)}ee.value="archived-documents"},Q=()=>{i.selectedDocument=null,te.value=!0},K=()=>{de("useDocument")},be=l=>{const{tab:o,searchQuery:M}=l;O.value=o,y.value=M,setTimeout(()=>{},100)},_e=()=>{if(!E.value){console.error("Cannot open letterhead modal: currentUser is not loaded");return}F("Membrete Global",()=>{k.value=!0})},xe=l=>{$e("Membrete global subido correctamente","success")},Re=()=>{$e("Membrete global eliminado correctamente","success")},ze=async()=>{if(!G.value){if(C.value==="useDocument"){C.value="default",I.value==="lawyer"?O.value="my-documents":ee.value="my-documents";return}I.value==="lawyer"?O.value="folders":ee.value="folders";try{await new Promise(l=>setTimeout(l,100)),await c.fetchFolders(!0)}catch{}}};we(()=>i.lastUpdatedDocumentId,(l,o)=>{if(l&&l!==o&&C.value==="default"){const M=Date.now();(!we.lastExecutionTime||M-we.lastExecutionTime>100)&&(we.lastExecutionTime=M,C.value)}},{immediate:!1}),we(d,l=>{}),we(T,l=>{}),we(R,l=>{}),we(()=>v.path,(l,o)=>{l==="/dynamic_document_dashboard"&&o&&o.includes("/document/use/")&&i.init()}),we(()=>v.query,l=>{l.lawyerTab&&(O.value=l.lawyerTab),l.tab&&(ee.value=l.tab)},{immediate:!0});const Ue=[{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"archived-documents",label:"Dcs. Archivados"}],oe=[{name:"legal-documents",label:"Minutas"},{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"archived-documents",label:"Dcs. Archivados"},{name:"finished-documents",label:"Dcs. Clientes"},{name:"in-progress-documents",label:"Dcs. Clientes en Progreso"}],ie=b(!1),ce=b(!1),Ce=()=>{ie.value=!1,ce.value=!1},Te=l=>{y.value="",O.value=l,ie.value=!1,Ce()},je=l=>{y.value="",ee.value=l,ce.value=!1,Ce()};Qe(async()=>{try{await Promise.all([w.init(),i.init(),c.init()])}catch(o){console.error("Error initializing dynamic document dashboard:",o)}i.selectedDocument=null,C.value!=="useDocument"&&(C.value="default");const l=localStorage.getItem("lastUpdatedDocumentId");l&&i.documents.some(M=>M.id.toString()===l)&&(i.lastUpdatedDocumentId=parseInt(l))});const x=async l=>{w.currentUser&&(w.currentUser.has_signature=!0),$e("Firma electrónica guardada correctamente","success"),setTimeout(()=>{X.value=!1,ne.value=!1},500)};return(l,o)=>{var M,me;return s(),r(ge,null,[e("div",Ih,[e("div",Nh,[ns(l.$slots,"default")]),e("div",Oh,[I.value==="lawyer"?(s(),r("div",qh,[C.value==="useDocument"?(s(),r("div",Vh,[n(as,{searchQuery:y.value,selectedTags:U.value,onGoBack:ze},null,8,["searchQuery","selectedTags"])])):(s(),r("div",Qh,[e("div",Wh,[e("div",Hh,[e("nav",Gh,[(s(),r(ge,null,he(oe,L=>e("button",{key:L.name,onClick:pe(De=>Te(L.name),["stop"]),class:j([O.value===L.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},g(L.label),11,Zh)),64))]),e("div",Jh,[e("button",{onClick:pe(J,["stop"]),disabled:!E.value,class:j(["inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-purple-200 text-sm font-medium transition-all duration-200",E.value?"bg-white text-gray-700 hover:bg-purple-50 hover:border-purple-300":"bg-gray-50 text-gray-400 cursor-not-allowed opacity-60"])},[n(t(_t),{class:"size-5 text-purple-500"}),Yh],10,Kh),e("button",{onClick:o[0]||(o[0]=pe(L=>k.value=!0,["stop"])),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-green-200 bg-white text-sm font-medium text-gray-700 hover:bg-green-50 hover:border-green-300 transition-all duration-200"},[n(t(Ne),{class:"size-5 text-green-500"}),Xh]),O.value==="legal-documents"?(s(),r("button",{key:0,onClick:pe(Q,["stop"]),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-secondary bg-secondary text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200"},[n(t(We),{class:"size-5"}),ef])):h("",!0),O.value==="my-documents"?(s(),r("button",{key:1,onClick:pe(K,["stop"]),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-secondary bg-secondary text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200"},[n(t(We),{class:"size-5"}),tf])):h("",!0)])]),e("div",sf,[e("button",{onClick:o[1]||(o[1]=pe(L=>ie.value=!ie.value,["stop"])),class:"dropdown-button w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,g(((M=oe.find(L=>L.name===O.value))==null?void 0:M.label)||"Seleccionar sección"),1),(s(),r("svg",{class:j(["ml-2 h-5 w-5 transition-transform duration-200",ie.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},af,2))]),ie.value?(s(),r("div",rf,[(s(),r(ge,null,he(oe,L=>e("button",{key:L.name,onClick:pe(De=>Te(L.name),["stop"]),class:j(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",O.value===L.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},g(L.label),11,nf)),64))])):h("",!0),e("div",{class:j(["grid gap-2",O.value==="legal-documents"||O.value==="my-documents"?"grid-cols-3":"grid-cols-2"])},[e("button",{onClick:pe(J,["stop"]),disabled:!E.value,class:j(["flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-purple-200 text-center transition-all duration-200",E.value?"bg-white hover:bg-purple-50":"bg-gray-50 cursor-not-allowed opacity-60"])},[n(t(_t),{class:"size-6 text-purple-500 mb-1"}),df],10,lf),e("button",{onClick:o[2]||(o[2]=pe(L=>k.value=!0,["stop"])),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-green-200 bg-white text-center transition-all duration-200 hover:bg-green-50"},[n(t(Ne),{class:"size-6 text-green-500 mb-1"}),cf]),O.value==="legal-documents"?(s(),r("button",{key:0,onClick:pe(Q,["stop"]),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-secondary bg-secondary text-white text-center transition-all duration-200 hover:bg-blue-700"},[n(t(We),{class:"size-6 mb-1"}),uf])):h("",!0),O.value==="my-documents"?(s(),r("button",{key:1,onClick:pe(K,["stop"]),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-secondary bg-secondary text-white text-center transition-all duration-200 hover:bg-blue-700"},[n(t(We),{class:"size-6 mb-1"}),mf])):h("",!0)],2)])]),O.value==="legal-documents"?(s(),r("div",gf,[n(It,{searchQuery:y.value,"onUpdate:searchQuery":o[3]||(o[3]=L=>y.value=L),selectedTags:U.value,"is-loading":t(i).isLoading,"card-type":"lawyer","show-state-filter":!0,"show-client-filter":!0,"show-associations-column":!0,context:"legal-documents",onRefresh:q},null,8,["searchQuery","selectedTags","is-loading"])])):h("",!0),O.value==="my-documents"?(s(),r("div",pf,[n(It,{searchQuery:y.value,"onUpdate:searchQuery":o[4]||(o[4]=L=>y.value=L),selectedTags:U.value,"is-loading":t(i).isLoading,"card-type":"client","show-state-filter":!0,"show-client-filter":!1,"show-associations-column":!0,context:"my-documents",onRefresh:q},null,8,["searchQuery","selectedTags","is-loading"])])):h("",!0),O.value==="folders"?(s(),r("div",hf,[n(os,{searchQuery:y.value,selectedTags:U.value,onRefresh:q,onNavigateToMain:ze,onNavigateToDocument:be},null,8,["searchQuery","selectedTags"])])):h("",!0),O.value==="pending-signatures"?(s(),r("div",ff,[n(lt,{state:"PendingSignatures",searchQuery:y.value,selectedTags:U.value,onRefresh:q,onOpenElectronicSignature:J,onDocumentFullySigned:se,onDocumentRejected:N},null,8,["searchQuery","selectedTags"])])):h("",!0),O.value==="signed-documents"?(s(),r("div",yf,[n(lt,{state:"FullySigned",searchQuery:y.value,selectedTags:U.value,onRefresh:q,onOpenElectronicSignature:J},null,8,["searchQuery","selectedTags"])])):h("",!0),O.value==="archived-documents"?(s(),r("div",vf,[n(lt,{state:"Archived",searchQuery:y.value,selectedTags:U.value,onRefresh:q,onOpenElectronicSignature:J},null,8,["searchQuery","selectedTags"])])):h("",!0),O.value==="finished-documents"?(s(),r("div",bf,[n(au,{searchQuery:y.value,selectedTags:U.value},null,8,["searchQuery","selectedTags"])])):h("",!0),O.value==="in-progress-documents"?(s(),r("div",xf,[n(_m,{searchQuery:y.value,selectedTags:U.value},null,8,["searchQuery","selectedTags"])])):h("",!0),Z.value.length===0?(s(),r("div",_f,$f)):h("",!0)]))])):h("",!0),I.value==="client"||I.value==="basic"||I.value==="corporate_client"?(s(),r("div",kf,[e("div",Cf,[e("div",Df,[e("nav",Sf,[(s(),r(ge,null,he(Ue,L=>e("button",{key:L.name,onClick:pe(De=>je(L.name),["stop"]),class:j([ee.value===L.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},g(L.label),11,Ff)),64))]),e("div",Ef,[e("div",Tf,[e("button",{onClick:pe(P,["stop"]),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border text-purple-600 hover:bg-purple-50 border-purple-200"},[n(t(_t),{class:"h-4 w-4"}),re(" Firma Electrónica ")])]),e("div",Af,[e("button",{onClick:pe(_e,["stop"]),disabled:t(f),class:j(["inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border",t(f)?"text-green-400 bg-gray-50 border-gray-200 cursor-not-allowed opacity-60":"text-green-600 hover:bg-green-50 border-green-200"])},[n(t(Ne),{class:"h-4 w-4"}),re(" Membrete Global ")],10,Mf),t(f)?(s(),r("div",jf,[re(" Actualiza tu suscripción para usar esta funcionalidad "),Pf])):h("",!0)]),e("button",{onClick:o[5]||(o[5]=pe(L=>de("useDocument"),["stop"])),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[n(t(We),{class:"h-4 w-4"}),re(" Nuevo Documento ")])])]),e("div",Lf,[e("button",{onClick:o[6]||(o[6]=pe(L=>ce.value=!ce.value,["stop"])),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,g(((me=Ue.find(L=>L.name===ee.value))==null?void 0:me.label)||"Seleccionar sección"),1),(s(),r("svg",{class:j(["ml-2 h-5 w-5 transition-transform duration-200",ce.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Rf,2))]),ce.value?(s(),r("div",zf,[(s(),r(ge,null,he(Ue,L=>e("button",{key:L.name,onClick:pe(De=>je(L.name),["stop"]),class:j(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",ee.value===L.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},g(L.label),11,Uf)),64))])):h("",!0)]),e("div",If,[e("div",Nf,[e("button",{onClick:pe(P,["stop"]),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-purple-600 bg-purple-50 hover:bg-purple-100"},[n(t(_t),{class:"h-5 w-5"}),re(" Firma Electrónica ")])]),e("div",Of,[e("button",{onClick:pe(_e,["stop"]),disabled:t(f),class:j(["w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors",t(f)?"text-green-400 bg-gray-50 cursor-not-allowed opacity-60":"text-green-600 bg-green-50 hover:bg-green-100"])},[n(t(Ne),{class:"h-5 w-5"}),re(" Membrete Global ")],10,qf),t(f)?(s(),r("div",Vf,[re(" Actualiza tu suscripción para usar esta funcionalidad "),Qf])):h("",!0)]),e("button",{onClick:o[7]||(o[7]=pe(L=>de("useDocument"),["stop"])),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[n(t(We),{class:"h-5 w-5"}),re(" Nuevo Documento ")])])]),C.value==="useDocument"?(s(),r("div",Wf,[n(as,{searchQuery:y.value,selectedTags:U.value,onGoBack:ze},null,8,["searchQuery","selectedTags"])])):(s(),r("div",Hf,[ee.value==="folders"?(s(),le(os,{key:0,searchQuery:y.value,selectedTags:U.value,onRefresh:q,onNavigateToMain:ze},null,8,["searchQuery","selectedTags"])):ee.value==="my-documents"?(s(),le(It,{key:1,searchQuery:y.value,"onUpdate:searchQuery":o[8]||(o[8]=L=>y.value=L),selectedTags:U.value,"is-loading":t(i).isLoading,"card-type":"client","show-state-filter":!0,"show-client-filter":!1,"show-associations-column":!0,context:"my-documents",onRefresh:q},null,8,["searchQuery","selectedTags","is-loading"])):ee.value==="pending-signatures"?(s(),le(lt,{key:2,state:"PendingSignatures",searchQuery:y.value,selectedTags:U.value,onRefresh:q,onOpenElectronicSignature:B,onDocumentFullySigned:ve,onDocumentRejected:H},null,8,["searchQuery","selectedTags"])):ee.value==="signed-documents"?(s(),le(lt,{key:3,state:"FullySigned",searchQuery:y.value,selectedTags:U.value,onRefresh:q,onOpenElectronicSignature:B},null,8,["searchQuery","selectedTags"])):ee.value==="archived-documents"?(s(),le(lt,{key:4,state:"Archived",searchQuery:y.value,selectedTags:U.value,onRefresh:q,onOpenElectronicSignature:B},null,8,["searchQuery","selectedTags"])):h("",!0)]))])):h("",!0)])]),te.value?(s(),le(Ge,{key:0},{default:A(()=>[n(kp,{onClose:Y})]),_:1})):h("",!0),X.value&&E.value?(s(),le(Ge,{key:1},{default:A(()=>[e("div",Gf,[e("div",Zf,[e("div",Jf,[Kf,e("button",{onClick:o[9]||(o[9]=L=>X.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[n(t(Ae),{class:"h-6 w-6"})])]),e("div",Yf,[n(Jt,{"user-id":E.value.id,"initial-show-options":!E.value.has_signature,onSignatureSaved:x,onCancel:o[10]||(o[10]=L=>X.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):h("",!0),ne.value&&E.value?(s(),le(Ge,{key:2},{default:A(()=>[e("div",Xf,[e("div",ey,[e("div",ty,[sy,e("button",{onClick:o[11]||(o[11]=L=>ne.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[n(t(Ae),{class:"h-6 w-6"})])]),e("div",oy,[n(Jt,{"user-id":E.value.id,"initial-show-options":!E.value.has_signature,onSignatureSaved:x,onCancel:o[12]||(o[12]=L=>ne.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):h("",!0),n(Qt,{isVisible:t(tt),documentData:t(Vt),onClose:o[13]||(o[13]=L=>tt.value=!1)},null,8,["isVisible","documentData"]),n(Uh,{isVisible:k.value,onClose:o[14]||(o[14]=L=>k.value=!1),onUploaded:xe,onDeleted:Re},null,8,["isVisible"])],64)}}};export{jy as default};
