import{e as s,f as o,g as e,u as ot,r as b,aK as is,o as Ze,as as yt,c as B,h as r,j as t,G as Me,w as Se,v as Te,n as P,l as g,t as m,m as he,p as ae,s as ke,b5 as bs,i as M,ac as Ge,a9 as ds,b6 as xs,Q as vt,k as ne,a2 as Xe,F as ge,D as Jt,E as cs,b7 as _s,a0 as ws,C as $s,T as De,N as ye,I as et,a1 as Qe,ag as Ue,ad as Ie,ae as Ne,af as be,b8 as ks,O as St,P as Ft,a5 as Cs,ah as it,aY as Ds,ai as Et,am as Wt,an as Ss,ao as Fs,ab as Es,b9 as $t,ba as Xt}from"./index.js";import{u as He,o as Ts,s as nt,p as Ht}from"./index2.js";import{g as ht,a as ft}from"./DocumentPermissionsManager.js";import{r as As,_ as Gt,a as Tt}from"./DocumentRelationshipsModal.js";import{_ as At}from"./_plugin-vue_export-helper.js";import{B as Ms,r as js,a as Mt,b as jt,_ as Zt,c as Kt,D as us,d as Ps,L as Pt,s as es}from"./index3.js";import{r as Ct}from"./FolderIcon.js";import{r as Ke}from"./PlusIcon.js";import{r as ut}from"./EllipsisVerticalIcon.js";import{r as dt}from"./DocumentIcon.js";import{_ as Ls}from"./DocumentCard.js";import{r as ms}from"./EyeIcon.js";import{r as bt}from"./ChevronRightIcon.js";import{_ as ts}from"./SignatureDocumentCard.js";import{r as Vt,a as Bs,b as Rs}from"./TagIcon.js";import{r as We}from"./ChevronDownIcon.js";import{r as Ye}from"./MagnifyingGlassIcon.js";import{r as Dt}from"./CheckCircleIcon.js";import{r as ss}from"./PencilIcon.js";import{r as Qt}from"./TrashIcon.js";import{a as gs,r as os}from"./LinkIcon.js";import{r as ps}from"./PhotoIcon.js";import{r as lt,a as zs}from"./FunnelIcon.js";import{r as Us}from"./ArrowLeftIcon.js";import{r as Lt}from"./CubeTransparentIcon.js";import{r as as}from"./CloudArrowUpIcon.js";import{r as Is}from"./ExclamationTriangleIcon.js";import"./useRecentViews.js";import"./loading_message.js";function rs(a,$){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})])}function Ns(a,$){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})])}function Os(a,$){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})])}function qs(a,$){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const Vs={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Qs={class:"flex justify-end"},Ws=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[ae(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),Hs={class:"mt-2"},Gs={class:"flex gap-2 mt-2.5"},Zs=["disabled"],Ks=e("span",null,"Actualizar nombre",-1),Ys=[Ks],Js=["disabled"],hs={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(a,{emit:$}){const i=a,u=ot(),D=He(),_=$,h=b(""),k=b(""),y=()=>{_("close")};is(()=>{var X,S;D.selectedDocument?(h.value=((X=D.selectedDocument)==null?void 0:X.title)||"",k.value=((S=D.selectedDocument)==null?void 0:S.title)||""):(h.value="",k.value="")});const C=X=>{X.key==="Escape"&&y()};Ze(()=>{document.addEventListener("keydown",C)}),yt(()=>{document.removeEventListener("keydown",C)});const W=B(()=>h.value.trim().length>0),N=B(()=>{var X;return!!((X=D.selectedDocument)!=null&&X.id)}),U=B(()=>N.value&&h.value.trim()!==k.value.trim()&&h.value.trim().length>0);async function te(){if(N.value&&U.value)try{const X={title:h.value.trim()};await D.updateDocument(D.selectedDocument.id,X),k.value=h.value.trim(),D.selectedDocument.title=h.value.trim();const S=D.selectedDocument.id;ke("Document name successfully updated.","success"),_("close",{updatedDocId:S});const E=window.location.pathname;E==="/dynamic_document_dashboard"||E==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(X){console.error("Error updating document name:",X),ke("Error updating document name.","error")}}function ie(){const X=encodeURIComponent(h.value.trim());i.documentId&&!D.selectedDocument?u.push(`/dynamic_document_dashboard/document/use/creator/${i.documentId}/${X}`):D.selectedDocument?(D.selectedDocument.title=h.value.trim(),u.push(`/dynamic_document_dashboard/document/use/editor/${D.selectedDocument.id}/${X}`)):ke("Error: No se pudo continuar. Documento no seleccionado.","error")}return(X,S)=>(s(),o("div",Vs,[e("div",Qs,[e("button",{onClick:y},[r(t(Me),{class:"size-6"})])]),e("form",{onSubmit:he(ie,["prevent"])},[e("div",null,[Ws,e("div",Hs,[Se(e("input",{"onUpdate:modelValue":S[0]||(S[0]=d=>h.value=d),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[Te,h.value]])])]),e("div",Gs,[N.value?(s(),o("button",{key:0,type:"button",onClick:te,disabled:!U.value,class:P(["p-2.5 text-sm font-medium rounded-md flex gap-2",U.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Ys,10,Zs)):g("",!0),e("button",{type:"submit",class:P(["p-2.5 text-sm font-medium rounded-md flex gap-2",W.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!W.value},[e("span",null,m(N.value?"Editar Documento":"Continuar"),1)],10,Js)])],32)]))}},Xs={class:"mt-3 pt-2 border-t border-gray-100"},eo={class:"flex items-center gap-2 text-xs text-gray-500"},to=e("span",null,"Hacer clic para usar este documento",-1),so={__name:"UseDocumentCard",props:{document:{type:Object,required:!0},showTags:{type:Boolean,default:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null},additionalClasses:{type:String,default:""}},emits:["click","remove-from-folder","document-created"],setup(a,{emit:$}){const i=a,u=$,D=b(!1),_=b(null),h=ht(9),k=B(()=>"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium !bg-purple-100 !text-purple-700 !border !border-purple-200"),y=B(()=>h.dark),C=B(()=>{const S="group !border-purple-400 !bg-purple-50/50 !shadow-purple-100";return i.additionalClasses?`${S} ${i.additionalClasses}`:S}),W=B(()=>i.menuOptions!==null?i.menuOptions:[{label:"Usar",action:"use",icon:Ns,iconClasses:"w-4 h-4 text-purple-600"},{label:"Previsualización",action:"preview",icon:ms,iconClasses:"w-4 h-4 text-gray-600"}]),N=B(()=>!1),U=(S,d)=>{i.disableInternalActions?u("click",S,d):ie(S.id)},te=(S,d)=>{switch(S){case"use":ie(d.id);break;case"preview":Ts(d);break;default:console.warn("Unknown menu action:",S)}};function ie(S){S?(_.value=S,D.value=!0):console.error("Document ID is required:",S)}function X(S){if(D.value=!1,_.value=null,S&&S.updatedDocId){u("document-created",S);const d=window.location.pathname;d==="/dynamic_document_dashboard"||d==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(S.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}}return(S,d)=>(s(),o(ge,null,[r(Ms,{document:a.document,"card-type":a.cardType,"card-context":a.cardContext,"status-icon":t(xs),"status-text":"Disponible","status-badge-classes":k.value,"menu-options":W.value,"highlighted-doc-id":null,"show-tags":a.showTags,"document-store":a.documentStore,"user-store":a.userStore,"additional-classes":C.value,"disable-internal-actions":a.disableInternalActions,"show-menu-options":a.showMenuOptions,onClick:U,onMenuAction:te,onRemoveFromFolder:d[0]||(d[0]=E=>S.$emit("remove-from-folder",E))},bs({"additional-actions":M(()=>[ds(S.$slots,"additional-actions")]),_:2},[N.value?{name:"right-action",fn:M(()=>[r(t(bt),{class:"w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors"})]),key:"0"}:void 0,a.disableInternalActions?void 0:{name:"footer",fn:M(()=>[e("div",Xs,[e("div",eo,[e("div",{class:"w-2 h-2 rounded-full",style:Ge({backgroundColor:y.value})},null,4),to])])]),key:"1"}]),1032,["document","card-type","card-context","status-icon","status-badge-classes","menu-options","show-tags","document-store","user-store","additional-classes","disable-internal-actions","show-menu-options"]),Se(r(Xe,null,{default:M(()=>[_.value!==null?(s(),ne(hs,{key:0,"document-id":_.value,onClose:X},null,8,["document-id"])):g("",!0)]),_:1},512),[[vt,D.value]])],64))}},oo=()=>({folders:[],currentFolder:null,isLoading:!1,error:null,lastUpdatedFolderId:null}),ao={sortedFolders:a=>[...a.folders].sort(($,i)=>new Date(i.created_at)-new Date($.created_at)),getFolderById:a=>$=>a.folders.find(i=>i.id===$),getFoldersByColor:a=>$=>a.folders.filter(i=>i.color_id===$),getFolderWithColor:a=>$=>{const i=a.folders.find(u=>u.id===$);return i?{...i,color:ht(i.color_id)}:null},getFoldersContainingDocument:a=>$=>a.folders.filter(i=>i.document_ids&&i.document_ids.includes($)),totalDocumentsInFolders:a=>a.folders.reduce(($,i)=>$+(i.document_ids?i.document_ids.length:0),0),hasFolders:a=>a.folders.length>0,availableColors:()=>ft()},ro={async init(a=!1){if(!(this.folders.length>0&&!a)){this.isLoading=!0,this.error=null;try{await this.fetchFolders()}catch($){console.error("Error initializing document folder store:",$),this.error="Error al inicializar las carpetas"}finally{this.isLoading=!1}}},async fetchFolders(){try{const a=await Jt("dynamic-documents/folders/");if(a.status===200)return this.folders=a.data,a.data;throw new Error(`Error fetching folders: ${a.status}`)}catch(a){throw console.error("Error fetching folders:",a),this.error="Error al obtener las carpetas",a}},async fetchFolder(a){this.isLoading=!0,this.error=null;try{const $=await Jt(`dynamic-documents/folders/${a}/`);if($.status===200){const i=$.data,u=this.folders.findIndex(D=>D.id===i.id);return u!==-1?this.folders[u]=i:this.folders.push(i),this.currentFolder=i,i}else throw new Error(`Error fetching folder: ${$.status}`)}catch($){throw console.error("Error fetching folder:",$),this.error="Error al obtener la carpeta",$}finally{this.isLoading=!1}},async createFolder(a){this.isLoading=!0,this.error=null;try{if(!a.name||a.name.trim()==="")throw new Error("El nombre de la carpeta es requerido");const $=a.color_id??0;if($<0||$>=ft().length)throw new Error("Color de carpeta no válido");const i={name:a.name.trim(),color_id:$,...a.document_ids&&{document_ids:a.document_ids}},u=await cs("dynamic-documents/folders/create/",i);if(u.status===200||u.status===201){const D=u.data;return this.folders.push(D),this.lastUpdatedFolderId=D.id,ke("Carpeta creada exitosamente","success"),D}else throw new Error(`Error creating folder: ${u.status}`)}catch($){throw console.error("Error creating folder:",$),this.error=$.message||"Error al crear la carpeta",ke(this.error,"error"),$}finally{this.isLoading=!1}},async updateFolder(a,$){this.isLoading=!0,this.error=null;try{if($.name&&$.name.trim()==="")throw new Error("El nombre de la carpeta no puede estar vacío");if($.color_id!==void 0){const D=$.color_id;if(D<0||D>=ft().length)throw new Error("Color de carpeta no válido")}const i={};$.name&&(i.name=$.name.trim()),$.color_id!==void 0&&(i.color_id=$.color_id),$.document_ids!==void 0&&(i.document_ids=$.document_ids);const u=await _s(`dynamic-documents/folders/${a}/update/`,i);if(u.status===200){const D=u.data,_=this.folders.findIndex(h=>h.id===a);return _!==-1&&(this.folders[_]=D),this.currentFolder&&this.currentFolder.id===a&&(this.currentFolder=D),this.lastUpdatedFolderId=a,ke("Carpeta actualizada exitosamente","success"),D}else throw new Error(`Error updating folder: ${u.status}`)}catch(i){throw console.error("Error updating folder:",i),this.error=i.message||"Error al actualizar la carpeta",ke(this.error,"error"),i}finally{this.isLoading=!1}},async deleteFolder(a){this.isLoading=!0,this.error=null;try{const $=await ws(`dynamic-documents/folders/${a}/delete/`);if($.status===204||$.status===200)return this.folders=this.folders.filter(i=>i.id!==a),this.currentFolder&&this.currentFolder.id===a&&(this.currentFolder=null),await ke("Carpeta eliminada exitosamente","success"),!0;throw new Error(`Error deleting folder: ${$.status}`)}catch($){throw console.error("Error deleting folder:",$),this.error=$.message||"Error al eliminar la carpeta",await ke(this.error,"error"),$}finally{this.isLoading=!1}},setCurrentFolder(a){this.currentFolder=a},clearCurrentFolder(){this.currentFolder=null},reset(){this.folders=[],this.currentFolder=null,this.isLoading=!1,this.error=null,this.lastUpdatedFolderId=null}},no={async addDocumentsToFolder(a,$){const i=this.getFolderById(a);if(!i)throw new Error("Carpeta no encontrada");const u=i.document_ids||[],D=[...new Set([...u,...$])];return await this.updateFolder(a,{document_ids:D})},async removeDocumentsFromFolder(a,$){const i=this.getFolderById(a);if(!i)throw new Error("Carpeta no encontrada");const D=(i.document_ids||[]).filter(_=>!$.includes(_));return await this.updateFolder(a,{document_ids:D})},async moveDocumentsBetweenFolders(a,$,i){try{$&&await this.removeDocumentsFromFolder($,a),i&&await this.addDocumentsToFolder(i,a),await ke("Documentos movidos exitosamente","success")}catch(u){throw console.error("Error moving documents between folders:",u),await ke("Error al mover documentos","error"),u}},getFolderColor(a){const $=this.getFolderById(a);return $?ht($.color_id):ht(0)},validateFolderData(a){const $=[];if((!a.name||a.name.trim()==="")&&$.push("El nombre de la carpeta es requerido"),a.name&&a.name.length>100&&$.push("El nombre de la carpeta no puede exceder 100 caracteres"),a.color_id!==void 0){const i=a.color_id;(i<0||i>=ft().length)&&$.push("Color de carpeta no válido")}return a.document_ids&&!Array.isArray(a.document_ids)&&$.push("Los IDs de documentos deben ser un array"),{isValid:$.length===0,errors:$}}},Yt=$s("documentFolder",{state:oo,getters:ao,actions:{...ro,...no}}),lo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},io={class:"bg-white rounded-xl shadow-xl max-w-md w-full"},co={class:"flex justify-between items-center p-6 border-b"},uo={class:"text-lg font-semibold text-gray-900"},mo={class:"mb-4"},go=e("label",{for:"folderName",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la carpeta ",-1),po={class:"mb-6"},ho=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Color de la carpeta ",-1),fo={class:"grid grid-cols-8 gap-2"},yo=["onClick","title"],vo={class:"flex gap-3"},bo=["disabled"],xo={__name:"CreateEditFolderModal",props:{isVisible:{type:Boolean,required:!0},editingFolder:{type:Object,default:null}},emits:["close","success"],setup(a,{emit:$}){const i=a,u=$,D=Yt(),_=b(!1),h=b({name:"",color_id:0}),k=B(()=>ft()),y=()=>{h.value={name:"",color_id:0}};De(()=>i.editingFolder,N=>{N?h.value={name:N.name,color_id:N.color_id}:y()},{immediate:!0}),De(()=>i.isVisible,N=>{N||y()});const C=()=>{u("close")},W=async()=>{if(h.value.name.trim()){_.value=!0;try{i.editingFolder?await D.updateFolder(i.editingFolder.id,h.value):await D.createFolder(h.value),_.value=!1,u("success")}catch{_.value=!1}}};return(N,U)=>a.isVisible?(s(),ne(Xe,{key:0},{default:M(()=>[e("div",lo,[e("div",io,[e("div",co,[e("h3",uo,m(a.editingFolder?"Editar Carpeta":"Nueva Carpeta"),1),e("button",{onClick:C,class:"text-gray-400 hover:text-gray-500"},[r(t(Me),{class:"w-6 h-6"})])]),e("form",{onSubmit:he(W,["prevent"]),class:"p-6"},[e("div",mo,[go,Se(e("input",{id:"folderName","onUpdate:modelValue":U[0]||(U[0]=te=>h.value.name=te),type:"text",required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ej: Contratos Laborales"},null,512),[[Te,h.value.name]])]),e("div",po,[ho,e("div",fo,[(s(!0),o(ge,null,ye(k.value,te=>(s(),o("button",{key:te.id,type:"button",onClick:ie=>h.value.color_id=te.id,class:P(["w-8 h-8 rounded-full border-2 transition-all",h.value.color_id===te.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"]),style:Ge({backgroundColor:te.hex}),title:te.name},null,14,yo))),128))])]),e("div",vo,[e("button",{type:"button",onClick:C,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:!h.value.name.trim()||_.value,class:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},m(_.value?"Guardando...":a.editingFolder?"Actualizar":"Crear"),9,bo)])],32)])])]),_:1})):g("",!0)}},_o={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},wo={class:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col"},$o={class:"border-b px-6 py-4 flex-shrink-0"},ko={class:"flex justify-between items-center"},Co={class:"flex items-center gap-3"},Do={class:"text-xl font-semibold text-gray-900"},So={class:"text-sm text-gray-600"},Fo={class:"flex items-center gap-2"},Eo={class:"flex-1 overflow-y-auto p-6"},To={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},Ao={class:"min-w-full divide-y divide-gray-200"},Mo=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tipo "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),jo={class:"bg-white divide-y divide-gray-200"},Po=["onClick"],Lo={class:"px-6 py-4 whitespace-nowrap"},Bo={class:"flex items-center"},Ro={class:"flex-shrink-0 h-10 w-10"},zo={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Uo={class:"ml-4"},Io={class:"text-sm font-medium text-gray-900"},No={class:"px-6 py-4 whitespace-nowrap"},Oo={class:"text-sm text-gray-600"},qo={class:"px-6 py-4 whitespace-nowrap"},Vo={class:"px-6 py-4 whitespace-nowrap"},Qo={class:"flex flex-wrap gap-1"},Wo={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},Ho={key:1,class:"text-sm text-gray-400"},Go={class:"py-1"},Zo=["onClick"],Ko=["onClick"],Yo={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Jo=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"Esta carpeta está vacía",-1),Xo=e("p",{class:"text-gray-600 mb-4"},"Agrega documentos para organizar tu trabajo",-1),ea={__name:"FolderDetailsModalTable",props:{folder:{type:Object,default:null}},emits:["close","add-documents","remove-document","view-document","use-document","document-action"],setup(a,{emit:$}){const i=a,u=$;et(),He();const D=b({}),_=b({}),h=b(!1),k=b(-1),y=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],C=B(()=>{if(!i.folder)return y[0];if(i.folder.color)return y.find(J=>J.name===i.folder.color)||y[0];const A=i.folder.id%y.length;return y[A]}),W=A=>A.state==="Published"||A.state==="Draft"?"Formato":A.state==="PendingSignatures"||A.state==="FullySigned"?"Para Firmar":A.state==="Progress"||A.state==="Completed"?"Mis Documentos":"Documento",N=A=>({Published:"Publicado",Draft:"Borrador",Progress:"En Progreso",Completed:"Completado",PendingSignatures:"Pendiente Firma",FullySigned:"Firmado"})[A.state]||A.state,U=A=>({Published:"bg-green-100 text-green-700 border border-green-200",Draft:"bg-gray-100 text-gray-700 border border-gray-200",Progress:"bg-blue-100 text-blue-700 border border-blue-200",Completed:"bg-green-100 text-green-700 border border-green-200",PendingSignatures:"bg-yellow-100 text-yellow-700 border border-yellow-200",FullySigned:"bg-green-100 text-green-700 border border-green-200"})[A.state]||"bg-gray-100 text-gray-700 border border-gray-200",te=A=>{const J=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],Q=A.id%J.length;return J[Q]},ie=()=>{u("close")},X=()=>{u("add-documents",i.folder)},S=A=>{u("remove-document",{folderId:i.folder.id,documentId:A.id})},d=A=>{const J=W(A);u(J==="Formato"?"use-document":"view-document",A)},E=()=>!h.value||!i.folder?"auto":i.folder.documents.length===1?"280px":i.folder.documents.length===2&&k.value===1?"340px":"280px",T=(A,J)=>{A&&(D.value[J]=A)},Y=(A,J)=>{A&&(_.value[J]=A)},v=(A,J)=>{h.value=!J,k.value=J?-1:A,J||setTimeout(()=>{const Q=_.value[A];if(Q){const Z=Q.$el||Q;if(Z&&Z.getBoundingClientRect){const K=Z.getBoundingClientRect(),H=window.innerHeight;if(A===0){if(K.bottom>H-20){const G=K.bottom-H+40;window.scrollBy({top:G,behavior:"smooth"})}}else if(K.bottom>H-10){const G=K.bottom-H+30;window.scrollBy({top:G,behavior:"smooth"})}else if(K.top<80){const G=K.top-100;window.scrollBy({top:G,behavior:"smooth"})}}}},100)};return(A,J)=>a.folder?(s(),ne(Xe,{key:0},{default:M(()=>[e("div",_o,[e("div",wo,[e("div",$o,[e("div",ko,[e("div",Co,[e("div",{class:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:Ge({backgroundColor:C.value.hex+"20"})},[r(t(Ct),{class:"h-6 w-6",style:Ge({color:C.value.hex})},null,8,["style"])],4),e("div",null,[e("h3",Do,m(a.folder.name),1),e("p",So,m(a.folder.documents.length)+" documento"+m(a.folder.documents.length!==1?"s":""),1)])]),e("div",Fo,[e("button",{onClick:X,class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"},[r(t(Ke),{class:"w-5 h-5"}),ae(" Agregar documentos ")]),e("button",{onClick:ie,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[r(t(Me),{class:"w-6 h-6"})])])])]),e("div",Eo,[a.folder.documents.length>0?(s(),o("div",To,[e("div",{class:"overflow-x-auto",style:Ge({minHeight:E()})},[e("table",Ao,[Mo,e("tbody",jo,[(s(!0),o(ge,null,ye(a.folder.documents,(Q,Z)=>{var K;return s(),o("tr",{key:Q.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:H=>d(Q)},[e("td",Lo,[e("div",Bo,[e("div",Ro,[e("div",zo,[r(t(Qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",Uo,[e("div",Io,m(Q.title),1)])])]),e("td",No,[e("span",Oo,m(W(Q)),1)]),e("td",qo,[e("span",{class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",U(Q)])},m(N(Q)),3)]),e("td",Vo,[e("div",Qo,[(s(!0),o(ge,null,ye((K=Q.tags)==null?void 0:K.slice(0,2),H=>(s(),o("span",{key:H.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",te(H)])},m(H.name),3))),128)),Q.tags&&Q.tags.length>2?(s(),o("span",Wo," +"+m(Q.tags.length-2),1)):g("",!0),!Q.tags||Q.tags.length===0?(s(),o("span",Ho,"-")):g("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:J[0]||(J[0]=he(()=>{},["stop"]))},[r(t(Ue),{as:"div",class:"relative inline-block text-left"},{default:M(({open:H})=>[r(t(Ie),{ref_for:!0,ref:G=>T(G,Z),onClick:G=>v(Z,H),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:M(()=>[r(t(ut),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),r(t(Ne),{ref_for:!0,ref:G=>Y(G,Z),class:P([a.folder.documents.length>2&&Z>0&&Z>=a.folder.documents.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:M(()=>[e("div",Go,[r(t(be),null,{default:M(({active:G})=>[e("a",{onClick:L=>d(Q),class:P([G?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver documento ",10,Zo)]),_:2},1024),r(t(be),null,{default:M(({active:G})=>[e("a",{onClick:L=>S(Q),class:P([G?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Quitar de carpeta ",10,Ko)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,Po)}),128))])])],4)])):(s(),o("div",Yo,[r(t(dt),{class:"w-12 h-12 text-gray-300 mx-auto mb-4"}),Jo,Xo,e("button",{onClick:X,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},[r(t(Ke),{class:"w-5 h-5"}),ae(" Agregar documentos ")])]))])])])]),_:1})):g("",!0)}},xt=a=>(St("data-v-d403a707"),a=a(),Ft(),a),ta={class:"tag-filter-container"},sa={class:"relative"},oa={class:"flex items-center"},aa={key:0,class:"ml-2 inline-flex items-center justify-center h-5 w-5 bg-primary text-white text-xs rounded-full font-medium"},ra={key:0,class:"absolute left-0 mt-2 w-full sm:w-80 bg-white rounded-xl shadow-xl ring-1 ring-black ring-opacity-5 border border-gray-100 z-50 overflow-hidden"},na={class:"bg-gray-50 p-4 border-b border-gray-200"},la={class:"flex items-center justify-between mb-3"},ia=xt(()=>e("h3",{class:"text-sm font-semibold text-gray-900"},"Filtrar por etiquetas",-1)),da={key:0,class:"text-xs text-gray-500"},ca={class:"relative"},ua={key:0,class:"px-4 py-2 bg-blue-50 border-b border-blue-100"},ma={class:"flex items-center justify-between"},ga={class:"text-xs font-medium text-blue-700"},pa={class:"max-h-52 overflow-y-auto"},ha={key:0,class:"px-4 py-8 text-center"},fa=xt(()=>e("p",{class:"text-gray-500 text-sm"},"No hay etiquetas disponibles",-1)),ya={key:1,class:"px-4 py-8 text-center"},va={class:"text-gray-500 text-sm"},ba={key:2,class:"px-4 py-8 text-center"},xa=xt(()=>e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"}),e("span",{class:"ml-3 text-sm text-gray-600"},"Cargando etiquetas...")],-1)),_a=[xa],wa={key:3,class:"py-2"},$a=["onClick"],ka={class:"flex items-center h-5"},Ca={class:"relative"},Da=["id","checked","onChange"],Sa={key:0,class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},Fa=xt(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),Ea=[Fa],Ta={class:"ml-3 flex items-center flex-1 min-w-0"},Aa={class:"text-sm font-medium text-gray-900 truncate"},Ma={key:0,class:"mt-4"},ja={class:"flex items-start gap-2"},Pa=xt(()=>e("span",{class:"text-xs font-medium text-gray-500 mt-1.5 flex-shrink-0"},"Activos:",-1)),La={class:"flex flex-wrap gap-2"},Ba=["onClick"],Ra={class:"mr-1"},za={class:"ml-1 p-0.5 rounded-full hover:bg-white/50 transition-colors duration-150"},Ua={__name:"TagFilter",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(a,{emit:$}){const i=a,u=$,D=He(),_=b(!1),h=b([]),k=b(!1),y=b(""),C=B(()=>D.sortedTags),W=B(()=>{if(!y.value.trim())return C.value;const d=y.value.toLowerCase().trim();return C.value.filter(E=>E.name.toLowerCase().includes(d))}),N=d=>{const E=ht(d.color_id);return{hex:E&&E.hex?E.hex:"#9CA3AF",dark:E&&E.dark?E.dark:"#374151"}},U=()=>{_.value=!_.value,_.value&&(y.value="")},te=d=>h.value.some(E=>E.id===d.id),ie=d=>{const E=h.value.findIndex(T=>T.id===d.id);E>=0?h.value.splice(E,1):h.value.push(d),u("update:modelValue",h.value)},X=()=>{h.value=[],u("update:modelValue",[])},S=d=>{d.target.closest(".tag-filter-container")||(_.value=!1,y.value="")};return Ze(async()=>{try{k.value=!0,await D.initTags()}catch(d){console.error("Error loading tags:",d)}finally{k.value=!1}document.addEventListener("click",S)}),De(()=>i.modelValue,d=>{h.value=d||[]},{immediate:!0}),yt(()=>{document.removeEventListener("click",S)}),(d,E)=>(s(),o("div",ta,[e("div",sa,[e("button",{onClick:U,class:P(["group inline-flex items-center justify-between w-full sm:w-auto sm:min-w-[200px] px-4 py-3 border border-gray-200 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-primary transition-all duration-200",{"ring-2 ring-primary border-primary bg-blue-50":_.value,"border-primary bg-primary/5":h.value.length>0&&!_.value}])},[e("div",oa,[r(t(Vt),{class:P(["h-5 w-5 mr-2.5 text-gray-500 group-hover:text-gray-600",{"text-primary":h.value.length>0||_.value}])},null,8,["class"]),e("span",{class:P(["text-gray-700",{"text-primary font-semibold":h.value.length>0||_.value}])}," Filtrar por etiquetas ",2),h.value.length>0?(s(),o("span",aa,m(h.value.length),1)):g("",!0)]),r(t(We),{class:P(["ml-3 h-4 w-4 text-gray-400 transition-all duration-200 group-hover:text-gray-600",{"rotate-180 text-primary":_.value,"text-primary":h.value.length>0&&!_.value}])},null,8,["class"])],2),r(ks,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:M(()=>[_.value?(s(),o("div",ra,[e("div",na,[e("div",la,[ia,C.value.length>0?(s(),o("span",da,m(C.value.length)+" disponibles ",1)):g("",!0)]),e("div",ca,[r(t(Ye),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Se(e("input",{"onUpdate:modelValue":E[0]||(E[0]=T=>y.value=T),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"},null,512),[[Te,y.value]])])]),h.value.length>0?(s(),o("div",ua,[e("div",ma,[e("span",ga,m(h.value.length)+" etiqueta"+m(h.value.length!==1?"s":"")+" seleccionada"+m(h.value.length!==1?"s":""),1),e("button",{onClick:X,class:"text-xs text-red-600 hover:text-red-700 font-medium px-2 py-1 rounded-md hover:bg-red-50 transition-all duration-200"}," Limpiar todo ")])])):g("",!0),e("div",pa,[!k.value&&W.value.length===0&&y.value.trim()===""?(s(),o("div",ha,[r(t(Vt),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),fa])):g("",!0),!k.value&&W.value.length===0&&y.value.trim()!==""?(s(),o("div",ya,[r(t(Ye),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e("p",va,'Sin resultados para "'+m(y.value)+'"',1),e("button",{onClick:E[1]||(E[1]=T=>y.value=""),class:"text-xs text-primary hover:text-primary-dark mt-2 font-medium"}," Ver todas las etiquetas ")])):g("",!0),k.value?(s(),o("div",ba,_a)):g("",!0),!k.value&&W.value.length>0?(s(),o("div",wa,[(s(!0),o(ge,null,ye(W.value,T=>(s(),o("div",{key:T.id,class:"group flex items-center px-4 py-2.5 hover:bg-gray-50 cursor-pointer transition-colors duration-150",onClick:Y=>ie(T)},[e("div",ka,[e("div",Ca,[e("input",{id:`tag-${T.id}`,type:"checkbox",checked:te(T),onChange:Y=>ie(T),class:"sr-only"},null,40,Da),e("div",{class:P(["w-4 h-4 border-2 rounded transition-all duration-200 flex items-center justify-center",te(T)?"bg-primary border-primary":"border-gray-300 group-hover:border-gray-400"])},[te(T)?(s(),o("svg",Sa,Ea)):g("",!0)],2)])]),e("div",Ta,[e("div",{class:"w-3 h-3 rounded-full mr-2.5 border flex-shrink-0 shadow-sm",style:Ge({backgroundColor:N(T).hex})},null,4),e("span",Aa,m(T.name),1)])],8,$a))),128))])):g("",!0)])])):g("",!0)]),_:1})]),h.value.length>0?(s(),o("div",Ma,[e("div",ja,[Pa,e("div",La,[(s(!0),o(ge,null,ye(h.value,T=>(s(),o("div",{key:T.id,class:"group inline-flex items-center pl-2.5 pr-1.5 py-1.5 rounded-lg text-xs font-medium border shadow-sm cursor-pointer transition-all duration-200 hover:shadow-md",style:Ge({backgroundColor:N(T).hex+"20",borderColor:N(T).hex+"40",color:N(T).dark}),onClick:Y=>ie(T)},[e("div",{class:"w-2 h-2 rounded-full mr-2 flex-shrink-0",style:Ge({backgroundColor:N(T).hex})},null,4),e("span",Ra,m(T.name),1),e("div",za,[r(t(Me),{class:"h-3 w-3 opacity-60 group-hover:opacity-100"})])],12,Ba))),128))])])])):g("",!0)]))}},Ia=At(Ua,[["__scopeId","data-v-d403a707"]]),Na={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Oa={class:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden"},qa={class:"border-b"},Va={class:"hidden sm:flex justify-between items-center p-6"},Qa=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Wa={class:"text-sm text-gray-600"},Ha={class:"sm:hidden p-4"},Ga={class:"flex justify-between items-start mb-2"},Za={class:"flex-1 min-w-0 mr-3"},Ka=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Ya={class:"text-sm text-gray-600 truncate"},Ja={class:"border-b"},Xa={class:"hidden sm:flex space-x-8 px-6","aria-label":"Tabs"},er=["onClick"],tr={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},sr={class:"sm:hidden relative px-4 py-3"},or={class:"flex items-center"},ar={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},rr=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),nr=[rr],lr={class:"absolute top-full left-4 right-4 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},ir=["onClick"],dr={class:"border-b bg-gray-50 p-4 sm:p-6"},cr={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},ur={class:"flex-1"},mr={key:0,class:"flex items-center gap-3"},gr={class:"text-sm text-gray-600"},pr={class:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-350px)]"},hr={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},fr=["onClick"],yr=e("span",null,"Etiquetas",-1),vr=[yr],br={key:5,class:"absolute top-2 left-2 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center shadow-sm"},xr={key:0,class:"text-center py-8 sm:py-12"},_r={class:"text-lg font-medium text-gray-900 mb-2"},wr={class:"text-gray-600 text-sm sm:text-base"},$r={class:"border-t bg-gray-50"},kr={class:"hidden sm:flex justify-between items-center p-6"},Cr={class:"text-sm text-gray-600"},Dr={class:"flex gap-3"},Sr=["disabled"],Fr={class:"sm:hidden p-4 space-y-3"},Er={class:"text-center text-sm text-gray-600"},Tr={class:"flex gap-3"},Ar=["disabled"],Mr={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 p-4"},jr={class:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] flex flex-col"},Pr={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},Lr={class:"flex items-center gap-2"},Br=e("h2",{class:"text-sm font-semibold text-gray-900"},"Etiquetas del documento",-1),Rr={class:"px-4 py-3 border-b border-gray-100 text-xs text-gray-500"},zr=e("span",{class:"font-medium text-gray-700"},"Documento:",-1),Ur={class:"ml-1"},Ir={class:"px-4 py-3 overflow-y-auto"},Nr={key:0,class:"text-sm text-gray-500"},Or={key:1,class:"space-y-2 text-sm"},qr={class:"flex items-center gap-2 min-w-0"},Vr={key:0,class:"text-xs text-gray-500 truncate max-w-[8rem]"},Qr={__name:"AddDocumentsModal",props:{isVisible:{type:Boolean,required:!0},folder:{type:Object,default:null}},emits:["close","add-documents"],setup(a,{emit:$}){const i=a,u=$,D=He(),_=et(),h=b([]),k=b([]),y=b("my-documents"),C=b(!1),W=b(!1),N=b(!1),U=b(null),te=[{name:"my-documents",label:"Mis Documentos"},{name:"use-documents",label:"Minutas"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Documentos Firmados"}],ie=B(()=>_.currentUser);De(()=>i.isVisible,H=>{H&&(h.value=[],k.value=[],y.value="my-documents")}),De(y,()=>{h.value=[]}),De(k,()=>{h.value=[]},{deep:!0});const X=B(()=>{const H=d(y.value);return H.length===0?!1:H.every(G=>h.value.includes(G.id))}),S=H=>{var j;if(!i.folder)return[];const G=i.folder.documents.map(le=>le.id);let L=[];switch(H){case"my-documents":L=D.progressAndCompletedDocumentsByClient((j=ie.value)==null?void 0:j.id);break;case"use-documents":L=D.publishedDocumentsUnassigned;break;case"pending-signatures":L=D.documents.filter(le=>{var fe,q;return le.state==="PendingSignatures"&&(le.assigned_to===((fe=ie.value)==null?void 0:fe.id)||((q=le.signatures)==null?void 0:q.some(O=>{var V;return O.signer_email===((V=ie.value)==null?void 0:V.email)})))});break;case"signed-documents":L=D.documents.filter(le=>{var fe,q;return le.state==="FullySigned"&&(le.assigned_to===((fe=ie.value)==null?void 0:fe.id)||((q=le.signatures)==null?void 0:q.some(O=>{var V;return O.signer_email===((V=ie.value)==null?void 0:V.email)})))});break;default:L=[]}return L.filter(le=>!G.includes(le.id))},d=H=>{const G=S(H);if(!k.value||k.value.length===0)return G;const L=k.value.map(j=>j.id);return G.filter(j=>!j.tags||j.tags.length===0?!1:j.tags.some(le=>L.includes(le.id)))},E=H=>{const G=h.value.indexOf(H);G>-1?h.value.splice(G,1):h.value.push(H)},T=()=>{const G=d(y.value).map(L=>L.id);if(X.value)h.value=h.value.filter(L=>!G.includes(L));else{const L=G.filter(j=>!h.value.includes(j));h.value.push(...L)}},Y=()=>{u("close")},v=async()=>{if(h.value.length!==0){C.value=!0;try{await u("add-documents",h.value)}finally{C.value=!1}}},A=H=>{y.value=H,W.value=!1},J=H=>{H.target.closest(".relative")||(W.value=!1)};Ze(()=>{document.addEventListener("click",J)}),yt(()=>{document.removeEventListener("click",J)});const Q=H=>{const G=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],L=H.id%G.length;return G[L]},Z=H=>{U.value=H,N.value=!0},K=()=>{N.value=!1,U.value=null};return(H,G)=>a.isVisible&&a.folder?(s(),ne(Xe,{key:0},{default:M(()=>{var L;return[e("div",Na,[e("div",Oa,[e("div",qa,[e("div",Va,[e("div",null,[Qa,e("p",Wa,'Selecciona documentos para agregar a "'+m(a.folder.name)+'"',1)]),e("button",{onClick:Y,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors"},[r(t(Me),{class:"w-5 h-5"})])]),e("div",Ha,[e("div",Ga,[e("div",Za,[Ka,e("p",Ya,'Para "'+m(a.folder.name)+'"',1)]),e("button",{onClick:Y,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors flex-shrink-0"},[r(t(Me),{class:"w-5 h-5"})])])])]),e("div",Ja,[e("nav",Xa,[(s(),o(ge,null,ye(te,j=>e("button",{key:j.name,onClick:le=>y.value=j.name,class:P([y.value===j.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[ae(m(j.label)+" ",1),e("span",tr,m(d(j.name).length),1)],10,er)),64))]),e("div",sr,[e("button",{onClick:G[0]||(G[0]=j=>W.value=!W.value),class:"w-full flex items-center justify-between py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("div",or,[e("span",null,m(((L=te.find(j=>j.name===y.value))==null?void 0:L.label)||"Seleccionar categoría"),1),e("span",ar,m(d(y.value).length),1)]),(s(),o("svg",{class:P(["ml-2 h-5 w-5 transition-transform duration-200",W.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},nr,2))]),Se(e("div",lr,[(s(),o(ge,null,ye(te,j=>e("button",{key:j.name,onClick:le=>A(j.name),class:P(["w-full text-left px-4 py-3 text-sm transition-colors duration-150 flex items-center justify-between",y.value===j.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},[e("span",null,m(j.label),1),e("span",{class:P(["py-0.5 px-2 rounded-full text-xs",y.value===j.name?"bg-white/20 text-white":"bg-gray-100 text-gray-600"])},m(d(j.name).length),3)],10,ir)),64))],512),[[vt,W.value]])])]),e("div",dr,[e("div",cr,[e("div",ur,[r(Ia,{modelValue:k.value,"onUpdate:modelValue":G[1]||(G[1]=j=>k.value=j),class:"max-w-md"},null,8,["modelValue"])]),d(y.value).length>0?(s(),o("div",mr,[e("span",gr,m(d(y.value).length)+" documento(s) disponible(s) ",1),e("button",{onClick:T,class:P(["px-4 py-2 rounded-lg border font-medium text-sm transition-colors",X.value?"bg-red-50 border-red-200 text-red-700 hover:bg-red-100":"bg-primary text-white border-primary hover:bg-primary-dark"])},m(X.value?"Deseleccionar todos":"Seleccionar todos"),3)])):g("",!0)])]),e("div",pr,[e("div",hr,[(s(!0),o(ge,null,ye(d(y.value),j=>(s(),o("div",{key:j.id,class:"relative"},[y.value==="my-documents"?(s(),ne(t(Ls),{key:0,document:j,"highlighted-doc-id":null,"show-tags":!1,"show-client-name":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":h.value.includes(j.id)?"ring-2 ring-primary bg-primary-50":"",onClick:le=>E(j.id)},null,8,["document","additional-classes","onClick"])):g("",!0),y.value==="use-documents"?(s(),ne(t(so),{key:1,document:j,"show-tags":!1,"menu-options":[],"show-menu-options":!1,"disable-internal-actions":!0,"additional-classes":h.value.includes(j.id)?"ring-2 ring-primary bg-primary-50":"",onClick:le=>E(j.id)},null,8,["document","additional-classes","onClick"])):g("",!0),y.value==="pending-signatures"?(s(),ne(t(ts),{key:2,document:j,"highlighted-doc-id":null,"show-tags":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":h.value.includes(j.id)?"ring-2 ring-primary bg-primary-50":"",onClick:le=>E(j.id)},null,8,["document","additional-classes","onClick"])):g("",!0),y.value==="signed-documents"?(s(),ne(t(ts),{key:3,document:j,"highlighted-doc-id":null,"show-tags":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":h.value.includes(j.id)?"ring-2 ring-primary bg-primary-50":"",onClick:le=>E(j.id)},null,8,["document","additional-classes","onClick"])):g("",!0),j.tags&&j.tags.length>0?(s(),o("button",{key:4,type:"button",class:"absolute bottom-2 right-2 px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 inline-flex items-center gap-1",onClick:he(le=>Z(j),["stop"])},vr,8,fr)):g("",!0),h.value.includes(j.id)?(s(),o("div",br,[r(t(Bs),{class:"w-4 h-4"})])):g("",!0)]))),128))]),d(y.value).length===0?(s(),o("div",xr,[r(t(dt),{class:"w-12 h-12 sm:w-16 sm:h-16 text-gray-300 mx-auto mb-4"}),e("h4",_r,m(k.value.length>0?"No hay documentos que coincidan con el filtro":"No hay documentos disponibles"),1),e("p",wr,m(k.value.length>0?"Intenta ajustar los filtros de etiquetas o selecciona otra categoría":"No tienes documentos de esta categoría que no estén ya en la carpeta"),1)])):g("",!0)]),e("div",$r,[e("div",kr,[e("div",Cr,m(h.value.length)+" documento(s) seleccionado(s) ",1),e("div",Dr,[e("button",{onClick:Y,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{onClick:v,disabled:h.value.length===0||C.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},m(C.value?"Agregando...":`Agregar ${h.value.length} documento(s)`),9,Sr)])]),e("div",Fr,[e("div",Er,m(h.value.length)+" documento(s) seleccionado(s) ",1),e("div",Tr,[e("button",{onClick:Y,class:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center font-medium"}," Cancelar "),e("button",{onClick:v,disabled:h.value.length===0||C.value,class:"flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-center font-medium"},m(C.value?"Agregando...":"Agregar"),9,Ar)])])]),N.value&&U.value?(s(),o("div",Mr,[e("div",jr,[e("div",Pr,[e("div",Lr,[r(t(dt),{class:"h-5 w-5 text-gray-500"}),Br]),e("button",{type:"button",class:"text-gray-400 hover:text-gray-600 p-1 rounded-md hover:bg-gray-100",onClick:K},[r(t(Me),{class:"h-5 w-5"})])]),e("div",Rr,[zr,e("span",Ur,m(U.value.title||"Sin título"),1)]),e("div",Ir,[!U.value.tags||U.value.tags.length===0?(s(),o("div",Nr," Este documento no tiene etiquetas. ")):(s(),o("ul",Or,[(s(!0),o(ge,null,ye(U.value.tags,j=>(s(),o("li",{key:j.id,class:"flex items-center justify-between gap-2"},[e("div",qr,[e("span",{class:P(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",Q(j)])},m(j.name),3)]),j.description?(s(),o("span",Vr,m(j.description),1)):g("",!0)]))),128))]))]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end"},[e("button",{type:"button",class:"px-4 py-2 text-sm font-medium rounded-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-50",onClick:K}," Cerrar ")])])])):g("",!0)])])]}),_:1})):g("",!0)}},mt=a=>(St("data-v-d9a5a89f"),a=a(),Ft(),a),Wr={class:"folders-table"},Hr={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200",style:{"overflow-x":"visible","overflow-y":"hidden"}},Gr={class:"min-w-full divide-y divide-gray-200"},Zr=mt(()=>e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Carpeta "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documentos "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Creada "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1)),Kr={class:"bg-white divide-y divide-gray-200"},Yr=["onClick"],Jr={class:"px-6 py-4 whitespace-nowrap"},Xr={class:"flex items-center"},en={class:"flex-shrink-0 h-10 w-10"},tn={class:"ml-4"},sn={class:"text-sm font-medium text-gray-900"},on={class:"px-6 py-4 whitespace-nowrap"},an={class:"flex items-center gap-2"},rn={class:"text-sm text-gray-900"},nn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ln={class:"py-1"},dn=["onClick"],cn=["onClick"],un=["onClick"],mn=["onClick"],gn={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},pn=mt(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No tienes carpetas aún",-1)),hn=mt(()=>e("p",{class:"text-gray-600 mb-6"},"Crea tu primera carpeta para organizar tus documentos",-1)),fn={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},yn=mt(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No se encontraron carpetas",-1)),vn=mt(()=>e("p",{class:"text-gray-600"},"No hay carpetas que coincidan con tu búsqueda",-1)),bn={key:3,class:"flex justify-center items-center py-12"},xn=mt(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)),_n=[xn],wn={__name:"FoldersTable",props:{sortedFolders:{type:Array,required:!0},searchQuery:{type:String,default:""},isLoading:{type:Boolean,default:!1}},emits:["folder-click","edit-folder","delete-folder","add-documents","create-folder"],setup(a,{emit:$}){const i=a,u=$,D=b({}),_=b({}),h=b(!1),k=b(-1),y=B(()=>{if(!i.searchQuery.trim())return i.sortedFolders;const v=i.searchQuery.toLowerCase();return i.sortedFolders.filter(A=>A.name.toLowerCase().includes(v))}),C=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],W=v=>{if(v.color)return C.find(J=>J.name===v.color)||C[0];const A=v.id%C.length;return C[A]},N=v=>{if(!v)return"-";const A=new Date(v),Q=Math.abs(new Date-A),Z=Math.ceil(Q/(1e3*60*60*24));return Z===0?"Hoy":Z===1?"Ayer":Z<7?`Hace ${Z} días`:Z<30?`Hace ${Math.floor(Z/7)} semanas`:Z<365?`Hace ${Math.floor(Z/30)} meses`:A.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},U=v=>{u("folder-click",v)},te=v=>{u("edit-folder",v)},ie=v=>{u("delete-folder",v)},X=v=>{u("add-documents",v)},S=()=>{u("create-folder")},d=()=>h.value?y.value.length===1?"280px":y.value.length===2&&k.value===1?"340px":"280px":"auto",E=(v,A)=>{v&&(D.value[A]=v)},T=(v,A)=>{v&&(_.value[A]=v)},Y=(v,A)=>{h.value=!A,k.value=A?-1:v,A||setTimeout(()=>{const J=_.value[v];if(J){const Q=J.$el||J;if(Q&&Q.getBoundingClientRect){const Z=Q.getBoundingClientRect(),K=window.innerHeight;if(v===0){if(Z.bottom>K-20){const H=Z.bottom-K+40;window.scrollBy({top:H,behavior:"smooth"})}}else if(Z.bottom>K-10){const H=Z.bottom-K+30;window.scrollBy({top:H,behavior:"smooth"})}else if(Z.top<80){const H=Z.top-100;window.scrollBy({top:H,behavior:"smooth"})}}}},100)};return(v,A)=>(s(),o("div",Wr,[!a.isLoading&&y.value.length>0?(s(),o("div",Hr,[e("div",{class:"overflow-x-auto",style:Ge({minHeight:d(),overflowY:"visible"})},[e("table",Gr,[Zr,e("tbody",Kr,[(s(!0),o(ge,null,ye(y.value,(J,Q)=>{var Z,K;return s(),o("tr",{key:J.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:H=>U(J)},[e("td",Jr,[e("div",Xr,[e("div",en,[e("div",{class:"h-10 w-10 rounded-lg flex items-center justify-center",style:Ge({backgroundColor:W(J).hex+"20"})},[r(t(Ct),{class:"h-6 w-6",style:Ge({color:W(J).hex})},null,8,["style"])],4)]),e("div",tn,[e("div",sn,m(J.name),1)])])]),e("td",on,[e("div",an,[r(t(Qe),{class:"h-5 w-5 text-gray-400"}),e("span",rn,m(((Z=J.documents)==null?void 0:Z.length)||0)+" documento"+m((((K=J.documents)==null?void 0:K.length)||0)!==1?"s":""),1)])]),e("td",nn,m(N(J.created_at)),1),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:A[0]||(A[0]=he(()=>{},["stop"]))},[r(t(Ue),{as:"div",class:"relative inline-block text-left"},{default:M(({open:H})=>[r(t(Ie),{ref_for:!0,ref:G=>E(G,Q),onClick:G=>Y(Q,H),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:M(()=>[r(t(ut),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),r(t(Ne),{ref_for:!0,ref:G=>T(G,Q),class:P([y.value.length>2&&Q>0&&Q>=y.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:M(()=>[e("div",ln,[r(t(be),null,{default:M(({active:G})=>[e("a",{onClick:L=>U(J),class:P([G?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver carpeta ",10,dn)]),_:2},1024),r(t(be),null,{default:M(({active:G})=>[e("a",{onClick:L=>X(J),class:P([G?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Agregar documentos ",10,cn)]),_:2},1024),r(t(be),null,{default:M(({active:G})=>[e("a",{onClick:L=>te(J),class:P([G?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Editar ",10,un)]),_:2},1024),r(t(be),null,{default:M(({active:G})=>[e("a",{onClick:L=>ie(J),class:P([G?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Eliminar ",10,mn)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,Yr)}),128))])])],4)])):!a.isLoading&&a.sortedFolders.length===0?(s(),o("div",gn,[r(t(Ct),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),pn,hn,e("button",{onClick:S,class:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"},[r(t(Ke),{class:"w-5 h-5"}),ae(" Crear Primera Carpeta ")])])):!a.isLoading&&a.sortedFolders.length>0&&y.value.length===0?(s(),o("div",fn,[r(t(Ct),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),yn,vn])):g("",!0),a.isLoading?(s(),o("div",bn,_n)):g("",!0)]))}},$n=At(wn,[["__scopeId","data-v-d9a5a89f"]]),fs=a=>(St("data-v-e3f57445"),a=a(),Ft(),a),kn={class:"folder-management"},Cn={class:"mb-6"},Dn={class:"hidden sm:flex justify-between items-center"},Sn=fs(()=>e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Fn={class:"sm:hidden"},En=fs(()=>e("div",{class:"text-center mb-4"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1 px-2"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Tn={__name:"FolderManagement",props:{searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","navigate-to-main","navigate-to-document"],setup(a,{emit:$}){const i=a,u=$,D=Yt(),_=He(),h=et(),k=b(!1),y=b(null),C=b(null),W=b(!1),N=b(null),U=B(()=>D.isLoading),te=B(()=>D.sortedFolders);B(()=>h.currentUser),Ze(async()=>{await D.init(),await _.init()}),De(()=>i.searchQuery,()=>{}),De(()=>D.folders,L=>{var j,le;if(C.value&&L&&L.length>0){const fe=L.find(q=>q.id===C.value.id);fe&&((j=C.value.documents)!=null&&j.length,(le=fe.documents)!=null&&le.length,JSON.stringify(C.value)!==JSON.stringify(fe)&&(C.value={...fe}))}},{deep:!0});const ie=()=>{y.value=null,k.value=!0},X=L=>{y.value=L,k.value=!0},S=()=>{k.value=!1,y.value=null},d=()=>{S()},E=L=>{C.value=L},T=()=>{C.value=null},Y=async L=>{if(confirm(`¿Estás seguro de que quieres eliminar la carpeta "${L.name}"?`))try{await D.deleteFolder(L.id),ke(`Carpeta "${L.name}" eliminada correctamente`,"success")}catch(j){ke("Error al eliminar la carpeta","error"),console.error("Error deleting folder:",j)}},v=L=>{N.value=L,W.value=!0},A=async(L=!1)=>{if(W.value=!1,N.value=null,L&&C.value)try{await J()}catch(j){console.warn("Error refreshing folder after adding documents:",j)}},J=async()=>{if(C.value)try{await D.fetchFolder(C.value.id);const L=D.getFolderById(C.value.id);L&&(C.value={...L},console.log("✅ Selected folder refreshed successfully"))}catch(L){throw console.error("❌ Error refreshing selected folder:",L),L}},Q=async L=>{var j,le,fe;if(!(!N.value||L.length===0))try{const q=N.value.documents.map(re=>re.id).filter(re=>re!=null&&!isNaN(parseInt(re))).map(re=>parseInt(re)),O=L.filter(re=>re!=null&&!isNaN(parseInt(re))).map(re=>parseInt(re)),V=[...new Set([...q,...O])];if(console.log("Current document IDs:",q),console.log("Selected document IDs:",O),console.log("Updated document IDs:",V),V.some(re=>!Number.isInteger(re)||re<=0))throw new Error("IDs de documentos inválidos detectados");await D.updateFolder(N.value.id,{document_ids:V}),await A(!0),ke(`${O.length} documento(s) agregado(s) a la carpeta`,"success"),u("navigate-to-main")}catch(q){console.error("Error adding documents to folder:",q),console.error("Error details:",((j=q.response)==null?void 0:j.data)||q.message),(le=q.response)!=null&&le.status?ke(`Error al agregar documentos: ${((fe=q.response.data)==null?void 0:fe.detail)||q.message}`,"error"):ke("Error al agregar documentos a la carpeta","error")}},Z=async L=>{var le,fe,q;if(!C.value)return;const j=typeof L=="object"&&L!==null?L.documentId:L;try{const O=parseInt(j);if(!Number.isInteger(O)||O<=0)throw new Error("ID de documento inválido");const V=C.value.documents.map(re=>re.id).filter(re=>re!=null&&!isNaN(parseInt(re))).map(re=>parseInt(re)).filter(re=>re!==O);await D.updateFolder(C.value.id,{document_ids:V}),ke("Documento removido de la carpeta","success"),C.value=null,u("navigate-to-main")}catch(O){console.error("Error removing document from folder:",O),console.error("Error details:",((le=O.response)==null?void 0:le.data)||O.message),(fe=O.response)!=null&&fe.status?ke(`Error al remover documento: ${((q=O.response.data)==null?void 0:q.detail)||O.message}`,"error"):ke("Error al remover el documento de la carpeta","error")}},K=L=>{let j="legal-documents";L.state==="Published"||L.state==="Draft"?j="legal-documents":L.state==="PendingSignatures"?j="pending-signatures":L.state==="FullySigned"?j="signed-documents":L.state==="Progress"||L.state==="Completed"?j="my-documents":(L.state==="Rejected"||L.state==="Expired"||L.state==="Archived")&&(j="archived-documents"),C.value=null,u("navigate-to-document",{tab:j,searchQuery:L.title})},H=L=>{C.value=null,u("navigate-to-document",{tab:"legal-documents",searchQuery:L.title})},G=(L,j)=>{console.log("Document action:",L,j)};return(L,j)=>(s(),o("div",kn,[e("div",Cn,[e("div",Dn,[Sn,e("button",{onClick:ie,class:"inline-flex items-center gap-2 px-4 py-2.5 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md"},[r(t(Ke),{class:"w-5 h-5"}),ae(" Nueva Carpeta ")])]),e("div",Fn,[En,e("button",{onClick:ie,class:"w-full flex items-center justify-center gap-3 px-4 py-4 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium text-base"},[r(t(Ke),{class:"w-6 h-6"}),ae(" Nueva Carpeta ")])])]),r(t($n),{"sorted-folders":te.value,"search-query":a.searchQuery,"is-loading":U.value,onFolderClick:E,onEditFolder:X,onDeleteFolder:Y,onAddDocuments:v,onCreateFolder:ie},null,8,["sorted-folders","search-query","is-loading"]),r(t(xo),{"is-visible":k.value,"editing-folder":y.value,onClose:S,onSuccess:d},null,8,["is-visible","editing-folder"]),r(t(ea),{folder:C.value,onClose:T,onAddDocuments:v,onRemoveDocument:Z,onViewDocument:K,onUseDocument:H,onDocumentAction:G},null,8,["folder"]),r(t(Qr),{"is-visible":W.value,folder:N.value,onClose:A,onAddDocuments:Q},null,8,["is-visible","folder"])]))}},ns=At(Tn,[["__scopeId","data-v-e3f57445"]]);function An(a){return!a.variables||a.variables.length===0?!0:a.variables.every($=>$.name_es&&$.name_es.trim().length>0)}function kt(a,$){var D;if(!a.requires_signature||a.state!=="PendingSignatures"||!a.signatures||a.signatures.length===0)return!1;const i=(D=$==null?void 0:$.currentUser)==null?void 0:D.email,u=a.signatures.find(_=>_.signer_email===i);return!(!u||u.signed)}const Mn={lawyer:{getMenuOptions:(a,$,i)=>{let u;return $==="legal-documents"&&(a.state==="Draft"||a.state==="Published")?u=[{label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Actualizar nombre",action:"edit"},{label:"Editar documento",action:"editDocument"},{label:"Editar configuración de variables",action:"editForm"}]},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}]:u=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}],a.state!=="Draft"&&a.state!=="Published"&&u.splice(2,0,{label:"Administrar Asociaciones",action:"relationships"}),a.state==="Draft"?u.push({label:"Publicar",action:"publish",disabled:!An(a)}):a.state==="Published"&&u.push({label:"Mover a Borrador",action:"draft"}),(a.state==="Completed"||a.state==="Published")&&u.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),a.requires_signature&&(a.state==="PendingSignatures"||a.state==="FullySigned")&&(u.push({label:"Ver Firmas",action:"viewSignatures"}),kt(a,i)&&u.push({label:"Firmar documento",action:"sign"})),u}},signatures:{getMenuOptions:(a,$,i)=>{const u=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}],D=a.relationships_count&&a.relationships_count>0;return u.push({label:"Administrar Asociaciones",action:"relationships",disabled:!D}),a.requires_signature&&["PendingSignatures","FullySigned","Rejected","Expired"].includes(a.state)&&u.push({label:"Estado de las firmas",action:"viewSignatures"}),kt(a,i)&&u.push({label:"Firmar documento",action:"sign"}),a.state==="PendingSignatures"&&kt(a,i)&&u.push({label:"Rechazar documento",action:"reject"}),a.state==="FullySigned"&&u.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),a.state==="PendingSignatures"&&u.push({label:"Descargar PDF",action:"downloadPDF"}),a.state==="Rejected"&&Array.isArray(a.signatures)&&a.signatures.some(h=>h.rejection_comment)&&u.push({label:"Ver motivo del rechazo",action:"viewRejectionReason"}),u}},client:{getMenuOptions:(a,$,i)=>{var y,C,W,N;const u=[],D=((y=i==null?void 0:i.currentUser)==null?void 0:y.role)==="basic",_=((C=i==null?void 0:i.currentUser)==null?void 0:C.role)==="corporate_client"||((W=i==null?void 0:i.currentUser)==null?void 0:W.role)==="client",h=((N=i==null?void 0:i.currentUser)==null?void 0:N.role)==="lawyer",k=a.state==="Progress";if(a.state==="Completed"?(u.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Editar Formulario",action:"editForm"}]}),(_||D||h)&&u.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:D})):a.state==="Progress"?(u.push({label:"Completar",action:"editForm"}),(_||D||h)&&u.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:!0})):u.push({label:"Completar",action:"editForm"}),(a.state==="Completed"||a.state==="Progress")&&u.push({label:"Previsualizar",action:"preview"}),u.push({label:"Eliminar",action:"delete"}),D?u.push({label:"Gestionar Membrete",action:"letterhead",disabled:!0}):u.push({label:"Gestionar Membrete",action:"letterhead"}),u.push({label:"Administrar Asociaciones",action:"relationships",disabled:D||k}),a.requires_signature){const te=["PendingSignatures","FullySigned","Rejected","Expired"].includes(a.state);$!=="my-documents"&&te&&(u.push({label:"Ver Firmas",action:"viewSignatures"}),kt(a,i)&&u.push({label:"Firmar documento",action:"sign"}))}if(a.state==="Completed"||a.state==="Progress"){const U=a.state==="Completed";u.push({label:"Descargar PDF",action:"downloadPDF",disabled:!U},{label:"Descargar Word",action:"downloadWord",disabled:D||!U},{label:"Enviar",action:"email",disabled:D||!U})}return u}}};function jn(a,$,i="list",u=null){const D=Mn[a];return D?D.getMenuOptions($,i,u):[]}function ys(){const a=et(),$=B(()=>{var _;return((_=a.currentUser)==null?void 0:_.role)==="basic"}),i=_=>{ke("Esta funcionalidad está restringida para usuarios básicos. Por favor, contacta a tu abogado para obtener acceso completo.","warning")};return{isBasicUser:$,showRestrictionNotification:i,handleFeatureAccess:(_,h)=>$.value?(i(),!1):(h&&h(),!0),getRestrictedButtonClasses:_=>_?"opacity-60 cursor-not-allowed":""}}const Pn={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Ln={class:"px-6 py-4 border-b border-gray-200"},Bn=e("h2",{class:"text-xl font-semibold text-gray-800"},"Acciones del Documento",-1),Rn={class:"text-sm text-gray-500 mt-1"},zn={class:"p-6 overflow-y-auto flex-grow"},Un={class:"space-y-4"},In={key:0,class:"text-sm font-semibold text-gray-700 uppercase tracking-wide px-2"},Nn={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},On=["onClick","disabled"],qn={class:"text-sm font-medium"},Vn={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Qn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Wn={key:1,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Hn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Gn={key:2,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Zn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Kn={key:3,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Yn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Jn={key:4,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Xn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),el={key:1,class:"border-t border-gray-200 my-4"},tl={key:0,class:"text-center py-12"},sl=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay acciones disponibles",-1),ol=e("p",{class:"mt-1 text-sm text-gray-500"}," No hay opciones disponibles para este documento. ",-1),Bt={__name:"DocumentActionsModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null},cardType:{type:String,required:!0,validator:a=>["lawyer","client","signatures"].includes(a)},context:{type:String,default:"table"},userStore:{type:Object,default:null}},emits:["close","action"],setup(a,{emit:$}){const i=a,u=$,D=B(()=>i.document?jn(i.cardType,i.document,i.context,i.userStore):[]),_=B(()=>{const S=D.value;if(!S||S.length===0)return[];const d=[],E={edit:"Edición",view:"Visualización",share:"Compartir",manage:"Gestión",signatures:"Firmas",delete:"Eliminación"},T={edit:[],view:[],share:[],manage:[],signatures:[],delete:[]};return S.forEach(Y=>{if(Y.children&&Array.isArray(Y.children))Y.children.forEach(v=>{const A=v.action.toLowerCase();h(v,A,T)});else{const v=Y.action.toLowerCase();h(Y,v,T)}}),T.edit.length>0&&d.push({title:E.edit,options:T.edit}),T.view.length>0&&d.push({title:E.view,options:T.view}),T.share.length>0&&d.push({title:E.share,options:T.share}),T.signatures.length>0&&d.push({title:E.signatures,options:T.signatures}),T.manage.length>0&&d.push({title:E.manage,options:T.manage}),T.delete.length>0&&d.push({title:E.delete,options:T.delete}),d}),h=(S,d,E)=>{d.includes("edit")||d.includes("editar")||d==="copy"||d==="draft"||d==="publish"||d==="completar"?E.edit.push(S):d.includes("signature")||d.includes("firma")||d.includes("sign")||d==="reject"?E.signatures.push(S):d.includes("view")||d.includes("preview")||d.includes("ver")||d.includes("previsualización")?E.view.push(S):d.includes("download")||d.includes("email")||d.includes("enviar")||d.includes("descargar")?E.share.push(S):d.includes("permission")||d.includes("relationship")||d.includes("letterhead")||d.includes("permiso")||d.includes("asociación")||d.includes("membrete")||d==="formalize"?E.manage.push(S):d.includes("delete")||d.includes("eliminar")?E.delete.push(S):E.manage.push(S)},k=S=>{const d=S.toLowerCase();return d==="sign"||d.includes("firmar")?Dt:d==="editform"||d.includes("completar")?rs:d==="editdocument"||d.includes("editar documento")?ss:d.includes("edit")||d==="editar"?ss:d.includes("delete")||d==="eliminar"?Qt:d.includes("preview")||d.includes("ver")||d.includes("previsualización")?ms:d==="copy"||d.includes("copia")?As:d.includes("download")||d.includes("descargar")?it:d.includes("email")||d.includes("enviar")?Ds:d.includes("permission")||d.includes("permiso")?Rs:d.includes("relationship")||d.includes("asociación")?gs:d.includes("letterhead")||d.includes("membrete")?ps:d==="reject"||d.includes("rechazar")?qs:d.includes("signature")||d.includes("firma")?Dt:d==="publish"||d.includes("publicar")?Os:d==="draft"||d.includes("borrador")?Qe:d==="formalize"||d.includes("formalizar")?rs:dt},y=S=>{const d=S.toLowerCase();return d.includes("delete")||d==="eliminar"||d==="reject"||d.includes("rechazar")?"text-red-600":d==="sign"||d.includes("firmar")?"text-green-600":d.includes("download")||d.includes("descargar")?"text-blue-600":d.includes("email")||d.includes("enviar")?"text-green-600":d.includes("signature")||d.includes("firma")?"text-purple-600":"text-gray-600"},C=S=>{const d=S.toLowerCase();return d.includes("delete")||d==="eliminar"||d==="reject"||d.includes("rechazar")?"border-red-200 bg-red-50 text-red-700 hover:bg-red-100 hover:border-red-300":d==="sign"||d.includes("firmar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":d.includes("download")||d.includes("descargar")?"border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 hover:border-blue-300":d.includes("email")||d.includes("enviar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":d.includes("signature")||d.includes("firma")?"border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-100 hover:border-purple-300":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-300"},{isBasicUser:W,handleFeatureAccess:N}=ys(),U=["formalize","letterhead","relationships","downloadWord","email"],te=S=>{const d=S.toLowerCase();return U.some(E=>d===E.toLowerCase())},ie=S=>{const d=D.value.find(T=>T.action===S?T:T.children?T.children.find(Y=>Y.action===S):null),E=d!=null&&d.children?d.children.find(T=>T.action===S):d;if(E!=null&&E.disabled){N("Esta funcionalidad",null);return}u("action",S,i.document)},X=()=>{u("close")};return(S,d)=>Se((s(),ne(Xe,null,{default:M(()=>{var E;return[e("div",Pn,[e("div",Ln,[Bn,e("p",Rn,m(((E=a.document)==null?void 0:E.title)||"Cargando..."),1),e("button",{onClick:X,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500 transition-colors"},[r(t(Me),{class:"h-6 w-6"})])]),e("div",zn,[e("div",Un,[(s(!0),o(ge,null,ye(_.value,(T,Y)=>(s(),o("div",{key:Y,class:"space-y-2"},[T.title?(s(),o("h3",In,m(T.title),1)):g("",!0),e("div",Nn,[(s(!0),o(ge,null,ye(T.options,v=>{var A,J,Q;return s(),o("div",{key:v.action,class:"relative group"},[e("button",{onClick:Z=>ie(v.action),disabled:v.disabled,class:P(["flex items-center justify-start w-full px-4 py-3 rounded-lg border transition-all duration-200",v.disabled?"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed opacity-60":C(v.action),"hover:shadow-md hover:scale-[1.02]"])},[(s(),ne(Cs(k(v.action)),{class:P(["h-5 w-5 mr-3 flex-shrink-0",v.disabled?"text-gray-400":y(v.action)])},null,8,["class"])),e("span",qn,m(v.label),1),v.disabled?(s(),ne(t(js),{key:0,class:"h-4 w-4 ml-auto text-gray-400"})):g("",!0)],10,On),v.disabled&&v.action==="relationships"&&!t(W)&&((A=a.document)==null?void 0:A.state)==="Progress"?(s(),o("div",Vn,[ae(" Solo puedes administrar asociaciones cuando el documento está completado. "),Qn])):v.disabled&&v.action==="relationships"&&!t(W)?(s(),o("div",Wn,[ae(" Este documento no tiene documentos asociados. "),Hn])):v.disabled&&v.action==="formalize"&&((J=a.document)==null?void 0:J.state)!=="Completed"?(s(),o("div",Gn,[ae(" Solo puedes formalizar y agregar firmas cuando el documento está completado. "),Zn])):v.disabled&&["downloadPDF","downloadWord","email"].includes(v.action)&&((Q=a.document)==null?void 0:Q.state)!=="Completed"?(s(),o("div",Kn,[ae(" Solo puedes usar esta acción cuando el documento está completado. "),Yn])):v.disabled&&t(W)&&te(v.action)?(s(),o("div",Jn,[ae(" Actualiza tu suscripción para usar esta funcionalidad "),Xn])):g("",!0)])}),128))]),Y<_.value.length-1?(s(),o("div",el)):g("",!0)]))),128)),_.value.length===0?(s(),o("div",tl,[r(t(dt),{class:"mx-auto h-12 w-12 text-gray-400"}),sl,ol])):g("",!0)])])])]}),_:1},512)),[[vt,a.isVisible]])}},al={class:"bg-white rounded-xl shadow-xl max-w-lg w-full mx-4"},rl={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},nl=e("h2",{class:"text-sm font-semibold text-gray-900"}," Información clave del documento ",-1),ll=e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.8",d:"M6 6l8 8M6 14L14 6"})],-1),il=[ll],dl={class:"px-4 py-4 space-y-4 text-sm text-gray-800 max-h-[70vh] overflow-y-auto"},cl={key:0},ul=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Usuario / Contraparte ",-1),ml={class:"text-gray-900 break-words"},gl={key:1},pl=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Objeto ",-1),hl={class:"text-gray-900 whitespace-pre-line"},fl={key:2},yl=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Valor ",-1),vl={class:"text-gray-900 font-medium text-base"},bl={key:3},xl=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Plazo ",-1),_l={class:"text-gray-900"},wl={key:4},$l=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Fechas ",-1),kl={class:"space-y-1 text-gray-900"},Cl={key:0},Dl=e("span",{class:"font-medium"},"Suscripción:",-1),Sl={class:"ml-1"},Fl={key:1},El=e("span",{class:"font-medium"},"Vigencia:",-1),Tl={class:"ml-1"},Al={key:0},Ml={key:1},jl={key:2},Pl={key:5,class:"text-gray-400 text-sm"},Ll={class:"px-4 py-3 border-t border-gray-100 flex justify-end"},vs={__name:"DocumentSummaryModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close"],setup(a,{emit:$}){const i=a,u=B(()=>i.document&&i.document.summary_counterparty||""),D=B(()=>{if(!i.document||!i.document.summary_value)return"";const y=i.document.summary_value,C=i.document.summary_value_currency||"",W=new Intl.NumberFormat("es-CO",{minimumFractionDigits:0,maximumFractionDigits:2}).format(y);return C==="USD"?`USD $${W}`:C==="EUR"?`€${W}`:C==="COP"?`$${W} COP`:C?`${C} ${W}`:`$${W}`}),_=B(()=>i.document?!!(i.document.summary_subscription_date||i.document.summary_start_date||i.document.summary_end_date):!1),h=B(()=>i.document?!!(u.value||i.document.summary_object||D.value||i.document.summary_term||_.value):!1),k=y=>y?typeof y=="string"?y.split("T")[0]:y:"";return(y,C)=>a.isVisible&&a.document?(s(),o("div",{key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",onClick:C[2]||(C[2]=he(W=>y.$emit("close"),["self"]))},[e("div",al,[e("div",rl,[nl,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:C[0]||(C[0]=W=>y.$emit("close"))},il)]),e("div",dl,[u.value?(s(),o("div",cl,[ul,e("div",ml,m(u.value),1)])):g("",!0),a.document.summary_object?(s(),o("div",gl,[pl,e("div",hl,m(a.document.summary_object),1)])):g("",!0),D.value?(s(),o("div",fl,[yl,e("div",vl,m(D.value),1)])):g("",!0),a.document.summary_term?(s(),o("div",bl,[xl,e("div",_l,m(a.document.summary_term),1)])):g("",!0),_.value?(s(),o("div",wl,[$l,e("div",kl,[a.document.summary_subscription_date?(s(),o("div",Cl,[Dl,e("span",Sl,m(k(a.document.summary_subscription_date)),1)])):g("",!0),a.document.summary_start_date||a.document.summary_end_date?(s(),o("div",Fl,[El,e("span",Tl,[a.document.summary_start_date?(s(),o("span",Al,m(k(a.document.summary_start_date)),1)):g("",!0),a.document.summary_start_date&&a.document.summary_end_date?(s(),o("span",Ml," → ")):g("",!0),a.document.summary_end_date?(s(),o("span",jl,m(k(a.document.summary_end_date)),1)):g("",!0)])])):g("",!0)])])):g("",!0),h.value?g("",!0):(s(),o("div",Pl," Este documento aún no tiene campos clasificados para mostrar. "))]),e("div",Ll,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-md text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200",onClick:C[1]||(C[1]=W=>y.$emit("close"))}," Cerrar ")])])])):g("",!0)}},Bl={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},Rl={class:"mb-4"},zl={class:"relative w-full"},Ul={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},Il={class:"flex items-center gap-2 min-w-0"},Nl={class:"truncate"},Ol={class:"py-1"},ql=["onClick"],Vl={class:"flex items-center gap-2 min-w-0"},Ql={class:"truncate"},Wl={class:"p-2"},Hl={class:"relative mb-2"},Gl={class:"max-h-60 overflow-y-auto"},Zl=["onClick"],Kl={class:"truncate"},Yl={class:"flex items-center gap-2 min-w-0"},Jl={class:"truncate"},Xl={class:"p-2"},ei={class:"relative mb-2"},ti={class:"max-h-60 overflow-y-auto"},si=["onClick"],oi={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},ai={class:"flex flex-col gap-1"},ri=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),ni={class:"flex flex-col gap-1"},li=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),ii={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},di={class:"py-1"},ci=["onClick"],ui={class:"flex gap-2 w-full sm:w-auto"},mi=e("span",null,"Limpiar filtros",-1),gi={key:0,class:"flex justify-center items-center py-12 bg-white rounded-lg shadow-sm border border-gray-200"},pi=e("div",{class:"text-center"},[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e("p",{class:"text-sm text-gray-500"},"Cargando documentos...")],-1),hi=[pi],fi={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},yi={class:"overflow-x-auto"},vi={class:"min-w-full divide-y divide-gray-200"},bi={class:"bg-gray-50"},xi={key:0,scope:"col",class:"w-12 px-3 py-3"},_i=["checked"],wi=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento ",-1),$i=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),ki=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Contraparte ",-1),Ci=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Objeto ",-1),Di=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Valor ",-1),Si=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plazo ",-1),Fi=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fechas ",-1),Ei={key:1,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Ti=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas ",-1),Ai={class:"bg-white divide-y divide-gray-200"},Mi=["onClick"],ji={key:0,class:"px-3 py-4"},Pi=["checked","onChange"],Li={class:"px-6 py-4"},Bi={class:"flex items-center gap-3"},Ri={class:"min-w-0"},zi=["onClick"],Ui={class:"px-6 py-4 whitespace-nowrap"},Ii={class:"px-6 py-4 whitespace-nowrap"},Ni={class:"text-sm text-gray-900"},Oi={class:"px-6 py-4 whitespace-nowrap"},qi={class:"text-sm text-gray-900 line-clamp-2 max-w-xs"},Vi={class:"px-6 py-4 whitespace-nowrap"},Qi={class:"text-sm text-gray-900"},Wi={class:"px-6 py-4 whitespace-nowrap"},Hi={class:"text-sm text-gray-900"},Gi={class:"px-6 py-4 whitespace-nowrap"},Zi={class:"text-xs text-gray-900 space-y-0.5"},Ki={key:0},Yi=e("span",{class:"font-medium"},"Suscripción:",-1),Ji={class:"ml-1"},Xi={key:1},ed=e("span",{class:"font-medium"},"Vigencia:",-1),td={class:"ml-1"},sd={key:0},od={key:1},ad={key:2},rd={key:2,class:"text-gray-400"},nd={key:1,class:"px-6 py-4 whitespace-nowrap"},ld=["onClick"],id={key:1,class:"text-sm text-gray-400"},dd={class:"px-6 py-4"},cd={class:"flex flex-wrap gap-1"},ud=["onClick"],md={key:0,class:"bg-gray-50 px-4 py-3 border-t border-gray-200 sm:px-6"},gd={class:"flex items-center justify-between"},pd={class:"flex-1 flex justify-between sm:hidden"},hd=["disabled"],fd=["disabled"],yd={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},vd={class:"text-sm text-gray-700"},bd={class:"font-medium"},xd={class:"font-medium"},_d={class:"font-medium"},wd={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},$d=["disabled"],kd=["onClick"],Cd=["disabled"],Dd={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Sd=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos",-1),Fd={class:"mt-1 text-sm text-gray-500"},Ed={key:12,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4"},Td={class:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] flex flex-col"},Ad={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},Md={class:"flex items-center gap-2"},jd=e("h2",{class:"text-sm font-semibold text-gray-900"},"Etiquetas del documento",-1),Pd={class:"px-4 py-3 border-b border-gray-100 text-xs text-gray-500"},Ld=e("span",{class:"font-medium text-gray-700"},"Documento:",-1),Bd={class:"ml-1"},Rd={class:"px-4 py-3 overflow-y-auto"},zd={key:0,class:"text-sm text-gray-500"},Ud={key:1,class:"space-y-2 text-sm"},Id={class:"flex items-center gap-2 min-w-0"},Nd={key:0,class:"text-xs text-gray-500 truncate max-w-[8rem]"},qt={__name:"DocumentListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null},cardType:{type:String,default:"lawyer",validator:a=>["lawyer","client"].includes(a)},showStateFilter:{type:Boolean,default:!0},showClientFilter:{type:Boolean,default:!1},showAssociationsColumn:{type:Boolean,default:!0},availableStates:{type:Array,default:()=>["Draft","Published","Progress","PendingSignatures","Completed","FullySigned","Rejected","Expired"]},context:{type:String,default:"legal-documents"},isLoading:{type:Boolean,default:!1}},emits:["refresh","open-electronic-signature","update:searchQuery"],setup(a,{emit:$}){const i=He(),u=et(),D=ot(),_=a,h=$,{activeModals:k,openModal:y,closeModal:C}=Mt(i,u),W=B(()=>(k==null?void 0:k.value)||k||{}),N=B(()=>{const x=W.value;return(x==null?void 0:x.relationships)||{isOpen:!1,document:null}}),{handlePreviewDocument:U,deleteDocument:te,downloadPDFDocument:ie,downloadWordDocument:X,copyDocument:S,publishDocument:d,moveToDraft:E,formalizeDocument:T,signDocument:Y,downloadSignedDocument:v}=jt(i,u,h),A=b(""),J=b(""),Q=b(""),Z=b(null),K=b(null),H=b(null),G=b(""),L=b(""),j=b("recent"),le=b([]),fe=b(!1),q=b(null),O=b(!1),V=b(null),re=b(!1),_e=b(null),pe=b(1),we=b(20),Re=B(()=>_.cardType==="lawyer"&&_.context==="legal-documents");B(()=>!1);const ze=B(()=>{if(_.promptDocuments)return _.promptDocuments;const x=u.currentUser;return _.cardType==="lawyer"&&_.context==="legal-documents"?!(x!=null&&x.id)||typeof i.getDocumentsByLawyerId!="function"?[]:i.getDocumentsByLawyerId(x.id)||[]:_.cardType==="client"&&_.context==="my-documents"?!(x!=null&&x.id)||typeof i.progressAndCompletedDocumentsByClient!="function"?[]:i.progressAndCompletedDocumentsByClient(x.id)||[]:i.documents||[]}),qe=B(()=>{const x=new Map;return ze.value.forEach(p=>{var ce;(ce=p.tags)==null||ce.forEach(f=>{x.has(f.id)||x.set(f.id,f)})}),Array.from(x.values())}),ee=B(()=>{if(!J.value)return qe.value;const x=J.value.toLowerCase();return qe.value.filter(p=>p.name.toLowerCase().includes(x))}),de=B(()=>{if(!K.value)return null;const x=qe.value.find(p=>p.id===K.value);return(x==null?void 0:x.name)||null}),ue=B(()=>{if(_.cardType!=="lawyer")return[];const x=new Map;return ze.value.forEach(p=>{p.client&&x.set(p.client.id,p.client)}),Array.from(x.values())}),Fe=B(()=>{if(!Q.value)return ue.value;const x=Q.value.toLowerCase();return ue.value.filter(p=>`${p.first_name} ${p.last_name}`.toLowerCase().includes(x))}),je=B(()=>{if(!H.value)return null;const x=ue.value.find(p=>p.id===H.value);return x?`${x.first_name} ${x.last_name}`:null}),Ae=B(()=>!_.selectedTags||!_.selectedTags.length?[]:_.selectedTags.map(x=>typeof x=="object"?x.id:x)),c=B(()=>{let x=ze.value;const p=(A.value||"").toLowerCase();return p&&(x=x.filter(ce=>{var f,xe;return((f=ce.title)==null?void 0:f.toLowerCase().includes(p))||((xe=ce.code)==null?void 0:xe.toLowerCase().includes(p))})),Z.value&&(x=x.filter(ce=>ce.state===Z.value)),(G.value||L.value)&&(x=x.filter(ce=>{const f=ce.summary_subscription_date||ce.created_at||ce.updated_at;if(!f)return!1;const xe=new Date(f);if(isNaN(xe.getTime()))return!1;if(G.value){const Le=new Date(G.value);if(xe<Le)return!1}if(L.value){const Le=new Date(L.value);if(Le.setHours(23,59,59,999),xe>Le)return!1}return!0})),K.value&&(x=x.filter(ce=>{var f;return(f=ce.tags)==null?void 0:f.some(xe=>xe.id===K.value)})),Ae.value.length>0&&(x=x.filter(ce=>{var f;return(f=ce.tags)==null?void 0:f.some(xe=>Ae.value.includes(xe.id))})),H.value&&_.cardType==="lawyer"&&(x=x.filter(ce=>{var f;return((f=ce.client)==null?void 0:f.id)===H.value})),x}),n=()=>{Z.value=null,K.value=null,H.value=null,G.value="",L.value=""},l=B(()=>{if(_.cardType!=="lawyer"||_.context!=="legal-documents")return!1;const x=c.value;return x.length?x.every(p=>p.state==="Draft"||p.state==="Published"):!1}),R=B(()=>{const x=[...c.value];switch(j.value){case"recent":return x.sort((p,ce)=>new Date(ce.updated_at)-new Date(p.updated_at));case"oldest":return x.sort((p,ce)=>new Date(p.updated_at)-new Date(ce.updated_at));case"name-asc":return x.sort((p,ce)=>(p.title||"").localeCompare(ce.title||""));case"name-desc":return x.sort((p,ce)=>(ce.title||"").localeCompare(p.title||""));default:return x}}),z=B(()=>{const x=(pe.value-1)*we.value,p=x+we.value;return R.value.slice(x,p)}),oe=B(()=>Math.ceil(R.value.length/we.value)),Ve=B(()=>{const x=oe.value,p=pe.value,ce=[];if(x<=7)for(let f=1;f<=x;f++)ce.push(f);else if(p<=4){for(let f=1;f<=5;f++)ce.push(f);ce.push("..."),ce.push(x)}else if(p>=x-3){ce.push(1),ce.push("...");for(let f=x-4;f<=x;f++)ce.push(f)}else ce.push(1),ce.push("..."),ce.push(p-1),ce.push(p),ce.push(p+1),ce.push("..."),ce.push(x);return ce}),Ee=B(()=>z.value.length>0&&z.value.every(x=>le.value.includes(x.id))),Oe=[{value:"recent",label:"Más recientes"},{value:"oldest",label:"Más antiguos"},{value:"name-asc",label:"Nombre (A-Z)"},{value:"name-desc",label:"Nombre (Z-A)"}],tt=x=>{var p;return((p=Oe.find(ce=>ce.value===x))==null?void 0:p.label)||"Ordenar"},at=x=>({Draft:"Borrador",Published:"Publicado",Progress:"En Progreso",PendingSignatures:"Pendiente de Firmas",Completed:"Completado",FullySigned:"Firmado",Rejected:"Rechazado",Expired:"Expirado"})[x]||x,gt=x=>at(x.state),Rt=x=>({Draft:"bg-gray-100 text-gray-800",Published:"bg-blue-100 text-blue-800",Progress:"bg-yellow-100 text-yellow-800",PendingSignatures:"bg-orange-100 text-orange-800",Completed:"bg-green-100 text-green-800",FullySigned:"bg-purple-100 text-purple-800",Rejected:"bg-red-100 text-red-800",Expired:"bg-gray-100 text-gray-800"})[x.state]||"bg-gray-100 text-gray-800",zt=x=>({Draft:"text-gray-500",Published:"text-blue-600",Progress:"text-yellow-600",PendingSignatures:"text-orange-600",Completed:"text-green-600",FullySigned:"text-purple-600",Rejected:"text-red-600",Expired:"text-gray-500"})[x.state]||"text-gray-400",pt=x=>{if(x&&x.color)return{red:"bg-red-100 text-red-800",blue:"bg-blue-100 text-blue-800",green:"bg-green-100 text-green-800",yellow:"bg-yellow-100 text-yellow-800",purple:"bg-purple-100 text-purple-800",pink:"bg-pink-100 text-pink-800",indigo:"bg-indigo-100 text-indigo-800"}[x.color]||"bg-gray-100 text-gray-800";const p=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],ce=x&&typeof x.id=="number"?x.id%p.length:0;return p[ce]},rt=x=>x?new Date(x).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"-",Ut=x=>x.summary_counterparty||"",_t=x=>{if(!x.summary_value)return"";const p=x.summary_value_currency||"";return p?`${p} ${x.summary_value}`:x.summary_value},wt=x=>["Completed","FullySigned"].includes(x.state),It=x=>String(i.lastUpdatedDocumentId)===String(x),Nt=x=>{const p=le.value.indexOf(x);p>-1?le.value.splice(p,1):le.value.push(x)},I=x=>{_e.value=x,re.value=!0},F=()=>{re.value=!1,_e.value=null},se=()=>{if(Ee.value)le.value=le.value.filter(x=>!z.value.some(p=>p.id===x));else{const x=z.value.map(p=>p.id).filter(p=>!le.value.includes(p));le.value.push(...x)}},w=x=>{q.value=x,fe.value=!0},me=x=>{V.value=x,O.value=!0},ve=()=>{const x=le.value.length>0?R.value.filter(st=>le.value.includes(st.id)):R.value,p=["Nombre Minuta","Estado","Etiquetas"],ce=x.map(st=>[st.title||"",gt(st),st.tags?st.tags.map(Ot=>Ot.name).join(", "):""]),f=[p.join(","),...ce.map(st=>st.map(Ot=>`"${Ot}"`).join(","))].join(`
`),xe=new Blob([f],{type:"text/csv;charset=utf-8;"}),Le=document.createElement("a"),Je=URL.createObjectURL(xe);Le.setAttribute("href",Je),Le.setAttribute("download",`documentos_${new Date().toISOString().split("T")[0]}.csv`),Le.style.visibility="hidden",document.body.appendChild(Le),Le.click(),document.body.removeChild(Le)},Ce=async(x,p)=>{var ce,f;switch(x){case"preview":await U(p);break;case"edit":{const xe=((ce=u.currentUser)==null?void 0:ce.role)||"client";_.cardType==="lawyer"&&_.context==="legal-documents"?y("edit",p,{userRole:xe,renameOnly:!0}):y("edit",p,{userRole:xe})}break;case"editForm":if(_.cardType==="lawyer"&&_.context==="legal-documents")try{const xe=await i.fetchDocumentById(p.id,!0);i.selectedDocument=xe,D.push("/dynamic_document_dashboard/lawyer/variables-config")}catch(xe){console.error("Error al abrir la configuración de variables:",xe)}else y("edit",p,{userRole:"client"});break;case"editDocument":(((f=u.currentUser)==null?void 0:f.role)||"client")==="lawyer"&&_.cardType==="lawyer"?D.push(`/dynamic_document_dashboard/lawyer/editor/edit/${p.id}`):D.push(`/dynamic_document_dashboard/client/editor/edit/${p.id}`);break;case"permissions":y("permissions",p);break;case"relationships":y("relationships",p);break;case"letterhead":y("letterhead",p);break;case"viewSignatures":case"signatures":y("signatures",p);break;case"publish":await d(p);break;case"draft":case"move-to-draft":await E(p);break;case"formalize":await T(p);break;case"sign":await Y(p);break;case"delete":await te(p);break;case"downloadPDF":case"download-pdf":await ie(p);break;case"downloadWord":case"download-word":await X(p);break;case"downloadSignedDocument":case"download-signed":await v(p);break;case"email":case"send":y("email",p);break;case"copy":await S(p);break;default:console.warn("Unknown action:",x)}},$e=async(x,p)=>{O.value=!1,await Ce(x,p)},Pe=({documentId:x,count:p})=>{const ce=i.documents.find(f=>f.id===x);ce&&(ce.relationships_count=p)};return De(()=>R.value.length,()=>{pe.value>oe.value&&(pe.value=Math.max(1,oe.value))}),De(A,x=>{h("update:searchQuery",x??"")}),De(()=>_.searchQuery,x=>{x!=null&&(A.value=x)},{immediate:!0}),Ze(async()=>{_.promptDocuments||await i.init(),await u.init()}),(x,p)=>{var ce;return s(),o("div",null,[e("div",Bl,[e("div",Rl,[e("div",zl,[r(t(Ye),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Se(e("input",{"onUpdate:modelValue":p[0]||(p[0]=f=>A.value=f),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Te,A.value]])])]),e("div",Ul,[a.showStateFilter?(s(),ne(t(Ue),{key:0,as:"div",class:"relative"},{default:M(()=>[r(t(Ie),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[e("div",Il,[r(t(lt),{class:"h-4 w-4 flex-shrink-0"}),e("span",Nl,m(Z.value||"Estado"),1)]),r(t(We),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Ne),{class:"absolute left-0 z-10 mt-2 w-full min-w-[14rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",Ol,[r(t(be),null,{default:M(({active:f})=>[e("a",{onClick:p[1]||(p[1]=xe=>Z.value=null),class:P([f?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,ye(a.availableStates,f=>(s(),ne(t(be),{key:f},{default:M(({active:xe})=>[e("a",{onClick:Le=>Z.value=f,class:P([xe?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},m(at(f)),11,ql)]),_:2},1024))),128))])]),_:1})]),_:1})):g("",!0),r(t(Ue),{as:"div",class:"relative"},{default:M(()=>[r(t(Ie),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[e("div",Vl,[r(t(lt),{class:"h-4 w-4 flex-shrink-0"}),e("span",Ql,m(de.value||"Etiqueta"),1)]),r(t(We),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Ne),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",Wl,[e("div",Hl,[r(t(Ye),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Se(e("input",{"onUpdate:modelValue":p[2]||(p[2]=f=>J.value=f),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:p[3]||(p[3]=he(()=>{},["stop"]))},null,512),[[Te,J.value]])]),e("div",Gl,[r(t(be),null,{default:M(({active:f})=>[e("a",{onClick:p[4]||(p[4]=xe=>K.value=null),class:P([f?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,ye(ee.value,f=>(s(),ne(t(be),{key:f.id},{default:M(({active:xe})=>[e("a",{onClick:Le=>K.value=f.id,class:P([xe?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:P(["w-3 h-3 rounded-full flex-shrink-0",pt(f)])},null,2),e("span",Kl,m(f.name),1)],10,Zl)]),_:2},1024))),128))])])]),_:1})]),_:1}),a.showClientFilter?(s(),ne(t(Ue),{key:1,as:"div",class:"relative"},{default:M(()=>[r(t(Ie),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[e("div",Yl,[r(t(lt),{class:"h-4 w-4 flex-shrink-0"}),e("span",Jl,m(je.value||"Cliente"),1)]),r(t(We),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Ne),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",Xl,[e("div",ei,[r(t(Ye),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Se(e("input",{"onUpdate:modelValue":p[5]||(p[5]=f=>Q.value=f),type:"text",placeholder:"Buscar clientes...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:p[6]||(p[6]=he(()=>{},["stop"]))},null,512),[[Te,Q.value]])]),e("div",ti,[r(t(be),null,{default:M(({active:f})=>[e("a",{onClick:p[7]||(p[7]=xe=>H.value=null),class:P([f?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,ye(Fe.value,f=>(s(),ne(t(be),{key:f.id},{default:M(({active:xe})=>[e("a",{onClick:Le=>H.value=f.id,class:P([xe?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])},m(f.first_name)+" "+m(f.last_name),11,si)]),_:2},1024))),128))])])]),_:1})]),_:1})):g("",!0)]),e("div",oi,[e("div",ai,[ri,Se(e("input",{"onUpdate:modelValue":p[8]||(p[8]=f=>G.value=f),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Te,G.value]])]),e("div",ni,[li,Se(e("input",{"onUpdate:modelValue":p[9]||(p[9]=f=>L.value=f),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Te,L.value]])])]),e("div",ii,[r(t(Ue),{as:"div",class:"relative w-full sm:w-auto"},{default:M(()=>[r(t(Ie),{class:"w-full sm:w-auto inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[r(t(zs),{class:"h-4 w-4"}),e("span",null,m(tt(j.value)),1),r(t(We),{class:"h-4 w-4"})]),_:1}),r(t(Ne),{class:"absolute left-0 z-10 mt-2 w-56 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",di,[(s(),o(ge,null,ye(Oe,f=>r(t(be),{key:f.value},{default:M(({active:xe})=>[e("a",{onClick:Le=>j.value=f.value,class:P([xe?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},m(f.label),11,ci)]),_:2},1024)),64))])]),_:1})]),_:1}),e("div",ui,[le.value.length>0?(s(),o("button",{key:0,onClick:ve,class:"flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[r(t(it),{class:"h-4 w-4"}),e("span",null,"Exportar ("+m(le.value.length)+")",1)])):g("",!0),Z.value||K.value||H.value||G.value||L.value?(s(),o("button",{key:1,onClick:n,class:"flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-200 rounded-md bg-white text-xs font-medium text-gray-500 hover:bg-gray-50",title:"Limpiar filtros",type:"button"},[r(t(Me),{class:"h-4 w-4 flex-shrink-0"}),mi])):g("",!0)])])]),a.isLoading?(s(),o("div",gi,hi)):!a.isLoading&&z.value.length>0?(s(),o("div",fi,[e("div",yi,[e("table",vi,[e("thead",bi,[e("tr",null,[Re.value?(s(),o("th",xi,[e("input",{type:"checkbox",checked:Ee.value,onChange:se,class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded cursor-pointer"},null,40,_i)])):g("",!0),wi,$i,ki,Ci,Di,Si,Fi,a.showAssociationsColumn&&!l.value?(s(),o("th",Ei," Asociaciones ")):g("",!0),Ti])]),e("tbody",Ai,[(s(!0),o(ge,null,ye(z.value,f=>{var xe,Le;return s(),o("tr",{key:f.id,class:P(["hover:bg-gray-50 cursor-pointer transition-colors duration-150",It(f.id)?"bg-yellow-50":""]),onClick:Je=>me(f)},[Re.value?(s(),o("td",ji,[e("input",{type:"checkbox",checked:le.value.includes(f.id),onChange:he(Je=>Nt(f.id),["stop"]),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded cursor-pointer"},null,40,Pi)])):g("",!0),e("td",Li,[e("div",Bi,[r(t(Qe),{class:P(["h-5 w-5 flex-shrink-0",zt(f)])},null,8,["class"]),e("div",Ri,[e("button",{onClick:he(Je=>w(f),["stop"]),class:"text-sm font-medium text-gray-900 hover:text-secondary truncate block max-w-xs text-left"},m(f.title||"Sin título"),9,zi)])])]),e("td",Ui,[e("span",{class:P([Rt(f),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},m(gt(f)),3)]),e("td",Ii,[e("span",Ni,m(Ut(f)||"-"),1)]),e("td",Oi,[e("span",qi,m(f.summary_object||"-"),1)]),e("td",Vi,[e("span",Qi,m(_t(f)||"-"),1)]),e("td",Wi,[e("span",Hi,m(f.summary_term||"-"),1)]),e("td",Gi,[e("div",Zi,[f.summary_subscription_date?(s(),o("div",Ki,[Yi,e("span",Ji,m(rt(f.summary_subscription_date)),1)])):g("",!0),f.summary_start_date||f.summary_end_date?(s(),o("div",Xi,[ed,e("span",td,[f.summary_start_date?(s(),o("span",sd,m(rt(f.summary_start_date)),1)):g("",!0),f.summary_start_date&&f.summary_end_date?(s(),o("span",od," → ")):g("",!0),f.summary_end_date?(s(),o("span",ad,m(rt(f.summary_end_date)),1)):g("",!0)])])):g("",!0),!f.summary_subscription_date&&!f.summary_start_date&&!f.summary_end_date?(s(),o("span",rd," - ")):g("",!0)])]),a.showAssociationsColumn&&!l.value?(s(),o("td",nd,[wt(f)?(s(),o("button",{key:0,onClick:he(Je=>t(y)("relationships",f),["stop"]),class:"inline-flex items-center gap-1 text-sm text-secondary hover:text-blue-700"},[r(t(gs),{class:"h-4 w-4"}),e("span",null,m(f.relationships_count||0),1)],8,ld)):(s(),o("span",id,m(f.relationships_count||0),1))])):g("",!0),e("td",dd,[e("div",cd,[(s(!0),o(ge,null,ye((xe=f.tags)==null?void 0:xe.slice(0,2),Je=>(s(),o("span",{key:Je.id,class:P([pt(Je),"px-2 py-1 text-xs rounded-full"])},m(Je.name),3))),128)),((Le=f.tags)==null?void 0:Le.length)>2?(s(),o("button",{key:0,type:"button",class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 inline-flex items-center gap-1",onClick:he(Je=>I(f),["stop"])},[e("span",null,"+"+m(f.tags.length-2),1)],8,ud)):g("",!0)])])],10,Mi)}),128))])])]),oe.value>1?(s(),o("div",md,[e("div",gd,[e("div",pd,[e("button",{onClick:p[10]||(p[10]=f=>pe.value--),disabled:pe.value===1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Anterior ",8,hd),e("button",{onClick:p[11]||(p[11]=f=>pe.value++),disabled:pe.value===oe.value,class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Siguiente ",8,fd)]),e("div",yd,[e("div",null,[e("p",vd,[ae(" Mostrando "),e("span",bd,m((pe.value-1)*we.value+1),1),ae(" a "),e("span",xd,m(Math.min(pe.value*we.value,R.value.length)),1),ae(" de "),e("span",_d,m(R.value.length),1),ae(" resultados ")])]),e("div",null,[e("nav",wd,[e("button",{onClick:p[12]||(p[12]=f=>pe.value--),disabled:pe.value===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[r(t(Et),{class:"h-5 w-5"})],8,$d),(s(!0),o(ge,null,ye(Ve.value,f=>(s(),o("button",{key:f,onClick:xe=>typeof f=="number"?pe.value=f:null,class:P([f===pe.value?"z-10 bg-secondary border-secondary text-white":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50",typeof f=="string"?"cursor-default":"cursor-pointer","relative inline-flex items-center px-4 py-2 border text-sm font-medium"])},m(f),11,kd))),128)),e("button",{onClick:p[13]||(p[13]=f=>pe.value++),disabled:pe.value===oe.value,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[r(t(bt),{class:"h-5 w-5"})],8,Cd)])])])])])):g("",!0)])):!a.isLoading&&z.value.length===0?(s(),o("div",Dd,[r(t(Qe),{class:"mx-auto h-12 w-12 text-gray-400"}),Sd,e("p",Fd,m(_.promptDocuments?"No se encontraron documentos":"Comienza creando un nuevo documento"),1)])):g("",!0),t(nt)?(s(),ne(Gt,{key:3,"is-open":t(nt),document:t(Ht),onClose:p[14]||(p[14]=f=>nt.value=!1)},null,8,["is-open","document"])):g("",!0),t(k).edit.isOpen?(s(),ne(t(Zt),{key:4,"is-open":t(k).edit.isOpen,document:t(k).edit.document,"user-role":t(k).edit.userRole||((ce=t(u).currentUser)==null?void 0:ce.role)||"client","show-editor-button":!t(k).edit.renameOnly,onClose:p[15]||(p[15]=f=>t(C)("edit")),onRefresh:p[16]||(p[16]=f=>h("refresh"))},null,8,["is-open","document","user-role","show-editor-button"])):g("",!0),W.value.email.isOpen?(s(),ne(t(Kt),{key:5,"is-open":W.value.email.isOpen,document:W.value.email.document,onClose:p[17]||(p[17]=f=>t(C)("email")),onRefresh:p[18]||(p[18]=f=>h("refresh"))},null,8,["is-open","document"])):g("",!0),t(k).signatures.isOpen?(s(),ne(t(us),{key:6,"is-open":t(k).signatures.isOpen,document:t(k).signatures.document,onClose:p[19]||(p[19]=f=>t(C)("signatures")),onRefresh:p[20]||(p[20]=f=>h("refresh"))},null,8,["is-open","document"])):g("",!0),t(k).permissions.isOpen?(s(),ne(t(Ps),{key:7,"is-open":t(k).permissions.isOpen,document:t(k).permissions.document,onClose:p[21]||(p[21]=f=>t(C)("permissions")),onRefresh:p[22]||(p[22]=f=>h("refresh"))},null,8,["is-open","document"])):g("",!0),t(k).letterhead.isOpen?(s(),ne(Pt,{key:8,"is-visible":t(k).letterhead.isOpen,document:t(k).letterhead.document,onClose:p[23]||(p[23]=f=>t(C)("letterhead")),onRefresh:p[24]||(p[24]=f=>h("refresh"))},null,8,["is-visible","document"])):g("",!0),N.value.isOpen?(s(),ne(Tt,{key:9,"is-open":N.value.isOpen,document:N.value.document,onClose:p[25]||(p[25]=f=>t(C)("relationships")),onUpdateCount:Pe},null,8,["is-open","document"])):g("",!0),O.value?(s(),ne(Bt,{key:10,"is-visible":O.value,document:V.value,"card-type":a.cardType,context:_.context||"list","user-store":t(u),onClose:p[26]||(p[26]=f=>O.value=!1),onRefresh:p[27]||(p[27]=f=>h("refresh")),onAction:$e},null,8,["is-visible","document","card-type","context","user-store"])):g("",!0),fe.value?(s(),ne(vs,{key:11,"is-visible":fe.value,document:q.value,onClose:p[28]||(p[28]=f=>fe.value=!1)},null,8,["is-visible","document"])):g("",!0),re.value&&_e.value?(s(),o("div",Ed,[e("div",Td,[e("div",Ad,[e("div",Md,[r(t(Vt),{class:"h-5 w-5 text-gray-500"}),jd]),e("button",{type:"button",class:"text-gray-400 hover:text-gray-600 p-1 rounded-md hover:bg-gray-100",onClick:F},[r(t(Me),{class:"h-5 w-5"})])]),e("div",Pd,[Ld,e("span",Bd,m(_e.value.title||"Sin título"),1)]),e("div",Rd,[!_e.value.tags||_e.value.tags.length===0?(s(),o("div",zd," Este documento no tiene etiquetas. ")):(s(),o("ul",Ud,[(s(!0),o(ge,null,ye(_e.value.tags,f=>(s(),o("li",{key:f.id,class:"flex items-center justify-between gap-2"},[e("div",Id,[e("span",{class:P(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",pt(f)])},m(f.name),3)]),f.description?(s(),o("span",Nd,m(f.description),1)):g("",!0)]))),128))]))]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end"},[e("button",{type:"button",class:"px-4 py-2 text-sm font-medium rounded-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-50",onClick:F}," Cerrar ")])])])):g("",!0)])}}},Od={class:"mb-4"},qd={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},Vd={class:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"},Qd={class:"flex flex-col sm:flex-row gap-3 flex-1 w-full lg:w-auto"},Wd={class:"relative flex-1 min-w-[200px]"},Hd={class:"max-w-[120px] truncate"},Gd={class:"p-2"},Zd={class:"relative mb-2"},Kd={class:"max-h-60 overflow-y-auto"},Yd=["onClick"],Jd={class:"truncate"},Xd={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},ec={class:"flex items-center gap-3 w-full lg:w-auto"},tc={class:"text-sm text-gray-500 whitespace-nowrap"},sc={class:"py-1"},oc={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},ac={class:"min-w-full divide-y divide-gray-200"},rc=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plantilla "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),nc={class:"bg-white divide-y divide-gray-200"},lc=["onClick"],ic={class:"px-6 py-4 whitespace-nowrap"},dc={class:"flex items-center"},cc={class:"flex-shrink-0 h-10 w-10"},uc={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},mc={class:"ml-4"},gc={class:"text-sm font-medium text-gray-900"},pc=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-700 border border-purple-200"}," Disponible ")],-1),hc={class:"px-6 py-4 whitespace-nowrap"},fc={class:"flex flex-wrap gap-1"},yc={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},vc={key:1,class:"text-sm text-gray-400"},bc={class:"py-1"},xc=["onClick"],_c={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},wc=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay plantillas disponibles",-1),$c={class:"mt-1 text-sm text-gray-500"},kc=e("div",{class:"mt-4"},[e("div",{class:"text-xs text-gray-400 bg-gray-100 px-3 py-2 rounded-lg inline-block"},[ae(" 💡 "),e("strong",null,"Tip:"),ae(" Las plantillas son creadas por los abogados ")])],-1),ls={__name:"UseDocumentTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["go-back"],setup(a,{emit:$}){const i=He();et();const u=ot(),D=$,_=b(""),h=b(""),k=b(null),y=b("recent"),C=b(!1),W=b(null),N=b({}),U=b({}),te=b(!1),ie=b(-1),X=B(()=>i.publishedDocumentsUnassigned||[]),S=B(()=>{let q=[...X.value];const O=_.value.toLowerCase();return O&&(q=q.filter(V=>{var re,_e;return((re=V.title)==null?void 0:re.toLowerCase().includes(O))||((_e=V.tags)==null?void 0:_e.some(pe=>{var we;return(we=pe.name)==null?void 0:we.toLowerCase().includes(O)}))})),k.value&&(q=q.filter(V=>V.tags&&V.tags.some(re=>re.id===k.value))),y.value==="name"?q.sort((V,re)=>{const _e=(V.title||"").toLowerCase(),pe=(re.title||"").toLowerCase();return _e.localeCompare(pe)}):y.value==="recent"&&q.sort((V,re)=>re.id-V.id),q}),d=B(()=>{const q=new Map;return X.value.forEach(O=>{O.tags&&O.tags.length>0&&O.tags.forEach(V=>{q.has(V.id)||q.set(V.id,V)})}),Array.from(q.values()).sort((O,V)=>O.name.localeCompare(V.name))}),E=B(()=>{if(!h.value)return d.value;const q=h.value.toLowerCase();return d.value.filter(O=>O.name.toLowerCase().includes(q))}),T=B(()=>{if(!k.value)return null;const q=d.value.find(O=>O.id===k.value);return q?q.name:null}),Y=B(()=>{switch(y.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),v=B(()=>{const q=_.value&&_.value.trim().length>0,O=k.value!==null;return q&&O?"No se encontraron plantillas que coincidan con tu búsqueda y filtros":q?"No se encontraron plantillas que coincidan con tu búsqueda":O?"No se encontraron plantillas con la etiqueta seleccionada":"Aún no hay plantillas disponibles para usar"}),A=q=>{const O=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],V=q.id%O.length;return O[V]},J=q=>{const O=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],V=q.id%O.length;return O[V]},Q=()=>{k.value=null},Z=q=>{q&&(i.selectedDocument=null,W.value=q,C.value=!0)},K=()=>{C.value=!1,W.value=null},H=q=>{if(q.state==="Published"&&!q.assigned_to)Z(q.id);else{const V=`/dynamic_document_dashboard/document/use/editor/${q.id}/${encodeURIComponent(q.title.trim())}`;u.push(V)}},G=()=>{D("go-back")};Ze(async()=>{(!i.documents||i.documents.length===0)&&await i.init(!0)});const L=()=>te.value?S.value.length===1?"280px":S.value.length===2&&ie.value===1?"340px":"280px":"auto",j=(q,O)=>{q&&(N.value[O]=q)},le=(q,O)=>{q&&(U.value[O]=q)},fe=(q,O)=>{te.value=!O,ie.value=O?-1:q,O||setTimeout(()=>{const V=U.value[q];if(V){const re=V.$el||V;if(re&&re.getBoundingClientRect){const _e=re.getBoundingClientRect(),pe=window.innerHeight;if(q===0){if(_e.bottom>pe-20){const we=_e.bottom-pe+40;window.scrollBy({top:we,behavior:"smooth"})}}else if(_e.bottom>pe-10){const we=_e.bottom-pe+30;window.scrollBy({top:we,behavior:"smooth"})}else if(_e.top<80){const we=_e.top-100;window.scrollBy({top:we,behavior:"smooth"})}}}},100)};return(q,O)=>(s(),o("div",null,[e("div",Od,[e("button",{onClick:G,class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors border border-gray-300"},[r(t(Us),{class:"h-4 w-4"}),ae(" Volver a Mis Documentos ")])]),e("div",qd,[e("div",Vd,[e("div",Qd,[e("div",Wd,[r(t(Ye),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Se(e("input",{"onUpdate:modelValue":O[0]||(O[0]=V=>_.value=V),type:"text",placeholder:"Buscar plantillas...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent"},null,512),[[Te,_.value]])]),r(t(Ue),{as:"div",class:"relative"},{default:M(()=>[r(t(Ie),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[r(t(lt),{class:"h-4 w-4"}),e("span",Hd,m(T.value||"Etiqueta"),1),r(t(We),{class:"h-4 w-4"})]),_:1}),r(t(Ne),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",Gd,[e("div",Zd,[r(t(Ye),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Se(e("input",{"onUpdate:modelValue":O[1]||(O[1]=V=>h.value=V),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:O[2]||(O[2]=he(()=>{},["stop"]))},null,512),[[Te,h.value]])]),e("div",Kd,[r(t(be),null,{default:M(({active:V})=>[e("a",{onClick:O[3]||(O[3]=re=>k.value=null),class:P([V?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,ye(E.value,V=>(s(),ne(t(be),{key:V.id},{default:M(({active:re})=>[e("a",{onClick:_e=>k.value=V.id,class:P([re?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:P(["w-3 h-3 rounded-full flex-shrink-0",J(V)])},null,2),e("span",Jd,m(V.name),1)],10,Yd)]),_:2},1024))),128)),E.value.length===0?(s(),o("div",Xd," No se encontraron etiquetas ")):g("",!0)])])]),_:1})]),_:1}),k.value?(s(),o("button",{key:0,onClick:Q,class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[r(t(Me),{class:"h-4 w-4"}),ae(" Limpiar ")])):g("",!0)]),e("div",ec,[e("span",tc," Mostrando "+m(S.value.length)+" plantillas ",1),r(t(Ue),{as:"div",class:"relative"},{default:M(()=>[r(t(Ie),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[ae(" Ordenar: "+m(Y.value)+" ",1),r(t(We),{class:"h-4 w-4"})]),_:1}),r(t(Ne),{class:"absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",sc,[r(t(be),null,{default:M(({active:V})=>[e("a",{onClick:O[4]||(O[4]=re=>y.value="recent"),class:P([V?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),r(t(be),null,{default:M(({active:V})=>[e("a",{onClick:O[5]||(O[5]=re=>y.value="name"),class:P([V?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),S.value.length>0?(s(),o("div",oc,[e("div",{class:"overflow-x-auto",style:Ge({minHeight:L()})},[e("table",ac,[rc,e("tbody",nc,[(s(!0),o(ge,null,ye(S.value,(V,re)=>{var _e;return s(),o("tr",{key:V.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:pe=>H(V)},[e("td",ic,[e("div",dc,[e("div",cc,[e("div",uc,[r(t(Qe),{class:"h-5 w-5 text-purple-600"})])]),e("div",mc,[e("div",gc,m(V.title),1)])])]),pc,e("td",hc,[e("div",fc,[(s(!0),o(ge,null,ye((_e=V.tags)==null?void 0:_e.slice(0,2),pe=>(s(),o("span",{key:pe.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",A(pe)])},m(pe.name),3))),128)),V.tags&&V.tags.length>2?(s(),o("span",yc," +"+m(V.tags.length-2),1)):g("",!0),!V.tags||V.tags.length===0?(s(),o("span",vc,"-")):g("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:O[6]||(O[6]=he(()=>{},["stop"]))},[r(t(Ue),{as:"div",class:"relative inline-block text-left"},{default:M(({open:pe})=>[r(t(Ie),{ref_for:!0,ref:we=>j(we,re),onClick:we=>fe(re,pe),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:M(()=>[r(t(ut),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),r(t(Ne),{ref_for:!0,ref:we=>le(we,re),class:P([S.value.length>2&&re>0&&re>=S.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:M(()=>[e("div",bc,[r(t(be),null,{default:M(({active:we})=>[e("a",{onClick:Re=>H(V),class:P([we?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Usar plantilla ",10,xc)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,lc)}),128))])])],4)])):(s(),o("div",_c,[r(t(Lt),{class:"mx-auto h-12 w-12 text-gray-400"}),wc,e("p",$c,m(v.value),1),kc])),Se(r(Xe,null,{default:M(()=>[W.value!==null?(s(),ne(hs,{key:0,"document-id":W.value,onClose:K},null,8,["document-id"])):g("",!0)]),_:1},512),[[vt,C.value]])]))}},Cc={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},Dc={class:"mb-4"},Sc={class:"relative w-full"},Fc={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},Ec={class:"flex items-center gap-2 min-w-0"},Tc={class:"truncate"},Ac={class:"py-1"},Mc=["onClick"],jc={class:"flex items-center justify-stretch"},Pc=e("span",null,"Limpiar",-1),Lc={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},Bc={class:"flex flex-col gap-1"},Rc=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),zc={class:"flex flex-col gap-1"},Uc=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),Ic={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},Nc={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Oc={class:"flex items-center gap-2"},qc=e("span",{class:"hidden sm:inline"},"Exportar",-1),Vc={class:"py-1"},Qc=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),Wc={class:"py-1"},Hc={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Gc={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Zc={class:"min-w-full divide-y divide-gray-200"},Kc={class:"bg-gray-50"},Yc={scope:"col",class:"w-12 px-6 py-3"},Jc=["checked"],Xc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),eu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),tu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),su=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Docs. Asociados ",-1),ou=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),au={class:"bg-white divide-y divide-gray-200"},ru=["onClick"],nu=["checked","onChange"],lu={class:"px-6 py-4 whitespace-nowrap"},iu={class:"flex items-center"},du={class:"flex-shrink-0 h-10 w-10"},cu={class:"h-10 w-10 rounded-lg bg-green-100 flex items-center justify-center"},uu={class:"ml-4"},mu={class:"text-sm font-medium text-gray-900"},gu={class:"px-6 py-4 whitespace-nowrap"},pu={class:"text-sm text-gray-900"},hu=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-700 border border-green-200"}," Completado ")],-1),fu={class:"px-6 py-4 whitespace-nowrap"},yu=["onClick"],vu={class:"px-6 py-4 whitespace-nowrap"},bu={class:"flex flex-wrap gap-1"},xu={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},_u={key:1,class:"text-sm text-gray-400"},wu={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},$u={class:"flex flex-1 justify-between sm:hidden"},ku=["disabled"],Cu=["disabled"],Du={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Su={class:"text-sm text-gray-700"},Fu={class:"font-medium"},Eu={class:"font-medium"},Tu={class:"font-medium"},Au={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Mu=["disabled"],ju=e("span",{class:"sr-only"},"Anterior",-1),Pu=["onClick"],Lu={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},Bu=["disabled"],Ru=e("span",{class:"sr-only"},"Siguiente",-1),zu={key:0,class:"text-center py-12"},Uu=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos completados",-1),Iu=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos completados por clientes aparecerán aquí.",-1),Nu={__name:"DocumentFinishedByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(a,{emit:$}){const i=He(),u=et(),D=ot(),_=a,h=$,{activeModals:k,openModal:y,closeModal:C,getUserRole:W}=Mt(i,u),{handlePreviewDocument:N,deleteDocument:U,downloadPDFDocument:te,downloadWordDocument:ie}=jt(i,u,h),X=b(""),S=b(null),d=b(""),E=b(""),T=b("recent"),Y=b([]),v=b(1),A=b(10);Ze(()=>{i.init(),u.init()});const J=B(()=>{const c=i.completedDocumentsByClient,n=_.selectedTags?_.selectedTags.map(R=>R.id):[];return i.filteredDocumentsBySearchAndTags(_.searchQuery,u,n).filter(R=>c.some(z=>z.id===R.id))}),Q=B(()=>{let c=[...J.value];const n=X.value.toLowerCase();return n&&(c=c.filter(l=>{var R,z;return((R=l.title)==null?void 0:R.toLowerCase().includes(n))||((z=l.tags)==null?void 0:z.some(oe=>{var Ve;return(Ve=oe.name)==null?void 0:Ve.toLowerCase().includes(n)}))})),S.value&&(c=c.filter(l=>l.tags&&l.tags.some(R=>R.id===S.value))),(d.value||E.value)&&(c=c.filter(l=>{const R=l.summary_subscription_date||l.created_at||l.updated_at;if(!R)return!1;const z=new Date(R);if(isNaN(z.getTime()))return!1;if(d.value){const oe=new Date(d.value);if(z<oe)return!1}if(E.value){const oe=new Date(E.value);if(oe.setHours(23,59,59,999),z>oe)return!1}return!0})),T.value==="name"?c.sort((l,R)=>{const z=(l.title||"").toLowerCase(),oe=(R.title||"").toLowerCase();return z.localeCompare(oe)}):T.value==="recent"&&c.sort((l,R)=>{const z=new Date(l.updated_at||l.created_at);return new Date(R.updated_at||R.created_at)-z}),c}),Z=B(()=>{const c=(v.value-1)*A.value,n=c+A.value;return Q.value.slice(c,n)}),K=B(()=>Math.ceil(Q.value.length/A.value)),H=B(()=>{const c=(v.value-1)*A.value+1,n=Math.min(v.value*A.value,Q.value.length);return{start:c,end:n,total:Q.value.length}});De([X,S,d,E],()=>{v.value=1});const G=B(()=>{const c=new Map;return J.value.forEach(n=>{n.tags&&n.tags.length>0&&n.tags.forEach(l=>{c.has(l.id)||c.set(l.id,l)})}),Array.from(c.values()).sort((n,l)=>n.name.localeCompare(l.name))}),L=B(()=>{if(!S.value)return null;const c=G.value.find(n=>n.id===S.value);return c?c.name:null}),j=B(()=>{switch(T.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),le=c=>c.summary_counterparty?c.summary_counterparty:"Cliente",fe=c=>{const n=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],l=c.id%n.length;return n[l]},q=B(()=>Q.value.length>0&&Y.value.length===Q.value.length),O=()=>{q.value?Y.value=[]:Y.value=Q.value.map(c=>c.id)},V=c=>{const n=Y.value.indexOf(c);n>-1?Y.value.splice(n,1):Y.value.push(c)},re=()=>{Y.value=Q.value.map(c=>c.id)},_e=()=>{Y.value=[]},pe=()=>{S.value=null,d.value="",E.value=""},we=()=>{v.value>1&&v.value--},Re=()=>{v.value<K.value&&v.value++},ze=c=>{c>=1&&c<=K.value&&(v.value=c)},qe=B(()=>{const c=K.value,n=v.value,l=[];if(c<=7)for(let R=1;R<=c;R++)l.push(R);else if(n<=4){for(let R=1;R<=5;R++)l.push(R);l.push("..."),l.push(c)}else if(n>=c-3){l.push(1),l.push("...");for(let R=c-4;R<=c;R++)l.push(R)}else l.push(1),l.push("..."),l.push(n-1),l.push(n),l.push(n+1),l.push("..."),l.push(c);return l}),ee=()=>{const c=Y.value.length>0?Q.value.filter(Ee=>Y.value.includes(Ee.id)):Q.value,n=["Nombre Documento","Cliente","Estado","Etiquetas"],l=c.map(Ee=>[Ee.title||"",le(Ee),"Completado",Ee.tags?Ee.tags.map(Oe=>Oe.name).join(", "):""]),R=[n.join(","),...l.map(Ee=>Ee.map(Oe=>`"${Oe}"`).join(","))].join(`
`),z=new Blob([R],{type:"text/csv;charset=utf-8;"}),oe=document.createElement("a"),Ve=URL.createObjectURL(z);oe.setAttribute("href",Ve),oe.setAttribute("download",`documentos_completados_${new Date().toISOString().split("T")[0]}.csv`),oe.style.visibility="hidden",document.body.appendChild(oe),oe.click(),document.body.removeChild(oe)},de=async(c,n)=>{try{switch(c){case"editForm":y("edit",n,{userRole:W()});break;case"editDocument":D.push(`/dynamic_document_dashboard/client/editor/edit/${n.id}`);break;case"preview":await N(n);break;case"delete":await U(n);break;case"letterhead":y("letterhead",n);break;case"relationships":y("relationships",n);break;case"downloadPDF":await te(n);break;case"downloadWord":await ie(n);break;case"email":y("email",n);break;default:console.warn("Unknown action:",c)}}catch(l){console.error(`Error executing action ${c}:`,l)}},ue=b(!1),Fe=b(null),je=c=>{Fe.value=c,ue.value=!0},Ae=async(c,n)=>{ue.value=!1,await de(c,n)};return(c,n)=>(s(),o("div",null,[e("div",Cc,[e("div",Dc,[e("div",Sc,[r(t(Ye),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Se(e("input",{"onUpdate:modelValue":n[0]||(n[0]=l=>X.value=l),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Te,X.value]])])]),e("div",Fc,[r(t(Ue),{as:"div",class:"relative"},{default:M(()=>[r(t(Ie),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[e("div",Ec,[r(t(lt),{class:"h-4 w-4 flex-shrink-0"}),e("span",Tc,m(L.value||"Etiqueta"),1)]),r(t(We),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Ne),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:M(()=>[e("div",Ac,[r(t(be),null,{default:M(({active:l})=>[e("a",{onClick:n[1]||(n[1]=R=>S.value=null),class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,ye(G.value,l=>(s(),ne(t(be),{key:l.id},{default:M(({active:R})=>[e("a",{onClick:z=>S.value=l.id,class:P([R?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},m(l.name),11,Mc)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",jc,[S.value||d.value||E.value?(s(),o("button",{key:0,onClick:pe,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[r(t(Me),{class:"h-4 w-4 flex-shrink-0"}),Pc])):g("",!0)])]),e("div",Lc,[e("div",Bc,[Rc,Se(e("input",{"onUpdate:modelValue":n[2]||(n[2]=l=>d.value=l),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Te,d.value]])]),e("div",zc,[Uc,Se(e("input",{"onUpdate:modelValue":n[3]||(n[3]=l=>E.value=l),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Te,E.value]])])]),e("div",Ic,[e("div",Nc,[e("div",Oc,[e("button",{onClick:ee,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[r(t(it),{class:"h-4 w-4"}),qc]),r(t(Ue),{as:"div",class:"relative"},{default:M(()=>[r(t(Ie),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:M(()=>[r(t(ut),{class:"h-5 w-5 text-gray-500"})]),_:1}),r(t(Ne),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",Vc,[r(t(be),null,{default:M(({active:l})=>[e("a",{onClick:re,class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),r(t(be),null,{default:M(({active:l})=>[e("a",{onClick:_e,class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),r(t(Ue),{as:"div",class:"relative"},{default:M(()=>[r(t(Ie),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[Qc,ae(" "+m(j.value)+" ",1),r(t(We),{class:"h-4 w-4"})]),_:1}),r(t(Ne),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",Wc,[r(t(be),null,{default:M(({active:l})=>[e("a",{onClick:n[4]||(n[4]=R=>T.value="recent"),class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),r(t(be),null,{default:M(({active:l})=>[e("a",{onClick:n[5]||(n[5]=R=>T.value="name"),class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Hc,[e("div",Gc,[e("table",Zc,[e("thead",Kc,[e("tr",null,[e("th",Yc,[e("input",{type:"checkbox",checked:q.value,onChange:O,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Jc)]),Xc,eu,tu,su,ou])]),e("tbody",au,[(s(!0),o(ge,null,ye(Z.value,(l,R)=>{var z;return s(),o("tr",{key:l.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:oe=>je(l)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:n[6]||(n[6]=he(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:Y.value.includes(l.id),onChange:oe=>V(l.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,nu)]),e("td",lu,[e("div",iu,[e("div",du,[e("div",cu,[r(t(Qe),{class:"h-5 w-5 text-green-600"})])]),e("div",uu,[e("div",mu,m(l.title),1)])])]),e("td",gu,[e("div",pu,m(le(l)),1)]),hu,e("td",fu,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100",onClick:he(oe=>t(y)("relationships",l),["stop"])}," Ver asociaciones ",8,yu)]),e("td",vu,[e("div",bu,[(s(!0),o(ge,null,ye((z=l.tags)==null?void 0:z.slice(0,2),oe=>(s(),o("span",{key:oe.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",fe(oe)])},m(oe.name),3))),128)),l.tags&&l.tags.length>2?(s(),o("span",xu," +"+m(l.tags.length-2),1)):g("",!0),!l.tags||l.tags.length===0?(s(),o("span",_u,"-")):g("",!0)])])],8,ru)}),128))])])]),K.value>1?(s(),o("div",wu,[e("div",$u,[e("button",{onClick:we,disabled:v.value===1,class:P(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",v.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,ku),e("button",{onClick:Re,disabled:v.value===K.value,class:P(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",v.value===K.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Cu)]),e("div",Du,[e("div",null,[e("p",Su,[ae(" Mostrando "),e("span",Fu,m(H.value.start),1),ae(" a "),e("span",Eu,m(H.value.end),1),ae(" de "),e("span",Tu,m(H.value.total),1),ae(" resultados ")])]),e("div",null,[e("nav",Au,[e("button",{onClick:we,disabled:v.value===1,class:P(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",v.value===1?"opacity-50 cursor-not-allowed":""])},[ju,r(t(Et),{class:"h-5 w-5","aria-hidden":"true"})],10,Mu),(s(!0),o(ge,null,ye(qe.value,l=>(s(),o(ge,{key:l},[l!=="..."?(s(),o("button",{key:0,onClick:R=>ze(l),class:P(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",v.value===l?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},m(l),11,Pu)):(s(),o("span",Lu," ... "))],64))),128)),e("button",{onClick:Re,disabled:v.value===K.value,class:P(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",v.value===K.value?"opacity-50 cursor-not-allowed":""])},[Ru,r(t(bt),{class:"h-5 w-5","aria-hidden":"true"})],10,Bu)])])])])):g("",!0)]),Q.value.length===0?(s(),o("div",zu,[r(t(Lt),{class:"mx-auto h-12 w-12 text-gray-400"}),Uu,Iu])):g("",!0),(s(),ne(Wt,{to:"body"},[t(k).edit.isOpen?(s(),ne(t(Zt),{key:0,document:t(k).edit.document,"user-role":t(W)(),onClose:n[7]||(n[7]=l=>t(C)("edit")),onRefresh:n[8]||(n[8]=l=>h("refresh"))},null,8,["document","user-role"])):g("",!0),t(k).email.isOpen?(s(),ne(t(Kt),{key:1,document:t(k).email.document,onClose:n[9]||(n[9]=l=>t(C)("email"))},null,8,["document"])):g("",!0),t(k).letterhead.isOpen?(s(),ne(Pt,{key:2,"is-visible":t(k).letterhead.isOpen,document:t(k).letterhead.document,onClose:n[10]||(n[10]=l=>t(C)("letterhead")),onUploaded:n[11]||(n[11]=l=>h("refresh")),onDeleted:n[12]||(n[12]=l=>h("refresh"))},null,8,["is-visible","document"])):g("",!0),t(k).relationships.isOpen?(s(),ne(Tt,{key:3,"is-open":t(k).relationships.isOpen,document:t(k).relationships.document,onClose:n[13]||(n[13]=l=>t(C)("relationships")),onRefresh:n[14]||(n[14]=l=>h("refresh"))},null,8,["is-open","document"])):g("",!0),ue.value?(s(),ne(Bt,{key:4,"is-visible":ue.value,document:Fe.value,"card-type":"client",context:"table","user-store":t(u),onClose:n[15]||(n[15]=l=>ue.value=!1),onAction:Ae},null,8,["is-visible","document","user-store"])):g("",!0)]))]))}},Ou={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},qu={class:"mb-4"},Vu={class:"relative w-full"},Qu={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},Wu={class:"flex items-center gap-2 min-w-0"},Hu={class:"truncate"},Gu={class:"py-1"},Zu=["onClick"],Ku={class:"flex items-center justify-stretch"},Yu=e("span",null,"Limpiar",-1),Ju={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},Xu={class:"flex flex-col gap-1"},em=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),tm={class:"flex flex-col gap-1"},sm=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),om={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},am={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},rm={class:"flex items-center gap-2"},nm=e("span",{class:"hidden sm:inline"},"Exportar",-1),lm={class:"py-1"},im=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),dm={class:"py-1"},cm={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},um={class:"overflow-x-auto",style:{"overflow-y":"visible"}},mm={class:"min-w-full divide-y divide-gray-200"},gm={class:"bg-gray-50"},pm={scope:"col",class:"w-12 px-6 py-3"},hm=["checked"],fm=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),ym=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),vm=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),bm=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Docs. Asociados ",-1),xm=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),_m={class:"bg-white divide-y divide-gray-200"},wm=["onClick"],$m=["checked","onChange"],km={class:"px-6 py-4 whitespace-nowrap"},Cm={class:"flex items-center"},Dm={class:"flex-shrink-0 h-10 w-10"},Sm={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Fm={class:"ml-4"},Em={class:"text-sm font-medium text-gray-900"},Tm={class:"px-6 py-4 whitespace-nowrap"},Am={class:"text-sm text-gray-900"},Mm=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-700 border border-blue-200"}," En Progreso ")],-1),jm={class:"px-6 py-4 whitespace-nowrap"},Pm=["onClick"],Lm={class:"px-6 py-4 whitespace-nowrap"},Bm={class:"flex flex-wrap gap-1"},Rm={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},zm={key:1,class:"text-sm text-gray-400"},Um={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Im={class:"flex flex-1 justify-between sm:hidden"},Nm=["disabled"],Om=["disabled"],qm={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Vm={class:"text-sm text-gray-700"},Qm={class:"font-medium"},Wm={class:"font-medium"},Hm={class:"font-medium"},Gm={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Zm=["disabled"],Km=e("span",{class:"sr-only"},"Anterior",-1),Ym=["onClick"],Jm={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},Xm=["disabled"],e0=e("span",{class:"sr-only"},"Siguiente",-1),t0={key:0,class:"text-center py-12"},s0=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos en progreso",-1),o0=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos en progreso por clientes aparecerán aquí.",-1),a0={__name:"DocumentInProgressByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(a,{emit:$}){const i=He(),u=et(),D=ot(),_=a,h=$,{activeModals:k,openModal:y,closeModal:C,getUserRole:W}=Mt(i,u),{handlePreviewDocument:N,deleteDocument:U,downloadPDFDocument:te,downloadWordDocument:ie}=jt(i,u,h),X=b(""),S=b(null),d=b(""),E=b(""),T=b("recent"),Y=b([]),v=b(1),A=b(10);Ze(()=>{i.init(),u.init()});const J=B(()=>{const c=i.progressDocumentsByClient,n=_.selectedTags?_.selectedTags.map(R=>R.id):[];return i.filteredDocumentsBySearchAndTags(_.searchQuery,u,n).filter(R=>c.some(z=>z.id===R.id))}),Q=B(()=>{let c=[...J.value];const n=X.value.toLowerCase();return n&&(c=c.filter(l=>{var R,z;return((R=l.title)==null?void 0:R.toLowerCase().includes(n))||((z=l.tags)==null?void 0:z.some(oe=>{var Ve;return(Ve=oe.name)==null?void 0:Ve.toLowerCase().includes(n)}))})),S.value&&(c=c.filter(l=>l.tags&&l.tags.some(R=>R.id===S.value))),(d.value||E.value)&&(c=c.filter(l=>{const R=l.summary_subscription_date||l.created_at||l.updated_at;if(!R)return!1;const z=new Date(R);if(isNaN(z.getTime()))return!1;if(d.value){const oe=new Date(d.value);if(z<oe)return!1}if(E.value){const oe=new Date(E.value);if(oe.setHours(23,59,59,999),z>oe)return!1}return!0})),T.value==="name"?c.sort((l,R)=>{const z=(l.title||"").toLowerCase(),oe=(R.title||"").toLowerCase();return z.localeCompare(oe)}):T.value==="recent"&&c.sort((l,R)=>{const z=new Date(l.updated_at||l.created_at);return new Date(R.updated_at||R.created_at)-z}),c}),Z=B(()=>{const c=(v.value-1)*A.value,n=c+A.value;return Q.value.slice(c,n)}),K=B(()=>Math.ceil(Q.value.length/A.value)),H=B(()=>{const c=(v.value-1)*A.value+1,n=Math.min(v.value*A.value,Q.value.length);return{start:c,end:n,total:Q.value.length}});De([X,S,d,E],()=>{v.value=1});const G=B(()=>{const c=new Map;return J.value.forEach(n=>{n.tags&&n.tags.length>0&&n.tags.forEach(l=>{c.has(l.id)||c.set(l.id,l)})}),Array.from(c.values()).sort((n,l)=>n.name.localeCompare(l.name))}),L=B(()=>{if(!S.value)return null;const c=G.value.find(n=>n.id===S.value);return c?c.name:null}),j=B(()=>{switch(T.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),le=c=>c.summary_counterparty?c.summary_counterparty:"Cliente",fe=c=>{const n=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],l=c.id%n.length;return n[l]},q=B(()=>Q.value.length>0&&Y.value.length===Q.value.length),O=()=>{q.value?Y.value=[]:Y.value=Q.value.map(c=>c.id)},V=c=>{const n=Y.value.indexOf(c);n>-1?Y.value.splice(n,1):Y.value.push(c)},re=()=>{Y.value=Q.value.map(c=>c.id)},_e=()=>{Y.value=[]},pe=()=>{S.value=null,d.value="",E.value=""},we=()=>{v.value>1&&v.value--},Re=()=>{v.value<K.value&&v.value++},ze=c=>{c>=1&&c<=K.value&&(v.value=c)},qe=B(()=>{const c=K.value,n=v.value,l=[];if(c<=7)for(let R=1;R<=c;R++)l.push(R);else if(n<=4){for(let R=1;R<=5;R++)l.push(R);l.push("..."),l.push(c)}else if(n>=c-3){l.push(1),l.push("...");for(let R=c-4;R<=c;R++)l.push(R)}else l.push(1),l.push("..."),l.push(n-1),l.push(n),l.push(n+1),l.push("..."),l.push(c);return l}),ee=()=>{const c=Y.value.length>0?Q.value.filter(Ee=>Y.value.includes(Ee.id)):Q.value,n=["Nombre Documento","Cliente","Estado","Etiquetas"],l=c.map(Ee=>[Ee.title||"",le(Ee),"En Progreso",Ee.tags?Ee.tags.map(Oe=>Oe.name).join(", "):""]),R=[n.join(","),...l.map(Ee=>Ee.map(Oe=>`"${Oe}"`).join(","))].join(`
`),z=new Blob([R],{type:"text/csv;charset=utf-8;"}),oe=document.createElement("a"),Ve=URL.createObjectURL(z);oe.setAttribute("href",Ve),oe.setAttribute("download",`documentos_en_progreso_${new Date().toISOString().split("T")[0]}.csv`),oe.style.visibility="hidden",document.body.appendChild(oe),oe.click(),document.body.removeChild(oe)},de=async(c,n)=>{try{switch(c){case"editForm":y("edit",n,{userRole:W()});break;case"editDocument":D.push(`/dynamic_document_dashboard/client/editor/edit/${n.id}`);break;case"preview":await N(n);break;case"delete":await U(n);break;case"letterhead":y("letterhead",n);break;case"relationships":y("relationships",n);break;case"downloadPDF":await te(n);break;case"downloadWord":await ie(n);break;case"email":y("email",n);break;default:console.warn("Unknown action:",c)}}catch(l){console.error(`Error executing action ${c}:`,l)}},ue=b(!1),Fe=b(null),je=c=>{Fe.value=c,ue.value=!0},Ae=async(c,n)=>{ue.value=!1,await de(c,n)};return(c,n)=>(s(),o("div",null,[e("div",Ou,[e("div",qu,[e("div",Vu,[r(t(Ye),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Se(e("input",{"onUpdate:modelValue":n[0]||(n[0]=l=>X.value=l),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Te,X.value]])])]),e("div",Qu,[r(t(Ue),{as:"div",class:"relative"},{default:M(()=>[r(t(Ie),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[e("div",Wu,[r(t(lt),{class:"h-4 w-4 flex-shrink-0"}),e("span",Hu,m(L.value||"Etiqueta"),1)]),r(t(We),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Ne),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:M(()=>[e("div",Gu,[r(t(be),null,{default:M(({active:l})=>[e("a",{onClick:n[1]||(n[1]=R=>S.value=null),class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,ye(G.value,l=>(s(),ne(t(be),{key:l.id},{default:M(({active:R})=>[e("a",{onClick:z=>S.value=l.id,class:P([R?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},m(l.name),11,Zu)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",Ku,[S.value||d.value||E.value?(s(),o("button",{key:0,onClick:pe,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[r(t(Me),{class:"h-4 w-4 flex-shrink-0"}),Yu])):g("",!0)])]),e("div",Ju,[e("div",Xu,[em,Se(e("input",{"onUpdate:modelValue":n[2]||(n[2]=l=>d.value=l),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Te,d.value]])]),e("div",tm,[sm,Se(e("input",{"onUpdate:modelValue":n[3]||(n[3]=l=>E.value=l),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Te,E.value]])])]),e("div",om,[e("div",am,[e("div",rm,[e("button",{onClick:ee,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[r(t(it),{class:"h-4 w-4"}),nm]),r(t(Ue),{as:"div",class:"relative"},{default:M(()=>[r(t(Ie),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:M(()=>[r(t(ut),{class:"h-5 w-5 text-gray-500"})]),_:1}),r(t(Ne),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",lm,[r(t(be),null,{default:M(({active:l})=>[e("a",{onClick:re,class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),r(t(be),null,{default:M(({active:l})=>[e("a",{onClick:_e,class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),r(t(Ue),{as:"div",class:"relative"},{default:M(()=>[r(t(Ie),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[im,ae(" "+m(j.value)+" ",1),r(t(We),{class:"h-4 w-4"})]),_:1}),r(t(Ne),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",dm,[r(t(be),null,{default:M(({active:l})=>[e("a",{onClick:n[4]||(n[4]=R=>T.value="recent"),class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),r(t(be),null,{default:M(({active:l})=>[e("a",{onClick:n[5]||(n[5]=R=>T.value="name"),class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",cm,[e("div",um,[e("table",mm,[e("thead",gm,[e("tr",null,[e("th",pm,[e("input",{type:"checkbox",checked:q.value,onChange:O,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,hm)]),fm,ym,vm,bm,xm])]),e("tbody",_m,[(s(!0),o(ge,null,ye(Z.value,(l,R)=>{var z;return s(),o("tr",{key:l.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:oe=>je(l)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:n[6]||(n[6]=he(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:Y.value.includes(l.id),onChange:oe=>V(l.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,$m)]),e("td",km,[e("div",Cm,[e("div",Dm,[e("div",Sm,[r(t(Qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",Fm,[e("div",Em,m(l.title),1)])])]),e("td",Tm,[e("div",Am,m(le(l)),1)]),Mm,e("td",jm,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100",onClick:he(oe=>t(y)("relationships",l),["stop"])}," Ver asociaciones ",8,Pm)]),e("td",Lm,[e("div",Bm,[(s(!0),o(ge,null,ye((z=l.tags)==null?void 0:z.slice(0,2),oe=>(s(),o("span",{key:oe.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",fe(oe)])},m(oe.name),3))),128)),l.tags&&l.tags.length>2?(s(),o("span",Rm," +"+m(l.tags.length-2),1)):g("",!0),!l.tags||l.tags.length===0?(s(),o("span",zm,"-")):g("",!0)])])],8,wm)}),128))])])]),K.value>1?(s(),o("div",Um,[e("div",Im,[e("button",{onClick:we,disabled:v.value===1,class:P(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",v.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,Nm),e("button",{onClick:Re,disabled:v.value===K.value,class:P(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",v.value===K.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Om)]),e("div",qm,[e("div",null,[e("p",Vm,[ae(" Mostrando "),e("span",Qm,m(H.value.start),1),ae(" a "),e("span",Wm,m(H.value.end),1),ae(" de "),e("span",Hm,m(H.value.total),1),ae(" resultados ")])]),e("div",null,[e("nav",Gm,[e("button",{onClick:we,disabled:v.value===1,class:P(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",v.value===1?"opacity-50 cursor-not-allowed":""])},[Km,r(t(Et),{class:"h-5 w-5","aria-hidden":"true"})],10,Zm),(s(!0),o(ge,null,ye(qe.value,l=>(s(),o(ge,{key:l},[l!=="..."?(s(),o("button",{key:0,onClick:R=>ze(l),class:P(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",v.value===l?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},m(l),11,Ym)):(s(),o("span",Jm," ... "))],64))),128)),e("button",{onClick:Re,disabled:v.value===K.value,class:P(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",v.value===K.value?"opacity-50 cursor-not-allowed":""])},[e0,r(t(bt),{class:"h-5 w-5","aria-hidden":"true"})],10,Xm)])])])])):g("",!0)]),Q.value.length===0?(s(),o("div",t0,[r(t(Lt),{class:"mx-auto h-12 w-12 text-gray-400"}),s0,o0])):g("",!0),(s(),ne(Wt,{to:"body"},[t(k).edit.isOpen?(s(),ne(t(Zt),{key:0,document:t(k).edit.document,"user-role":t(W)(),onClose:n[7]||(n[7]=l=>t(C)("edit")),onRefresh:n[8]||(n[8]=l=>h("refresh"))},null,8,["document","user-role"])):g("",!0),t(k).email.isOpen?(s(),ne(t(Kt),{key:1,document:t(k).email.document,onClose:n[9]||(n[9]=l=>t(C)("email"))},null,8,["document"])):g("",!0),t(k).letterhead.isOpen?(s(),ne(Pt,{key:2,"is-visible":t(k).letterhead.isOpen,document:t(k).letterhead.document,onClose:n[10]||(n[10]=l=>t(C)("letterhead")),onUploaded:n[11]||(n[11]=l=>h("refresh")),onDeleted:n[12]||(n[12]=l=>h("refresh"))},null,8,["is-visible","document"])):g("",!0),t(k).relationships.isOpen?(s(),ne(Tt,{key:3,"is-open":t(k).relationships.isOpen,document:t(k).relationships.document,onClose:n[13]||(n[13]=l=>t(C)("relationships")),onRefresh:n[14]||(n[14]=l=>h("refresh"))},null,8,["is-open","document"])):g("",!0),ue.value?(s(),ne(Bt,{key:4,"is-visible":ue.value,document:Fe.value,"card-type":"client",context:"table","user-store":t(u),onClose:n[15]||(n[15]=l=>ue.value=!1),onAction:Ae},null,8,["is-visible","document","user-store"])):g("",!0)]))]))}},r0={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},n0={class:"mb-4"},l0={class:"relative w-full"},i0={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},d0={class:"flex items-center gap-2 min-w-0"},c0={class:"truncate"},u0={class:"p-2"},m0={class:"relative mb-2"},g0={class:"max-h-60 overflow-y-auto"},p0=["onClick"],h0={class:"truncate"},f0={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},y0={class:"flex items-center justify-stretch"},v0=e("span",null,"Limpiar",-1),b0={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},x0={class:"flex flex-col gap-1"},_0=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),w0={class:"flex flex-col gap-1"},$0=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),k0={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},C0={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},D0={class:"flex items-center gap-2"},S0=e("span",{class:"hidden sm:inline"},"Exportar",-1),F0={class:"py-1"},E0=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),T0={class:"py-1"},A0={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},M0={class:"overflow-x-auto",style:{"overflow-y":"visible"}},j0={class:"min-w-full divide-y divide-gray-200"},P0={class:"bg-gray-50"},L0={scope:"col",class:"w-12 px-6 py-3"},B0=["checked"],R0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),z0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado Firma ",-1),U0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Contraparte ",-1),I0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Objeto ",-1),N0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Valor ",-1),O0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plazo ",-1),q0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fechas ",-1),V0={key:0,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Q0={key:1,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},W0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),H0={class:"bg-white divide-y divide-gray-200"},G0=["onClick"],Z0=["checked","onChange"],K0={class:"px-6 py-4 whitespace-nowrap"},Y0={class:"flex items-center"},J0={class:"flex-shrink-0 h-10 w-10"},X0={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},eg={class:"ml-4"},tg={class:"text-sm font-medium text-gray-900"},sg={class:"px-6 py-4 whitespace-nowrap"},og={class:"px-6 py-4 whitespace-nowrap"},ag={class:"text-sm text-gray-900"},rg={class:"px-6 py-4 whitespace-nowrap"},ng={class:"text-sm text-gray-900 line-clamp-2 max-w-xs"},lg={class:"px-6 py-4 whitespace-nowrap"},ig={class:"text-sm text-gray-900"},dg={class:"px-6 py-4 whitespace-nowrap"},cg={class:"text-sm text-gray-900"},ug={class:"px-6 py-4 whitespace-nowrap"},mg={class:"text-xs text-gray-900 space-y-0.5"},gg={key:0},pg=e("span",{class:"font-medium"},"Suscripción:",-1),hg={class:"ml-1"},fg={key:1},yg=e("span",{class:"font-medium"},"Vigencia:",-1),vg={class:"ml-1"},bg={key:0},xg={key:1},_g={key:2},wg={key:2,class:"text-gray-400"},$g={key:0,class:"px-6 py-4 whitespace-nowrap"},kg={key:0,class:"text-sm text-gray-900"},Cg={key:1,class:"text-sm text-gray-400"},Dg={key:1,class:"px-6 py-4 whitespace-nowrap"},Sg=["disabled","onClick"],Fg={key:0},Eg={key:1},Tg={class:"px-6 py-4 whitespace-nowrap"},Ag={class:"flex flex-wrap gap-1"},Mg={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},jg={key:1,class:"text-sm text-gray-400"},Pg={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Lg={class:"flex flex-1 justify-between sm:hidden"},Bg=["disabled"],Rg=["disabled"],zg={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Ug={class:"text-sm text-gray-700"},Ig={class:"font-medium"},Ng={class:"font-medium"},Og={class:"font-medium"},qg={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Vg=["disabled"],Qg=e("span",{class:"sr-only"},"Anterior",-1),Wg=["onClick"],Hg={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},Gg=["disabled"],Zg=e("span",{class:"sr-only"},"Siguiente",-1),Kg={key:0,class:"text-center py-12"},Yg={class:"mt-2 text-sm font-medium text-gray-900"},Jg={class:"mt-1 text-sm text-gray-500"},Xg={key:1,class:"text-center py-12"},ep=e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-secondary"},null,-1),tp=e("p",{class:"mt-2 text-sm text-gray-500"},"Cargando documentos...",-1),sp=[ep,tp],op={key:5,class:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40"},ap={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4"},rp={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},np=e("h2",{class:"text-sm font-semibold text-gray-900"},"Rechazar documento",-1),lp={class:"px-4 py-4 space-y-3 text-sm text-gray-700"},ip={class:"font-semibold"},dp=e("p",{class:"text-xs text-gray-500"}," El rechazo devolverá el documento al abogado creador para que pueda revisarlo, editarlo o archivarlo. ",-1),cp=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Motivo del rechazo (opcional) ",-1),up={key:6,class:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40"},mp={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4"},gp={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},pp=e("h2",{class:"text-sm font-semibold text-gray-900"},"Motivo del rechazo",-1),hp={class:"px-4 py-4 text-sm text-gray-700 whitespace-pre-line"},fp={class:"px-4 py-3 border-t border-gray-100 flex justify-end bg-gray-50"},ct={__name:"SignaturesListTable",props:{state:{type:String,required:!0,validator:a=>["PendingSignatures","FullySigned","Archived"].includes(a)},searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","document-fully-signed","document-rejected","open-electronic-signature"],setup(a,{expose:$,emit:i}){const u=a,D=i,_=et(),h=He();ot();const{activeModals:k,openModal:y,closeModal:C,getUserRole:W}=Mt(h,_),{handlePreviewDocument:N,downloadPDFDocument:U,signDocument:te,downloadSignedDocument:ie}=jt(h,_,D);b([]);const X=b(!1),S=b(""),d=b(""),E=b(null),T=b(""),Y=b(""),v=b("recent"),A=b([]),J=b(!1),Q=b(null),Z=b(1),K=b(10),H=B(()=>u.state==="PendingSignatures"?"No tienes documentos pendientes por firmar":u.state==="FullySigned"?"No tienes documentos firmados":"No tienes documentos archivados"),G=B(()=>u.state==="PendingSignatures"?"Cuando tengas documentos que requieran tu firma electrónica aparecerán aquí.":u.state==="FullySigned"?"Una vez que firmes documentos electrónicamente, aparecerán aquí.":"Aquí aparecerán los documentos rechazados o expirados relacionados contigo."),L=B(()=>{const I=_.currentUser.role,F=_.currentUser.id,se=_.currentUser.email;let w=[];return I==="lawyer"?u.state==="PendingSignatures"?w=h.pendingSignatureDocuments.filter(me=>{var $e;const ve=me.created_by===F,Ce=($e=me.signatures)==null?void 0:$e.some(Pe=>Pe.signer_email===se);return ve||Ce}):u.state==="FullySigned"?w=h.fullySignedDocuments.filter(me=>{var $e;const ve=me.created_by===F,Ce=($e=me.signatures)==null?void 0:$e.some(Pe=>Pe.signer_email===se&&Pe.signed);return ve||Ce}):u.state==="Archived"&&(w=h.documents.filter(me=>{var $e;if(me.state!=="Rejected"&&me.state!=="Expired")return!1;const ve=me.created_by===F,Ce=($e=me.signatures)==null?void 0:$e.some(Pe=>Pe.signer_email===se);return ve||Ce})):u.state==="PendingSignatures"?w=h.documents.filter(me=>{var $e;if(me.state!=="PendingSignatures")return!1;const ve=($e=me.signatures)==null?void 0:$e.some(Pe=>Pe.signer_email===se),Ce=me.created_by===F;return ve||Ce}):u.state==="FullySigned"?w=h.documents.filter(me=>{var $e;if(me.state!=="FullySigned")return!1;const ve=($e=me.signatures)==null?void 0:$e.some(Pe=>Pe.signer_email===se&&Pe.signed),Ce=me.created_by===F;return ve||Ce}):u.state==="Archived"&&(w=h.documents.filter(me=>{var $e;if(me.state!=="Rejected"&&me.state!=="Expired")return!1;const ve=($e=me.signatures)==null?void 0:$e.some(Pe=>Pe.signer_email===se),Ce=me.created_by===F;return ve||Ce})),w}),j=B(()=>{let I=[...L.value];const F=S.value.toLowerCase();return F&&(I=I.filter(se=>{var w,me;return((w=se.title)==null?void 0:w.toLowerCase().includes(F))||((me=se.tags)==null?void 0:me.some(ve=>{var Ce;return(Ce=ve.name)==null?void 0:Ce.toLowerCase().includes(F)}))})),E.value&&(I=I.filter(se=>se.tags&&se.tags.some(w=>w.id===E.value))),(T.value||Y.value)&&(I=I.filter(se=>{const w=se.summary_subscription_date||se.created_at||se.updated_at;if(!w)return!1;const me=new Date(w);if(isNaN(me.getTime()))return!1;if(T.value){const ve=new Date(T.value);if(me<ve)return!1}if(Y.value){const ve=new Date(Y.value);if(ve.setHours(23,59,59,999),me>ve)return!1}return!0})),v.value==="name"?I.sort((se,w)=>{const me=(se.title||"").toLowerCase(),ve=(w.title||"").toLowerCase();return me.localeCompare(ve)}):v.value==="recent"&&I.sort((se,w)=>{const me=new Date(se.updated_at||se.created_at);return new Date(w.updated_at||w.created_at)-me}),I}),le=B(()=>{const I=(Z.value-1)*K.value,F=I+K.value;return j.value.slice(I,F)}),fe=B(()=>Math.ceil(j.value.length/K.value)),q=B(()=>{const I=(Z.value-1)*K.value+1,F=Math.min(Z.value*K.value,j.value.length);return{start:I,end:F,total:j.value.length}});De([S,E,T,Y],()=>{Z.value=1});const O=B(()=>{const I=new Map;return L.value.forEach(F=>{F.tags&&F.tags.length>0&&F.tags.forEach(se=>{I.has(se.id)||I.set(se.id,se)})}),Array.from(I.values()).sort((F,se)=>F.name.localeCompare(se.name))}),V=B(()=>{if(!d.value)return O.value;const I=d.value.toLowerCase();return O.value.filter(F=>F.name.toLowerCase().includes(I))}),re=B(()=>{if(!E.value)return null;const I=O.value.find(F=>F.id===E.value);return I?I.name:null}),_e=I=>{const F=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],se=I.id%F.length;return F[se]},pe=B(()=>{switch(v.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),we=I=>{const F=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],se=I.id%F.length;return F[se]},Re=I=>u.state==="FullySigned"?"bg-green-100 text-green-700 border border-green-200":u.state==="Archived"?I.state==="Rejected"?"bg-red-100 text-red-700 border border-red-200":(I.state==="Expired","bg-gray-100 text-gray-700 border border-gray-200"):"bg-yellow-100 text-yellow-700 border border-yellow-200",ze=I=>u.state==="FullySigned"?"Firmado":u.state==="Archived"?I.state==="Rejected"?"Rechazado":I.state==="Expired"?"Expirado":"Archivado":"Pendiente",qe=B(()=>j.value.length>0&&A.value.length===j.value.length),ee=()=>{qe.value?A.value=[]:A.value=j.value.map(I=>I.id)},de=I=>{const F=A.value.indexOf(I);F>-1?A.value.splice(F,1):A.value.push(I)},ue=()=>{A.value=j.value.map(I=>I.id)},Fe=()=>{A.value=[]},je=()=>{E.value=null,T.value="",Y.value=""},Ae=()=>{Z.value>1&&Z.value--},c=()=>{Z.value<fe.value&&Z.value++},n=I=>{I>=1&&I<=fe.value&&(Z.value=I)},l=I=>I?typeof I=="string"?I.split("T")[0]:I:"",R=B(()=>{const I=fe.value,F=Z.value,se=[];if(I<=7)for(let w=1;w<=I;w++)se.push(w);else if(F<=4){for(let w=1;w<=5;w++)se.push(w);se.push("..."),se.push(I)}else if(F>=I-3){se.push(1),se.push("...");for(let w=I-4;w<=I;w++)se.push(w)}else se.push(1),se.push("..."),se.push(F-1),se.push(F),se.push(F+1),se.push("..."),se.push(I);return se}),z=()=>{const I=A.value.length>0?j.value.filter($e=>A.value.includes($e.id)):j.value,F=["Nombre Documento","Estado Firma","Etiquetas"],se=I.map($e=>[$e.title||"",ze($e),$e.tags?$e.tags.map(Pe=>Pe.name).join(", "):""]),w=[F.join(","),...se.map($e=>$e.map(Pe=>`"${Pe}"`).join(","))].join(`
`),me=new Blob([w],{type:"text/csv;charset=utf-8;"}),ve=document.createElement("a"),Ce=URL.createObjectURL(me);ve.setAttribute("href",Ce),ve.setAttribute("download",`documentos_firmas_${new Date().toISOString().split("T")[0]}.csv`),ve.style.visibility="hidden",document.body.appendChild(ve),ve.click(),document.body.removeChild(ve)},oe=b(!1),Ve=b(null),Ee=b(!1),Oe=b(null),tt=b(""),at=b(!1),gt=b(""),Rt=I=>{Ve.value=I,oe.value=!0},zt=async(I,F)=>{oe.value=!1,await pt(I,F)},pt=async(I,F)=>{try{switch(I){case"preview":await N(F);break;case"letterhead":y("letterhead",F);break;case"relationships":y("relationships",F);break;case"viewSignatures":y("signatures",F);break;case"sign":await te(F,y);break;case"reject":Oe.value=F,tt.value="",Ee.value=!0;break;case"viewRejectionReason":{const se=(F.signatures||[]).find(w=>w.rejection_comment);se&&se.rejection_comment?(gt.value=se.rejection_comment,at.value=!0):await ke("Este documento no tiene un motivo de rechazo registrado.","info");break}case"downloadSignedDocument":await ie(F);break;case"downloadPDF":await U(F);break;default:console.warn("Unknown action:",I)}}catch(se){console.error(`Error executing action ${I}:`,se)}},rt=()=>{Ee.value=!1,Oe.value=null,tt.value=""},Ut=async()=>{if(!Oe.value)return;const I=Oe.value,F=I.id,se=_.currentUser.id;try{const w=`dynamic-documents/${F}/reject/${se}/`,me=tt.value?{comment:tt.value}:{},ve=await cs(w,me);ve&&(ve.status===200||ve.status===201)?(rt(),D("document-rejected",I),Promise.all([ke("Documento rechazado correctamente.","success"),Ss(Fs.FINISH,`Rechazaste el documento "${I.title}"`).catch(Ce=>console.warn("No se pudo registrar la actividad de rechazo:",Ce)),h.init(!0)]).then(()=>{D("refresh")})):await ke("Error al rechazar el documento.","error")}catch(w){console.error("Error rejecting document:",w),await ke("Error al rechazar el documento.","error")}},_t=async()=>{X.value=!0;try{await h.init(!0)}catch(I){console.error("Error refreshing documents:",I),ke("Error al actualizar documentos","error")}finally{X.value=!1}},wt=async()=>{await _t(),D("refresh")};Ze(async()=>{await _t()}),$({refresh:wt});const It=I=>{var se;if(!I.summary_counterparty)return null;const F=(se=I.variables)==null?void 0:se.find(w=>w.summary_field==="counterparty");return(F==null?void 0:F.value)||I.summary_counterparty},Nt=I=>{if(!I.summary_value)return null;const F=parseFloat(I.summary_value);return isNaN(F)?null:F};return De(()=>_.currentUser,()=>{wt()}),(I,F)=>{var se;return s(),o("div",null,[e("div",r0,[e("div",n0,[e("div",l0,[r(t(Ye),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Se(e("input",{"onUpdate:modelValue":F[0]||(F[0]=w=>S.value=w),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Te,S.value]])])]),e("div",i0,[r(t(Ue),{as:"div",class:"relative"},{default:M(()=>[r(t(Ie),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[e("div",d0,[r(t(lt),{class:"h-4 w-4 flex-shrink-0"}),e("span",c0,m(re.value||"Etiqueta"),1)]),r(t(We),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Ne),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",u0,[e("div",m0,[r(t(Ye),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Se(e("input",{"onUpdate:modelValue":F[1]||(F[1]=w=>d.value=w),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:F[2]||(F[2]=he(()=>{},["stop"]))},null,512),[[Te,d.value]])]),e("div",g0,[r(t(be),null,{default:M(({active:w})=>[e("a",{onClick:F[3]||(F[3]=me=>E.value=null),class:P([w?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,ye(V.value,w=>(s(),ne(t(be),{key:w.id},{default:M(({active:me})=>[e("a",{onClick:ve=>E.value=w.id,class:P([me?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:P(["w-3 h-3 rounded-full flex-shrink-0",_e(w)])},null,2),e("span",h0,m(w.name),1)],10,p0)]),_:2},1024))),128)),V.value.length===0?(s(),o("div",f0," No se encontraron etiquetas ")):g("",!0)])])]),_:1})]),_:1}),e("div",y0,[E.value||T.value||Y.value?(s(),o("button",{key:0,onClick:je,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[r(t(Me),{class:"h-4 w-4 flex-shrink-0"}),v0])):g("",!0)])]),e("div",b0,[e("div",x0,[_0,Se(e("input",{"onUpdate:modelValue":F[4]||(F[4]=w=>T.value=w),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Te,T.value]])]),e("div",w0,[$0,Se(e("input",{"onUpdate:modelValue":F[5]||(F[5]=w=>Y.value=w),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Te,Y.value]])])]),e("div",k0,[e("div",C0,[e("div",D0,[e("button",{onClick:z,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[r(t(it),{class:"h-4 w-4"}),S0]),r(t(Ue),{as:"div",class:"relative"},{default:M(()=>[r(t(Ie),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:M(()=>[r(t(ut),{class:"h-5 w-5 text-gray-500"})]),_:1}),r(t(Ne),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",F0,[r(t(be),null,{default:M(({active:w})=>[e("a",{onClick:ue,class:P([w?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),r(t(be),null,{default:M(({active:w})=>[e("a",{onClick:Fe,class:P([w?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),r(t(Ue),{as:"div",class:"relative"},{default:M(()=>[r(t(Ie),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:M(()=>[E0,ae(" "+m(pe.value)+" ",1),r(t(We),{class:"h-4 w-4"})]),_:1}),r(t(Ne),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:M(()=>[e("div",T0,[r(t(be),null,{default:M(({active:w})=>[e("a",{onClick:F[6]||(F[6]=me=>v.value="recent"),class:P([w?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),r(t(be),null,{default:M(({active:w})=>[e("a",{onClick:F[7]||(F[7]=me=>v.value="name"),class:P([w?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",A0,[e("div",M0,[e("table",j0,[e("thead",P0,[e("tr",null,[e("th",L0,[e("input",{type:"checkbox",checked:qe.value,onChange:ee,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,B0)]),R0,z0,U0,I0,N0,O0,q0,u.state==="PendingSignatures"?(s(),o("th",V0," Fecha Expiración ")):g("",!0),u.state==="PendingSignatures"||u.state==="FullySigned"?(s(),o("th",Q0," Docs. Asociados ")):g("",!0),W0])]),e("tbody",H0,[(s(!0),o(ge,null,ye(le.value,(w,me)=>{var ve;return s(),o("tr",{key:w.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:Ce=>Rt(w)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:F[8]||(F[8]=he(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:A.value.includes(w.id),onChange:Ce=>de(w.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Z0)]),e("td",K0,[e("div",Y0,[e("div",J0,[e("div",X0,[r(t(Qe),{class:"h-5 w-5 text-purple-600"})])]),e("div",eg,[e("div",tg,m(w.title),1)])])]),e("td",sg,[e("span",{class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",Re(w)])},m(ze(w)),3)]),e("td",og,[e("span",ag,m(It(w)||"-"),1)]),e("td",rg,[e("span",ng,m(w.summary_object||"-"),1)]),e("td",lg,[e("span",ig,m(Nt(w)||"-"),1)]),e("td",dg,[e("span",cg,m(w.summary_term||"-"),1)]),e("td",ug,[e("div",mg,[w.summary_subscription_date?(s(),o("div",gg,[pg,e("span",hg,m(l(w.summary_subscription_date)),1)])):g("",!0),w.summary_start_date||w.summary_end_date?(s(),o("div",fg,[yg,e("span",vg,[w.summary_start_date?(s(),o("span",bg,m(l(w.summary_start_date)),1)):g("",!0),w.summary_start_date&&w.summary_end_date?(s(),o("span",xg," → ")):g("",!0),w.summary_end_date?(s(),o("span",_g,m(l(w.summary_end_date)),1)):g("",!0)])])):g("",!0),!w.summary_subscription_date&&!w.summary_start_date&&!w.summary_end_date?(s(),o("span",wg," - ")):g("",!0)])]),u.state==="PendingSignatures"?(s(),o("td",$g,[w.signature_due_date?(s(),o("span",kg,m(l(w.signature_due_date)),1)):(s(),o("span",Cg," - "))])):g("",!0),u.state==="PendingSignatures"||u.state==="FullySigned"?(s(),o("td",Dg,[e("button",{type:"button",disabled:!w.relationships_count||w.relationships_count===0,class:P(["inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border transition-colors",w.relationships_count&&w.relationships_count>0?"border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100 cursor-pointer":"border-gray-200 text-gray-400 bg-gray-50 cursor-not-allowed opacity-60"]),onClick:he(Ce=>t(y)("relationships",w),["stop"])},[w.relationships_count&&w.relationships_count>0?(s(),o("span",Fg," Ver asociaciones ("+m(w.relationships_count)+") ",1)):(s(),o("span",Eg," Sin asociaciones "))],10,Sg)])):g("",!0),e("td",Tg,[e("div",Ag,[(s(!0),o(ge,null,ye((ve=w.tags)==null?void 0:ve.slice(0,2),Ce=>(s(),o("span",{key:Ce.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",we(Ce)])},m(Ce.name),3))),128)),w.tags&&w.tags.length>2?(s(),o("span",Mg," +"+m(w.tags.length-2),1)):g("",!0),!w.tags||w.tags.length===0?(s(),o("span",jg,"-")):g("",!0)])])],8,G0)}),128))])])]),fe.value>1?(s(),o("div",Pg,[e("div",Lg,[e("button",{onClick:Ae,disabled:Z.value===1,class:P(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",Z.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,Bg),e("button",{onClick:c,disabled:Z.value===fe.value,class:P(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",Z.value===fe.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Rg)]),e("div",zg,[e("div",null,[e("p",Ug,[ae(" Mostrando "),e("span",Ig,m(q.value.start),1),ae(" a "),e("span",Ng,m(q.value.end),1),ae(" de "),e("span",Og,m(q.value.total),1),ae(" resultados ")])]),e("div",null,[e("nav",qg,[e("button",{onClick:Ae,disabled:Z.value===1,class:P(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",Z.value===1?"opacity-50 cursor-not-allowed":""])},[Qg,r(t(Et),{class:"h-5 w-5","aria-hidden":"true"})],10,Vg),(s(!0),o(ge,null,ye(R.value,w=>(s(),o(ge,{key:w},[w!=="..."?(s(),o("button",{key:0,onClick:me=>n(w),class:P(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",Z.value===w?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},m(w),11,Wg)):(s(),o("span",Hg," ... "))],64))),128)),e("button",{onClick:c,disabled:Z.value===fe.value,class:P(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",Z.value===fe.value?"opacity-50 cursor-not-allowed":""])},[Zg,r(t(bt),{class:"h-5 w-5","aria-hidden":"true"})],10,Gg)])])])])):g("",!0)]),j.value.length===0&&!X.value?(s(),o("div",Kg,[r(t(Lt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",Yg,m(H.value),1),e("p",Jg,m(G.value),1)])):g("",!0),X.value?(s(),o("div",Xg,sp)):g("",!0),r(Gt,{isVisible:t(nt),documentData:t(Ht),onClose:F[9]||(F[9]=w=>nt.value=!1)},null,8,["isVisible","documentData"]),(s(),ne(Wt,{to:"body"},[t(k).signatures.isOpen?(s(),ne(t(us),{key:0,"document-id":(se=t(k).signatures.document)==null?void 0:se.id,onClose:F[10]||(F[10]=w=>t(C)("signatures")),onRefresh:F[11]||(F[11]=w=>D("refresh")),onOpenElectronicSignature:F[12]||(F[12]=w=>D("open-electronic-signature"))},null,8,["document-id"])):g("",!0),t(k).letterhead.isOpen?(s(),ne(Pt,{key:1,"is-visible":t(k).letterhead.isOpen,document:t(k).letterhead.document,onClose:F[13]||(F[13]=w=>t(C)("letterhead")),onRefresh:F[14]||(F[14]=w=>D("refresh"))},null,8,["is-visible","document"])):g("",!0),oe.value?(s(),ne(Bt,{key:2,"is-visible":oe.value,document:Ve.value,"card-type":"signatures",context:"table","user-store":t(_),onClose:F[15]||(F[15]=w=>oe.value=!1),onAction:zt},null,8,["is-visible","document","user-store"])):g("",!0),t(k).relationships.isOpen?(s(),ne(Tt,{key:3,"is-open":t(k).relationships.isOpen,document:t(k).relationships.document,readonly:u.state==="PendingSignatures"||u.state==="FullySigned",onClose:F[16]||(F[16]=w=>t(C)("relationships")),onRefresh:F[17]||(F[17]=w=>D("refresh"))},null,8,["is-open","document","readonly"])):g("",!0),J.value?(s(),ne(vs,{key:4,"is-visible":J.value,document:Q.value,onClose:F[18]||(F[18]=w=>J.value=!1)},null,8,["is-visible","document"])):g("",!0),Ee.value&&Oe.value?(s(),o("div",op,[e("div",ap,[e("div",rp,[np,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:rt},[r(t(Me),{class:"h-5 w-5"})])]),e("div",lp,[e("p",null,[ae(" Estás a punto de rechazar el documento "),e("span",ip,'"'+m(Oe.value.title)+'"',1),ae(". ")]),dp,e("div",null,[cp,Se(e("textarea",{"onUpdate:modelValue":F[19]||(F[19]=w=>tt.value=w),rows:"4",class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-secondary focus:border-transparent resize-none",placeholder:"Describe brevemente por qué no estás de acuerdo con el documento..."},null,512),[[Te,tt.value]])])]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end gap-2 bg-gray-50"},[e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100",onClick:rt}," Cancelar "),e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700",onClick:Ut}," Rechazar documento ")])])])):g("",!0),at.value?(s(),o("div",up,[e("div",mp,[e("div",gp,[pp,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:F[20]||(F[20]=w=>at.value=!1)},[r(t(Me),{class:"h-5 w-5"})])]),e("div",hp,m(gt.value||"No se encontró un motivo de rechazo para este documento."),1),e("div",fp,[e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100",onClick:F[21]||(F[21]=w=>at.value=!1)}," Cerrar ")])])])):g("",!0)]))])}}},yp={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},vp={class:"flex justify-end"},bp=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[ae(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),xp={class:"mt-2"},_p={class:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t border-gray-200"},wp=["disabled"],$p=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),kp=e("span",null,"Actualizar nombre",-1),Cp=[$p,kp],Dp=["disabled"],Sp=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1),Fp={__name:"CreateDocumentByLawyer",emits:["close"],setup(a,{emit:$}){const i=ot(),u=He(),D=$,_=b(""),h=b("");is(()=>{var te;(te=u.selectedDocument)!=null&&te.title?(_.value=u.selectedDocument.title,h.value=u.selectedDocument.title):(_.value="",h.value="")});const k=te=>{te.key==="Escape"&&D("close")};Ze(()=>{document.addEventListener("keydown",k)}),yt(()=>{document.removeEventListener("keydown",k)});const y=B(()=>_.value.trim().length>0),C=B(()=>{var te;return!!((te=u.selectedDocument)!=null&&te.id)}),W=B(()=>C.value&&_.value.trim()!==h.value.trim()&&_.value.trim().length>0);async function N(){if(C.value&&W.value)try{const te={title:_.value.trim()};await u.updateDocument(u.selectedDocument.id,te),h.value=_.value.trim(),u.selectedDocument.title=_.value.trim(),u.lastUpdatedDocumentId=u.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",u.selectedDocument.id);const ie=u.selectedDocument.id;D("close",{updatedDocId:ie});const X=window.location.pathname;X==="/dynamic_document_dashboard"||X==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(ie)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(te){console.error("Error updating document name:",te)}}const U=async()=>{if(!y.value)return;const te=encodeURIComponent(_.value.trim());C.value?(u.selectedDocument.title=_.value,u.selectedDocument.id&&(u.lastUpdatedDocumentId=u.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",u.selectedDocument.id.toString())),i.push(`/dynamic_document_dashboard/lawyer/editor/edit/${u.selectedDocument.id}`)):(u.selectedDocument={title:_.value.trim()},i.push(`/dynamic_document_dashboard/lawyer/editor/create/${te}`))};return(te,ie)=>(s(),o("div",yp,[e("div",vp,[e("button",{onClick:ie[0]||(ie[0]=X=>D("close"))},[r(t(Me),{class:"size-6"})])]),e("form",{onSubmit:he(U,["prevent"])},[e("div",null,[bp,e("div",xp,[Se(e("input",{"onUpdate:modelValue":ie[1]||(ie[1]=X=>_.value=X),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[Te,_.value]])])]),e("div",_p,[C.value?(s(),o("button",{key:0,type:"button",onClick:N,disabled:!W.value,class:P(["inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm transition-all duration-200",W.value?"bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500":"bg-gray-100 text-gray-400 border-2 border-dashed border-gray-300 cursor-not-allowed"])},Cp,10,wp)):g("",!0),e("button",{type:"submit",class:P(["inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm transition-all duration-200",y.value?"bg-green-600 text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500":"bg-gray-100 text-gray-400 border-2 border-dashed border-gray-300 cursor-not-allowed"]),disabled:!y.value},[Sp,e("span",null,m(C.value?"Editar Documento":"Continuar"),1)],10,Dp)])],32)]))}},Be=a=>(St("data-v-857c746d"),a=a(),Ft(),a),Ep={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Tp={class:"px-6 py-4 border-b border-gray-200"},Ap=Be(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gestión de Membrete Global para PDF",-1)),Mp=Be(()=>e("p",{class:"text-sm text-gray-500 mt-1"}," La imagen de membrete se usará por defecto solo al generar documentos en PDF. Para documentos Word, se utiliza la plantilla .docx configurada más abajo. ",-1)),jp={class:"p-6 overflow-y-auto flex-grow"},Pp={key:0,class:"text-center py-10"},Lp=Be(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),Bp={class:"mt-4 text-gray-500"},Rp={key:1,class:"space-y-6"},zp={key:0,class:"space-y-4"},Up=Be(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete de imagen para PDF actual",-1)),Ip={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Np=["src"],Op={class:"mt-4 flex justify-center space-x-3"},qp=["disabled"],Vp={key:1,class:"text-center py-8"},Qp=Be(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete para PDF",-1)),Wp=Be(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," No tienes una imagen de membrete global configurada para los documentos PDF. ",-1)),Hp=Be(()=>e("p",{class:"mt-1 text-xs text-gray-400"}," Este membrete de imagen se aplicará solo a los PDF que no tengan un membrete específico. ",-1)),Gp={class:"space-y-4"},Zp={class:"text-lg font-medium text-gray-900"},Kp={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},Yp={key:0},Jp={class:"mt-4"},Xp=Be(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, máximo 10MB. Se usa únicamente para los PDF. ",-1)),eh=Be(()=>e("p",{class:"text-xs text-gray-400 mt-1"},' Dimensiones ideales: 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI) ',-1)),th={key:1,class:"space-y-4"},sh={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},oh={class:"text-gray-400"},ah={key:0,class:"mt-4"},rh=["src"],nh={class:"flex justify-center space-x-3"},lh=["disabled"],ih={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},dh={class:"space-y-4 border-t border-gray-200 pt-6"},ch=Be(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Plantilla Word para documentos (.docx)",-1)),uh=Be(()=>e("p",{class:"text-sm text-gray-500"}," Esta plantilla se usará al descargar documentos en Word. Debe ser un archivo .docx con tu membrete configurado (header, footer o watermark). El contenido del documento se añadirá sobre esa plantilla. ",-1)),mh={key:0,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},gh={class:"text-sm text-gray-700"},ph=Be(()=>e("div",{class:"font-medium"},"Plantilla actual:",-1)),hh={class:"mt-1 break-words"},fh={class:"font-mono break-all"},yh={key:0,class:"text-gray-400 ml-2"},vh={class:"mt-3 flex flex-wrap gap-3"},bh=["disabled"],xh={key:1,class:"text-sm text-gray-500"},_h={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},wh={key:0},$h={class:"mt-4"},kh=Be(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos .docx, máximo 10MB. ",-1)),Ch={key:1,class:"space-y-4"},Dh={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Sh={class:"text-gray-400"},Fh={class:"flex justify-center space-x-3"},Eh=["disabled"],Th={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Ah={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},Mh={class:"flex items-center space-x-2"},jh=Be(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete para PDF",-1)),Ph=Be(()=>e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-yellow-800 mb-2"},"🔄 Prioridad de Membrete"),e("div",{class:"text-sm text-yellow-700 space-y-1"},[e("div",null,[e("strong",null,"1º Prioridad:"),ae(" Membrete específico del documento")]),e("div",null,[e("strong",null,"2º Prioridad:"),ae(" Membrete global de imagen para PDF del usuario (este)")]),e("div",null,[e("strong",null,"3º Prioridad:"),ae(" Sin membrete")])])],-1)),Lh=Be(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"📐 Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"2550 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"3300 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporción:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta, 300 DPI)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"±10%")])])])],-1)),Bh=Be(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🎨 Distribución Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"⚠️ ZONA CRÍTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mantén semi-transparente. El texto del documento se superpone aquí.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, teléfonos, emails, información de contacto.")])])])])])],-1)),Rh=Be(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🔧 Consideraciones Técnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Posicionamiento:"),ae(" La imagen se centra automáticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Transparencia:"),ae(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Márgenes:"),ae(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Resolución:"),ae(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"⚠️"),e("span",null,[e("strong",null,"Zona crítica:"),ae(" Evita elementos gráficos densos en el centro (300-400px de altura)")])])])])],-1)),zh=Be(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"💡 Tips de Diseño Rápido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"• Si solo tienes header, ubícalo en los primeros 120-150px"),e("div",null,"• El resto de la imagen debe ser transparente o blanco"),e("div",null,"• Para footer, usa los últimos 80-120px"),e("div",null,"• El texto se superpone en toda la imagen, mantén el centro claro")])],-1)),Uh={key:3,class:"space-y-2"},Ih={class:"flex"},Nh={class:"text-sm text-yellow-700"},Oh={__name:"GlobalLetterheadModal",props:{isVisible:{type:Boolean,default:!1}},emits:["close","uploaded","deleted"],setup(a,{emit:$}){const i=a,u=$;De(()=>i.isVisible,ee=>{});const D=He(),_=b(!1),h=b(""),k=b(!1),y=b(!1),C=b(null),W=b(null),N=b(null),U=b([]),te=b(null),ie=b(!1),X=b(!1),S=b(null),d=b(!1),E=b(null),T=b(""),Y=b(null),v=b(!1),A=b(!1),J=b(null),Q=()=>{H(),u("close")},Z=ee=>{const de=ee.target.files[0];if(!de)return;if(!de.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(de.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}C.value=de,U.value=[];const ue=new FileReader;ue.onload=Fe=>{W.value=Fe.target.result;const je=new Image;je.onload=()=>{K(je.width,je.height)},je.src=Fe.target.result},ue.readAsDataURL(de)},K=(ee,de)=>{const Ae=ee/de,c=2550/3300,n=Math.abs(Ae-c)/c;if(ee===2550&&de===3300){U.value.push("✅ Dimensiones perfectas: 2550 × 3300 píxeles");return}n<=.1?(U.value.push(`ℹ️ Buenas proporciones detectadas: ${ee} × ${de} píxeles (${Ae.toFixed(3)})`),(ee!==2550||de!==3300)&&U.value.push('💡 Para mejores resultados, usa exactamente 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI)')):(U.value.push(`⚠️ Proporciones no ideales: ${ee} × ${de} píxeles (${Ae.toFixed(3)})`),U.value.push(`🎯 Proporciones recomendadas: ${c.toFixed(3)} (8.5:11, tamaño carta)`),U.value.push("📐 Considera redimensionar tu imagen a 2550 × 3300 píxeles (tamaño carta)")),(ee<1200||de<1600)&&U.value.push("⚠️ Imagen muy pequeña - puede verse pixelada en documentos PDF tamaño carta"),(ee>4e3||de>5e3)&&U.value.push("ℹ️ Imagen muy grande - se redimensionará automáticamente para ajustarse al tamaño carta")},H=()=>{C.value=null,W.value=null,U.value=[],ie.value=!1,te.value&&(te.value.value="")},G=async()=>{var ee;if(C.value){k.value=!0,U.value=[];try{const de=await D.uploadGlobalLetterheadImage(C.value);(ee=de.data)!=null&&ee.warnings&&de.data.warnings.length>0&&(U.value=de.data.warnings),X.value=!1,await L(),H(),u("uploaded",de.data)}catch(de){console.error("Error uploading global letterhead:",de),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{k.value=!1}}},L=async()=>{if(!(N.value===null&&X.value)){X.value=!0;try{const ee=await D.getGlobalLetterheadImage();ee.data&&(N.value=URL.createObjectURL(ee.data))}catch{N.value=null}}},j=async()=>{await es("¿Estás seguro de que deseas eliminar la imagen de membrete global?")&&le()},le=async()=>{y.value=!0;try{await D.deleteGlobalLetterheadImage(),N.value&&URL.revokeObjectURL(N.value),N.value=null,X.value=!0,u("deleted")}catch(ee){console.error("Error deleting global letterhead:",ee),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{y.value=!1}},fe=ee=>{const de=ee.target.files[0];if(de){if(!de.name.toLowerCase().endsWith(".docx")){alert("Solo se permiten archivos .docx para la plantilla Word");return}if(de.size>10*1024*1024){alert("El archivo de plantilla no puede ser mayor a 10MB");return}S.value=de}},q=()=>{S.value=null,J.value&&(J.value.value="")},O=async()=>{var ee;if(S.value){v.value=!0;try{const ue=(ee=(await D.uploadGlobalLetterheadWordTemplate(S.value)).data)==null?void 0:ee.template_info;d.value=!0,T.value=(ue==null?void 0:ue.filename)||S.value.name,Y.value=(ue==null?void 0:ue.size_bytes)||S.value.size,await V(),q()}catch(de){console.error("Error uploading global Word template:",de),alert("Error al subir la plantilla Word. Por favor intenta nuevamente.")}finally{v.value=!1}}},V=async()=>{var ee,de;try{const ue=await D.getGlobalLetterheadWordTemplate("blob");if(!ue){d.value=!1,E.value&&URL.revokeObjectURL(E.value),E.value=null,T.value="",Y.value=null;return}if(ue&&ue.data){d.value=!0,E.value&&URL.revokeObjectURL(E.value),E.value=URL.createObjectURL(ue.data);const Fe=((ee=ue.headers)==null?void 0:ee["content-disposition"])||((de=ue.headers)==null?void 0:de["Content-Disposition"]);let je="plantilla_word.docx";if(Fe){const Ae=Fe.match(/filename="?([^";]+)"?/i);Ae&&Ae[1]&&(je=Ae[1])}T.value=je,Y.value=ue.data.size||null}}catch(ue){console.error("Error loading global Word template:",ue)}},re=async()=>{await es("¿Estás seguro de que deseas eliminar la plantilla Word de membrete global?")&&_e()},_e=async()=>{A.value=!0;try{await D.deleteGlobalLetterheadWordTemplate(),E.value&&URL.revokeObjectURL(E.value),E.value=null,T.value="",Y.value=null,d.value=!1}catch(ee){console.error("Error deleting global Word template:",ee),alert("Error al eliminar la plantilla Word. Por favor intenta nuevamente.")}finally{A.value=!1}},pe=()=>{if(E.value){const ee=document.createElement("a");ee.href=E.value,ee.download=T.value||"membrete-word.docx",document.body.appendChild(ee),ee.click(),document.body.removeChild(ee)}},we=()=>{if(N.value){const ee=document.createElement("a");ee.href=N.value,ee.download="membrete-global.png",document.body.appendChild(ee),ee.click(),document.body.removeChild(ee)}},Re=()=>{N.value=null},ze=ee=>{if(ee===0)return"0 Bytes";const de=1024,ue=["Bytes","KB","MB","GB"],Fe=Math.floor(Math.log(ee)/Math.log(de));return parseFloat((ee/Math.pow(de,Fe)).toFixed(2))+" "+ue[Fe]};De(()=>i.isVisible,ee=>{ee&&(L(),V())});const qe=()=>{N.value&&URL.revokeObjectURL(N.value),W.value&&URL.revokeObjectURL(W.value),E.value&&URL.revokeObjectURL(E.value)};return Ze(()=>{i.isVisible&&L()}),yt(qe),(ee,de)=>Se((s(),ne(Xe,null,{default:M(()=>[e("div",Ep,[e("div",Tp,[Ap,Mp,e("button",{onClick:Q,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[r(t(Me),{class:"h-6 w-6"})])]),e("div",jp,[_.value?(s(),o("div",Pp,[Lp,e("p",Bp,m(h.value),1)])):(s(),o("div",Rp,[N.value?(s(),o("div",zp,[Up,e("div",Ip,[e("img",{src:N.value,alt:"Membrete de imagen para PDF actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:Re},null,40,Np),e("div",Op,[e("button",{onClick:we,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[r(t(it),{class:"h-4 w-4 mr-2"}),ae(" Descargar ")]),e("button",{onClick:j,disabled:y.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[r(t(Qt),{class:"h-4 w-4 mr-2"}),ae(" "+m(y.value?"Eliminando...":"Eliminar"),1)],8,qp)])])])):(s(),o("div",Vp,[r(t(dt),{class:"mx-auto h-12 w-12 text-gray-400"}),Qp,Wp,Hp])),e("div",Gp,[e("h3",Zp,m(N.value?"Reemplazar Membrete de imagen para PDF":"Subir Membrete de imagen para PDF"),1),e("div",Kp,[e("input",{ref_key:"fileInput",ref:te,type:"file",accept:".png",onChange:Z,class:"hidden"},null,544),C.value?(s(),o("div",th,[e("div",sh,[r(t(Dt),{class:"h-5 w-5 text-green-500"}),e("span",null,m(C.value.name),1),e("span",oh,"("+m(ze(C.value.size))+")",1)]),W.value?(s(),o("div",ah,[e("img",{src:W.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,rh)])):g("",!0),e("div",nh,[e("button",{onClick:H,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:G,disabled:k.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[k.value?(s(),o("div",ih)):(s(),ne(t(as),{key:0,class:"h-4 w-4 mr-2"})),ae(" "+m(k.value?"Subiendo...":"Subir Imagen para PDF"),1)],8,lh)])])):(s(),o("div",Yp,[r(t(ps),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Jp,[e("button",{onClick:de[0]||(de[0]=ue=>ee.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG para PDF "),e("button",{onClick:de[1]||(de[1]=ue=>ie.value=!ie.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[r(t(os),{class:"h-4 w-4 mr-2"}),ae(" "+m(ie.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),Xp,eh]))])]),e("div",dh,[ch,uh,d.value?(s(),o("div",mh,[e("div",gh,[ph,e("div",hh,[e("span",fh,m(T.value||"plantilla_word.docx"),1),Y.value?(s(),o("span",yh,"("+m(ze(Y.value))+")",1)):g("",!0)])]),e("div",vh,[E.value?(s(),o("button",{key:0,onClick:pe,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[r(t(it),{class:"h-4 w-4 mr-2"}),ae(" Descargar ")])):g("",!0),e("button",{onClick:re,disabled:A.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[r(t(Qt),{class:"h-4 w-4 mr-2"}),ae(" "+m(A.value?"Eliminando...":"Eliminar"),1)],8,bh)])])):(s(),o("div",xh," No tienes una plantilla Word configurada. Puedes subir un archivo .docx con tu membrete. ")),e("div",_h,[e("input",{ref_key:"wordTemplateInput",ref:J,type:"file",accept:".docx",onChange:fe,class:"hidden"},null,544),S.value?(s(),o("div",Ch,[e("div",Dh,[r(t(Dt),{class:"h-5 w-5 text-green-500"}),e("span",null,m(S.value.name),1),e("span",Sh,"("+m(ze(S.value.size))+")",1)]),e("div",Fh,[e("button",{onClick:q,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:O,disabled:v.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[v.value?(s(),o("div",Th)):(s(),ne(t(as),{key:0,class:"h-4 w-4 mr-2"})),ae(" "+m(v.value?"Subiendo...":"Subir Plantilla"),1)],8,Eh)])])):(s(),o("div",wh,[r(t(dt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",$h,[e("button",{onClick:de[2]||(de[2]=ue=>ee.$refs.wordTemplateInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Plantilla .docx (Word) ")]),kh]))])]),ie.value?(s(),o("div",Ah,[e("div",Mh,[r(t(os),{class:"h-6 w-6 text-blue-600"}),jh]),Ph,Lh,Bh,Rh,zh])):g("",!0),U.value.length>0?(s(),o("div",Uh,[(s(!0),o(ge,null,ye(U.value,(ue,Fe)=>(s(),o("div",{key:Fe,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",Ih,[r(t(Is),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",Nh,m(ue),1)])]))),128))])):g("",!0)]))])])]),_:1},512)),[[vt,a.isVisible]])}},qh=At(Oh,[["__scopeId","data-v-857c746d"]]),Vh={class:"min-h-screen bg-gray-50"},Qh={class:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8"},Wh={class:"p-4 sm:p-6 lg:p-8"},Hh={key:0},Gh={key:0},Zh={key:1},Kh={class:"mb-6 border-b border-gray-200 pb-4"},Yh={class:"hidden md:block"},Jh={class:"flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8 mb-4","aria-label":"Tabs"},Xh=["onClick"],ef={class:"flex gap-3"},tf=["disabled"],sf=e("span",null,"Firma Electrónica",-1),of=e("span",null,"Membrete Global",-1),af=e("span",null,"Nueva Minuta",-1),rf=e("span",null,"Nuevo Documento",-1),nf={class:"md:hidden space-y-3 relative"},lf=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),df=[lf],cf={key:0,class:"absolute z-20 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden w-full"},uf=["onClick"],mf=["disabled"],gf=e("span",{class:"font-medium text-xs leading-tight"},"Firma",-1),pf=e("span",{class:"font-medium text-xs leading-tight"},"Membrete",-1),hf=e("span",{class:"font-medium text-xs leading-tight"},"Nueva Minuta",-1),ff=e("span",{class:"font-medium text-xs leading-tight"},"Nuevo Doc.",-1),yf={key:0},vf={key:1},bf={key:2},xf={key:3},_f={key:4},wf={key:5},$f={key:6},kf={key:7},Cf={key:8,class:"mt-6 text-center text-gray-400 font-regular"},Df=e("p",null,"No hay documentos disponibles para mostrar.",-1),Sf=[Df],Ff={key:1},Ef={class:"mb-6 border-b border-gray-200"},Tf={class:"hidden md:flex items-center justify-between"},Af={class:"-mb-px flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},Mf=["onClick"],jf={class:"flex items-center gap-2 mb-4"},Pf={class:"relative"},Lf={class:"relative group"},Bf=["disabled"],Rf={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},zf=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),Uf={class:"md:hidden relative"},If=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),Nf=[If],Of={key:0,class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},qf=["onClick"],Vf={class:"md:hidden mt-4 mb-4 flex flex-col gap-2"},Qf={class:"relative"},Wf={class:"relative group"},Hf=["disabled"],Gf={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},Zf=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),Kf={key:0},Yf={key:1},Jf={class:"p-4 sm:p-6"},Xf={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},ey={class:"flex justify-between items-center p-4 border-b"},ty=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),sy={class:"p-4 sm:p-6"},oy={class:"p-4 sm:p-6"},ay={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},ry={class:"flex justify-between items-center p-4 border-b"},ny=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),ly={class:"p-4 sm:p-6"},Ry={__name:"Dashboard",setup(a){const $=et(),i=He(),u=Yt(),D=ot(),_=Es(),{isBasicUser:h,handleFeatureAccess:k}=ys(),y=b(""),C=b("default"),W=b(!1),N=b("folders"),U=b("legal-documents"),te=b(!1),ie=b(!1),X=b(!1),S=b(!1),d=b(!1),E=b(null),T=b([]),Y=b("recent");De(U,(c,n)=>{},{immediate:!0}),B(()=>[]),B(()=>Y.value==="recent"?"Más recientes":"Nombre (A-Z)");const v=B(()=>$.currentUser),A=B(()=>v.value?v.value.role:(D.push("/login"),null)),J=B(()=>{let c=[];A.value==="lawyer"?c=i.draftAndPublishedDocumentsUnassigned:(A.value==="client"||A.value==="basic"||A.value==="corporate_client")&&(c=i.progressAndCompletedDocumentsByClient(v.value.id));const n=T.value&&Array.isArray(T.value)?T.value.map(l=>l.id):[];return i.filteredDocumentsBySearchAndTags(y.value,$,n).filter(l=>c.some(R=>R.id===l.id))}),Q=async c=>{C.value=c,i.selectedDocument=null;try{await i.init(!0)}catch(n){console.error("Error loading documents for useDocument section:",n)}},Z=()=>{W.value=!1,C.value="default",i.selectedDocument=null},K=async()=>{await i.init(!0)},H=()=>{if(!v.value){console.error("Cannot open signature modal: currentUser is not loaded");return}ie.value=!0},G=()=>{if(!v.value){console.error("Cannot open signature modal: currentUser is not loaded");return}te.value=!0},L=()=>{if(!v.value){console.error("Cannot open signature modal: currentUser is not loaded");return}te.value=!0},j=async c=>{U.value="signed-documents"},le=async c=>{N.value="signed-documents"},fe=async c=>{try{c&&c.id?await i.fetchDocumentById(c.id,!0):await i.init(!0)}catch(n){console.error("Error refreshing rejected document for lawyer:",n)}U.value="archived-documents"},q=async c=>{try{c&&c.id?await i.fetchDocumentById(c.id,!0):await i.init(!0)}catch(n){console.error("Error refreshing rejected document for client:",n)}N.value="archived-documents"},O=()=>{i.selectedDocument=null,W.value=!0},V=()=>{Q("useDocument")},re=c=>{const{tab:n,searchQuery:l}=c;U.value=n,y.value=l,setTimeout(()=>{},100)},_e=()=>{if(!v.value){console.error("Cannot open letterhead modal: currentUser is not loaded");return}k("Membrete Global",()=>{X.value=!0})},pe=c=>{ke("Membrete global subido correctamente","success")},we=()=>{ke("Membrete global eliminado correctamente","success")},Re=async()=>{if(C.value==="useDocument"){C.value="default",A.value==="lawyer"?U.value="my-documents":N.value="my-documents";return}A.value==="lawyer"?U.value="folders":N.value="folders";try{await new Promise(c=>setTimeout(c,100)),await u.fetchFolders(!0)}catch{}};De(()=>i.lastUpdatedDocumentId,(c,n)=>{if(c&&c!==n&&C.value==="default"){const l=Date.now();(!De.lastExecutionTime||l-De.lastExecutionTime>100)&&(De.lastExecutionTime=l,C.value="default")}},{immediate:!1}),De(S,c=>{}),De(d,c=>{}),De(E,c=>{}),De(()=>_.path,(c,n)=>{c==="/dynamic_document_dashboard"&&n&&n.includes("/document/use/")&&i.init()}),De(()=>_.query,c=>{c.lawyerTab&&(U.value=c.lawyerTab),c.tab&&(N.value=c.tab)},{immediate:!0});const ze=[{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"archived-documents",label:"Dcs. Archivados"}],qe=[{name:"legal-documents",label:"Minutas"},{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"archived-documents",label:"Dcs. Archivados"},{name:"finished-documents",label:"Dcs. Clientes"},{name:"in-progress-documents",label:"Dcs. Clientes en Progreso"}],ee=b(!1),de=b(!1),ue=()=>{ee.value=!1,de.value=!1},Fe=c=>{y.value="",U.value=c,ee.value=!1,ue()},je=c=>{C.value="default",y.value="",N.value=c,de.value=!1,ue()};Ze(async()=>{try{await Promise.all([$.init(),i.init(),u.init()])}catch(n){console.error("Error initializing dynamic document dashboard:",n)}i.selectedDocument=null,C.value="default";const c=localStorage.getItem("lastUpdatedDocumentId");c&&i.documents.some(l=>l.id.toString()===c)&&(i.lastUpdatedDocumentId=parseInt(c))});const Ae=async c=>{$.currentUser&&($.currentUser.has_signature=!0),ke("Firma electrónica guardada correctamente","success"),setTimeout(()=>{ie.value=!1,te.value=!1},500)};return(c,n)=>{var l,R;return s(),o(ge,null,[e("div",Vh,[e("div",Qh,[ds(c.$slots,"default")]),e("div",Wh,[A.value==="lawyer"?(s(),o("div",Hh,[C.value==="useDocument"?(s(),o("div",Gh,[r(ls,{searchQuery:y.value,selectedTags:T.value,onGoBack:Re},null,8,["searchQuery","selectedTags"])])):(s(),o("div",Zh,[e("div",Kh,[e("div",Yh,[e("nav",Jh,[(s(),o(ge,null,ye(qe,z=>e("button",{key:z.name,onClick:he(oe=>Fe(z.name),["stop"]),class:P([U.value===z.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},m(z.label),11,Xh)),64))]),e("div",ef,[e("button",{onClick:he(H,["stop"]),disabled:!v.value,class:P(["inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-purple-200 text-sm font-medium transition-all duration-200",v.value?"bg-white text-gray-700 hover:bg-purple-50 hover:border-purple-300":"bg-gray-50 text-gray-400 cursor-not-allowed opacity-60"])},[r(t($t),{class:"size-5 text-purple-500"}),sf],10,tf),e("button",{onClick:n[0]||(n[0]=he(z=>X.value=!0,["stop"])),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-green-200 bg-white text-sm font-medium text-gray-700 hover:bg-green-50 hover:border-green-300 transition-all duration-200"},[r(t(Qe),{class:"size-5 text-green-500"}),of]),U.value==="legal-documents"?(s(),o("button",{key:0,onClick:he(O,["stop"]),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-secondary bg-secondary text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200"},[r(t(Ke),{class:"size-5"}),af])):g("",!0),U.value==="my-documents"?(s(),o("button",{key:1,onClick:he(V,["stop"]),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-secondary bg-secondary text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200"},[r(t(Ke),{class:"size-5"}),rf])):g("",!0)])]),e("div",nf,[e("button",{onClick:n[1]||(n[1]=he(z=>ee.value=!ee.value,["stop"])),class:"dropdown-button w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,m(((l=qe.find(z=>z.name===U.value))==null?void 0:l.label)||"Seleccionar sección"),1),(s(),o("svg",{class:P(["ml-2 h-5 w-5 transition-transform duration-200",ee.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},df,2))]),ee.value?(s(),o("div",cf,[(s(),o(ge,null,ye(qe,z=>e("button",{key:z.name,onClick:he(oe=>Fe(z.name),["stop"]),class:P(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",U.value===z.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},m(z.label),11,uf)),64))])):g("",!0),e("div",{class:P(["grid gap-2",U.value==="legal-documents"||U.value==="my-documents"?"grid-cols-3":"grid-cols-2"])},[e("button",{onClick:he(H,["stop"]),disabled:!v.value,class:P(["flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-purple-200 text-center transition-all duration-200",v.value?"bg-white hover:bg-purple-50":"bg-gray-50 cursor-not-allowed opacity-60"])},[r(t($t),{class:"size-6 text-purple-500 mb-1"}),gf],10,mf),e("button",{onClick:n[2]||(n[2]=he(z=>X.value=!0,["stop"])),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-green-200 bg-white text-center transition-all duration-200 hover:bg-green-50"},[r(t(Qe),{class:"size-6 text-green-500 mb-1"}),pf]),U.value==="legal-documents"?(s(),o("button",{key:0,onClick:he(O,["stop"]),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-secondary bg-secondary text-white text-center transition-all duration-200 hover:bg-blue-700"},[r(t(Ke),{class:"size-6 mb-1"}),hf])):g("",!0),U.value==="my-documents"?(s(),o("button",{key:1,onClick:he(V,["stop"]),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-secondary bg-secondary text-white text-center transition-all duration-200 hover:bg-blue-700"},[r(t(Ke),{class:"size-6 mb-1"}),ff])):g("",!0)],2)])]),U.value==="legal-documents"?(s(),o("div",yf,[r(qt,{searchQuery:y.value,"onUpdate:searchQuery":n[3]||(n[3]=z=>y.value=z),selectedTags:T.value,"is-loading":t(i).isLoading,"card-type":"lawyer","show-state-filter":!0,"show-client-filter":!0,"show-associations-column":!0,context:"legal-documents",onRefresh:K},null,8,["searchQuery","selectedTags","is-loading"])])):g("",!0),U.value==="my-documents"?(s(),o("div",vf,[r(qt,{searchQuery:y.value,"onUpdate:searchQuery":n[4]||(n[4]=z=>y.value=z),selectedTags:T.value,"is-loading":t(i).isLoading,"card-type":"client","show-state-filter":!0,"show-client-filter":!1,"show-associations-column":!0,context:"my-documents",onRefresh:K},null,8,["searchQuery","selectedTags","is-loading"])])):g("",!0),U.value==="folders"?(s(),o("div",bf,[r(ns,{searchQuery:y.value,selectedTags:T.value,onRefresh:K,onNavigateToMain:Re,onNavigateToDocument:re},null,8,["searchQuery","selectedTags"])])):g("",!0),U.value==="pending-signatures"?(s(),o("div",xf,[r(ct,{state:"PendingSignatures",searchQuery:y.value,selectedTags:T.value,onRefresh:K,onOpenElectronicSignature:H,onDocumentFullySigned:j,onDocumentRejected:fe},null,8,["searchQuery","selectedTags"])])):g("",!0),U.value==="signed-documents"?(s(),o("div",_f,[r(ct,{state:"FullySigned",searchQuery:y.value,selectedTags:T.value,onRefresh:K,onOpenElectronicSignature:H},null,8,["searchQuery","selectedTags"])])):g("",!0),U.value==="archived-documents"?(s(),o("div",wf,[r(ct,{state:"Archived",searchQuery:y.value,selectedTags:T.value,onRefresh:K,onOpenElectronicSignature:H},null,8,["searchQuery","selectedTags"])])):g("",!0),U.value==="finished-documents"?(s(),o("div",$f,[r(Nu,{searchQuery:y.value,selectedTags:T.value},null,8,["searchQuery","selectedTags"])])):g("",!0),U.value==="in-progress-documents"?(s(),o("div",kf,[r(a0,{searchQuery:y.value,selectedTags:T.value},null,8,["searchQuery","selectedTags"])])):g("",!0),J.value.length===0?(s(),o("div",Cf,Sf)):g("",!0)]))])):g("",!0),A.value==="client"||A.value==="basic"||A.value==="corporate_client"?(s(),o("div",Ff,[e("div",Ef,[e("div",Tf,[e("nav",Af,[(s(),o(ge,null,ye(ze,z=>e("button",{key:z.name,onClick:he(oe=>je(z.name),["stop"]),class:P([N.value===z.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},m(z.label),11,Mf)),64))]),e("div",jf,[e("div",Pf,[e("button",{onClick:he(G,["stop"]),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border text-purple-600 hover:bg-purple-50 border-purple-200"},[r(t($t),{class:"h-4 w-4"}),ae(" Firma Electrónica ")])]),e("div",Lf,[e("button",{onClick:he(_e,["stop"]),disabled:t(h),class:P(["inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border",t(h)?"text-green-400 bg-gray-50 border-gray-200 cursor-not-allowed opacity-60":"text-green-600 hover:bg-green-50 border-green-200"])},[r(t(Qe),{class:"h-4 w-4"}),ae(" Membrete Global ")],10,Bf),t(h)?(s(),o("div",Rf,[ae(" Actualiza tu suscripción para usar esta funcionalidad "),zf])):g("",!0)]),e("button",{onClick:n[5]||(n[5]=he(z=>Q("useDocument"),["stop"])),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[r(t(Ke),{class:"h-4 w-4"}),ae(" Nuevo Documento ")])])]),e("div",Uf,[e("button",{onClick:n[6]||(n[6]=he(z=>de.value=!de.value,["stop"])),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,m(((R=ze.find(z=>z.name===N.value))==null?void 0:R.label)||"Seleccionar sección"),1),(s(),o("svg",{class:P(["ml-2 h-5 w-5 transition-transform duration-200",de.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Nf,2))]),de.value?(s(),o("div",Of,[(s(),o(ge,null,ye(ze,z=>e("button",{key:z.name,onClick:he(oe=>je(z.name),["stop"]),class:P(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",N.value===z.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},m(z.label),11,qf)),64))])):g("",!0)]),e("div",Vf,[e("div",Qf,[e("button",{onClick:he(G,["stop"]),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-purple-600 bg-purple-50 hover:bg-purple-100"},[r(t($t),{class:"h-5 w-5"}),ae(" Firma Electrónica ")])]),e("div",Wf,[e("button",{onClick:he(_e,["stop"]),disabled:t(h),class:P(["w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors",t(h)?"text-green-400 bg-gray-50 cursor-not-allowed opacity-60":"text-green-600 bg-green-50 hover:bg-green-100"])},[r(t(Qe),{class:"h-5 w-5"}),ae(" Membrete Global ")],10,Hf),t(h)?(s(),o("div",Gf,[ae(" Actualiza tu suscripción para usar esta funcionalidad "),Zf])):g("",!0)]),e("button",{onClick:n[7]||(n[7]=he(z=>Q("useDocument"),["stop"])),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[r(t(Ke),{class:"h-5 w-5"}),ae(" Nuevo Documento ")])])]),C.value==="useDocument"?(s(),o("div",Kf,[r(ls,{searchQuery:y.value,selectedTags:T.value,onGoBack:Re},null,8,["searchQuery","selectedTags"])])):(s(),o("div",Yf,[N.value==="folders"?(s(),ne(ns,{key:0,searchQuery:y.value,selectedTags:T.value,onRefresh:K,onNavigateToMain:Re},null,8,["searchQuery","selectedTags"])):N.value==="my-documents"?(s(),ne(qt,{key:1,searchQuery:y.value,"onUpdate:searchQuery":n[8]||(n[8]=z=>y.value=z),selectedTags:T.value,"is-loading":t(i).isLoading,"card-type":"client","show-state-filter":!0,"show-client-filter":!1,"show-associations-column":!0,context:"my-documents",onRefresh:K},null,8,["searchQuery","selectedTags","is-loading"])):N.value==="pending-signatures"?(s(),ne(ct,{key:2,state:"PendingSignatures",searchQuery:y.value,selectedTags:T.value,onRefresh:K,onOpenElectronicSignature:L,onDocumentFullySigned:le,onDocumentRejected:q},null,8,["searchQuery","selectedTags"])):N.value==="signed-documents"?(s(),ne(ct,{key:3,state:"FullySigned",searchQuery:y.value,selectedTags:T.value,onRefresh:K,onOpenElectronicSignature:L},null,8,["searchQuery","selectedTags"])):N.value==="archived-documents"?(s(),ne(ct,{key:4,state:"Archived",searchQuery:y.value,selectedTags:T.value,onRefresh:K,onOpenElectronicSignature:L},null,8,["searchQuery","selectedTags"])):g("",!0)]))])):g("",!0)])]),W.value?(s(),ne(Xe,{key:0},{default:M(()=>[r(Fp,{onClose:Z})]),_:1})):g("",!0),ie.value&&v.value?(s(),ne(Xe,{key:1},{default:M(()=>[e("div",Jf,[e("div",Xf,[e("div",ey,[ty,e("button",{onClick:n[9]||(n[9]=z=>ie.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[r(t(Me),{class:"h-6 w-6"})])]),e("div",sy,[r(Xt,{"user-id":v.value.id,"initial-show-options":!v.value.has_signature,onSignatureSaved:Ae,onCancel:n[10]||(n[10]=z=>ie.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):g("",!0),te.value&&v.value?(s(),ne(Xe,{key:2},{default:M(()=>[e("div",oy,[e("div",ay,[e("div",ry,[ny,e("button",{onClick:n[11]||(n[11]=z=>te.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[r(t(Me),{class:"h-6 w-6"})])]),e("div",ly,[r(Xt,{"user-id":v.value.id,"initial-show-options":!v.value.has_signature,onSignatureSaved:Ae,onCancel:n[12]||(n[12]=z=>te.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):g("",!0),r(Gt,{isVisible:t(nt),documentData:t(Ht),onClose:n[13]||(n[13]=z=>nt.value=!1)},null,8,["isVisible","documentData"]),r(qh,{isVisible:X.value,onClose:n[14]||(n[14]=z=>X.value=!1),onUploaded:pe,onDeleted:we},null,8,["isVisible"])],64)}}};export{Ry as default};
