import{e as o,f as i,g as e,u as Ie,r as A,aH as Re,o as te,ap as pe,c as P,j as b,l as m,G as re,w as ae,v as Fe,n as R,i as I,t as F,h as ue,p as O,s as G,ab as Je,k as X,b1 as ie,a8 as Qe,b5 as Ke,Q as ye,m as H,a1 as de,F as W,P as ne,N as fe,O as ve,D as xe,E as Ye,b6 as Xe,a0 as et,C as tt,T as Y,M as J,a as st,b7 as De,aS as Ce,b8 as Oe,ae as ot}from"./index.js";import{u as se,o as Ge,s as ce,p as Ee}from"./index2.js";import{g as ge,a as _e}from"./DocumentPermissionsManager.js";import{_ as rt}from"./SearchBarAndFilterBy.js";import{_ as be}from"./_plugin-vue_export-helper.js";import{r as nt}from"./ArrowDownTrayIcon.js";import{r as He}from"./TrashIcon.js";import{r as Te}from"./DocumentIcon.js";import{r as at}from"./PhotoIcon.js";import{r as qe}from"./InformationCircleIcon.js";import{r as We,b as lt,a as Le}from"./LinkIcon.js";import{r as it,a as ze}from"./MagnifyingGlassIcon.js";import{r as dt}from"./ExclamationTriangleIcon.js";import{r as me,_ as he}from"./DocumentCard.js";import{r as oe}from"./PlusIcon.js";import{r as Ve,a as ct}from"./TagIcon.js";import{B as ut,_ as Ue}from"./index3.js";import{r as mt}from"./EyeIcon.js";import{_ as Ae,S as Se}from"./SignaturesList.js";import{r as Me}from"./PencilIcon.js";import{useRecentViews as gt}from"./useRecentViews.js";import"./MagnifyingGlassIcon2.js";import"./loading_message.js";function ht(t,r){return o(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function pt(t,r){return o(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})])}const ft={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},vt={class:"flex justify-end"},bt=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[O(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),yt={class:"mt-2"},xt={class:"flex gap-2 mt-2.5"},_t=["disabled"],wt=e("span",null,"Actualizar nombre",-1),$t=[wt],kt=["disabled"],Dt={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(t,{emit:r}){const s=t,g=Ie(),p=se(),l=r,n=A(""),y=A(""),d=()=>{l("close")};Re(()=>{var u,v;p.selectedDocument?(n.value=((u=p.selectedDocument)==null?void 0:u.title)||"",y.value=((v=p.selectedDocument)==null?void 0:v.title)||""):(n.value="",y.value="")});const a=u=>{u.key==="Escape"&&d()};te(()=>{document.addEventListener("keydown",a)}),pe(()=>{document.removeEventListener("keydown",a)});const x=P(()=>n.value.trim().length>0),_=P(()=>{var u;return!!((u=p.selectedDocument)!=null&&u.id)}),k=P(()=>_.value&&n.value.trim()!==y.value.trim()&&n.value.trim().length>0);async function h(){if(_.value&&k.value)try{const u={title:n.value.trim()};await p.updateDocument(p.selectedDocument.id,u),y.value=n.value.trim(),p.selectedDocument.title=n.value.trim();const v=p.selectedDocument.id;G("Document name successfully updated.","success"),l("close",{updatedDocId:v});const U=window.location.pathname;U==="/dynamic_document_dashboard"||U==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(u){console.error("Error updating document name:",u),G("Error updating document name.","error")}}function w(){const u=encodeURIComponent(n.value.trim());s.documentId&&!p.selectedDocument?g.push(`/dynamic_document_dashboard/document/use/creator/${s.documentId}/${u}`):p.selectedDocument?(p.selectedDocument.title=n.value.trim(),g.push(`/dynamic_document_dashboard/document/use/editor/${p.selectedDocument.id}/${u}`)):G("Error: No se pudo continuar. Documento no seleccionado.","error")}return(u,v)=>(o(),i("div",ft,[e("div",vt,[e("button",{onClick:d},[b(m(re),{class:"size-6"})])]),e("form",{onSubmit:ue(w,["prevent"])},[e("div",null,[bt,e("div",yt,[ae(e("input",{"onUpdate:modelValue":v[0]||(v[0]=$=>n.value=$),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[Fe,n.value]])])]),e("div",xt,[_.value?(o(),i("button",{key:0,type:"button",onClick:h,disabled:!k.value,class:R(["p-2.5 text-sm font-medium rounded-md flex gap-2",k.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},$t,10,_t)):I("",!0),e("button",{type:"submit",class:R(["p-2.5 text-sm font-medium rounded-md flex gap-2",x.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!x.value},[e("span",null,F(_.value?"Editar Documento":"Continuar"),1)],10,kt)])],32)]))}},Ct={class:"mt-3 pt-2 border-t border-gray-100"},St={class:"flex items-center gap-2 text-xs text-gray-500"},It=e("span",null,"Hacer clic para usar este documento",-1),je={__name:"UseDocumentCard",props:{document:{type:Object,required:!0},showTags:{type:Boolean,default:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null}},emits:["click","remove-from-folder","document-created"],setup(t,{emit:r}){const s=t,g=r,p=A(!1),l=A(null),n=ge(9),y=P(()=>"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium !bg-purple-100 !text-purple-700 !border !border-purple-200"),d=P(()=>n.dark),a=P(()=>"group !border-purple-400 !bg-purple-50/50 !shadow-purple-100"),x=P(()=>s.menuOptions!==null?s.menuOptions:[{label:"Usar",action:"use",icon:pt,iconClasses:"w-4 h-4 text-purple-600"},{label:"Previsualizaci√≥n",action:"preview",icon:mt,iconClasses:"w-4 h-4 text-gray-600"}]),_=P(()=>!1),k=(v,$)=>{s.disableInternalActions?g("click",v,$):w(v.id)},h=(v,$)=>{switch(v){case"use":w($.id);break;case"preview":Ge($);break;default:console.warn("Unknown menu action:",v)}};function w(v){v?(l.value=v,p.value=!0):console.error("Document ID is required:",v)}function u(v){if(p.value=!1,l.value=null,v&&v.updatedDocId){g("document-created",v);const $=window.location.pathname;$==="/dynamic_document_dashboard"||$==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(v.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}}return(v,$)=>(o(),i(W,null,[b(ut,{document:t.document,"card-type":t.cardType,"card-context":t.cardContext,"status-icon":m(Ke),"status-text":"Disponible","status-badge-classes":y.value,"menu-options":x.value,"highlighted-doc-id":null,"show-tags":t.showTags,"document-store":t.documentStore,"user-store":t.userStore,"additional-classes":a.value,"disable-internal-actions":t.disableInternalActions,"show-menu-options":t.showMenuOptions,onClick:k,onMenuAction:h,onRemoveFromFolder:$[0]||($[0]=U=>v.$emit("remove-from-folder",U))},Je({"additional-actions":X(()=>[Qe(v.$slots,"additional-actions")]),_:2},[_.value?{name:"right-action",fn:X(()=>[b(m(We),{class:"w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors"})]),key:"0"}:void 0,t.disableInternalActions?void 0:{name:"footer",fn:X(()=>[e("div",Ct,[e("div",St,[e("div",{class:"w-2 h-2 rounded-full",style:ie({backgroundColor:d.value})},null,4),It])])]),key:"1"}]),1032,["document","card-type","card-context","status-icon","status-badge-classes","menu-options","show-tags","document-store","user-store","additional-classes","disable-internal-actions","show-menu-options"]),ae(b(de,null,{default:X(()=>[l.value!==null?(o(),H(Dt,{key:0,"document-id":l.value,onClose:u},null,8,["document-id"])):I("",!0)]),_:1},512),[[ye,p.value]])],64))}},we=t=>(fe("data-v-a52f6718"),t=t(),ve(),t),Ft={class:"flex items-start justify-between mb-4"},Et={class:"flex items-center gap-3"},Tt={class:"relative"},Lt={class:"flex-1 min-w-0"},Ut={class:"font-medium text-gray-900 text-sm truncate group-hover:text-primary transition-colors"},Mt={class:"text-xs text-gray-500 mt-0.5"},At={class:"relative folder-menu-container"},Bt={key:0,class:"absolute right-0 top-full mt-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50"},jt=we(()=>e("div",{class:"border-t border-gray-100 my-1"},null,-1)),Nt={class:"space-y-2"},Pt={key:0,class:"flex items-center gap-2"},qt=we(()=>e("div",{class:"w-2 h-2 bg-blue-500 rounded-full"},null,-1)),zt={class:"text-xs text-gray-600"},Vt={key:1,class:"flex items-center gap-2"},Rt=we(()=>e("div",{class:"w-2 h-2 bg-green-500 rounded-full"},null,-1)),Qt={class:"text-xs text-gray-600"},Ot={key:2,class:"flex items-center gap-2"},Gt=we(()=>e("div",{class:"w-2 h-2 bg-orange-500 rounded-full"},null,-1)),Ht={class:"text-xs text-gray-600"},Wt={key:3,class:"text-center py-3"},Zt=we(()=>e("p",{class:"text-xs text-gray-500"},"Carpeta vac√≠a",-1)),Jt={class:"mt-4 pt-3 border-t border-gray-100"},Kt={class:"flex items-center justify-between"},Yt={class:"text-xs text-gray-500"},Xt={__name:"FolderCard",props:{folder:{type:Object,required:!0}},emits:["click","edit","delete","add-documents"],setup(t,{emit:r}){const s=t,g=r,p=ne(),l=A(!1),n=A(!1),y=P(()=>p.currentUser),d=P(()=>ge(s.folder.color_id)||{hex:"#6B7280",name:"Gray"}),a=P(()=>s.folder.documents?s.folder.documents.length:0),x=P(()=>{if(!s.folder.documents)return{myDocuments:[],useDocuments:[],signatureDocuments:[]};const c=s.folder.documents;return{myDocuments:c.filter(D=>{var f;return D.assigned_to===((f=y.value)==null?void 0:f.id)&&(D.state==="Progress"||D.state==="Completed")}),useDocuments:c.filter(D=>D.state==="Published"&&!D.assigned_to),signatureDocuments:c.filter(D=>D.state==="PendingSignatures"||D.state==="FullySigned")}}),_=c=>{c.target.closest(".folder-menu-container")||n.value||l.value||g("click",s.folder)},k=()=>{l.value=!l.value},h=(c=!1)=>{l.value=!1,c&&(n.value=!0,setTimeout(()=>{n.value=!1},50))},w=()=>{h(!1),g("edit",s.folder)},u=()=>{h(!1),g("delete",s.folder)},v=()=>{h(!1),g("add-documents",s.folder)},$=c=>{if(!c)return"";const D=new Date(c),T=Math.abs(new Date-D),C=Math.floor(T/(1e3*60*60*24));if(C===0)return"hoy";if(C===1)return"ayer";if(C<7)return`hace ${C} d√≠as`;if(C<30){const E=Math.floor(C/7);return`hace ${E} ${E===1?"semana":"semanas"}`}else if(C<365){const E=Math.floor(C/30);return`hace ${E} ${E===1?"mes":"meses"}`}else return D.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},U=c=>{l.value&&!c.target.closest(".folder-menu-container")&&h(!0)};return te(()=>{document.addEventListener("click",U)}),pe(()=>{document.removeEventListener("click",U)}),(c,D)=>(o(),i("div",{class:"relative bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 p-5 cursor-pointer group",onClick:_},[e("div",Ft,[e("div",Et,[e("div",Tt,[b(m(me),{class:"w-10 h-10 text-gray-400",style:ie({color:d.value.hex})},null,8,["style"]),e("div",{class:"absolute -top-1 -right-1 w-4 h-4 rounded-full border-2 border-white shadow-sm",style:ie({backgroundColor:d.value.hex})},null,4)]),e("div",Lt,[e("h3",Ut,F(t.folder.name),1),e("p",Mt,F(a.value)+" "+F(a.value===1?"documento":"documentos"),1)])]),e("div",At,[e("button",{onClick:ue(k,["stop"]),class:R(["opacity-100 transition-opacity p-1.5 rounded-full hover:bg-gray-100",{"bg-gray-100":l.value}])},[b(m(lt),{class:"w-4 h-4 text-gray-500"})],2),l.value?(o(),i("div",Bt,[e("button",{onClick:ue(w,["stop"]),class:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[b(m(Me),{class:"w-4 h-4"}),O(" Editar carpeta ")]),e("button",{onClick:ue(v,["stop"]),class:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[b(m(oe),{class:"w-4 h-4"}),O(" Agregar documentos ")]),jt,e("button",{onClick:ue(u,["stop"]),class:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2"},[b(m(He),{class:"w-4 h-4"}),O(" Eliminar carpeta ")])])):I("",!0)])]),e("div",Nt,[x.value.myDocuments.length>0?(o(),i("div",Pt,[qt,e("span",zt,F(x.value.myDocuments.length)+" mis documentos ",1)])):I("",!0),x.value.useDocuments.length>0?(o(),i("div",Vt,[Rt,e("span",Qt,F(x.value.useDocuments.length)+" formatos disponibles ",1)])):I("",!0),x.value.signatureDocuments.length>0?(o(),i("div",Ot,[Gt,e("span",Ht,F(x.value.signatureDocuments.length)+" documentos con firmas ",1)])):I("",!0),a.value===0?(o(),i("div",Wt,[b(m(Te),{class:"w-8 h-8 text-gray-300 mx-auto mb-1"}),Zt])):I("",!0)]),e("div",Jt,[e("div",Kt,[e("span",Yt," Creada "+F($(t.folder.created_at)),1),b(m(We),{class:"w-4 h-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})])]),l.value?(o(),i("div",{key:0,onClick:h,class:"fixed inset-0 z-5"})):I("",!0)]))}},es=be(Xt,[["__scopeId","data-v-a52f6718"]]),ts=()=>({folders:[],currentFolder:null,isLoading:!1,error:null,lastUpdatedFolderId:null}),ss={sortedFolders:t=>[...t.folders].sort((r,s)=>new Date(s.created_at)-new Date(r.created_at)),getFolderById:t=>r=>t.folders.find(s=>s.id===r),getFoldersByColor:t=>r=>t.folders.filter(s=>s.color_id===r),getFolderWithColor:t=>r=>{const s=t.folders.find(g=>g.id===r);return s?{...s,color:ge(s.color_id)}:null},getFoldersContainingDocument:t=>r=>t.folders.filter(s=>s.document_ids&&s.document_ids.includes(r)),totalDocumentsInFolders:t=>t.folders.reduce((r,s)=>r+(s.document_ids?s.document_ids.length:0),0),hasFolders:t=>t.folders.length>0,availableColors:()=>_e()},os={async init(t=!1){if(!(this.folders.length>0&&!t)){this.isLoading=!0,this.error=null;try{await this.fetchFolders()}catch(r){console.error("Error initializing document folder store:",r),this.error="Error al inicializar las carpetas"}finally{this.isLoading=!1}}},async fetchFolders(){try{const t=await xe("dynamic-documents/folders/");if(t.status===200)return this.folders=t.data,t.data;throw new Error(`Error fetching folders: ${t.status}`)}catch(t){throw console.error("Error fetching folders:",t),this.error="Error al obtener las carpetas",t}},async fetchFolder(t){this.isLoading=!0,this.error=null;try{const r=await xe(`dynamic-documents/folders/${t}/`);if(r.status===200){const s=r.data,g=this.folders.findIndex(p=>p.id===s.id);return g!==-1?this.folders[g]=s:this.folders.push(s),this.currentFolder=s,s}else throw new Error(`Error fetching folder: ${r.status}`)}catch(r){throw console.error("Error fetching folder:",r),this.error="Error al obtener la carpeta",r}finally{this.isLoading=!1}},async createFolder(t){this.isLoading=!0,this.error=null;try{if(!t.name||t.name.trim()==="")throw new Error("El nombre de la carpeta es requerido");const r=t.color_id??0;if(r<0||r>=_e().length)throw new Error("Color de carpeta no v√°lido");const s={name:t.name.trim(),color_id:r,...t.document_ids&&{document_ids:t.document_ids}},g=await Ye("dynamic-documents/folders/create/",s);if(g.status===200||g.status===201){const p=g.data;return this.folders.push(p),this.lastUpdatedFolderId=p.id,await G("Carpeta creada exitosamente","success"),p}else throw new Error(`Error creating folder: ${g.status}`)}catch(r){throw console.error("Error creating folder:",r),this.error=r.message||"Error al crear la carpeta",await G(this.error,"error"),r}finally{this.isLoading=!1}},async updateFolder(t,r){this.isLoading=!0,this.error=null;try{if(r.name&&r.name.trim()==="")throw new Error("El nombre de la carpeta no puede estar vac√≠o");if(r.color_id!==void 0){const p=r.color_id;if(p<0||p>=_e().length)throw new Error("Color de carpeta no v√°lido")}const s={};r.name&&(s.name=r.name.trim()),r.color_id!==void 0&&(s.color_id=r.color_id),r.document_ids!==void 0&&(s.document_ids=r.document_ids);const g=await Xe(`dynamic-documents/folders/${t}/update/`,s);if(g.status===200){const p=g.data,l=this.folders.findIndex(n=>n.id===t);return l!==-1&&(this.folders[l]=p),this.currentFolder&&this.currentFolder.id===t&&(this.currentFolder=p),this.lastUpdatedFolderId=t,await G("Carpeta actualizada exitosamente","success"),p}else throw new Error(`Error updating folder: ${g.status}`)}catch(s){throw console.error("Error updating folder:",s),this.error=s.message||"Error al actualizar la carpeta",await G(this.error,"error"),s}finally{this.isLoading=!1}},async deleteFolder(t){this.isLoading=!0,this.error=null;try{const r=await et(`dynamic-documents/folders/${t}/delete/`);if(r.status===204||r.status===200)return this.folders=this.folders.filter(s=>s.id!==t),this.currentFolder&&this.currentFolder.id===t&&(this.currentFolder=null),await G("Carpeta eliminada exitosamente","success"),!0;throw new Error(`Error deleting folder: ${r.status}`)}catch(r){throw console.error("Error deleting folder:",r),this.error=r.message||"Error al eliminar la carpeta",await G(this.error,"error"),r}finally{this.isLoading=!1}},setCurrentFolder(t){this.currentFolder=t},clearCurrentFolder(){this.currentFolder=null},reset(){this.folders=[],this.currentFolder=null,this.isLoading=!1,this.error=null,this.lastUpdatedFolderId=null}},rs={async addDocumentsToFolder(t,r){const s=this.getFolderById(t);if(!s)throw new Error("Carpeta no encontrada");const g=s.document_ids||[],p=[...new Set([...g,...r])];return await this.updateFolder(t,{document_ids:p})},async removeDocumentsFromFolder(t,r){const s=this.getFolderById(t);if(!s)throw new Error("Carpeta no encontrada");const p=(s.document_ids||[]).filter(l=>!r.includes(l));return await this.updateFolder(t,{document_ids:p})},async moveDocumentsBetweenFolders(t,r,s){try{r&&await this.removeDocumentsFromFolder(r,t),s&&await this.addDocumentsToFolder(s,t),await G("Documentos movidos exitosamente","success")}catch(g){throw console.error("Error moving documents between folders:",g),await G("Error al mover documentos","error"),g}},getFolderColor(t){const r=this.getFolderById(t);return r?ge(r.color_id):ge(0)},validateFolderData(t){const r=[];if((!t.name||t.name.trim()==="")&&r.push("El nombre de la carpeta es requerido"),t.name&&t.name.length>100&&r.push("El nombre de la carpeta no puede exceder 100 caracteres"),t.color_id!==void 0){const s=t.color_id;(s<0||s>=_e().length)&&r.push("Color de carpeta no v√°lido")}return t.document_ids&&!Array.isArray(t.document_ids)&&r.push("Los IDs de documentos deben ser un array"),{isValid:r.length===0,errors:r}}},Ne=tt("documentFolder",{state:ts,getters:ss,actions:{...os,...rs}}),ee=t=>(fe("data-v-7e31361f"),t=t(),ve(),t),ns={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},as={class:"px-6 py-4 border-b border-gray-200"},ls=ee(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gesti√≥n de Membrete Global",-1)),is=ee(()=>e("p",{class:"text-sm text-gray-500 mt-1"}," Este membrete se aplicar√° por defecto a todos tus documentos ",-1)),ds={class:"p-6 overflow-y-auto flex-grow"},cs={key:0,class:"text-center py-10"},us=ee(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),ms={class:"mt-4 text-gray-500"},gs={key:1,class:"space-y-6"},hs={key:0,class:"space-y-4"},ps=ee(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete Global Actual",-1)),fs={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},vs=["src"],bs={class:"mt-4 flex justify-center space-x-3"},ys=["disabled"],xs={key:1,class:"text-center py-8"},_s=ee(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete Global",-1)),ws=ee(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," No tienes una imagen de membrete global configurada. ",-1)),$s=ee(()=>e("p",{class:"mt-1 text-xs text-gray-400"}," El membrete global se aplicar√° a todos los documentos que no tengan un membrete espec√≠fico. ",-1)),ks={class:"space-y-4"},Ds={class:"text-lg font-medium text-gray-900"},Cs={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},Ss={key:0},Is={class:"mt-4"},Fs=ee(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, m√°ximo 10MB ",-1)),Es=ee(()=>e("p",{class:"text-xs text-gray-400 mt-1"}," Dimensiones ideales: 612 √ó 612 p√≠xeles (8.5:11 Carta) ",-1)),Ts={key:1,class:"space-y-4"},Ls={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Us={class:"text-gray-400"},Ms={key:0,class:"mt-4"},As=["src"],Bs={class:"flex justify-center space-x-3"},js=["disabled"],Ns={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Ps={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},qs={class:"flex items-center space-x-2"},zs=ee(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete Global",-1)),Vs=ee(()=>e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-yellow-800 mb-2"},"üîÑ Prioridad de Membrete"),e("div",{class:"text-sm text-yellow-700 space-y-1"},[e("div",null,[e("strong",null,"1¬∫ Prioridad:"),O(" Membrete espec√≠fico del documento")]),e("div",null,[e("strong",null,"2¬∫ Prioridad:"),O(" Membrete global del usuario (este)")]),e("div",null,[e("strong",null,"3¬∫ Prioridad:"),O(" Sin membrete")])])],-1)),Rs=ee(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"üìê Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"612 p√≠xeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"612 p√≠xeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporci√≥n:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"¬±10%")])])])],-1)),Qs=ee(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"üé® Distribuci√≥n Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"‚ö†Ô∏è ZONA CR√çTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mant√©n semi-transparente. El texto del documento se superpone aqu√≠.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, tel√©fonos, emails, informaci√≥n de contacto.")])])])])])],-1)),Os=ee(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"üîß Consideraciones T√©cnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"‚Ä¢"),e("span",null,[e("strong",null,"Posicionamiento:"),O(" La imagen se centra autom√°ticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"‚Ä¢"),e("span",null,[e("strong",null,"Transparencia:"),O(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"‚Ä¢"),e("span",null,[e("strong",null,"M√°rgenes:"),O(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"‚Ä¢"),e("span",null,[e("strong",null,"Resoluci√≥n:"),O(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"‚ö†Ô∏è"),e("span",null,[e("strong",null,"Zona cr√≠tica:"),O(" Evita elementos gr√°ficos densos en el centro (300-400px de altura)")])])])])],-1)),Gs=ee(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"üí° Tips de Dise√±o R√°pido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"‚Ä¢ Si solo tienes header, ub√≠calo en los primeros 120-150px"),e("div",null,"‚Ä¢ El resto de la imagen debe ser transparente o blanco"),e("div",null,"‚Ä¢ Para footer, usa los √∫ltimos 80-120px"),e("div",null,"‚Ä¢ El texto se superpone en toda la imagen, mant√©n el centro claro")])],-1)),Hs={key:3,class:"space-y-2"},Ws={class:"flex"},Zs={class:"text-sm text-yellow-700"},Js={__name:"GlobalLetterheadModal",props:{isVisible:{type:Boolean,default:!1}},emits:["close","uploaded","deleted"],setup(t,{emit:r}){const s=t,g=r,p=se(),l=A(!1),n=A(""),y=A(!1),d=A(!1),a=A(null),x=A(null),_=A(null),k=A([]),h=A(null),w=A(!1),u=()=>{U(),g("close")},v=j=>{const q=j.target.files[0];if(!q)return;if(!q.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(q.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}a.value=q,k.value=[];const M=new FileReader;M.onload=S=>{x.value=S.target.result;const N=new Image;N.onload=()=>{$(N.width,N.height)},N.src=S.target.result},M.readAsDataURL(q)},$=(j,q)=>{const V=j/q,z=612/612,B=Math.abs(V-z)/z;if(j===612&&q===612){k.value.push("‚úÖ Dimensiones perfectas: 612 √ó 612 p√≠xeles");return}B<=.1?(k.value.push(`‚ÑπÔ∏è Buenas proporciones detectadas: ${j} √ó ${q} p√≠xeles (${V.toFixed(3)})`),(j!==612||q!==612)&&k.value.push("üí° Para mejores resultados, usa exactamente 612 √ó 612 p√≠xeles")):(k.value.push(`‚ö†Ô∏è Proporciones no ideales: ${j} √ó ${q} p√≠xeles (${V.toFixed(3)})`),k.value.push(`üéØ Proporciones recomendadas: ${z.toFixed(3)} (8.5:11)`),k.value.push("üìê Considera redimensionar tu imagen a 612 √ó 612 p√≠xeles")),(j<300||q<300)&&k.value.push("‚ö†Ô∏è Imagen muy peque√±a - puede verse pixelada en documentos"),(j>1200||q>1600)&&k.value.push("‚ÑπÔ∏è Imagen muy grande - se redimensionar√° autom√°ticamente")},U=()=>{a.value=null,x.value=null,k.value=[],w.value=!1,h.value&&(h.value.value="")},c=async()=>{var j;if(a.value){y.value=!0,k.value=[];try{const q=await p.uploadGlobalLetterheadImage(a.value);(j=q.data)!=null&&j.warnings&&q.data.warnings.length>0&&(k.value=q.data.warnings),await D(),U(),g("uploaded",q.data)}catch(q){console.error("Error uploading global letterhead:",q),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{y.value=!1}}},D=async()=>{try{const j=await p.getGlobalLetterheadImage();j.data&&(_.value=URL.createObjectURL(j.data))}catch{_.value=null}},f=()=>{confirm("¬øEst√°s seguro de que deseas eliminar la imagen de membrete global?")&&T()},T=async()=>{d.value=!0;try{await p.deleteGlobalLetterheadImage(),_.value&&URL.revokeObjectURL(_.value),_.value=null,g("deleted")}catch(j){console.error("Error deleting global letterhead:",j),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{d.value=!1}},C=()=>{if(_.value){const j=document.createElement("a");j.href=_.value,j.download="membrete-global.png",document.body.appendChild(j),j.click(),document.body.removeChild(j)}},E=()=>{_.value=null},L=j=>{if(j===0)return"0 Bytes";const q=1024,M=["Bytes","KB","MB","GB"],S=Math.floor(Math.log(j)/Math.log(q));return parseFloat((j/Math.pow(q,S)).toFixed(2))+" "+M[S]};Y(()=>s.isVisible,j=>{j&&D()});const Q=()=>{_.value&&URL.revokeObjectURL(_.value),x.value&&URL.revokeObjectURL(x.value)};return te(()=>{s.isVisible&&D()}),pe(Q),(j,q)=>ae((o(),H(de,null,{default:X(()=>[e("div",ns,[e("div",as,[ls,is,e("button",{onClick:u,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[b(m(re),{class:"h-6 w-6"})])]),e("div",ds,[l.value?(o(),i("div",cs,[us,e("p",ms,F(n.value),1)])):(o(),i("div",gs,[_.value?(o(),i("div",hs,[ps,e("div",fs,[e("img",{src:_.value,alt:"Membrete global actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:E},null,40,vs),e("div",bs,[e("button",{onClick:C,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[b(m(nt),{class:"h-4 w-4 mr-2"}),O(" Descargar ")]),e("button",{onClick:f,disabled:d.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[b(m(He),{class:"h-4 w-4 mr-2"}),O(" "+F(d.value?"Eliminando...":"Eliminar"),1)],8,ys)])])])):(o(),i("div",xs,[b(m(Te),{class:"mx-auto h-12 w-12 text-gray-400"}),_s,ws,$s])),e("div",ks,[e("h3",Ds,F(_.value?"Reemplazar Membrete Global":"Subir Membrete Global"),1),e("div",Cs,[e("input",{ref_key:"fileInput",ref:h,type:"file",accept:".png",onChange:v,class:"hidden"},null,544),a.value?(o(),i("div",Ts,[e("div",Ls,[b(m(Le),{class:"h-5 w-5 text-green-500"}),e("span",null,F(a.value.name),1),e("span",Us,"("+F(L(a.value.size))+")",1)]),x.value?(o(),i("div",Ms,[e("img",{src:x.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,As)])):I("",!0),e("div",Bs,[e("button",{onClick:U,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:c,disabled:y.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[y.value?(o(),i("div",Ns)):(o(),H(m(it),{key:0,class:"h-4 w-4 mr-2"})),O(" "+F(y.value?"Subiendo...":"Subir Imagen"),1)],8,js)])])):(o(),i("div",Ss,[b(m(at),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Is,[e("button",{onClick:q[0]||(q[0]=M=>j.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG "),e("button",{onClick:q[1]||(q[1]=M=>w.value=!w.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[b(m(qe),{class:"h-4 w-4 mr-2"}),O(" "+F(w.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),Fs,Es]))])]),w.value?(o(),i("div",Ps,[e("div",qs,[b(m(qe),{class:"h-6 w-6 text-blue-600"}),zs]),Vs,Rs,Qs,Os,Gs])):I("",!0),k.value.length>0?(o(),i("div",Hs,[(o(!0),i(W,null,J(k.value,(M,S)=>(o(),i("div",{key:S,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",Ws,[b(m(dt),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",Zs,F(M),1)])]))),128))])):I("",!0)]))])])]),_:1},512)),[[ye,t.isVisible]])}},Ks=be(Js,[["__scopeId","data-v-7e31361f"]]),Ys={key:0,class:"pb-6 border-b border-gray-200"},Xs={class:"hidden sm:flex gap-4 lg:gap-6"},eo=e("div",{class:"grid min-w-0"},[e("span",{class:"font-medium text-base truncate"},"Minutas y Documentos"),e("span",{class:"text-gray-400 font-regular text-sm truncate"},"Mi unidad")],-1),to=e("div",{class:"grid min-w-0"},[e("span",{class:"font-medium text-base truncate"},"Firma Electr√≥nica"),e("span",{class:"text-gray-400 font-regular text-sm truncate"},"Documentos")],-1),so=e("div",{class:"grid min-w-0"},[e("span",{class:"font-medium text-base truncate"},"Membrete Global"),e("span",{class:"text-gray-400 font-regular text-sm truncate"},"Para todos los documentos")],-1),oo=e("div",{class:"grid"},[e("span",{class:"font-medium text-base"},"Nueva Minuta")],-1),ro={class:"sm:hidden space-y-3"},no=e("div",{class:"grid"},[e("span",{class:"font-semibold text-lg"},"Minutas y Documentos"),e("span",{class:"text-gray-500 font-regular text-sm"},"Mi unidad")],-1),ao={class:"grid grid-cols-3 gap-3"},lo=e("span",{class:"font-medium text-sm leading-tight"},"Firma Electr√≥nica",-1),io=e("span",{class:"font-medium text-sm leading-tight"},"Membrete Global",-1),co=e("span",{class:"font-medium text-sm leading-tight"},"Nueva Minuta",-1),uo={key:1,class:"pb-6 border-b border-gray-200"},mo={class:"hidden sm:flex gap-4 lg:gap-6"},go=e("div",{class:"grid"},[e("span",{class:"font-medium text-base truncate"},"Mis Documentos")],-1),ho=e("div",{class:"grid"},[e("span",{class:"font-medium text-base truncate"},"Firma Electr√≥nica")],-1),po=e("div",{class:"grid min-w-0"},[e("span",{class:"font-medium text-base truncate"},"Membrete Global"),e("span",{class:"text-gray-400 font-regular text-sm truncate"},"Para todos los documentos")],-1),fo=e("div",{class:"grid"},[e("span",{class:"font-medium text-base"},"Nuevo Documento")],-1),vo={class:"sm:hidden space-y-3"},bo=e("div",{class:"grid"},[e("span",{class:"font-semibold text-lg"},"Mis Documentos")],-1),yo={class:"grid grid-cols-3 gap-3"},xo=e("span",{class:"font-medium text-sm leading-tight"},"Firma Electr√≥nica",-1),_o=e("span",{class:"font-medium text-sm leading-tight"},"Membrete Global",-1),wo=e("span",{class:"font-medium text-sm leading-tight"},"Nuevo Documento",-1),$o={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-auto"},ko={class:"flex justify-between items-center mb-4"},Do=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electr√≥nica",-1),Co={__name:"DocumentsNavigation",props:{role:String},emits:["updateCurrentSection","openNewDocument","globalLetterheadUploaded","globalLetterheadDeleted"],setup(t,{emit:r}){ne();const s=st();te(async()=>{});const g=r,p=A("default"),l=A(!1),n=A(!1),y=t,d=k=>{p.value=k,g("updateCurrentSection",k)},a=async k=>{try{s.userAuth&&(s.userAuth.has_signature=!0,s.saveToLocalStorageAuth()),G("Firma electr√≥nica guardada correctamente","success"),l.value=!1}catch(h){console.error("Error updating signature information:",h),G("Hubo un problema al guardar la firma","error")}},x=k=>{G("Membrete global subido correctamente","success"),g("globalLetterheadUploaded",k)},_=()=>{G("Membrete global eliminado correctamente","success"),g("globalLetterheadDeleted")};return(k,h)=>(o(),i(W,null,[(y==null?void 0:y.role)==="lawyer"?(o(),i("div",Ys,[e("div",Xs,[e("button",{onClick:h[0]||(h[0]=w=>d("default")),class:R(["flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-yellow-300 text-start bg-white transition-all duration-200 hover:shadow-md flex-1 min-w-0",{"bg-yellow-300/30 shadow-md":p.value=="default"}])},[b(m(me),{class:"size-6 text-yellow-500 font-semibold flex-shrink-0"}),eo],2),e("button",{onClick:h[1]||(h[1]=w=>l.value=!0),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-purple-300 bg-white text-start transition-all duration-200 hover:bg-purple-50 hover:shadow-md flex-1 min-w-0"},[b(m(De),{class:"size-6 text-purple-500 font-semibold flex-shrink-0"}),to]),e("button",{onClick:h[2]||(h[2]=w=>n.value=!0),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-green-300 bg-white text-start transition-all duration-200 hover:bg-green-50 hover:shadow-md flex-1 min-w-0"},[b(m(Ce),{class:"size-6 text-green-500 font-semibold flex-shrink-0"}),so]),e("button",{onClick:h[3]||(h[3]=w=>k.$emit("openNewDocument")),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-gray-200 bg-white text-start transition-all duration-200 hover:bg-gray-50 hover:shadow-md hover:border-secondary"},[b(m(oe),{class:"size-6 text-secondary font-semibold flex-shrink-0"}),oo])]),e("div",ro,[e("button",{onClick:h[4]||(h[4]=w=>d("default")),class:R(["w-full flex gap-3 items-center py-4 px-4 rounded-xl border-2 border-yellow-300 text-start bg-white transition-all duration-200",{"bg-yellow-300/30 shadow-md":p.value=="default"}])},[b(m(me),{class:"size-7 text-yellow-500 font-semibold flex-shrink-0"}),no],2),e("div",ao,[e("button",{onClick:h[5]||(h[5]=w=>l.value=!0),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-purple-300 bg-white text-center transition-all duration-200 hover:bg-purple-50 min-h-[90px]"},[b(m(De),{class:"size-8 text-purple-500 font-semibold mb-2"}),lo]),e("button",{onClick:h[6]||(h[6]=w=>n.value=!0),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-green-300 bg-white text-center transition-all duration-200 hover:bg-green-50 min-h-[90px]"},[b(m(Ce),{class:"size-8 text-green-500 font-semibold mb-2"}),io]),e("button",{onClick:h[7]||(h[7]=w=>k.$emit("openNewDocument")),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-gray-200 bg-white text-center transition-all duration-200 hover:bg-gray-50 hover:border-secondary min-h-[90px]"},[b(m(oe),{class:"size-8 text-secondary font-semibold mb-2"}),co])])])])):I("",!0),(y==null?void 0:y.role)==="client"?(o(),i("div",uo,[e("div",mo,[e("button",{onClick:h[8]||(h[8]=w=>d("default")),class:R(["flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-yellow-300 bg-white text-start transition-all duration-200 hover:shadow-md flex-1 min-w-0",{"bg-yellow-300/30 shadow-md":p.value=="default"}])},[b(m(me),{class:"size-6 text-yellow-500 font-semibold flex-shrink-0"}),go],2),e("button",{onClick:h[9]||(h[9]=w=>l.value=!0),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-purple-300 bg-white text-start transition-all duration-200 hover:bg-purple-50 hover:shadow-md flex-1 min-w-0"},[b(m(De),{class:"size-6 text-purple-500 font-semibold flex-shrink-0"}),ho]),e("button",{onClick:h[10]||(h[10]=w=>n.value=!0),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-green-300 bg-white text-start transition-all duration-200 hover:bg-green-50 hover:shadow-md flex-1 min-w-0"},[b(m(Ce),{class:"size-6 text-green-500 font-semibold flex-shrink-0"}),po]),e("button",{onClick:h[11]||(h[11]=w=>d("useDocument")),class:R(["flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-gray-200 bg-white text-start transition-all duration-200 hover:bg-gray-50 hover:shadow-md hover:border-secondary",{"bg-selected-background border-secondary":p.value=="useDocument"}])},[b(m(oe),{class:"size-6 text-secondary font-semibold flex-shrink-0"}),fo],2)]),e("div",vo,[e("button",{onClick:h[12]||(h[12]=w=>d("default")),class:R(["w-full flex gap-3 items-center py-4 px-4 rounded-xl border-2 border-yellow-300 text-start bg-white transition-all duration-200",{"bg-yellow-300/30 shadow-md":p.value=="default"}])},[b(m(me),{class:"size-7 text-yellow-500 font-semibold flex-shrink-0"}),bo],2),e("div",yo,[e("button",{onClick:h[13]||(h[13]=w=>l.value=!0),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-purple-300 bg-white text-center transition-all duration-200 hover:bg-purple-50 min-h-[90px]"},[b(m(De),{class:"size-8 text-purple-500 font-semibold mb-2"}),xo]),e("button",{onClick:h[14]||(h[14]=w=>n.value=!0),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-green-300 bg-white text-center transition-all duration-200 hover:bg-green-50 min-h-[90px]"},[b(m(Ce),{class:"size-8 text-green-500 font-semibold mb-2"}),_o]),e("button",{onClick:h[15]||(h[15]=w=>d("useDocument")),class:R(["flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-gray-200 bg-white text-center transition-all duration-200 hover:bg-gray-50 hover:border-secondary min-h-[90px]",{"bg-selected-background border-secondary":p.value=="useDocument"}])},[b(m(oe),{class:"size-8 text-secondary font-semibold mb-2"}),wo],2)])])])):I("",!0),l.value?(o(),H(de,{key:2},{default:X(()=>[e("div",$o,[e("div",ko,[Do,e("button",{onClick:h[16]||(h[16]=w=>l.value=!1),class:"text-gray-400 hover:text-gray-500"},[b(m(re),{class:"h-6 w-6"})])]),b(Oe,{initialShowOptions:!0,"user-id":m(s).userAuth.id,onSignatureSaved:a,onCancel:h[17]||(h[17]=w=>l.value=!1)},null,8,["user-id"])])]),_:1})):I("",!0),b(Ks,{"is-visible":n.value,onClose:h[18]||(h[18]=w=>n.value=!1),onUploaded:x,onDeleted:_},null,8,["is-visible"])],64))}},$e=t=>(fe("data-v-d403a707"),t=t(),ve(),t),So={class:"tag-filter-container"},Io={class:"relative"},Fo={class:"flex items-center"},Eo={key:0,class:"ml-2 inline-flex items-center justify-center h-5 w-5 bg-primary text-white text-xs rounded-full font-medium"},To={key:0,class:"absolute left-0 mt-2 w-full sm:w-80 bg-white rounded-xl shadow-xl ring-1 ring-black ring-opacity-5 border border-gray-100 z-50 overflow-hidden"},Lo={class:"bg-gray-50 p-4 border-b border-gray-200"},Uo={class:"flex items-center justify-between mb-3"},Mo=$e(()=>e("h3",{class:"text-sm font-semibold text-gray-900"},"Filtrar por etiquetas",-1)),Ao={key:0,class:"text-xs text-gray-500"},Bo={class:"relative"},jo={key:0,class:"px-4 py-2 bg-blue-50 border-b border-blue-100"},No={class:"flex items-center justify-between"},Po={class:"text-xs font-medium text-blue-700"},qo={class:"max-h-52 overflow-y-auto"},zo={key:0,class:"px-4 py-8 text-center"},Vo=$e(()=>e("p",{class:"text-gray-500 text-sm"},"No hay etiquetas disponibles",-1)),Ro={key:1,class:"px-4 py-8 text-center"},Qo={class:"text-gray-500 text-sm"},Oo={key:2,class:"px-4 py-8 text-center"},Go=$e(()=>e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"}),e("span",{class:"ml-3 text-sm text-gray-600"},"Cargando etiquetas...")],-1)),Ho=[Go],Wo={key:3,class:"py-2"},Zo=["onClick"],Jo={class:"flex items-center h-5"},Ko={class:"relative"},Yo=["id","checked","onChange"],Xo={key:0,class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},er=$e(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),tr=[er],sr={class:"ml-3 flex items-center flex-1 min-w-0"},or={class:"text-sm font-medium text-gray-900 truncate"},rr={key:0,class:"mt-4"},nr={class:"flex items-start gap-2"},ar=$e(()=>e("span",{class:"text-xs font-medium text-gray-500 mt-1.5 flex-shrink-0"},"Activos:",-1)),lr={class:"flex flex-wrap gap-2"},ir=["onClick"],dr={class:"mr-1"},cr={class:"ml-1 p-0.5 rounded-full hover:bg-white/50 transition-colors duration-150"},ur={__name:"TagFilter",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(t,{emit:r}){const s=t,g=r,p=se(),l=A(!1),n=A([]),y=A(!1),d=A(""),a=P(()=>p.sortedTags),x=P(()=>{if(!d.value.trim())return a.value;const $=d.value.toLowerCase().trim();return a.value.filter(U=>U.name.toLowerCase().includes($))}),_=$=>{const U=ge($.color_id);return{hex:U&&U.hex?U.hex:"#9CA3AF",dark:U&&U.dark?U.dark:"#374151"}},k=()=>{l.value=!l.value,l.value&&(d.value="")},h=$=>n.value.some(U=>U.id===$.id),w=$=>{const U=n.value.findIndex(c=>c.id===$.id);U>=0?n.value.splice(U,1):n.value.push($),g("update:modelValue",n.value)},u=()=>{n.value=[],g("update:modelValue",[])},v=$=>{$.target.closest(".tag-filter-container")||(l.value=!1,d.value="")};return te(async()=>{try{y.value=!0,await p.initTags()}catch($){console.error("Error loading tags:",$)}finally{y.value=!1}document.addEventListener("click",v)}),Y(()=>s.modelValue,$=>{n.value=$||[]},{immediate:!0}),pe(()=>{document.removeEventListener("click",v)}),($,U)=>(o(),i("div",So,[e("div",Io,[e("button",{onClick:k,class:R(["group inline-flex items-center justify-between w-full sm:w-auto sm:min-w-[200px] px-4 py-3 border border-gray-200 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-primary transition-all duration-200",{"ring-2 ring-primary border-primary bg-blue-50":l.value,"border-primary bg-primary/5":n.value.length>0&&!l.value}])},[e("div",Fo,[b(m(Ve),{class:R(["h-5 w-5 mr-2.5 text-gray-500 group-hover:text-gray-600",{"text-primary":n.value.length>0||l.value}])},null,8,["class"]),e("span",{class:R(["text-gray-700",{"text-primary font-semibold":n.value.length>0||l.value}])}," Filtrar por etiquetas ",2),n.value.length>0?(o(),i("span",Eo,F(n.value.length),1)):I("",!0)]),b(m(ht),{class:R(["ml-3 h-4 w-4 text-gray-400 transition-all duration-200 group-hover:text-gray-600",{"rotate-180 text-primary":l.value,"text-primary":n.value.length>0&&!l.value}])},null,8,["class"])],2),b(ot,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:X(()=>[l.value?(o(),i("div",To,[e("div",Lo,[e("div",Uo,[Mo,a.value.length>0?(o(),i("span",Ao,F(a.value.length)+" disponibles ",1)):I("",!0)]),e("div",Bo,[b(m(ze),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),ae(e("input",{"onUpdate:modelValue":U[0]||(U[0]=c=>d.value=c),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"},null,512),[[Fe,d.value]])])]),n.value.length>0?(o(),i("div",jo,[e("div",No,[e("span",Po,F(n.value.length)+" etiqueta"+F(n.value.length!==1?"s":"")+" seleccionada"+F(n.value.length!==1?"s":""),1),e("button",{onClick:u,class:"text-xs text-red-600 hover:text-red-700 font-medium px-2 py-1 rounded-md hover:bg-red-50 transition-all duration-200"}," Limpiar todo ")])])):I("",!0),e("div",qo,[!y.value&&x.value.length===0&&d.value.trim()===""?(o(),i("div",zo,[b(m(Ve),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),Vo])):I("",!0),!y.value&&x.value.length===0&&d.value.trim()!==""?(o(),i("div",Ro,[b(m(ze),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e("p",Qo,'Sin resultados para "'+F(d.value)+'"',1),e("button",{onClick:U[1]||(U[1]=c=>d.value=""),class:"text-xs text-primary hover:text-primary-dark mt-2 font-medium"}," Ver todas las etiquetas ")])):I("",!0),y.value?(o(),i("div",Oo,Ho)):I("",!0),!y.value&&x.value.length>0?(o(),i("div",Wo,[(o(!0),i(W,null,J(x.value,c=>(o(),i("div",{key:c.id,class:"group flex items-center px-4 py-2.5 hover:bg-gray-50 cursor-pointer transition-colors duration-150",onClick:D=>w(c)},[e("div",Jo,[e("div",Ko,[e("input",{id:`tag-${c.id}`,type:"checkbox",checked:h(c),onChange:D=>w(c),class:"sr-only"},null,40,Yo),e("div",{class:R(["w-4 h-4 border-2 rounded transition-all duration-200 flex items-center justify-center",h(c)?"bg-primary border-primary":"border-gray-300 group-hover:border-gray-400"])},[h(c)?(o(),i("svg",Xo,tr)):I("",!0)],2)])]),e("div",sr,[e("div",{class:"w-3 h-3 rounded-full mr-2.5 border flex-shrink-0 shadow-sm",style:ie({backgroundColor:_(c).hex})},null,4),e("span",or,F(c.name),1)])],8,Zo))),128))])):I("",!0)])])):I("",!0)]),_:1})]),n.value.length>0?(o(),i("div",rr,[e("div",nr,[ar,e("div",lr,[(o(!0),i(W,null,J(n.value,c=>(o(),i("div",{key:c.id,class:"group inline-flex items-center pl-2.5 pr-1.5 py-1.5 rounded-lg text-xs font-medium border shadow-sm cursor-pointer transition-all duration-200 hover:shadow-md",style:ie({backgroundColor:_(c).hex+"20",borderColor:_(c).hex+"40",color:_(c).dark}),onClick:D=>w(c)},[e("div",{class:"w-2 h-2 rounded-full mr-2 flex-shrink-0",style:ie({backgroundColor:_(c).hex})},null,4),e("span",dr,F(c.name),1),e("div",cr,[b(m(re),{class:"h-3 w-3 opacity-60 group-hover:opacity-100"})])],12,ir))),128))])])])):I("",!0)]))}},Be=be(ur,[["__scopeId","data-v-d403a707"]]),mr={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},gr={class:"bg-white rounded-xl shadow-xl max-w-md w-full"},hr={class:"flex justify-between items-center p-6 border-b"},pr={class:"text-lg font-semibold text-gray-900"},fr={class:"mb-4"},vr=e("label",{for:"folderName",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la carpeta ",-1),br={class:"mb-6"},yr=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Color de la carpeta ",-1),xr={class:"grid grid-cols-8 gap-2"},_r=["onClick","title"],wr={class:"flex gap-3"},$r=["disabled"],kr={__name:"CreateEditFolderModal",props:{isVisible:{type:Boolean,required:!0},editingFolder:{type:Object,default:null}},emits:["close","success"],setup(t,{emit:r}){const s=t,g=r,p=Ne(),l=A(!1),n=A({name:"",color_id:0}),y=P(()=>_e()),d=()=>{n.value={name:"",color_id:0}};Y(()=>s.editingFolder,_=>{_?n.value={name:_.name,color_id:_.color_id}:d()},{immediate:!0}),Y(()=>s.isVisible,_=>{_||d()});const a=()=>{g("close")},x=async()=>{if(n.value.name.trim()){l.value=!0;try{s.editingFolder?(await p.updateFolder(s.editingFolder.id,n.value),G("Carpeta actualizada correctamente","success")):(await p.createFolder(n.value),G("Carpeta creada correctamente","success")),g("success")}catch(_){const k=s.editingFolder?"actualizar":"crear";G(`Error al ${k} la carpeta`,"error"),console.error(`Error ${k} folder:`,_)}finally{l.value=!1}}};return(_,k)=>t.isVisible?(o(),H(de,{key:0},{default:X(()=>[e("div",mr,[e("div",gr,[e("div",hr,[e("h3",pr,F(t.editingFolder?"Editar Carpeta":"Nueva Carpeta"),1),e("button",{onClick:a,class:"text-gray-400 hover:text-gray-500"},[b(m(re),{class:"w-6 h-6"})])]),e("form",{onSubmit:ue(x,["prevent"]),class:"p-6"},[e("div",fr,[vr,ae(e("input",{id:"folderName","onUpdate:modelValue":k[0]||(k[0]=h=>n.value.name=h),type:"text",required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ej: Contratos Laborales"},null,512),[[Fe,n.value.name]])]),e("div",br,[yr,e("div",xr,[(o(!0),i(W,null,J(y.value,h=>(o(),i("button",{key:h.id,type:"button",onClick:w=>n.value.color_id=h.id,class:R(["w-8 h-8 rounded-full border-2 transition-all",n.value.color_id===h.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"]),style:ie({backgroundColor:h.hex}),title:h.name},null,14,_r))),128))])]),e("div",wr,[e("button",{type:"button",onClick:a,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:!n.value.name.trim()||l.value,class:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},F(l.value?"Guardando...":t.editingFolder?"Actualizar":"Crear"),9,$r)])],32)])])]),_:1})):I("",!0)}},Dr={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Cr={class:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden"},Sr={class:"border-b"},Ir={class:"hidden sm:flex justify-between items-center p-6"},Fr={class:"flex items-center gap-3"},Er={class:"text-lg font-semibold text-gray-900"},Tr={class:"text-sm text-gray-600"},Lr={class:"flex items-center gap-2"},Ur={class:"sm:hidden"},Mr={class:"flex justify-between items-center p-4 pb-2"},Ar={class:"flex items-center gap-3 flex-1 min-w-0"},Br={class:"min-w-0 flex-1"},jr={class:"text-lg font-semibold text-gray-900 truncate"},Nr={class:"text-sm text-gray-600"},Pr={class:"px-4 pb-4"},qr={class:"p-4 sm:p-6 overflow-y-auto max-h-[70vh]"},zr={class:"space-y-6"},Vr={key:0},Rr=e("h4",{class:"text-base font-semibold text-gray-900 mb-3"},"Mis Documentos",-1),Qr={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Or={key:1},Gr=e("h4",{class:"text-base font-semibold text-gray-900 mb-3"},"Formatos Disponibles",-1),Hr={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Wr={key:2},Zr=e("h4",{class:"text-base font-semibold text-gray-900 mb-3"},"Documentos para Firmar",-1),Jr={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Kr={key:3,class:"text-center py-8 sm:py-12"},Yr={class:"text-gray-400 mb-4"},Xr=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"Esta carpeta est√° vac√≠a",-1),en=e("p",{class:"text-gray-600 mb-4 text-sm sm:text-base"},"Agrega documentos para organizar tu trabajo",-1),tn={__name:"FolderDetailsModal",props:{folder:{type:Object,default:null}},emits:["close","add-documents","remove-document","view-document","use-document","refresh"],setup(t,{emit:r}){const s=t,g=r,p=ne(),l=se(),n=P(()=>p.currentUser),y=P(()=>{var w;return(w=s.folder)!=null&&w.color_id?ge(s.folder.color_id)||{hex:"#6B7280"}:{hex:"#6B7280"}}),d=P(()=>{if(!s.folder)return{myDocuments:[],useDocuments:[],signatureDocuments:[]};const w=s.folder.documents||[];return{myDocuments:w.filter(u=>{var v;return u.assigned_to===((v=n.value)==null?void 0:v.id)&&(u.state==="Progress"||u.state==="Completed")}),useDocuments:w.filter(u=>u.state==="Published"&&!u.assigned_to),signatureDocuments:w.filter(u=>u.state==="PendingSignatures"||u.state==="FullySigned")}});Y(()=>s.folder,(w,u)=>{var v,$;if(w&&u&&w.id===u.id){const U=((v=u.documents)==null?void 0:v.length)||0,c=(($=w.documents)==null?void 0:$.length)||0;c!==U&&console.log(`üìÅ FolderDetailsModal: Folder "${w.name}" updated! Documents: ${U} ‚Üí ${c}`)}},{deep:!0});const a=()=>{g("close")},x=()=>{g("add-documents",s.folder)},_=w=>{g("view-document",w)},k=w=>{const u=s.folder.documents.find(v=>v.id===w);u&&g("use-document",u)},h=w=>{g("remove-document",w.id)};return(w,u)=>t.folder?(o(),H(de,{key:0},{default:X(()=>[e("div",Dr,[e("div",Cr,[e("div",Sr,[e("div",Ir,[e("div",Fr,[e("div",{class:"w-8 h-8 rounded-full flex-shrink-0",style:ie({backgroundColor:y.value.hex})},null,4),e("div",null,[e("h3",Er,F(t.folder.name),1),e("p",Tr,F(t.folder.documents.length)+" documento"+F(t.folder.documents.length!==1?"s":""),1)])]),e("div",Lr,[e("button",{onClick:x,class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"},[b(m(oe),{class:"w-4 h-4"}),O(" Agregar documentos ")]),e("button",{onClick:a,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[b(m(re),{class:"w-5 h-5"})])])]),e("div",Ur,[e("div",Mr,[e("div",Ar,[e("div",{class:"w-7 h-7 rounded-full flex-shrink-0",style:ie({backgroundColor:y.value.hex})},null,4),e("div",Br,[e("h3",jr,F(t.folder.name),1),e("p",Nr,F(t.folder.documents.length)+" documento"+F(t.folder.documents.length!==1?"s":""),1)])]),e("button",{onClick:a,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors flex-shrink-0 ml-2"},[b(m(re),{class:"w-5 h-5"})])]),e("div",Pr,[e("button",{onClick:x,class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors"},[b(m(oe),{class:"w-4 h-4"}),O(" Agregar documentos ")])])])]),e("div",qr,[e("div",zr,[d.value.myDocuments.length>0?(o(),i("div",Vr,[Rr,e("div",Qr,[(o(!0),i(W,null,J(d.value.myDocuments,v=>(o(),H(m(he),{key:v.id,document:v,"card-type":"client","card-context":"folder","highlighted-doc-id":null,"show-tags":!0,"show-client-name":!1,"additional-classes":"relative","document-store":m(l),"user-store":m(p),onClick:_,onRefresh:u[0]||(u[0]=$=>w.$emit("refresh")),onRemoveFromFolder:h},null,8,["document","document-store","user-store"]))),128))])])):I("",!0),d.value.useDocuments.length>0?(o(),i("div",Or,[Gr,e("div",Hr,[(o(!0),i(W,null,J(d.value.useDocuments,v=>(o(),H(m(je),{key:v.id,document:v,"card-context":"folder","show-menu-options":!0,"document-store":m(l),"user-store":m(p),onClick:k,onRemoveFromFolder:h},null,8,["document","document-store","user-store"]))),128))])])):I("",!0),d.value.signatureDocuments.length>0?(o(),i("div",Wr,[Zr,e("div",Jr,[(o(!0),i(W,null,J(d.value.signatureDocuments,v=>(o(),H(m(Ae),{key:v.id,document:v,"card-context":"folder","highlighted-doc-id":null,"document-store":m(l),"user-store":m(p),onRefresh:u[1]||(u[1]=$=>w.$emit("refresh")),onRemoveFromFolder:h},null,8,["document","document-store","user-store"]))),128))])])):I("",!0),t.folder.documents.length===0?(o(),i("div",Kr,[e("div",Yr,[b(m(Te),{class:"w-10 h-10 sm:w-12 sm:h-12 mx-auto"})]),Xr,en,e("button",{onClick:x,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm sm:text-base"},[b(m(oe),{class:"w-4 h-4"}),O(" Agregar documentos ")])])):I("",!0)])])])])]),_:1})):I("",!0)}},sn={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},on={class:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden"},rn={class:"border-b"},nn={class:"hidden sm:flex justify-between items-center p-6"},an=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),ln={class:"text-sm text-gray-600"},dn={class:"sm:hidden p-4"},cn={class:"flex justify-between items-start mb-2"},un={class:"flex-1 min-w-0 mr-3"},mn=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),gn={class:"text-sm text-gray-600 truncate"},hn={class:"border-b"},pn={class:"hidden sm:flex space-x-8 px-6","aria-label":"Tabs"},fn=["onClick"],vn={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},bn={class:"sm:hidden relative px-4 py-3"},yn={class:"flex items-center"},xn={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},_n=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),wn=[_n],$n={class:"absolute top-full left-4 right-4 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},kn=["onClick"],Dn={class:"border-b bg-gray-50 p-4 sm:p-6"},Cn={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Sn={class:"flex-1"},In={key:0,class:"flex items-center gap-3"},Fn={class:"text-sm text-gray-600"},En={class:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-350px)]"},Tn={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Ln={key:4,class:"absolute top-2 left-2 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center shadow-sm"},Un={key:0,class:"text-center py-8 sm:py-12"},Mn={class:"text-lg font-medium text-gray-900 mb-2"},An={class:"text-gray-600 text-sm sm:text-base"},Bn={class:"border-t bg-gray-50"},jn={class:"hidden sm:flex justify-between items-center p-6"},Nn={class:"text-sm text-gray-600"},Pn={class:"flex gap-3"},qn=["disabled"],zn={class:"sm:hidden p-4 space-y-3"},Vn={class:"text-center text-sm text-gray-600"},Rn={class:"flex gap-3"},Qn=["disabled"],On={__name:"AddDocumentsModal",props:{isVisible:{type:Boolean,required:!0},folder:{type:Object,default:null}},emits:["close","add-documents"],setup(t,{emit:r}){const s=t,g=r,p=se(),l=ne(),n=A([]),y=A([]),d=A("my-documents"),a=A(!1),x=A(!1),_=[{name:"my-documents",label:"Mis Documentos"},{name:"use-documents",label:"Formatos Disponibles"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Documentos Firmados"}],k=P(()=>l.currentUser);Y(()=>s.isVisible,T=>{T&&(n.value=[],y.value=[],d.value="my-documents")}),Y(d,()=>{n.value=[]}),Y(y,()=>{n.value=[]},{deep:!0});const h=P(()=>{const T=u(d.value);return T.length===0?!1:T.every(C=>n.value.includes(C.id))}),w=T=>{var L;if(!s.folder)return[];const C=s.folder.documents.map(Q=>Q.id);let E=[];switch(T){case"my-documents":E=p.progressAndCompletedDocumentsByClient((L=k.value)==null?void 0:L.id);break;case"use-documents":E=p.publishedDocumentsUnassigned;break;case"pending-signatures":E=p.documents.filter(Q=>{var j,q;return Q.state==="PendingSignatures"&&(Q.assigned_to===((j=k.value)==null?void 0:j.id)||((q=Q.signatures)==null?void 0:q.some(M=>{var S;return M.signer_email===((S=k.value)==null?void 0:S.email)})))});break;case"signed-documents":E=p.documents.filter(Q=>{var j,q;return Q.state==="FullySigned"&&(Q.assigned_to===((j=k.value)==null?void 0:j.id)||((q=Q.signatures)==null?void 0:q.some(M=>{var S;return M.signer_email===((S=k.value)==null?void 0:S.email)})))});break;default:E=[]}return E.filter(Q=>!C.includes(Q.id))},u=T=>{const C=w(T);if(!y.value||y.value.length===0)return C;const E=y.value.map(L=>L.id);return C.filter(L=>!L.tags||L.tags.length===0?!1:L.tags.some(Q=>E.includes(Q.id)))},v=T=>{const C=n.value.indexOf(T);C>-1?n.value.splice(C,1):n.value.push(T)},$=()=>{const C=u(d.value).map(E=>E.id);if(h.value)n.value=n.value.filter(E=>!C.includes(E));else{const E=C.filter(L=>!n.value.includes(L));n.value.push(...E)}},U=()=>{g("close")},c=async()=>{if(n.value.length!==0){a.value=!0;try{await g("add-documents",n.value)}finally{a.value=!1}}},D=T=>{d.value=T,x.value=!1},f=T=>{T.target.closest(".relative")||(x.value=!1)};return te(()=>{document.addEventListener("click",f)}),pe(()=>{document.removeEventListener("click",f)}),(T,C)=>t.isVisible&&t.folder?(o(),H(de,{key:0},{default:X(()=>{var E;return[e("div",sn,[e("div",on,[e("div",rn,[e("div",nn,[e("div",null,[an,e("p",ln,'Selecciona documentos para agregar a "'+F(t.folder.name)+'"',1)]),e("button",{onClick:U,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors"},[b(m(re),{class:"w-5 h-5"})])]),e("div",dn,[e("div",cn,[e("div",un,[mn,e("p",gn,'Para "'+F(t.folder.name)+'"',1)]),e("button",{onClick:U,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors flex-shrink-0"},[b(m(re),{class:"w-5 h-5"})])])])]),e("div",hn,[e("nav",pn,[(o(),i(W,null,J(_,L=>e("button",{key:L.name,onClick:Q=>d.value=L.name,class:R([d.value===L.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[O(F(L.label)+" ",1),e("span",vn,F(u(L.name).length),1)],10,fn)),64))]),e("div",bn,[e("button",{onClick:C[0]||(C[0]=L=>x.value=!x.value),class:"w-full flex items-center justify-between py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("div",yn,[e("span",null,F(((E=_.find(L=>L.name===d.value))==null?void 0:E.label)||"Seleccionar categor√≠a"),1),e("span",xn,F(u(d.value).length),1)]),(o(),i("svg",{class:R(["ml-2 h-5 w-5 transition-transform duration-200",x.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},wn,2))]),ae(e("div",$n,[(o(),i(W,null,J(_,L=>e("button",{key:L.name,onClick:Q=>D(L.name),class:R(["w-full text-left px-4 py-3 text-sm transition-colors duration-150 flex items-center justify-between",d.value===L.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},[e("span",null,F(L.label),1),e("span",{class:R(["py-0.5 px-2 rounded-full text-xs",d.value===L.name?"bg-white/20 text-white":"bg-gray-100 text-gray-600"])},F(u(L.name).length),3)],10,kn)),64))],512),[[ye,x.value]])])]),e("div",Dn,[e("div",Cn,[e("div",Sn,[b(Be,{modelValue:y.value,"onUpdate:modelValue":C[1]||(C[1]=L=>y.value=L),class:"max-w-md"},null,8,["modelValue"])]),u(d.value).length>0?(o(),i("div",In,[e("span",Fn,F(u(d.value).length)+" documento(s) disponible(s) ",1),e("button",{onClick:$,class:R(["px-4 py-2 rounded-lg border font-medium text-sm transition-colors",h.value?"bg-red-50 border-red-200 text-red-700 hover:bg-red-100":"bg-primary text-white border-primary hover:bg-primary-dark"])},F(h.value?"Deseleccionar todos":"Seleccionar todos"),3)])):I("",!0)])]),e("div",En,[e("div",Tn,[(o(!0),i(W,null,J(u(d.value),L=>(o(),i("div",{key:L.id,class:"relative"},[d.value==="my-documents"?(o(),H(m(he),{key:0,document:L,"highlighted-doc-id":null,"show-tags":!0,"show-client-name":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":n.value.includes(L.id)?"ring-2 ring-primary bg-primary-50":"",onClick:Q=>v(L.id)},null,8,["document","additional-classes","onClick"])):I("",!0),d.value==="use-documents"?(o(),H(m(je),{key:1,document:L,"show-tags":!0,"menu-options":[],"show-menu-options":!1,"disable-internal-actions":!0,"additional-classes":n.value.includes(L.id)?"ring-2 ring-primary bg-primary-50":"",onClick:Q=>v(L.id)},null,8,["document","additional-classes","onClick"])):I("",!0),d.value==="pending-signatures"?(o(),H(m(Ae),{key:2,document:L,"highlighted-doc-id":null,"show-tags":!0,"menu-options":[],"disable-internal-actions":!0,"additional-classes":n.value.includes(L.id)?"ring-2 ring-primary bg-primary-50":"",onClick:Q=>v(L.id)},null,8,["document","additional-classes","onClick"])):I("",!0),d.value==="signed-documents"?(o(),H(m(Ae),{key:3,document:L,"highlighted-doc-id":null,"show-tags":!0,"menu-options":[],"disable-internal-actions":!0,"additional-classes":n.value.includes(L.id)?"ring-2 ring-primary bg-primary-50":"",onClick:Q=>v(L.id)},null,8,["document","additional-classes","onClick"])):I("",!0),n.value.includes(L.id)?(o(),i("div",Ln,[b(m(ct),{class:"w-4 h-4"})])):I("",!0)]))),128))]),u(d.value).length===0?(o(),i("div",Un,[b(m(Te),{class:"w-12 h-12 sm:w-16 sm:h-16 text-gray-300 mx-auto mb-4"}),e("h4",Mn,F(y.value.length>0?"No hay documentos que coincidan con el filtro":"No hay documentos disponibles"),1),e("p",An,F(y.value.length>0?"Intenta ajustar los filtros de etiquetas o selecciona otra categor√≠a":"No tienes documentos de esta categor√≠a que no est√©n ya en la carpeta"),1)])):I("",!0)]),e("div",Bn,[e("div",jn,[e("div",Nn,F(n.value.length)+" documento(s) seleccionado(s) ",1),e("div",Pn,[e("button",{onClick:U,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{onClick:c,disabled:n.value.length===0||a.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},F(a.value?"Agregando...":`Agregar ${n.value.length} documento(s)`),9,qn)])]),e("div",zn,[e("div",Vn,F(n.value.length)+" documento(s) seleccionado(s) ",1),e("div",Rn,[e("button",{onClick:U,class:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center font-medium"}," Cancelar "),e("button",{onClick:c,disabled:n.value.length===0||a.value,class:"flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-center font-medium"},F(a.value?"Agregando...":"Agregar"),9,Qn)])])])])])]}),_:1})):I("",!0)}},ke=t=>(fe("data-v-71ba7453"),t=t(),ve(),t),Gn={class:"folders-grid"},Hn={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},Wn={key:1,class:"text-center py-12"},Zn=ke(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No tienes carpetas a√∫n",-1)),Jn=ke(()=>e("p",{class:"text-gray-600 mb-6"},"Crea tu primera carpeta para organizar tus documentos",-1)),Kn={key:2,class:"text-center py-12"},Yn=ke(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No se encontraron carpetas",-1)),Xn=ke(()=>e("p",{class:"text-gray-600"},"No hay carpetas que coincidan con tu b√∫squeda",-1)),ea={key:3,class:"flex justify-center items-center py-12"},ta=ke(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)),sa=[ta],oa={__name:"FoldersGrid",props:{sortedFolders:{type:Array,required:!0},searchQuery:{type:String,default:""},isLoading:{type:Boolean,default:!1}},emits:["folder-click","edit-folder","delete-folder","add-documents","create-folder"],setup(t,{emit:r}){const s=t,g=r,p=P(()=>{if(!s.searchQuery.trim())return s.sortedFolders;const x=s.searchQuery.toLowerCase();return s.sortedFolders.filter(_=>_.name.toLowerCase().includes(x))}),l=x=>{g("folder-click",x)},n=x=>{g("edit-folder",x)},y=x=>{g("delete-folder",x)},d=x=>{g("add-documents",x)},a=()=>{g("create-folder")};return(x,_)=>(o(),i("div",Gn,[!t.isLoading&&p.value.length>0?(o(),i("div",Hn,[(o(!0),i(W,null,J(p.value,k=>(o(),H(m(es),{key:k.id,folder:k,onClick:l,onEdit:n,onDelete:y,onAddDocuments:d},null,8,["folder"]))),128))])):!t.isLoading&&t.sortedFolders.length===0?(o(),i("div",Wn,[b(m(me),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Zn,Jn,e("button",{onClick:a,class:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"},[b(m(oe),{class:"w-5 h-5"}),O(" Crear Primera Carpeta ")])])):!t.isLoading&&t.sortedFolders.length>0&&p.value.length===0?(o(),i("div",Kn,[b(m(me),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Yn,Xn])):I("",!0),t.isLoading?(o(),i("div",ea,sa)):I("",!0)]))}},ra=be(oa,[["__scopeId","data-v-71ba7453"]]),Ze=t=>(fe("data-v-1ea3aed8"),t=t(),ve(),t),na={class:"folder-management"},aa={class:"mb-6"},la={class:"hidden sm:flex justify-between items-center"},ia=Ze(()=>e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),da={class:"sm:hidden"},ca=Ze(()=>e("div",{class:"text-center mb-4"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1 px-2"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),ua={__name:"FolderManagement",props:{searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","navigate-to-main"],setup(t,{emit:r}){const s=t,g=r,p=Ne(),l=se(),n=ne(),y=A(!1),d=A(null),a=A(null),x=A(!1),_=A(null),k=P(()=>p.isLoading),h=P(()=>p.sortedFolders);P(()=>n.currentUser),te(async()=>{await p.init(),await l.init()}),Y(()=>s.searchQuery,()=>{}),Y(()=>p.folders,M=>{var S,N;if(a.value&&M&&M.length>0){const V=M.find(z=>z.id===a.value.id);if(V){const z=((S=a.value.documents)==null?void 0:S.length)||0,B=((N=V.documents)==null?void 0:N.length)||0;JSON.stringify(a.value)!==JSON.stringify(V)&&(a.value={...V},console.log(`üîÑ FolderManagement: Synced selectedFolder "${V.name}" with store. Documents: ${z} ‚Üí ${B}`))}}},{deep:!0});const w=()=>{d.value=null,y.value=!0},u=M=>{d.value=M,y.value=!0},v=()=>{y.value=!1,d.value=null},$=()=>{v()},U=M=>{a.value=M},c=()=>{a.value=null},D=async M=>{if(confirm(`¬øEst√°s seguro de que quieres eliminar la carpeta "${M.name}"?`))try{await p.deleteFolder(M.id),G(`Carpeta "${M.name}" eliminada correctamente`,"success")}catch(S){G("Error al eliminar la carpeta","error"),console.error("Error deleting folder:",S)}},f=M=>{_.value=M,x.value=!0},T=async(M=!1)=>{if(x.value=!1,_.value=null,M&&a.value)try{await C()}catch(S){console.warn("Error refreshing folder after adding documents:",S)}},C=async()=>{if(a.value)try{await p.fetchFolderById(a.value.id,!0);const M=p.getFolderById(a.value.id);M&&(a.value={...M},console.log("‚úÖ Selected folder refreshed successfully"))}catch(M){throw console.error("‚ùå Error refreshing selected folder:",M),M}},E=async M=>{var S,N,V;if(!(!_.value||M.length===0))try{const z=_.value.documents.map(K=>K.id).filter(K=>K!=null&&!isNaN(parseInt(K))).map(K=>parseInt(K)),B=M.filter(K=>K!=null&&!isNaN(parseInt(K))).map(K=>parseInt(K)),Z=[...new Set([...z,...B])];if(console.log("Current document IDs:",z),console.log("Selected document IDs:",B),console.log("Updated document IDs:",Z),Z.some(K=>!Number.isInteger(K)||K<=0))throw new Error("IDs de documentos inv√°lidos detectados");await p.updateFolder(_.value.id,{document_ids:Z}),await T(!0),G(`${B.length} documento(s) agregado(s) a la carpeta`,"success"),g("navigate-to-main")}catch(z){console.error("Error adding documents to folder:",z),console.error("Error details:",((S=z.response)==null?void 0:S.data)||z.message),(N=z.response)!=null&&N.status?G(`Error al agregar documentos: ${((V=z.response.data)==null?void 0:V.detail)||z.message}`,"error"):G("Error al agregar documentos a la carpeta","error")}},L=async M=>{var S,N,V;if(a.value)try{const z=parseInt(M);if(!Number.isInteger(z)||z<=0)throw new Error("ID de documento inv√°lido");const B=a.value.documents.map(Z=>Z.id).filter(Z=>Z!=null&&!isNaN(parseInt(Z))).map(Z=>parseInt(Z)).filter(Z=>Z!==z);console.log("Removing document ID:",z),console.log("Updated document IDs after removal:",B),await p.updateFolder(a.value.id,{document_ids:B}),G("Documento removido de la carpeta","success"),a.value=null,g("navigate-to-main");try{await p.fetchFolderById(a.value.id,!0);const Z=p.getFolderById(a.value.id);Z&&(a.value=Z),console.log("Folder data refreshed successfully after removal")}catch(Z){console.warn("Error refreshing folder data:",Z);try{a.value={...a.value,documents:a.value.documents.filter(K=>K.id!==z)},console.log("Applied optimistic removal for document ID:",z)}catch(K){console.warn("Optimistic update failed:",K)}}}catch(z){console.error("Error removing document from folder:",z),console.error("Error details:",((S=z.response)==null?void 0:S.data)||z.message),(N=z.response)!=null&&N.status?G(`Error al remover documento: ${((V=z.response.data)==null?void 0:V.detail)||z.message}`,"error"):G("Error al remover el documento de la carpeta","error")}},Q=M=>{console.log("View document:",M)},j=M=>{console.log("Use document:",M)},q=(M,S)=>{console.log("Document action:",M,S)};return(M,S)=>(o(),i("div",na,[e("div",aa,[e("div",la,[ia,e("button",{onClick:w,class:"inline-flex items-center gap-2 px-4 py-2.5 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md"},[b(m(oe),{class:"w-5 h-5"}),O(" Nueva Carpeta ")])]),e("div",da,[ca,e("button",{onClick:w,class:"w-full flex items-center justify-center gap-3 px-4 py-4 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium text-base"},[b(m(oe),{class:"w-6 h-6"}),O(" Nueva Carpeta ")])])]),b(m(ra),{"sorted-folders":h.value,"search-query":t.searchQuery,"is-loading":k.value,onFolderClick:U,onEditFolder:u,onDeleteFolder:D,onAddDocuments:f,onCreateFolder:w},null,8,["sorted-folders","search-query","is-loading"]),b(m(kr),{"is-visible":y.value,"editing-folder":d.value,onClose:v,onSuccess:$},null,8,["is-visible","editing-folder"]),b(m(tn),{folder:a.value,onClose:c,onAddDocuments:f,onRemoveDocument:L,onViewDocument:Q,onUseDocument:j,onDocumentAction:q},null,8,["folder"]),b(m(On),{"is-visible":x.value,folder:_.value,onClose:T,onAddDocuments:E},null,8,["is-visible","folder"])]))}},ma=be(ua,[["__scopeId","data-v-1ea3aed8"]]),Pe=t=>(fe("data-v-7aa0f627"),t=t(),ve(),t),ga={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},ha={key:1,class:"mt-6 flex flex-col items-center justify-center text-center text-gray-500 w-full p-12 rounded-xl bg-gray-50 border-2 border-dashed border-gray-200"},pa=Pe(()=>e("svg",{class:"w-16 h-16 mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),fa=Pe(()=>e("h3",{class:"text-lg font-semibold mb-2 text-gray-700"}," No hay documentos en esta secci√≥n ",-1)),va={class:"text-sm mb-4 max-w-md"},ba=Pe(()=>e("div",{class:"flex flex-col sm:flex-row gap-3 mt-2"},[e("div",{class:"text-xs text-gray-400 bg-gray-100 px-3 py-2 rounded-lg"},[O(" üí° "),e("strong",null,"Tip:"),O(" Los documentos aparecer√°n cuando tu abogado los asigne ")])],-1)),ya={__name:"DocumentListClient",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null}},setup(t){const r=se(),s=ne(),{registerView:g}=gt(),p=P(()=>s.getCurrentUser),l=A([]),n=A(!1);s.userSignature;const y=P(()=>{const u=a.searchQuery&&a.searchQuery.trim().length>0,v=a.selectedTags&&a.selectedTags.length>0;return u&&v?"No se encontraron documentos que coincidan con tu b√∫squeda y filtros seleccionados. Intenta ajustar los criterios de b√∫squeda.":u?"No se encontraron documentos que coincidan con tu b√∫squeda. Intenta con otros t√©rminos.":v?"No hay documentos disponibles con las etiquetas seleccionadas. Prueba con otras etiquetas.":"A√∫n no tienes documentos asignados. Contacta a tu abogado para gestionar tus documentos jur√≠dicos."}),d=P(()=>{if(a.promptDocuments)return null;const u=r.lastUpdatedDocumentId,v=localStorage.getItem("lastUpdatedDocumentId");return u&&x.value.some(U=>String(U.id)===String(u))?u:v&&x.value.some(c=>String(c.id)===String(v))?v:null}),a=t;te(async()=>{if(await s.init(),await r.init(),a.promptDocuments)return;await r.init(),await _();const u=localStorage.getItem("lastUpdatedDocumentId");u&&!r.lastUpdatedDocumentId&&(r.lastUpdatedDocumentId=u),r.lastUpdatedDocumentId&&x.value.some(v=>String(v.id)===String(r.lastUpdatedDocumentId))}),Y(()=>r.lastUpdatedDocumentId,u=>{a.promptDocuments||u&&localStorage.setItem("lastUpdatedDocumentId",u)});const x=P(()=>{var c,D;if(a.promptDocuments){const f=(c=p.value)==null?void 0:c.id;let T=a.promptDocuments.filter(C=>{const E=C.assigned_to?String(C.assigned_to):null,L=String(f);return E===L&&(C.state==="Progress"||C.state==="Completed")});if(a.searchQuery){const C=a.searchQuery.toLowerCase();T=T.filter(E=>{var L,Q,j,q,M,S,N,V;return E.title.toLowerCase().includes(C)||E.state.toLowerCase().includes(C)||E.assigned_to&&s&&(((Q=(L=s.userById(E.assigned_to))==null?void 0:L.first_name)==null?void 0:Q.toLowerCase().includes(C))||((q=(j=s.userById(E.assigned_to))==null?void 0:j.last_name)==null?void 0:q.toLowerCase().includes(C))||((S=(M=s.userById(E.assigned_to))==null?void 0:M.email)==null?void 0:S.toLowerCase().includes(C))||((V=(N=s.userById(E.assigned_to))==null?void 0:N.identification)==null?void 0:V.toLowerCase().includes(C)))})}if(a.selectedTags&&a.selectedTags.length>0){const C=a.selectedTags.map(E=>E.id);T=T.filter(E=>!E.tags||E.tags.length===0?!1:E.tags.some(L=>C.includes(L.id)))}return T}const u=r.progressAndCompletedDocumentsByClient((D=p.value)==null?void 0:D.id),v=a.selectedTags?a.selectedTags.map(f=>f.id):[];return r.filteredDocumentsBySearchAndTags(a.searchQuery,s,v).filter(f=>u.some(T=>String(T.id)===String(f.id)))}),_=async()=>{n.value=!0;try{const u=s.currentUser.id;if(!u)return;const v=await xe(`dynamic-documents/user/${u}/pending-documents-full/`);l.value=v.data}catch(u){console.error("Error fetching documents:",u),u.response&&console.error("Error details:",u.response.data),await G("Error al cargar documentos","error"),l.value=[]}finally{n.value=!1}},k=async u=>{await g("document",u.id),Ge(u)};Y(x,u=>{if(!a.promptDocuments&&r.lastUpdatedDocumentId&&!u.some($=>String($.id)===String(r.lastUpdatedDocumentId))&&u.length>0){const U=[...u].sort((c,D)=>D.id-c.id)[0].id;r.lastUpdatedDocumentId=U,localStorage.setItem("lastUpdatedDocumentId",U)}});const h=u=>{u&&(r.lastUpdatedDocumentId=u,localStorage.setItem("lastUpdatedDocumentId",u),setTimeout(()=>{try{const v=document.querySelectorAll(`[data-document-id="${u}"]`);if(v.length>0){const $=v[0];$.style.border="3px solid #3b82f6",$.classList.remove("animate-pulse-highlight"),$.classList.remove("border-secondary"),$.classList.remove("shadow-md"),$.offsetWidth,$.classList.add("animate-pulse-highlight"),$.classList.add("border-secondary"),$.classList.add("shadow-md"),$.scrollIntoView({behavior:"smooth",block:"center"})}}catch(v){console.error("Error forcing highlight:",v)}},100))};window.forceDocumentHighlight=h;const w=async()=>{await r.init(!0)};return(u,v)=>(o(),i(W,null,[x.value.length>0?(o(),i("div",ga,[(o(!0),i(W,null,J(x.value,$=>(o(),H(m(he),{key:$.id,document:$,"card-type":"client","card-context":"list","highlighted-doc-id":d.value,"status-icon":$.state==="Completed"?m(Le):m(Me),"status-text":$.state==="Completed"?"Completado":"En Progreso","status-badge-classes":$.state==="Completed"?"bg-green-100 text-green-700 border border-green-200":"bg-blue-100 text-blue-700 border border-blue-200","document-store":m(r),"user-store":m(s),"prompt-documents":a.promptDocuments,"edit-modal-component":"UseDocumentByClient",onClick:k,onRefresh:w},null,8,["document","highlighted-doc-id","status-icon","status-text","status-badge-classes","document-store","user-store","prompt-documents"]))),128))])):I("",!0),x.value.length===0?(o(),i("div",ha,[pa,fa,e("p",va,F(y.value),1),ba])):I("",!0),b(Ue,{isVisible:m(ce),documentData:m(Ee),onClose:v[0]||(v[0]=$=>ce.value=!1)},null,8,["isVisible","documentData"])],64))}},xa=be(ya,[["__scopeId","data-v-7aa0f627"]]),_a={key:0,class:"mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},wa={key:1,class:"mt-8 flex flex-col items-center justify-center text-center text-gray-500 w-full p-12 rounded-xl bg-gray-50 border-2 border-dashed border-gray-200"},$a=e("svg",{class:"w-16 h-16 mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),ka=e("h3",{class:"text-lg font-semibold mb-2 text-gray-700"}," No hay plantillas disponibles ",-1),Da={class:"text-sm mb-4 max-w-md"},Ca=e("div",{class:"flex flex-col sm:flex-row gap-3 mt-2"},[e("div",{class:"text-xs text-gray-400 bg-gray-100 px-3 py-2 rounded-lg"},[O(" üí° "),e("strong",null,"Tip:"),O(" Las plantillas son creadas por los abogados ")])],-1),Sa={__name:"UseDocument",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},setup(t){const r=se(),s=ne(),g=t,p=P(()=>{const y=r.publishedDocumentsUnassigned,d=g.selectedTags?g.selectedTags.map(x=>x.id):[];return r.filteredDocumentsBySearchAndTags(g.searchQuery,s,d).filter(x=>y.some(_=>_.id===x.id))});s.userSignature;const l=P(()=>{const y=g.searchQuery&&g.searchQuery.trim().length>0,d=g.selectedTags&&g.selectedTags.length>0;return y&&d?"No se encontraron plantillas que coincidan con tu b√∫squeda y filtros seleccionados. Intenta ajustar los criterios de b√∫squeda.":y?"No se encontraron plantillas que coincidan con tu b√∫squeda. Intenta con otros t√©rminos o contacta a tu abogado.":d?"No hay plantillas disponibles con las etiquetas seleccionadas. Prueba con otras etiquetas o contacta a tu abogado.":"Actualmente no hay plantillas de documentos jur√≠dicos disponibles para usar. Contacta a tu abogado para que publique plantillas."});function n(y){y&&y.updatedDocId&&(r.lastUpdatedDocumentId=y.updatedDocId,localStorage.setItem("lastUpdatedDocumentId",y.updatedDocId))}return(y,d)=>(o(),i(W,null,[p.value.length>0?(o(),i("div",_a,[(o(!0),i(W,null,J(p.value,a=>(o(),H(m(je),{key:a.id,document:a,"show-menu-options":!0,onDocumentCreated:n},null,8,["document"]))),128))])):(o(),i("div",wa,[$a,ka,e("p",Da,F(l.value),1),Ca])),b(Ue,{isVisible:m(ce),documentData:m(Ee),onClose:d[0]||(d[0]=a=>ce.value=!1)},null,8,["isVisible","documentData"])],64))}},le=t=>(fe("data-v-71135d5a"),t=t(),ve(),t),Ia={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},Fa={key:0,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ea=le(()=>e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1)),Ta=le(()=>e("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)),La=[Ea,Ta],Ua={key:1,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ma=le(()=>e("path",{d:"M20 6L9 17l-5-5"},null,-1)),Aa=[Ma],Ba={key:2,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},ja=le(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),Na=[ja],Pa={key:3,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},qa=le(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),za=[qa],Va={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},Ra={key:0,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Qa=le(()=>e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1)),Oa=le(()=>e("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)),Ga=[Qa,Oa],Ha={key:1,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Wa=le(()=>e("path",{d:"M20 6L9 17l-5-5"},null,-1)),Za=[Wa],Ja={key:2,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ka=le(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),Ya=[Ka],Xa={key:3,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},el=le(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),tl=[el],sl={__name:"DocumentListLawyer",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null}},setup(t){const r=se(),s=ne();Ie();const g=A([]),p=A([]),l=t,n=c=>c.state==="Published"||c.state==="FullySigned"?Le:Me,y=c=>{switch(c.state){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return"Desconocido"}},d=c=>{switch(c.state){case"Published":case"FullySigned":return"bg-green-100 text-green-700 border border-green-200";case"Draft":case"Progress":return"bg-blue-100 text-blue-700 border border-blue-200";case"PendingSignatures":return"bg-yellow-100 text-yellow-700 border border-yellow-200";case"Completed":return"bg-purple-100 text-purple-700 border border-purple-200";default:return"bg-gray-100 text-gray-700 border border-gray-200"}},a=c=>{var D,f;return c.fully_signed?"bg-green-100 text-green-700 border border-green-200":(D=u(c))!=null&&D.signed&&!c.fully_signed?"bg-blue-100 text-blue-700 border border-blue-200":u(c)&&!((f=u(c))!=null&&f.signed)?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200"},x=P(()=>{if(l.promptDocuments)return[];const D=(r.getDocumentsByLawyerId(s.currentUser.id)||[]).filter(C=>C.state!=="FullySigned"),f=l.selectedTags?l.selectedTags.map(C=>C.id):[];return r.filteredDocumentsBySearchAndTags(l.searchQuery,s,f).filter(C=>D.some(E=>E.id===C.id))}),_=P(()=>{if(l.promptDocuments&&l.promptDocuments.length>0){let c=l.promptDocuments.filter(D=>D.title&&D.title.toLowerCase().includes((l.searchQuery||"").toLowerCase()));if(l.selectedTags&&l.selectedTags.length>0){const D=l.selectedTags.map(f=>f.id);c=c.filter(f=>!f.tags||f.tags.length===0?!1:f.tags.some(T=>D.includes(T.id)))}return c}return[]}),k=P(()=>l.promptDocuments?_.value:x.value),h=P(()=>{if(l.promptDocuments)return null;const c=r.lastUpdatedDocumentId,D=localStorage.getItem("lastUpdatedDocumentId"),f=[...x.value];return c&&f.some(E=>String(E.id)===String(c))?c:D&&f.some(E=>String(E.id)===String(D))?D:null}),w=async()=>{try{const c=s.currentUser.id,D=await xe(`dynamic-documents/user/${c}/pending-documents-full/`),f=await xe(`dynamic-documents/user/${c}/signed-documents/`);D.status===200&&(g.value=D.data),f.status===200&&(p.value=f.data)}catch(c){console.error("Error fetching lawyer documents:",c),c.response&&(console.error("Error response data:",c.response.data),console.error("Error status:",c.response.status))}},u=c=>{if(!c.signatures||!c.requires_signature)return null;const D=String(s.currentUser.id);return c.signatures.find(f=>String(f.signer_id)===D)},v=c=>{if(!c.requires_signature)return"";if(c.fully_signed)return"Documento formalizado";const D=u(c);if(c.signatures&&c.signatures.length>0){const f=c.signatures.length,T=c.signatures.filter(C=>C.signed).length;if(D&&D.signed){if(T===1&&f>1)return`Has firmado. Faltan ${f-T} firmas m√°s`;if(T<f)return`Has firmado. Faltan ${f-T} firmas m√°s`}return`Firmas: ${T}/${f}`}return D?"Requiere tu firma":"Requiere firmas"};Y(k,c=>{if(!l.promptDocuments&&r.lastUpdatedDocumentId&&!c.some(f=>String(f.id)===String(r.lastUpdatedDocumentId))&&c.length>0){const T=[...c].sort((C,E)=>E.id-C.id)[0].id;r.lastUpdatedDocumentId=T,localStorage.setItem("lastUpdatedDocumentId",T)}});const $=c=>{c&&setTimeout(()=>{try{const D=document.querySelectorAll(`[data-document-id="${c}"]`);if(D.length>0){const f=D[0];f.classList.remove("animate-pulse-highlight-green","animate-pulse-highlight-blue"),f.offsetWidth,(f.querySelector("[data-document-id]")||f).classList.contains("border-green-400")?f.classList.add("animate-pulse-highlight-green"):f.classList.add("animate-pulse-highlight-blue"),f.scrollIntoView({behavior:"smooth",block:"center"})}}catch(D){console.error("Error forcing highlight:",D)}},100)};window.forceDocumentHighlight=$,te(async()=>{if(l.promptDocuments)return;await r.init();const c=localStorage.getItem("lastUpdatedDocumentId");c&&(r.lastUpdatedDocumentId=c,setTimeout(()=>{k.value.some(f=>String(f.id)===String(c))&&$(c)},500)),w()});const U=async()=>{await r.init()};return(c,D)=>(o(),i(W,null,[l.promptDocuments&&_.value.length>0?(o(),i("div",Ia,[(o(!0),i(W,null,J(_.value,f=>(o(),H(m(he),{key:f.id,document:f,"card-type":"lawyer","card-context":"prompt","highlighted-doc-id":h.value,"status-icon":n(f),"status-text":y(f),"status-badge-classes":d(f),"document-store":m(r),"user-store":m(s),"prompt-documents":!0,onRefresh:U},{"additional-badges":X(()=>{var T;return[f.requires_signature?(o(),i("div",{key:0,class:R(["inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",a(f)])},[f.fully_signed?(o(),i("svg",Fa,La)):(T=u(f))!=null&&T.signed?(o(),i("svg",Ua,Aa)):u(f)?(o(),i("svg",Ba,Na)):(o(),i("svg",Pa,za)),e("span",null,F(f.fully_signed?"Formalizado":v(f)),1)],2)):I("",!0)]}),_:2},1032,["document","highlighted-doc-id","status-icon","status-text","status-badge-classes","document-store","user-store"]))),128))])):l.promptDocuments?I("",!0):(o(),i("div",Va,[(o(!0),i(W,null,J(k.value,f=>(o(),H(m(he),{key:f.id,document:f,"card-type":"lawyer","card-context":"list","highlighted-doc-id":h.value,"status-icon":n(f),"status-text":y(f),"status-badge-classes":d(f),"document-store":m(r),"user-store":m(s),onRefresh:U},{"additional-badges":X(()=>{var T;return[f.requires_signature?(o(),i("div",{key:0,class:R(["inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",a(f)])},[f.fully_signed?(o(),i("svg",Ra,Ga)):(T=u(f))!=null&&T.signed?(o(),i("svg",Ha,Za)):u(f)?(o(),i("svg",Ja,Ya)):(o(),i("svg",Xa,tl)),e("span",null,F(f.fully_signed?"Formalizado":v(f)),1)],2)):I("",!0)]}),_:2},1032,["document","highlighted-doc-id","status-icon","status-text","status-badge-classes","document-store","user-store"]))),128))])),b(Ue,{isVisible:m(ce),documentData:m(Ee),onClose:D[0]||(D[0]=f=>ce.value=!1)},null,8,["isVisible","documentData"])],64))}},ol=be(sl,[["__scopeId","data-v-71135d5a"]]),rl={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},nl={__name:"DocumentFinishedByClientList",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(t,{emit:r}){const s=se(),g=ne();te(()=>{s.init(),g.init()});const p=t,l=P(()=>{const n=s.completedDocumentsByClient,y=p.selectedTags?p.selectedTags.map(a=>a.id):[];return s.filteredDocumentsBySearchAndTags(p.searchQuery,g,y).filter(a=>n.some(x=>x.id===a.id))});return g.userSignature,(n,y)=>(o(),i("div",rl,[(o(!0),i(W,null,J(l.value,d=>(o(),H(m(he),{key:d.id,document:d,"card-type":"lawyer","card-context":"finished","highlighted-doc-id":null,"status-icon":m(Le),"status-text":"Completado","status-badge-classes":"bg-green-100 text-green-700 border border-green-200","document-store":m(s),"user-store":m(g),"edit-route":`/dynamic_document_dashboard/document/use/editor/${d.id}/${encodeURIComponent(d.title.trim())}`,onRefresh:y[0]||(y[0]=a=>n.$emit("refresh"))},null,8,["document","status-icon","document-store","user-store","edit-route"]))),128))]))}},al={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4"},ll={__name:"DocumentInProgressByClientList",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(t,{emit:r}){const s=se(),g=ne();te(()=>{s.init(),g.init()});const p=t,l=P(()=>{const n=s.progressDocumentsByClient,y=p.selectedTags?p.selectedTags.map(a=>a.id):[];return s.filteredDocumentsBySearchAndTags(p.searchQuery,g,y).filter(a=>n.some(x=>x.id===a.id))});return g.userSignature,(n,y)=>(o(),i("div",al,[(o(!0),i(W,null,J(l.value,d=>(o(),H(m(he),{key:d.id,document:d,"card-type":"lawyer","card-context":"progress","highlighted-doc-id":null,"status-icon":m(Me),"status-text":"En Progreso","status-badge-classes":"bg-blue-100 text-blue-700 border border-blue-200","document-store":m(s),"user-store":m(g),"edit-route":`/dynamic_document_dashboard/document/use/editor/${d.id}/${encodeURIComponent(d.title.trim())}`,onRefresh:y[0]||(y[0]=a=>n.$emit("refresh"))},null,8,["document","status-icon","document-store","user-store","edit-route"]))),128))]))}},il={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},dl={class:"flex justify-end"},cl=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[O(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),ul={class:"mt-2"},ml={class:"flex gap-2 mt-2.5"},gl=["disabled"],hl=e("span",null,"Actualizar nombre",-1),pl=[hl],fl=["disabled"],vl={__name:"CreateDocumentByLawyer",emits:["close"],setup(t,{emit:r}){const s=Ie(),g=se(),p=r,l=A(""),n=A("");Re(()=>{var h;(h=g.selectedDocument)!=null&&h.title?(l.value=g.selectedDocument.title,n.value=g.selectedDocument.title):(l.value="",n.value="")});const y=h=>{h.key==="Escape"&&p("close")};te(()=>{document.addEventListener("keydown",y)}),pe(()=>{document.removeEventListener("keydown",y)});const d=P(()=>l.value.trim().length>0),a=P(()=>{var h;return!!((h=g.selectedDocument)!=null&&h.id)}),x=P(()=>a.value&&l.value.trim()!==n.value.trim()&&l.value.trim().length>0);async function _(){if(a.value&&x.value)try{const h={title:l.value.trim()};await g.updateDocument(g.selectedDocument.id,h),n.value=l.value.trim(),g.selectedDocument.title=l.value.trim(),g.lastUpdatedDocumentId=g.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",g.selectedDocument.id);const w=g.selectedDocument.id;p("close",{updatedDocId:w});const u=window.location.pathname;u==="/dynamic_document_dashboard"||u==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(w)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(h){console.error("Error updating document name:",h)}}const k=async()=>{if(!d.value)return;const h=encodeURIComponent(l.value.trim());a.value?(g.selectedDocument.title=l.value,g.selectedDocument.id&&(g.lastUpdatedDocumentId=g.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",g.selectedDocument.id.toString())),s.push(`/dynamic_document_dashboard/lawyer/editor/edit/${g.selectedDocument.id}`)):(g.selectedDocument={title:l.value.trim()},s.push(`/dynamic_document_dashboard/lawyer/editor/create/${h}`))};return(h,w)=>(o(),i("div",il,[e("div",dl,[e("button",{onClick:w[0]||(w[0]=u=>p("close"))},[b(m(re),{class:"size-6"})])]),e("form",{onSubmit:ue(k,["prevent"])},[e("div",null,[cl,e("div",ul,[ae(e("input",{"onUpdate:modelValue":w[1]||(w[1]=u=>l.value=u),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[Fe,l.value]])])]),e("div",ml,[a.value?(o(),i("button",{key:0,type:"button",onClick:_,disabled:!x.value,class:R(["p-2.5 text-sm font-medium rounded-md flex gap-2",x.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},pl,10,gl)):I("",!0),e("button",{type:"submit",class:R(["p-2.5 text-sm font-medium rounded-md flex gap-2",d.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!d.value},[e("span",null,F(a.value?"Editar Documento":"Continuar"),1)],10,fl)])],32)]))}},bl={class:"p-4 sm:p-6 lg:p-10 lg:px-8"},yl={key:0,class:"mt-6"},xl={class:"mb-6 border-b border-gray-200"},_l={class:"-mb-px hidden md:flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},wl=["onClick"],$l={class:"md:hidden relative"},kl=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),Dl=[kl],Cl={class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},Sl=["onClick"],Il={class:"mb-6"},Fl={key:0},El={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-3 sm:gap-4"},Tl={key:2,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-3 sm:gap-4"},Ll={key:3},Ul={key:4},Ml={key:5,class:"mt-6 text-center text-gray-400 font-regular"},Al=e("p",null,"No hay documentos disponibles para mostrar.",-1),Bl=[Al],jl={key:1,class:"mt-6"},Nl={key:0,class:"mb-6 border-b border-gray-200"},Pl={class:"-mb-px hidden md:flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},ql=["onClick"],zl={class:"md:hidden relative"},Vl=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),Rl=[Vl],Ql={class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},Ol=["onClick"],Gl={key:1,class:"mb-6"},Hl={class:"p-4 sm:p-6"},Wl={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},Zl={class:"flex justify-between items-center p-4 border-b"},Jl=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electr√≥nica",-1),Kl={class:"p-4 sm:p-6"},_i={__name:"Dashboard",setup(t){const r=ne(),s=se(),g=Ne(),p=Ie(),l=A(""),n=A("default"),y=A(!1),d=A("folders"),a=A("legal-documents"),x=A(!1),_=A([]),k=P(()=>r.currentUser),h=P(()=>k.value?k.value.role:(console.log("Current user is null, redirecting to login..."),p.push("/login"),null)),w=P(()=>{let S=[];h.value==="lawyer"?S=s.draftAndPublishedDocumentsUnassigned:h.value==="client"&&(S=s.progressAndCompletedDocumentsByClient(k.value.id));const N=_.value.map(V=>V.id);return s.filteredDocumentsBySearchAndTags(l.value,r,N).filter(V=>S.some(z=>z.id===V.id))}),u=S=>{n.value=S,s.selectedDocument=null},v=()=>{y.value=!1,n.value="default",s.selectedDocument=null},$=async()=>{await s.init(!0)},U=S=>{console.log("Global letterhead uploaded:",S)},c=()=>{console.log("Global letterhead deleted")},D=async()=>{d.value="folders";try{await new Promise(S=>setTimeout(S,100)),await g.fetchFolders(!0),console.log("üìÇ Dashboard: Refreshed folders after navigate-to-main")}catch(S){console.warn("Error refreshing folders on navigate-to-main:",S)}};Y(()=>s.lastUpdatedDocumentId,(S,N)=>{if(S&&S!==N&&n.value==="default"){const V=Date.now();(!Y.lastExecutionTime||V-Y.lastExecutionTime>100)&&(Y.lastExecutionTime=V,n.value="default")}},{immediate:!1});const f=[{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Dcs. Firmados"}],T=[{name:"legal-documents",label:"Minutas"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"finished-documents",label:"Dcs. Clientes"},{name:"in-progress-documents",label:"Dcs. Clientes en Progreso"}],C=A(!1),E=A(!1),L=()=>{C.value=!1,E.value=!1},Q=S=>{const N=document.querySelectorAll(".relative");let V=!1;N.forEach(z=>{z.contains(S.target)&&(V=!0)}),V||L()},j=S=>{a.value=S,C.value=!1},q=S=>{d.value=S,E.value=!1};te(async()=>{await r.init(),await s.init(),await g.init(),s.selectedDocument=null,n.value="default";const S=localStorage.getItem("lastUpdatedDocumentId");S&&s.documents.some(V=>V.id.toString()===S)&&(s.lastUpdatedDocumentId=parseInt(S)),document.addEventListener("click",Q)}),pe(()=>{document.removeEventListener("click",Q)});const M=async S=>{await r.getUserInfo(),r.currentUser&&(r.currentUser.has_signature=!0),showNotification("Firma electr√≥nica guardada correctamente","success"),setTimeout(()=>{x.value=!1},500)};return(S,N)=>{var V,z;return o(),i(W,null,[b(rt,{"onUpdate:searchQuery":N[0]||(N[0]=B=>l.value=B)},{default:X(()=>[Qe(S.$slots,"default")]),_:3}),e("div",bl,[b(Co,{onOpenNewDocument:N[1]||(N[1]=B=>y.value=!0),onUpdateCurrentSection:u,onGlobalLetterheadUploaded:U,onGlobalLetterheadDeleted:c,role:h.value},null,8,["role"]),h.value==="lawyer"?(o(),i("div",yl,[e("div",xl,[e("nav",_l,[(o(),i(W,null,J(T,B=>e("button",{key:B.name,onClick:Z=>a.value=B.name,class:R([a.value===B.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},F(B.label),11,wl)),64))]),e("div",$l,[e("button",{onClick:N[2]||(N[2]=B=>C.value=!C.value),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,F(((V=T.find(B=>B.name===a.value))==null?void 0:V.label)||"Seleccionar secci√≥n"),1),(o(),i("svg",{class:R(["ml-2 h-5 w-5 transition-transform duration-200",C.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Dl,2))]),ae(e("div",Cl,[(o(),i(W,null,J(T,B=>e("button",{key:B.name,onClick:Z=>j(B.name),class:R(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",a.value===B.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},F(B.label),11,Sl)),64))],512),[[ye,C.value]])])]),e("div",Il,[b(Be,{modelValue:_.value,"onUpdate:modelValue":N[3]||(N[3]=B=>_.value=B)},null,8,["modelValue"])]),a.value==="legal-documents"?(o(),i("div",Fl,[b(ol,{searchQuery:l.value,selectedTags:_.value},null,8,["searchQuery","selectedTags"])])):I("",!0),a.value==="pending-signatures"?(o(),i("div",El,[b(Se,{state:"PendingSignatures",searchQuery:l.value,selectedTags:_.value},null,8,["searchQuery","selectedTags"])])):I("",!0),a.value==="signed-documents"?(o(),i("div",Tl,[b(Se,{state:"FullySigned",searchQuery:l.value,selectedTags:_.value},null,8,["searchQuery","selectedTags"])])):I("",!0),a.value==="finished-documents"?(o(),i("div",Ll,[b(nl,{searchQuery:l.value,selectedTags:_.value},null,8,["searchQuery","selectedTags"])])):I("",!0),a.value==="in-progress-documents"?(o(),i("div",Ul,[b(ll,{searchQuery:l.value,selectedTags:_.value},null,8,["searchQuery","selectedTags"])])):I("",!0),w.value.length===0?(o(),i("div",Ml,Bl)):I("",!0)])):I("",!0),h.value==="client"?(o(),i("div",jl,[n.value!=="useDocument"?(o(),i("div",Nl,[e("nav",Pl,[(o(),i(W,null,J(f,B=>e("button",{key:B.name,onClick:Z=>d.value=B.name,class:R([d.value===B.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},F(B.label),11,ql)),64))]),e("div",zl,[e("button",{onClick:N[4]||(N[4]=B=>E.value=!E.value),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,F(((z=f.find(B=>B.name===d.value))==null?void 0:z.label)||"Seleccionar secci√≥n"),1),(o(),i("svg",{class:R(["ml-2 h-5 w-5 transition-transform duration-200",E.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Rl,2))]),ae(e("div",Ql,[(o(),i(W,null,J(f,B=>e("button",{key:B.name,onClick:Z=>q(B.name),class:R(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",d.value===B.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},F(B.label),11,Ol)),64))],512),[[ye,E.value]])])])):I("",!0),d.value!=="folders"?(o(),i("div",Gl,[b(Be,{modelValue:_.value,"onUpdate:modelValue":N[5]||(N[5]=B=>_.value=B)},null,8,["modelValue"])])):I("",!0),n.value==="useDocument"?(o(),H(Sa,{key:2,searchQuery:l.value,selectedTags:_.value},null,8,["searchQuery","selectedTags"])):(o(),i("div",{key:3,class:R(["grid gap-3 sm:gap-4",{"grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3":d.value!="my-documents"&&d.value!="folders"&&d.value!="pending-signatures"&&d.value!="signed-documents"}])},[d.value==="pending-signatures"?(o(),H(Se,{key:0,state:"PendingSignatures",searchQuery:l.value,selectedTags:_.value,onRefresh:$},null,8,["searchQuery","selectedTags"])):I("",!0),d.value==="my-documents"?(o(),H(xa,{key:1,searchQuery:l.value,selectedTags:_.value},null,8,["searchQuery","selectedTags"])):I("",!0),d.value==="folders"?(o(),H(ma,{key:2,searchQuery:l.value,selectedTags:_.value,onRefresh:$,onNavigateToMain:D},null,8,["searchQuery","selectedTags"])):I("",!0),d.value==="signed-documents"?(o(),H(Se,{key:3,state:"FullySigned",searchQuery:l.value,selectedTags:_.value},null,8,["searchQuery","selectedTags"])):I("",!0)],2))])):I("",!0)]),ae(b(de,null,{default:X(()=>[b(vl,{onClose:v})]),_:1},512),[[ye,y.value]]),x.value?(o(),H(de,{key:0},{default:X(()=>[e("div",Hl,[e("div",Wl,[e("div",Zl,[Jl,e("button",{onClick:N[6]||(N[6]=B=>x.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[b(m(re),{class:"h-6 w-6"})])]),e("div",Kl,[b(Oe,{"user-id":k.value.id,"initial-show-options":!k.value.has_signature,onSignatureSaved:M,onCancel:N[7]||(N[7]=B=>x.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):I("",!0),b(Ue,{isVisible:m(ce),documentData:m(Ee),onClose:N[8]||(N[8]=B=>ce.value=!1)},null,8,["isVisible","documentData"])],64)}}};export{_i as default};
