import{e as n,f as l,g as e,u as et,r as x,aJ as Gt,o as Re,ar as ut,c as B,h as o,j as t,G as je,w as Pe,v as qe,n as C,l as E,t as h,m as ve,p as Y,s as ke,b4 as es,i as k,ac as Ge,a9 as Ht,b5 as ts,Q as Dt,k as oe,a2 as Xe,F as de,D as Ct,E as ss,b6 as os,a0 as ns,C as rs,T as ye,N as me,I as Je,a1 as Qe,ag as Fe,ad as Ee,ae as Te,af as ue,b7 as as,O as mt,P as gt,a5 as ls,ah as tt,aX as is,ai as pt,b8 as ht,ab as ds,b9 as wt,ba as zt}from"./index.js";import{u as Ve,o as cs,s as nt,p as It}from"./index2.js";import{g as dt,a as ct}from"./DocumentPermissionsManager.js";import{B as us,r as ms,a as gs,b as ft,c as vt,d as St,e as Ft,L as bt,f as Et,_ as jt,D as Zt,g as ps,s as Nt}from"./index3.js";import{_ as yt}from"./_plugin-vue_export-helper.js";import{r as kt}from"./FolderIcon.js";import{r as Ye}from"./PlusIcon.js";import{r as ot}from"./EllipsisVerticalIcon.js";import{r as rt}from"./DocumentIcon.js";import{_ as hs}from"./DocumentCard.js";import{r as Jt}from"./EyeIcon.js";import{r as at}from"./ChevronRightIcon.js";import{_ as Ot}from"./SignatureDocumentCard.js";import{r as Rt,a as fs,b as vs}from"./TagIcon.js";import{r as Oe}from"./ChevronDownIcon.js";import{r as He}from"./MagnifyingGlassIcon.js";import{r as qt}from"./PencilIcon.js";import{r as Pt}from"./TrashIcon.js";import{r as bs}from"./LinkIcon.js";import{r as Kt}from"./PhotoIcon.js";import{r as Lt}from"./CheckCircleIcon.js";import{r as st,a as lt}from"./FunnelIcon.js";import{r as ys}from"./ArrowLeftIcon.js";import{r as Vt}from"./InformationCircleIcon.js";import{r as Qt}from"./CloudArrowUpIcon.js";import{r as xs}from"./ExclamationTriangleIcon.js";import"./useRecentViews.js";import"./loading_message.js";function Wt(a,v){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})])}function _s(a,v){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})])}function ws(a,v){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})])}const $s={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},ks={class:"flex justify-end"},Cs=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[Y(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),Ds={class:"mt-2"},Ss={class:"flex gap-2 mt-2.5"},Fs=["disabled"],Es=e("span",null,"Actualizar nombre",-1),Ts=[Es],As=["disabled"],Ms={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(a,{emit:v}){const d=a,g=et(),A=Ve(),S=v,u=x(""),F=x(""),_=()=>{S("close")};Gt(()=>{var L,$;A.selectedDocument?(u.value=((L=A.selectedDocument)==null?void 0:L.title)||"",F.value=(($=A.selectedDocument)==null?void 0:$.title)||""):(u.value="",F.value="")});const P=L=>{L.key==="Escape"&&_()};Re(()=>{document.addEventListener("keydown",P)}),ut(()=>{document.removeEventListener("keydown",P)});const se=B(()=>u.value.trim().length>0),Q=B(()=>{var L;return!!((L=A.selectedDocument)!=null&&L.id)}),K=B(()=>Q.value&&u.value.trim()!==F.value.trim()&&u.value.trim().length>0);async function O(){if(Q.value&&K.value)try{const L={title:u.value.trim()};await A.updateDocument(A.selectedDocument.id,L),F.value=u.value.trim(),A.selectedDocument.title=u.value.trim();const $=A.selectedDocument.id;ke("Document name successfully updated.","success"),S("close",{updatedDocId:$});const w=window.location.pathname;w==="/dynamic_document_dashboard"||w==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(L){console.error("Error updating document name:",L),ke("Error updating document name.","error")}}function m(){const L=encodeURIComponent(u.value.trim());d.documentId&&!A.selectedDocument?g.push(`/dynamic_document_dashboard/document/use/creator/${d.documentId}/${L}`):A.selectedDocument?(A.selectedDocument.title=u.value.trim(),g.push(`/dynamic_document_dashboard/document/use/editor/${A.selectedDocument.id}/${L}`)):ke("Error: No se pudo continuar. Documento no seleccionado.","error")}return(L,$)=>(n(),l("div",$s,[e("div",ks,[e("button",{onClick:_},[o(t(je),{class:"size-6"})])]),e("form",{onSubmit:ve(m,["prevent"])},[e("div",null,[Cs,e("div",Ds,[Pe(e("input",{"onUpdate:modelValue":$[0]||($[0]=V=>u.value=V),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[qe,u.value]])])]),e("div",Ss,[Q.value?(n(),l("button",{key:0,type:"button",onClick:O,disabled:!K.value,class:C(["p-2.5 text-sm font-medium rounded-md flex gap-2",K.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Ts,10,Fs)):E("",!0),e("button",{type:"submit",class:C(["p-2.5 text-sm font-medium rounded-md flex gap-2",se.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!se.value},[e("span",null,h(Q.value?"Editar Documento":"Continuar"),1)],10,As)])],32)]))}},Ps={class:"mt-3 pt-2 border-t border-gray-100"},Ls={class:"flex items-center gap-2 text-xs text-gray-500"},Is=e("span",null,"Hacer clic para usar este documento",-1),js={__name:"UseDocumentCard",props:{document:{type:Object,required:!0},showTags:{type:Boolean,default:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null}},emits:["click","remove-from-folder","document-created"],setup(a,{emit:v}){const d=a,g=v,A=x(!1),S=x(null),u=dt(9),F=B(()=>"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium !bg-purple-100 !text-purple-700 !border !border-purple-200"),_=B(()=>u.dark),P=B(()=>"group !border-purple-400 !bg-purple-50/50 !shadow-purple-100"),se=B(()=>d.menuOptions!==null?d.menuOptions:[{label:"Usar",action:"use",icon:_s,iconClasses:"w-4 h-4 text-purple-600"},{label:"Previsualización",action:"preview",icon:Jt,iconClasses:"w-4 h-4 text-gray-600"}]),Q=B(()=>!1),K=($,V)=>{d.disableInternalActions?g("click",$,V):m($.id)},O=($,V)=>{switch($){case"use":m(V.id);break;case"preview":cs(V);break;default:console.warn("Unknown menu action:",$)}};function m($){$?(S.value=$,A.value=!0):console.error("Document ID is required:",$)}function L($){if(A.value=!1,S.value=null,$&&$.updatedDocId){g("document-created",$);const V=window.location.pathname;V==="/dynamic_document_dashboard"||V==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight($.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}}return($,V)=>(n(),l(de,null,[o(us,{document:a.document,"card-type":a.cardType,"card-context":a.cardContext,"status-icon":t(ts),"status-text":"Disponible","status-badge-classes":F.value,"menu-options":se.value,"highlighted-doc-id":null,"show-tags":a.showTags,"document-store":a.documentStore,"user-store":a.userStore,"additional-classes":P.value,"disable-internal-actions":a.disableInternalActions,"show-menu-options":a.showMenuOptions,onClick:K,onMenuAction:O,onRemoveFromFolder:V[0]||(V[0]=w=>$.$emit("remove-from-folder",w))},es({"additional-actions":k(()=>[Ht($.$slots,"additional-actions")]),_:2},[Q.value?{name:"right-action",fn:k(()=>[o(t(at),{class:"w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors"})]),key:"0"}:void 0,a.disableInternalActions?void 0:{name:"footer",fn:k(()=>[e("div",Ps,[e("div",Ls,[e("div",{class:"w-2 h-2 rounded-full",style:Ge({backgroundColor:_.value})},null,4),Is])])]),key:"1"}]),1032,["document","card-type","card-context","status-icon","status-badge-classes","menu-options","show-tags","document-store","user-store","additional-classes","disable-internal-actions","show-menu-options"]),Pe(o(Xe,null,{default:k(()=>[S.value!==null?(n(),oe(Ms,{key:0,"document-id":S.value,onClose:L},null,8,["document-id"])):E("",!0)]),_:1},512),[[Dt,A.value]])],64))}},Bs=()=>({folders:[],currentFolder:null,isLoading:!1,error:null,lastUpdatedFolderId:null}),Us={sortedFolders:a=>[...a.folders].sort((v,d)=>new Date(d.created_at)-new Date(v.created_at)),getFolderById:a=>v=>a.folders.find(d=>d.id===v),getFoldersByColor:a=>v=>a.folders.filter(d=>d.color_id===v),getFolderWithColor:a=>v=>{const d=a.folders.find(g=>g.id===v);return d?{...d,color:dt(d.color_id)}:null},getFoldersContainingDocument:a=>v=>a.folders.filter(d=>d.document_ids&&d.document_ids.includes(v)),totalDocumentsInFolders:a=>a.folders.reduce((v,d)=>v+(d.document_ids?d.document_ids.length:0),0),hasFolders:a=>a.folders.length>0,availableColors:()=>ct()},zs={async init(a=!1){if(!(this.folders.length>0&&!a)){this.isLoading=!0,this.error=null;try{await this.fetchFolders()}catch(v){console.error("Error initializing document folder store:",v),this.error="Error al inicializar las carpetas"}finally{this.isLoading=!1}}},async fetchFolders(){try{const a=await Ct("dynamic-documents/folders/");if(a.status===200)return this.folders=a.data,a.data;throw new Error(`Error fetching folders: ${a.status}`)}catch(a){throw console.error("Error fetching folders:",a),this.error="Error al obtener las carpetas",a}},async fetchFolder(a){this.isLoading=!0,this.error=null;try{const v=await Ct(`dynamic-documents/folders/${a}/`);if(v.status===200){const d=v.data,g=this.folders.findIndex(A=>A.id===d.id);return g!==-1?this.folders[g]=d:this.folders.push(d),this.currentFolder=d,d}else throw new Error(`Error fetching folder: ${v.status}`)}catch(v){throw console.error("Error fetching folder:",v),this.error="Error al obtener la carpeta",v}finally{this.isLoading=!1}},async createFolder(a){this.isLoading=!0,this.error=null;try{if(!a.name||a.name.trim()==="")throw new Error("El nombre de la carpeta es requerido");const v=a.color_id??0;if(v<0||v>=ct().length)throw new Error("Color de carpeta no válido");const d={name:a.name.trim(),color_id:v,...a.document_ids&&{document_ids:a.document_ids}},g=await ss("dynamic-documents/folders/create/",d);if(g.status===200||g.status===201){const A=g.data;return this.folders.push(A),this.lastUpdatedFolderId=A.id,ke("Carpeta creada exitosamente","success"),A}else throw new Error(`Error creating folder: ${g.status}`)}catch(v){throw console.error("Error creating folder:",v),this.error=v.message||"Error al crear la carpeta",ke(this.error,"error"),v}finally{this.isLoading=!1}},async updateFolder(a,v){this.isLoading=!0,this.error=null;try{if(v.name&&v.name.trim()==="")throw new Error("El nombre de la carpeta no puede estar vacío");if(v.color_id!==void 0){const A=v.color_id;if(A<0||A>=ct().length)throw new Error("Color de carpeta no válido")}const d={};v.name&&(d.name=v.name.trim()),v.color_id!==void 0&&(d.color_id=v.color_id),v.document_ids!==void 0&&(d.document_ids=v.document_ids);const g=await os(`dynamic-documents/folders/${a}/update/`,d);if(g.status===200){const A=g.data,S=this.folders.findIndex(u=>u.id===a);return S!==-1&&(this.folders[S]=A),this.currentFolder&&this.currentFolder.id===a&&(this.currentFolder=A),this.lastUpdatedFolderId=a,ke("Carpeta actualizada exitosamente","success"),A}else throw new Error(`Error updating folder: ${g.status}`)}catch(d){throw console.error("Error updating folder:",d),this.error=d.message||"Error al actualizar la carpeta",ke(this.error,"error"),d}finally{this.isLoading=!1}},async deleteFolder(a){this.isLoading=!0,this.error=null;try{const v=await ns(`dynamic-documents/folders/${a}/delete/`);if(v.status===204||v.status===200)return this.folders=this.folders.filter(d=>d.id!==a),this.currentFolder&&this.currentFolder.id===a&&(this.currentFolder=null),await ke("Carpeta eliminada exitosamente","success"),!0;throw new Error(`Error deleting folder: ${v.status}`)}catch(v){throw console.error("Error deleting folder:",v),this.error=v.message||"Error al eliminar la carpeta",await ke(this.error,"error"),v}finally{this.isLoading=!1}},setCurrentFolder(a){this.currentFolder=a},clearCurrentFolder(){this.currentFolder=null},reset(){this.folders=[],this.currentFolder=null,this.isLoading=!1,this.error=null,this.lastUpdatedFolderId=null}},Ns={async addDocumentsToFolder(a,v){const d=this.getFolderById(a);if(!d)throw new Error("Carpeta no encontrada");const g=d.document_ids||[],A=[...new Set([...g,...v])];return await this.updateFolder(a,{document_ids:A})},async removeDocumentsFromFolder(a,v){const d=this.getFolderById(a);if(!d)throw new Error("Carpeta no encontrada");const A=(d.document_ids||[]).filter(S=>!v.includes(S));return await this.updateFolder(a,{document_ids:A})},async moveDocumentsBetweenFolders(a,v,d){try{v&&await this.removeDocumentsFromFolder(v,a),d&&await this.addDocumentsToFolder(d,a),await ke("Documentos movidos exitosamente","success")}catch(g){throw console.error("Error moving documents between folders:",g),await ke("Error al mover documentos","error"),g}},getFolderColor(a){const v=this.getFolderById(a);return v?dt(v.color_id):dt(0)},validateFolderData(a){const v=[];if((!a.name||a.name.trim()==="")&&v.push("El nombre de la carpeta es requerido"),a.name&&a.name.length>100&&v.push("El nombre de la carpeta no puede exceder 100 caracteres"),a.color_id!==void 0){const d=a.color_id;(d<0||d>=ct().length)&&v.push("Color de carpeta no válido")}return a.document_ids&&!Array.isArray(a.document_ids)&&v.push("Los IDs de documentos deben ser un array"),{isValid:v.length===0,errors:v}}},Bt=rs("documentFolder",{state:Bs,getters:Us,actions:{...zs,...Ns}}),Os={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Rs={class:"bg-white rounded-xl shadow-xl max-w-md w-full"},qs={class:"flex justify-between items-center p-6 border-b"},Vs={class:"text-lg font-semibold text-gray-900"},Qs={class:"mb-4"},Ws=e("label",{for:"folderName",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la carpeta ",-1),Gs={class:"mb-6"},Hs=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Color de la carpeta ",-1),Zs={class:"grid grid-cols-8 gap-2"},Js=["onClick","title"],Ks={class:"flex gap-3"},Ys=["disabled"],Xs={__name:"CreateEditFolderModal",props:{isVisible:{type:Boolean,required:!0},editingFolder:{type:Object,default:null}},emits:["close","success"],setup(a,{emit:v}){const d=a,g=v,A=Bt(),S=x(!1),u=x({name:"",color_id:0}),F=B(()=>ct()),_=()=>{u.value={name:"",color_id:0}};ye(()=>d.editingFolder,Q=>{Q?u.value={name:Q.name,color_id:Q.color_id}:_()},{immediate:!0}),ye(()=>d.isVisible,Q=>{Q||_()});const P=()=>{g("close")},se=async()=>{if(u.value.name.trim()){S.value=!0;try{d.editingFolder?await A.updateFolder(d.editingFolder.id,u.value):await A.createFolder(u.value),S.value=!1,g("success")}catch{S.value=!1}}};return(Q,K)=>a.isVisible?(n(),oe(Xe,{key:0},{default:k(()=>[e("div",Os,[e("div",Rs,[e("div",qs,[e("h3",Vs,h(a.editingFolder?"Editar Carpeta":"Nueva Carpeta"),1),e("button",{onClick:P,class:"text-gray-400 hover:text-gray-500"},[o(t(je),{class:"w-6 h-6"})])]),e("form",{onSubmit:ve(se,["prevent"]),class:"p-6"},[e("div",Qs,[Ws,Pe(e("input",{id:"folderName","onUpdate:modelValue":K[0]||(K[0]=O=>u.value.name=O),type:"text",required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ej: Contratos Laborales"},null,512),[[qe,u.value.name]])]),e("div",Gs,[Hs,e("div",Zs,[(n(!0),l(de,null,me(F.value,O=>(n(),l("button",{key:O.id,type:"button",onClick:m=>u.value.color_id=O.id,class:C(["w-8 h-8 rounded-full border-2 transition-all",u.value.color_id===O.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"]),style:Ge({backgroundColor:O.hex}),title:O.name},null,14,Js))),128))])]),e("div",Ks,[e("button",{type:"button",onClick:P,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:!u.value.name.trim()||S.value,class:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},h(S.value?"Guardando...":a.editingFolder?"Actualizar":"Crear"),9,Ys)])],32)])])]),_:1})):E("",!0)}},eo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},to={class:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col"},so={class:"border-b px-6 py-4 flex-shrink-0"},oo={class:"flex justify-between items-center"},no={class:"flex items-center gap-3"},ro={class:"text-xl font-semibold text-gray-900"},ao={class:"text-sm text-gray-600"},lo={class:"flex items-center gap-2"},io={class:"flex-1 overflow-y-auto p-6"},co={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},uo={class:"min-w-full divide-y divide-gray-200"},mo=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tipo "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),go={class:"bg-white divide-y divide-gray-200"},po=["onClick"],ho={class:"px-6 py-4 whitespace-nowrap"},fo={class:"flex items-center"},vo={class:"flex-shrink-0 h-10 w-10"},bo={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},yo={class:"ml-4"},xo={class:"text-sm font-medium text-gray-900"},_o={class:"px-6 py-4 whitespace-nowrap"},wo={class:"text-sm text-gray-600"},$o={class:"px-6 py-4 whitespace-nowrap"},ko={class:"px-6 py-4 whitespace-nowrap"},Co={class:"flex flex-wrap gap-1"},Do={key:0,class:"text-sm text-gray-400"},So={class:"py-1"},Fo=["onClick"],Eo=["onClick"],To={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Ao=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"Esta carpeta está vacía",-1),Mo=e("p",{class:"text-gray-600 mb-4"},"Agrega documentos para organizar tu trabajo",-1),Po={__name:"FolderDetailsModalTable",props:{folder:{type:Object,default:null}},emits:["close","add-documents","remove-document","view-document","use-document","document-action"],setup(a,{emit:v}){const d=a,g=v;Je(),Ve();const A=x({}),S=x({}),u=x(!1),F=x(-1),_=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],P=B(()=>{if(!d.folder)return _[0];if(d.folder.color)return _.find(M=>M.name===d.folder.color)||_[0];const p=d.folder.id%_.length;return _[p]}),se=p=>p.state==="Published"||p.state==="Draft"?"Formato":p.state==="PendingSignatures"||p.state==="FullySigned"?"Para Firmar":p.state==="Progress"||p.state==="Completed"?"Mis Documentos":"Documento",Q=p=>({Published:"Publicado",Draft:"Borrador",Progress:"En Progreso",Completed:"Completado",PendingSignatures:"Pendiente Firma",FullySigned:"Firmado"})[p.state]||p.state,K=p=>({Published:"bg-green-100 text-green-700 border border-green-200",Draft:"bg-gray-100 text-gray-700 border border-gray-200",Progress:"bg-blue-100 text-blue-700 border border-blue-200",Completed:"bg-green-100 text-green-700 border border-green-200",PendingSignatures:"bg-yellow-100 text-yellow-700 border border-yellow-200",FullySigned:"bg-green-100 text-green-700 border border-green-200"})[p.state]||"bg-gray-100 text-gray-700 border border-gray-200",O=p=>{const M=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],R=p.id%M.length;return M[R]},m=()=>{g("close")},L=()=>{g("add-documents",d.folder)},$=p=>{g("remove-document",{folderId:d.folder.id,documentId:p.id})},V=p=>{const M=se(p);g(M==="Formato"?"use-document":"view-document",p)},w=()=>!u.value||!d.folder?"auto":d.folder.documents.length===1?"280px":d.folder.documents.length===2&&F.value===1?"340px":"280px",D=(p,M)=>{p&&(A.value[M]=p)},ae=(p,M)=>{p&&(S.value[M]=p)},U=(p,M)=>{u.value=!M,F.value=M?-1:p,M||setTimeout(()=>{const R=S.value[p];if(R){const T=R.$el||R;if(T&&T.getBoundingClientRect){const z=T.getBoundingClientRect(),ne=window.innerHeight;if(p===0){if(z.bottom>ne-20){const X=z.bottom-ne+40;window.scrollBy({top:X,behavior:"smooth"})}}else if(z.bottom>ne-10){const X=z.bottom-ne+30;window.scrollBy({top:X,behavior:"smooth"})}else if(z.top<80){const X=z.top-100;window.scrollBy({top:X,behavior:"smooth"})}}}},100)};return(p,M)=>a.folder?(n(),oe(Xe,{key:0},{default:k(()=>[e("div",eo,[e("div",to,[e("div",so,[e("div",oo,[e("div",no,[e("div",{class:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:Ge({backgroundColor:P.value.hex+"20"})},[o(t(kt),{class:"h-6 w-6",style:Ge({color:P.value.hex})},null,8,["style"])],4),e("div",null,[e("h3",ro,h(a.folder.name),1),e("p",ao,h(a.folder.documents.length)+" documento"+h(a.folder.documents.length!==1?"s":""),1)])]),e("div",lo,[e("button",{onClick:L,class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"},[o(t(Ye),{class:"w-5 h-5"}),Y(" Agregar documentos ")]),e("button",{onClick:m,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[o(t(je),{class:"w-6 h-6"})])])])]),e("div",io,[a.folder.documents.length>0?(n(),l("div",co,[e("div",{class:"overflow-x-auto",style:Ge({minHeight:w()})},[e("table",uo,[mo,e("tbody",go,[(n(!0),l(de,null,me(a.folder.documents,(R,T)=>(n(),l("tr",{key:R.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:z=>V(R)},[e("td",ho,[e("div",fo,[e("div",vo,[e("div",bo,[o(t(Qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",yo,[e("div",xo,h(R.title),1)])])]),e("td",_o,[e("span",wo,h(se(R)),1)]),e("td",$o,[e("span",{class:C(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",K(R)])},h(Q(R)),3)]),e("td",ko,[e("div",Co,[(n(!0),l(de,null,me(R.tags,z=>(n(),l("span",{key:z.id,class:C(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",O(z)])},h(z.name),3))),128)),!R.tags||R.tags.length===0?(n(),l("span",Do,"-")):E("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:M[0]||(M[0]=ve(()=>{},["stop"]))},[o(t(Fe),{as:"div",class:"relative inline-block text-left"},{default:k(({open:z})=>[o(t(Ee),{ref_for:!0,ref:ne=>D(ne,T),onClick:ne=>U(T,z),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:k(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),o(t(Te),{ref_for:!0,ref:ne=>ae(ne,T),class:C([a.folder.documents.length>2&&T>0&&T>=a.folder.documents.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:k(()=>[e("div",So,[o(t(ue),null,{default:k(({active:ne})=>[e("a",{onClick:X=>V(R),class:C([ne?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver documento ",10,Fo)]),_:2},1024),o(t(ue),null,{default:k(({active:ne})=>[e("a",{onClick:X=>$(R),class:C([ne?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Quitar de carpeta ",10,Eo)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,po))),128))])])],4)])):(n(),l("div",To,[o(t(rt),{class:"w-12 h-12 text-gray-300 mx-auto mb-4"}),Ao,Mo,e("button",{onClick:L,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},[o(t(Ye),{class:"w-5 h-5"}),Y(" Agregar documentos ")])]))])])])]),_:1})):E("",!0)}},xt=a=>(mt("data-v-d403a707"),a=a(),gt(),a),Lo={class:"tag-filter-container"},Io={class:"relative"},jo={class:"flex items-center"},Bo={key:0,class:"ml-2 inline-flex items-center justify-center h-5 w-5 bg-primary text-white text-xs rounded-full font-medium"},Uo={key:0,class:"absolute left-0 mt-2 w-full sm:w-80 bg-white rounded-xl shadow-xl ring-1 ring-black ring-opacity-5 border border-gray-100 z-50 overflow-hidden"},zo={class:"bg-gray-50 p-4 border-b border-gray-200"},No={class:"flex items-center justify-between mb-3"},Oo=xt(()=>e("h3",{class:"text-sm font-semibold text-gray-900"},"Filtrar por etiquetas",-1)),Ro={key:0,class:"text-xs text-gray-500"},qo={class:"relative"},Vo={key:0,class:"px-4 py-2 bg-blue-50 border-b border-blue-100"},Qo={class:"flex items-center justify-between"},Wo={class:"text-xs font-medium text-blue-700"},Go={class:"max-h-52 overflow-y-auto"},Ho={key:0,class:"px-4 py-8 text-center"},Zo=xt(()=>e("p",{class:"text-gray-500 text-sm"},"No hay etiquetas disponibles",-1)),Jo={key:1,class:"px-4 py-8 text-center"},Ko={class:"text-gray-500 text-sm"},Yo={key:2,class:"px-4 py-8 text-center"},Xo=xt(()=>e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"}),e("span",{class:"ml-3 text-sm text-gray-600"},"Cargando etiquetas...")],-1)),en=[Xo],tn={key:3,class:"py-2"},sn=["onClick"],on={class:"flex items-center h-5"},nn={class:"relative"},rn=["id","checked","onChange"],an={key:0,class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},ln=xt(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),dn=[ln],cn={class:"ml-3 flex items-center flex-1 min-w-0"},un={class:"text-sm font-medium text-gray-900 truncate"},mn={key:0,class:"mt-4"},gn={class:"flex items-start gap-2"},pn=xt(()=>e("span",{class:"text-xs font-medium text-gray-500 mt-1.5 flex-shrink-0"},"Activos:",-1)),hn={class:"flex flex-wrap gap-2"},fn=["onClick"],vn={class:"mr-1"},bn={class:"ml-1 p-0.5 rounded-full hover:bg-white/50 transition-colors duration-150"},yn={__name:"TagFilter",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(a,{emit:v}){const d=a,g=v,A=Ve(),S=x(!1),u=x([]),F=x(!1),_=x(""),P=B(()=>A.sortedTags),se=B(()=>{if(!_.value.trim())return P.value;const V=_.value.toLowerCase().trim();return P.value.filter(w=>w.name.toLowerCase().includes(V))}),Q=V=>{const w=dt(V.color_id);return{hex:w&&w.hex?w.hex:"#9CA3AF",dark:w&&w.dark?w.dark:"#374151"}},K=()=>{S.value=!S.value,S.value&&(_.value="")},O=V=>u.value.some(w=>w.id===V.id),m=V=>{const w=u.value.findIndex(D=>D.id===V.id);w>=0?u.value.splice(w,1):u.value.push(V),g("update:modelValue",u.value)},L=()=>{u.value=[],g("update:modelValue",[])},$=V=>{V.target.closest(".tag-filter-container")||(S.value=!1,_.value="")};return Re(async()=>{try{F.value=!0,await A.initTags()}catch(V){console.error("Error loading tags:",V)}finally{F.value=!1}document.addEventListener("click",$)}),ye(()=>d.modelValue,V=>{u.value=V||[]},{immediate:!0}),ut(()=>{document.removeEventListener("click",$)}),(V,w)=>(n(),l("div",Lo,[e("div",Io,[e("button",{onClick:K,class:C(["group inline-flex items-center justify-between w-full sm:w-auto sm:min-w-[200px] px-4 py-3 border border-gray-200 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-primary transition-all duration-200",{"ring-2 ring-primary border-primary bg-blue-50":S.value,"border-primary bg-primary/5":u.value.length>0&&!S.value}])},[e("div",jo,[o(t(Rt),{class:C(["h-5 w-5 mr-2.5 text-gray-500 group-hover:text-gray-600",{"text-primary":u.value.length>0||S.value}])},null,8,["class"]),e("span",{class:C(["text-gray-700",{"text-primary font-semibold":u.value.length>0||S.value}])}," Filtrar por etiquetas ",2),u.value.length>0?(n(),l("span",Bo,h(u.value.length),1)):E("",!0)]),o(t(Oe),{class:C(["ml-3 h-4 w-4 text-gray-400 transition-all duration-200 group-hover:text-gray-600",{"rotate-180 text-primary":S.value,"text-primary":u.value.length>0&&!S.value}])},null,8,["class"])],2),o(as,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:k(()=>[S.value?(n(),l("div",Uo,[e("div",zo,[e("div",No,[Oo,P.value.length>0?(n(),l("span",Ro,h(P.value.length)+" disponibles ",1)):E("",!0)]),e("div",qo,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":w[0]||(w[0]=D=>_.value=D),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"},null,512),[[qe,_.value]])])]),u.value.length>0?(n(),l("div",Vo,[e("div",Qo,[e("span",Wo,h(u.value.length)+" etiqueta"+h(u.value.length!==1?"s":"")+" seleccionada"+h(u.value.length!==1?"s":""),1),e("button",{onClick:L,class:"text-xs text-red-600 hover:text-red-700 font-medium px-2 py-1 rounded-md hover:bg-red-50 transition-all duration-200"}," Limpiar todo ")])])):E("",!0),e("div",Go,[!F.value&&se.value.length===0&&_.value.trim()===""?(n(),l("div",Ho,[o(t(Rt),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),Zo])):E("",!0),!F.value&&se.value.length===0&&_.value.trim()!==""?(n(),l("div",Jo,[o(t(He),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e("p",Ko,'Sin resultados para "'+h(_.value)+'"',1),e("button",{onClick:w[1]||(w[1]=D=>_.value=""),class:"text-xs text-primary hover:text-primary-dark mt-2 font-medium"}," Ver todas las etiquetas ")])):E("",!0),F.value?(n(),l("div",Yo,en)):E("",!0),!F.value&&se.value.length>0?(n(),l("div",tn,[(n(!0),l(de,null,me(se.value,D=>(n(),l("div",{key:D.id,class:"group flex items-center px-4 py-2.5 hover:bg-gray-50 cursor-pointer transition-colors duration-150",onClick:ae=>m(D)},[e("div",on,[e("div",nn,[e("input",{id:`tag-${D.id}`,type:"checkbox",checked:O(D),onChange:ae=>m(D),class:"sr-only"},null,40,rn),e("div",{class:C(["w-4 h-4 border-2 rounded transition-all duration-200 flex items-center justify-center",O(D)?"bg-primary border-primary":"border-gray-300 group-hover:border-gray-400"])},[O(D)?(n(),l("svg",an,dn)):E("",!0)],2)])]),e("div",cn,[e("div",{class:"w-3 h-3 rounded-full mr-2.5 border flex-shrink-0 shadow-sm",style:Ge({backgroundColor:Q(D).hex})},null,4),e("span",un,h(D.name),1)])],8,sn))),128))])):E("",!0)])])):E("",!0)]),_:1})]),u.value.length>0?(n(),l("div",mn,[e("div",gn,[pn,e("div",hn,[(n(!0),l(de,null,me(u.value,D=>(n(),l("div",{key:D.id,class:"group inline-flex items-center pl-2.5 pr-1.5 py-1.5 rounded-lg text-xs font-medium border shadow-sm cursor-pointer transition-all duration-200 hover:shadow-md",style:Ge({backgroundColor:Q(D).hex+"20",borderColor:Q(D).hex+"40",color:Q(D).dark}),onClick:ae=>m(D)},[e("div",{class:"w-2 h-2 rounded-full mr-2 flex-shrink-0",style:Ge({backgroundColor:Q(D).hex})},null,4),e("span",vn,h(D.name),1),e("div",bn,[o(t(je),{class:"h-3 w-3 opacity-60 group-hover:opacity-100"})])],12,fn))),128))])])])):E("",!0)]))}},xn=yt(yn,[["__scopeId","data-v-d403a707"]]),_n={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},wn={class:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden"},$n={class:"border-b"},kn={class:"hidden sm:flex justify-between items-center p-6"},Cn=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Dn={class:"text-sm text-gray-600"},Sn={class:"sm:hidden p-4"},Fn={class:"flex justify-between items-start mb-2"},En={class:"flex-1 min-w-0 mr-3"},Tn=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),An={class:"text-sm text-gray-600 truncate"},Mn={class:"border-b"},Pn={class:"hidden sm:flex space-x-8 px-6","aria-label":"Tabs"},Ln=["onClick"],In={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},jn={class:"sm:hidden relative px-4 py-3"},Bn={class:"flex items-center"},Un={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},zn=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),Nn=[zn],On={class:"absolute top-full left-4 right-4 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},Rn=["onClick"],qn={class:"border-b bg-gray-50 p-4 sm:p-6"},Vn={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Qn={class:"flex-1"},Wn={key:0,class:"flex items-center gap-3"},Gn={class:"text-sm text-gray-600"},Hn={class:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-350px)]"},Zn={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Jn={key:4,class:"absolute top-2 left-2 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center shadow-sm"},Kn={key:0,class:"text-center py-8 sm:py-12"},Yn={class:"text-lg font-medium text-gray-900 mb-2"},Xn={class:"text-gray-600 text-sm sm:text-base"},er={class:"border-t bg-gray-50"},tr={class:"hidden sm:flex justify-between items-center p-6"},sr={class:"text-sm text-gray-600"},or={class:"flex gap-3"},nr=["disabled"],rr={class:"sm:hidden p-4 space-y-3"},ar={class:"text-center text-sm text-gray-600"},lr={class:"flex gap-3"},ir=["disabled"],dr={__name:"AddDocumentsModal",props:{isVisible:{type:Boolean,required:!0},folder:{type:Object,default:null}},emits:["close","add-documents"],setup(a,{emit:v}){const d=a,g=v,A=Ve(),S=Je(),u=x([]),F=x([]),_=x("my-documents"),P=x(!1),se=x(!1),Q=[{name:"my-documents",label:"Mis Documentos"},{name:"use-documents",label:"Formatos Disponibles"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Documentos Firmados"}],K=B(()=>S.currentUser);ye(()=>d.isVisible,p=>{p&&(u.value=[],F.value=[],_.value="my-documents")}),ye(_,()=>{u.value=[]}),ye(F,()=>{u.value=[]},{deep:!0});const O=B(()=>{const p=L(_.value);return p.length===0?!1:p.every(M=>u.value.includes(M.id))}),m=p=>{var T;if(!d.folder)return[];const M=d.folder.documents.map(z=>z.id);let R=[];switch(p){case"my-documents":R=A.progressAndCompletedDocumentsByClient((T=K.value)==null?void 0:T.id);break;case"use-documents":R=A.publishedDocumentsUnassigned;break;case"pending-signatures":R=A.documents.filter(z=>{var ne,X;return z.state==="PendingSignatures"&&(z.assigned_to===((ne=K.value)==null?void 0:ne.id)||((X=z.signatures)==null?void 0:X.some(f=>{var N;return f.signer_email===((N=K.value)==null?void 0:N.email)})))});break;case"signed-documents":R=A.documents.filter(z=>{var ne,X;return z.state==="FullySigned"&&(z.assigned_to===((ne=K.value)==null?void 0:ne.id)||((X=z.signatures)==null?void 0:X.some(f=>{var N;return f.signer_email===((N=K.value)==null?void 0:N.email)})))});break;default:R=[]}return R.filter(z=>!M.includes(z.id))},L=p=>{const M=m(p);if(!F.value||F.value.length===0)return M;const R=F.value.map(T=>T.id);return M.filter(T=>!T.tags||T.tags.length===0?!1:T.tags.some(z=>R.includes(z.id)))},$=p=>{const M=u.value.indexOf(p);M>-1?u.value.splice(M,1):u.value.push(p)},V=()=>{const M=L(_.value).map(R=>R.id);if(O.value)u.value=u.value.filter(R=>!M.includes(R));else{const R=M.filter(T=>!u.value.includes(T));u.value.push(...R)}},w=()=>{g("close")},D=async()=>{if(u.value.length!==0){P.value=!0;try{await g("add-documents",u.value)}finally{P.value=!1}}},ae=p=>{_.value=p,se.value=!1},U=p=>{p.target.closest(".relative")||(se.value=!1)};return Re(()=>{document.addEventListener("click",U)}),ut(()=>{document.removeEventListener("click",U)}),(p,M)=>a.isVisible&&a.folder?(n(),oe(Xe,{key:0},{default:k(()=>{var R;return[e("div",_n,[e("div",wn,[e("div",$n,[e("div",kn,[e("div",null,[Cn,e("p",Dn,'Selecciona documentos para agregar a "'+h(a.folder.name)+'"',1)]),e("button",{onClick:w,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors"},[o(t(je),{class:"w-5 h-5"})])]),e("div",Sn,[e("div",Fn,[e("div",En,[Tn,e("p",An,'Para "'+h(a.folder.name)+'"',1)]),e("button",{onClick:w,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors flex-shrink-0"},[o(t(je),{class:"w-5 h-5"})])])])]),e("div",Mn,[e("nav",Pn,[(n(),l(de,null,me(Q,T=>e("button",{key:T.name,onClick:z=>_.value=T.name,class:C([_.value===T.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[Y(h(T.label)+" ",1),e("span",In,h(L(T.name).length),1)],10,Ln)),64))]),e("div",jn,[e("button",{onClick:M[0]||(M[0]=T=>se.value=!se.value),class:"w-full flex items-center justify-between py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("div",Bn,[e("span",null,h(((R=Q.find(T=>T.name===_.value))==null?void 0:R.label)||"Seleccionar categoría"),1),e("span",Un,h(L(_.value).length),1)]),(n(),l("svg",{class:C(["ml-2 h-5 w-5 transition-transform duration-200",se.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Nn,2))]),Pe(e("div",On,[(n(),l(de,null,me(Q,T=>e("button",{key:T.name,onClick:z=>ae(T.name),class:C(["w-full text-left px-4 py-3 text-sm transition-colors duration-150 flex items-center justify-between",_.value===T.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},[e("span",null,h(T.label),1),e("span",{class:C(["py-0.5 px-2 rounded-full text-xs",_.value===T.name?"bg-white/20 text-white":"bg-gray-100 text-gray-600"])},h(L(T.name).length),3)],10,Rn)),64))],512),[[Dt,se.value]])])]),e("div",qn,[e("div",Vn,[e("div",Qn,[o(xn,{modelValue:F.value,"onUpdate:modelValue":M[1]||(M[1]=T=>F.value=T),class:"max-w-md"},null,8,["modelValue"])]),L(_.value).length>0?(n(),l("div",Wn,[e("span",Gn,h(L(_.value).length)+" documento(s) disponible(s) ",1),e("button",{onClick:V,class:C(["px-4 py-2 rounded-lg border font-medium text-sm transition-colors",O.value?"bg-red-50 border-red-200 text-red-700 hover:bg-red-100":"bg-primary text-white border-primary hover:bg-primary-dark"])},h(O.value?"Deseleccionar todos":"Seleccionar todos"),3)])):E("",!0)])]),e("div",Hn,[e("div",Zn,[(n(!0),l(de,null,me(L(_.value),T=>(n(),l("div",{key:T.id,class:"relative"},[_.value==="my-documents"?(n(),oe(t(hs),{key:0,document:T,"highlighted-doc-id":null,"show-tags":!0,"show-client-name":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":u.value.includes(T.id)?"ring-2 ring-primary bg-primary-50":"",onClick:z=>$(T.id)},null,8,["document","additional-classes","onClick"])):E("",!0),_.value==="use-documents"?(n(),oe(t(js),{key:1,document:T,"show-tags":!0,"menu-options":[],"show-menu-options":!1,"disable-internal-actions":!0,"additional-classes":u.value.includes(T.id)?"ring-2 ring-primary bg-primary-50":"",onClick:z=>$(T.id)},null,8,["document","additional-classes","onClick"])):E("",!0),_.value==="pending-signatures"?(n(),oe(t(Ot),{key:2,document:T,"highlighted-doc-id":null,"show-tags":!0,"menu-options":[],"disable-internal-actions":!0,"additional-classes":u.value.includes(T.id)?"ring-2 ring-primary bg-primary-50":"",onClick:z=>$(T.id)},null,8,["document","additional-classes","onClick"])):E("",!0),_.value==="signed-documents"?(n(),oe(t(Ot),{key:3,document:T,"highlighted-doc-id":null,"show-tags":!0,"menu-options":[],"disable-internal-actions":!0,"additional-classes":u.value.includes(T.id)?"ring-2 ring-primary bg-primary-50":"",onClick:z=>$(T.id)},null,8,["document","additional-classes","onClick"])):E("",!0),u.value.includes(T.id)?(n(),l("div",Jn,[o(t(fs),{class:"w-4 h-4"})])):E("",!0)]))),128))]),L(_.value).length===0?(n(),l("div",Kn,[o(t(rt),{class:"w-12 h-12 sm:w-16 sm:h-16 text-gray-300 mx-auto mb-4"}),e("h4",Yn,h(F.value.length>0?"No hay documentos que coincidan con el filtro":"No hay documentos disponibles"),1),e("p",Xn,h(F.value.length>0?"Intenta ajustar los filtros de etiquetas o selecciona otra categoría":"No tienes documentos de esta categoría que no estén ya en la carpeta"),1)])):E("",!0)]),e("div",er,[e("div",tr,[e("div",sr,h(u.value.length)+" documento(s) seleccionado(s) ",1),e("div",or,[e("button",{onClick:w,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{onClick:D,disabled:u.value.length===0||P.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},h(P.value?"Agregando...":`Agregar ${u.value.length} documento(s)`),9,nr)])]),e("div",rr,[e("div",ar,h(u.value.length)+" documento(s) seleccionado(s) ",1),e("div",lr,[e("button",{onClick:w,class:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center font-medium"}," Cancelar "),e("button",{onClick:D,disabled:u.value.length===0||P.value,class:"flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-center font-medium"},h(P.value?"Agregando...":"Agregar"),9,ir)])])])])])]}),_:1})):E("",!0)}},it=a=>(mt("data-v-d9a5a89f"),a=a(),gt(),a),cr={class:"folders-table"},ur={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200",style:{"overflow-x":"visible","overflow-y":"hidden"}},mr={class:"min-w-full divide-y divide-gray-200"},gr=it(()=>e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Carpeta "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documentos "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Creada "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1)),pr={class:"bg-white divide-y divide-gray-200"},hr=["onClick"],fr={class:"px-6 py-4 whitespace-nowrap"},vr={class:"flex items-center"},br={class:"flex-shrink-0 h-10 w-10"},yr={class:"ml-4"},xr={class:"text-sm font-medium text-gray-900"},_r={class:"px-6 py-4 whitespace-nowrap"},wr={class:"flex items-center gap-2"},$r={class:"text-sm text-gray-900"},kr={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Cr={class:"py-1"},Dr=["onClick"],Sr=["onClick"],Fr=["onClick"],Er=["onClick"],Tr={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Ar=it(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No tienes carpetas aún",-1)),Mr=it(()=>e("p",{class:"text-gray-600 mb-6"},"Crea tu primera carpeta para organizar tus documentos",-1)),Pr={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Lr=it(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No se encontraron carpetas",-1)),Ir=it(()=>e("p",{class:"text-gray-600"},"No hay carpetas que coincidan con tu búsqueda",-1)),jr={key:3,class:"flex justify-center items-center py-12"},Br=it(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)),Ur=[Br],zr={__name:"FoldersTable",props:{sortedFolders:{type:Array,required:!0},searchQuery:{type:String,default:""},isLoading:{type:Boolean,default:!1}},emits:["folder-click","edit-folder","delete-folder","add-documents","create-folder"],setup(a,{emit:v}){const d=a,g=v,A=x({}),S=x({}),u=x(!1),F=x(-1),_=B(()=>{if(!d.searchQuery.trim())return d.sortedFolders;const U=d.searchQuery.toLowerCase();return d.sortedFolders.filter(p=>p.name.toLowerCase().includes(U))}),P=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],se=U=>{if(U.color)return P.find(M=>M.name===U.color)||P[0];const p=U.id%P.length;return P[p]},Q=U=>{if(!U)return"-";const p=new Date(U),R=Math.abs(new Date-p),T=Math.ceil(R/(1e3*60*60*24));return T===0?"Hoy":T===1?"Ayer":T<7?`Hace ${T} días`:T<30?`Hace ${Math.floor(T/7)} semanas`:T<365?`Hace ${Math.floor(T/30)} meses`:p.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},K=U=>{g("folder-click",U)},O=U=>{g("edit-folder",U)},m=U=>{g("delete-folder",U)},L=U=>{g("add-documents",U)},$=()=>{g("create-folder")},V=()=>u.value?_.value.length===1?"280px":_.value.length===2&&F.value===1?"340px":"280px":"auto",w=(U,p)=>{U&&(A.value[p]=U)},D=(U,p)=>{U&&(S.value[p]=U)},ae=(U,p)=>{u.value=!p,F.value=p?-1:U,p||setTimeout(()=>{const M=S.value[U];if(M){const R=M.$el||M;if(R&&R.getBoundingClientRect){const T=R.getBoundingClientRect(),z=window.innerHeight;if(U===0){if(T.bottom>z-20){const ne=T.bottom-z+40;window.scrollBy({top:ne,behavior:"smooth"})}}else if(T.bottom>z-10){const ne=T.bottom-z+30;window.scrollBy({top:ne,behavior:"smooth"})}else if(T.top<80){const ne=T.top-100;window.scrollBy({top:ne,behavior:"smooth"})}}}},100)};return(U,p)=>(n(),l("div",cr,[!a.isLoading&&_.value.length>0?(n(),l("div",ur,[e("div",{class:"overflow-x-auto",style:Ge({minHeight:V(),overflowY:"visible"})},[e("table",mr,[gr,e("tbody",pr,[(n(!0),l(de,null,me(_.value,(M,R)=>{var T,z;return n(),l("tr",{key:M.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:ne=>K(M)},[e("td",fr,[e("div",vr,[e("div",br,[e("div",{class:"h-10 w-10 rounded-lg flex items-center justify-center",style:Ge({backgroundColor:se(M).hex+"20"})},[o(t(kt),{class:"h-6 w-6",style:Ge({color:se(M).hex})},null,8,["style"])],4)]),e("div",yr,[e("div",xr,h(M.name),1)])])]),e("td",_r,[e("div",wr,[o(t(Qe),{class:"h-5 w-5 text-gray-400"}),e("span",$r,h(((T=M.documents)==null?void 0:T.length)||0)+" documento"+h((((z=M.documents)==null?void 0:z.length)||0)!==1?"s":""),1)])]),e("td",kr,h(Q(M.created_at)),1),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:p[0]||(p[0]=ve(()=>{},["stop"]))},[o(t(Fe),{as:"div",class:"relative inline-block text-left"},{default:k(({open:ne})=>[o(t(Ee),{ref_for:!0,ref:X=>w(X,R),onClick:X=>ae(R,ne),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:k(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),o(t(Te),{ref_for:!0,ref:X=>D(X,R),class:C([_.value.length>2&&R>0&&R>=_.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:k(()=>[e("div",Cr,[o(t(ue),null,{default:k(({active:X})=>[e("a",{onClick:f=>K(M),class:C([X?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver carpeta ",10,Dr)]),_:2},1024),o(t(ue),null,{default:k(({active:X})=>[e("a",{onClick:f=>L(M),class:C([X?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Agregar documentos ",10,Sr)]),_:2},1024),o(t(ue),null,{default:k(({active:X})=>[e("a",{onClick:f=>O(M),class:C([X?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Editar ",10,Fr)]),_:2},1024),o(t(ue),null,{default:k(({active:X})=>[e("a",{onClick:f=>m(M),class:C([X?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Eliminar ",10,Er)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,hr)}),128))])])],4)])):!a.isLoading&&a.sortedFolders.length===0?(n(),l("div",Tr,[o(t(kt),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Ar,Mr,e("button",{onClick:$,class:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"},[o(t(Ye),{class:"w-5 h-5"}),Y(" Crear Primera Carpeta ")])])):!a.isLoading&&a.sortedFolders.length>0&&_.value.length===0?(n(),l("div",Pr,[o(t(kt),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Lr,Ir])):E("",!0),a.isLoading?(n(),l("div",jr,Ur)):E("",!0)]))}},Nr=yt(zr,[["__scopeId","data-v-d9a5a89f"]]),Yt=a=>(mt("data-v-ab5666d5"),a=a(),gt(),a),Or={class:"folder-management"},Rr={class:"mb-6"},qr={class:"hidden sm:flex justify-between items-center"},Vr=Yt(()=>e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Qr={class:"sm:hidden"},Wr=Yt(()=>e("div",{class:"text-center mb-4"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1 px-2"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Gr={__name:"FolderManagement",props:{searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","navigate-to-main"],setup(a,{emit:v}){const d=a,g=v,A=Bt(),S=Ve(),u=Je(),F=x(!1),_=x(null),P=x(null),se=x(!1),Q=x(null),K=B(()=>A.isLoading),O=B(()=>A.sortedFolders);B(()=>u.currentUser),Re(async()=>{await A.init(),await S.init()}),ye(()=>d.searchQuery,()=>{}),ye(()=>A.folders,f=>{var N,G;if(P.value&&f&&f.length>0){const re=f.find(te=>te.id===P.value.id);if(re){const te=((N=P.value.documents)==null?void 0:N.length)||0,fe=((G=re.documents)==null?void 0:G.length)||0;JSON.stringify(P.value)!==JSON.stringify(re)&&(P.value={...re},console.log(`🔄 FolderManagement: Synced selectedFolder "${re.name}" with store. Documents: ${te} → ${fe}`))}}},{deep:!0});const m=()=>{_.value=null,F.value=!0},L=f=>{_.value=f,F.value=!0},$=()=>{F.value=!1,_.value=null},V=()=>{$()},w=f=>{P.value=f},D=()=>{P.value=null},ae=async f=>{if(confirm(`¿Estás seguro de que quieres eliminar la carpeta "${f.name}"?`))try{await A.deleteFolder(f.id),ke(`Carpeta "${f.name}" eliminada correctamente`,"success")}catch(N){ke("Error al eliminar la carpeta","error"),console.error("Error deleting folder:",N)}},U=f=>{Q.value=f,se.value=!0},p=async(f=!1)=>{if(se.value=!1,Q.value=null,f&&P.value)try{await M()}catch(N){console.warn("Error refreshing folder after adding documents:",N)}},M=async()=>{if(P.value)try{await A.fetchFolderById(P.value.id,!0);const f=A.getFolderById(P.value.id);f&&(P.value={...f},console.log("✅ Selected folder refreshed successfully"))}catch(f){throw console.error("❌ Error refreshing selected folder:",f),f}},R=async f=>{var N,G,re;if(!(!Q.value||f.length===0))try{const te=Q.value.documents.map(pe=>pe.id).filter(pe=>pe!=null&&!isNaN(parseInt(pe))).map(pe=>parseInt(pe)),fe=f.filter(pe=>pe!=null&&!isNaN(parseInt(pe))).map(pe=>parseInt(pe)),ce=[...new Set([...te,...fe])];if(console.log("Current document IDs:",te),console.log("Selected document IDs:",fe),console.log("Updated document IDs:",ce),ce.some(pe=>!Number.isInteger(pe)||pe<=0))throw new Error("IDs de documentos inválidos detectados");await A.updateFolder(Q.value.id,{document_ids:ce}),await p(!0),ke(`${fe.length} documento(s) agregado(s) a la carpeta`,"success"),g("navigate-to-main")}catch(te){console.error("Error adding documents to folder:",te),console.error("Error details:",((N=te.response)==null?void 0:N.data)||te.message),(G=te.response)!=null&&G.status?ke(`Error al agregar documentos: ${((re=te.response.data)==null?void 0:re.detail)||te.message}`,"error"):ke("Error al agregar documentos a la carpeta","error")}},T=async f=>{var N,G,re;if(P.value)try{const te=parseInt(f);if(!Number.isInteger(te)||te<=0)throw new Error("ID de documento inválido");const fe=P.value.documents.map(ce=>ce.id).filter(ce=>ce!=null&&!isNaN(parseInt(ce))).map(ce=>parseInt(ce)).filter(ce=>ce!==te);console.log("Removing document ID:",te),console.log("Updated document IDs after removal:",fe),await A.updateFolder(P.value.id,{document_ids:fe}),ke("Documento removido de la carpeta","success"),P.value=null,g("navigate-to-main");try{await A.fetchFolderById(P.value.id,!0);const ce=A.getFolderById(P.value.id);ce&&(P.value=ce),console.log("Folder data refreshed successfully after removal")}catch(ce){console.warn("Error refreshing folder data:",ce);try{P.value={...P.value,documents:P.value.documents.filter(pe=>pe.id!==te)},console.log("Applied optimistic removal for document ID:",te)}catch(pe){console.warn("Optimistic update failed:",pe)}}}catch(te){console.error("Error removing document from folder:",te),console.error("Error details:",((N=te.response)==null?void 0:N.data)||te.message),(G=te.response)!=null&&G.status?ke(`Error al remover documento: ${((re=te.response.data)==null?void 0:re.detail)||te.message}`,"error"):ke("Error al remover el documento de la carpeta","error")}},z=f=>{console.log("View document:",f)},ne=f=>{console.log("Use document:",f)},X=(f,N)=>{console.log("Document action:",f,N)};return(f,N)=>(n(),l("div",Or,[e("div",Rr,[e("div",qr,[Vr,e("button",{onClick:m,class:"inline-flex items-center gap-2 px-4 py-2.5 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md"},[o(t(Ye),{class:"w-5 h-5"}),Y(" Nueva Carpeta ")])]),e("div",Qr,[Wr,e("button",{onClick:m,class:"w-full flex items-center justify-center gap-3 px-4 py-4 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium text-base"},[o(t(Ye),{class:"w-6 h-6"}),Y(" Nueva Carpeta ")])])]),o(t(Nr),{"sorted-folders":O.value,"search-query":a.searchQuery,"is-loading":K.value,onFolderClick:w,onEditFolder:L,onDeleteFolder:ae,onAddDocuments:U,onCreateFolder:m},null,8,["sorted-folders","search-query","is-loading"]),o(t(Xs),{"is-visible":F.value,"editing-folder":_.value,onClose:$,onSuccess:V},null,8,["is-visible","editing-folder"]),o(t(Po),{folder:P.value,onClose:D,onAddDocuments:U,onRemoveDocument:T,onViewDocument:z,onUseDocument:ne,onDocumentAction:X},null,8,["folder"]),o(t(dr),{"is-visible":se.value,folder:Q.value,onClose:p,onAddDocuments:R},null,8,["is-visible","folder"])]))}},Hr=yt(Gr,[["__scopeId","data-v-ab5666d5"]]);function Ut(){const a=Je(),v=B(()=>{var S;return((S=a.currentUser)==null?void 0:S.role)==="basic"}),d=S=>{ke("Esta funcionalidad está restringida para usuarios básicos. Por favor, contacta a tu abogado para obtener acceso completo.","warning")};return{isBasicUser:v,showRestrictionNotification:d,handleFeatureAccess:(S,u)=>v.value?(d(),!1):(u&&u(),!0),getRestrictedButtonClasses:S=>S?"opacity-60 cursor-not-allowed":""}}function Zr(a){return!a.variables||a.variables.length===0?!0:a.variables.every(v=>v.name_es&&v.name_es.trim().length>0)}function Mt(a,v){var A;if(!a.requires_signature||a.state!=="PendingSignatures"||!a.signatures||a.signatures.length===0)return!1;const d=(A=v==null?void 0:v.currentUser)==null?void 0:A.email,g=a.signatures.find(S=>S.signer_email===d);return!(!g||g.signed)}const Jr={lawyer:{getMenuOptions:(a,v,d)=>{const g=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Administrar Asociaciones",action:"relationships"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}];return a.state==="Draft"?g.push({label:"Publicar",action:"publish",disabled:!Zr(a)}):a.state==="Published"&&(g.push({label:"Mover a Borrador",action:"draft"}),g.push({label:"Formalizar y Agregar Firmas",action:"formalize"})),(a.state==="Completed"||a.state==="Published")&&g.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),a.requires_signature&&(g.push({label:"Ver Firmas",action:"viewSignatures"}),Mt(a,d)&&g.push({label:"Firmar documento",action:"sign"})),g}},signatures:{getMenuOptions:(a,v,d)=>{const g=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}];return a.requires_signature&&(a.state==="PendingSignatures"||a.state==="FullySigned")&&g.push({label:"Estado de las firmas",action:"viewSignatures"}),Mt(a,d)&&g.push({label:"Firmar documento",action:"sign"}),a.state==="FullySigned"&&g.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),a.state==="PendingSignatures"&&g.push({label:"Descargar PDF",action:"downloadPDF"}),g}},client:{getMenuOptions:(a,v,d)=>{var u,F,_;const g=[],A=((u=d==null?void 0:d.currentUser)==null?void 0:u.role)==="basic",S=((F=d==null?void 0:d.currentUser)==null?void 0:F.role)==="corporate_client"||((_=d==null?void 0:d.currentUser)==null?void 0:_.role)==="client";return a.state==="Completed"?(g.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Editar Formulario",action:"editForm"},{label:"Editar Documento",action:"editDocument"}]}),S&&g.push({label:"Formalizar y Agregar Firmas",action:"formalize"})):g.push({label:"Completar",action:"editForm"}),a.state==="Completed"&&g.push({label:"Previsualizar",action:"preview"}),g.push({label:"Eliminar",action:"delete"}),A?g.push({label:"Gestionar Membrete",action:"letterhead",disabled:!0}):g.push({label:"Gestionar Membrete",action:"letterhead"}),g.push({label:"Administrar Asociaciones",action:"relationships"}),a.requires_signature&&(g.push({label:"Ver Firmas",action:"viewSignatures"}),Mt(a,d)&&g.push({label:"Firmar documento",action:"sign"})),a.state==="Completed"&&g.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar",action:"email"}),g}}};function Kr(a,v,d="list",g=null){const A=Jr[a];return A?A.getMenuOptions(v,d,g):[]}const Yr={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Xr={class:"px-6 py-4 border-b border-gray-200"},ea=e("h2",{class:"text-xl font-semibold text-gray-800"},"Acciones del Documento",-1),ta={class:"text-sm text-gray-500 mt-1"},sa={class:"p-6 overflow-y-auto flex-grow"},oa={class:"space-y-4"},na={key:0,class:"text-sm font-semibold text-gray-700 uppercase tracking-wide px-2"},ra={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},aa=["onClick","disabled"],la={class:"text-sm font-medium"},ia={key:1,class:"border-t border-gray-200 my-4"},da={key:0,class:"text-center py-12"},ca=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay acciones disponibles",-1),ua=e("p",{class:"mt-1 text-sm text-gray-500"}," No hay opciones disponibles para este documento. ",-1),_t={__name:"DocumentActionsModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null},cardType:{type:String,required:!0,validator:a=>["lawyer","client","signatures"].includes(a)},context:{type:String,default:"table"},userStore:{type:Object,default:null}},emits:["close","action"],setup(a,{emit:v}){const d=a,g=v,A=B(()=>d.document?Kr(d.cardType,d.document,d.context,d.userStore):[]),S=B(()=>{const O=A.value;if(!O||O.length===0)return[];const m=[],L={edit:"Edición",view:"Visualización",share:"Compartir",manage:"Gestión",signatures:"Firmas",delete:"Eliminación"},$={edit:[],view:[],share:[],manage:[],signatures:[],delete:[]};return O.forEach(V=>{if(V.children&&Array.isArray(V.children))V.children.forEach(w=>{const D=w.action.toLowerCase();u(w,D,$)});else{const w=V.action.toLowerCase();u(V,w,$)}}),$.edit.length>0&&m.push({title:L.edit,options:$.edit}),$.view.length>0&&m.push({title:L.view,options:$.view}),$.share.length>0&&m.push({title:L.share,options:$.share}),$.signatures.length>0&&m.push({title:L.signatures,options:$.signatures}),$.manage.length>0&&m.push({title:L.manage,options:$.manage}),$.delete.length>0&&m.push({title:L.delete,options:$.delete}),m}),u=(O,m,L)=>{m.includes("edit")||m.includes("editar")||m==="copy"||m==="draft"||m==="publish"||m==="formalize"||m==="completar"?L.edit.push(O):m.includes("view")||m.includes("preview")||m.includes("ver")||m.includes("previsualización")?L.view.push(O):m.includes("download")||m.includes("email")||m.includes("enviar")||m.includes("descargar")?L.share.push(O):m.includes("signature")||m.includes("firma")||m.includes("sign")?L.signatures.push(O):m.includes("permission")||m.includes("relationship")||m.includes("letterhead")||m.includes("permiso")||m.includes("asociación")||m.includes("membrete")?L.manage.push(O):m.includes("delete")||m.includes("eliminar")?L.delete.push(O):L.manage.push(O)},F=O=>{const m=O.toLowerCase();return m==="editform"||m.includes("completar")?Wt:m==="editdocument"||m.includes("editar documento")?qt:m.includes("edit")||m==="editar"?qt:m.includes("delete")||m==="eliminar"?Pt:m.includes("preview")||m.includes("ver")||m.includes("previsualización")?Jt:m==="copy"||m.includes("copia")?gs:m.includes("download")||m.includes("descargar")?tt:m.includes("email")||m.includes("enviar")?is:m.includes("permission")||m.includes("permiso")?vs:m.includes("relationship")||m.includes("asociación")?bs:m.includes("letterhead")||m.includes("membrete")?Kt:m.includes("signature")||m.includes("firma")?Lt:m==="publish"||m.includes("publicar")?ws:m==="draft"||m.includes("borrador")?Qe:m==="formalize"||m.includes("formalizar")?Wt:rt},_=O=>{const m=O.toLowerCase();return m.includes("delete")||m==="eliminar"?"text-red-600":m.includes("download")||m.includes("descargar")?"text-blue-600":m.includes("email")||m.includes("enviar")?"text-green-600":m.includes("signature")||m.includes("firma")?"text-purple-600":"text-gray-600"},P=O=>{const m=O.toLowerCase();return m.includes("delete")||m==="eliminar"?"border-red-200 bg-red-50 text-red-700 hover:bg-red-100 hover:border-red-300":m.includes("download")||m.includes("descargar")?"border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 hover:border-blue-300":m.includes("email")||m.includes("enviar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":m.includes("signature")||m.includes("firma")?"border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-100 hover:border-purple-300":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-300"},{handleFeatureAccess:se}=Ut(),Q=O=>{const m=A.value.find($=>$.action===O?$:$.children?$.children.find(V=>V.action===O):null),L=m!=null&&m.children?m.children.find($=>$.action===O):m;if(L!=null&&L.disabled){se("Esta funcionalidad",null);return}g("action",O,d.document)},K=()=>{g("close")};return(O,m)=>Pe((n(),oe(Xe,null,{default:k(()=>{var L;return[e("div",Yr,[e("div",Xr,[ea,e("p",ta,h(((L=a.document)==null?void 0:L.title)||"Cargando..."),1),e("button",{onClick:K,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500 transition-colors"},[o(t(je),{class:"h-6 w-6"})])]),e("div",sa,[e("div",oa,[(n(!0),l(de,null,me(S.value,($,V)=>(n(),l("div",{key:V,class:"space-y-2"},[$.title?(n(),l("h3",na,h($.title),1)):E("",!0),e("div",ra,[(n(!0),l(de,null,me($.options,w=>(n(),l("button",{key:w.action,onClick:D=>Q(w.action),disabled:w.disabled,class:C(["flex items-center justify-start px-4 py-3 rounded-lg border transition-all duration-200",w.disabled?"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed opacity-60":P(w.action),"hover:shadow-md hover:scale-[1.02]"])},[(n(),oe(ls(F(w.action)),{class:C(["h-5 w-5 mr-3 flex-shrink-0",w.disabled?"text-gray-400":_(w.action)])},null,8,["class"])),e("span",la,h(w.label),1),w.disabled?(n(),oe(t(ms),{key:0,class:"h-4 w-4 ml-auto text-gray-400"})):E("",!0)],10,aa))),128))]),V<S.value.length-1?(n(),l("div",ia)):E("",!0)]))),128)),S.value.length===0?(n(),l("div",da,[o(t(rt),{class:"mx-auto h-12 w-12 text-gray-400"}),ca,ua])):E("",!0)])])])]}),_:1},512)),[[Dt,a.isVisible]])}},ma={class:"document-list-client-table"},ga={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},pa={class:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"},ha={class:"flex flex-col sm:flex-row gap-3 flex-1 w-full lg:w-auto"},fa={class:"relative flex-1 min-w-[200px]"},va={class:"max-w-[120px] truncate"},ba={class:"p-2"},ya={class:"relative mb-2"},xa={class:"max-h-60 overflow-y-auto"},_a=["onClick"],wa={class:"truncate"},$a={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},ka={class:"flex items-center gap-3 w-full lg:w-auto"},Ca={class:"text-sm text-gray-500 whitespace-nowrap"},Da={class:"py-1"},Sa={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Fa={class:"overflow-x-auto"},Ea={class:"min-w-full divide-y divide-gray-200"},Ta=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Firma "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ")])],-1),Aa={class:"bg-white divide-y divide-gray-200"},Ma=["onClick"],Pa={class:"px-6 py-4 whitespace-nowrap"},La={class:"flex items-center"},Ia={class:"flex-shrink-0 h-10 w-10"},ja={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Ba={class:"ml-4"},Ua={class:"text-sm font-medium text-gray-900"},za={class:"px-6 py-4 whitespace-nowrap"},Na={class:"px-6 py-4 whitespace-nowrap"},Oa={class:"px-6 py-4 whitespace-nowrap"},Ra={class:"flex flex-wrap gap-1"},qa={key:0,class:"text-sm text-gray-400"},Va={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Qa={class:"flex flex-1 justify-between sm:hidden"},Wa=["disabled"],Ga=["disabled"],Ha={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Za={class:"text-sm text-gray-700"},Ja={class:"font-medium"},Ka={class:"font-medium"},Ya={class:"font-medium"},Xa={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},el=["disabled"],tl=e("span",{class:"sr-only"},"Anterior",-1),sl=["onClick"],ol={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},nl=["disabled"],rl=e("span",{class:"sr-only"},"Siguiente",-1),al={key:1,class:"text-center py-12"},ll=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos",-1),il=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos asignados por tu abogado aparecerán aquí.",-1),dl={__name:"DocumentListClientTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh","open-letterhead","open-relationships"],setup(a,{emit:v}){const d=Ve(),g=Je(),A=et(),S=v,{handleFeatureAccess:u}=Ut(),{activeModals:F,openModal:_,closeModal:P}=ft(d,g),{handlePreviewDocument:se,deleteDocument:Q,downloadPDFDocument:K,downloadWordDocument:O,formalizeDocument:m,signDocument:L}=vt(d,g,S);ye(F,r=>{},{deep:!0}),Re(()=>{});const $=x(""),V=x(""),w=x(null),D=x("recent");Re(()=>{d.init(),g.init()});const ae=B(()=>g.getCurrentUser),U=B(()=>ae.value?d.progressAndCompletedDocumentsByClient(ae.value.id):[]),p=B(()=>{let r=[...U.value];const s=$.value.toLowerCase();return s&&(r=r.filter(c=>{var J,ge;return((J=c.title)==null?void 0:J.toLowerCase().includes(s))||((ge=c.tags)==null?void 0:ge.some(Ie=>{var $e;return($e=Ie.name)==null?void 0:$e.toLowerCase().includes(s)}))})),w.value&&(r=r.filter(c=>c.tags&&c.tags.some(J=>J.id===w.value))),D.value==="name"?r.sort((c,J)=>{const ge=(c.title||"").toLowerCase(),Ie=(J.title||"").toLowerCase();return ge.localeCompare(Ie)}):D.value==="recent"&&r.sort((c,J)=>J.id-c.id),r}),M=x(1),R=x(10),T=B(()=>{const r=(M.value-1)*R.value,s=r+R.value;return p.value.slice(r,s)}),z=B(()=>Math.ceil(p.value.length/R.value)),ne=B(()=>{const r=(M.value-1)*R.value+1,s=Math.min(M.value*R.value,p.value.length);return{start:r,end:s,total:p.value.length}});ye([$,w,D],()=>{M.value=1});const X=B(()=>{const r=z.value,s=M.value,c=[];if(r<=7)for(let J=1;J<=r;J++)c.push(J);else if(s<=4){for(let J=1;J<=5;J++)c.push(J);c.push("..."),c.push(r)}else if(s>=r-3){c.push(1),c.push("...");for(let J=r-4;J<=r;J++)c.push(J)}else c.push(1),c.push("..."),c.push(s-1),c.push(s),c.push(s+1),c.push("..."),c.push(r);return c}),f=()=>{M.value>1&&M.value--},N=()=>{M.value<z.value&&M.value++},G=r=>{r>=1&&r<=z.value&&(M.value=r)},re=B(()=>{const r=new Map;return U.value.forEach(s=>{s.tags&&s.tags.length>0&&s.tags.forEach(c=>{r.has(c.id)||r.set(c.id,c)})}),Array.from(r.values()).sort((s,c)=>s.name.localeCompare(c.name))}),te=B(()=>{if(!V.value)return re.value;const r=V.value.toLowerCase();return re.value.filter(s=>s.name.toLowerCase().includes(r))}),fe=B(()=>{if(!w.value)return null;const r=re.value.find(s=>s.id===w.value);return r?r.name:null}),ce=B(()=>{switch(D.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),pe=r=>r.state==="Completed"?"Completado":r.state==="Progress"?"En Progreso":r.state||"Sin estado",Ce=r=>r.state==="Completed"?"bg-green-100 text-green-700 border border-green-200":r.state==="Progress"?"bg-blue-100 text-blue-700 border border-blue-200":"bg-gray-100 text-gray-700 border border-gray-200",De=r=>{if(!r.signatures||r.signatures.length===0)return"Sin Firma";if(r.fully_signed)return"Firmado";const s=r.signatures.find(J=>{var ge;return J.user_id===((ge=ae.value)==null?void 0:ge.id)});return s?s.signed?"Firmado":"Pendiente Firmar":r.signatures.some(J=>!J.signed)?"Pendiente Firmar":"Sin Firma"},Ne=r=>{const s=De(r);return s==="Sin Firma"?"bg-yellow-100 text-yellow-700 border border-yellow-200":s==="Firmado"?"bg-green-100 text-green-700 border border-green-200":s==="Pendiente Firmar"?"bg-blue-100 text-blue-700 border border-blue-200":s==="Devuelto Sin Firma"?"bg-red-100 text-red-700 border border-red-200":"bg-gray-100 text-gray-700 border border-gray-200"},Le=r=>{const s=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],c=r.id%s.length;return s[c]},Be=r=>{const s=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],c=r.id%s.length;return s[c]},Ue=()=>{w.value=null},b=x(!1),j=x(null),le=r=>{j.value=r,b.value=!0},he=async(r,s)=>{b.value=!1,await i(r,s)},i=async(r,s)=>{var c;try{switch(r){case"editForm":_("edit",s,{userRole:((c=g.currentUser)==null?void 0:c.role)||"client"});break;case"editDocument":A.push(`/dynamic_document_dashboard/client/editor/edit/${s.id}`);break;case"preview":await se(s);break;case"delete":await Q(s);break;case"letterhead":u("Membrete Individual",()=>{_("letterhead",s)});break;case"relationships":_("relationships",s);break;case"downloadPDF":await K(s);break;case"downloadWord":await O(s);break;case"email":_("email",s);break;case"formalize":await m(s);break;case"viewSignatures":_("signatures",s);break;case"sign":await L(s,_);break;default:console.warn("Unknown action:",r)}}catch(J){console.error(`Error executing action ${r}:`,J)}};return(r,s)=>(n(),l(de,null,[e("div",ma,[e("div",ga,[e("div",pa,[e("div",ha,[e("div",fa,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":s[0]||(s[0]=c=>$.value=c),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent"},null,512),[[qe,$.value]])]),o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:k(()=>[o(t(st),{class:"h-4 w-4"}),e("span",va,h(fe.value||"Etiqueta"),1),o(t(Oe),{class:"h-4 w-4"})]),_:1}),o(t(Te),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",ba,[e("div",ya,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":s[1]||(s[1]=c=>V.value=c),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:s[2]||(s[2]=ve(()=>{},["stop"]))},null,512),[[qe,V.value]])]),e("div",xa,[o(t(ue),null,{default:k(({active:c})=>[e("a",{onClick:s[3]||(s[3]=J=>w.value=null),class:C([c?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(n(!0),l(de,null,me(te.value,c=>(n(),oe(t(ue),{key:c.id},{default:k(({active:J})=>[e("a",{onClick:ge=>w.value=c.id,class:C([J?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:C(["w-3 h-3 rounded-full flex-shrink-0",Be(c)])},null,2),e("span",wa,h(c.name),1)],10,_a)]),_:2},1024))),128)),te.value.length===0?(n(),l("div",$a," No se encontraron etiquetas ")):E("",!0)])])]),_:1})]),_:1}),w.value?(n(),l("button",{key:0,onClick:Ue,class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(je),{class:"h-4 w-4"}),Y(" Limpiar ")])):E("",!0)]),e("div",ka,[e("span",Ca,h(p.value.length)+" "+h(p.value.length===1?"resultado":"resultados"),1),o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:k(()=>[Y(" Ordenar: "+h(ce.value)+" ",1),o(t(Oe),{class:"h-4 w-4"})]),_:1}),o(t(Te),{class:"absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",Da,[o(t(ue),null,{default:k(({active:c})=>[e("a",{onClick:s[4]||(s[4]=J=>D.value="recent"),class:C([c?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:k(({active:c})=>[e("a",{onClick:s[5]||(s[5]=J=>D.value="name"),class:C([c?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Sa,[e("div",Fa,[e("table",Ea,[Ta,e("tbody",Aa,[(n(!0),l(de,null,me(T.value,(c,J)=>(n(),l("tr",{key:c.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:ge=>le(c)},[e("td",Pa,[e("div",La,[e("div",Ia,[e("div",ja,[o(t(Qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",Ba,[e("div",Ua,h(c.title),1)])])]),e("td",za,[e("span",{class:C(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",Ce(c)])},h(pe(c)),3)]),e("td",Na,[e("span",{class:C(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",Ne(c)])},h(De(c)),3)]),e("td",Oa,[e("div",Ra,[(n(!0),l(de,null,me(c.tags,ge=>(n(),l("span",{key:ge.id,class:C(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",Le(ge)])},h(ge.name),3))),128)),!c.tags||c.tags.length===0?(n(),l("span",qa,"-")):E("",!0)])])],8,Ma))),128))])])]),z.value>1?(n(),l("div",Va,[e("div",Qa,[e("button",{onClick:f,disabled:M.value===1,class:C(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",M.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,Wa),e("button",{onClick:N,disabled:M.value===z.value,class:C(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",M.value===z.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Ga)]),e("div",Ha,[e("div",null,[e("p",Za,[Y(" Mostrando "),e("span",Ja,h(ne.value.start),1),Y(" a "),e("span",Ka,h(ne.value.end),1),Y(" de "),e("span",Ya,h(ne.value.total),1),Y(" resultados ")])]),e("div",null,[e("nav",Xa,[e("button",{onClick:f,disabled:M.value===1,class:C(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",M.value===1?"opacity-50 cursor-not-allowed":""])},[tl,o(t(pt),{class:"h-5 w-5","aria-hidden":"true"})],10,el),(n(!0),l(de,null,me(X.value,c=>(n(),l(de,{key:c},[c!=="..."?(n(),l("button",{key:0,onClick:J=>G(c),class:C(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",M.value===c?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},h(c),11,sl)):(n(),l("span",ol," ... "))],64))),128)),e("button",{onClick:N,disabled:M.value===z.value,class:C(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",M.value===z.value?"opacity-50 cursor-not-allowed":""])},[rl,o(t(at),{class:"h-5 w-5","aria-hidden":"true"})],10,nl)])])])])):E("",!0),p.value.length===0?(n(),l("div",al,[o(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),ll,il])):E("",!0)])]),(n(),oe(ht,{to:"body"},[t(F).edit.isOpen?(n(),oe(St,{key:0,document:t(F).edit.document,"user-role":t(F).edit.userRole,onClose:s[6]||(s[6]=c=>t(P)("edit")),onRefresh:s[7]||(s[7]=c=>S("refresh"))},null,8,["document","user-role"])):E("",!0),t(F).email.isOpen?(n(),oe(Ft,{key:1,document:t(F).email.document,onClose:s[8]||(s[8]=c=>t(P)("email"))},null,8,["document"])):E("",!0),t(F).letterhead.isOpen?(n(),oe(bt,{key:2,"is-visible":!0,document:t(F).letterhead.document,onClose:s[9]||(s[9]=c=>t(P)("letterhead")),onRefresh:s[10]||(s[10]=c=>S("refresh"))},null,8,["document"])):E("",!0),t(F).relationships.isOpen?(n(),oe(Et,{key:3,"is-open":!0,document:t(F).relationships.document,onClose:s[11]||(s[11]=c=>t(P)("relationships")),onRefresh:s[12]||(s[12]=c=>S("refresh"))},null,8,["document"])):E("",!0),b.value?(n(),oe(_t,{key:4,"is-visible":b.value,document:j.value,"card-type":"client",context:"table","user-store":t(g),onClose:s[13]||(s[13]=c=>b.value=!1),onAction:he},null,8,["is-visible","document","user-store"])):E("",!0)]))],64))}},cl={class:"mb-4"},ul={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},ml={class:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"},gl={class:"flex flex-col sm:flex-row gap-3 flex-1 w-full lg:w-auto"},pl={class:"relative flex-1 min-w-[200px]"},hl={class:"max-w-[120px] truncate"},fl={class:"p-2"},vl={class:"relative mb-2"},bl={class:"max-h-60 overflow-y-auto"},yl=["onClick"],xl={class:"truncate"},_l={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},wl={class:"flex items-center gap-3 w-full lg:w-auto"},$l={class:"text-sm text-gray-500 whitespace-nowrap"},kl={class:"py-1"},Cl={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},Dl={class:"min-w-full divide-y divide-gray-200"},Sl=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plantilla "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),Fl={class:"bg-white divide-y divide-gray-200"},El=["onClick"],Tl={class:"px-6 py-4 whitespace-nowrap"},Al={class:"flex items-center"},Ml={class:"flex-shrink-0 h-10 w-10"},Pl={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},Ll={class:"ml-4"},Il={class:"text-sm font-medium text-gray-900"},jl=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-700 border border-purple-200"}," Disponible ")],-1),Bl={class:"px-6 py-4 whitespace-nowrap"},Ul={class:"flex flex-wrap gap-1"},zl={key:0,class:"text-sm text-gray-400"},Nl={class:"py-1"},Ol=["onClick"],Rl={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},ql=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay plantillas disponibles",-1),Vl={class:"mt-1 text-sm text-gray-500"},Ql=e("div",{class:"mt-4"},[e("div",{class:"text-xs text-gray-400 bg-gray-100 px-3 py-2 rounded-lg inline-block"},[Y(" 💡 "),e("strong",null,"Tip:"),Y(" Las plantillas son creadas por los abogados ")])],-1),Wl={__name:"UseDocumentTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["go-back"],setup(a,{emit:v}){const d=Ve();Je();const g=et(),A=v,S=x(""),u=x(""),F=x(null),_=x("recent"),P=x({}),se=x({}),Q=x(!1),K=x(-1),O=B(()=>d.publishedDocumentsUnassigned||[]),m=B(()=>{let f=[...O.value];const N=S.value.toLowerCase();return N&&(f=f.filter(G=>{var re,te;return((re=G.title)==null?void 0:re.toLowerCase().includes(N))||((te=G.tags)==null?void 0:te.some(fe=>{var ce;return(ce=fe.name)==null?void 0:ce.toLowerCase().includes(N)}))})),F.value&&(f=f.filter(G=>G.tags&&G.tags.some(re=>re.id===F.value))),_.value==="name"?f.sort((G,re)=>{const te=(G.title||"").toLowerCase(),fe=(re.title||"").toLowerCase();return te.localeCompare(fe)}):_.value==="recent"&&f.sort((G,re)=>re.id-G.id),f}),L=B(()=>{const f=new Map;return O.value.forEach(N=>{N.tags&&N.tags.length>0&&N.tags.forEach(G=>{f.has(G.id)||f.set(G.id,G)})}),Array.from(f.values()).sort((N,G)=>N.name.localeCompare(G.name))}),$=B(()=>{if(!u.value)return L.value;const f=u.value.toLowerCase();return L.value.filter(N=>N.name.toLowerCase().includes(f))}),V=B(()=>{if(!F.value)return null;const f=L.value.find(N=>N.id===F.value);return f?f.name:null}),w=B(()=>{switch(_.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),D=B(()=>{const f=S.value&&S.value.trim().length>0,N=F.value!==null;return f&&N?"No se encontraron plantillas que coincidan con tu búsqueda y filtros":f?"No se encontraron plantillas que coincidan con tu búsqueda":N?"No se encontraron plantillas con la etiqueta seleccionada":"Aún no hay plantillas disponibles para usar"}),ae=f=>{const N=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],G=f.id%N.length;return N[G]},U=f=>{const N=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],G=f.id%N.length;return N[G]},p=()=>{F.value=null},M=f=>{const re=`/dynamic_document_dashboard/document/use/${f.state==="Published"&&!f.assigned_to?"creator":"editor"}/${f.id}/${encodeURIComponent(f.title.trim())}`;g.push(re)},R=()=>{A("go-back")};Re(async()=>{(!d.documents||d.documents.length===0)&&await d.init(!0)});const T=()=>Q.value?m.value.length===1?"280px":m.value.length===2&&K.value===1?"340px":"280px":"auto",z=(f,N)=>{f&&(P.value[N]=f)},ne=(f,N)=>{f&&(se.value[N]=f)},X=(f,N)=>{Q.value=!N,K.value=N?-1:f,N||setTimeout(()=>{const G=se.value[f];if(G){const re=G.$el||G;if(re&&re.getBoundingClientRect){const te=re.getBoundingClientRect(),fe=window.innerHeight;if(f===0){if(te.bottom>fe-20){const ce=te.bottom-fe+40;window.scrollBy({top:ce,behavior:"smooth"})}}else if(te.bottom>fe-10){const ce=te.bottom-fe+30;window.scrollBy({top:ce,behavior:"smooth"})}else if(te.top<80){const ce=te.top-100;window.scrollBy({top:ce,behavior:"smooth"})}}}},100)};return(f,N)=>(n(),l("div",null,[e("div",cl,[e("button",{onClick:R,class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors border border-gray-300"},[o(t(ys),{class:"h-4 w-4"}),Y(" Volver a Mis Documentos ")])]),e("div",ul,[e("div",ml,[e("div",gl,[e("div",pl,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":N[0]||(N[0]=G=>S.value=G),type:"text",placeholder:"Buscar plantillas...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent"},null,512),[[qe,S.value]])]),o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:k(()=>[o(t(st),{class:"h-4 w-4"}),e("span",hl,h(V.value||"Etiqueta"),1),o(t(Oe),{class:"h-4 w-4"})]),_:1}),o(t(Te),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",fl,[e("div",vl,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":N[1]||(N[1]=G=>u.value=G),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:N[2]||(N[2]=ve(()=>{},["stop"]))},null,512),[[qe,u.value]])]),e("div",bl,[o(t(ue),null,{default:k(({active:G})=>[e("a",{onClick:N[3]||(N[3]=re=>F.value=null),class:C([G?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(n(!0),l(de,null,me($.value,G=>(n(),oe(t(ue),{key:G.id},{default:k(({active:re})=>[e("a",{onClick:te=>F.value=G.id,class:C([re?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:C(["w-3 h-3 rounded-full flex-shrink-0",U(G)])},null,2),e("span",xl,h(G.name),1)],10,yl)]),_:2},1024))),128)),$.value.length===0?(n(),l("div",_l," No se encontraron etiquetas ")):E("",!0)])])]),_:1})]),_:1}),F.value?(n(),l("button",{key:0,onClick:p,class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(je),{class:"h-4 w-4"}),Y(" Limpiar ")])):E("",!0)]),e("div",wl,[e("span",$l," Mostrando "+h(m.value.length)+" plantillas ",1),o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:k(()=>[Y(" Ordenar: "+h(w.value)+" ",1),o(t(Oe),{class:"h-4 w-4"})]),_:1}),o(t(Te),{class:"absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",kl,[o(t(ue),null,{default:k(({active:G})=>[e("a",{onClick:N[4]||(N[4]=re=>_.value="recent"),class:C([G?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:k(({active:G})=>[e("a",{onClick:N[5]||(N[5]=re=>_.value="name"),class:C([G?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),m.value.length>0?(n(),l("div",Cl,[e("div",{class:"overflow-x-auto",style:Ge({minHeight:T()})},[e("table",Dl,[Sl,e("tbody",Fl,[(n(!0),l(de,null,me(m.value,G=>(n(),l("tr",{key:G.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:re=>M(G)},[e("td",Tl,[e("div",Al,[e("div",Ml,[e("div",Pl,[o(t(Qe),{class:"h-5 w-5 text-purple-600"})])]),e("div",Ll,[e("div",Il,h(G.title),1)])])]),jl,e("td",Bl,[e("div",Ul,[(n(!0),l(de,null,me(G.tags,re=>(n(),l("span",{key:re.id,class:C(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ae(re)])},h(re.name),3))),128)),!G.tags||G.tags.length===0?(n(),l("span",zl,"-")):E("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:N[6]||(N[6]=ve(()=>{},["stop"]))},[o(t(Fe),{as:"div",class:"relative inline-block text-left"},{default:k(({open:re})=>[o(t(Ee),{ref_for:!0,ref:te=>z(te,f.index),onClick:te=>X(f.index,re),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:k(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),o(t(Te),{ref_for:!0,ref:te=>ne(te,f.index),class:C([m.value.length>2&&f.index>0&&f.index>=m.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:k(()=>[e("div",Nl,[o(t(ue),null,{default:k(({active:te})=>[e("a",{onClick:fe=>M(G),class:C([te?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Usar plantilla ",10,Ol)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,El))),128))])])],4)])):(n(),l("div",Rl,[o(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),ql,e("p",Vl,h(D.value),1),Ql]))]))}},Ke=a=>(mt("data-v-f7aff6da"),a=a(),gt(),a),Gl={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},Hl={class:"mb-4"},Zl={class:"relative w-full"},Jl={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},Kl={class:"flex items-center gap-2 min-w-0"},Yl={class:"truncate"},Xl={class:"py-1"},ei=["onClick"],ti={class:"flex items-center gap-2 min-w-0"},si={class:"truncate"},oi={class:"p-2"},ni={class:"relative mb-2"},ri={class:"max-h-60 overflow-y-auto"},ai=["onClick"],li={class:"truncate"},ii={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},di={class:"flex items-center justify-stretch"},ci=Ke(()=>e("span",null,"Limpiar",-1)),ui={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},mi={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},gi={class:"text-sm text-gray-500"},pi={class:"font-medium"},hi=Ke(()=>e("span",{class:"hidden sm:inline"},"Ordenar:",-1)),fi={class:"py-1"},vi={class:"flex items-center gap-2"},bi=Ke(()=>e("span",{class:"hidden sm:inline"},"Exportar",-1)),yi={class:"py-1"},xi={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},_i={class:"overflow-x-auto",style:{"overflow-y":"visible"}},wi={class:"min-w-full divide-y divide-gray-200"},$i={class:"bg-gray-50"},ki={scope:"col",class:"w-12 px-6 py-3"},Ci=["checked"],Di=Ke(()=>e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Minuta ",-1)),Si=Ke(()=>e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1)),Fi=Ke(()=>e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1)),Ei={class:"bg-white divide-y divide-gray-200"},Ti=["onClick"],Ai=["checked","onChange"],Mi={class:"px-6 py-4 whitespace-nowrap"},Pi={class:"flex items-center"},Li={class:"flex-shrink-0 h-10 w-10"},Ii={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},ji={class:"ml-4"},Bi={class:"text-sm font-medium text-gray-900"},Ui={class:"px-6 py-4 whitespace-nowrap"},zi={class:"px-6 py-4 whitespace-nowrap"},Ni={class:"flex flex-wrap gap-1"},Oi={key:0,class:"text-sm text-gray-400"},Ri={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},qi={class:"flex flex-1 justify-between sm:hidden"},Vi=["disabled"],Qi=["disabled"],Wi={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Gi={class:"text-sm text-gray-700"},Hi={class:"font-medium"},Zi={class:"font-medium"},Ji={class:"font-medium"},Ki={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Yi=["disabled"],Xi=Ke(()=>e("span",{class:"sr-only"},"Anterior",-1)),ed=["onClick"],td={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},sd=["disabled"],od=Ke(()=>e("span",{class:"sr-only"},"Siguiente",-1)),nd={key:0,class:"text-center py-12"},rd=Ke(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos",-1)),ad=Ke(()=>e("p",{class:"mt-1 text-sm text-gray-500"},"No se encontraron documentos con los filtros seleccionados.",-1)),ld={__name:"DocumentListLawyer",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null}},emits:["refresh"],setup(a,{emit:v}){const d=Ve(),g=Je(),A=et(),S=v,{activeModals:u,openModal:F,closeModal:_,getUserRole:P}=ft(d,g),{handlePreviewDocument:se,deleteDocument:Q,downloadPDFDocument:K,downloadWordDocument:O,copyDocument:m,publishDocument:L,moveToDraft:$,formalizeDocument:V,signDocument:w,downloadSignedDocument:D}=vt(d,g,S),ae=x([]),U=x([]),p=a,M=x(""),R=x(""),T=x(null),z=x(null),ne=x("recent"),X=x([]),f=x(1),N=x(10),G=I=>{switch(I.state){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return"Desconocido"}},re=I=>{switch(I.state){case"Published":case"FullySigned":return"bg-green-100 text-green-700 border border-green-200";case"Draft":case"Progress":return"bg-blue-100 text-blue-700 border border-blue-200";case"PendingSignatures":return"bg-yellow-100 text-yellow-700 border border-yellow-200";case"Completed":return"bg-purple-100 text-purple-700 border border-purple-200";default:return"bg-gray-100 text-gray-700 border border-gray-200"}},te=I=>{const y=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],H=I.id%y.length;return y[H]},fe=I=>{switch(I){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return I}},ce=B(()=>{const I=new Set;return Le.value.forEach(y=>{y.state&&I.add(y.state)}),Array.from(I).sort()}),pe=B(()=>{const I=new Map;return Le.value.forEach(y=>{y.tags&&y.tags.length>0&&y.tags.forEach(H=>{I.has(H.id)||I.set(H.id,H)})}),Array.from(I.values()).sort((y,H)=>y.name.localeCompare(H.name))}),Ce=B(()=>{if(!R.value)return pe.value;const I=R.value.toLowerCase();return pe.value.filter(y=>y.name.toLowerCase().includes(I))}),De=B(()=>{if(!z.value)return null;const I=pe.value.find(y=>y.id===z.value);return I?I.name:null}),Ne=I=>{const y=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],H=I.id%y.length;return y[H]},Le=B(()=>{if(p.promptDocuments)return[];const y=(d.getDocumentsByLawyerId(g.currentUser.id)||[]).filter(we=>we.state!=="FullySigned"),H=p.selectedTags?p.selectedTags.map(we=>we.id):[];return d.filteredDocumentsBySearchAndTags(p.searchQuery,g,H).filter(we=>y.some(_e=>_e.id===we.id))}),Be=B(()=>{if(p.promptDocuments&&p.promptDocuments.length>0){let I=p.promptDocuments.filter(y=>y.title&&y.title.toLowerCase().includes((p.searchQuery||"").toLowerCase()));if(p.selectedTags&&p.selectedTags.length>0){const y=p.selectedTags.map(H=>H.id);I=I.filter(H=>!H.tags||H.tags.length===0?!1:H.tags.some(q=>y.includes(q.id)))}return I}return[]}),Ue=B(()=>p.promptDocuments?Be.value:Le.value),b=B(()=>{let I=[...Ue.value];const y=M.value.toLowerCase();return y&&(I=I.filter(H=>{var q,we,_e;return((q=H.title)==null?void 0:q.toLowerCase().includes(y))||((we=H.state)==null?void 0:we.toLowerCase().includes(y))||((_e=H.tags)==null?void 0:_e.some(Tt=>{var Ze;return(Ze=Tt.name)==null?void 0:Ze.toLowerCase().includes(y)}))})),T.value&&(I=I.filter(H=>H.state===T.value)),z.value&&(I=I.filter(H=>H.tags&&H.tags.some(q=>q.id===z.value))),ne.value==="name"?I.sort((H,q)=>{const we=(H.title||"").toLowerCase(),_e=(q.title||"").toLowerCase();return we.localeCompare(_e)}):ne.value==="recent"&&I.sort((H,q)=>q.id-H.id),I}),j=B(()=>{const I=(f.value-1)*N.value,y=I+N.value;return b.value.slice(I,y)}),le=B(()=>Math.ceil(b.value.length/N.value)),he=B(()=>{const I=(f.value-1)*N.value+1,y=Math.min(f.value*N.value,b.value.length);return{start:I,end:y,total:b.value.length}});ye([M,T,z],()=>{f.value=1});const i=B(()=>{switch(ne.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}});B(()=>{if(p.promptDocuments)return null;const I=d.lastUpdatedDocumentId,y=localStorage.getItem("lastUpdatedDocumentId"),H=[...Le.value];return I&&H.some(_e=>String(_e.id)===String(I))?I:y&&H.some(_e=>String(_e.id)===String(y))?y:null});const r=async()=>{try{const I=g.currentUser.id,y=await Ct(`dynamic-documents/user/${I}/pending-documents-full/`),H=await Ct(`dynamic-documents/user/${I}/signed-documents/`);y.status===200&&(ae.value=y.data),H.status===200&&(U.value=H.data)}catch(I){console.error("Error fetching lawyer documents:",I),I.response&&(console.error("Error response data:",I.response.data),console.error("Error status:",I.response.status))}};ye(Ue,I=>{if(!p.promptDocuments&&d.lastUpdatedDocumentId&&!I.some(H=>String(H.id)===String(d.lastUpdatedDocumentId))&&I.length>0){const q=[...I].sort((we,_e)=>_e.id-we.id)[0].id;d.lastUpdatedDocumentId=q,localStorage.setItem("lastUpdatedDocumentId",q)}});const s=I=>{I&&setTimeout(()=>{try{const y=document.querySelectorAll(`[data-document-id="${I}"]`);if(y.length>0){const H=y[0];H.classList.remove("animate-pulse-highlight-green","animate-pulse-highlight-blue"),H.offsetWidth,(H.querySelector("[data-document-id]")||H).classList.contains("border-green-400")?H.classList.add("animate-pulse-highlight-green"):H.classList.add("animate-pulse-highlight-blue"),H.scrollIntoView({behavior:"smooth",block:"center"})}}catch(y){console.error("Error forcing highlight:",y)}},100)};window.forceDocumentHighlight=s,Re(async()=>{if(p.promptDocuments)return;await d.init();const I=localStorage.getItem("lastUpdatedDocumentId");I&&(d.lastUpdatedDocumentId=I,setTimeout(()=>{Ue.value.some(H=>String(H.id)===String(I))&&s(I)},500)),r()});const c=B(()=>b.value.length>0&&X.value.length===b.value.length),J=()=>{c.value?X.value=[]:X.value=b.value.map(I=>I.id)},ge=I=>{const y=X.value.indexOf(I);y>-1?X.value.splice(y,1):X.value.push(I)},Ie=()=>{X.value=b.value.map(I=>I.id)},$e=()=>{X.value=[]},We=()=>{T.value=null,z.value=null},ee=()=>{f.value>1&&f.value--},W=()=>{f.value<le.value&&f.value++},ie=I=>{I>=1&&I<=le.value&&(f.value=I)},Z=B(()=>{const I=le.value,y=f.value,H=[];if(I<=7)for(let q=1;q<=I;q++)H.push(q);else if(y<=4){for(let q=1;q<=5;q++)H.push(q);H.push("..."),H.push(I)}else if(y>=I-3){H.push(1),H.push("...");for(let q=I-4;q<=I;q++)H.push(q)}else H.push(1),H.push("..."),H.push(y-1),H.push(y),H.push(y+1),H.push("..."),H.push(I);return H}),be=()=>{const I=X.value.length>0?b.value.filter(Ze=>X.value.includes(Ze.id)):b.value,y=["Nombre Minuta","Estado","Etiquetas"],H=I.map(Ze=>[Ze.title||"",G(Ze),Ze.tags?Ze.tags.map(At=>At.name).join(", "):""]),q=[y.join(","),...H.map(Ze=>Ze.map(At=>`"${At}"`).join(","))].join(`
`),we=new Blob([q],{type:"text/csv;charset=utf-8;"}),_e=document.createElement("a"),Tt=URL.createObjectURL(we);_e.setAttribute("href",Tt),_e.setAttribute("download",`documentos_${new Date().toISOString().split("T")[0]}.csv`),_e.style.visibility="hidden",document.body.appendChild(_e),_e.click(),document.body.removeChild(_e)},xe=async(I,y)=>{try{switch(I){case"edit":A.push(`/dynamic_document_dashboard/lawyer/editor/edit/${y.id}`);break;case"permissions":F("permissions",y);break;case"relationships":F("relationships",y);break;case"preview":await se(y);break;case"delete":await Q(y);break;case"downloadPDF":await K(y);break;case"downloadWord":await O(y);break;case"email":F("email",y);break;case"copy":await m(y);break;case"publish":await L(y);break;case"draft":await $(y);break;case"formalize":await V(y);break;case"viewSignatures":F("signatures",y);break;case"sign":await w(y,F);break;case"letterhead":F("letterhead",y);break;default:console.warn("Unknown action:",I)}}catch(H){console.error(`Error executing action ${I}:`,H)}},Me=x(!1),Se=x(null),ze=I=>{Se.value=I,Me.value=!0},Xt=async(I,y)=>{Me.value=!1,await xe(I,y)};return(I,y)=>{var H;return n(),l("div",null,[e("div",Gl,[e("div",Hl,[e("div",Zl,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":y[0]||(y[0]=q=>M.value=q),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[qe,M.value]])])]),e("div",Jl,[o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:k(()=>[e("div",Kl,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",Yl,h(T.value||"Estado"),1)]),o(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Te),{class:"absolute left-0 z-10 mt-2 w-full min-w-[14rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",Xl,[o(t(ue),null,{default:k(({active:q})=>[e("a",{onClick:y[1]||(y[1]=we=>T.value=null),class:C([q?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(n(!0),l(de,null,me(ce.value,q=>(n(),oe(t(ue),{key:q},{default:k(({active:we})=>[e("a",{onClick:_e=>T.value=q,class:C([we?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},h(fe(q)),11,ei)]),_:2},1024))),128))])]),_:1})]),_:1}),o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:k(()=>[e("div",ti,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",si,h(De.value||"Etiqueta"),1)]),o(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Te),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",oi,[e("div",ni,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":y[2]||(y[2]=q=>R.value=q),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:y[3]||(y[3]=ve(()=>{},["stop"]))},null,512),[[qe,R.value]])]),e("div",ri,[o(t(ue),null,{default:k(({active:q})=>[e("a",{onClick:y[4]||(y[4]=we=>z.value=null),class:C([q?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(n(!0),l(de,null,me(Ce.value,q=>(n(),oe(t(ue),{key:q.id},{default:k(({active:we})=>[e("a",{onClick:_e=>z.value=q.id,class:C([we?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:C(["w-3 h-3 rounded-full flex-shrink-0",Ne(q)])},null,2),e("span",li,h(q.name),1)],10,ai)]),_:2},1024))),128)),Ce.value.length===0?(n(),l("div",ii," No se encontraron etiquetas ")):E("",!0)])])]),_:1})]),_:1}),e("div",di,[T.value||z.value?(n(),l("button",{key:0,onClick:We,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(je),{class:"h-4 w-4 flex-shrink-0"}),ci])):E("",!0)])]),e("div",ui,[e("div",mi,[e("div",gi,[e("span",pi,h(b.value.length),1),Y(" resultados ")]),o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:k(()=>[hi,Y(" "+h(i.value)+" ",1),o(t(Oe),{class:"h-4 w-4"})]),_:1}),o(t(Te),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",fi,[o(t(ue),null,{default:k(({active:q})=>[e("a",{onClick:y[5]||(y[5]=we=>ne.value="recent"),class:C([q?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:k(({active:q})=>[e("a",{onClick:y[6]||(y[6]=we=>ne.value="name"),class:C([q?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})]),e("div",vi,[e("button",{onClick:be,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[o(t(tt),{class:"h-4 w-4"}),bi]),o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:k(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:1}),o(t(Te),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",yi,[o(t(ue),null,{default:k(({active:q})=>[e("a",{onClick:Ie,class:C([q?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),o(t(ue),null,{default:k(({active:q})=>[e("a",{onClick:$e,class:C([q?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",xi,[e("div",_i,[e("table",wi,[e("thead",$i,[e("tr",null,[e("th",ki,[e("input",{type:"checkbox",checked:c.value,onChange:J,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Ci)]),Di,Si,Fi])]),e("tbody",Ei,[(n(!0),l(de,null,me(j.value,(q,we)=>(n(),l("tr",{key:q.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:_e=>ze(q)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:y[7]||(y[7]=ve(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:X.value.includes(q.id),onChange:_e=>ge(q.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Ai)]),e("td",Mi,[e("div",Pi,[e("div",Li,[e("div",Ii,[o(t(Qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",ji,[e("div",Bi,h(q.title),1)])])]),e("td",Ui,[e("span",{class:C(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",re(q)])},h(G(q)),3)]),e("td",zi,[e("div",Ni,[(n(!0),l(de,null,me(q.tags,_e=>(n(),l("span",{key:_e.id,class:C(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",te(_e)])},h(_e.name),3))),128)),!q.tags||q.tags.length===0?(n(),l("span",Oi,"-")):E("",!0)])])],8,Ti))),128))])])]),le.value>1?(n(),l("div",Ri,[e("div",qi,[e("button",{onClick:ee,disabled:f.value===1,class:C(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",f.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,Vi),e("button",{onClick:W,disabled:f.value===le.value,class:C(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",f.value===le.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Qi)]),e("div",Wi,[e("div",null,[e("p",Gi,[Y(" Mostrando "),e("span",Hi,h(he.value.start),1),Y(" a "),e("span",Zi,h(he.value.end),1),Y(" de "),e("span",Ji,h(he.value.total),1),Y(" resultados ")])]),e("div",null,[e("nav",Ki,[e("button",{onClick:ee,disabled:f.value===1,class:C(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",f.value===1?"opacity-50 cursor-not-allowed":""])},[Xi,o(t(pt),{class:"h-5 w-5","aria-hidden":"true"})],10,Yi),(n(!0),l(de,null,me(Z.value,q=>(n(),l(de,{key:q},[q!=="..."?(n(),l("button",{key:0,onClick:we=>ie(q),class:C(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",f.value===q?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},h(q),11,ed)):(n(),l("span",td," ... "))],64))),128)),e("button",{onClick:W,disabled:f.value===le.value,class:C(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",f.value===le.value?"opacity-50 cursor-not-allowed":""])},[od,o(t(at),{class:"h-5 w-5","aria-hidden":"true"})],10,sd)])])])])):E("",!0)]),b.value.length===0?(n(),l("div",nd,[o(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),rd,ad])):E("",!0),o(jt,{isVisible:t(nt),documentData:t(It),onClose:y[8]||(y[8]=q=>nt.value=!1)},null,8,["isVisible","documentData"]),(n(),oe(ht,{to:"body"},[t(u).edit.isOpen?(n(),oe(t(St),{key:0,document:t(u).edit.document,"user-role":t(P)(),onClose:y[9]||(y[9]=q=>t(_)("edit")),onRefresh:y[10]||(y[10]=q=>S("refresh"))},null,8,["document","user-role"])):E("",!0),t(u).email.isOpen?(n(),oe(t(Ft),{key:1,document:t(u).email.document,onClose:y[11]||(y[11]=q=>t(_)("email"))},null,8,["document"])):E("",!0),t(u).signatures.isOpen?(n(),oe(t(Zt),{key:2,"document-id":(H=t(u).signatures.document)==null?void 0:H.id,onClose:y[12]||(y[12]=q=>t(_)("signatures")),onRefresh:y[13]||(y[13]=q=>S("refresh"))},null,8,["document-id"])):E("",!0),t(u).permissions.isOpen?(n(),oe(t(ps),{key:3,"is-open":t(u).permissions.isOpen,document:t(u).permissions.document,onClose:y[14]||(y[14]=q=>t(_)("permissions")),onSaved:y[15]||(y[15]=q=>S("refresh"))},null,8,["is-open","document"])):E("",!0),t(u).letterhead.isOpen?(n(),oe(bt,{key:4,"is-visible":t(u).letterhead.isOpen,document:t(u).letterhead.document,onClose:y[16]||(y[16]=q=>t(_)("letterhead")),onUploaded:y[17]||(y[17]=q=>S("refresh")),onDeleted:y[18]||(y[18]=q=>S("refresh"))},null,8,["is-visible","document"])):E("",!0),t(u).relationships.isOpen?(n(),oe(Et,{key:5,"is-open":t(u).relationships.isOpen,document:t(u).relationships.document,onClose:y[19]||(y[19]=q=>t(_)("relationships")),onRefresh:y[20]||(y[20]=q=>S("refresh"))},null,8,["is-open","document"])):E("",!0),Me.value?(n(),oe(_t,{key:6,"is-visible":Me.value,document:Se.value,"card-type":"lawyer",context:"table","user-store":t(g),onClose:y[21]||(y[21]=q=>Me.value=!1),onAction:Xt},null,8,["is-visible","document","user-store"])):E("",!0)]))])}}},id=yt(ld,[["__scopeId","data-v-f7aff6da"]]),dd={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},cd={class:"mb-4"},ud={class:"relative w-full"},md={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},gd={class:"flex items-center gap-2 min-w-0"},pd={class:"truncate"},hd={class:"py-1"},fd=["onClick"],vd={class:"flex items-center justify-stretch"},bd=e("span",null,"Limpiar",-1),yd={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},xd={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},_d={class:"text-sm text-gray-500"},wd={class:"font-medium"},$d=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),kd={class:"py-1"},Cd={class:"flex items-center gap-2"},Dd=e("span",{class:"hidden sm:inline"},"Exportar",-1),Sd={class:"py-1"},Fd={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Ed={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Td={class:"min-w-full divide-y divide-gray-200"},Ad={class:"bg-gray-50"},Md={scope:"col",class:"w-12 px-6 py-3"},Pd=["checked"],Ld=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Id=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),jd=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),Bd=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),Ud={class:"bg-white divide-y divide-gray-200"},zd=["onClick"],Nd=["checked","onChange"],Od={class:"px-6 py-4 whitespace-nowrap"},Rd={class:"flex items-center"},qd={class:"flex-shrink-0 h-10 w-10"},Vd={class:"h-10 w-10 rounded-lg bg-green-100 flex items-center justify-center"},Qd={class:"ml-4"},Wd={class:"text-sm font-medium text-gray-900"},Gd={class:"px-6 py-4 whitespace-nowrap"},Hd={class:"text-sm text-gray-900"},Zd=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-700 border border-green-200"}," Completado ")],-1),Jd={class:"px-6 py-4 whitespace-nowrap"},Kd={class:"flex flex-wrap gap-1"},Yd={key:0,class:"text-sm text-gray-400"},Xd={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},ec={class:"flex flex-1 justify-between sm:hidden"},tc=["disabled"],sc=["disabled"],oc={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},nc={class:"text-sm text-gray-700"},rc={class:"font-medium"},ac={class:"font-medium"},lc={class:"font-medium"},ic={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},dc=["disabled"],cc=e("span",{class:"sr-only"},"Anterior",-1),uc=["onClick"],mc={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},gc=["disabled"],pc=e("span",{class:"sr-only"},"Siguiente",-1),hc={key:0,class:"text-center py-12"},fc=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos completados",-1),vc=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos completados por clientes aparecerán aquí.",-1),bc={__name:"DocumentFinishedByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(a,{emit:v}){const d=Ve(),g=Je(),A=et(),S=a,u=v,{activeModals:F,openModal:_,closeModal:P,getUserRole:se}=ft(d,g),{handlePreviewDocument:Q,deleteDocument:K,downloadPDFDocument:O,downloadWordDocument:m}=vt(d,g,u),L=x(""),$=x(null),V=x("recent"),w=x([]),D=x(1),ae=x(10);Re(()=>{d.init(),g.init()});const U=B(()=>{const i=d.completedDocumentsByClient,r=S.selectedTags?S.selectedTags.map(c=>c.id):[];return d.filteredDocumentsBySearchAndTags(S.searchQuery,g,r).filter(c=>i.some(J=>J.id===c.id))}),p=B(()=>{let i=[...U.value];const r=L.value.toLowerCase();return r&&(i=i.filter(s=>{var c,J;return((c=s.title)==null?void 0:c.toLowerCase().includes(r))||((J=s.tags)==null?void 0:J.some(ge=>{var Ie;return(Ie=ge.name)==null?void 0:Ie.toLowerCase().includes(r)}))})),$.value&&(i=i.filter(s=>s.tags&&s.tags.some(c=>c.id===$.value))),V.value==="name"?i.sort((s,c)=>{const J=(s.title||"").toLowerCase(),ge=(c.title||"").toLowerCase();return J.localeCompare(ge)}):V.value==="recent"&&i.sort((s,c)=>c.id-s.id),i}),M=B(()=>{const i=(D.value-1)*ae.value,r=i+ae.value;return p.value.slice(i,r)}),R=B(()=>Math.ceil(p.value.length/ae.value)),T=B(()=>{const i=(D.value-1)*ae.value+1,r=Math.min(D.value*ae.value,p.value.length);return{start:i,end:r,total:p.value.length}});ye([L,$],()=>{D.value=1});const z=B(()=>{const i=new Map;return U.value.forEach(r=>{r.tags&&r.tags.length>0&&r.tags.forEach(s=>{i.has(s.id)||i.set(s.id,s)})}),Array.from(i.values()).sort((r,s)=>r.name.localeCompare(s.name))}),ne=B(()=>{if(!$.value)return null;const i=z.value.find(r=>r.id===$.value);return i?i.name:null}),X=B(()=>{switch(V.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),f=i=>i.client_name?i.client_name:i.client?`${i.client.first_name||""} ${i.client.last_name||""}`.trim():"Cliente",N=i=>{const r=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],s=i.id%r.length;return r[s]},G=B(()=>p.value.length>0&&w.value.length===p.value.length),re=()=>{G.value?w.value=[]:w.value=p.value.map(i=>i.id)},te=i=>{const r=w.value.indexOf(i);r>-1?w.value.splice(r,1):w.value.push(i)},fe=()=>{w.value=p.value.map(i=>i.id)},ce=()=>{w.value=[]},pe=()=>{$.value=null},Ce=()=>{D.value>1&&D.value--},De=()=>{D.value<R.value&&D.value++},Ne=i=>{i>=1&&i<=R.value&&(D.value=i)},Le=B(()=>{const i=R.value,r=D.value,s=[];if(i<=7)for(let c=1;c<=i;c++)s.push(c);else if(r<=4){for(let c=1;c<=5;c++)s.push(c);s.push("..."),s.push(i)}else if(r>=i-3){s.push(1),s.push("...");for(let c=i-4;c<=i;c++)s.push(c)}else s.push(1),s.push("..."),s.push(r-1),s.push(r),s.push(r+1),s.push("..."),s.push(i);return s}),Be=()=>{const i=w.value.length>0?p.value.filter($e=>w.value.includes($e.id)):p.value,r=["Nombre Documento","Cliente","Estado","Etiquetas"],s=i.map($e=>[$e.title||"",f($e),"Completado",$e.tags?$e.tags.map(We=>We.name).join(", "):""]),c=[r.join(","),...s.map($e=>$e.map(We=>`"${We}"`).join(","))].join(`
`),J=new Blob([c],{type:"text/csv;charset=utf-8;"}),ge=document.createElement("a"),Ie=URL.createObjectURL(J);ge.setAttribute("href",Ie),ge.setAttribute("download",`documentos_completados_${new Date().toISOString().split("T")[0]}.csv`),ge.style.visibility="hidden",document.body.appendChild(ge),ge.click(),document.body.removeChild(ge)},Ue=async(i,r)=>{try{switch(i){case"editForm":_("edit",r,{userRole:se()});break;case"editDocument":A.push(`/dynamic_document_dashboard/client/editor/edit/${r.id}`);break;case"preview":await Q(r);break;case"delete":await K(r);break;case"letterhead":_("letterhead",r);break;case"relationships":_("relationships",r);break;case"downloadPDF":await O(r);break;case"downloadWord":await m(r);break;case"email":_("email",r);break;default:console.warn("Unknown action:",i)}}catch(s){console.error(`Error executing action ${i}:`,s)}},b=x(!1),j=x(null),le=i=>{j.value=i,b.value=!0},he=async(i,r)=>{b.value=!1,await Ue(i,r)};return(i,r)=>(n(),l("div",null,[e("div",dd,[e("div",cd,[e("div",ud,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":r[0]||(r[0]=s=>L.value=s),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[qe,L.value]])])]),e("div",md,[o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:k(()=>[e("div",gd,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",pd,h(ne.value||"Etiqueta"),1)]),o(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Te),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:k(()=>[e("div",hd,[o(t(ue),null,{default:k(({active:s})=>[e("a",{onClick:r[1]||(r[1]=c=>$.value=null),class:C([s?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(n(!0),l(de,null,me(z.value,s=>(n(),oe(t(ue),{key:s.id},{default:k(({active:c})=>[e("a",{onClick:J=>$.value=s.id,class:C([c?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},h(s.name),11,fd)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",vd,[$.value?(n(),l("button",{key:0,onClick:pe,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(je),{class:"h-4 w-4 flex-shrink-0"}),bd])):E("",!0)])]),e("div",yd,[e("div",xd,[e("div",_d,[e("span",wd,h(p.value.length),1),Y(" resultados ")]),o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:k(()=>[$d,Y(" "+h(X.value)+" ",1),o(t(Oe),{class:"h-4 w-4"})]),_:1}),o(t(Te),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",kd,[o(t(ue),null,{default:k(({active:s})=>[e("a",{onClick:r[2]||(r[2]=c=>V.value="recent"),class:C([s?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:k(({active:s})=>[e("a",{onClick:r[3]||(r[3]=c=>V.value="name"),class:C([s?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})]),e("div",Cd,[e("button",{onClick:Be,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[o(t(tt),{class:"h-4 w-4"}),Dd]),o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:k(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:1}),o(t(Te),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",Sd,[o(t(ue),null,{default:k(({active:s})=>[e("a",{onClick:fe,class:C([s?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),o(t(ue),null,{default:k(({active:s})=>[e("a",{onClick:ce,class:C([s?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Fd,[e("div",Ed,[e("table",Td,[e("thead",Ad,[e("tr",null,[e("th",Md,[e("input",{type:"checkbox",checked:G.value,onChange:re,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Pd)]),Ld,Id,jd,Bd])]),e("tbody",Ud,[(n(!0),l(de,null,me(M.value,(s,c)=>(n(),l("tr",{key:s.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:J=>le(s)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:r[4]||(r[4]=ve(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:w.value.includes(s.id),onChange:J=>te(s.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Nd)]),e("td",Od,[e("div",Rd,[e("div",qd,[e("div",Vd,[o(t(Qe),{class:"h-5 w-5 text-green-600"})])]),e("div",Qd,[e("div",Wd,h(s.title),1)])])]),e("td",Gd,[e("div",Hd,h(f(s)),1)]),Zd,e("td",Jd,[e("div",Kd,[(n(!0),l(de,null,me(s.tags,J=>(n(),l("span",{key:J.id,class:C(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",N(J)])},h(J.name),3))),128)),!s.tags||s.tags.length===0?(n(),l("span",Yd,"-")):E("",!0)])])],8,zd))),128))])])]),R.value>1?(n(),l("div",Xd,[e("div",ec,[e("button",{onClick:Ce,disabled:D.value===1,class:C(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",D.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,tc),e("button",{onClick:De,disabled:D.value===R.value,class:C(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",D.value===R.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,sc)]),e("div",oc,[e("div",null,[e("p",nc,[Y(" Mostrando "),e("span",rc,h(T.value.start),1),Y(" a "),e("span",ac,h(T.value.end),1),Y(" de "),e("span",lc,h(T.value.total),1),Y(" resultados ")])]),e("div",null,[e("nav",ic,[e("button",{onClick:Ce,disabled:D.value===1,class:C(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",D.value===1?"opacity-50 cursor-not-allowed":""])},[cc,o(t(pt),{class:"h-5 w-5","aria-hidden":"true"})],10,dc),(n(!0),l(de,null,me(Le.value,s=>(n(),l(de,{key:s},[s!=="..."?(n(),l("button",{key:0,onClick:c=>Ne(s),class:C(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",D.value===s?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},h(s),11,uc)):(n(),l("span",mc," ... "))],64))),128)),e("button",{onClick:De,disabled:D.value===R.value,class:C(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",D.value===R.value?"opacity-50 cursor-not-allowed":""])},[pc,o(t(at),{class:"h-5 w-5","aria-hidden":"true"})],10,gc)])])])])):E("",!0)]),p.value.length===0?(n(),l("div",hc,[o(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),fc,vc])):E("",!0),(n(),oe(ht,{to:"body"},[t(F).edit.isOpen?(n(),oe(t(St),{key:0,document:t(F).edit.document,"user-role":t(se)(),onClose:r[5]||(r[5]=s=>t(P)("edit")),onRefresh:r[6]||(r[6]=s=>u("refresh"))},null,8,["document","user-role"])):E("",!0),t(F).email.isOpen?(n(),oe(t(Ft),{key:1,document:t(F).email.document,onClose:r[7]||(r[7]=s=>t(P)("email"))},null,8,["document"])):E("",!0),t(F).letterhead.isOpen?(n(),oe(bt,{key:2,"is-visible":t(F).letterhead.isOpen,document:t(F).letterhead.document,onClose:r[8]||(r[8]=s=>t(P)("letterhead")),onUploaded:r[9]||(r[9]=s=>u("refresh")),onDeleted:r[10]||(r[10]=s=>u("refresh"))},null,8,["is-visible","document"])):E("",!0),t(F).relationships.isOpen?(n(),oe(Et,{key:3,"is-open":t(F).relationships.isOpen,document:t(F).relationships.document,onClose:r[11]||(r[11]=s=>t(P)("relationships")),onRefresh:r[12]||(r[12]=s=>u("refresh"))},null,8,["is-open","document"])):E("",!0),b.value?(n(),oe(_t,{key:4,"is-visible":b.value,document:j.value,"card-type":"client",context:"table","user-store":t(g),onClose:r[13]||(r[13]=s=>b.value=!1),onAction:he},null,8,["is-visible","document","user-store"])):E("",!0)]))]))}},yc={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},xc={class:"mb-4"},_c={class:"relative w-full"},wc={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},$c={class:"flex items-center gap-2 min-w-0"},kc={class:"truncate"},Cc={class:"py-1"},Dc=["onClick"],Sc={class:"flex items-center justify-stretch"},Fc=e("span",null,"Limpiar",-1),Ec={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},Tc={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Ac={class:"text-sm text-gray-500"},Mc={class:"font-medium"},Pc=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),Lc={class:"py-1"},Ic={class:"flex items-center gap-2"},jc=e("span",{class:"hidden sm:inline"},"Exportar",-1),Bc={class:"py-1"},Uc={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},zc={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Nc={class:"min-w-full divide-y divide-gray-200"},Oc={class:"bg-gray-50"},Rc={scope:"col",class:"w-12 px-6 py-3"},qc=["checked"],Vc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Qc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),Wc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),Gc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),Hc={class:"bg-white divide-y divide-gray-200"},Zc=["onClick"],Jc=["checked","onChange"],Kc={class:"px-6 py-4 whitespace-nowrap"},Yc={class:"flex items-center"},Xc={class:"flex-shrink-0 h-10 w-10"},eu={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},tu={class:"ml-4"},su={class:"text-sm font-medium text-gray-900"},ou={class:"px-6 py-4 whitespace-nowrap"},nu={class:"text-sm text-gray-900"},ru=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-700 border border-blue-200"}," En Progreso ")],-1),au={class:"px-6 py-4 whitespace-nowrap"},lu={class:"flex flex-wrap gap-1"},iu={key:0,class:"text-sm text-gray-400"},du={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},cu={class:"flex flex-1 justify-between sm:hidden"},uu=["disabled"],mu=["disabled"],gu={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},pu={class:"text-sm text-gray-700"},hu={class:"font-medium"},fu={class:"font-medium"},vu={class:"font-medium"},bu={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},yu=["disabled"],xu=e("span",{class:"sr-only"},"Anterior",-1),_u=["onClick"],wu={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},$u=["disabled"],ku=e("span",{class:"sr-only"},"Siguiente",-1),Cu={key:0,class:"text-center py-12"},Du=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos en progreso",-1),Su=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos en progreso por clientes aparecerán aquí.",-1),Fu={__name:"DocumentInProgressByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(a,{emit:v}){const d=Ve(),g=Je(),A=et(),S=a,u=v,{activeModals:F,openModal:_,closeModal:P,getUserRole:se}=ft(d,g),{handlePreviewDocument:Q,deleteDocument:K,downloadPDFDocument:O,downloadWordDocument:m}=vt(d,g,u),L=x(""),$=x(null),V=x("recent"),w=x([]),D=x(1),ae=x(10);Re(()=>{d.init(),g.init()});const U=B(()=>{const i=d.progressDocumentsByClient,r=S.selectedTags?S.selectedTags.map(c=>c.id):[];return d.filteredDocumentsBySearchAndTags(S.searchQuery,g,r).filter(c=>i.some(J=>J.id===c.id))}),p=B(()=>{let i=[...U.value];const r=L.value.toLowerCase();return r&&(i=i.filter(s=>{var c,J;return((c=s.title)==null?void 0:c.toLowerCase().includes(r))||((J=s.tags)==null?void 0:J.some(ge=>{var Ie;return(Ie=ge.name)==null?void 0:Ie.toLowerCase().includes(r)}))})),$.value&&(i=i.filter(s=>s.tags&&s.tags.some(c=>c.id===$.value))),V.value==="name"?i.sort((s,c)=>{const J=(s.title||"").toLowerCase(),ge=(c.title||"").toLowerCase();return J.localeCompare(ge)}):V.value==="recent"&&i.sort((s,c)=>c.id-s.id),i}),M=B(()=>{const i=(D.value-1)*ae.value,r=i+ae.value;return p.value.slice(i,r)}),R=B(()=>Math.ceil(p.value.length/ae.value)),T=B(()=>{const i=(D.value-1)*ae.value+1,r=Math.min(D.value*ae.value,p.value.length);return{start:i,end:r,total:p.value.length}});ye([L,$],()=>{D.value=1});const z=B(()=>{const i=new Map;return U.value.forEach(r=>{r.tags&&r.tags.length>0&&r.tags.forEach(s=>{i.has(s.id)||i.set(s.id,s)})}),Array.from(i.values()).sort((r,s)=>r.name.localeCompare(s.name))}),ne=B(()=>{if(!$.value)return null;const i=z.value.find(r=>r.id===$.value);return i?i.name:null}),X=B(()=>{switch(V.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),f=i=>i.client_name?i.client_name:i.client?`${i.client.first_name||""} ${i.client.last_name||""}`.trim():"Cliente",N=i=>{const r=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],s=i.id%r.length;return r[s]},G=B(()=>p.value.length>0&&w.value.length===p.value.length),re=()=>{G.value?w.value=[]:w.value=p.value.map(i=>i.id)},te=i=>{const r=w.value.indexOf(i);r>-1?w.value.splice(r,1):w.value.push(i)},fe=()=>{w.value=p.value.map(i=>i.id)},ce=()=>{w.value=[]},pe=()=>{$.value=null},Ce=()=>{D.value>1&&D.value--},De=()=>{D.value<R.value&&D.value++},Ne=i=>{i>=1&&i<=R.value&&(D.value=i)},Le=B(()=>{const i=R.value,r=D.value,s=[];if(i<=7)for(let c=1;c<=i;c++)s.push(c);else if(r<=4){for(let c=1;c<=5;c++)s.push(c);s.push("..."),s.push(i)}else if(r>=i-3){s.push(1),s.push("...");for(let c=i-4;c<=i;c++)s.push(c)}else s.push(1),s.push("..."),s.push(r-1),s.push(r),s.push(r+1),s.push("..."),s.push(i);return s}),Be=()=>{const i=w.value.length>0?p.value.filter($e=>w.value.includes($e.id)):p.value,r=["Nombre Documento","Cliente","Estado","Etiquetas"],s=i.map($e=>[$e.title||"",f($e),"En Progreso",$e.tags?$e.tags.map(We=>We.name).join(", "):""]),c=[r.join(","),...s.map($e=>$e.map(We=>`"${We}"`).join(","))].join(`
`),J=new Blob([c],{type:"text/csv;charset=utf-8;"}),ge=document.createElement("a"),Ie=URL.createObjectURL(J);ge.setAttribute("href",Ie),ge.setAttribute("download",`documentos_en_progreso_${new Date().toISOString().split("T")[0]}.csv`),ge.style.visibility="hidden",document.body.appendChild(ge),ge.click(),document.body.removeChild(ge)},Ue=async(i,r)=>{try{switch(i){case"editForm":_("edit",r,{userRole:se()});break;case"editDocument":A.push(`/dynamic_document_dashboard/client/editor/edit/${r.id}`);break;case"preview":await Q(r);break;case"delete":await K(r);break;case"letterhead":_("letterhead",r);break;case"relationships":_("relationships",r);break;case"downloadPDF":await O(r);break;case"downloadWord":await m(r);break;case"email":_("email",r);break;default:console.warn("Unknown action:",i)}}catch(s){console.error(`Error executing action ${i}:`,s)}},b=x(!1),j=x(null),le=i=>{j.value=i,b.value=!0},he=async(i,r)=>{b.value=!1,await Ue(i,r)};return(i,r)=>(n(),l("div",null,[e("div",yc,[e("div",xc,[e("div",_c,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":r[0]||(r[0]=s=>L.value=s),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[qe,L.value]])])]),e("div",wc,[o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:k(()=>[e("div",$c,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",kc,h(ne.value||"Etiqueta"),1)]),o(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Te),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:k(()=>[e("div",Cc,[o(t(ue),null,{default:k(({active:s})=>[e("a",{onClick:r[1]||(r[1]=c=>$.value=null),class:C([s?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(n(!0),l(de,null,me(z.value,s=>(n(),oe(t(ue),{key:s.id},{default:k(({active:c})=>[e("a",{onClick:J=>$.value=s.id,class:C([c?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},h(s.name),11,Dc)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",Sc,[$.value?(n(),l("button",{key:0,onClick:pe,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(je),{class:"h-4 w-4 flex-shrink-0"}),Fc])):E("",!0)])]),e("div",Ec,[e("div",Tc,[e("div",Ac,[e("span",Mc,h(p.value.length),1),Y(" resultados ")]),o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:k(()=>[Pc,Y(" "+h(X.value)+" ",1),o(t(Oe),{class:"h-4 w-4"})]),_:1}),o(t(Te),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",Lc,[o(t(ue),null,{default:k(({active:s})=>[e("a",{onClick:r[2]||(r[2]=c=>V.value="recent"),class:C([s?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:k(({active:s})=>[e("a",{onClick:r[3]||(r[3]=c=>V.value="name"),class:C([s?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})]),e("div",Ic,[e("button",{onClick:Be,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[o(t(tt),{class:"h-4 w-4"}),jc]),o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:k(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:1}),o(t(Te),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",Bc,[o(t(ue),null,{default:k(({active:s})=>[e("a",{onClick:fe,class:C([s?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),o(t(ue),null,{default:k(({active:s})=>[e("a",{onClick:ce,class:C([s?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Uc,[e("div",zc,[e("table",Nc,[e("thead",Oc,[e("tr",null,[e("th",Rc,[e("input",{type:"checkbox",checked:G.value,onChange:re,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,qc)]),Vc,Qc,Wc,Gc])]),e("tbody",Hc,[(n(!0),l(de,null,me(M.value,(s,c)=>(n(),l("tr",{key:s.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:J=>le(s)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:r[4]||(r[4]=ve(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:w.value.includes(s.id),onChange:J=>te(s.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Jc)]),e("td",Kc,[e("div",Yc,[e("div",Xc,[e("div",eu,[o(t(Qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",tu,[e("div",su,h(s.title),1)])])]),e("td",ou,[e("div",nu,h(f(s)),1)]),ru,e("td",au,[e("div",lu,[(n(!0),l(de,null,me(s.tags,J=>(n(),l("span",{key:J.id,class:C(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",N(J)])},h(J.name),3))),128)),!s.tags||s.tags.length===0?(n(),l("span",iu,"-")):E("",!0)])])],8,Zc))),128))])])]),R.value>1?(n(),l("div",du,[e("div",cu,[e("button",{onClick:Ce,disabled:D.value===1,class:C(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",D.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,uu),e("button",{onClick:De,disabled:D.value===R.value,class:C(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",D.value===R.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,mu)]),e("div",gu,[e("div",null,[e("p",pu,[Y(" Mostrando "),e("span",hu,h(T.value.start),1),Y(" a "),e("span",fu,h(T.value.end),1),Y(" de "),e("span",vu,h(T.value.total),1),Y(" resultados ")])]),e("div",null,[e("nav",bu,[e("button",{onClick:Ce,disabled:D.value===1,class:C(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",D.value===1?"opacity-50 cursor-not-allowed":""])},[xu,o(t(pt),{class:"h-5 w-5","aria-hidden":"true"})],10,yu),(n(!0),l(de,null,me(Le.value,s=>(n(),l(de,{key:s},[s!=="..."?(n(),l("button",{key:0,onClick:c=>Ne(s),class:C(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",D.value===s?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},h(s),11,_u)):(n(),l("span",wu," ... "))],64))),128)),e("button",{onClick:De,disabled:D.value===R.value,class:C(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",D.value===R.value?"opacity-50 cursor-not-allowed":""])},[ku,o(t(at),{class:"h-5 w-5","aria-hidden":"true"})],10,$u)])])])])):E("",!0)]),p.value.length===0?(n(),l("div",Cu,[o(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),Du,Su])):E("",!0),(n(),oe(ht,{to:"body"},[t(F).edit.isOpen?(n(),oe(t(St),{key:0,document:t(F).edit.document,"user-role":t(se)(),onClose:r[5]||(r[5]=s=>t(P)("edit")),onRefresh:r[6]||(r[6]=s=>u("refresh"))},null,8,["document","user-role"])):E("",!0),t(F).email.isOpen?(n(),oe(t(Ft),{key:1,document:t(F).email.document,onClose:r[7]||(r[7]=s=>t(P)("email"))},null,8,["document"])):E("",!0),t(F).letterhead.isOpen?(n(),oe(bt,{key:2,"is-visible":t(F).letterhead.isOpen,document:t(F).letterhead.document,onClose:r[8]||(r[8]=s=>t(P)("letterhead")),onUploaded:r[9]||(r[9]=s=>u("refresh")),onDeleted:r[10]||(r[10]=s=>u("refresh"))},null,8,["is-visible","document"])):E("",!0),t(F).relationships.isOpen?(n(),oe(Et,{key:3,"is-open":t(F).relationships.isOpen,document:t(F).relationships.document,onClose:r[11]||(r[11]=s=>t(P)("relationships")),onRefresh:r[12]||(r[12]=s=>u("refresh"))},null,8,["is-open","document"])):E("",!0),b.value?(n(),oe(_t,{key:4,"is-visible":b.value,document:j.value,"card-type":"client",context:"table","user-store":t(g),onClose:r[13]||(r[13]=s=>b.value=!1),onAction:he},null,8,["is-visible","document","user-store"])):E("",!0)]))]))}},Eu={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},Tu={class:"mb-4"},Au={class:"relative w-full"},Mu={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},Pu={class:"flex items-center gap-2 min-w-0"},Lu={class:"truncate"},Iu={class:"p-2"},ju={class:"relative mb-2"},Bu={class:"max-h-60 overflow-y-auto"},Uu=["onClick"],zu={class:"truncate"},Nu={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},Ou={class:"flex items-center justify-stretch"},Ru=e("span",null,"Limpiar",-1),qu={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},Vu={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Qu={class:"text-sm text-gray-500"},Wu={class:"font-medium"},Gu=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),Hu={class:"py-1"},Zu={class:"flex items-center gap-2"},Ju=e("span",{class:"hidden sm:inline"},"Exportar",-1),Ku={class:"py-1"},Yu={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Xu={class:"overflow-x-auto",style:{"overflow-y":"visible"}},em={class:"min-w-full divide-y divide-gray-200"},tm={class:"bg-gray-50"},sm={scope:"col",class:"w-12 px-6 py-3"},om=["checked"],nm=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),rm=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado Firma ",-1),am=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),lm={class:"bg-white divide-y divide-gray-200"},im=["onClick"],dm=["checked","onChange"],cm={class:"px-6 py-4 whitespace-nowrap"},um={class:"flex items-center"},mm={class:"flex-shrink-0 h-10 w-10"},gm={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},pm={class:"ml-4"},hm={class:"text-sm font-medium text-gray-900"},fm={class:"px-6 py-4 whitespace-nowrap"},vm={class:"px-6 py-4 whitespace-nowrap"},bm={class:"flex flex-wrap gap-1"},ym={key:0,class:"text-sm text-gray-400"},xm={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},_m={class:"flex flex-1 justify-between sm:hidden"},wm=["disabled"],$m=["disabled"],km={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Cm={class:"text-sm text-gray-700"},Dm={class:"font-medium"},Sm={class:"font-medium"},Fm={class:"font-medium"},Em={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Tm=["disabled"],Am=e("span",{class:"sr-only"},"Anterior",-1),Mm=["onClick"],Pm={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},Lm=["disabled"],Im=e("span",{class:"sr-only"},"Siguiente",-1),jm={key:0,class:"text-center py-12"},Bm={class:"mt-2 text-sm font-medium text-gray-900"},Um={class:"mt-1 text-sm text-gray-500"},zm={key:1,class:"text-center py-12"},Nm=e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-secondary"},null,-1),Om=e("p",{class:"mt-2 text-sm text-gray-500"},"Cargando documentos...",-1),Rm=[Nm,Om],$t={__name:"SignaturesListTable",props:{state:{type:String,required:!0,validator:a=>["PendingSignatures","FullySigned"].includes(a)},searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","document-fully-signed","open-electronic-signature"],setup(a,{expose:v,emit:d}){const g=a,A=d,S=Je(),u=Ve();et();const{activeModals:F,openModal:_,closeModal:P,getUserRole:se}=ft(u,S),{handlePreviewDocument:Q,downloadPDFDocument:K,signDocument:O,downloadSignedDocument:m}=vt(u,S,A);x([]);const L=x(!1),$=x(""),V=x(""),w=x(null),D=x("recent"),ae=x([]),U=x(1),p=x(10),M=B(()=>g.state==="PendingSignatures"?"No tienes documentos pendientes por firmar":"No tienes documentos firmados"),R=B(()=>g.state==="PendingSignatures"?"Cuando tengas documentos que requieran tu firma electrónica aparecerán aquí.":"Una vez que firmes documentos electrónicamente, aparecerán aquí."),T=B(()=>{const ee=S.currentUser.role,W=S.currentUser.id,ie=S.currentUser.email;let Z=[];return ee==="lawyer"?g.state==="PendingSignatures"?Z=u.pendingSignatureDocuments.filter(be=>{var Se;const xe=be.created_by===W,Me=(Se=be.signatures)==null?void 0:Se.some(ze=>ze.signer_email===ie);return xe||Me}):Z=u.fullySignedDocuments.filter(be=>{var Se;const xe=be.created_by===W,Me=(Se=be.signatures)==null?void 0:Se.some(ze=>ze.signer_email===ie&&ze.signed);return xe||Me}):g.state==="PendingSignatures"?Z=u.documents.filter(be=>{var Se;if(be.state!=="PendingSignatures")return!1;const xe=(Se=be.signatures)==null?void 0:Se.some(ze=>ze.signer_email===ie),Me=be.created_by===W;return xe||Me}):Z=u.documents.filter(be=>{var Se;if(be.state!=="FullySigned")return!1;const xe=(Se=be.signatures)==null?void 0:Se.some(ze=>ze.signer_email===ie&&ze.signed),Me=be.created_by===W;return xe||Me}),Z}),z=B(()=>{let ee=[...T.value];const W=$.value.toLowerCase();return W&&(ee=ee.filter(ie=>{var Z,be;return((Z=ie.title)==null?void 0:Z.toLowerCase().includes(W))||((be=ie.tags)==null?void 0:be.some(xe=>{var Me;return(Me=xe.name)==null?void 0:Me.toLowerCase().includes(W)}))})),w.value&&(ee=ee.filter(ie=>ie.tags&&ie.tags.some(Z=>Z.id===w.value))),D.value==="name"?ee.sort((ie,Z)=>{const be=(ie.title||"").toLowerCase(),xe=(Z.title||"").toLowerCase();return be.localeCompare(xe)}):D.value==="recent"&&ee.sort((ie,Z)=>Z.id-ie.id),ee}),ne=B(()=>{const ee=(U.value-1)*p.value,W=ee+p.value;return z.value.slice(ee,W)}),X=B(()=>Math.ceil(z.value.length/p.value)),f=B(()=>{const ee=(U.value-1)*p.value+1,W=Math.min(U.value*p.value,z.value.length);return{start:ee,end:W,total:z.value.length}});ye([$,w],()=>{U.value=1});const N=B(()=>{const ee=new Map;return T.value.forEach(W=>{W.tags&&W.tags.length>0&&W.tags.forEach(ie=>{ee.has(ie.id)||ee.set(ie.id,ie)})}),Array.from(ee.values()).sort((W,ie)=>W.name.localeCompare(ie.name))}),G=B(()=>{if(!V.value)return N.value;const ee=V.value.toLowerCase();return N.value.filter(W=>W.name.toLowerCase().includes(ee))}),re=B(()=>{if(!w.value)return null;const ee=N.value.find(W=>W.id===w.value);return ee?ee.name:null}),te=ee=>{const W=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],ie=ee.id%W.length;return W[ie]},fe=B(()=>{switch(D.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),ce=ee=>{const W=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],ie=ee.id%W.length;return W[ie]},pe=ee=>g.state==="FullySigned"?"bg-green-100 text-green-700 border border-green-200":"bg-yellow-100 text-yellow-700 border border-yellow-200",Ce=ee=>g.state==="FullySigned"?"Firmado":"Pendiente",De=B(()=>z.value.length>0&&ae.value.length===z.value.length),Ne=()=>{De.value?ae.value=[]:ae.value=z.value.map(ee=>ee.id)},Le=ee=>{const W=ae.value.indexOf(ee);W>-1?ae.value.splice(W,1):ae.value.push(ee)},Be=()=>{ae.value=z.value.map(ee=>ee.id)},Ue=()=>{ae.value=[]},b=()=>{w.value=null},j=()=>{U.value>1&&U.value--},le=()=>{U.value<X.value&&U.value++},he=ee=>{ee>=1&&ee<=X.value&&(U.value=ee)},i=B(()=>{const ee=X.value,W=U.value,ie=[];if(ee<=7)for(let Z=1;Z<=ee;Z++)ie.push(Z);else if(W<=4){for(let Z=1;Z<=5;Z++)ie.push(Z);ie.push("..."),ie.push(ee)}else if(W>=ee-3){ie.push(1),ie.push("...");for(let Z=ee-4;Z<=ee;Z++)ie.push(Z)}else ie.push(1),ie.push("..."),ie.push(W-1),ie.push(W),ie.push(W+1),ie.push("..."),ie.push(ee);return ie}),r=()=>{const ee=ae.value.length>0?z.value.filter(Se=>ae.value.includes(Se.id)):z.value,W=["Nombre Documento","Estado Firma","Etiquetas"],ie=ee.map(Se=>[Se.title||"",Ce(),Se.tags?Se.tags.map(ze=>ze.name).join(", "):""]),Z=[W.join(","),...ie.map(Se=>Se.map(ze=>`"${ze}"`).join(","))].join(`
`),be=new Blob([Z],{type:"text/csv;charset=utf-8;"}),xe=document.createElement("a"),Me=URL.createObjectURL(be);xe.setAttribute("href",Me),xe.setAttribute("download",`documentos_firmas_${new Date().toISOString().split("T")[0]}.csv`),xe.style.visibility="hidden",document.body.appendChild(xe),xe.click(),document.body.removeChild(xe)},s=x(!1),c=x(null),J=ee=>{c.value=ee,s.value=!0},ge=async(ee,W)=>{s.value=!1,await Ie(ee,W)},Ie=async(ee,W)=>{try{switch(ee){case"preview":await Q(W);break;case"letterhead":_("letterhead",W);break;case"viewSignatures":_("signatures",W);break;case"sign":await O(W,_);break;case"downloadSignedDocument":await m(W);break;case"downloadPDF":await K(W);break;default:console.warn("Unknown action:",ee)}}catch(ie){console.error(`Error executing action ${ee}:`,ie)}},$e=async()=>{L.value=!0;try{await u.init(!0)}catch(ee){console.error("Error refreshing documents:",ee),ke("Error al actualizar documentos","error")}finally{L.value=!1}},We=async()=>{await $e(),A("refresh")};return Re(async()=>{await $e()}),v({refresh:We}),ye(()=>S.currentUser,()=>{We()}),(ee,W)=>{var ie;return n(),l("div",null,[e("div",Eu,[e("div",Tu,[e("div",Au,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":W[0]||(W[0]=Z=>$.value=Z),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[qe,$.value]])])]),e("div",Mu,[o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:k(()=>[e("div",Pu,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",Lu,h(re.value||"Etiqueta"),1)]),o(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Te),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",Iu,[e("div",ju,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":W[1]||(W[1]=Z=>V.value=Z),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:W[2]||(W[2]=ve(()=>{},["stop"]))},null,512),[[qe,V.value]])]),e("div",Bu,[o(t(ue),null,{default:k(({active:Z})=>[e("a",{onClick:W[3]||(W[3]=be=>w.value=null),class:C([Z?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(n(!0),l(de,null,me(G.value,Z=>(n(),oe(t(ue),{key:Z.id},{default:k(({active:be})=>[e("a",{onClick:xe=>w.value=Z.id,class:C([be?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:C(["w-3 h-3 rounded-full flex-shrink-0",te(Z)])},null,2),e("span",zu,h(Z.name),1)],10,Uu)]),_:2},1024))),128)),G.value.length===0?(n(),l("div",Nu," No se encontraron etiquetas ")):E("",!0)])])]),_:1})]),_:1}),e("div",Ou,[w.value?(n(),l("button",{key:0,onClick:b,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(je),{class:"h-4 w-4 flex-shrink-0"}),Ru])):E("",!0)])]),e("div",qu,[e("div",Vu,[e("div",Qu,[e("span",Wu,h(z.value.length),1),Y(" resultados ")]),o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:k(()=>[Gu,Y(" "+h(fe.value)+" ",1),o(t(Oe),{class:"h-4 w-4"})]),_:1}),o(t(Te),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",Hu,[o(t(ue),null,{default:k(({active:Z})=>[e("a",{onClick:W[4]||(W[4]=be=>D.value="recent"),class:C([Z?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:k(({active:Z})=>[e("a",{onClick:W[5]||(W[5]=be=>D.value="name"),class:C([Z?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})]),e("div",Zu,[e("button",{onClick:r,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[o(t(tt),{class:"h-4 w-4"}),Ju]),o(t(Fe),{as:"div",class:"relative"},{default:k(()=>[o(t(Ee),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:k(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:1}),o(t(Te),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:k(()=>[e("div",Ku,[o(t(ue),null,{default:k(({active:Z})=>[e("a",{onClick:Be,class:C([Z?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),o(t(ue),null,{default:k(({active:Z})=>[e("a",{onClick:Ue,class:C([Z?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Yu,[e("div",Xu,[e("table",em,[e("thead",tm,[e("tr",null,[e("th",sm,[e("input",{type:"checkbox",checked:De.value,onChange:Ne,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,om)]),nm,rm,am])]),e("tbody",lm,[(n(!0),l(de,null,me(ne.value,(Z,be)=>(n(),l("tr",{key:Z.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:xe=>J(Z)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:W[6]||(W[6]=ve(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:ae.value.includes(Z.id),onChange:xe=>Le(Z.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,dm)]),e("td",cm,[e("div",um,[e("div",mm,[e("div",gm,[o(t(Qe),{class:"h-5 w-5 text-purple-600"})])]),e("div",pm,[e("div",hm,h(Z.title),1)])])]),e("td",fm,[e("span",{class:C(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",pe()])},h(Ce()),3)]),e("td",vm,[e("div",bm,[(n(!0),l(de,null,me(Z.tags,xe=>(n(),l("span",{key:xe.id,class:C(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ce(xe)])},h(xe.name),3))),128)),!Z.tags||Z.tags.length===0?(n(),l("span",ym,"-")):E("",!0)])])],8,im))),128))])])]),X.value>1?(n(),l("div",xm,[e("div",_m,[e("button",{onClick:j,disabled:U.value===1,class:C(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",U.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,wm),e("button",{onClick:le,disabled:U.value===X.value,class:C(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",U.value===X.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,$m)]),e("div",km,[e("div",null,[e("p",Cm,[Y(" Mostrando "),e("span",Dm,h(f.value.start),1),Y(" a "),e("span",Sm,h(f.value.end),1),Y(" de "),e("span",Fm,h(f.value.total),1),Y(" resultados ")])]),e("div",null,[e("nav",Em,[e("button",{onClick:j,disabled:U.value===1,class:C(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",U.value===1?"opacity-50 cursor-not-allowed":""])},[Am,o(t(pt),{class:"h-5 w-5","aria-hidden":"true"})],10,Tm),(n(!0),l(de,null,me(i.value,Z=>(n(),l(de,{key:Z},[Z!=="..."?(n(),l("button",{key:0,onClick:be=>he(Z),class:C(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",U.value===Z?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},h(Z),11,Mm)):(n(),l("span",Pm," ... "))],64))),128)),e("button",{onClick:le,disabled:U.value===X.value,class:C(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",U.value===X.value?"opacity-50 cursor-not-allowed":""])},[Im,o(t(at),{class:"h-5 w-5","aria-hidden":"true"})],10,Lm)])])])])):E("",!0)]),z.value.length===0&&!L.value?(n(),l("div",jm,[o(t(lt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",Bm,h(M.value),1),e("p",Um,h(R.value),1)])):E("",!0),L.value?(n(),l("div",zm,Rm)):E("",!0),o(jt,{isVisible:t(nt),documentData:t(It),onClose:W[7]||(W[7]=Z=>nt.value=!1)},null,8,["isVisible","documentData"]),(n(),oe(ht,{to:"body"},[t(F).signatures.isOpen?(n(),oe(t(Zt),{key:0,"document-id":(ie=t(F).signatures.document)==null?void 0:ie.id,onClose:W[8]||(W[8]=Z=>t(P)("signatures")),onRefresh:W[9]||(W[9]=Z=>A("refresh"))},null,8,["document-id"])):E("",!0),t(F).letterhead.isOpen?(n(),oe(bt,{key:1,"is-visible":t(F).letterhead.isOpen,document:t(F).letterhead.document,onClose:W[10]||(W[10]=Z=>t(P)("letterhead")),onUploaded:W[11]||(W[11]=Z=>A("refresh")),onDeleted:W[12]||(W[12]=Z=>A("refresh"))},null,8,["is-visible","document"])):E("",!0),s.value?(n(),oe(_t,{key:2,"is-visible":s.value,document:c.value,"card-type":"signatures",context:"table","user-store":t(S),onClose:W[13]||(W[13]=Z=>s.value=!1),onAction:ge},null,8,["is-visible","document","user-store"])):E("",!0)]))])}}},qm={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Vm={class:"flex justify-end"},Qm=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[Y(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),Wm={class:"mt-2"},Gm={class:"flex gap-2 mt-2.5"},Hm=["disabled"],Zm=e("span",null,"Actualizar nombre",-1),Jm=[Zm],Km=["disabled"],Ym={__name:"CreateDocumentByLawyer",emits:["close"],setup(a,{emit:v}){const d=et(),g=Ve(),A=v,S=x(""),u=x("");Gt(()=>{var O;(O=g.selectedDocument)!=null&&O.title?(S.value=g.selectedDocument.title,u.value=g.selectedDocument.title):(S.value="",u.value="")});const F=O=>{O.key==="Escape"&&A("close")};Re(()=>{document.addEventListener("keydown",F)}),ut(()=>{document.removeEventListener("keydown",F)});const _=B(()=>S.value.trim().length>0),P=B(()=>{var O;return!!((O=g.selectedDocument)!=null&&O.id)}),se=B(()=>P.value&&S.value.trim()!==u.value.trim()&&S.value.trim().length>0);async function Q(){if(P.value&&se.value)try{const O={title:S.value.trim()};await g.updateDocument(g.selectedDocument.id,O),u.value=S.value.trim(),g.selectedDocument.title=S.value.trim(),g.lastUpdatedDocumentId=g.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",g.selectedDocument.id);const m=g.selectedDocument.id;A("close",{updatedDocId:m});const L=window.location.pathname;L==="/dynamic_document_dashboard"||L==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(m)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(O){console.error("Error updating document name:",O)}}const K=async()=>{if(!_.value)return;const O=encodeURIComponent(S.value.trim());P.value?(g.selectedDocument.title=S.value,g.selectedDocument.id&&(g.lastUpdatedDocumentId=g.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",g.selectedDocument.id.toString())),d.push(`/dynamic_document_dashboard/lawyer/editor/edit/${g.selectedDocument.id}`)):(g.selectedDocument={title:S.value.trim()},d.push(`/dynamic_document_dashboard/lawyer/editor/create/${O}`))};return(O,m)=>(n(),l("div",qm,[e("div",Vm,[e("button",{onClick:m[0]||(m[0]=L=>A("close"))},[o(t(je),{class:"size-6"})])]),e("form",{onSubmit:ve(K,["prevent"])},[e("div",null,[Qm,e("div",Wm,[Pe(e("input",{"onUpdate:modelValue":m[1]||(m[1]=L=>S.value=L),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[qe,S.value]])])]),e("div",Gm,[P.value?(n(),l("button",{key:0,type:"button",onClick:Q,disabled:!se.value,class:C(["p-2.5 text-sm font-medium rounded-md flex gap-2",se.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Jm,10,Hm)):E("",!0),e("button",{type:"submit",class:C(["p-2.5 text-sm font-medium rounded-md flex gap-2",_.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!_.value},[e("span",null,h(P.value?"Editar Documento":"Continuar"),1)],10,Km)])],32)]))}},Ae=a=>(mt("data-v-b59f9884"),a=a(),gt(),a),Xm={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},eg={class:"px-6 py-4 border-b border-gray-200"},tg=Ae(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gestión de Membrete Global para PDF",-1)),sg=Ae(()=>e("p",{class:"text-sm text-gray-500 mt-1"}," La imagen de membrete se usará por defecto solo al generar documentos en PDF. Para documentos Word, se utiliza la plantilla .docx configurada más abajo. ",-1)),og={class:"p-6 overflow-y-auto flex-grow"},ng={key:0,class:"text-center py-10"},rg=Ae(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),ag={class:"mt-4 text-gray-500"},lg={key:1,class:"space-y-6"},ig={key:0,class:"space-y-4"},dg=Ae(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete de imagen para PDF actual",-1)),cg={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},ug=["src"],mg={class:"mt-4 flex justify-center space-x-3"},gg=["disabled"],pg={key:1,class:"text-center py-8"},hg=Ae(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete para PDF",-1)),fg=Ae(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," No tienes una imagen de membrete global configurada para los documentos PDF. ",-1)),vg=Ae(()=>e("p",{class:"mt-1 text-xs text-gray-400"}," Este membrete de imagen se aplicará solo a los PDF que no tengan un membrete específico. ",-1)),bg={class:"space-y-4"},yg={class:"text-lg font-medium text-gray-900"},xg={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},_g={key:0},wg={class:"mt-4"},$g=Ae(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, máximo 10MB. Se usa únicamente para los PDF. ",-1)),kg=Ae(()=>e("p",{class:"text-xs text-gray-400 mt-1"}," Dimensiones ideales: 612 × 612 píxeles (8.5:11 Carta) ",-1)),Cg={key:1,class:"space-y-4"},Dg={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Sg={class:"text-gray-400"},Fg={key:0,class:"mt-4"},Eg=["src"],Tg={class:"flex justify-center space-x-3"},Ag=["disabled"],Mg={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Pg={class:"space-y-4 border-t border-gray-200 pt-6"},Lg=Ae(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Plantilla Word para documentos (.docx)",-1)),Ig=Ae(()=>e("p",{class:"text-sm text-gray-500"}," Esta plantilla se usará al descargar documentos en Word. Debe ser un archivo .docx con tu membrete configurado (header, footer o watermark). El contenido del documento se añadirá sobre esa plantilla. ",-1)),jg={key:0,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Bg={class:"text-sm text-gray-700"},Ug=Ae(()=>e("div",{class:"font-medium"},"Plantilla actual:",-1)),zg={class:"mt-1 break-words"},Ng={class:"font-mono break-all"},Og={key:0,class:"text-gray-400 ml-2"},Rg={class:"mt-3 flex flex-wrap gap-3"},qg=["disabled"],Vg={key:1,class:"text-sm text-gray-500"},Qg={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},Wg={key:0},Gg={class:"mt-4"},Hg=Ae(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos .docx, máximo 10MB. ",-1)),Zg={key:1,class:"space-y-4"},Jg={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Kg={class:"text-gray-400"},Yg={class:"flex justify-center space-x-3"},Xg=["disabled"],e0={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},t0={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},s0={class:"flex items-center space-x-2"},o0=Ae(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete para PDF",-1)),n0=Ae(()=>e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-yellow-800 mb-2"},"🔄 Prioridad de Membrete"),e("div",{class:"text-sm text-yellow-700 space-y-1"},[e("div",null,[e("strong",null,"1º Prioridad:"),Y(" Membrete específico del documento")]),e("div",null,[e("strong",null,"2º Prioridad:"),Y(" Membrete global de imagen para PDF del usuario (este)")]),e("div",null,[e("strong",null,"3º Prioridad:"),Y(" Sin membrete")])])],-1)),r0=Ae(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"📐 Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"612 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"612 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporción:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"±10%")])])])],-1)),a0=Ae(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🎨 Distribución Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"⚠️ ZONA CRÍTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mantén semi-transparente. El texto del documento se superpone aquí.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, teléfonos, emails, información de contacto.")])])])])])],-1)),l0=Ae(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🔧 Consideraciones Técnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Posicionamiento:"),Y(" La imagen se centra automáticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Transparencia:"),Y(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Márgenes:"),Y(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Resolución:"),Y(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"⚠️"),e("span",null,[e("strong",null,"Zona crítica:"),Y(" Evita elementos gráficos densos en el centro (300-400px de altura)")])])])])],-1)),i0=Ae(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"💡 Tips de Diseño Rápido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"• Si solo tienes header, ubícalo en los primeros 120-150px"),e("div",null,"• El resto de la imagen debe ser transparente o blanco"),e("div",null,"• Para footer, usa los últimos 80-120px"),e("div",null,"• El texto se superpone en toda la imagen, mantén el centro claro")])],-1)),d0={key:3,class:"space-y-2"},c0={class:"flex"},u0={class:"text-sm text-yellow-700"},m0={__name:"GlobalLetterheadModal",props:{isVisible:{type:Boolean,default:!1}},emits:["close","uploaded","deleted"],setup(a,{emit:v}){const d=a,g=v;ye(()=>d.isVisible,b=>{});const A=Ve(),S=x(!1),u=x(""),F=x(!1),_=x(!1),P=x(null),se=x(null),Q=x(null),K=x([]),O=x(null),m=x(!1),L=x(!1),$=x(null),V=x(!1),w=x(null),D=x(""),ae=x(null),U=x(!1),p=x(!1),M=x(null),R=()=>{ne(),g("close")},T=b=>{const j=b.target.files[0];if(!j)return;if(!j.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(j.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}P.value=j,K.value=[];const le=new FileReader;le.onload=he=>{se.value=he.target.result;const i=new Image;i.onload=()=>{z(i.width,i.height)},i.src=he.target.result},le.readAsDataURL(j)},z=(b,j)=>{const r=b/j,s=612/612,c=Math.abs(r-s)/s;if(b===612&&j===612){K.value.push("✅ Dimensiones perfectas: 612 × 612 píxeles");return}c<=.1?(K.value.push(`ℹ️ Buenas proporciones detectadas: ${b} × ${j} píxeles (${r.toFixed(3)})`),(b!==612||j!==612)&&K.value.push("💡 Para mejores resultados, usa exactamente 612 × 612 píxeles")):(K.value.push(`⚠️ Proporciones no ideales: ${b} × ${j} píxeles (${r.toFixed(3)})`),K.value.push(`🎯 Proporciones recomendadas: ${s.toFixed(3)} (8.5:11)`),K.value.push("📐 Considera redimensionar tu imagen a 612 × 612 píxeles")),(b<300||j<300)&&K.value.push("⚠️ Imagen muy pequeña - puede verse pixelada en documentos"),(b>1200||j>1600)&&K.value.push("ℹ️ Imagen muy grande - se redimensionará automáticamente")},ne=()=>{P.value=null,se.value=null,K.value=[],m.value=!1,O.value&&(O.value.value="")},X=async()=>{var b;if(P.value){F.value=!0,K.value=[];try{const j=await A.uploadGlobalLetterheadImage(P.value);(b=j.data)!=null&&b.warnings&&j.data.warnings.length>0&&(K.value=j.data.warnings),L.value=!1,await f(),ne(),g("uploaded",j.data)}catch(j){console.error("Error uploading global letterhead:",j),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{F.value=!1}}},f=async()=>{if(!(Q.value===null&&L.value)){L.value=!0;try{const b=await A.getGlobalLetterheadImage();b.data&&(Q.value=URL.createObjectURL(b.data))}catch{Q.value=null}}},N=async()=>{await Nt("¿Estás seguro de que deseas eliminar la imagen de membrete global?")&&G()},G=async()=>{_.value=!0;try{await A.deleteGlobalLetterheadImage(),Q.value&&URL.revokeObjectURL(Q.value),Q.value=null,L.value=!0,g("deleted")}catch(b){console.error("Error deleting global letterhead:",b),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{_.value=!1}},re=b=>{const j=b.target.files[0];if(j){if(!j.name.toLowerCase().endsWith(".docx")){alert("Solo se permiten archivos .docx para la plantilla Word");return}if(j.size>10*1024*1024){alert("El archivo de plantilla no puede ser mayor a 10MB");return}$.value=j}},te=()=>{$.value=null,M.value&&(M.value.value="")},fe=async()=>{var b;if($.value){U.value=!0;try{const le=(b=(await A.uploadGlobalLetterheadWordTemplate($.value)).data)==null?void 0:b.template_info;V.value=!0,D.value=(le==null?void 0:le.filename)||$.value.name,ae.value=(le==null?void 0:le.size_bytes)||$.value.size,await ce(),te()}catch(j){console.error("Error uploading global Word template:",j),alert("Error al subir la plantilla Word. Por favor intenta nuevamente.")}finally{U.value=!1}}},ce=async()=>{var b,j,le;try{const he=await A.getGlobalLetterheadWordTemplate("blob");if(he&&he.data){V.value=!0,w.value&&URL.revokeObjectURL(w.value),w.value=URL.createObjectURL(he.data);const i=((b=he.headers)==null?void 0:b["content-disposition"])||((j=he.headers)==null?void 0:j["Content-Disposition"]);let r="plantilla_word.docx";if(i){const s=i.match(/filename="?([^";]+)"?/i);s&&s[1]&&(r=s[1])}D.value=r,ae.value=he.data.size||null}}catch(he){((le=he.response)==null?void 0:le.status)===404?(V.value=!1,w.value&&URL.revokeObjectURL(w.value),w.value=null,D.value="",ae.value=null):console.error("Error loading global Word template:",he)}},pe=async()=>{await Nt("¿Estás seguro de que deseas eliminar la plantilla Word de membrete global?")&&Ce()},Ce=async()=>{p.value=!0;try{await A.deleteGlobalLetterheadWordTemplate(),w.value&&URL.revokeObjectURL(w.value),w.value=null,D.value="",ae.value=null,V.value=!1}catch(b){console.error("Error deleting global Word template:",b),alert("Error al eliminar la plantilla Word. Por favor intenta nuevamente.")}finally{p.value=!1}},De=()=>{if(w.value){const b=document.createElement("a");b.href=w.value,b.download=D.value||"membrete-word.docx",document.body.appendChild(b),b.click(),document.body.removeChild(b)}},Ne=()=>{if(Q.value){const b=document.createElement("a");b.href=Q.value,b.download="membrete-global.png",document.body.appendChild(b),b.click(),document.body.removeChild(b)}},Le=()=>{Q.value=null},Be=b=>{if(b===0)return"0 Bytes";const j=1024,le=["Bytes","KB","MB","GB"],he=Math.floor(Math.log(b)/Math.log(j));return parseFloat((b/Math.pow(j,he)).toFixed(2))+" "+le[he]};ye(()=>d.isVisible,b=>{b&&(f(),ce())});const Ue=()=>{Q.value&&URL.revokeObjectURL(Q.value),se.value&&URL.revokeObjectURL(se.value),w.value&&URL.revokeObjectURL(w.value)};return Re(()=>{d.isVisible&&f()}),ut(Ue),(b,j)=>Pe((n(),oe(Xe,null,{default:k(()=>[e("div",Xm,[e("div",eg,[tg,sg,e("button",{onClick:R,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[o(t(je),{class:"h-6 w-6"})])]),e("div",og,[S.value?(n(),l("div",ng,[rg,e("p",ag,h(u.value),1)])):(n(),l("div",lg,[Q.value?(n(),l("div",ig,[dg,e("div",cg,[e("img",{src:Q.value,alt:"Membrete de imagen para PDF actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:Le},null,40,ug),e("div",mg,[e("button",{onClick:Ne,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[o(t(tt),{class:"h-4 w-4 mr-2"}),Y(" Descargar ")]),e("button",{onClick:N,disabled:_.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[o(t(Pt),{class:"h-4 w-4 mr-2"}),Y(" "+h(_.value?"Eliminando...":"Eliminar"),1)],8,gg)])])])):(n(),l("div",pg,[o(t(rt),{class:"mx-auto h-12 w-12 text-gray-400"}),hg,fg,vg])),e("div",bg,[e("h3",yg,h(Q.value?"Reemplazar Membrete de imagen para PDF":"Subir Membrete de imagen para PDF"),1),e("div",xg,[e("input",{ref_key:"fileInput",ref:O,type:"file",accept:".png",onChange:T,class:"hidden"},null,544),P.value?(n(),l("div",Cg,[e("div",Dg,[o(t(Lt),{class:"h-5 w-5 text-green-500"}),e("span",null,h(P.value.name),1),e("span",Sg,"("+h(Be(P.value.size))+")",1)]),se.value?(n(),l("div",Fg,[e("img",{src:se.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,Eg)])):E("",!0),e("div",Tg,[e("button",{onClick:ne,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:X,disabled:F.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[F.value?(n(),l("div",Mg)):(n(),oe(t(Qt),{key:0,class:"h-4 w-4 mr-2"})),Y(" "+h(F.value?"Subiendo...":"Subir Imagen para PDF"),1)],8,Ag)])])):(n(),l("div",_g,[o(t(Kt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",wg,[e("button",{onClick:j[0]||(j[0]=le=>b.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG para PDF "),e("button",{onClick:j[1]||(j[1]=le=>m.value=!m.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[o(t(Vt),{class:"h-4 w-4 mr-2"}),Y(" "+h(m.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),$g,kg]))])]),e("div",Pg,[Lg,Ig,V.value?(n(),l("div",jg,[e("div",Bg,[Ug,e("div",zg,[e("span",Ng,h(D.value||"plantilla_word.docx"),1),ae.value?(n(),l("span",Og,"("+h(Be(ae.value))+")",1)):E("",!0)])]),e("div",Rg,[w.value?(n(),l("button",{key:0,onClick:De,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[o(t(tt),{class:"h-4 w-4 mr-2"}),Y(" Descargar ")])):E("",!0),e("button",{onClick:pe,disabled:p.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[o(t(Pt),{class:"h-4 w-4 mr-2"}),Y(" "+h(p.value?"Eliminando...":"Eliminar"),1)],8,qg)])])):(n(),l("div",Vg," No tienes una plantilla Word configurada. Puedes subir un archivo .docx con tu membrete. ")),e("div",Qg,[e("input",{ref_key:"wordTemplateInput",ref:M,type:"file",accept:".docx",onChange:re,class:"hidden"},null,544),$.value?(n(),l("div",Zg,[e("div",Jg,[o(t(Lt),{class:"h-5 w-5 text-green-500"}),e("span",null,h($.value.name),1),e("span",Kg,"("+h(Be($.value.size))+")",1)]),e("div",Yg,[e("button",{onClick:te,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:fe,disabled:U.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[U.value?(n(),l("div",e0)):(n(),oe(t(Qt),{key:0,class:"h-4 w-4 mr-2"})),Y(" "+h(U.value?"Subiendo...":"Subir Plantilla"),1)],8,Xg)])])):(n(),l("div",Wg,[o(t(rt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Gg,[e("button",{onClick:j[2]||(j[2]=le=>b.$refs.wordTemplateInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Plantilla .docx (Word) ")]),Hg]))])]),m.value?(n(),l("div",t0,[e("div",s0,[o(t(Vt),{class:"h-6 w-6 text-blue-600"}),o0]),n0,r0,a0,l0,i0])):E("",!0),K.value.length>0?(n(),l("div",d0,[(n(!0),l(de,null,me(K.value,(le,he)=>(n(),l("div",{key:he,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",c0,[o(t(xs),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",u0,h(le),1)])]))),128))])):E("",!0)]))])])]),_:1},512)),[[Dt,a.isVisible]])}},g0=yt(m0,[["__scopeId","data-v-b59f9884"]]),p0={class:"min-h-screen bg-gray-50"},h0={class:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8"},f0={class:"p-4 sm:p-6 lg:p-8"},v0={key:0},b0={class:"mb-6 border-b border-gray-200"},y0={class:"hidden md:block"},x0={class:"flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8 mb-4","aria-label":"Tabs"},_0=["onClick"],w0={class:"flex gap-3"},$0=["disabled"],k0=e("span",null,"Firma Electrónica",-1),C0=e("span",null,"Membrete Global",-1),D0=e("span",null,"Nueva Minuta",-1),S0={class:"md:hidden space-y-3 relative"},F0=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),E0=[F0],T0={key:0,class:"absolute z-20 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden w-full"},A0=["onClick"],M0={class:"grid grid-cols-3 gap-2"},P0=["disabled"],L0=e("span",{class:"font-medium text-xs leading-tight"},"Firma",-1),I0=e("span",{class:"font-medium text-xs leading-tight"},"Membrete",-1),j0=e("span",{class:"font-medium text-xs leading-tight"},"Nueva",-1),B0={key:0},U0={key:1},z0={key:2},N0={key:3},O0={key:4},R0={key:5,class:"mt-6 text-center text-gray-400 font-regular"},q0=e("p",null,"No hay documentos disponibles para mostrar.",-1),V0=[q0],Q0={key:1},W0={class:"mb-6 border-b border-gray-200"},G0={class:"hidden md:flex items-center justify-between"},H0={class:"-mb-px flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},Z0=["onClick"],J0={class:"flex items-center gap-2 mb-4"},K0={class:"relative group"},Y0=["disabled"],X0={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},ep=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),tp={class:"relative group"},sp=["disabled"],op={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},np=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),rp={class:"md:hidden relative"},ap=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),lp=[ap],ip={key:0,class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},dp=["onClick"],cp={class:"md:hidden mt-4 mb-4 flex flex-col gap-2"},up={class:"relative group"},mp=["disabled"],gp={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},pp=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),hp={class:"relative group"},fp=["disabled"],vp={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},bp=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),yp={key:0},xp={key:1},_p={class:"p-4 sm:p-6"},wp={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},$p={class:"flex justify-between items-center p-4 border-b"},kp=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),Cp={class:"p-4 sm:p-6"},Dp={class:"p-4 sm:p-6"},Sp={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},Fp={class:"flex justify-between items-center p-4 border-b"},Ep=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),Tp={class:"p-4 sm:p-6"},rh={__name:"Dashboard",setup(a){const v=Je(),d=Ve(),g=Bt(),A=et(),S=ds(),{isBasicUser:u,handleFeatureAccess:F}=Ut(),_=x(""),P=x("default"),se=x(!1),Q=x("folders"),K=x("legal-documents"),O=x(!1),m=x(!1),L=x(!1),$=x(!1),V=x(!1),w=x(null),D=x([]),ae=x("recent");ye(K,(b,j)=>{},{immediate:!0}),B(()=>[]),B(()=>ae.value==="recent"?"Más recientes":"Nombre (A-Z)");const U=B(()=>v.currentUser),p=B(()=>U.value?U.value.role:(A.push("/login"),null)),M=B(()=>{let b=[];p.value==="lawyer"?b=d.draftAndPublishedDocumentsUnassigned:(p.value==="client"||p.value==="basic"||p.value==="corporate_client")&&(b=d.progressAndCompletedDocumentsByClient(U.value.id));const j=D.value&&Array.isArray(D.value)?D.value.map(le=>le.id):[];return d.filteredDocumentsBySearchAndTags(_.value,v,j).filter(le=>b.some(he=>he.id===le.id))}),R=async b=>{P.value=b,d.selectedDocument=null;try{await d.init(!0)}catch(j){console.error("Error loading documents for useDocument section:",j)}},T=()=>{se.value=!1,P.value="default",d.selectedDocument=null},z=async()=>{await d.init(!0)},ne=()=>{if(!U.value){console.error("Cannot open signature modal: currentUser is not loaded");return}m.value=!0},X=()=>{if(!U.value){console.error("Cannot open signature modal: currentUser is not loaded");return}F("Firma Electrónica",()=>{O.value=!0})},f=async b=>{K.value="signed-documents"},N=async b=>{Q.value="signed-documents"},G=()=>{if(!U.value){console.error("Cannot open letterhead modal: currentUser is not loaded");return}F("Membrete Global",()=>{L.value=!0})},re=b=>{ke("Membrete global subido correctamente","success")},te=()=>{ke("Membrete global eliminado correctamente","success")},fe=async()=>{if(P.value==="useDocument"){P.value="default",Q.value="my-documents";return}Q.value="folders";try{await new Promise(b=>setTimeout(b,100)),await g.fetchFolders(!0)}catch{}};ye(()=>d.lastUpdatedDocumentId,(b,j)=>{if(b&&b!==j&&P.value==="default"){const le=Date.now();(!ye.lastExecutionTime||le-ye.lastExecutionTime>100)&&(ye.lastExecutionTime=le,P.value="default")}},{immediate:!1}),ye($,b=>{}),ye(V,b=>{}),ye(w,b=>{}),ye(()=>S.path,(b,j)=>{b==="/dynamic_document_dashboard"&&j&&j.includes("/document/use/")&&d.init()}),ye(()=>S.query,b=>{b.lawyerTab&&(K.value=b.lawyerTab),b.tab&&(Q.value=b.tab)},{immediate:!0});const ce=[{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"}],pe=[{name:"legal-documents",label:"Minutas"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"finished-documents",label:"Dcs. Clientes"},{name:"in-progress-documents",label:"Dcs. Clientes en Progreso"}],Ce=x(!1),De=x(!1),Ne=()=>{Ce.value=!1,De.value=!1},Le=b=>{K.value=b,Ce.value=!1,Ne()},Be=b=>{Q.value=b,De.value=!1,Ne()};Re(async()=>{await v.init(),await d.init(),await g.init(),d.selectedDocument=null,P.value="default";const b=localStorage.getItem("lastUpdatedDocumentId");b&&d.documents.some(le=>le.id.toString()===b)&&(d.lastUpdatedDocumentId=parseInt(b))});const Ue=async b=>{v.currentUser&&(v.currentUser.has_signature=!0),ke("Firma electrónica guardada correctamente","success"),setTimeout(()=>{m.value=!1,O.value=!1},500)};return(b,j)=>{var le,he;return n(),l(de,null,[e("div",p0,[e("div",h0,[Ht(b.$slots,"default")]),e("div",f0,[p.value==="lawyer"?(n(),l("div",v0,[e("div",b0,[e("div",y0,[e("nav",x0,[(n(),l(de,null,me(pe,i=>e("button",{key:i.name,onClick:ve(r=>Le(i.name),["stop"]),class:C([K.value===i.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},h(i.label),11,_0)),64))]),e("div",w0,[e("button",{onClick:ve(ne,["stop"]),disabled:!U.value,class:C(["inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-purple-200 text-sm font-medium transition-all duration-200",U.value?"bg-white text-gray-700 hover:bg-purple-50 hover:border-purple-300":"bg-gray-50 text-gray-400 cursor-not-allowed opacity-60"])},[o(t(wt),{class:"size-5 text-purple-500"}),k0],10,$0),e("button",{onClick:j[0]||(j[0]=ve(i=>L.value=!0,["stop"])),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-green-200 bg-white text-sm font-medium text-gray-700 hover:bg-green-50 hover:border-green-300 transition-all duration-200"},[o(t(Qe),{class:"size-5 text-green-500"}),C0]),e("button",{onClick:j[1]||(j[1]=ve(i=>se.value=!0,["stop"])),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-secondary bg-secondary text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200"},[o(t(Ye),{class:"size-5"}),D0])])]),e("div",S0,[e("button",{onClick:j[2]||(j[2]=ve(i=>Ce.value=!Ce.value,["stop"])),class:"dropdown-button w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,h(((le=pe.find(i=>i.name===K.value))==null?void 0:le.label)||"Seleccionar sección"),1),(n(),l("svg",{class:C(["ml-2 h-5 w-5 transition-transform duration-200",Ce.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},E0,2))]),Ce.value?(n(),l("div",T0,[(n(),l(de,null,me(pe,i=>e("button",{key:i.name,onClick:ve(r=>Le(i.name),["stop"]),class:C(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",K.value===i.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},h(i.label),11,A0)),64))])):E("",!0),e("div",M0,[e("button",{onClick:ve(ne,["stop"]),disabled:!U.value,class:C(["flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-purple-200 text-center transition-all duration-200",U.value?"bg-white hover:bg-purple-50":"bg-gray-50 cursor-not-allowed opacity-60"])},[o(t(wt),{class:"size-6 text-purple-500 mb-1"}),L0],10,P0),e("button",{onClick:j[3]||(j[3]=ve(i=>L.value=!0,["stop"])),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-green-200 bg-white text-center transition-all duration-200 hover:bg-green-50"},[o(t(Qe),{class:"size-6 text-green-500 mb-1"}),I0]),e("button",{onClick:j[4]||(j[4]=ve(i=>se.value=!0,["stop"])),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-secondary bg-secondary text-white text-center transition-all duration-200 hover:bg-blue-700"},[o(t(Ye),{class:"size-6 mb-1"}),j0])])])]),K.value==="legal-documents"?(n(),l("div",B0,[o(id,{searchQuery:_.value,selectedTags:D.value},null,8,["searchQuery","selectedTags"])])):E("",!0),K.value==="pending-signatures"?(n(),l("div",U0,[o($t,{state:"PendingSignatures",searchQuery:_.value,selectedTags:D.value,onOpenElectronicSignature:ne,onDocumentFullySigned:f},null,8,["searchQuery","selectedTags"])])):E("",!0),K.value==="signed-documents"?(n(),l("div",z0,[o($t,{state:"FullySigned",searchQuery:_.value,selectedTags:D.value,onOpenElectronicSignature:ne},null,8,["searchQuery","selectedTags"])])):E("",!0),K.value==="finished-documents"?(n(),l("div",N0,[o(bc,{searchQuery:_.value,selectedTags:D.value},null,8,["searchQuery","selectedTags"])])):E("",!0),K.value==="in-progress-documents"?(n(),l("div",O0,[o(Fu,{searchQuery:_.value,selectedTags:D.value},null,8,["searchQuery","selectedTags"])])):E("",!0),M.value.length===0?(n(),l("div",R0,V0)):E("",!0)])):E("",!0),p.value==="client"||p.value==="basic"||p.value==="corporate_client"?(n(),l("div",Q0,[e("div",W0,[e("div",G0,[e("nav",H0,[(n(),l(de,null,me(ce,i=>e("button",{key:i.name,onClick:ve(r=>Be(i.name),["stop"]),class:C([Q.value===i.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},h(i.label),11,Z0)),64))]),e("div",J0,[e("div",K0,[e("button",{onClick:ve(X,["stop"]),disabled:t(u),class:C(["inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border",t(u)?"text-purple-400 bg-gray-50 border-gray-200 cursor-not-allowed opacity-60":"text-purple-600 hover:bg-purple-50 border-purple-200"])},[o(t(wt),{class:"h-4 w-4"}),Y(" Firma Electrónica ")],10,Y0),t(u)?(n(),l("div",X0,[Y(" Actualiza tu suscripción para usar esta funcionalidad "),ep])):E("",!0)]),e("div",tp,[e("button",{onClick:ve(G,["stop"]),disabled:t(u),class:C(["inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border",t(u)?"text-green-400 bg-gray-50 border-gray-200 cursor-not-allowed opacity-60":"text-green-600 hover:bg-green-50 border-green-200"])},[o(t(Qe),{class:"h-4 w-4"}),Y(" Membrete Global ")],10,sp),t(u)?(n(),l("div",op,[Y(" Actualiza tu suscripción para usar esta funcionalidad "),np])):E("",!0)]),e("button",{onClick:j[5]||(j[5]=ve(i=>R("useDocument"),["stop"])),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[o(t(Ye),{class:"h-4 w-4"}),Y(" Nuevo Documento ")])])]),e("div",rp,[e("button",{onClick:j[6]||(j[6]=ve(i=>De.value=!De.value,["stop"])),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,h(((he=ce.find(i=>i.name===Q.value))==null?void 0:he.label)||"Seleccionar sección"),1),(n(),l("svg",{class:C(["ml-2 h-5 w-5 transition-transform duration-200",De.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},lp,2))]),De.value?(n(),l("div",ip,[(n(),l(de,null,me(ce,i=>e("button",{key:i.name,onClick:ve(r=>Be(i.name),["stop"]),class:C(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",Q.value===i.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},h(i.label),11,dp)),64))])):E("",!0)]),e("div",cp,[e("div",up,[e("button",{onClick:ve(X,["stop"]),disabled:t(u),class:C(["w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors",t(u)?"text-purple-400 bg-gray-50 cursor-not-allowed opacity-60":"text-purple-600 bg-purple-50 hover:bg-purple-100"])},[o(t(wt),{class:"h-5 w-5"}),Y(" Firma Electrónica ")],10,mp),t(u)?(n(),l("div",gp,[Y(" Actualiza tu suscripción para usar esta funcionalidad "),pp])):E("",!0)]),e("div",hp,[e("button",{onClick:ve(G,["stop"]),disabled:t(u),class:C(["w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors",t(u)?"text-green-400 bg-gray-50 cursor-not-allowed opacity-60":"text-green-600 bg-green-50 hover:bg-green-100"])},[o(t(Qe),{class:"h-5 w-5"}),Y(" Membrete Global ")],10,fp),t(u)?(n(),l("div",vp,[Y(" Actualiza tu suscripción para usar esta funcionalidad "),bp])):E("",!0)]),e("button",{onClick:j[7]||(j[7]=ve(i=>R("useDocument"),["stop"])),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[o(t(Ye),{class:"h-5 w-5"}),Y(" Nuevo Documento ")])])]),P.value==="useDocument"?(n(),l("div",yp,[o(Wl,{searchQuery:_.value,selectedTags:D.value,onGoBack:fe},null,8,["searchQuery","selectedTags"])])):(n(),l("div",xp,[Q.value==="folders"?(n(),oe(Hr,{key:0,searchQuery:_.value,selectedTags:D.value,onRefresh:z,onNavigateToMain:fe},null,8,["searchQuery","selectedTags"])):Q.value==="my-documents"?(n(),oe(dl,{key:1,searchQuery:_.value,selectedTags:D.value,onRefresh:z},null,8,["searchQuery","selectedTags"])):Q.value==="pending-signatures"?(n(),oe($t,{key:2,state:"PendingSignatures",searchQuery:_.value,selectedTags:D.value,onRefresh:z,onOpenElectronicSignature:X,onDocumentFullySigned:N},null,8,["searchQuery","selectedTags"])):Q.value==="signed-documents"?(n(),oe($t,{key:3,state:"FullySigned",searchQuery:_.value,selectedTags:D.value,onRefresh:z,onOpenElectronicSignature:X},null,8,["searchQuery","selectedTags"])):E("",!0)]))])):E("",!0)])]),se.value?(n(),oe(Xe,{key:0},{default:k(()=>[o(Ym,{onClose:T})]),_:1})):E("",!0),m.value&&U.value?(n(),oe(Xe,{key:1},{default:k(()=>[e("div",_p,[e("div",wp,[e("div",$p,[kp,e("button",{onClick:j[8]||(j[8]=i=>m.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[o(t(je),{class:"h-6 w-6"})])]),e("div",Cp,[o(zt,{"user-id":U.value.id,"initial-show-options":!U.value.has_signature,onSignatureSaved:Ue,onCancel:j[9]||(j[9]=i=>m.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):E("",!0),O.value&&U.value?(n(),oe(Xe,{key:2},{default:k(()=>[e("div",Dp,[e("div",Sp,[e("div",Fp,[Ep,e("button",{onClick:j[10]||(j[10]=i=>O.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[o(t(je),{class:"h-6 w-6"})])]),e("div",Tp,[o(zt,{"user-id":U.value.id,"initial-show-options":!U.value.has_signature,onSignatureSaved:Ue,onCancel:j[11]||(j[11]=i=>O.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):E("",!0),o(jt,{isVisible:t(nt),documentData:t(It),onClose:j[12]||(j[12]=i=>nt.value=!1)},null,8,["isVisible","documentData"]),o(g0,{isVisible:L.value,onClose:j[13]||(j[13]=i=>L.value=!1),onUploaded:re,onDeleted:te},null,8,["isVisible"])],64)}}};export{rh as default};
