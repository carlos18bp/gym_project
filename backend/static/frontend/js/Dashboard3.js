import{e as n,f as i,g as e,u as et,r as v,aJ as Gt,o as Oe,ar as ut,c as L,h as o,j as t,G as Ue,w as Pe,v as Re,n as $,l as D,t as p,m as fe,p as oe,s as De,b4 as ts,i as _,ac as Ge,a9 as Ht,b5 as ss,Q as mt,k as re,a2 as Ke,F as de,D as Dt,E as os,b6 as ns,a0 as rs,C as ls,T as we,N as me,I as Je,a1 as Qe,ag as Te,ad as Ae,ae as Me,af as ue,b7 as as,O as gt,P as pt,a5 as is,ah as tt,aX as ds,ai as ht,b8 as ft,ab as cs,b9 as $t,ba as zt}from"./index.js";import{u as qe,o as us,s as nt,p as It}from"./index2.js";import{g as dt,a as ct}from"./DocumentPermissionsManager.js";import{B as ms,r as gs,a as ps,b as vt,c as bt,d as St,e as Et,L as yt,f as Ft,_ as jt,D as Zt,g as hs,s as Nt}from"./index3.js";import{_ as xt}from"./_plugin-vue_export-helper.js";import{r as Ct}from"./FolderIcon.js";import{r as Xe}from"./PlusIcon.js";import{r as ot}from"./EllipsisVerticalIcon.js";import{r as rt}from"./DocumentIcon.js";import{_ as fs}from"./DocumentCard.js";import{r as Jt}from"./EyeIcon.js";import{r as lt}from"./ChevronRightIcon.js";import{_ as Ot}from"./SignatureDocumentCard.js";import{r as Rt,a as vs,b as bs}from"./TagIcon.js";import{r as Ne}from"./ChevronDownIcon.js";import{r as He}from"./MagnifyingGlassIcon.js";import{r as qt}from"./PencilIcon.js";import{r as Pt}from"./TrashIcon.js";import{r as ys}from"./LinkIcon.js";import{r as Kt}from"./PhotoIcon.js";import{r as Lt}from"./CheckCircleIcon.js";import{r as st,a as at}from"./FunnelIcon.js";import{r as xs}from"./ArrowLeftIcon.js";import{r as Vt}from"./InformationCircleIcon.js";import{r as Qt}from"./CloudArrowUpIcon.js";import{r as _s}from"./ExclamationTriangleIcon.js";import"./useRecentViews.js";import"./loading_message.js";function Wt(a,h){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})])}function ws(a,h){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})])}function $s(a,h){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})])}const ks={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Cs={class:"flex justify-end"},Ds=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[oe(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),Ss={class:"mt-2"},Es={class:"flex gap-2 mt-2.5"},Fs=["disabled"],Ts=e("span",null,"Actualizar nombre",-1),As=[Ts],Ms=["disabled"],Yt={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(a,{emit:h}){const d=a,c=et(),E=qe(),k=h,u=v(""),C=v(""),y=()=>{k("close")};Gt(()=>{var A,b;E.selectedDocument?(u.value=((A=E.selectedDocument)==null?void 0:A.title)||"",C.value=((b=E.selectedDocument)==null?void 0:b.title)||""):(u.value="",C.value="")});const F=A=>{A.key==="Escape"&&y()};Oe(()=>{document.addEventListener("keydown",F)}),ut(()=>{document.removeEventListener("keydown",F)});const te=L(()=>u.value.trim().length>0),H=L(()=>{var A;return!!((A=E.selectedDocument)!=null&&A.id)}),X=L(()=>H.value&&u.value.trim()!==C.value.trim()&&u.value.trim().length>0);async function U(){if(H.value&&X.value)try{const A={title:u.value.trim()};await E.updateDocument(E.selectedDocument.id,A),C.value=u.value.trim(),E.selectedDocument.title=u.value.trim();const b=E.selectedDocument.id;De("Document name successfully updated.","success"),k("close",{updatedDocId:b});const x=window.location.pathname;x==="/dynamic_document_dashboard"||x==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(A){console.error("Error updating document name:",A),De("Error updating document name.","error")}}function m(){const A=encodeURIComponent(u.value.trim());d.documentId&&!E.selectedDocument?c.push(`/dynamic_document_dashboard/document/use/creator/${d.documentId}/${A}`):E.selectedDocument?(E.selectedDocument.title=u.value.trim(),c.push(`/dynamic_document_dashboard/document/use/editor/${E.selectedDocument.id}/${A}`)):De("Error: No se pudo continuar. Documento no seleccionado.","error")}return(A,b)=>(n(),i("div",ks,[e("div",Cs,[e("button",{onClick:y},[o(t(Ue),{class:"size-6"})])]),e("form",{onSubmit:fe(m,["prevent"])},[e("div",null,[Ds,e("div",Ss,[Pe(e("input",{"onUpdate:modelValue":b[0]||(b[0]=q=>u.value=q),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[Re,u.value]])])]),e("div",Es,[H.value?(n(),i("button",{key:0,type:"button",onClick:U,disabled:!X.value,class:$(["p-2.5 text-sm font-medium rounded-md flex gap-2",X.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},As,10,Fs)):D("",!0),e("button",{type:"submit",class:$(["p-2.5 text-sm font-medium rounded-md flex gap-2",te.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!te.value},[e("span",null,p(H.value?"Editar Documento":"Continuar"),1)],10,Ms)])],32)]))}},Ps={class:"mt-3 pt-2 border-t border-gray-100"},Ls={class:"flex items-center gap-2 text-xs text-gray-500"},Is=e("span",null,"Hacer clic para usar este documento",-1),js={__name:"UseDocumentCard",props:{document:{type:Object,required:!0},showTags:{type:Boolean,default:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null}},emits:["click","remove-from-folder","document-created"],setup(a,{emit:h}){const d=a,c=h,E=v(!1),k=v(null),u=dt(9),C=L(()=>"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium !bg-purple-100 !text-purple-700 !border !border-purple-200"),y=L(()=>u.dark),F=L(()=>"group !border-purple-400 !bg-purple-50/50 !shadow-purple-100"),te=L(()=>d.menuOptions!==null?d.menuOptions:[{label:"Usar",action:"use",icon:ws,iconClasses:"w-4 h-4 text-purple-600"},{label:"Previsualización",action:"preview",icon:Jt,iconClasses:"w-4 h-4 text-gray-600"}]),H=L(()=>!1),X=(b,q)=>{d.disableInternalActions?c("click",b,q):m(b.id)},U=(b,q)=>{switch(b){case"use":m(q.id);break;case"preview":us(q);break;default:console.warn("Unknown menu action:",b)}};function m(b){b?(k.value=b,E.value=!0):console.error("Document ID is required:",b)}function A(b){if(E.value=!1,k.value=null,b&&b.updatedDocId){c("document-created",b);const q=window.location.pathname;q==="/dynamic_document_dashboard"||q==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(b.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}}return(b,q)=>(n(),i(de,null,[o(ms,{document:a.document,"card-type":a.cardType,"card-context":a.cardContext,"status-icon":t(ss),"status-text":"Disponible","status-badge-classes":C.value,"menu-options":te.value,"highlighted-doc-id":null,"show-tags":a.showTags,"document-store":a.documentStore,"user-store":a.userStore,"additional-classes":F.value,"disable-internal-actions":a.disableInternalActions,"show-menu-options":a.showMenuOptions,onClick:X,onMenuAction:U,onRemoveFromFolder:q[0]||(q[0]=x=>b.$emit("remove-from-folder",x))},ts({"additional-actions":_(()=>[Ht(b.$slots,"additional-actions")]),_:2},[H.value?{name:"right-action",fn:_(()=>[o(t(lt),{class:"w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors"})]),key:"0"}:void 0,a.disableInternalActions?void 0:{name:"footer",fn:_(()=>[e("div",Ps,[e("div",Ls,[e("div",{class:"w-2 h-2 rounded-full",style:Ge({backgroundColor:y.value})},null,4),Is])])]),key:"1"}]),1032,["document","card-type","card-context","status-icon","status-badge-classes","menu-options","show-tags","document-store","user-store","additional-classes","disable-internal-actions","show-menu-options"]),Pe(o(Ke,null,{default:_(()=>[k.value!==null?(n(),re(Yt,{key:0,"document-id":k.value,onClose:A},null,8,["document-id"])):D("",!0)]),_:1},512),[[mt,E.value]])],64))}},Bs=()=>({folders:[],currentFolder:null,isLoading:!1,error:null,lastUpdatedFolderId:null}),Us={sortedFolders:a=>[...a.folders].sort((h,d)=>new Date(d.created_at)-new Date(h.created_at)),getFolderById:a=>h=>a.folders.find(d=>d.id===h),getFoldersByColor:a=>h=>a.folders.filter(d=>d.color_id===h),getFolderWithColor:a=>h=>{const d=a.folders.find(c=>c.id===h);return d?{...d,color:dt(d.color_id)}:null},getFoldersContainingDocument:a=>h=>a.folders.filter(d=>d.document_ids&&d.document_ids.includes(h)),totalDocumentsInFolders:a=>a.folders.reduce((h,d)=>h+(d.document_ids?d.document_ids.length:0),0),hasFolders:a=>a.folders.length>0,availableColors:()=>ct()},zs={async init(a=!1){if(!(this.folders.length>0&&!a)){this.isLoading=!0,this.error=null;try{await this.fetchFolders()}catch(h){console.error("Error initializing document folder store:",h),this.error="Error al inicializar las carpetas"}finally{this.isLoading=!1}}},async fetchFolders(){try{const a=await Dt("dynamic-documents/folders/");if(a.status===200)return this.folders=a.data,a.data;throw new Error(`Error fetching folders: ${a.status}`)}catch(a){throw console.error("Error fetching folders:",a),this.error="Error al obtener las carpetas",a}},async fetchFolder(a){this.isLoading=!0,this.error=null;try{const h=await Dt(`dynamic-documents/folders/${a}/`);if(h.status===200){const d=h.data,c=this.folders.findIndex(E=>E.id===d.id);return c!==-1?this.folders[c]=d:this.folders.push(d),this.currentFolder=d,d}else throw new Error(`Error fetching folder: ${h.status}`)}catch(h){throw console.error("Error fetching folder:",h),this.error="Error al obtener la carpeta",h}finally{this.isLoading=!1}},async createFolder(a){this.isLoading=!0,this.error=null;try{if(!a.name||a.name.trim()==="")throw new Error("El nombre de la carpeta es requerido");const h=a.color_id??0;if(h<0||h>=ct().length)throw new Error("Color de carpeta no válido");const d={name:a.name.trim(),color_id:h,...a.document_ids&&{document_ids:a.document_ids}},c=await os("dynamic-documents/folders/create/",d);if(c.status===200||c.status===201){const E=c.data;return this.folders.push(E),this.lastUpdatedFolderId=E.id,De("Carpeta creada exitosamente","success"),E}else throw new Error(`Error creating folder: ${c.status}`)}catch(h){throw console.error("Error creating folder:",h),this.error=h.message||"Error al crear la carpeta",De(this.error,"error"),h}finally{this.isLoading=!1}},async updateFolder(a,h){this.isLoading=!0,this.error=null;try{if(h.name&&h.name.trim()==="")throw new Error("El nombre de la carpeta no puede estar vacío");if(h.color_id!==void 0){const E=h.color_id;if(E<0||E>=ct().length)throw new Error("Color de carpeta no válido")}const d={};h.name&&(d.name=h.name.trim()),h.color_id!==void 0&&(d.color_id=h.color_id),h.document_ids!==void 0&&(d.document_ids=h.document_ids);const c=await ns(`dynamic-documents/folders/${a}/update/`,d);if(c.status===200){const E=c.data,k=this.folders.findIndex(u=>u.id===a);return k!==-1&&(this.folders[k]=E),this.currentFolder&&this.currentFolder.id===a&&(this.currentFolder=E),this.lastUpdatedFolderId=a,De("Carpeta actualizada exitosamente","success"),E}else throw new Error(`Error updating folder: ${c.status}`)}catch(d){throw console.error("Error updating folder:",d),this.error=d.message||"Error al actualizar la carpeta",De(this.error,"error"),d}finally{this.isLoading=!1}},async deleteFolder(a){this.isLoading=!0,this.error=null;try{const h=await rs(`dynamic-documents/folders/${a}/delete/`);if(h.status===204||h.status===200)return this.folders=this.folders.filter(d=>d.id!==a),this.currentFolder&&this.currentFolder.id===a&&(this.currentFolder=null),await De("Carpeta eliminada exitosamente","success"),!0;throw new Error(`Error deleting folder: ${h.status}`)}catch(h){throw console.error("Error deleting folder:",h),this.error=h.message||"Error al eliminar la carpeta",await De(this.error,"error"),h}finally{this.isLoading=!1}},setCurrentFolder(a){this.currentFolder=a},clearCurrentFolder(){this.currentFolder=null},reset(){this.folders=[],this.currentFolder=null,this.isLoading=!1,this.error=null,this.lastUpdatedFolderId=null}},Ns={async addDocumentsToFolder(a,h){const d=this.getFolderById(a);if(!d)throw new Error("Carpeta no encontrada");const c=d.document_ids||[],E=[...new Set([...c,...h])];return await this.updateFolder(a,{document_ids:E})},async removeDocumentsFromFolder(a,h){const d=this.getFolderById(a);if(!d)throw new Error("Carpeta no encontrada");const E=(d.document_ids||[]).filter(k=>!h.includes(k));return await this.updateFolder(a,{document_ids:E})},async moveDocumentsBetweenFolders(a,h,d){try{h&&await this.removeDocumentsFromFolder(h,a),d&&await this.addDocumentsToFolder(d,a),await De("Documentos movidos exitosamente","success")}catch(c){throw console.error("Error moving documents between folders:",c),await De("Error al mover documentos","error"),c}},getFolderColor(a){const h=this.getFolderById(a);return h?dt(h.color_id):dt(0)},validateFolderData(a){const h=[];if((!a.name||a.name.trim()==="")&&h.push("El nombre de la carpeta es requerido"),a.name&&a.name.length>100&&h.push("El nombre de la carpeta no puede exceder 100 caracteres"),a.color_id!==void 0){const d=a.color_id;(d<0||d>=ct().length)&&h.push("Color de carpeta no válido")}return a.document_ids&&!Array.isArray(a.document_ids)&&h.push("Los IDs de documentos deben ser un array"),{isValid:h.length===0,errors:h}}},Bt=ls("documentFolder",{state:Bs,getters:Us,actions:{...zs,...Ns}}),Os={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Rs={class:"bg-white rounded-xl shadow-xl max-w-md w-full"},qs={class:"flex justify-between items-center p-6 border-b"},Vs={class:"text-lg font-semibold text-gray-900"},Qs={class:"mb-4"},Ws=e("label",{for:"folderName",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la carpeta ",-1),Gs={class:"mb-6"},Hs=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Color de la carpeta ",-1),Zs={class:"grid grid-cols-8 gap-2"},Js=["onClick","title"],Ks={class:"flex gap-3"},Ys=["disabled"],Xs={__name:"CreateEditFolderModal",props:{isVisible:{type:Boolean,required:!0},editingFolder:{type:Object,default:null}},emits:["close","success"],setup(a,{emit:h}){const d=a,c=h,E=Bt(),k=v(!1),u=v({name:"",color_id:0}),C=L(()=>ct()),y=()=>{u.value={name:"",color_id:0}};we(()=>d.editingFolder,H=>{H?u.value={name:H.name,color_id:H.color_id}:y()},{immediate:!0}),we(()=>d.isVisible,H=>{H||y()});const F=()=>{c("close")},te=async()=>{if(u.value.name.trim()){k.value=!0;try{d.editingFolder?await E.updateFolder(d.editingFolder.id,u.value):await E.createFolder(u.value),k.value=!1,c("success")}catch{k.value=!1}}};return(H,X)=>a.isVisible?(n(),re(Ke,{key:0},{default:_(()=>[e("div",Os,[e("div",Rs,[e("div",qs,[e("h3",Vs,p(a.editingFolder?"Editar Carpeta":"Nueva Carpeta"),1),e("button",{onClick:F,class:"text-gray-400 hover:text-gray-500"},[o(t(Ue),{class:"w-6 h-6"})])]),e("form",{onSubmit:fe(te,["prevent"]),class:"p-6"},[e("div",Qs,[Ws,Pe(e("input",{id:"folderName","onUpdate:modelValue":X[0]||(X[0]=U=>u.value.name=U),type:"text",required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ej: Contratos Laborales"},null,512),[[Re,u.value.name]])]),e("div",Gs,[Hs,e("div",Zs,[(n(!0),i(de,null,me(C.value,U=>(n(),i("button",{key:U.id,type:"button",onClick:m=>u.value.color_id=U.id,class:$(["w-8 h-8 rounded-full border-2 transition-all",u.value.color_id===U.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"]),style:Ge({backgroundColor:U.hex}),title:U.name},null,14,Js))),128))])]),e("div",Ks,[e("button",{type:"button",onClick:F,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:!u.value.name.trim()||k.value,class:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},p(k.value?"Guardando...":a.editingFolder?"Actualizar":"Crear"),9,Ys)])],32)])])]),_:1})):D("",!0)}},eo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},to={class:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col"},so={class:"border-b px-6 py-4 flex-shrink-0"},oo={class:"flex justify-between items-center"},no={class:"flex items-center gap-3"},ro={class:"text-xl font-semibold text-gray-900"},lo={class:"text-sm text-gray-600"},ao={class:"flex items-center gap-2"},io={class:"flex-1 overflow-y-auto p-6"},co={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},uo={class:"min-w-full divide-y divide-gray-200"},mo=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tipo "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),go={class:"bg-white divide-y divide-gray-200"},po=["onClick"],ho={class:"px-6 py-4 whitespace-nowrap"},fo={class:"flex items-center"},vo={class:"flex-shrink-0 h-10 w-10"},bo={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},yo={class:"ml-4"},xo={class:"text-sm font-medium text-gray-900"},_o={class:"px-6 py-4 whitespace-nowrap"},wo={class:"text-sm text-gray-600"},$o={class:"px-6 py-4 whitespace-nowrap"},ko={class:"px-6 py-4 whitespace-nowrap"},Co={class:"flex flex-wrap gap-1"},Do={key:0,class:"text-sm text-gray-400"},So={class:"py-1"},Eo=["onClick"],Fo=["onClick"],To={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Ao=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"Esta carpeta está vacía",-1),Mo=e("p",{class:"text-gray-600 mb-4"},"Agrega documentos para organizar tu trabajo",-1),Po={__name:"FolderDetailsModalTable",props:{folder:{type:Object,default:null}},emits:["close","add-documents","remove-document","view-document","use-document","document-action"],setup(a,{emit:h}){const d=a,c=h;Je(),qe();const E=v({}),k=v({}),u=v(!1),C=v(-1),y=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],F=L(()=>{if(!d.folder)return y[0];if(d.folder.color)return y.find(T=>T.name===d.folder.color)||y[0];const g=d.folder.id%y.length;return y[g]}),te=g=>g.state==="Published"||g.state==="Draft"?"Formato":g.state==="PendingSignatures"||g.state==="FullySigned"?"Para Firmar":g.state==="Progress"||g.state==="Completed"?"Mis Documentos":"Documento",H=g=>({Published:"Publicado",Draft:"Borrador",Progress:"En Progreso",Completed:"Completado",PendingSignatures:"Pendiente Firma",FullySigned:"Firmado"})[g.state]||g.state,X=g=>({Published:"bg-green-100 text-green-700 border border-green-200",Draft:"bg-gray-100 text-gray-700 border border-gray-200",Progress:"bg-blue-100 text-blue-700 border border-blue-200",Completed:"bg-green-100 text-green-700 border border-green-200",PendingSignatures:"bg-yellow-100 text-yellow-700 border border-yellow-200",FullySigned:"bg-green-100 text-green-700 border border-green-200"})[g.state]||"bg-gray-100 text-gray-700 border border-gray-200",U=g=>{const T=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],z=g.id%T.length;return T[z]},m=()=>{c("close")},A=()=>{c("add-documents",d.folder)},b=g=>{c("remove-document",{folderId:d.folder.id,documentId:g.id})},q=g=>{const T=te(g);c(T==="Formato"?"use-document":"view-document",g)},x=()=>!u.value||!d.folder?"auto":d.folder.documents.length===1?"280px":d.folder.documents.length===2&&C.value===1?"340px":"280px",w=(g,T)=>{g&&(E.value[T]=g)},ae=(g,T)=>{g&&(k.value[T]=g)},I=(g,T)=>{u.value=!T,C.value=T?-1:g,T||setTimeout(()=>{const z=k.value[g];if(z){const S=z.$el||z;if(S&&S.getBoundingClientRect){const B=S.getBoundingClientRect(),le=window.innerHeight;if(g===0){if(B.bottom>le-20){const se=B.bottom-le+40;window.scrollBy({top:se,behavior:"smooth"})}}else if(B.bottom>le-10){const se=B.bottom-le+30;window.scrollBy({top:se,behavior:"smooth"})}else if(B.top<80){const se=B.top-100;window.scrollBy({top:se,behavior:"smooth"})}}}},100)};return(g,T)=>a.folder?(n(),re(Ke,{key:0},{default:_(()=>[e("div",eo,[e("div",to,[e("div",so,[e("div",oo,[e("div",no,[e("div",{class:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:Ge({backgroundColor:F.value.hex+"20"})},[o(t(Ct),{class:"h-6 w-6",style:Ge({color:F.value.hex})},null,8,["style"])],4),e("div",null,[e("h3",ro,p(a.folder.name),1),e("p",lo,p(a.folder.documents.length)+" documento"+p(a.folder.documents.length!==1?"s":""),1)])]),e("div",ao,[e("button",{onClick:A,class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"},[o(t(Xe),{class:"w-5 h-5"}),oe(" Agregar documentos ")]),e("button",{onClick:m,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[o(t(Ue),{class:"w-6 h-6"})])])])]),e("div",io,[a.folder.documents.length>0?(n(),i("div",co,[e("div",{class:"overflow-x-auto",style:Ge({minHeight:x()})},[e("table",uo,[mo,e("tbody",go,[(n(!0),i(de,null,me(a.folder.documents,(z,S)=>(n(),i("tr",{key:z.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:B=>q(z)},[e("td",ho,[e("div",fo,[e("div",vo,[e("div",bo,[o(t(Qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",yo,[e("div",xo,p(z.title),1)])])]),e("td",_o,[e("span",wo,p(te(z)),1)]),e("td",$o,[e("span",{class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",X(z)])},p(H(z)),3)]),e("td",ko,[e("div",Co,[(n(!0),i(de,null,me(z.tags,B=>(n(),i("span",{key:B.id,class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",U(B)])},p(B.name),3))),128)),!z.tags||z.tags.length===0?(n(),i("span",Do,"-")):D("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:T[0]||(T[0]=fe(()=>{},["stop"]))},[o(t(Te),{as:"div",class:"relative inline-block text-left"},{default:_(({open:B})=>[o(t(Ae),{ref_for:!0,ref:le=>w(le,S),onClick:le=>I(S,B),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:_(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),o(t(Me),{ref_for:!0,ref:le=>ae(le,S),class:$([a.folder.documents.length>2&&S>0&&S>=a.folder.documents.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:_(()=>[e("div",So,[o(t(ue),null,{default:_(({active:le})=>[e("a",{onClick:se=>q(z),class:$([le?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver documento ",10,Eo)]),_:2},1024),o(t(ue),null,{default:_(({active:le})=>[e("a",{onClick:se=>b(z),class:$([le?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Quitar de carpeta ",10,Fo)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,po))),128))])])],4)])):(n(),i("div",To,[o(t(rt),{class:"w-12 h-12 text-gray-300 mx-auto mb-4"}),Ao,Mo,e("button",{onClick:A,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},[o(t(Xe),{class:"w-5 h-5"}),oe(" Agregar documentos ")])]))])])])]),_:1})):D("",!0)}},_t=a=>(gt("data-v-d403a707"),a=a(),pt(),a),Lo={class:"tag-filter-container"},Io={class:"relative"},jo={class:"flex items-center"},Bo={key:0,class:"ml-2 inline-flex items-center justify-center h-5 w-5 bg-primary text-white text-xs rounded-full font-medium"},Uo={key:0,class:"absolute left-0 mt-2 w-full sm:w-80 bg-white rounded-xl shadow-xl ring-1 ring-black ring-opacity-5 border border-gray-100 z-50 overflow-hidden"},zo={class:"bg-gray-50 p-4 border-b border-gray-200"},No={class:"flex items-center justify-between mb-3"},Oo=_t(()=>e("h3",{class:"text-sm font-semibold text-gray-900"},"Filtrar por etiquetas",-1)),Ro={key:0,class:"text-xs text-gray-500"},qo={class:"relative"},Vo={key:0,class:"px-4 py-2 bg-blue-50 border-b border-blue-100"},Qo={class:"flex items-center justify-between"},Wo={class:"text-xs font-medium text-blue-700"},Go={class:"max-h-52 overflow-y-auto"},Ho={key:0,class:"px-4 py-8 text-center"},Zo=_t(()=>e("p",{class:"text-gray-500 text-sm"},"No hay etiquetas disponibles",-1)),Jo={key:1,class:"px-4 py-8 text-center"},Ko={class:"text-gray-500 text-sm"},Yo={key:2,class:"px-4 py-8 text-center"},Xo=_t(()=>e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"}),e("span",{class:"ml-3 text-sm text-gray-600"},"Cargando etiquetas...")],-1)),en=[Xo],tn={key:3,class:"py-2"},sn=["onClick"],on={class:"flex items-center h-5"},nn={class:"relative"},rn=["id","checked","onChange"],ln={key:0,class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},an=_t(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),dn=[an],cn={class:"ml-3 flex items-center flex-1 min-w-0"},un={class:"text-sm font-medium text-gray-900 truncate"},mn={key:0,class:"mt-4"},gn={class:"flex items-start gap-2"},pn=_t(()=>e("span",{class:"text-xs font-medium text-gray-500 mt-1.5 flex-shrink-0"},"Activos:",-1)),hn={class:"flex flex-wrap gap-2"},fn=["onClick"],vn={class:"mr-1"},bn={class:"ml-1 p-0.5 rounded-full hover:bg-white/50 transition-colors duration-150"},yn={__name:"TagFilter",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(a,{emit:h}){const d=a,c=h,E=qe(),k=v(!1),u=v([]),C=v(!1),y=v(""),F=L(()=>E.sortedTags),te=L(()=>{if(!y.value.trim())return F.value;const q=y.value.toLowerCase().trim();return F.value.filter(x=>x.name.toLowerCase().includes(q))}),H=q=>{const x=dt(q.color_id);return{hex:x&&x.hex?x.hex:"#9CA3AF",dark:x&&x.dark?x.dark:"#374151"}},X=()=>{k.value=!k.value,k.value&&(y.value="")},U=q=>u.value.some(x=>x.id===q.id),m=q=>{const x=u.value.findIndex(w=>w.id===q.id);x>=0?u.value.splice(x,1):u.value.push(q),c("update:modelValue",u.value)},A=()=>{u.value=[],c("update:modelValue",[])},b=q=>{q.target.closest(".tag-filter-container")||(k.value=!1,y.value="")};return Oe(async()=>{try{C.value=!0,await E.initTags()}catch(q){console.error("Error loading tags:",q)}finally{C.value=!1}document.addEventListener("click",b)}),we(()=>d.modelValue,q=>{u.value=q||[]},{immediate:!0}),ut(()=>{document.removeEventListener("click",b)}),(q,x)=>(n(),i("div",Lo,[e("div",Io,[e("button",{onClick:X,class:$(["group inline-flex items-center justify-between w-full sm:w-auto sm:min-w-[200px] px-4 py-3 border border-gray-200 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-primary transition-all duration-200",{"ring-2 ring-primary border-primary bg-blue-50":k.value,"border-primary bg-primary/5":u.value.length>0&&!k.value}])},[e("div",jo,[o(t(Rt),{class:$(["h-5 w-5 mr-2.5 text-gray-500 group-hover:text-gray-600",{"text-primary":u.value.length>0||k.value}])},null,8,["class"]),e("span",{class:$(["text-gray-700",{"text-primary font-semibold":u.value.length>0||k.value}])}," Filtrar por etiquetas ",2),u.value.length>0?(n(),i("span",Bo,p(u.value.length),1)):D("",!0)]),o(t(Ne),{class:$(["ml-3 h-4 w-4 text-gray-400 transition-all duration-200 group-hover:text-gray-600",{"rotate-180 text-primary":k.value,"text-primary":u.value.length>0&&!k.value}])},null,8,["class"])],2),o(as,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:_(()=>[k.value?(n(),i("div",Uo,[e("div",zo,[e("div",No,[Oo,F.value.length>0?(n(),i("span",Ro,p(F.value.length)+" disponibles ",1)):D("",!0)]),e("div",qo,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":x[0]||(x[0]=w=>y.value=w),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"},null,512),[[Re,y.value]])])]),u.value.length>0?(n(),i("div",Vo,[e("div",Qo,[e("span",Wo,p(u.value.length)+" etiqueta"+p(u.value.length!==1?"s":"")+" seleccionada"+p(u.value.length!==1?"s":""),1),e("button",{onClick:A,class:"text-xs text-red-600 hover:text-red-700 font-medium px-2 py-1 rounded-md hover:bg-red-50 transition-all duration-200"}," Limpiar todo ")])])):D("",!0),e("div",Go,[!C.value&&te.value.length===0&&y.value.trim()===""?(n(),i("div",Ho,[o(t(Rt),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),Zo])):D("",!0),!C.value&&te.value.length===0&&y.value.trim()!==""?(n(),i("div",Jo,[o(t(He),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e("p",Ko,'Sin resultados para "'+p(y.value)+'"',1),e("button",{onClick:x[1]||(x[1]=w=>y.value=""),class:"text-xs text-primary hover:text-primary-dark mt-2 font-medium"}," Ver todas las etiquetas ")])):D("",!0),C.value?(n(),i("div",Yo,en)):D("",!0),!C.value&&te.value.length>0?(n(),i("div",tn,[(n(!0),i(de,null,me(te.value,w=>(n(),i("div",{key:w.id,class:"group flex items-center px-4 py-2.5 hover:bg-gray-50 cursor-pointer transition-colors duration-150",onClick:ae=>m(w)},[e("div",on,[e("div",nn,[e("input",{id:`tag-${w.id}`,type:"checkbox",checked:U(w),onChange:ae=>m(w),class:"sr-only"},null,40,rn),e("div",{class:$(["w-4 h-4 border-2 rounded transition-all duration-200 flex items-center justify-center",U(w)?"bg-primary border-primary":"border-gray-300 group-hover:border-gray-400"])},[U(w)?(n(),i("svg",ln,dn)):D("",!0)],2)])]),e("div",cn,[e("div",{class:"w-3 h-3 rounded-full mr-2.5 border flex-shrink-0 shadow-sm",style:Ge({backgroundColor:H(w).hex})},null,4),e("span",un,p(w.name),1)])],8,sn))),128))])):D("",!0)])])):D("",!0)]),_:1})]),u.value.length>0?(n(),i("div",mn,[e("div",gn,[pn,e("div",hn,[(n(!0),i(de,null,me(u.value,w=>(n(),i("div",{key:w.id,class:"group inline-flex items-center pl-2.5 pr-1.5 py-1.5 rounded-lg text-xs font-medium border shadow-sm cursor-pointer transition-all duration-200 hover:shadow-md",style:Ge({backgroundColor:H(w).hex+"20",borderColor:H(w).hex+"40",color:H(w).dark}),onClick:ae=>m(w)},[e("div",{class:"w-2 h-2 rounded-full mr-2 flex-shrink-0",style:Ge({backgroundColor:H(w).hex})},null,4),e("span",vn,p(w.name),1),e("div",bn,[o(t(Ue),{class:"h-3 w-3 opacity-60 group-hover:opacity-100"})])],12,fn))),128))])])])):D("",!0)]))}},xn=xt(yn,[["__scopeId","data-v-d403a707"]]),_n={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},wn={class:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden"},$n={class:"border-b"},kn={class:"hidden sm:flex justify-between items-center p-6"},Cn=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Dn={class:"text-sm text-gray-600"},Sn={class:"sm:hidden p-4"},En={class:"flex justify-between items-start mb-2"},Fn={class:"flex-1 min-w-0 mr-3"},Tn=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),An={class:"text-sm text-gray-600 truncate"},Mn={class:"border-b"},Pn={class:"hidden sm:flex space-x-8 px-6","aria-label":"Tabs"},Ln=["onClick"],In={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},jn={class:"sm:hidden relative px-4 py-3"},Bn={class:"flex items-center"},Un={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},zn=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),Nn=[zn],On={class:"absolute top-full left-4 right-4 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},Rn=["onClick"],qn={class:"border-b bg-gray-50 p-4 sm:p-6"},Vn={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Qn={class:"flex-1"},Wn={key:0,class:"flex items-center gap-3"},Gn={class:"text-sm text-gray-600"},Hn={class:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-350px)]"},Zn={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Jn={key:4,class:"absolute top-2 left-2 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center shadow-sm"},Kn={key:0,class:"text-center py-8 sm:py-12"},Yn={class:"text-lg font-medium text-gray-900 mb-2"},Xn={class:"text-gray-600 text-sm sm:text-base"},er={class:"border-t bg-gray-50"},tr={class:"hidden sm:flex justify-between items-center p-6"},sr={class:"text-sm text-gray-600"},or={class:"flex gap-3"},nr=["disabled"],rr={class:"sm:hidden p-4 space-y-3"},lr={class:"text-center text-sm text-gray-600"},ar={class:"flex gap-3"},ir=["disabled"],dr={__name:"AddDocumentsModal",props:{isVisible:{type:Boolean,required:!0},folder:{type:Object,default:null}},emits:["close","add-documents"],setup(a,{emit:h}){const d=a,c=h,E=qe(),k=Je(),u=v([]),C=v([]),y=v("my-documents"),F=v(!1),te=v(!1),H=[{name:"my-documents",label:"Mis Documentos"},{name:"use-documents",label:"Formatos Disponibles"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Documentos Firmados"}],X=L(()=>k.currentUser);we(()=>d.isVisible,g=>{g&&(u.value=[],C.value=[],y.value="my-documents")}),we(y,()=>{u.value=[]}),we(C,()=>{u.value=[]},{deep:!0});const U=L(()=>{const g=A(y.value);return g.length===0?!1:g.every(T=>u.value.includes(T.id))}),m=g=>{var S;if(!d.folder)return[];const T=d.folder.documents.map(B=>B.id);let z=[];switch(g){case"my-documents":z=E.progressAndCompletedDocumentsByClient((S=X.value)==null?void 0:S.id);break;case"use-documents":z=E.publishedDocumentsUnassigned;break;case"pending-signatures":z=E.documents.filter(B=>{var le,se;return B.state==="PendingSignatures"&&(B.assigned_to===((le=X.value)==null?void 0:le.id)||((se=B.signatures)==null?void 0:se.some(V=>{var ce;return V.signer_email===((ce=X.value)==null?void 0:ce.email)})))});break;case"signed-documents":z=E.documents.filter(B=>{var le,se;return B.state==="FullySigned"&&(B.assigned_to===((le=X.value)==null?void 0:le.id)||((se=B.signatures)==null?void 0:se.some(V=>{var ce;return V.signer_email===((ce=X.value)==null?void 0:ce.email)})))});break;default:z=[]}return z.filter(B=>!T.includes(B.id))},A=g=>{const T=m(g);if(!C.value||C.value.length===0)return T;const z=C.value.map(S=>S.id);return T.filter(S=>!S.tags||S.tags.length===0?!1:S.tags.some(B=>z.includes(B.id)))},b=g=>{const T=u.value.indexOf(g);T>-1?u.value.splice(T,1):u.value.push(g)},q=()=>{const T=A(y.value).map(z=>z.id);if(U.value)u.value=u.value.filter(z=>!T.includes(z));else{const z=T.filter(S=>!u.value.includes(S));u.value.push(...z)}},x=()=>{c("close")},w=async()=>{if(u.value.length!==0){F.value=!0;try{await c("add-documents",u.value)}finally{F.value=!1}}},ae=g=>{y.value=g,te.value=!1},I=g=>{g.target.closest(".relative")||(te.value=!1)};return Oe(()=>{document.addEventListener("click",I)}),ut(()=>{document.removeEventListener("click",I)}),(g,T)=>a.isVisible&&a.folder?(n(),re(Ke,{key:0},{default:_(()=>{var z;return[e("div",_n,[e("div",wn,[e("div",$n,[e("div",kn,[e("div",null,[Cn,e("p",Dn,'Selecciona documentos para agregar a "'+p(a.folder.name)+'"',1)]),e("button",{onClick:x,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors"},[o(t(Ue),{class:"w-5 h-5"})])]),e("div",Sn,[e("div",En,[e("div",Fn,[Tn,e("p",An,'Para "'+p(a.folder.name)+'"',1)]),e("button",{onClick:x,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors flex-shrink-0"},[o(t(Ue),{class:"w-5 h-5"})])])])]),e("div",Mn,[e("nav",Pn,[(n(),i(de,null,me(H,S=>e("button",{key:S.name,onClick:B=>y.value=S.name,class:$([y.value===S.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[oe(p(S.label)+" ",1),e("span",In,p(A(S.name).length),1)],10,Ln)),64))]),e("div",jn,[e("button",{onClick:T[0]||(T[0]=S=>te.value=!te.value),class:"w-full flex items-center justify-between py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("div",Bn,[e("span",null,p(((z=H.find(S=>S.name===y.value))==null?void 0:z.label)||"Seleccionar categoría"),1),e("span",Un,p(A(y.value).length),1)]),(n(),i("svg",{class:$(["ml-2 h-5 w-5 transition-transform duration-200",te.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Nn,2))]),Pe(e("div",On,[(n(),i(de,null,me(H,S=>e("button",{key:S.name,onClick:B=>ae(S.name),class:$(["w-full text-left px-4 py-3 text-sm transition-colors duration-150 flex items-center justify-between",y.value===S.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},[e("span",null,p(S.label),1),e("span",{class:$(["py-0.5 px-2 rounded-full text-xs",y.value===S.name?"bg-white/20 text-white":"bg-gray-100 text-gray-600"])},p(A(S.name).length),3)],10,Rn)),64))],512),[[mt,te.value]])])]),e("div",qn,[e("div",Vn,[e("div",Qn,[o(xn,{modelValue:C.value,"onUpdate:modelValue":T[1]||(T[1]=S=>C.value=S),class:"max-w-md"},null,8,["modelValue"])]),A(y.value).length>0?(n(),i("div",Wn,[e("span",Gn,p(A(y.value).length)+" documento(s) disponible(s) ",1),e("button",{onClick:q,class:$(["px-4 py-2 rounded-lg border font-medium text-sm transition-colors",U.value?"bg-red-50 border-red-200 text-red-700 hover:bg-red-100":"bg-primary text-white border-primary hover:bg-primary-dark"])},p(U.value?"Deseleccionar todos":"Seleccionar todos"),3)])):D("",!0)])]),e("div",Hn,[e("div",Zn,[(n(!0),i(de,null,me(A(y.value),S=>(n(),i("div",{key:S.id,class:"relative"},[y.value==="my-documents"?(n(),re(t(fs),{key:0,document:S,"highlighted-doc-id":null,"show-tags":!0,"show-client-name":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":u.value.includes(S.id)?"ring-2 ring-primary bg-primary-50":"",onClick:B=>b(S.id)},null,8,["document","additional-classes","onClick"])):D("",!0),y.value==="use-documents"?(n(),re(t(js),{key:1,document:S,"show-tags":!0,"menu-options":[],"show-menu-options":!1,"disable-internal-actions":!0,"additional-classes":u.value.includes(S.id)?"ring-2 ring-primary bg-primary-50":"",onClick:B=>b(S.id)},null,8,["document","additional-classes","onClick"])):D("",!0),y.value==="pending-signatures"?(n(),re(t(Ot),{key:2,document:S,"highlighted-doc-id":null,"show-tags":!0,"menu-options":[],"disable-internal-actions":!0,"additional-classes":u.value.includes(S.id)?"ring-2 ring-primary bg-primary-50":"",onClick:B=>b(S.id)},null,8,["document","additional-classes","onClick"])):D("",!0),y.value==="signed-documents"?(n(),re(t(Ot),{key:3,document:S,"highlighted-doc-id":null,"show-tags":!0,"menu-options":[],"disable-internal-actions":!0,"additional-classes":u.value.includes(S.id)?"ring-2 ring-primary bg-primary-50":"",onClick:B=>b(S.id)},null,8,["document","additional-classes","onClick"])):D("",!0),u.value.includes(S.id)?(n(),i("div",Jn,[o(t(vs),{class:"w-4 h-4"})])):D("",!0)]))),128))]),A(y.value).length===0?(n(),i("div",Kn,[o(t(rt),{class:"w-12 h-12 sm:w-16 sm:h-16 text-gray-300 mx-auto mb-4"}),e("h4",Yn,p(C.value.length>0?"No hay documentos que coincidan con el filtro":"No hay documentos disponibles"),1),e("p",Xn,p(C.value.length>0?"Intenta ajustar los filtros de etiquetas o selecciona otra categoría":"No tienes documentos de esta categoría que no estén ya en la carpeta"),1)])):D("",!0)]),e("div",er,[e("div",tr,[e("div",sr,p(u.value.length)+" documento(s) seleccionado(s) ",1),e("div",or,[e("button",{onClick:x,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{onClick:w,disabled:u.value.length===0||F.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},p(F.value?"Agregando...":`Agregar ${u.value.length} documento(s)`),9,nr)])]),e("div",rr,[e("div",lr,p(u.value.length)+" documento(s) seleccionado(s) ",1),e("div",ar,[e("button",{onClick:x,class:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center font-medium"}," Cancelar "),e("button",{onClick:w,disabled:u.value.length===0||F.value,class:"flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-center font-medium"},p(F.value?"Agregando...":"Agregar"),9,ir)])])])])])]}),_:1})):D("",!0)}},it=a=>(gt("data-v-d9a5a89f"),a=a(),pt(),a),cr={class:"folders-table"},ur={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200",style:{"overflow-x":"visible","overflow-y":"hidden"}},mr={class:"min-w-full divide-y divide-gray-200"},gr=it(()=>e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Carpeta "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documentos "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Creada "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1)),pr={class:"bg-white divide-y divide-gray-200"},hr=["onClick"],fr={class:"px-6 py-4 whitespace-nowrap"},vr={class:"flex items-center"},br={class:"flex-shrink-0 h-10 w-10"},yr={class:"ml-4"},xr={class:"text-sm font-medium text-gray-900"},_r={class:"px-6 py-4 whitespace-nowrap"},wr={class:"flex items-center gap-2"},$r={class:"text-sm text-gray-900"},kr={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Cr={class:"py-1"},Dr=["onClick"],Sr=["onClick"],Er=["onClick"],Fr=["onClick"],Tr={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Ar=it(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No tienes carpetas aún",-1)),Mr=it(()=>e("p",{class:"text-gray-600 mb-6"},"Crea tu primera carpeta para organizar tus documentos",-1)),Pr={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Lr=it(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No se encontraron carpetas",-1)),Ir=it(()=>e("p",{class:"text-gray-600"},"No hay carpetas que coincidan con tu búsqueda",-1)),jr={key:3,class:"flex justify-center items-center py-12"},Br=it(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)),Ur=[Br],zr={__name:"FoldersTable",props:{sortedFolders:{type:Array,required:!0},searchQuery:{type:String,default:""},isLoading:{type:Boolean,default:!1}},emits:["folder-click","edit-folder","delete-folder","add-documents","create-folder"],setup(a,{emit:h}){const d=a,c=h,E=v({}),k=v({}),u=v(!1),C=v(-1),y=L(()=>{if(!d.searchQuery.trim())return d.sortedFolders;const I=d.searchQuery.toLowerCase();return d.sortedFolders.filter(g=>g.name.toLowerCase().includes(I))}),F=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],te=I=>{if(I.color)return F.find(T=>T.name===I.color)||F[0];const g=I.id%F.length;return F[g]},H=I=>{if(!I)return"-";const g=new Date(I),z=Math.abs(new Date-g),S=Math.ceil(z/(1e3*60*60*24));return S===0?"Hoy":S===1?"Ayer":S<7?`Hace ${S} días`:S<30?`Hace ${Math.floor(S/7)} semanas`:S<365?`Hace ${Math.floor(S/30)} meses`:g.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},X=I=>{c("folder-click",I)},U=I=>{c("edit-folder",I)},m=I=>{c("delete-folder",I)},A=I=>{c("add-documents",I)},b=()=>{c("create-folder")},q=()=>u.value?y.value.length===1?"280px":y.value.length===2&&C.value===1?"340px":"280px":"auto",x=(I,g)=>{I&&(E.value[g]=I)},w=(I,g)=>{I&&(k.value[g]=I)},ae=(I,g)=>{u.value=!g,C.value=g?-1:I,g||setTimeout(()=>{const T=k.value[I];if(T){const z=T.$el||T;if(z&&z.getBoundingClientRect){const S=z.getBoundingClientRect(),B=window.innerHeight;if(I===0){if(S.bottom>B-20){const le=S.bottom-B+40;window.scrollBy({top:le,behavior:"smooth"})}}else if(S.bottom>B-10){const le=S.bottom-B+30;window.scrollBy({top:le,behavior:"smooth"})}else if(S.top<80){const le=S.top-100;window.scrollBy({top:le,behavior:"smooth"})}}}},100)};return(I,g)=>(n(),i("div",cr,[!a.isLoading&&y.value.length>0?(n(),i("div",ur,[e("div",{class:"overflow-x-auto",style:Ge({minHeight:q(),overflowY:"visible"})},[e("table",mr,[gr,e("tbody",pr,[(n(!0),i(de,null,me(y.value,(T,z)=>{var S,B;return n(),i("tr",{key:T.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:le=>X(T)},[e("td",fr,[e("div",vr,[e("div",br,[e("div",{class:"h-10 w-10 rounded-lg flex items-center justify-center",style:Ge({backgroundColor:te(T).hex+"20"})},[o(t(Ct),{class:"h-6 w-6",style:Ge({color:te(T).hex})},null,8,["style"])],4)]),e("div",yr,[e("div",xr,p(T.name),1)])])]),e("td",_r,[e("div",wr,[o(t(Qe),{class:"h-5 w-5 text-gray-400"}),e("span",$r,p(((S=T.documents)==null?void 0:S.length)||0)+" documento"+p((((B=T.documents)==null?void 0:B.length)||0)!==1?"s":""),1)])]),e("td",kr,p(H(T.created_at)),1),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:g[0]||(g[0]=fe(()=>{},["stop"]))},[o(t(Te),{as:"div",class:"relative inline-block text-left"},{default:_(({open:le})=>[o(t(Ae),{ref_for:!0,ref:se=>x(se,z),onClick:se=>ae(z,le),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:_(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),o(t(Me),{ref_for:!0,ref:se=>w(se,z),class:$([y.value.length>2&&z>0&&z>=y.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:_(()=>[e("div",Cr,[o(t(ue),null,{default:_(({active:se})=>[e("a",{onClick:V=>X(T),class:$([se?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver carpeta ",10,Dr)]),_:2},1024),o(t(ue),null,{default:_(({active:se})=>[e("a",{onClick:V=>A(T),class:$([se?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Agregar documentos ",10,Sr)]),_:2},1024),o(t(ue),null,{default:_(({active:se})=>[e("a",{onClick:V=>U(T),class:$([se?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Editar ",10,Er)]),_:2},1024),o(t(ue),null,{default:_(({active:se})=>[e("a",{onClick:V=>m(T),class:$([se?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Eliminar ",10,Fr)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,hr)}),128))])])],4)])):!a.isLoading&&a.sortedFolders.length===0?(n(),i("div",Tr,[o(t(Ct),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Ar,Mr,e("button",{onClick:b,class:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"},[o(t(Xe),{class:"w-5 h-5"}),oe(" Crear Primera Carpeta ")])])):!a.isLoading&&a.sortedFolders.length>0&&y.value.length===0?(n(),i("div",Pr,[o(t(Ct),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Lr,Ir])):D("",!0),a.isLoading?(n(),i("div",jr,Ur)):D("",!0)]))}},Nr=xt(zr,[["__scopeId","data-v-d9a5a89f"]]),Xt=a=>(gt("data-v-ab5666d5"),a=a(),pt(),a),Or={class:"folder-management"},Rr={class:"mb-6"},qr={class:"hidden sm:flex justify-between items-center"},Vr=Xt(()=>e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Qr={class:"sm:hidden"},Wr=Xt(()=>e("div",{class:"text-center mb-4"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1 px-2"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Gr={__name:"FolderManagement",props:{searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","navigate-to-main"],setup(a,{emit:h}){const d=a,c=h,E=Bt(),k=qe(),u=Je(),C=v(!1),y=v(null),F=v(null),te=v(!1),H=v(null),X=L(()=>E.isLoading),U=L(()=>E.sortedFolders);L(()=>u.currentUser),Oe(async()=>{await E.init(),await k.init()}),we(()=>d.searchQuery,()=>{}),we(()=>E.folders,V=>{var ce,ye;if(F.value&&V&&V.length>0){const ve=V.find(N=>N.id===F.value.id);if(ve){const N=((ce=F.value.documents)==null?void 0:ce.length)||0,Y=((ye=ve.documents)==null?void 0:ye.length)||0;JSON.stringify(F.value)!==JSON.stringify(ve)&&(F.value={...ve},console.log(`🔄 FolderManagement: Synced selectedFolder "${ve.name}" with store. Documents: ${N} → ${Y}`))}}},{deep:!0});const m=()=>{y.value=null,C.value=!0},A=V=>{y.value=V,C.value=!0},b=()=>{C.value=!1,y.value=null},q=()=>{b()},x=V=>{F.value=V},w=()=>{F.value=null},ae=async V=>{if(confirm(`¿Estás seguro de que quieres eliminar la carpeta "${V.name}"?`))try{await E.deleteFolder(V.id),De(`Carpeta "${V.name}" eliminada correctamente`,"success")}catch(ce){De("Error al eliminar la carpeta","error"),console.error("Error deleting folder:",ce)}},I=V=>{H.value=V,te.value=!0},g=async(V=!1)=>{if(te.value=!1,H.value=null,V&&F.value)try{await T()}catch(ce){console.warn("Error refreshing folder after adding documents:",ce)}},T=async()=>{if(F.value)try{await E.fetchFolderById(F.value.id,!0);const V=E.getFolderById(F.value.id);V&&(F.value={...V},console.log("✅ Selected folder refreshed successfully"))}catch(V){throw console.error("❌ Error refreshing selected folder:",V),V}},z=async V=>{var ce,ye,ve;if(!(!H.value||V.length===0))try{const N=H.value.documents.map(ne=>ne.id).filter(ne=>ne!=null&&!isNaN(parseInt(ne))).map(ne=>parseInt(ne)),Y=V.filter(ne=>ne!=null&&!isNaN(parseInt(ne))).map(ne=>parseInt(ne)),W=[...new Set([...N,...Y])];if(console.log("Current document IDs:",N),console.log("Selected document IDs:",Y),console.log("Updated document IDs:",W),W.some(ne=>!Number.isInteger(ne)||ne<=0))throw new Error("IDs de documentos inválidos detectados");await E.updateFolder(H.value.id,{document_ids:W}),await g(!0),De(`${Y.length} documento(s) agregado(s) a la carpeta`,"success"),c("navigate-to-main")}catch(N){console.error("Error adding documents to folder:",N),console.error("Error details:",((ce=N.response)==null?void 0:ce.data)||N.message),(ye=N.response)!=null&&ye.status?De(`Error al agregar documentos: ${((ve=N.response.data)==null?void 0:ve.detail)||N.message}`,"error"):De("Error al agregar documentos a la carpeta","error")}},S=async V=>{var ce,ye,ve;if(F.value)try{const N=parseInt(V);if(!Number.isInteger(N)||N<=0)throw new Error("ID de documento inválido");const Y=F.value.documents.map(W=>W.id).filter(W=>W!=null&&!isNaN(parseInt(W))).map(W=>parseInt(W)).filter(W=>W!==N);console.log("Removing document ID:",N),console.log("Updated document IDs after removal:",Y),await E.updateFolder(F.value.id,{document_ids:Y}),De("Documento removido de la carpeta","success"),F.value=null,c("navigate-to-main");try{await E.fetchFolderById(F.value.id,!0);const W=E.getFolderById(F.value.id);W&&(F.value=W),console.log("Folder data refreshed successfully after removal")}catch(W){console.warn("Error refreshing folder data:",W);try{F.value={...F.value,documents:F.value.documents.filter(ne=>ne.id!==N)},console.log("Applied optimistic removal for document ID:",N)}catch(ne){console.warn("Optimistic update failed:",ne)}}}catch(N){console.error("Error removing document from folder:",N),console.error("Error details:",((ce=N.response)==null?void 0:ce.data)||N.message),(ye=N.response)!=null&&ye.status?De(`Error al remover documento: ${((ve=N.response.data)==null?void 0:ve.detail)||N.message}`,"error"):De("Error al remover el documento de la carpeta","error")}},B=V=>{console.log("View document:",V)},le=V=>{console.log("Use document:",V)},se=(V,ce)=>{console.log("Document action:",V,ce)};return(V,ce)=>(n(),i("div",Or,[e("div",Rr,[e("div",qr,[Vr,e("button",{onClick:m,class:"inline-flex items-center gap-2 px-4 py-2.5 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md"},[o(t(Xe),{class:"w-5 h-5"}),oe(" Nueva Carpeta ")])]),e("div",Qr,[Wr,e("button",{onClick:m,class:"w-full flex items-center justify-center gap-3 px-4 py-4 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium text-base"},[o(t(Xe),{class:"w-6 h-6"}),oe(" Nueva Carpeta ")])])]),o(t(Nr),{"sorted-folders":U.value,"search-query":a.searchQuery,"is-loading":X.value,onFolderClick:x,onEditFolder:A,onDeleteFolder:ae,onAddDocuments:I,onCreateFolder:m},null,8,["sorted-folders","search-query","is-loading"]),o(t(Xs),{"is-visible":C.value,"editing-folder":y.value,onClose:b,onSuccess:q},null,8,["is-visible","editing-folder"]),o(t(Po),{folder:F.value,onClose:w,onAddDocuments:I,onRemoveDocument:S,onViewDocument:B,onUseDocument:le,onDocumentAction:se},null,8,["folder"]),o(t(dr),{"is-visible":te.value,folder:H.value,onClose:g,onAddDocuments:z},null,8,["is-visible","folder"])]))}},Hr=xt(Gr,[["__scopeId","data-v-ab5666d5"]]);function Ut(){const a=Je(),h=L(()=>{var k;return((k=a.currentUser)==null?void 0:k.role)==="basic"}),d=k=>{De("Esta funcionalidad está restringida para usuarios básicos. Por favor, contacta a tu abogado para obtener acceso completo.","warning")};return{isBasicUser:h,showRestrictionNotification:d,handleFeatureAccess:(k,u)=>h.value?(d(),!1):(u&&u(),!0),getRestrictedButtonClasses:k=>k?"opacity-60 cursor-not-allowed":""}}function Zr(a){return!a.variables||a.variables.length===0?!0:a.variables.every(h=>h.name_es&&h.name_es.trim().length>0)}function Mt(a,h){var E;if(!a.requires_signature||a.state!=="PendingSignatures"||!a.signatures||a.signatures.length===0)return!1;const d=(E=h==null?void 0:h.currentUser)==null?void 0:E.email,c=a.signatures.find(k=>k.signer_email===d);return!(!c||c.signed)}const Jr={lawyer:{getMenuOptions:(a,h,d)=>{const c=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Administrar Asociaciones",action:"relationships"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}];return a.state==="Draft"?c.push({label:"Publicar",action:"publish",disabled:!Zr(a)}):a.state==="Published"&&(c.push({label:"Mover a Borrador",action:"draft"}),c.push({label:"Formalizar y Agregar Firmas",action:"formalize"})),(a.state==="Completed"||a.state==="Published")&&c.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),a.requires_signature&&(c.push({label:"Ver Firmas",action:"viewSignatures"}),Mt(a,d)&&c.push({label:"Firmar documento",action:"sign"})),c}},signatures:{getMenuOptions:(a,h,d)=>{const c=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}];return a.requires_signature&&(a.state==="PendingSignatures"||a.state==="FullySigned")&&c.push({label:"Estado de las firmas",action:"viewSignatures"}),Mt(a,d)&&c.push({label:"Firmar documento",action:"sign"}),a.state==="FullySigned"&&c.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),a.state==="PendingSignatures"&&c.push({label:"Descargar PDF",action:"downloadPDF"}),c}},client:{getMenuOptions:(a,h,d)=>{var u,C,y;const c=[],E=((u=d==null?void 0:d.currentUser)==null?void 0:u.role)==="basic",k=((C=d==null?void 0:d.currentUser)==null?void 0:C.role)==="corporate_client"||((y=d==null?void 0:d.currentUser)==null?void 0:y.role)==="client";return a.state==="Completed"?(c.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Editar Formulario",action:"editForm"},{label:"Editar Documento",action:"editDocument"}]}),k&&c.push({label:"Formalizar y Agregar Firmas",action:"formalize"})):c.push({label:"Completar",action:"editForm"}),a.state==="Completed"&&c.push({label:"Previsualizar",action:"preview"}),c.push({label:"Eliminar",action:"delete"}),E?c.push({label:"Gestionar Membrete",action:"letterhead",disabled:!0}):c.push({label:"Gestionar Membrete",action:"letterhead"}),c.push({label:"Administrar Asociaciones",action:"relationships"}),a.requires_signature&&(c.push({label:"Ver Firmas",action:"viewSignatures"}),Mt(a,d)&&c.push({label:"Firmar documento",action:"sign"})),a.state==="Completed"&&c.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar",action:"email"}),c}}};function Kr(a,h,d="list",c=null){const E=Jr[a];return E?E.getMenuOptions(h,d,c):[]}const Yr={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Xr={class:"px-6 py-4 border-b border-gray-200"},el=e("h2",{class:"text-xl font-semibold text-gray-800"},"Acciones del Documento",-1),tl={class:"text-sm text-gray-500 mt-1"},sl={class:"p-6 overflow-y-auto flex-grow"},ol={class:"space-y-4"},nl={key:0,class:"text-sm font-semibold text-gray-700 uppercase tracking-wide px-2"},rl={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},ll=["onClick","disabled"],al={class:"text-sm font-medium"},il={key:1,class:"border-t border-gray-200 my-4"},dl={key:0,class:"text-center py-12"},cl=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay acciones disponibles",-1),ul=e("p",{class:"mt-1 text-sm text-gray-500"}," No hay opciones disponibles para este documento. ",-1),wt={__name:"DocumentActionsModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null},cardType:{type:String,required:!0,validator:a=>["lawyer","client","signatures"].includes(a)},context:{type:String,default:"table"},userStore:{type:Object,default:null}},emits:["close","action"],setup(a,{emit:h}){const d=a,c=h,E=L(()=>d.document?Kr(d.cardType,d.document,d.context,d.userStore):[]),k=L(()=>{const U=E.value;if(!U||U.length===0)return[];const m=[],A={edit:"Edición",view:"Visualización",share:"Compartir",manage:"Gestión",signatures:"Firmas",delete:"Eliminación"},b={edit:[],view:[],share:[],manage:[],signatures:[],delete:[]};return U.forEach(q=>{if(q.children&&Array.isArray(q.children))q.children.forEach(x=>{const w=x.action.toLowerCase();u(x,w,b)});else{const x=q.action.toLowerCase();u(q,x,b)}}),b.edit.length>0&&m.push({title:A.edit,options:b.edit}),b.view.length>0&&m.push({title:A.view,options:b.view}),b.share.length>0&&m.push({title:A.share,options:b.share}),b.signatures.length>0&&m.push({title:A.signatures,options:b.signatures}),b.manage.length>0&&m.push({title:A.manage,options:b.manage}),b.delete.length>0&&m.push({title:A.delete,options:b.delete}),m}),u=(U,m,A)=>{m.includes("edit")||m.includes("editar")||m==="copy"||m==="draft"||m==="publish"||m==="formalize"||m==="completar"?A.edit.push(U):m.includes("view")||m.includes("preview")||m.includes("ver")||m.includes("previsualización")?A.view.push(U):m.includes("download")||m.includes("email")||m.includes("enviar")||m.includes("descargar")?A.share.push(U):m.includes("signature")||m.includes("firma")||m.includes("sign")?A.signatures.push(U):m.includes("permission")||m.includes("relationship")||m.includes("letterhead")||m.includes("permiso")||m.includes("asociación")||m.includes("membrete")?A.manage.push(U):m.includes("delete")||m.includes("eliminar")?A.delete.push(U):A.manage.push(U)},C=U=>{const m=U.toLowerCase();return m==="editform"||m.includes("completar")?Wt:m==="editdocument"||m.includes("editar documento")?qt:m.includes("edit")||m==="editar"?qt:m.includes("delete")||m==="eliminar"?Pt:m.includes("preview")||m.includes("ver")||m.includes("previsualización")?Jt:m==="copy"||m.includes("copia")?ps:m.includes("download")||m.includes("descargar")?tt:m.includes("email")||m.includes("enviar")?ds:m.includes("permission")||m.includes("permiso")?bs:m.includes("relationship")||m.includes("asociación")?ys:m.includes("letterhead")||m.includes("membrete")?Kt:m.includes("signature")||m.includes("firma")?Lt:m==="publish"||m.includes("publicar")?$s:m==="draft"||m.includes("borrador")?Qe:m==="formalize"||m.includes("formalizar")?Wt:rt},y=U=>{const m=U.toLowerCase();return m.includes("delete")||m==="eliminar"?"text-red-600":m.includes("download")||m.includes("descargar")?"text-blue-600":m.includes("email")||m.includes("enviar")?"text-green-600":m.includes("signature")||m.includes("firma")?"text-purple-600":"text-gray-600"},F=U=>{const m=U.toLowerCase();return m.includes("delete")||m==="eliminar"?"border-red-200 bg-red-50 text-red-700 hover:bg-red-100 hover:border-red-300":m.includes("download")||m.includes("descargar")?"border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 hover:border-blue-300":m.includes("email")||m.includes("enviar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":m.includes("signature")||m.includes("firma")?"border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-100 hover:border-purple-300":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-300"},{handleFeatureAccess:te}=Ut(),H=U=>{const m=E.value.find(b=>b.action===U?b:b.children?b.children.find(q=>q.action===U):null),A=m!=null&&m.children?m.children.find(b=>b.action===U):m;if(A!=null&&A.disabled){te("Esta funcionalidad",null);return}c("action",U,d.document)},X=()=>{c("close")};return(U,m)=>Pe((n(),re(Ke,null,{default:_(()=>{var A;return[e("div",Yr,[e("div",Xr,[el,e("p",tl,p(((A=a.document)==null?void 0:A.title)||"Cargando..."),1),e("button",{onClick:X,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500 transition-colors"},[o(t(Ue),{class:"h-6 w-6"})])]),e("div",sl,[e("div",ol,[(n(!0),i(de,null,me(k.value,(b,q)=>(n(),i("div",{key:q,class:"space-y-2"},[b.title?(n(),i("h3",nl,p(b.title),1)):D("",!0),e("div",rl,[(n(!0),i(de,null,me(b.options,x=>(n(),i("button",{key:x.action,onClick:w=>H(x.action),disabled:x.disabled,class:$(["flex items-center justify-start px-4 py-3 rounded-lg border transition-all duration-200",x.disabled?"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed opacity-60":F(x.action),"hover:shadow-md hover:scale-[1.02]"])},[(n(),re(is(C(x.action)),{class:$(["h-5 w-5 mr-3 flex-shrink-0",x.disabled?"text-gray-400":y(x.action)])},null,8,["class"])),e("span",al,p(x.label),1),x.disabled?(n(),re(t(gs),{key:0,class:"h-4 w-4 ml-auto text-gray-400"})):D("",!0)],10,ll))),128))]),q<k.value.length-1?(n(),i("div",il)):D("",!0)]))),128)),k.value.length===0?(n(),i("div",dl,[o(t(rt),{class:"mx-auto h-12 w-12 text-gray-400"}),cl,ul])):D("",!0)])])])]}),_:1},512)),[[mt,a.isVisible]])}},ml={class:"document-list-client-table"},gl={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},pl={class:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"},hl={class:"flex flex-col sm:flex-row gap-3 flex-1 w-full lg:w-auto"},fl={class:"relative flex-1 min-w-[200px]"},vl={class:"max-w-[120px] truncate"},bl={class:"p-2"},yl={class:"relative mb-2"},xl={class:"max-h-60 overflow-y-auto"},_l=["onClick"],wl={class:"truncate"},$l={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},kl={class:"flex items-center gap-3 w-full lg:w-auto"},Cl={class:"text-sm text-gray-500 whitespace-nowrap"},Dl={class:"py-1"},Sl={class:"bg-white rounded-lg shadow-sm border border-gray-200"},El={class:"overflow-x-auto"},Fl={class:"min-w-full divide-y divide-gray-200"},Tl=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ")])],-1),Al={class:"bg-white divide-y divide-gray-200"},Ml=["onClick"],Pl={class:"px-6 py-4 whitespace-nowrap"},Ll={class:"flex items-center"},Il={class:"flex-shrink-0 h-10 w-10"},jl={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Bl={class:"ml-4"},Ul={class:"text-sm font-medium text-gray-900"},zl={class:"px-6 py-4 whitespace-nowrap"},Nl={class:"px-6 py-4 whitespace-nowrap"},Ol={class:"flex flex-wrap gap-1"},Rl={key:0,class:"text-sm text-gray-400"},ql={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Vl={class:"flex flex-1 justify-between sm:hidden"},Ql=["disabled"],Wl=["disabled"],Gl={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Hl={class:"text-sm text-gray-700"},Zl={class:"font-medium"},Jl={class:"font-medium"},Kl={class:"font-medium"},Yl={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Xl=["disabled"],ea=e("span",{class:"sr-only"},"Anterior",-1),ta=["onClick"],sa={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},oa=["disabled"],na=e("span",{class:"sr-only"},"Siguiente",-1),ra={key:1,class:"text-center py-12"},la=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos",-1),aa=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos asignados por tu abogado aparecerán aquí.",-1),ia={__name:"DocumentListClientTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh","open-letterhead","open-relationships"],setup(a,{emit:h}){const d=qe(),c=Je(),E=et(),k=h,{handleFeatureAccess:u}=Ut(),{activeModals:C,openModal:y,closeModal:F}=vt(d,c),{handlePreviewDocument:te,deleteDocument:H,downloadPDFDocument:X,downloadWordDocument:U,formalizeDocument:m,signDocument:A}=bt(d,c,k);we(C,P=>{},{deep:!0}),Oe(()=>{});const b=v(""),q=v(""),x=v(null),w=v("recent");Oe(()=>{d.init(),c.init()});const ae=L(()=>c.getCurrentUser),I=L(()=>ae.value?d.progressAndCompletedDocumentsByClient(ae.value.id):[]),g=L(()=>{let P=[...I.value];const r=b.value.toLowerCase();return r&&(P=P.filter(s=>{var l,O;return((l=s.title)==null?void 0:l.toLowerCase().includes(r))||((O=s.tags)==null?void 0:O.some(pe=>{var _e;return(_e=pe.name)==null?void 0:_e.toLowerCase().includes(r)}))})),x.value&&(P=P.filter(s=>s.tags&&s.tags.some(l=>l.id===x.value))),w.value==="name"?P.sort((s,l)=>{const O=(s.title||"").toLowerCase(),pe=(l.title||"").toLowerCase();return O.localeCompare(pe)}):w.value==="recent"&&P.sort((s,l)=>l.id-s.id),P}),T=v(1),z=v(10),S=L(()=>{const P=(T.value-1)*z.value,r=P+z.value;return g.value.slice(P,r)}),B=L(()=>Math.ceil(g.value.length/z.value)),le=L(()=>{const P=(T.value-1)*z.value+1,r=Math.min(T.value*z.value,g.value.length);return{start:P,end:r,total:g.value.length}});we([b,x,w],()=>{T.value=1});const se=L(()=>{const P=B.value,r=T.value,s=[];if(P<=7)for(let l=1;l<=P;l++)s.push(l);else if(r<=4){for(let l=1;l<=5;l++)s.push(l);s.push("..."),s.push(P)}else if(r>=P-3){s.push(1),s.push("...");for(let l=P-4;l<=P;l++)s.push(l)}else s.push(1),s.push("..."),s.push(r-1),s.push(r),s.push(r+1),s.push("..."),s.push(P);return s}),V=()=>{T.value>1&&T.value--},ce=()=>{T.value<B.value&&T.value++},ye=P=>{P>=1&&P<=B.value&&(T.value=P)},ve=L(()=>{const P=new Map;return I.value.forEach(r=>{r.tags&&r.tags.length>0&&r.tags.forEach(s=>{P.has(s.id)||P.set(s.id,s)})}),Array.from(P.values()).sort((r,s)=>r.name.localeCompare(s.name))}),N=L(()=>{if(!q.value)return ve.value;const P=q.value.toLowerCase();return ve.value.filter(r=>r.name.toLowerCase().includes(P))}),Y=L(()=>{if(!x.value)return null;const P=ve.value.find(r=>r.id===x.value);return P?P.name:null}),W=L(()=>{switch(w.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),ne=P=>P.state==="Completed"?"Completado":P.state==="Progress"?"En Progreso":P.state||"Sin estado",ge=P=>P.state==="Completed"?"bg-green-100 text-green-700 border border-green-200":P.state==="Progress"?"bg-blue-100 text-blue-700 border border-blue-200":"bg-gray-100 text-gray-700 border border-gray-200",he=P=>{const r=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],s=P.id%r.length;return r[s]},xe=P=>{const r=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],s=P.id%r.length;return r[s]},je=()=>{x.value=null},Fe=v(!1),Be=v(null),Q=P=>{Be.value=P,Fe.value=!0},j=async(P,r)=>{Fe.value=!1,await Z(P,r)},Z=async(P,r)=>{var s;try{switch(P){case"editForm":y("edit",r,{userRole:((s=c.currentUser)==null?void 0:s.role)||"client"});break;case"editDocument":E.push(`/dynamic_document_dashboard/client/editor/edit/${r.id}`);break;case"preview":await te(r);break;case"delete":await H(r);break;case"letterhead":u("Membrete Individual",()=>{y("letterhead",r)});break;case"relationships":y("relationships",r);break;case"downloadPDF":await X(r);break;case"downloadWord":await U(r);break;case"email":y("email",r);break;case"formalize":await m(r);break;case"viewSignatures":y("signatures",r);break;case"sign":await A(r,y);break;default:console.warn("Unknown action:",P)}}catch(l){console.error(`Error executing action ${P}:`,l)}};return(P,r)=>(n(),i(de,null,[e("div",ml,[e("div",gl,[e("div",pl,[e("div",hl,[e("div",fl,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":r[0]||(r[0]=s=>b.value=s),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent"},null,512),[[Re,b.value]])]),o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:_(()=>[o(t(st),{class:"h-4 w-4"}),e("span",vl,p(Y.value||"Etiqueta"),1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",bl,[e("div",yl,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":r[1]||(r[1]=s=>q.value=s),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:r[2]||(r[2]=fe(()=>{},["stop"]))},null,512),[[Re,q.value]])]),e("div",xl,[o(t(ue),null,{default:_(({active:s})=>[e("a",{onClick:r[3]||(r[3]=l=>x.value=null),class:$([s?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(n(!0),i(de,null,me(N.value,s=>(n(),re(t(ue),{key:s.id},{default:_(({active:l})=>[e("a",{onClick:O=>x.value=s.id,class:$([l?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:$(["w-3 h-3 rounded-full flex-shrink-0",xe(s)])},null,2),e("span",wl,p(s.name),1)],10,_l)]),_:2},1024))),128)),N.value.length===0?(n(),i("div",$l," No se encontraron etiquetas ")):D("",!0)])])]),_:1})]),_:1}),x.value?(n(),i("button",{key:0,onClick:je,class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(Ue),{class:"h-4 w-4"}),oe(" Limpiar ")])):D("",!0)]),e("div",kl,[e("span",Cl,p(g.value.length)+" "+p(g.value.length===1?"resultado":"resultados"),1),o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:_(()=>[oe(" Ordenar: "+p(W.value)+" ",1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",Dl,[o(t(ue),null,{default:_(({active:s})=>[e("a",{onClick:r[4]||(r[4]=l=>w.value="recent"),class:$([s?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:_(({active:s})=>[e("a",{onClick:r[5]||(r[5]=l=>w.value="name"),class:$([s?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Sl,[e("div",El,[e("table",Fl,[Tl,e("tbody",Al,[(n(!0),i(de,null,me(S.value,(s,l)=>(n(),i("tr",{key:s.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:O=>Q(s)},[e("td",Pl,[e("div",Ll,[e("div",Il,[e("div",jl,[o(t(Qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",Bl,[e("div",Ul,p(s.title),1)])])]),e("td",zl,[e("span",{class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ge(s)])},p(ne(s)),3)]),e("td",Nl,[e("div",Ol,[(n(!0),i(de,null,me(s.tags,O=>(n(),i("span",{key:O.id,class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",he(O)])},p(O.name),3))),128)),!s.tags||s.tags.length===0?(n(),i("span",Rl,"-")):D("",!0)])])],8,Ml))),128))])])]),B.value>1?(n(),i("div",ql,[e("div",Vl,[e("button",{onClick:V,disabled:T.value===1,class:$(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",T.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,Ql),e("button",{onClick:ce,disabled:T.value===B.value,class:$(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",T.value===B.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Wl)]),e("div",Gl,[e("div",null,[e("p",Hl,[oe(" Mostrando "),e("span",Zl,p(le.value.start),1),oe(" a "),e("span",Jl,p(le.value.end),1),oe(" de "),e("span",Kl,p(le.value.total),1),oe(" resultados ")])]),e("div",null,[e("nav",Yl,[e("button",{onClick:V,disabled:T.value===1,class:$(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",T.value===1?"opacity-50 cursor-not-allowed":""])},[ea,o(t(ht),{class:"h-5 w-5","aria-hidden":"true"})],10,Xl),(n(!0),i(de,null,me(se.value,s=>(n(),i(de,{key:s},[s!=="..."?(n(),i("button",{key:0,onClick:l=>ye(s),class:$(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",T.value===s?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},p(s),11,ta)):(n(),i("span",sa," ... "))],64))),128)),e("button",{onClick:ce,disabled:T.value===B.value,class:$(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",T.value===B.value?"opacity-50 cursor-not-allowed":""])},[na,o(t(lt),{class:"h-5 w-5","aria-hidden":"true"})],10,oa)])])])])):D("",!0),g.value.length===0?(n(),i("div",ra,[o(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),la,aa])):D("",!0)])]),(n(),re(ft,{to:"body"},[t(C).edit.isOpen?(n(),re(St,{key:0,document:t(C).edit.document,"user-role":t(C).edit.userRole,onClose:r[6]||(r[6]=s=>t(F)("edit")),onRefresh:r[7]||(r[7]=s=>k("refresh"))},null,8,["document","user-role"])):D("",!0),t(C).email.isOpen?(n(),re(Et,{key:1,document:t(C).email.document,onClose:r[8]||(r[8]=s=>t(F)("email"))},null,8,["document"])):D("",!0),t(C).letterhead.isOpen?(n(),re(yt,{key:2,"is-visible":!0,document:t(C).letterhead.document,onClose:r[9]||(r[9]=s=>t(F)("letterhead")),onRefresh:r[10]||(r[10]=s=>k("refresh"))},null,8,["document"])):D("",!0),t(C).relationships.isOpen?(n(),re(Ft,{key:3,"is-open":!0,document:t(C).relationships.document,onClose:r[11]||(r[11]=s=>t(F)("relationships")),onRefresh:r[12]||(r[12]=s=>k("refresh"))},null,8,["document"])):D("",!0),Fe.value?(n(),re(wt,{key:4,"is-visible":Fe.value,document:Be.value,"card-type":"client",context:"table","user-store":t(c),onClose:r[13]||(r[13]=s=>Fe.value=!1),onAction:j},null,8,["is-visible","document","user-store"])):D("",!0)]))],64))}},da={class:"mb-4"},ca={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},ua={class:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"},ma={class:"flex flex-col sm:flex-row gap-3 flex-1 w-full lg:w-auto"},ga={class:"relative flex-1 min-w-[200px]"},pa={class:"max-w-[120px] truncate"},ha={class:"p-2"},fa={class:"relative mb-2"},va={class:"max-h-60 overflow-y-auto"},ba=["onClick"],ya={class:"truncate"},xa={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},_a={class:"flex items-center gap-3 w-full lg:w-auto"},wa={class:"text-sm text-gray-500 whitespace-nowrap"},$a={class:"py-1"},ka={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},Ca={class:"min-w-full divide-y divide-gray-200"},Da=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plantilla "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),Sa={class:"bg-white divide-y divide-gray-200"},Ea=["onClick"],Fa={class:"px-6 py-4 whitespace-nowrap"},Ta={class:"flex items-center"},Aa={class:"flex-shrink-0 h-10 w-10"},Ma={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},Pa={class:"ml-4"},La={class:"text-sm font-medium text-gray-900"},Ia=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-700 border border-purple-200"}," Disponible ")],-1),ja={class:"px-6 py-4 whitespace-nowrap"},Ba={class:"flex flex-wrap gap-1"},Ua={key:0,class:"text-sm text-gray-400"},za={class:"py-1"},Na=["onClick"],Oa={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Ra=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay plantillas disponibles",-1),qa={class:"mt-1 text-sm text-gray-500"},Va=e("div",{class:"mt-4"},[e("div",{class:"text-xs text-gray-400 bg-gray-100 px-3 py-2 rounded-lg inline-block"},[oe(" 💡 "),e("strong",null,"Tip:"),oe(" Las plantillas son creadas por los abogados ")])],-1),Qa={__name:"UseDocumentTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["go-back"],setup(a,{emit:h}){const d=qe();Je();const c=et(),E=h,k=v(""),u=v(""),C=v(null),y=v("recent"),F=v(!1),te=v(null),H=v({}),X=v({}),U=v(!1),m=v(-1),A=L(()=>d.publishedDocumentsUnassigned||[]),b=L(()=>{let N=[...A.value];const Y=k.value.toLowerCase();return Y&&(N=N.filter(W=>{var ne,ge;return((ne=W.title)==null?void 0:ne.toLowerCase().includes(Y))||((ge=W.tags)==null?void 0:ge.some(he=>{var xe;return(xe=he.name)==null?void 0:xe.toLowerCase().includes(Y)}))})),C.value&&(N=N.filter(W=>W.tags&&W.tags.some(ne=>ne.id===C.value))),y.value==="name"?N.sort((W,ne)=>{const ge=(W.title||"").toLowerCase(),he=(ne.title||"").toLowerCase();return ge.localeCompare(he)}):y.value==="recent"&&N.sort((W,ne)=>ne.id-W.id),N}),q=L(()=>{const N=new Map;return A.value.forEach(Y=>{Y.tags&&Y.tags.length>0&&Y.tags.forEach(W=>{N.has(W.id)||N.set(W.id,W)})}),Array.from(N.values()).sort((Y,W)=>Y.name.localeCompare(W.name))}),x=L(()=>{if(!u.value)return q.value;const N=u.value.toLowerCase();return q.value.filter(Y=>Y.name.toLowerCase().includes(N))}),w=L(()=>{if(!C.value)return null;const N=q.value.find(Y=>Y.id===C.value);return N?N.name:null}),ae=L(()=>{switch(y.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),I=L(()=>{const N=k.value&&k.value.trim().length>0,Y=C.value!==null;return N&&Y?"No se encontraron plantillas que coincidan con tu búsqueda y filtros":N?"No se encontraron plantillas que coincidan con tu búsqueda":Y?"No se encontraron plantillas con la etiqueta seleccionada":"Aún no hay plantillas disponibles para usar"}),g=N=>{const Y=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],W=N.id%Y.length;return Y[W]},T=N=>{const Y=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],W=N.id%Y.length;return Y[W]},z=()=>{C.value=null},S=N=>{N&&(d.selectedDocument=null,te.value=N,F.value=!0)},B=()=>{F.value=!1,te.value=null},le=N=>{if(N.state==="Published"&&!N.assigned_to)S(N.id);else{const W=`/dynamic_document_dashboard/document/use/editor/${N.id}/${encodeURIComponent(N.title.trim())}`;c.push(W)}},se=()=>{E("go-back")};Oe(async()=>{(!d.documents||d.documents.length===0)&&await d.init(!0)});const V=()=>U.value?b.value.length===1?"280px":b.value.length===2&&m.value===1?"340px":"280px":"auto",ce=(N,Y)=>{N&&(H.value[Y]=N)},ye=(N,Y)=>{N&&(X.value[Y]=N)},ve=(N,Y)=>{U.value=!Y,m.value=Y?-1:N,Y||setTimeout(()=>{const W=X.value[N];if(W){const ne=W.$el||W;if(ne&&ne.getBoundingClientRect){const ge=ne.getBoundingClientRect(),he=window.innerHeight;if(N===0){if(ge.bottom>he-20){const xe=ge.bottom-he+40;window.scrollBy({top:xe,behavior:"smooth"})}}else if(ge.bottom>he-10){const xe=ge.bottom-he+30;window.scrollBy({top:xe,behavior:"smooth"})}else if(ge.top<80){const xe=ge.top-100;window.scrollBy({top:xe,behavior:"smooth"})}}}},100)};return(N,Y)=>(n(),i("div",null,[e("div",da,[e("button",{onClick:se,class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors border border-gray-300"},[o(t(xs),{class:"h-4 w-4"}),oe(" Volver a Mis Documentos ")])]),e("div",ca,[e("div",ua,[e("div",ma,[e("div",ga,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":Y[0]||(Y[0]=W=>k.value=W),type:"text",placeholder:"Buscar plantillas...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent"},null,512),[[Re,k.value]])]),o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:_(()=>[o(t(st),{class:"h-4 w-4"}),e("span",pa,p(w.value||"Etiqueta"),1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",ha,[e("div",fa,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":Y[1]||(Y[1]=W=>u.value=W),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:Y[2]||(Y[2]=fe(()=>{},["stop"]))},null,512),[[Re,u.value]])]),e("div",va,[o(t(ue),null,{default:_(({active:W})=>[e("a",{onClick:Y[3]||(Y[3]=ne=>C.value=null),class:$([W?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(n(!0),i(de,null,me(x.value,W=>(n(),re(t(ue),{key:W.id},{default:_(({active:ne})=>[e("a",{onClick:ge=>C.value=W.id,class:$([ne?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:$(["w-3 h-3 rounded-full flex-shrink-0",T(W)])},null,2),e("span",ya,p(W.name),1)],10,ba)]),_:2},1024))),128)),x.value.length===0?(n(),i("div",xa," No se encontraron etiquetas ")):D("",!0)])])]),_:1})]),_:1}),C.value?(n(),i("button",{key:0,onClick:z,class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(Ue),{class:"h-4 w-4"}),oe(" Limpiar ")])):D("",!0)]),e("div",_a,[e("span",wa," Mostrando "+p(b.value.length)+" plantillas ",1),o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:_(()=>[oe(" Ordenar: "+p(ae.value)+" ",1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",$a,[o(t(ue),null,{default:_(({active:W})=>[e("a",{onClick:Y[4]||(Y[4]=ne=>y.value="recent"),class:$([W?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:_(({active:W})=>[e("a",{onClick:Y[5]||(Y[5]=ne=>y.value="name"),class:$([W?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),b.value.length>0?(n(),i("div",ka,[e("div",{class:"overflow-x-auto",style:Ge({minHeight:V()})},[e("table",Ca,[Da,e("tbody",Sa,[(n(!0),i(de,null,me(b.value,(W,ne)=>(n(),i("tr",{key:W.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:ge=>le(W)},[e("td",Fa,[e("div",Ta,[e("div",Aa,[e("div",Ma,[o(t(Qe),{class:"h-5 w-5 text-purple-600"})])]),e("div",Pa,[e("div",La,p(W.title),1)])])]),Ia,e("td",ja,[e("div",Ba,[(n(!0),i(de,null,me(W.tags,ge=>(n(),i("span",{key:ge.id,class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",g(ge)])},p(ge.name),3))),128)),!W.tags||W.tags.length===0?(n(),i("span",Ua,"-")):D("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:Y[6]||(Y[6]=fe(()=>{},["stop"]))},[o(t(Te),{as:"div",class:"relative inline-block text-left"},{default:_(({open:ge})=>[o(t(Ae),{ref_for:!0,ref:he=>ce(he,ne),onClick:he=>ve(ne,ge),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:_(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),o(t(Me),{ref_for:!0,ref:he=>ye(he,ne),class:$([b.value.length>2&&ne>0&&ne>=b.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:_(()=>[e("div",za,[o(t(ue),null,{default:_(({active:he})=>[e("a",{onClick:xe=>le(W),class:$([he?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Usar plantilla ",10,Na)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,Ea))),128))])])],4)])):(n(),i("div",Oa,[o(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),Ra,e("p",qa,p(I.value),1),Va])),Pe(o(Ke,null,{default:_(()=>[te.value!==null?(n(),re(Yt,{key:0,"document-id":te.value,onClose:B},null,8,["document-id"])):D("",!0)]),_:1},512),[[mt,F.value]])]))}},Ye=a=>(gt("data-v-20a3a659"),a=a(),pt(),a),Wa={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},Ga={class:"mb-4"},Ha={class:"relative w-full"},Za={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},Ja={class:"flex items-center gap-2 min-w-0"},Ka={class:"truncate"},Ya={class:"py-1"},Xa=["onClick"],ei={class:"flex items-center gap-2 min-w-0"},ti={class:"truncate"},si={class:"p-2"},oi={class:"relative mb-2"},ni={class:"max-h-60 overflow-y-auto"},ri=["onClick"],li={class:"truncate"},ai={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},ii={class:"flex items-center justify-stretch"},di=Ye(()=>e("span",null,"Limpiar",-1)),ci={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},ui={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},mi={class:"flex items-center gap-2"},gi=Ye(()=>e("span",{class:"hidden sm:inline"},"Exportar",-1)),pi={class:"py-1"},hi=Ye(()=>e("span",{class:"hidden sm:inline"},"Ordenar:",-1)),fi={class:"py-1"},vi={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},bi={class:"overflow-x-auto",style:{"overflow-y":"visible"}},yi={class:"min-w-full divide-y divide-gray-200"},xi={class:"bg-gray-50"},_i={scope:"col",class:"w-12 px-6 py-3"},wi=["checked"],$i=Ye(()=>e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Minuta ",-1)),ki=Ye(()=>e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1)),Ci=Ye(()=>e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1)),Di={class:"bg-white divide-y divide-gray-200"},Si=["onClick"],Ei=["checked","onChange"],Fi={class:"px-6 py-4 whitespace-nowrap"},Ti={class:"flex items-center"},Ai={class:"flex-shrink-0 h-10 w-10"},Mi={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Pi={class:"ml-4"},Li={class:"text-sm font-medium text-gray-900"},Ii={class:"px-6 py-4 whitespace-nowrap"},ji={class:"px-6 py-4 whitespace-nowrap"},Bi={class:"flex flex-wrap gap-1"},Ui={key:0,class:"text-sm text-gray-400"},zi={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Ni={class:"flex flex-1 justify-between sm:hidden"},Oi=["disabled"],Ri=["disabled"],qi={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Vi={class:"text-sm text-gray-700"},Qi={class:"font-medium"},Wi={class:"font-medium"},Gi={class:"font-medium"},Hi={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Zi=["disabled"],Ji=Ye(()=>e("span",{class:"sr-only"},"Anterior",-1)),Ki=["onClick"],Yi={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},Xi=["disabled"],ed=Ye(()=>e("span",{class:"sr-only"},"Siguiente",-1)),td={key:0,class:"text-center py-12"},sd=Ye(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos",-1)),od=Ye(()=>e("p",{class:"mt-1 text-sm text-gray-500"},"No se encontraron documentos con los filtros seleccionados.",-1)),nd={__name:"DocumentListLawyer",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null}},emits:["refresh"],setup(a,{emit:h}){const d=qe(),c=Je(),E=et(),k=h,{activeModals:u,openModal:C,closeModal:y,getUserRole:F}=vt(d,c),{handlePreviewDocument:te,deleteDocument:H,downloadPDFDocument:X,downloadWordDocument:U,copyDocument:m,publishDocument:A,moveToDraft:b,formalizeDocument:q,signDocument:x,downloadSignedDocument:w}=bt(d,c,k),ae=v([]),I=v([]),g=a,T=v(""),z=v(""),S=v(null),B=v(null),le=v("recent"),se=v([]),V=v(1),ce=v(10),ye=M=>{switch(M.state){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return"Desconocido"}},ve=M=>{switch(M.state){case"Published":case"FullySigned":return"bg-green-100 text-green-700 border border-green-200";case"Draft":case"Progress":return"bg-blue-100 text-blue-700 border border-blue-200";case"PendingSignatures":return"bg-yellow-100 text-yellow-700 border border-yellow-200";case"Completed":return"bg-purple-100 text-purple-700 border border-purple-200";default:return"bg-gray-100 text-gray-700 border border-gray-200"}},N=M=>{const f=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],J=M.id%f.length;return f[J]},Y=M=>{switch(M){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return M}},W=L(()=>{const M=new Set;return je.value.forEach(f=>{f.state&&M.add(f.state)}),Array.from(M).sort()}),ne=L(()=>{const M=new Map;return je.value.forEach(f=>{f.tags&&f.tags.length>0&&f.tags.forEach(J=>{M.has(J.id)||M.set(J.id,J)})}),Array.from(M.values()).sort((f,J)=>f.name.localeCompare(J.name))}),ge=L(()=>{if(!z.value)return ne.value;const M=z.value.toLowerCase();return ne.value.filter(f=>f.name.toLowerCase().includes(M))}),he=L(()=>{if(!B.value)return null;const M=ne.value.find(f=>f.id===B.value);return M?M.name:null}),xe=M=>{const f=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],J=M.id%f.length;return f[J]},je=L(()=>{if(g.promptDocuments)return[];const f=(d.getDocumentsByLawyerId(c.currentUser.id)||[]).filter(Ce=>Ce.state!=="FullySigned"),J=g.selectedTags?g.selectedTags.map(Ce=>Ce.id):[];return d.filteredDocumentsBySearchAndTags(g.searchQuery,c,J).filter(Ce=>f.some(ke=>ke.id===Ce.id))}),Fe=L(()=>{if(g.promptDocuments&&g.promptDocuments.length>0){let M=g.promptDocuments.filter(f=>f.title&&f.title.toLowerCase().includes((g.searchQuery||"").toLowerCase()));if(g.selectedTags&&g.selectedTags.length>0){const f=g.selectedTags.map(J=>J.id);M=M.filter(J=>!J.tags||J.tags.length===0?!1:J.tags.some(R=>f.includes(R.id)))}return M}return[]}),Be=L(()=>g.promptDocuments?Fe.value:je.value),Q=L(()=>{let M=[...Be.value];const f=T.value.toLowerCase();return f&&(M=M.filter(J=>{var R,Ce,ke;return((R=J.title)==null?void 0:R.toLowerCase().includes(f))||((Ce=J.state)==null?void 0:Ce.toLowerCase().includes(f))||((ke=J.tags)==null?void 0:ke.some(Tt=>{var Ze;return(Ze=Tt.name)==null?void 0:Ze.toLowerCase().includes(f)}))})),S.value&&(M=M.filter(J=>J.state===S.value)),B.value&&(M=M.filter(J=>J.tags&&J.tags.some(R=>R.id===B.value))),le.value==="name"?M.sort((J,R)=>{const Ce=(J.title||"").toLowerCase(),ke=(R.title||"").toLowerCase();return Ce.localeCompare(ke)}):le.value==="recent"&&M.sort((J,R)=>R.id-J.id),M}),j=L(()=>{const M=(V.value-1)*ce.value,f=M+ce.value;return Q.value.slice(M,f)}),Z=L(()=>Math.ceil(Q.value.length/ce.value)),P=L(()=>{const M=(V.value-1)*ce.value+1,f=Math.min(V.value*ce.value,Q.value.length);return{start:M,end:f,total:Q.value.length}});we([T,S,B],()=>{V.value=1});const r=L(()=>{switch(le.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}});L(()=>{if(g.promptDocuments)return null;const M=d.lastUpdatedDocumentId,f=localStorage.getItem("lastUpdatedDocumentId"),J=[...je.value];return M&&J.some(ke=>String(ke.id)===String(M))?M:f&&J.some(ke=>String(ke.id)===String(f))?f:null});const s=async()=>{try{const M=c.currentUser.id,f=await Dt(`dynamic-documents/user/${M}/pending-documents-full/`),J=await Dt(`dynamic-documents/user/${M}/signed-documents/`);f.status===200&&(ae.value=f.data),J.status===200&&(I.value=J.data)}catch(M){console.error("Error fetching lawyer documents:",M),M.response&&(console.error("Error response data:",M.response.data),console.error("Error status:",M.response.status))}};we(Be,M=>{if(!g.promptDocuments&&d.lastUpdatedDocumentId&&!M.some(J=>String(J.id)===String(d.lastUpdatedDocumentId))&&M.length>0){const R=[...M].sort((Ce,ke)=>ke.id-Ce.id)[0].id;d.lastUpdatedDocumentId=R,localStorage.setItem("lastUpdatedDocumentId",R)}});const l=M=>{M&&setTimeout(()=>{try{const f=document.querySelectorAll(`[data-document-id="${M}"]`);if(f.length>0){const J=f[0];J.classList.remove("animate-pulse-highlight-green","animate-pulse-highlight-blue"),J.offsetWidth,(J.querySelector("[data-document-id]")||J).classList.contains("border-green-400")?J.classList.add("animate-pulse-highlight-green"):J.classList.add("animate-pulse-highlight-blue"),J.scrollIntoView({behavior:"smooth",block:"center"})}}catch(f){console.error("Error forcing highlight:",f)}},100)};window.forceDocumentHighlight=l,Oe(async()=>{if(g.promptDocuments)return;await d.init();const M=localStorage.getItem("lastUpdatedDocumentId");M&&(d.lastUpdatedDocumentId=M,setTimeout(()=>{Be.value.some(J=>String(J.id)===String(M))&&l(M)},500)),s()});const O=L(()=>Q.value.length>0&&se.value.length===Q.value.length),pe=()=>{O.value?se.value=[]:se.value=Q.value.map(M=>M.id)},_e=M=>{const f=se.value.indexOf(M);f>-1?se.value.splice(f,1):se.value.push(M)},Ve=()=>{se.value=Q.value.map(M=>M.id)},Se=()=>{se.value=[]},We=()=>{S.value=null,B.value=null},ee=()=>{V.value>1&&V.value--},G=()=>{V.value<Z.value&&V.value++},ie=M=>{M>=1&&M<=Z.value&&(V.value=M)},K=L(()=>{const M=Z.value,f=V.value,J=[];if(M<=7)for(let R=1;R<=M;R++)J.push(R);else if(f<=4){for(let R=1;R<=5;R++)J.push(R);J.push("..."),J.push(M)}else if(f>=M-3){J.push(1),J.push("...");for(let R=M-4;R<=M;R++)J.push(R)}else J.push(1),J.push("..."),J.push(f-1),J.push(f),J.push(f+1),J.push("..."),J.push(M);return J}),be=()=>{const M=se.value.length>0?Q.value.filter(Ze=>se.value.includes(Ze.id)):Q.value,f=["Nombre Minuta","Estado","Etiquetas"],J=M.map(Ze=>[Ze.title||"",ye(Ze),Ze.tags?Ze.tags.map(At=>At.name).join(", "):""]),R=[f.join(","),...J.map(Ze=>Ze.map(At=>`"${At}"`).join(","))].join(`
`),Ce=new Blob([R],{type:"text/csv;charset=utf-8;"}),ke=document.createElement("a"),Tt=URL.createObjectURL(Ce);ke.setAttribute("href",Tt),ke.setAttribute("download",`documentos_${new Date().toISOString().split("T")[0]}.csv`),ke.style.visibility="hidden",document.body.appendChild(ke),ke.click(),document.body.removeChild(ke)},$e=async(M,f)=>{try{switch(M){case"edit":E.push(`/dynamic_document_dashboard/lawyer/editor/edit/${f.id}`);break;case"permissions":C("permissions",f);break;case"relationships":C("relationships",f);break;case"preview":await te(f);break;case"delete":await H(f);break;case"downloadPDF":await X(f);break;case"downloadWord":await U(f);break;case"email":C("email",f);break;case"copy":await m(f);break;case"publish":await A(f);break;case"draft":await b(f);break;case"formalize":await q(f);break;case"viewSignatures":C("signatures",f);break;case"sign":await x(f,C);break;case"letterhead":C("letterhead",f);break;default:console.warn("Unknown action:",M)}}catch(J){console.error(`Error executing action ${M}:`,J)}},Ie=v(!1),Ee=v(null),ze=M=>{Ee.value=M,Ie.value=!0},es=async(M,f)=>{Ie.value=!1,await $e(M,f)};return(M,f)=>{var J;return n(),i("div",null,[e("div",Wa,[e("div",Ga,[e("div",Ha,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":f[0]||(f[0]=R=>T.value=R),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Re,T.value]])])]),e("div",Za,[o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:_(()=>[e("div",Ja,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",Ka,p(S.value||"Estado"),1)]),o(t(Ne),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Me),{class:"absolute left-0 z-10 mt-2 w-full min-w-[14rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",Ya,[o(t(ue),null,{default:_(({active:R})=>[e("a",{onClick:f[1]||(f[1]=Ce=>S.value=null),class:$([R?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(n(!0),i(de,null,me(W.value,R=>(n(),re(t(ue),{key:R},{default:_(({active:Ce})=>[e("a",{onClick:ke=>S.value=R,class:$([Ce?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},p(Y(R)),11,Xa)]),_:2},1024))),128))])]),_:1})]),_:1}),o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:_(()=>[e("div",ei,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",ti,p(he.value||"Etiqueta"),1)]),o(t(Ne),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Me),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",si,[e("div",oi,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":f[2]||(f[2]=R=>z.value=R),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:f[3]||(f[3]=fe(()=>{},["stop"]))},null,512),[[Re,z.value]])]),e("div",ni,[o(t(ue),null,{default:_(({active:R})=>[e("a",{onClick:f[4]||(f[4]=Ce=>B.value=null),class:$([R?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(n(!0),i(de,null,me(ge.value,R=>(n(),re(t(ue),{key:R.id},{default:_(({active:Ce})=>[e("a",{onClick:ke=>B.value=R.id,class:$([Ce?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:$(["w-3 h-3 rounded-full flex-shrink-0",xe(R)])},null,2),e("span",li,p(R.name),1)],10,ri)]),_:2},1024))),128)),ge.value.length===0?(n(),i("div",ai," No se encontraron etiquetas ")):D("",!0)])])]),_:1})]),_:1}),e("div",ii,[S.value||B.value?(n(),i("button",{key:0,onClick:We,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(Ue),{class:"h-4 w-4 flex-shrink-0"}),di])):D("",!0)])]),e("div",ci,[e("div",ui,[e("div",mi,[e("button",{onClick:be,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[o(t(tt),{class:"h-4 w-4"}),gi]),o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:_(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",pi,[o(t(ue),null,{default:_(({active:R})=>[e("a",{onClick:Ve,class:$([R?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),o(t(ue),null,{default:_(({active:R})=>[e("a",{onClick:Se,class:$([R?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:_(()=>[hi,oe(" "+p(r.value)+" ",1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",fi,[o(t(ue),null,{default:_(({active:R})=>[e("a",{onClick:f[5]||(f[5]=Ce=>le.value="recent"),class:$([R?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:_(({active:R})=>[e("a",{onClick:f[6]||(f[6]=Ce=>le.value="name"),class:$([R?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",vi,[e("div",bi,[e("table",yi,[e("thead",xi,[e("tr",null,[e("th",_i,[e("input",{type:"checkbox",checked:O.value,onChange:pe,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,wi)]),$i,ki,Ci])]),e("tbody",Di,[(n(!0),i(de,null,me(j.value,(R,Ce)=>(n(),i("tr",{key:R.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:ke=>ze(R)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:f[7]||(f[7]=fe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:se.value.includes(R.id),onChange:ke=>_e(R.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Ei)]),e("td",Fi,[e("div",Ti,[e("div",Ai,[e("div",Mi,[o(t(Qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",Pi,[e("div",Li,p(R.title),1)])])]),e("td",Ii,[e("span",{class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ve(R)])},p(ye(R)),3)]),e("td",ji,[e("div",Bi,[(n(!0),i(de,null,me(R.tags,ke=>(n(),i("span",{key:ke.id,class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",N(ke)])},p(ke.name),3))),128)),!R.tags||R.tags.length===0?(n(),i("span",Ui,"-")):D("",!0)])])],8,Si))),128))])])]),Z.value>1?(n(),i("div",zi,[e("div",Ni,[e("button",{onClick:ee,disabled:V.value===1,class:$(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",V.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,Oi),e("button",{onClick:G,disabled:V.value===Z.value,class:$(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",V.value===Z.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Ri)]),e("div",qi,[e("div",null,[e("p",Vi,[oe(" Mostrando "),e("span",Qi,p(P.value.start),1),oe(" a "),e("span",Wi,p(P.value.end),1),oe(" de "),e("span",Gi,p(P.value.total),1),oe(" resultados ")])]),e("div",null,[e("nav",Hi,[e("button",{onClick:ee,disabled:V.value===1,class:$(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",V.value===1?"opacity-50 cursor-not-allowed":""])},[Ji,o(t(ht),{class:"h-5 w-5","aria-hidden":"true"})],10,Zi),(n(!0),i(de,null,me(K.value,R=>(n(),i(de,{key:R},[R!=="..."?(n(),i("button",{key:0,onClick:Ce=>ie(R),class:$(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",V.value===R?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},p(R),11,Ki)):(n(),i("span",Yi," ... "))],64))),128)),e("button",{onClick:G,disabled:V.value===Z.value,class:$(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",V.value===Z.value?"opacity-50 cursor-not-allowed":""])},[ed,o(t(lt),{class:"h-5 w-5","aria-hidden":"true"})],10,Xi)])])])])):D("",!0)]),Q.value.length===0?(n(),i("div",td,[o(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),sd,od])):D("",!0),o(jt,{isVisible:t(nt),documentData:t(It),onClose:f[8]||(f[8]=R=>nt.value=!1)},null,8,["isVisible","documentData"]),(n(),re(ft,{to:"body"},[t(u).edit.isOpen?(n(),re(t(St),{key:0,document:t(u).edit.document,"user-role":t(F)(),onClose:f[9]||(f[9]=R=>t(y)("edit")),onRefresh:f[10]||(f[10]=R=>k("refresh"))},null,8,["document","user-role"])):D("",!0),t(u).email.isOpen?(n(),re(t(Et),{key:1,document:t(u).email.document,onClose:f[11]||(f[11]=R=>t(y)("email"))},null,8,["document"])):D("",!0),t(u).signatures.isOpen?(n(),re(t(Zt),{key:2,"document-id":(J=t(u).signatures.document)==null?void 0:J.id,onClose:f[12]||(f[12]=R=>t(y)("signatures")),onRefresh:f[13]||(f[13]=R=>k("refresh"))},null,8,["document-id"])):D("",!0),t(u).permissions.isOpen?(n(),re(t(hs),{key:3,"is-open":t(u).permissions.isOpen,document:t(u).permissions.document,onClose:f[14]||(f[14]=R=>t(y)("permissions")),onSaved:f[15]||(f[15]=R=>k("refresh"))},null,8,["is-open","document"])):D("",!0),t(u).letterhead.isOpen?(n(),re(yt,{key:4,"is-visible":t(u).letterhead.isOpen,document:t(u).letterhead.document,onClose:f[16]||(f[16]=R=>t(y)("letterhead")),onUploaded:f[17]||(f[17]=R=>k("refresh")),onDeleted:f[18]||(f[18]=R=>k("refresh"))},null,8,["is-visible","document"])):D("",!0),t(u).relationships.isOpen?(n(),re(Ft,{key:5,"is-open":t(u).relationships.isOpen,document:t(u).relationships.document,onClose:f[19]||(f[19]=R=>t(y)("relationships")),onRefresh:f[20]||(f[20]=R=>k("refresh"))},null,8,["is-open","document"])):D("",!0),Ie.value?(n(),re(wt,{key:6,"is-visible":Ie.value,document:Ee.value,"card-type":"lawyer",context:"table","user-store":t(c),onClose:f[21]||(f[21]=R=>Ie.value=!1),onAction:es},null,8,["is-visible","document","user-store"])):D("",!0)]))])}}},rd=xt(nd,[["__scopeId","data-v-20a3a659"]]),ld={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},ad={class:"mb-4"},id={class:"relative w-full"},dd={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},cd={class:"flex items-center gap-2 min-w-0"},ud={class:"truncate"},md={class:"py-1"},gd=["onClick"],pd={class:"flex items-center justify-stretch"},hd=e("span",null,"Limpiar",-1),fd={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},vd={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},bd={class:"flex items-center gap-2"},yd=e("span",{class:"hidden sm:inline"},"Exportar",-1),xd={class:"py-1"},_d=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),wd={class:"py-1"},$d={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},kd={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Cd={class:"min-w-full divide-y divide-gray-200"},Dd={class:"bg-gray-50"},Sd={scope:"col",class:"w-12 px-6 py-3"},Ed=["checked"],Fd=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Td=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),Ad=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),Md=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),Pd={class:"bg-white divide-y divide-gray-200"},Ld=["onClick"],Id=["checked","onChange"],jd={class:"px-6 py-4 whitespace-nowrap"},Bd={class:"flex items-center"},Ud={class:"flex-shrink-0 h-10 w-10"},zd={class:"h-10 w-10 rounded-lg bg-green-100 flex items-center justify-center"},Nd={class:"ml-4"},Od={class:"text-sm font-medium text-gray-900"},Rd={class:"px-6 py-4 whitespace-nowrap"},qd={class:"text-sm text-gray-900"},Vd=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-700 border border-green-200"}," Completado ")],-1),Qd={class:"px-6 py-4 whitespace-nowrap"},Wd={class:"flex flex-wrap gap-1"},Gd={key:0,class:"text-sm text-gray-400"},Hd={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Zd={class:"flex flex-1 justify-between sm:hidden"},Jd=["disabled"],Kd=["disabled"],Yd={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Xd={class:"text-sm text-gray-700"},ec={class:"font-medium"},tc={class:"font-medium"},sc={class:"font-medium"},oc={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},nc=["disabled"],rc=e("span",{class:"sr-only"},"Anterior",-1),lc=["onClick"],ac={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},ic=["disabled"],dc=e("span",{class:"sr-only"},"Siguiente",-1),cc={key:0,class:"text-center py-12"},uc=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos completados",-1),mc=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos completados por clientes aparecerán aquí.",-1),gc={__name:"DocumentFinishedByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(a,{emit:h}){const d=qe(),c=Je(),E=et(),k=a,u=h,{activeModals:C,openModal:y,closeModal:F,getUserRole:te}=vt(d,c),{handlePreviewDocument:H,deleteDocument:X,downloadPDFDocument:U,downloadWordDocument:m}=bt(d,c,u),A=v(""),b=v(null),q=v("recent"),x=v([]),w=v(1),ae=v(10);Oe(()=>{d.init(),c.init()});const I=L(()=>{const r=d.completedDocumentsByClient,s=k.selectedTags?k.selectedTags.map(O=>O.id):[];return d.filteredDocumentsBySearchAndTags(k.searchQuery,c,s).filter(O=>r.some(pe=>pe.id===O.id))}),g=L(()=>{let r=[...I.value];const s=A.value.toLowerCase();return s&&(r=r.filter(l=>{var O,pe;return((O=l.title)==null?void 0:O.toLowerCase().includes(s))||((pe=l.tags)==null?void 0:pe.some(_e=>{var Ve;return(Ve=_e.name)==null?void 0:Ve.toLowerCase().includes(s)}))})),b.value&&(r=r.filter(l=>l.tags&&l.tags.some(O=>O.id===b.value))),q.value==="name"?r.sort((l,O)=>{const pe=(l.title||"").toLowerCase(),_e=(O.title||"").toLowerCase();return pe.localeCompare(_e)}):q.value==="recent"&&r.sort((l,O)=>O.id-l.id),r}),T=L(()=>{const r=(w.value-1)*ae.value,s=r+ae.value;return g.value.slice(r,s)}),z=L(()=>Math.ceil(g.value.length/ae.value)),S=L(()=>{const r=(w.value-1)*ae.value+1,s=Math.min(w.value*ae.value,g.value.length);return{start:r,end:s,total:g.value.length}});we([A,b],()=>{w.value=1});const B=L(()=>{const r=new Map;return I.value.forEach(s=>{s.tags&&s.tags.length>0&&s.tags.forEach(l=>{r.has(l.id)||r.set(l.id,l)})}),Array.from(r.values()).sort((s,l)=>s.name.localeCompare(l.name))}),le=L(()=>{if(!b.value)return null;const r=B.value.find(s=>s.id===b.value);return r?r.name:null}),se=L(()=>{switch(q.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),V=r=>r.client_name?r.client_name:r.client?`${r.client.first_name||""} ${r.client.last_name||""}`.trim():"Cliente",ce=r=>{const s=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],l=r.id%s.length;return s[l]},ye=L(()=>g.value.length>0&&x.value.length===g.value.length),ve=()=>{ye.value?x.value=[]:x.value=g.value.map(r=>r.id)},N=r=>{const s=x.value.indexOf(r);s>-1?x.value.splice(s,1):x.value.push(r)},Y=()=>{x.value=g.value.map(r=>r.id)},W=()=>{x.value=[]},ne=()=>{b.value=null},ge=()=>{w.value>1&&w.value--},he=()=>{w.value<z.value&&w.value++},xe=r=>{r>=1&&r<=z.value&&(w.value=r)},je=L(()=>{const r=z.value,s=w.value,l=[];if(r<=7)for(let O=1;O<=r;O++)l.push(O);else if(s<=4){for(let O=1;O<=5;O++)l.push(O);l.push("..."),l.push(r)}else if(s>=r-3){l.push(1),l.push("...");for(let O=r-4;O<=r;O++)l.push(O)}else l.push(1),l.push("..."),l.push(s-1),l.push(s),l.push(s+1),l.push("..."),l.push(r);return l}),Fe=()=>{const r=x.value.length>0?g.value.filter(Se=>x.value.includes(Se.id)):g.value,s=["Nombre Documento","Cliente","Estado","Etiquetas"],l=r.map(Se=>[Se.title||"",V(Se),"Completado",Se.tags?Se.tags.map(We=>We.name).join(", "):""]),O=[s.join(","),...l.map(Se=>Se.map(We=>`"${We}"`).join(","))].join(`
`),pe=new Blob([O],{type:"text/csv;charset=utf-8;"}),_e=document.createElement("a"),Ve=URL.createObjectURL(pe);_e.setAttribute("href",Ve),_e.setAttribute("download",`documentos_completados_${new Date().toISOString().split("T")[0]}.csv`),_e.style.visibility="hidden",document.body.appendChild(_e),_e.click(),document.body.removeChild(_e)},Be=async(r,s)=>{try{switch(r){case"editForm":y("edit",s,{userRole:te()});break;case"editDocument":E.push(`/dynamic_document_dashboard/client/editor/edit/${s.id}`);break;case"preview":await H(s);break;case"delete":await X(s);break;case"letterhead":y("letterhead",s);break;case"relationships":y("relationships",s);break;case"downloadPDF":await U(s);break;case"downloadWord":await m(s);break;case"email":y("email",s);break;default:console.warn("Unknown action:",r)}}catch(l){console.error(`Error executing action ${r}:`,l)}},Q=v(!1),j=v(null),Z=r=>{j.value=r,Q.value=!0},P=async(r,s)=>{Q.value=!1,await Be(r,s)};return(r,s)=>(n(),i("div",null,[e("div",ld,[e("div",ad,[e("div",id,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>A.value=l),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Re,A.value]])])]),e("div",dd,[o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:_(()=>[e("div",cd,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",ud,p(le.value||"Etiqueta"),1)]),o(t(Ne),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Me),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:_(()=>[e("div",md,[o(t(ue),null,{default:_(({active:l})=>[e("a",{onClick:s[1]||(s[1]=O=>b.value=null),class:$([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(n(!0),i(de,null,me(B.value,l=>(n(),re(t(ue),{key:l.id},{default:_(({active:O})=>[e("a",{onClick:pe=>b.value=l.id,class:$([O?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},p(l.name),11,gd)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",pd,[b.value?(n(),i("button",{key:0,onClick:ne,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(Ue),{class:"h-4 w-4 flex-shrink-0"}),hd])):D("",!0)])]),e("div",fd,[e("div",vd,[e("div",bd,[e("button",{onClick:Fe,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[o(t(tt),{class:"h-4 w-4"}),yd]),o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:_(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",xd,[o(t(ue),null,{default:_(({active:l})=>[e("a",{onClick:Y,class:$([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),o(t(ue),null,{default:_(({active:l})=>[e("a",{onClick:W,class:$([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:_(()=>[_d,oe(" "+p(se.value)+" ",1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",wd,[o(t(ue),null,{default:_(({active:l})=>[e("a",{onClick:s[2]||(s[2]=O=>q.value="recent"),class:$([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:_(({active:l})=>[e("a",{onClick:s[3]||(s[3]=O=>q.value="name"),class:$([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",$d,[e("div",kd,[e("table",Cd,[e("thead",Dd,[e("tr",null,[e("th",Sd,[e("input",{type:"checkbox",checked:ye.value,onChange:ve,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Ed)]),Fd,Td,Ad,Md])]),e("tbody",Pd,[(n(!0),i(de,null,me(T.value,(l,O)=>(n(),i("tr",{key:l.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:pe=>Z(l)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:s[4]||(s[4]=fe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:x.value.includes(l.id),onChange:pe=>N(l.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Id)]),e("td",jd,[e("div",Bd,[e("div",Ud,[e("div",zd,[o(t(Qe),{class:"h-5 w-5 text-green-600"})])]),e("div",Nd,[e("div",Od,p(l.title),1)])])]),e("td",Rd,[e("div",qd,p(V(l)),1)]),Vd,e("td",Qd,[e("div",Wd,[(n(!0),i(de,null,me(l.tags,pe=>(n(),i("span",{key:pe.id,class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ce(pe)])},p(pe.name),3))),128)),!l.tags||l.tags.length===0?(n(),i("span",Gd,"-")):D("",!0)])])],8,Ld))),128))])])]),z.value>1?(n(),i("div",Hd,[e("div",Zd,[e("button",{onClick:ge,disabled:w.value===1,class:$(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",w.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,Jd),e("button",{onClick:he,disabled:w.value===z.value,class:$(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",w.value===z.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Kd)]),e("div",Yd,[e("div",null,[e("p",Xd,[oe(" Mostrando "),e("span",ec,p(S.value.start),1),oe(" a "),e("span",tc,p(S.value.end),1),oe(" de "),e("span",sc,p(S.value.total),1),oe(" resultados ")])]),e("div",null,[e("nav",oc,[e("button",{onClick:ge,disabled:w.value===1,class:$(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",w.value===1?"opacity-50 cursor-not-allowed":""])},[rc,o(t(ht),{class:"h-5 w-5","aria-hidden":"true"})],10,nc),(n(!0),i(de,null,me(je.value,l=>(n(),i(de,{key:l},[l!=="..."?(n(),i("button",{key:0,onClick:O=>xe(l),class:$(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",w.value===l?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},p(l),11,lc)):(n(),i("span",ac," ... "))],64))),128)),e("button",{onClick:he,disabled:w.value===z.value,class:$(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",w.value===z.value?"opacity-50 cursor-not-allowed":""])},[dc,o(t(lt),{class:"h-5 w-5","aria-hidden":"true"})],10,ic)])])])])):D("",!0)]),g.value.length===0?(n(),i("div",cc,[o(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),uc,mc])):D("",!0),(n(),re(ft,{to:"body"},[t(C).edit.isOpen?(n(),re(t(St),{key:0,document:t(C).edit.document,"user-role":t(te)(),onClose:s[5]||(s[5]=l=>t(F)("edit")),onRefresh:s[6]||(s[6]=l=>u("refresh"))},null,8,["document","user-role"])):D("",!0),t(C).email.isOpen?(n(),re(t(Et),{key:1,document:t(C).email.document,onClose:s[7]||(s[7]=l=>t(F)("email"))},null,8,["document"])):D("",!0),t(C).letterhead.isOpen?(n(),re(yt,{key:2,"is-visible":t(C).letterhead.isOpen,document:t(C).letterhead.document,onClose:s[8]||(s[8]=l=>t(F)("letterhead")),onUploaded:s[9]||(s[9]=l=>u("refresh")),onDeleted:s[10]||(s[10]=l=>u("refresh"))},null,8,["is-visible","document"])):D("",!0),t(C).relationships.isOpen?(n(),re(Ft,{key:3,"is-open":t(C).relationships.isOpen,document:t(C).relationships.document,onClose:s[11]||(s[11]=l=>t(F)("relationships")),onRefresh:s[12]||(s[12]=l=>u("refresh"))},null,8,["is-open","document"])):D("",!0),Q.value?(n(),re(wt,{key:4,"is-visible":Q.value,document:j.value,"card-type":"client",context:"table","user-store":t(c),onClose:s[13]||(s[13]=l=>Q.value=!1),onAction:P},null,8,["is-visible","document","user-store"])):D("",!0)]))]))}},pc={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},hc={class:"mb-4"},fc={class:"relative w-full"},vc={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},bc={class:"flex items-center gap-2 min-w-0"},yc={class:"truncate"},xc={class:"py-1"},_c=["onClick"],wc={class:"flex items-center justify-stretch"},$c=e("span",null,"Limpiar",-1),kc={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},Cc={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Dc={class:"flex items-center gap-2"},Sc=e("span",{class:"hidden sm:inline"},"Exportar",-1),Ec={class:"py-1"},Fc=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),Tc={class:"py-1"},Ac={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Mc={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Pc={class:"min-w-full divide-y divide-gray-200"},Lc={class:"bg-gray-50"},Ic={scope:"col",class:"w-12 px-6 py-3"},jc=["checked"],Bc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Uc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),zc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),Nc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),Oc={class:"bg-white divide-y divide-gray-200"},Rc=["onClick"],qc=["checked","onChange"],Vc={class:"px-6 py-4 whitespace-nowrap"},Qc={class:"flex items-center"},Wc={class:"flex-shrink-0 h-10 w-10"},Gc={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Hc={class:"ml-4"},Zc={class:"text-sm font-medium text-gray-900"},Jc={class:"px-6 py-4 whitespace-nowrap"},Kc={class:"text-sm text-gray-900"},Yc=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-700 border border-blue-200"}," En Progreso ")],-1),Xc={class:"px-6 py-4 whitespace-nowrap"},eu={class:"flex flex-wrap gap-1"},tu={key:0,class:"text-sm text-gray-400"},su={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},ou={class:"flex flex-1 justify-between sm:hidden"},nu=["disabled"],ru=["disabled"],lu={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},au={class:"text-sm text-gray-700"},iu={class:"font-medium"},du={class:"font-medium"},cu={class:"font-medium"},uu={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},mu=["disabled"],gu=e("span",{class:"sr-only"},"Anterior",-1),pu=["onClick"],hu={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},fu=["disabled"],vu=e("span",{class:"sr-only"},"Siguiente",-1),bu={key:0,class:"text-center py-12"},yu=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos en progreso",-1),xu=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos en progreso por clientes aparecerán aquí.",-1),_u={__name:"DocumentInProgressByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(a,{emit:h}){const d=qe(),c=Je(),E=et(),k=a,u=h,{activeModals:C,openModal:y,closeModal:F,getUserRole:te}=vt(d,c),{handlePreviewDocument:H,deleteDocument:X,downloadPDFDocument:U,downloadWordDocument:m}=bt(d,c,u),A=v(""),b=v(null),q=v("recent"),x=v([]),w=v(1),ae=v(10);Oe(()=>{d.init(),c.init()});const I=L(()=>{const r=d.progressDocumentsByClient,s=k.selectedTags?k.selectedTags.map(O=>O.id):[];return d.filteredDocumentsBySearchAndTags(k.searchQuery,c,s).filter(O=>r.some(pe=>pe.id===O.id))}),g=L(()=>{let r=[...I.value];const s=A.value.toLowerCase();return s&&(r=r.filter(l=>{var O,pe;return((O=l.title)==null?void 0:O.toLowerCase().includes(s))||((pe=l.tags)==null?void 0:pe.some(_e=>{var Ve;return(Ve=_e.name)==null?void 0:Ve.toLowerCase().includes(s)}))})),b.value&&(r=r.filter(l=>l.tags&&l.tags.some(O=>O.id===b.value))),q.value==="name"?r.sort((l,O)=>{const pe=(l.title||"").toLowerCase(),_e=(O.title||"").toLowerCase();return pe.localeCompare(_e)}):q.value==="recent"&&r.sort((l,O)=>O.id-l.id),r}),T=L(()=>{const r=(w.value-1)*ae.value,s=r+ae.value;return g.value.slice(r,s)}),z=L(()=>Math.ceil(g.value.length/ae.value)),S=L(()=>{const r=(w.value-1)*ae.value+1,s=Math.min(w.value*ae.value,g.value.length);return{start:r,end:s,total:g.value.length}});we([A,b],()=>{w.value=1});const B=L(()=>{const r=new Map;return I.value.forEach(s=>{s.tags&&s.tags.length>0&&s.tags.forEach(l=>{r.has(l.id)||r.set(l.id,l)})}),Array.from(r.values()).sort((s,l)=>s.name.localeCompare(l.name))}),le=L(()=>{if(!b.value)return null;const r=B.value.find(s=>s.id===b.value);return r?r.name:null}),se=L(()=>{switch(q.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),V=r=>r.client_name?r.client_name:r.client?`${r.client.first_name||""} ${r.client.last_name||""}`.trim():"Cliente",ce=r=>{const s=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],l=r.id%s.length;return s[l]},ye=L(()=>g.value.length>0&&x.value.length===g.value.length),ve=()=>{ye.value?x.value=[]:x.value=g.value.map(r=>r.id)},N=r=>{const s=x.value.indexOf(r);s>-1?x.value.splice(s,1):x.value.push(r)},Y=()=>{x.value=g.value.map(r=>r.id)},W=()=>{x.value=[]},ne=()=>{b.value=null},ge=()=>{w.value>1&&w.value--},he=()=>{w.value<z.value&&w.value++},xe=r=>{r>=1&&r<=z.value&&(w.value=r)},je=L(()=>{const r=z.value,s=w.value,l=[];if(r<=7)for(let O=1;O<=r;O++)l.push(O);else if(s<=4){for(let O=1;O<=5;O++)l.push(O);l.push("..."),l.push(r)}else if(s>=r-3){l.push(1),l.push("...");for(let O=r-4;O<=r;O++)l.push(O)}else l.push(1),l.push("..."),l.push(s-1),l.push(s),l.push(s+1),l.push("..."),l.push(r);return l}),Fe=()=>{const r=x.value.length>0?g.value.filter(Se=>x.value.includes(Se.id)):g.value,s=["Nombre Documento","Cliente","Estado","Etiquetas"],l=r.map(Se=>[Se.title||"",V(Se),"En Progreso",Se.tags?Se.tags.map(We=>We.name).join(", "):""]),O=[s.join(","),...l.map(Se=>Se.map(We=>`"${We}"`).join(","))].join(`
`),pe=new Blob([O],{type:"text/csv;charset=utf-8;"}),_e=document.createElement("a"),Ve=URL.createObjectURL(pe);_e.setAttribute("href",Ve),_e.setAttribute("download",`documentos_en_progreso_${new Date().toISOString().split("T")[0]}.csv`),_e.style.visibility="hidden",document.body.appendChild(_e),_e.click(),document.body.removeChild(_e)},Be=async(r,s)=>{try{switch(r){case"editForm":y("edit",s,{userRole:te()});break;case"editDocument":E.push(`/dynamic_document_dashboard/client/editor/edit/${s.id}`);break;case"preview":await H(s);break;case"delete":await X(s);break;case"letterhead":y("letterhead",s);break;case"relationships":y("relationships",s);break;case"downloadPDF":await U(s);break;case"downloadWord":await m(s);break;case"email":y("email",s);break;default:console.warn("Unknown action:",r)}}catch(l){console.error(`Error executing action ${r}:`,l)}},Q=v(!1),j=v(null),Z=r=>{j.value=r,Q.value=!0},P=async(r,s)=>{Q.value=!1,await Be(r,s)};return(r,s)=>(n(),i("div",null,[e("div",pc,[e("div",hc,[e("div",fc,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>A.value=l),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Re,A.value]])])]),e("div",vc,[o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:_(()=>[e("div",bc,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",yc,p(le.value||"Etiqueta"),1)]),o(t(Ne),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Me),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:_(()=>[e("div",xc,[o(t(ue),null,{default:_(({active:l})=>[e("a",{onClick:s[1]||(s[1]=O=>b.value=null),class:$([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(n(!0),i(de,null,me(B.value,l=>(n(),re(t(ue),{key:l.id},{default:_(({active:O})=>[e("a",{onClick:pe=>b.value=l.id,class:$([O?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},p(l.name),11,_c)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",wc,[b.value?(n(),i("button",{key:0,onClick:ne,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(Ue),{class:"h-4 w-4 flex-shrink-0"}),$c])):D("",!0)])]),e("div",kc,[e("div",Cc,[e("div",Dc,[e("button",{onClick:Fe,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[o(t(tt),{class:"h-4 w-4"}),Sc]),o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:_(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",Ec,[o(t(ue),null,{default:_(({active:l})=>[e("a",{onClick:Y,class:$([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),o(t(ue),null,{default:_(({active:l})=>[e("a",{onClick:W,class:$([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:_(()=>[Fc,oe(" "+p(se.value)+" ",1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",Tc,[o(t(ue),null,{default:_(({active:l})=>[e("a",{onClick:s[2]||(s[2]=O=>q.value="recent"),class:$([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:_(({active:l})=>[e("a",{onClick:s[3]||(s[3]=O=>q.value="name"),class:$([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Ac,[e("div",Mc,[e("table",Pc,[e("thead",Lc,[e("tr",null,[e("th",Ic,[e("input",{type:"checkbox",checked:ye.value,onChange:ve,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,jc)]),Bc,Uc,zc,Nc])]),e("tbody",Oc,[(n(!0),i(de,null,me(T.value,(l,O)=>(n(),i("tr",{key:l.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:pe=>Z(l)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:s[4]||(s[4]=fe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:x.value.includes(l.id),onChange:pe=>N(l.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,qc)]),e("td",Vc,[e("div",Qc,[e("div",Wc,[e("div",Gc,[o(t(Qe),{class:"h-5 w-5 text-blue-600"})])]),e("div",Hc,[e("div",Zc,p(l.title),1)])])]),e("td",Jc,[e("div",Kc,p(V(l)),1)]),Yc,e("td",Xc,[e("div",eu,[(n(!0),i(de,null,me(l.tags,pe=>(n(),i("span",{key:pe.id,class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ce(pe)])},p(pe.name),3))),128)),!l.tags||l.tags.length===0?(n(),i("span",tu,"-")):D("",!0)])])],8,Rc))),128))])])]),z.value>1?(n(),i("div",su,[e("div",ou,[e("button",{onClick:ge,disabled:w.value===1,class:$(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",w.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,nu),e("button",{onClick:he,disabled:w.value===z.value,class:$(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",w.value===z.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,ru)]),e("div",lu,[e("div",null,[e("p",au,[oe(" Mostrando "),e("span",iu,p(S.value.start),1),oe(" a "),e("span",du,p(S.value.end),1),oe(" de "),e("span",cu,p(S.value.total),1),oe(" resultados ")])]),e("div",null,[e("nav",uu,[e("button",{onClick:ge,disabled:w.value===1,class:$(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",w.value===1?"opacity-50 cursor-not-allowed":""])},[gu,o(t(ht),{class:"h-5 w-5","aria-hidden":"true"})],10,mu),(n(!0),i(de,null,me(je.value,l=>(n(),i(de,{key:l},[l!=="..."?(n(),i("button",{key:0,onClick:O=>xe(l),class:$(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",w.value===l?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},p(l),11,pu)):(n(),i("span",hu," ... "))],64))),128)),e("button",{onClick:he,disabled:w.value===z.value,class:$(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",w.value===z.value?"opacity-50 cursor-not-allowed":""])},[vu,o(t(lt),{class:"h-5 w-5","aria-hidden":"true"})],10,fu)])])])])):D("",!0)]),g.value.length===0?(n(),i("div",bu,[o(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),yu,xu])):D("",!0),(n(),re(ft,{to:"body"},[t(C).edit.isOpen?(n(),re(t(St),{key:0,document:t(C).edit.document,"user-role":t(te)(),onClose:s[5]||(s[5]=l=>t(F)("edit")),onRefresh:s[6]||(s[6]=l=>u("refresh"))},null,8,["document","user-role"])):D("",!0),t(C).email.isOpen?(n(),re(t(Et),{key:1,document:t(C).email.document,onClose:s[7]||(s[7]=l=>t(F)("email"))},null,8,["document"])):D("",!0),t(C).letterhead.isOpen?(n(),re(yt,{key:2,"is-visible":t(C).letterhead.isOpen,document:t(C).letterhead.document,onClose:s[8]||(s[8]=l=>t(F)("letterhead")),onUploaded:s[9]||(s[9]=l=>u("refresh")),onDeleted:s[10]||(s[10]=l=>u("refresh"))},null,8,["is-visible","document"])):D("",!0),t(C).relationships.isOpen?(n(),re(Ft,{key:3,"is-open":t(C).relationships.isOpen,document:t(C).relationships.document,onClose:s[11]||(s[11]=l=>t(F)("relationships")),onRefresh:s[12]||(s[12]=l=>u("refresh"))},null,8,["is-open","document"])):D("",!0),Q.value?(n(),re(wt,{key:4,"is-visible":Q.value,document:j.value,"card-type":"client",context:"table","user-store":t(c),onClose:s[13]||(s[13]=l=>Q.value=!1),onAction:P},null,8,["is-visible","document","user-store"])):D("",!0)]))]))}},wu={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},$u={class:"mb-4"},ku={class:"relative w-full"},Cu={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4"},Du={class:"flex items-center gap-2 min-w-0"},Su={class:"truncate"},Eu={class:"p-2"},Fu={class:"relative mb-2"},Tu={class:"max-h-60 overflow-y-auto"},Au=["onClick"],Mu={class:"truncate"},Pu={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},Lu={class:"flex items-center justify-stretch"},Iu=e("span",null,"Limpiar",-1),ju={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},Bu={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Uu={class:"flex items-center gap-2"},zu=e("span",{class:"hidden sm:inline"},"Exportar",-1),Nu={class:"py-1"},Ou=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),Ru={class:"py-1"},qu={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Vu={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Qu={class:"min-w-full divide-y divide-gray-200"},Wu={class:"bg-gray-50"},Gu={scope:"col",class:"w-12 px-6 py-3"},Hu=["checked"],Zu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Ju=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado Firma ",-1),Ku=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),Yu={class:"bg-white divide-y divide-gray-200"},Xu=["onClick"],em=["checked","onChange"],tm={class:"px-6 py-4 whitespace-nowrap"},sm={class:"flex items-center"},om={class:"flex-shrink-0 h-10 w-10"},nm={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},rm={class:"ml-4"},lm={class:"text-sm font-medium text-gray-900"},am={class:"px-6 py-4 whitespace-nowrap"},im={class:"px-6 py-4 whitespace-nowrap"},dm={class:"flex flex-wrap gap-1"},cm={key:0,class:"text-sm text-gray-400"},um={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},mm={class:"flex flex-1 justify-between sm:hidden"},gm=["disabled"],pm=["disabled"],hm={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},fm={class:"text-sm text-gray-700"},vm={class:"font-medium"},bm={class:"font-medium"},ym={class:"font-medium"},xm={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},_m=["disabled"],wm=e("span",{class:"sr-only"},"Anterior",-1),$m=["onClick"],km={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},Cm=["disabled"],Dm=e("span",{class:"sr-only"},"Siguiente",-1),Sm={key:0,class:"text-center py-12"},Em={class:"mt-2 text-sm font-medium text-gray-900"},Fm={class:"mt-1 text-sm text-gray-500"},Tm={key:1,class:"text-center py-12"},Am=e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-secondary"},null,-1),Mm=e("p",{class:"mt-2 text-sm text-gray-500"},"Cargando documentos...",-1),Pm=[Am,Mm],kt={__name:"SignaturesListTable",props:{state:{type:String,required:!0,validator:a=>["PendingSignatures","FullySigned"].includes(a)},searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","document-fully-signed","open-electronic-signature"],setup(a,{expose:h,emit:d}){const c=a,E=d,k=Je(),u=qe();et();const{activeModals:C,openModal:y,closeModal:F,getUserRole:te}=vt(u,k),{handlePreviewDocument:H,downloadPDFDocument:X,signDocument:U,downloadSignedDocument:m}=bt(u,k,E);v([]);const A=v(!1),b=v(""),q=v(""),x=v(null),w=v("recent"),ae=v([]),I=v(1),g=v(10),T=L(()=>c.state==="PendingSignatures"?"No tienes documentos pendientes por firmar":"No tienes documentos firmados"),z=L(()=>c.state==="PendingSignatures"?"Cuando tengas documentos que requieran tu firma electrónica aparecerán aquí.":"Una vez que firmes documentos electrónicamente, aparecerán aquí."),S=L(()=>{const ee=k.currentUser.role,G=k.currentUser.id,ie=k.currentUser.email;let K=[];return ee==="lawyer"?c.state==="PendingSignatures"?K=u.pendingSignatureDocuments.filter(be=>{var Ee;const $e=be.created_by===G,Ie=(Ee=be.signatures)==null?void 0:Ee.some(ze=>ze.signer_email===ie);return $e||Ie}):K=u.fullySignedDocuments.filter(be=>{var Ee;const $e=be.created_by===G,Ie=(Ee=be.signatures)==null?void 0:Ee.some(ze=>ze.signer_email===ie&&ze.signed);return $e||Ie}):c.state==="PendingSignatures"?K=u.documents.filter(be=>{var Ee;if(be.state!=="PendingSignatures")return!1;const $e=(Ee=be.signatures)==null?void 0:Ee.some(ze=>ze.signer_email===ie),Ie=be.created_by===G;return $e||Ie}):K=u.documents.filter(be=>{var Ee;if(be.state!=="FullySigned")return!1;const $e=(Ee=be.signatures)==null?void 0:Ee.some(ze=>ze.signer_email===ie&&ze.signed),Ie=be.created_by===G;return $e||Ie}),K}),B=L(()=>{let ee=[...S.value];const G=b.value.toLowerCase();return G&&(ee=ee.filter(ie=>{var K,be;return((K=ie.title)==null?void 0:K.toLowerCase().includes(G))||((be=ie.tags)==null?void 0:be.some($e=>{var Ie;return(Ie=$e.name)==null?void 0:Ie.toLowerCase().includes(G)}))})),x.value&&(ee=ee.filter(ie=>ie.tags&&ie.tags.some(K=>K.id===x.value))),w.value==="name"?ee.sort((ie,K)=>{const be=(ie.title||"").toLowerCase(),$e=(K.title||"").toLowerCase();return be.localeCompare($e)}):w.value==="recent"&&ee.sort((ie,K)=>K.id-ie.id),ee}),le=L(()=>{const ee=(I.value-1)*g.value,G=ee+g.value;return B.value.slice(ee,G)}),se=L(()=>Math.ceil(B.value.length/g.value)),V=L(()=>{const ee=(I.value-1)*g.value+1,G=Math.min(I.value*g.value,B.value.length);return{start:ee,end:G,total:B.value.length}});we([b,x],()=>{I.value=1});const ce=L(()=>{const ee=new Map;return S.value.forEach(G=>{G.tags&&G.tags.length>0&&G.tags.forEach(ie=>{ee.has(ie.id)||ee.set(ie.id,ie)})}),Array.from(ee.values()).sort((G,ie)=>G.name.localeCompare(ie.name))}),ye=L(()=>{if(!q.value)return ce.value;const ee=q.value.toLowerCase();return ce.value.filter(G=>G.name.toLowerCase().includes(ee))}),ve=L(()=>{if(!x.value)return null;const ee=ce.value.find(G=>G.id===x.value);return ee?ee.name:null}),N=ee=>{const G=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],ie=ee.id%G.length;return G[ie]},Y=L(()=>{switch(w.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),W=ee=>{const G=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],ie=ee.id%G.length;return G[ie]},ne=ee=>c.state==="FullySigned"?"bg-green-100 text-green-700 border border-green-200":"bg-yellow-100 text-yellow-700 border border-yellow-200",ge=ee=>c.state==="FullySigned"?"Firmado":"Pendiente",he=L(()=>B.value.length>0&&ae.value.length===B.value.length),xe=()=>{he.value?ae.value=[]:ae.value=B.value.map(ee=>ee.id)},je=ee=>{const G=ae.value.indexOf(ee);G>-1?ae.value.splice(G,1):ae.value.push(ee)},Fe=()=>{ae.value=B.value.map(ee=>ee.id)},Be=()=>{ae.value=[]},Q=()=>{x.value=null},j=()=>{I.value>1&&I.value--},Z=()=>{I.value<se.value&&I.value++},P=ee=>{ee>=1&&ee<=se.value&&(I.value=ee)},r=L(()=>{const ee=se.value,G=I.value,ie=[];if(ee<=7)for(let K=1;K<=ee;K++)ie.push(K);else if(G<=4){for(let K=1;K<=5;K++)ie.push(K);ie.push("..."),ie.push(ee)}else if(G>=ee-3){ie.push(1),ie.push("...");for(let K=ee-4;K<=ee;K++)ie.push(K)}else ie.push(1),ie.push("..."),ie.push(G-1),ie.push(G),ie.push(G+1),ie.push("..."),ie.push(ee);return ie}),s=()=>{const ee=ae.value.length>0?B.value.filter(Ee=>ae.value.includes(Ee.id)):B.value,G=["Nombre Documento","Estado Firma","Etiquetas"],ie=ee.map(Ee=>[Ee.title||"",ge(),Ee.tags?Ee.tags.map(ze=>ze.name).join(", "):""]),K=[G.join(","),...ie.map(Ee=>Ee.map(ze=>`"${ze}"`).join(","))].join(`
`),be=new Blob([K],{type:"text/csv;charset=utf-8;"}),$e=document.createElement("a"),Ie=URL.createObjectURL(be);$e.setAttribute("href",Ie),$e.setAttribute("download",`documentos_firmas_${new Date().toISOString().split("T")[0]}.csv`),$e.style.visibility="hidden",document.body.appendChild($e),$e.click(),document.body.removeChild($e)},l=v(!1),O=v(null),pe=ee=>{O.value=ee,l.value=!0},_e=async(ee,G)=>{l.value=!1,await Ve(ee,G)},Ve=async(ee,G)=>{try{switch(ee){case"preview":await H(G);break;case"letterhead":y("letterhead",G);break;case"viewSignatures":y("signatures",G);break;case"sign":await U(G,y);break;case"downloadSignedDocument":await m(G);break;case"downloadPDF":await X(G);break;default:console.warn("Unknown action:",ee)}}catch(ie){console.error(`Error executing action ${ee}:`,ie)}},Se=async()=>{A.value=!0;try{await u.init(!0)}catch(ee){console.error("Error refreshing documents:",ee),De("Error al actualizar documentos","error")}finally{A.value=!1}},We=async()=>{await Se(),E("refresh")};return Oe(async()=>{await Se()}),h({refresh:We}),we(()=>k.currentUser,()=>{We()}),(ee,G)=>{var ie;return n(),i("div",null,[e("div",wu,[e("div",$u,[e("div",ku,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":G[0]||(G[0]=K=>b.value=K),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Re,b.value]])])]),e("div",Cu,[o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:_(()=>[e("div",Du,[o(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",Su,p(ve.value||"Etiqueta"),1)]),o(t(Ne),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),o(t(Me),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",Eu,[e("div",Fu,[o(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Pe(e("input",{"onUpdate:modelValue":G[1]||(G[1]=K=>q.value=K),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:G[2]||(G[2]=fe(()=>{},["stop"]))},null,512),[[Re,q.value]])]),e("div",Tu,[o(t(ue),null,{default:_(({active:K})=>[e("a",{onClick:G[3]||(G[3]=be=>x.value=null),class:$([K?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(n(!0),i(de,null,me(ye.value,K=>(n(),re(t(ue),{key:K.id},{default:_(({active:be})=>[e("a",{onClick:$e=>x.value=K.id,class:$([be?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:$(["w-3 h-3 rounded-full flex-shrink-0",N(K)])},null,2),e("span",Mu,p(K.name),1)],10,Au)]),_:2},1024))),128)),ye.value.length===0?(n(),i("div",Pu," No se encontraron etiquetas ")):D("",!0)])])]),_:1})]),_:1}),e("div",Lu,[x.value?(n(),i("button",{key:0,onClick:Q,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[o(t(Ue),{class:"h-4 w-4 flex-shrink-0"}),Iu])):D("",!0)])]),e("div",ju,[e("div",Bu,[e("div",Uu,[e("button",{onClick:s,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[o(t(tt),{class:"h-4 w-4"}),zu]),o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:_(()=>[o(t(ot),{class:"h-5 w-5 text-gray-500"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",Nu,[o(t(ue),null,{default:_(({active:K})=>[e("a",{onClick:Fe,class:$([K?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),o(t(ue),null,{default:_(({active:K})=>[e("a",{onClick:Be,class:$([K?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),o(t(Te),{as:"div",class:"relative"},{default:_(()=>[o(t(Ae),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:_(()=>[Ou,oe(" "+p(Y.value)+" ",1),o(t(Ne),{class:"h-4 w-4"})]),_:1}),o(t(Me),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:_(()=>[e("div",Ru,[o(t(ue),null,{default:_(({active:K})=>[e("a",{onClick:G[4]||(G[4]=be=>w.value="recent"),class:$([K?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),o(t(ue),null,{default:_(({active:K})=>[e("a",{onClick:G[5]||(G[5]=be=>w.value="name"),class:$([K?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",qu,[e("div",Vu,[e("table",Qu,[e("thead",Wu,[e("tr",null,[e("th",Gu,[e("input",{type:"checkbox",checked:he.value,onChange:xe,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Hu)]),Zu,Ju,Ku])]),e("tbody",Yu,[(n(!0),i(de,null,me(le.value,(K,be)=>(n(),i("tr",{key:K.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:$e=>pe(K)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:G[6]||(G[6]=fe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:ae.value.includes(K.id),onChange:$e=>je(K.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,em)]),e("td",tm,[e("div",sm,[e("div",om,[e("div",nm,[o(t(Qe),{class:"h-5 w-5 text-purple-600"})])]),e("div",rm,[e("div",lm,p(K.title),1)])])]),e("td",am,[e("span",{class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ne()])},p(ge()),3)]),e("td",im,[e("div",dm,[(n(!0),i(de,null,me(K.tags,$e=>(n(),i("span",{key:$e.id,class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",W($e)])},p($e.name),3))),128)),!K.tags||K.tags.length===0?(n(),i("span",cm,"-")):D("",!0)])])],8,Xu))),128))])])]),se.value>1?(n(),i("div",um,[e("div",mm,[e("button",{onClick:j,disabled:I.value===1,class:$(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",I.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,gm),e("button",{onClick:Z,disabled:I.value===se.value,class:$(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",I.value===se.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,pm)]),e("div",hm,[e("div",null,[e("p",fm,[oe(" Mostrando "),e("span",vm,p(V.value.start),1),oe(" a "),e("span",bm,p(V.value.end),1),oe(" de "),e("span",ym,p(V.value.total),1),oe(" resultados ")])]),e("div",null,[e("nav",xm,[e("button",{onClick:j,disabled:I.value===1,class:$(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",I.value===1?"opacity-50 cursor-not-allowed":""])},[wm,o(t(ht),{class:"h-5 w-5","aria-hidden":"true"})],10,_m),(n(!0),i(de,null,me(r.value,K=>(n(),i(de,{key:K},[K!=="..."?(n(),i("button",{key:0,onClick:be=>P(K),class:$(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",I.value===K?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},p(K),11,$m)):(n(),i("span",km," ... "))],64))),128)),e("button",{onClick:Z,disabled:I.value===se.value,class:$(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",I.value===se.value?"opacity-50 cursor-not-allowed":""])},[Dm,o(t(lt),{class:"h-5 w-5","aria-hidden":"true"})],10,Cm)])])])])):D("",!0)]),B.value.length===0&&!A.value?(n(),i("div",Sm,[o(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",Em,p(T.value),1),e("p",Fm,p(z.value),1)])):D("",!0),A.value?(n(),i("div",Tm,Pm)):D("",!0),o(jt,{isVisible:t(nt),documentData:t(It),onClose:G[7]||(G[7]=K=>nt.value=!1)},null,8,["isVisible","documentData"]),(n(),re(ft,{to:"body"},[t(C).signatures.isOpen?(n(),re(t(Zt),{key:0,"document-id":(ie=t(C).signatures.document)==null?void 0:ie.id,onClose:G[8]||(G[8]=K=>t(F)("signatures")),onRefresh:G[9]||(G[9]=K=>E("refresh"))},null,8,["document-id"])):D("",!0),t(C).letterhead.isOpen?(n(),re(yt,{key:1,"is-visible":t(C).letterhead.isOpen,document:t(C).letterhead.document,onClose:G[10]||(G[10]=K=>t(F)("letterhead")),onUploaded:G[11]||(G[11]=K=>E("refresh")),onDeleted:G[12]||(G[12]=K=>E("refresh"))},null,8,["is-visible","document"])):D("",!0),l.value?(n(),re(wt,{key:2,"is-visible":l.value,document:O.value,"card-type":"signatures",context:"table","user-store":t(k),onClose:G[13]||(G[13]=K=>l.value=!1),onAction:_e},null,8,["is-visible","document","user-store"])):D("",!0)]))])}}},Lm={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Im={class:"flex justify-end"},jm=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[oe(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),Bm={class:"mt-2"},Um={class:"flex gap-2 mt-2.5"},zm=["disabled"],Nm=e("span",null,"Actualizar nombre",-1),Om=[Nm],Rm=["disabled"],qm={__name:"CreateDocumentByLawyer",emits:["close"],setup(a,{emit:h}){const d=et(),c=qe(),E=h,k=v(""),u=v("");Gt(()=>{var U;(U=c.selectedDocument)!=null&&U.title?(k.value=c.selectedDocument.title,u.value=c.selectedDocument.title):(k.value="",u.value="")});const C=U=>{U.key==="Escape"&&E("close")};Oe(()=>{document.addEventListener("keydown",C)}),ut(()=>{document.removeEventListener("keydown",C)});const y=L(()=>k.value.trim().length>0),F=L(()=>{var U;return!!((U=c.selectedDocument)!=null&&U.id)}),te=L(()=>F.value&&k.value.trim()!==u.value.trim()&&k.value.trim().length>0);async function H(){if(F.value&&te.value)try{const U={title:k.value.trim()};await c.updateDocument(c.selectedDocument.id,U),u.value=k.value.trim(),c.selectedDocument.title=k.value.trim(),c.lastUpdatedDocumentId=c.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",c.selectedDocument.id);const m=c.selectedDocument.id;E("close",{updatedDocId:m});const A=window.location.pathname;A==="/dynamic_document_dashboard"||A==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(m)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(U){console.error("Error updating document name:",U)}}const X=async()=>{if(!y.value)return;const U=encodeURIComponent(k.value.trim());F.value?(c.selectedDocument.title=k.value,c.selectedDocument.id&&(c.lastUpdatedDocumentId=c.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",c.selectedDocument.id.toString())),d.push(`/dynamic_document_dashboard/lawyer/editor/edit/${c.selectedDocument.id}`)):(c.selectedDocument={title:k.value.trim()},d.push(`/dynamic_document_dashboard/lawyer/editor/create/${U}`))};return(U,m)=>(n(),i("div",Lm,[e("div",Im,[e("button",{onClick:m[0]||(m[0]=A=>E("close"))},[o(t(Ue),{class:"size-6"})])]),e("form",{onSubmit:fe(X,["prevent"])},[e("div",null,[jm,e("div",Bm,[Pe(e("input",{"onUpdate:modelValue":m[1]||(m[1]=A=>k.value=A),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[Re,k.value]])])]),e("div",Um,[F.value?(n(),i("button",{key:0,type:"button",onClick:H,disabled:!te.value,class:$(["p-2.5 text-sm font-medium rounded-md flex gap-2",te.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Om,10,zm)):D("",!0),e("button",{type:"submit",class:$(["p-2.5 text-sm font-medium rounded-md flex gap-2",y.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!y.value},[e("span",null,p(F.value?"Editar Documento":"Continuar"),1)],10,Rm)])],32)]))}},Le=a=>(gt("data-v-4d444b98"),a=a(),pt(),a),Vm={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Qm={class:"px-6 py-4 border-b border-gray-200"},Wm=Le(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gestión de Membrete Global para PDF",-1)),Gm=Le(()=>e("p",{class:"text-sm text-gray-500 mt-1"}," La imagen de membrete se usará por defecto solo al generar documentos en PDF. Para documentos Word, se utiliza la plantilla .docx configurada más abajo. ",-1)),Hm={class:"p-6 overflow-y-auto flex-grow"},Zm={key:0,class:"text-center py-10"},Jm=Le(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),Km={class:"mt-4 text-gray-500"},Ym={key:1,class:"space-y-6"},Xm={key:0,class:"space-y-4"},eg=Le(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete de imagen para PDF actual",-1)),tg={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},sg=["src"],og={class:"mt-4 flex justify-center space-x-3"},ng=["disabled"],rg={key:1,class:"text-center py-8"},lg=Le(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete para PDF",-1)),ag=Le(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," No tienes una imagen de membrete global configurada para los documentos PDF. ",-1)),ig=Le(()=>e("p",{class:"mt-1 text-xs text-gray-400"}," Este membrete de imagen se aplicará solo a los PDF que no tengan un membrete específico. ",-1)),dg={class:"space-y-4"},cg={class:"text-lg font-medium text-gray-900"},ug={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},mg={key:0},gg={class:"mt-4"},pg=Le(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, máximo 10MB. Se usa únicamente para los PDF. ",-1)),hg=Le(()=>e("p",{class:"text-xs text-gray-400 mt-1"},' Dimensiones ideales: 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI) ',-1)),fg={key:1,class:"space-y-4"},vg={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},bg={class:"text-gray-400"},yg={key:0,class:"mt-4"},xg=["src"],_g={class:"flex justify-center space-x-3"},wg=["disabled"],$g={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},kg={class:"space-y-4 border-t border-gray-200 pt-6"},Cg=Le(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Plantilla Word para documentos (.docx)",-1)),Dg=Le(()=>e("p",{class:"text-sm text-gray-500"}," Esta plantilla se usará al descargar documentos en Word. Debe ser un archivo .docx con tu membrete configurado (header, footer o watermark). El contenido del documento se añadirá sobre esa plantilla. ",-1)),Sg={key:0,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Eg={class:"text-sm text-gray-700"},Fg=Le(()=>e("div",{class:"font-medium"},"Plantilla actual:",-1)),Tg={class:"mt-1 break-words"},Ag={class:"font-mono break-all"},Mg={key:0,class:"text-gray-400 ml-2"},Pg={class:"mt-3 flex flex-wrap gap-3"},Lg=["disabled"],Ig={key:1,class:"text-sm text-gray-500"},jg={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},Bg={key:0},Ug={class:"mt-4"},zg=Le(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos .docx, máximo 10MB. ",-1)),Ng={key:1,class:"space-y-4"},Og={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Rg={class:"text-gray-400"},qg={class:"flex justify-center space-x-3"},Vg=["disabled"],Qg={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Wg={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},Gg={class:"flex items-center space-x-2"},Hg=Le(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete para PDF",-1)),Zg=Le(()=>e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-yellow-800 mb-2"},"🔄 Prioridad de Membrete"),e("div",{class:"text-sm text-yellow-700 space-y-1"},[e("div",null,[e("strong",null,"1º Prioridad:"),oe(" Membrete específico del documento")]),e("div",null,[e("strong",null,"2º Prioridad:"),oe(" Membrete global de imagen para PDF del usuario (este)")]),e("div",null,[e("strong",null,"3º Prioridad:"),oe(" Sin membrete")])])],-1)),Jg=Le(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"📐 Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"2550 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"3300 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporción:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta, 300 DPI)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"±10%")])])])],-1)),Kg=Le(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🎨 Distribución Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"⚠️ ZONA CRÍTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mantén semi-transparente. El texto del documento se superpone aquí.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, teléfonos, emails, información de contacto.")])])])])])],-1)),Yg=Le(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🔧 Consideraciones Técnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Posicionamiento:"),oe(" La imagen se centra automáticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Transparencia:"),oe(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Márgenes:"),oe(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Resolución:"),oe(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"⚠️"),e("span",null,[e("strong",null,"Zona crítica:"),oe(" Evita elementos gráficos densos en el centro (300-400px de altura)")])])])])],-1)),Xg=Le(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"💡 Tips de Diseño Rápido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"• Si solo tienes header, ubícalo en los primeros 120-150px"),e("div",null,"• El resto de la imagen debe ser transparente o blanco"),e("div",null,"• Para footer, usa los últimos 80-120px"),e("div",null,"• El texto se superpone en toda la imagen, mantén el centro claro")])],-1)),e0={key:3,class:"space-y-2"},t0={class:"flex"},s0={class:"text-sm text-yellow-700"},o0={__name:"GlobalLetterheadModal",props:{isVisible:{type:Boolean,default:!1}},emits:["close","uploaded","deleted"],setup(a,{emit:h}){const d=a,c=h;we(()=>d.isVisible,Q=>{});const E=qe(),k=v(!1),u=v(""),C=v(!1),y=v(!1),F=v(null),te=v(null),H=v(null),X=v([]),U=v(null),m=v(!1),A=v(!1),b=v(null),q=v(!1),x=v(null),w=v(""),ae=v(null),I=v(!1),g=v(!1),T=v(null),z=()=>{le(),c("close")},S=Q=>{const j=Q.target.files[0];if(!j)return;if(!j.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(j.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}F.value=j,X.value=[];const Z=new FileReader;Z.onload=P=>{te.value=P.target.result;const r=new Image;r.onload=()=>{B(r.width,r.height)},r.src=P.target.result},Z.readAsDataURL(j)},B=(Q,j)=>{const s=Q/j,l=2550/3300,O=Math.abs(s-l)/l;if(Q===2550&&j===3300){X.value.push("✅ Dimensiones perfectas: 2550 × 3300 píxeles");return}O<=.1?(X.value.push(`ℹ️ Buenas proporciones detectadas: ${Q} × ${j} píxeles (${s.toFixed(3)})`),(Q!==2550||j!==3300)&&X.value.push('💡 Para mejores resultados, usa exactamente 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI)')):(X.value.push(`⚠️ Proporciones no ideales: ${Q} × ${j} píxeles (${s.toFixed(3)})`),X.value.push(`🎯 Proporciones recomendadas: ${l.toFixed(3)} (8.5:11, tamaño carta)`),X.value.push("📐 Considera redimensionar tu imagen a 2550 × 3300 píxeles (tamaño carta)")),(Q<1200||j<1600)&&X.value.push("⚠️ Imagen muy pequeña - puede verse pixelada en documentos PDF tamaño carta"),(Q>4e3||j>5e3)&&X.value.push("ℹ️ Imagen muy grande - se redimensionará automáticamente para ajustarse al tamaño carta")},le=()=>{F.value=null,te.value=null,X.value=[],m.value=!1,U.value&&(U.value.value="")},se=async()=>{var Q;if(F.value){C.value=!0,X.value=[];try{const j=await E.uploadGlobalLetterheadImage(F.value);(Q=j.data)!=null&&Q.warnings&&j.data.warnings.length>0&&(X.value=j.data.warnings),A.value=!1,await V(),le(),c("uploaded",j.data)}catch(j){console.error("Error uploading global letterhead:",j),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{C.value=!1}}},V=async()=>{if(!(H.value===null&&A.value)){A.value=!0;try{const Q=await E.getGlobalLetterheadImage();Q.data&&(H.value=URL.createObjectURL(Q.data))}catch{H.value=null}}},ce=async()=>{await Nt("¿Estás seguro de que deseas eliminar la imagen de membrete global?")&&ye()},ye=async()=>{y.value=!0;try{await E.deleteGlobalLetterheadImage(),H.value&&URL.revokeObjectURL(H.value),H.value=null,A.value=!0,c("deleted")}catch(Q){console.error("Error deleting global letterhead:",Q),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{y.value=!1}},ve=Q=>{const j=Q.target.files[0];if(j){if(!j.name.toLowerCase().endsWith(".docx")){alert("Solo se permiten archivos .docx para la plantilla Word");return}if(j.size>10*1024*1024){alert("El archivo de plantilla no puede ser mayor a 10MB");return}b.value=j}},N=()=>{b.value=null,T.value&&(T.value.value="")},Y=async()=>{var Q;if(b.value){I.value=!0;try{const Z=(Q=(await E.uploadGlobalLetterheadWordTemplate(b.value)).data)==null?void 0:Q.template_info;q.value=!0,w.value=(Z==null?void 0:Z.filename)||b.value.name,ae.value=(Z==null?void 0:Z.size_bytes)||b.value.size,await W(),N()}catch(j){console.error("Error uploading global Word template:",j),alert("Error al subir la plantilla Word. Por favor intenta nuevamente.")}finally{I.value=!1}}},W=async()=>{var Q,j,Z;try{const P=await E.getGlobalLetterheadWordTemplate("blob");if(P&&P.data){q.value=!0,x.value&&URL.revokeObjectURL(x.value),x.value=URL.createObjectURL(P.data);const r=((Q=P.headers)==null?void 0:Q["content-disposition"])||((j=P.headers)==null?void 0:j["Content-Disposition"]);let s="plantilla_word.docx";if(r){const l=r.match(/filename="?([^";]+)"?/i);l&&l[1]&&(s=l[1])}w.value=s,ae.value=P.data.size||null}}catch(P){((Z=P.response)==null?void 0:Z.status)===404?(q.value=!1,x.value&&URL.revokeObjectURL(x.value),x.value=null,w.value="",ae.value=null):console.error("Error loading global Word template:",P)}},ne=async()=>{await Nt("¿Estás seguro de que deseas eliminar la plantilla Word de membrete global?")&&ge()},ge=async()=>{g.value=!0;try{await E.deleteGlobalLetterheadWordTemplate(),x.value&&URL.revokeObjectURL(x.value),x.value=null,w.value="",ae.value=null,q.value=!1}catch(Q){console.error("Error deleting global Word template:",Q),alert("Error al eliminar la plantilla Word. Por favor intenta nuevamente.")}finally{g.value=!1}},he=()=>{if(x.value){const Q=document.createElement("a");Q.href=x.value,Q.download=w.value||"membrete-word.docx",document.body.appendChild(Q),Q.click(),document.body.removeChild(Q)}},xe=()=>{if(H.value){const Q=document.createElement("a");Q.href=H.value,Q.download="membrete-global.png",document.body.appendChild(Q),Q.click(),document.body.removeChild(Q)}},je=()=>{H.value=null},Fe=Q=>{if(Q===0)return"0 Bytes";const j=1024,Z=["Bytes","KB","MB","GB"],P=Math.floor(Math.log(Q)/Math.log(j));return parseFloat((Q/Math.pow(j,P)).toFixed(2))+" "+Z[P]};we(()=>d.isVisible,Q=>{Q&&(V(),W())});const Be=()=>{H.value&&URL.revokeObjectURL(H.value),te.value&&URL.revokeObjectURL(te.value),x.value&&URL.revokeObjectURL(x.value)};return Oe(()=>{d.isVisible&&V()}),ut(Be),(Q,j)=>Pe((n(),re(Ke,null,{default:_(()=>[e("div",Vm,[e("div",Qm,[Wm,Gm,e("button",{onClick:z,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[o(t(Ue),{class:"h-6 w-6"})])]),e("div",Hm,[k.value?(n(),i("div",Zm,[Jm,e("p",Km,p(u.value),1)])):(n(),i("div",Ym,[H.value?(n(),i("div",Xm,[eg,e("div",tg,[e("img",{src:H.value,alt:"Membrete de imagen para PDF actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:je},null,40,sg),e("div",og,[e("button",{onClick:xe,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[o(t(tt),{class:"h-4 w-4 mr-2"}),oe(" Descargar ")]),e("button",{onClick:ce,disabled:y.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[o(t(Pt),{class:"h-4 w-4 mr-2"}),oe(" "+p(y.value?"Eliminando...":"Eliminar"),1)],8,ng)])])])):(n(),i("div",rg,[o(t(rt),{class:"mx-auto h-12 w-12 text-gray-400"}),lg,ag,ig])),e("div",dg,[e("h3",cg,p(H.value?"Reemplazar Membrete de imagen para PDF":"Subir Membrete de imagen para PDF"),1),e("div",ug,[e("input",{ref_key:"fileInput",ref:U,type:"file",accept:".png",onChange:S,class:"hidden"},null,544),F.value?(n(),i("div",fg,[e("div",vg,[o(t(Lt),{class:"h-5 w-5 text-green-500"}),e("span",null,p(F.value.name),1),e("span",bg,"("+p(Fe(F.value.size))+")",1)]),te.value?(n(),i("div",yg,[e("img",{src:te.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,xg)])):D("",!0),e("div",_g,[e("button",{onClick:le,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:se,disabled:C.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[C.value?(n(),i("div",$g)):(n(),re(t(Qt),{key:0,class:"h-4 w-4 mr-2"})),oe(" "+p(C.value?"Subiendo...":"Subir Imagen para PDF"),1)],8,wg)])])):(n(),i("div",mg,[o(t(Kt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",gg,[e("button",{onClick:j[0]||(j[0]=Z=>Q.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG para PDF "),e("button",{onClick:j[1]||(j[1]=Z=>m.value=!m.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[o(t(Vt),{class:"h-4 w-4 mr-2"}),oe(" "+p(m.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),pg,hg]))])]),e("div",kg,[Cg,Dg,q.value?(n(),i("div",Sg,[e("div",Eg,[Fg,e("div",Tg,[e("span",Ag,p(w.value||"plantilla_word.docx"),1),ae.value?(n(),i("span",Mg,"("+p(Fe(ae.value))+")",1)):D("",!0)])]),e("div",Pg,[x.value?(n(),i("button",{key:0,onClick:he,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[o(t(tt),{class:"h-4 w-4 mr-2"}),oe(" Descargar ")])):D("",!0),e("button",{onClick:ne,disabled:g.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[o(t(Pt),{class:"h-4 w-4 mr-2"}),oe(" "+p(g.value?"Eliminando...":"Eliminar"),1)],8,Lg)])])):(n(),i("div",Ig," No tienes una plantilla Word configurada. Puedes subir un archivo .docx con tu membrete. ")),e("div",jg,[e("input",{ref_key:"wordTemplateInput",ref:T,type:"file",accept:".docx",onChange:ve,class:"hidden"},null,544),b.value?(n(),i("div",Ng,[e("div",Og,[o(t(Lt),{class:"h-5 w-5 text-green-500"}),e("span",null,p(b.value.name),1),e("span",Rg,"("+p(Fe(b.value.size))+")",1)]),e("div",qg,[e("button",{onClick:N,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:Y,disabled:I.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[I.value?(n(),i("div",Qg)):(n(),re(t(Qt),{key:0,class:"h-4 w-4 mr-2"})),oe(" "+p(I.value?"Subiendo...":"Subir Plantilla"),1)],8,Vg)])])):(n(),i("div",Bg,[o(t(rt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Ug,[e("button",{onClick:j[2]||(j[2]=Z=>Q.$refs.wordTemplateInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Plantilla .docx (Word) ")]),zg]))])]),m.value?(n(),i("div",Wg,[e("div",Gg,[o(t(Vt),{class:"h-6 w-6 text-blue-600"}),Hg]),Zg,Jg,Kg,Yg,Xg])):D("",!0),X.value.length>0?(n(),i("div",e0,[(n(!0),i(de,null,me(X.value,(Z,P)=>(n(),i("div",{key:P,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",t0,[o(t(_s),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",s0,p(Z),1)])]))),128))])):D("",!0)]))])])]),_:1},512)),[[mt,a.isVisible]])}},n0=xt(o0,[["__scopeId","data-v-4d444b98"]]),r0={class:"min-h-screen bg-gray-50"},l0={class:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8"},a0={class:"p-4 sm:p-6 lg:p-8"},i0={key:0},d0={class:"mb-6 border-b border-gray-200 pb-4"},c0={class:"hidden md:block"},u0={class:"flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8 mb-4","aria-label":"Tabs"},m0=["onClick"],g0={class:"flex gap-3"},p0=["disabled"],h0=e("span",null,"Firma Electrónica",-1),f0=e("span",null,"Membrete Global",-1),v0=e("span",null,"Nueva Minuta",-1),b0={class:"md:hidden space-y-3 relative"},y0=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),x0=[y0],_0={key:0,class:"absolute z-20 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden w-full"},w0=["onClick"],$0={class:"grid grid-cols-3 gap-2"},k0=["disabled"],C0=e("span",{class:"font-medium text-xs leading-tight"},"Firma",-1),D0=e("span",{class:"font-medium text-xs leading-tight"},"Membrete",-1),S0=e("span",{class:"font-medium text-xs leading-tight"},"Nueva",-1),E0={key:0},F0={key:1},T0={key:2},A0={key:3},M0={key:4},P0={key:5,class:"mt-6 text-center text-gray-400 font-regular"},L0=e("p",null,"No hay documentos disponibles para mostrar.",-1),I0=[L0],j0={key:1},B0={class:"mb-6 border-b border-gray-200"},U0={class:"hidden md:flex items-center justify-between"},z0={class:"-mb-px flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},N0=["onClick"],O0={class:"flex items-center gap-2 mb-4"},R0={class:"relative"},q0={class:"relative group"},V0=["disabled"],Q0={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},W0=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),G0={class:"md:hidden relative"},H0=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),Z0=[H0],J0={key:0,class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},K0=["onClick"],Y0={class:"md:hidden mt-4 mb-4 flex flex-col gap-2"},X0={class:"relative"},ep={class:"relative group"},tp=["disabled"],sp={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},op=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),np={key:0},rp={key:1},lp={class:"p-4 sm:p-6"},ap={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},ip={class:"flex justify-between items-center p-4 border-b"},dp=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),cp={class:"p-4 sm:p-6"},up={class:"p-4 sm:p-6"},mp={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},gp={class:"flex justify-between items-center p-4 border-b"},pp=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),hp={class:"p-4 sm:p-6"},Vp={__name:"Dashboard",setup(a){const h=Je(),d=qe(),c=Bt(),E=et(),k=cs(),{isBasicUser:u,handleFeatureAccess:C}=Ut(),y=v(""),F=v("default"),te=v(!1),H=v("folders"),X=v("legal-documents"),U=v(!1),m=v(!1),A=v(!1),b=v(!1),q=v(!1),x=v(null),w=v([]),ae=v("recent");we(X,(j,Z)=>{},{immediate:!0}),L(()=>[]),L(()=>ae.value==="recent"?"Más recientes":"Nombre (A-Z)");const I=L(()=>h.currentUser),g=L(()=>I.value?I.value.role:(E.push("/login"),null)),T=L(()=>{let j=[];g.value==="lawyer"?j=d.draftAndPublishedDocumentsUnassigned:(g.value==="client"||g.value==="basic"||g.value==="corporate_client")&&(j=d.progressAndCompletedDocumentsByClient(I.value.id));const Z=w.value&&Array.isArray(w.value)?w.value.map(P=>P.id):[];return d.filteredDocumentsBySearchAndTags(y.value,h,Z).filter(P=>j.some(r=>r.id===P.id))}),z=async j=>{F.value=j,d.selectedDocument=null;try{await d.init(!0)}catch(Z){console.error("Error loading documents for useDocument section:",Z)}},S=()=>{te.value=!1,F.value="default",d.selectedDocument=null},B=async()=>{await d.init(!0)},le=()=>{if(!I.value){console.error("Cannot open signature modal: currentUser is not loaded");return}m.value=!0},se=()=>{if(!I.value){console.error("Cannot open signature modal: currentUser is not loaded");return}U.value=!0},V=()=>{if(!I.value){console.error("Cannot open signature modal: currentUser is not loaded");return}U.value=!0},ce=async j=>{X.value="signed-documents"},ye=async j=>{H.value="signed-documents"},ve=()=>{if(!I.value){console.error("Cannot open letterhead modal: currentUser is not loaded");return}C("Membrete Global",()=>{A.value=!0})},N=j=>{De("Membrete global subido correctamente","success")},Y=()=>{De("Membrete global eliminado correctamente","success")},W=async()=>{if(F.value==="useDocument"){F.value="default",H.value="my-documents";return}H.value="folders";try{await new Promise(j=>setTimeout(j,100)),await c.fetchFolders(!0)}catch{}};we(()=>d.lastUpdatedDocumentId,(j,Z)=>{if(j&&j!==Z&&F.value==="default"){const P=Date.now();(!we.lastExecutionTime||P-we.lastExecutionTime>100)&&(we.lastExecutionTime=P,F.value="default")}},{immediate:!1}),we(b,j=>{}),we(q,j=>{}),we(x,j=>{}),we(()=>k.path,(j,Z)=>{j==="/dynamic_document_dashboard"&&Z&&Z.includes("/document/use/")&&d.init()}),we(()=>k.query,j=>{j.lawyerTab&&(X.value=j.lawyerTab),j.tab&&(H.value=j.tab)},{immediate:!0});const ne=[{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"}],ge=[{name:"legal-documents",label:"Minutas"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"finished-documents",label:"Dcs. Clientes"},{name:"in-progress-documents",label:"Dcs. Clientes en Progreso"}],he=v(!1),xe=v(!1),je=()=>{he.value=!1,xe.value=!1},Fe=j=>{X.value=j,he.value=!1,je()},Be=j=>{H.value=j,xe.value=!1,je()};Oe(async()=>{await h.init(),await d.init(),await c.init(),d.selectedDocument=null,F.value="default";const j=localStorage.getItem("lastUpdatedDocumentId");j&&d.documents.some(P=>P.id.toString()===j)&&(d.lastUpdatedDocumentId=parseInt(j))});const Q=async j=>{h.currentUser&&(h.currentUser.has_signature=!0),De("Firma electrónica guardada correctamente","success"),setTimeout(()=>{m.value=!1,U.value=!1},500)};return(j,Z)=>{var P,r;return n(),i(de,null,[e("div",r0,[e("div",l0,[Ht(j.$slots,"default")]),e("div",a0,[g.value==="lawyer"?(n(),i("div",i0,[e("div",d0,[e("div",c0,[e("nav",u0,[(n(),i(de,null,me(ge,s=>e("button",{key:s.name,onClick:fe(l=>Fe(s.name),["stop"]),class:$([X.value===s.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},p(s.label),11,m0)),64))]),e("div",g0,[e("button",{onClick:fe(le,["stop"]),disabled:!I.value,class:$(["inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-purple-200 text-sm font-medium transition-all duration-200",I.value?"bg-white text-gray-700 hover:bg-purple-50 hover:border-purple-300":"bg-gray-50 text-gray-400 cursor-not-allowed opacity-60"])},[o(t($t),{class:"size-5 text-purple-500"}),h0],10,p0),e("button",{onClick:Z[0]||(Z[0]=fe(s=>A.value=!0,["stop"])),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-green-200 bg-white text-sm font-medium text-gray-700 hover:bg-green-50 hover:border-green-300 transition-all duration-200"},[o(t(Qe),{class:"size-5 text-green-500"}),f0]),e("button",{onClick:Z[1]||(Z[1]=fe(s=>te.value=!0,["stop"])),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-secondary bg-secondary text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200"},[o(t(Xe),{class:"size-5"}),v0])])]),e("div",b0,[e("button",{onClick:Z[2]||(Z[2]=fe(s=>he.value=!he.value,["stop"])),class:"dropdown-button w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,p(((P=ge.find(s=>s.name===X.value))==null?void 0:P.label)||"Seleccionar sección"),1),(n(),i("svg",{class:$(["ml-2 h-5 w-5 transition-transform duration-200",he.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},x0,2))]),he.value?(n(),i("div",_0,[(n(),i(de,null,me(ge,s=>e("button",{key:s.name,onClick:fe(l=>Fe(s.name),["stop"]),class:$(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",X.value===s.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},p(s.label),11,w0)),64))])):D("",!0),e("div",$0,[e("button",{onClick:fe(le,["stop"]),disabled:!I.value,class:$(["flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-purple-200 text-center transition-all duration-200",I.value?"bg-white hover:bg-purple-50":"bg-gray-50 cursor-not-allowed opacity-60"])},[o(t($t),{class:"size-6 text-purple-500 mb-1"}),C0],10,k0),e("button",{onClick:Z[3]||(Z[3]=fe(s=>A.value=!0,["stop"])),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-green-200 bg-white text-center transition-all duration-200 hover:bg-green-50"},[o(t(Qe),{class:"size-6 text-green-500 mb-1"}),D0]),e("button",{onClick:Z[4]||(Z[4]=fe(s=>te.value=!0,["stop"])),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-secondary bg-secondary text-white text-center transition-all duration-200 hover:bg-blue-700"},[o(t(Xe),{class:"size-6 mb-1"}),S0])])])]),X.value==="legal-documents"?(n(),i("div",E0,[o(rd,{searchQuery:y.value,selectedTags:w.value},null,8,["searchQuery","selectedTags"])])):D("",!0),X.value==="pending-signatures"?(n(),i("div",F0,[o(kt,{state:"PendingSignatures",searchQuery:y.value,selectedTags:w.value,onOpenElectronicSignature:le,onDocumentFullySigned:ce},null,8,["searchQuery","selectedTags"])])):D("",!0),X.value==="signed-documents"?(n(),i("div",T0,[o(kt,{state:"FullySigned",searchQuery:y.value,selectedTags:w.value,onOpenElectronicSignature:le},null,8,["searchQuery","selectedTags"])])):D("",!0),X.value==="finished-documents"?(n(),i("div",A0,[o(gc,{searchQuery:y.value,selectedTags:w.value},null,8,["searchQuery","selectedTags"])])):D("",!0),X.value==="in-progress-documents"?(n(),i("div",M0,[o(_u,{searchQuery:y.value,selectedTags:w.value},null,8,["searchQuery","selectedTags"])])):D("",!0),T.value.length===0?(n(),i("div",P0,I0)):D("",!0)])):D("",!0),g.value==="client"||g.value==="basic"||g.value==="corporate_client"?(n(),i("div",j0,[e("div",B0,[e("div",U0,[e("nav",z0,[(n(),i(de,null,me(ne,s=>e("button",{key:s.name,onClick:fe(l=>Be(s.name),["stop"]),class:$([H.value===s.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},p(s.label),11,N0)),64))]),e("div",O0,[e("div",R0,[e("button",{onClick:fe(se,["stop"]),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border text-purple-600 hover:bg-purple-50 border-purple-200"},[o(t($t),{class:"h-4 w-4"}),oe(" Firma Electrónica ")])]),e("div",q0,[e("button",{onClick:fe(ve,["stop"]),disabled:t(u),class:$(["inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border",t(u)?"text-green-400 bg-gray-50 border-gray-200 cursor-not-allowed opacity-60":"text-green-600 hover:bg-green-50 border-green-200"])},[o(t(Qe),{class:"h-4 w-4"}),oe(" Membrete Global ")],10,V0),t(u)?(n(),i("div",Q0,[oe(" Actualiza tu suscripción para usar esta funcionalidad "),W0])):D("",!0)]),e("button",{onClick:Z[5]||(Z[5]=fe(s=>z("useDocument"),["stop"])),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[o(t(Xe),{class:"h-4 w-4"}),oe(" Nuevo Documento ")])])]),e("div",G0,[e("button",{onClick:Z[6]||(Z[6]=fe(s=>xe.value=!xe.value,["stop"])),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,p(((r=ne.find(s=>s.name===H.value))==null?void 0:r.label)||"Seleccionar sección"),1),(n(),i("svg",{class:$(["ml-2 h-5 w-5 transition-transform duration-200",xe.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Z0,2))]),xe.value?(n(),i("div",J0,[(n(),i(de,null,me(ne,s=>e("button",{key:s.name,onClick:fe(l=>Be(s.name),["stop"]),class:$(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",H.value===s.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},p(s.label),11,K0)),64))])):D("",!0)]),e("div",Y0,[e("div",X0,[e("button",{onClick:fe(se,["stop"]),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-purple-600 bg-purple-50 hover:bg-purple-100"},[o(t($t),{class:"h-5 w-5"}),oe(" Firma Electrónica ")])]),e("div",ep,[e("button",{onClick:fe(ve,["stop"]),disabled:t(u),class:$(["w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors",t(u)?"text-green-400 bg-gray-50 cursor-not-allowed opacity-60":"text-green-600 bg-green-50 hover:bg-green-100"])},[o(t(Qe),{class:"h-5 w-5"}),oe(" Membrete Global ")],10,tp),t(u)?(n(),i("div",sp,[oe(" Actualiza tu suscripción para usar esta funcionalidad "),op])):D("",!0)]),e("button",{onClick:Z[7]||(Z[7]=fe(s=>z("useDocument"),["stop"])),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[o(t(Xe),{class:"h-5 w-5"}),oe(" Nuevo Documento ")])])]),F.value==="useDocument"?(n(),i("div",np,[o(Qa,{searchQuery:y.value,selectedTags:w.value,onGoBack:W},null,8,["searchQuery","selectedTags"])])):(n(),i("div",rp,[H.value==="folders"?(n(),re(Hr,{key:0,searchQuery:y.value,selectedTags:w.value,onRefresh:B,onNavigateToMain:W},null,8,["searchQuery","selectedTags"])):H.value==="my-documents"?(n(),re(ia,{key:1,searchQuery:y.value,selectedTags:w.value,onRefresh:B},null,8,["searchQuery","selectedTags"])):H.value==="pending-signatures"?(n(),re(kt,{key:2,state:"PendingSignatures",searchQuery:y.value,selectedTags:w.value,onRefresh:B,onOpenElectronicSignature:V,onDocumentFullySigned:ye},null,8,["searchQuery","selectedTags"])):H.value==="signed-documents"?(n(),re(kt,{key:3,state:"FullySigned",searchQuery:y.value,selectedTags:w.value,onRefresh:B,onOpenElectronicSignature:V},null,8,["searchQuery","selectedTags"])):D("",!0)]))])):D("",!0)])]),te.value?(n(),re(Ke,{key:0},{default:_(()=>[o(qm,{onClose:S})]),_:1})):D("",!0),m.value&&I.value?(n(),re(Ke,{key:1},{default:_(()=>[e("div",lp,[e("div",ap,[e("div",ip,[dp,e("button",{onClick:Z[8]||(Z[8]=s=>m.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[o(t(Ue),{class:"h-6 w-6"})])]),e("div",cp,[o(zt,{"user-id":I.value.id,"initial-show-options":!I.value.has_signature,onSignatureSaved:Q,onCancel:Z[9]||(Z[9]=s=>m.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):D("",!0),U.value&&I.value?(n(),re(Ke,{key:2},{default:_(()=>[e("div",up,[e("div",mp,[e("div",gp,[pp,e("button",{onClick:Z[10]||(Z[10]=s=>U.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[o(t(Ue),{class:"h-6 w-6"})])]),e("div",hp,[o(zt,{"user-id":I.value.id,"initial-show-options":!I.value.has_signature,onSignatureSaved:Q,onCancel:Z[11]||(Z[11]=s=>U.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):D("",!0),o(jt,{isVisible:t(nt),documentData:t(It),onClose:Z[12]||(Z[12]=s=>nt.value=!1)},null,8,["isVisible","documentData"]),o(n0,{isVisible:A.value,onClose:Z[13]||(Z[13]=s=>A.value=!1),onUploaded:N,onDeleted:Y},null,8,["isVisible"])],64)}}};export{Vp as default};
