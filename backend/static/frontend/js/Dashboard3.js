import{e as s,f as o,g as e,u as et,r as b,aK as rs,o as We,as as pt,c as B,h as r,j as t,G as Te,w as Ce,v as Fe,n as P,l as h,t as g,m as he,p as re,s as $e,b5 as hs,i as j,ac as Qe,a9 as ns,b6 as fs,Q as ht,k as le,a2 as Ze,F as ge,D as Zt,E as ls,b7 as ys,a0 as vs,C as bs,T as ke,N as fe,I as Ke,a1 as Oe,ag as Le,ad as Be,ae as Re,af as ve,b8 as xs,O as Dt,P as St,a5 as _s,ah as ot,aY as ws,ai as Ft,am as qt,an as $s,ao as ks,ab as Cs,b9 as wt,ba as Kt}from"./index.js";import{u as Ve,o as Ds,s as tt,p as Vt}from"./index2.js";import{g as mt,a as gt}from"./DocumentPermissionsManager.js";import{r as Ss,_ as Qt,a as Et}from"./DocumentRelationshipsModal.js";import{_ as Tt}from"./_plugin-vue_export-helper.js";import{B as Fs,r as Es,a as At,b as jt,_ as Wt,c as Ht,D as is,d as Ts,L as Mt,s as Yt}from"./index3.js";import{r as kt}from"./FolderIcon.js";import{r as He}from"./PlusIcon.js";import{r as lt}from"./EllipsisVerticalIcon.js";import{r as at}from"./DocumentIcon.js";import{_ as As}from"./DocumentCard.js";import{r as ds}from"./EyeIcon.js";import{r as ft}from"./ChevronRightIcon.js";import{_ as Jt}from"./SignatureDocumentCard.js";import{r as Nt,a as js,b as Ms}from"./TagIcon.js";import{r as qe}from"./ChevronDownIcon.js";import{r as Ge}from"./MagnifyingGlassIcon.js";import{r as Ct}from"./CheckCircleIcon.js";import{r as Xt}from"./PencilIcon.js";import{r as Ot}from"./TrashIcon.js";import{a as cs,r as es}from"./LinkIcon.js";import{r as us}from"./PhotoIcon.js";import{r as st,a as Ps}from"./FunnelIcon.js";import{r as Ls}from"./ArrowLeftIcon.js";import{r as Pt}from"./CubeTransparentIcon.js";import{r as ts}from"./CloudArrowUpIcon.js";import{r as Bs}from"./ExclamationTriangleIcon.js";import"./useRecentViews.js";import"./loading_message.js";function ss(a,$){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})])}function Rs(a,$){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})])}function zs(a,$){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})])}function Is(a,$){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const Us={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Ns={class:"flex justify-end"},Os=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[re(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),qs={class:"mt-2"},Vs={class:"flex gap-2 mt-2.5"},Qs=["disabled"],Ws=e("span",null,"Actualizar nombre",-1),Hs=[Ws],Gs=["disabled"],ms={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(a,{emit:$}){const i=a,m=et(),D=Ve(),_=$,f=b(""),k=b(""),y=()=>{_("close")};rs(()=>{var te,S;D.selectedDocument?(f.value=((te=D.selectedDocument)==null?void 0:te.title)||"",k.value=((S=D.selectedDocument)==null?void 0:S.title)||""):(f.value="",k.value="")});const C=te=>{te.key==="Escape"&&y()};We(()=>{document.addEventListener("keydown",C)}),pt(()=>{document.removeEventListener("keydown",C)});const W=B(()=>f.value.trim().length>0),U=B(()=>{var te;return!!((te=D.selectedDocument)!=null&&te.id)}),z=B(()=>U.value&&f.value.trim()!==k.value.trim()&&f.value.trim().length>0);async function oe(){if(U.value&&z.value)try{const te={title:f.value.trim()};await D.updateDocument(D.selectedDocument.id,te),k.value=f.value.trim(),D.selectedDocument.title=f.value.trim();const S=D.selectedDocument.id;$e("Document name successfully updated.","success"),_("close",{updatedDocId:S});const F=window.location.pathname;F==="/dynamic_document_dashboard"||F==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(te){console.error("Error updating document name:",te),$e("Error updating document name.","error")}}function de(){const te=encodeURIComponent(f.value.trim());i.documentId&&!D.selectedDocument?m.push(`/dynamic_document_dashboard/document/use/creator/${i.documentId}/${te}`):D.selectedDocument?(D.selectedDocument.title=f.value.trim(),m.push(`/dynamic_document_dashboard/document/use/editor/${D.selectedDocument.id}/${te}`)):$e("Error: No se pudo continuar. Documento no seleccionado.","error")}return(te,S)=>(s(),o("div",Us,[e("div",Ns,[e("button",{onClick:y},[r(t(Te),{class:"size-6"})])]),e("form",{onSubmit:he(de,["prevent"])},[e("div",null,[Os,e("div",qs,[Ce(e("input",{"onUpdate:modelValue":S[0]||(S[0]=d=>f.value=d),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[Fe,f.value]])])]),e("div",Vs,[U.value?(s(),o("button",{key:0,type:"button",onClick:oe,disabled:!z.value,class:P(["p-2.5 text-sm font-medium rounded-md flex gap-2",z.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Hs,10,Qs)):h("",!0),e("button",{type:"submit",class:P(["p-2.5 text-sm font-medium rounded-md flex gap-2",W.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!W.value},[e("span",null,g(U.value?"Editar Documento":"Continuar"),1)],10,Gs)])],32)]))}},Zs={class:"mt-3 pt-2 border-t border-gray-100"},Ks={class:"flex items-center gap-2 text-xs text-gray-500"},Ys=e("span",null,"Hacer clic para usar este documento",-1),Js={__name:"UseDocumentCard",props:{document:{type:Object,required:!0},showTags:{type:Boolean,default:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null},additionalClasses:{type:String,default:""}},emits:["click","remove-from-folder","document-created"],setup(a,{emit:$}){const i=a,m=$,D=b(!1),_=b(null),f=mt(9),k=B(()=>"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium !bg-purple-100 !text-purple-700 !border !border-purple-200"),y=B(()=>f.dark),C=B(()=>{const S="group !border-purple-400 !bg-purple-50/50 !shadow-purple-100";return i.additionalClasses?`${S} ${i.additionalClasses}`:S}),W=B(()=>i.menuOptions!==null?i.menuOptions:[{label:"Usar",action:"use",icon:Rs,iconClasses:"w-4 h-4 text-purple-600"},{label:"Previsualización",action:"preview",icon:ds,iconClasses:"w-4 h-4 text-gray-600"}]),U=B(()=>!1),z=(S,d)=>{i.disableInternalActions?m("click",S,d):de(S.id)},oe=(S,d)=>{switch(S){case"use":de(d.id);break;case"preview":Ds(d);break;default:console.warn("Unknown menu action:",S)}};function de(S){S?(_.value=S,D.value=!0):console.error("Document ID is required:",S)}function te(S){if(D.value=!1,_.value=null,S&&S.updatedDocId){m("document-created",S);const d=window.location.pathname;d==="/dynamic_document_dashboard"||d==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(S.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}}return(S,d)=>(s(),o(ge,null,[r(Fs,{document:a.document,"card-type":a.cardType,"card-context":a.cardContext,"status-icon":t(fs),"status-text":"Disponible","status-badge-classes":k.value,"menu-options":W.value,"highlighted-doc-id":null,"show-tags":a.showTags,"document-store":a.documentStore,"user-store":a.userStore,"additional-classes":C.value,"disable-internal-actions":a.disableInternalActions,"show-menu-options":a.showMenuOptions,onClick:z,onMenuAction:oe,onRemoveFromFolder:d[0]||(d[0]=F=>S.$emit("remove-from-folder",F))},hs({"additional-actions":j(()=>[ns(S.$slots,"additional-actions")]),_:2},[U.value?{name:"right-action",fn:j(()=>[r(t(ft),{class:"w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors"})]),key:"0"}:void 0,a.disableInternalActions?void 0:{name:"footer",fn:j(()=>[e("div",Zs,[e("div",Ks,[e("div",{class:"w-2 h-2 rounded-full",style:Qe({backgroundColor:y.value})},null,4),Ys])])]),key:"1"}]),1032,["document","card-type","card-context","status-icon","status-badge-classes","menu-options","show-tags","document-store","user-store","additional-classes","disable-internal-actions","show-menu-options"]),Ce(r(Ze,null,{default:j(()=>[_.value!==null?(s(),le(ms,{key:0,"document-id":_.value,onClose:te},null,8,["document-id"])):h("",!0)]),_:1},512),[[ht,D.value]])],64))}},Xs=()=>({folders:[],currentFolder:null,isLoading:!1,error:null,lastUpdatedFolderId:null}),eo={sortedFolders:a=>[...a.folders].sort(($,i)=>new Date(i.created_at)-new Date($.created_at)),getFolderById:a=>$=>a.folders.find(i=>i.id===$),getFoldersByColor:a=>$=>a.folders.filter(i=>i.color_id===$),getFolderWithColor:a=>$=>{const i=a.folders.find(m=>m.id===$);return i?{...i,color:mt(i.color_id)}:null},getFoldersContainingDocument:a=>$=>a.folders.filter(i=>i.document_ids&&i.document_ids.includes($)),totalDocumentsInFolders:a=>a.folders.reduce(($,i)=>$+(i.document_ids?i.document_ids.length:0),0),hasFolders:a=>a.folders.length>0,availableColors:()=>gt()},to={async init(a=!1){if(!(this.folders.length>0&&!a)){this.isLoading=!0,this.error=null;try{await this.fetchFolders()}catch($){console.error("Error initializing document folder store:",$),this.error="Error al inicializar las carpetas"}finally{this.isLoading=!1}}},async fetchFolders(){try{const a=await Zt("dynamic-documents/folders/");if(a.status===200)return this.folders=a.data,a.data;throw new Error(`Error fetching folders: ${a.status}`)}catch(a){throw console.error("Error fetching folders:",a),this.error="Error al obtener las carpetas",a}},async fetchFolder(a){this.isLoading=!0,this.error=null;try{const $=await Zt(`dynamic-documents/folders/${a}/`);if($.status===200){const i=$.data,m=this.folders.findIndex(D=>D.id===i.id);return m!==-1?this.folders[m]=i:this.folders.push(i),this.currentFolder=i,i}else throw new Error(`Error fetching folder: ${$.status}`)}catch($){throw console.error("Error fetching folder:",$),this.error="Error al obtener la carpeta",$}finally{this.isLoading=!1}},async createFolder(a){this.isLoading=!0,this.error=null;try{if(!a.name||a.name.trim()==="")throw new Error("El nombre de la carpeta es requerido");const $=a.color_id??0;if($<0||$>=gt().length)throw new Error("Color de carpeta no válido");const i={name:a.name.trim(),color_id:$,...a.document_ids&&{document_ids:a.document_ids}},m=await ls("dynamic-documents/folders/create/",i);if(m.status===200||m.status===201){const D=m.data;return this.folders.push(D),this.lastUpdatedFolderId=D.id,$e("Carpeta creada exitosamente","success"),D}else throw new Error(`Error creating folder: ${m.status}`)}catch($){throw console.error("Error creating folder:",$),this.error=$.message||"Error al crear la carpeta",$e(this.error,"error"),$}finally{this.isLoading=!1}},async updateFolder(a,$){this.isLoading=!0,this.error=null;try{if($.name&&$.name.trim()==="")throw new Error("El nombre de la carpeta no puede estar vacío");if($.color_id!==void 0){const D=$.color_id;if(D<0||D>=gt().length)throw new Error("Color de carpeta no válido")}const i={};$.name&&(i.name=$.name.trim()),$.color_id!==void 0&&(i.color_id=$.color_id),$.document_ids!==void 0&&(i.document_ids=$.document_ids);const m=await ys(`dynamic-documents/folders/${a}/update/`,i);if(m.status===200){const D=m.data,_=this.folders.findIndex(f=>f.id===a);return _!==-1&&(this.folders[_]=D),this.currentFolder&&this.currentFolder.id===a&&(this.currentFolder=D),this.lastUpdatedFolderId=a,$e("Carpeta actualizada exitosamente","success"),D}else throw new Error(`Error updating folder: ${m.status}`)}catch(i){throw console.error("Error updating folder:",i),this.error=i.message||"Error al actualizar la carpeta",$e(this.error,"error"),i}finally{this.isLoading=!1}},async deleteFolder(a){this.isLoading=!0,this.error=null;try{const $=await vs(`dynamic-documents/folders/${a}/delete/`);if($.status===204||$.status===200)return this.folders=this.folders.filter(i=>i.id!==a),this.currentFolder&&this.currentFolder.id===a&&(this.currentFolder=null),await $e("Carpeta eliminada exitosamente","success"),!0;throw new Error(`Error deleting folder: ${$.status}`)}catch($){throw console.error("Error deleting folder:",$),this.error=$.message||"Error al eliminar la carpeta",await $e(this.error,"error"),$}finally{this.isLoading=!1}},setCurrentFolder(a){this.currentFolder=a},clearCurrentFolder(){this.currentFolder=null},reset(){this.folders=[],this.currentFolder=null,this.isLoading=!1,this.error=null,this.lastUpdatedFolderId=null}},so={async addDocumentsToFolder(a,$){const i=this.getFolderById(a);if(!i)throw new Error("Carpeta no encontrada");const m=i.document_ids||[],D=[...new Set([...m,...$])];return await this.updateFolder(a,{document_ids:D})},async removeDocumentsFromFolder(a,$){const i=this.getFolderById(a);if(!i)throw new Error("Carpeta no encontrada");const D=(i.document_ids||[]).filter(_=>!$.includes(_));return await this.updateFolder(a,{document_ids:D})},async moveDocumentsBetweenFolders(a,$,i){try{$&&await this.removeDocumentsFromFolder($,a),i&&await this.addDocumentsToFolder(i,a),await $e("Documentos movidos exitosamente","success")}catch(m){throw console.error("Error moving documents between folders:",m),await $e("Error al mover documentos","error"),m}},getFolderColor(a){const $=this.getFolderById(a);return $?mt($.color_id):mt(0)},validateFolderData(a){const $=[];if((!a.name||a.name.trim()==="")&&$.push("El nombre de la carpeta es requerido"),a.name&&a.name.length>100&&$.push("El nombre de la carpeta no puede exceder 100 caracteres"),a.color_id!==void 0){const i=a.color_id;(i<0||i>=gt().length)&&$.push("Color de carpeta no válido")}return a.document_ids&&!Array.isArray(a.document_ids)&&$.push("Los IDs de documentos deben ser un array"),{isValid:$.length===0,errors:$}}},Gt=bs("documentFolder",{state:Xs,getters:eo,actions:{...to,...so}}),oo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ao={class:"bg-white rounded-xl shadow-xl max-w-md w-full"},ro={class:"flex justify-between items-center p-6 border-b"},no={class:"text-lg font-semibold text-gray-900"},lo={class:"mb-4"},io=e("label",{for:"folderName",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la carpeta ",-1),co={class:"mb-6"},uo=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Color de la carpeta ",-1),mo={class:"grid grid-cols-8 gap-2"},go=["onClick","title"],po={class:"flex gap-3"},ho=["disabled"],fo={__name:"CreateEditFolderModal",props:{isVisible:{type:Boolean,required:!0},editingFolder:{type:Object,default:null}},emits:["close","success"],setup(a,{emit:$}){const i=a,m=$,D=Gt(),_=b(!1),f=b({name:"",color_id:0}),k=B(()=>gt()),y=()=>{f.value={name:"",color_id:0}};ke(()=>i.editingFolder,U=>{U?f.value={name:U.name,color_id:U.color_id}:y()},{immediate:!0}),ke(()=>i.isVisible,U=>{U||y()});const C=()=>{m("close")},W=async()=>{if(f.value.name.trim()){_.value=!0;try{i.editingFolder?await D.updateFolder(i.editingFolder.id,f.value):await D.createFolder(f.value),_.value=!1,m("success")}catch{_.value=!1}}};return(U,z)=>a.isVisible?(s(),le(Ze,{key:0},{default:j(()=>[e("div",oo,[e("div",ao,[e("div",ro,[e("h3",no,g(a.editingFolder?"Editar Carpeta":"Nueva Carpeta"),1),e("button",{onClick:C,class:"text-gray-400 hover:text-gray-500"},[r(t(Te),{class:"w-6 h-6"})])]),e("form",{onSubmit:he(W,["prevent"]),class:"p-6"},[e("div",lo,[io,Ce(e("input",{id:"folderName","onUpdate:modelValue":z[0]||(z[0]=oe=>f.value.name=oe),type:"text",required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ej: Contratos Laborales"},null,512),[[Fe,f.value.name]])]),e("div",co,[uo,e("div",mo,[(s(!0),o(ge,null,fe(k.value,oe=>(s(),o("button",{key:oe.id,type:"button",onClick:de=>f.value.color_id=oe.id,class:P(["w-8 h-8 rounded-full border-2 transition-all",f.value.color_id===oe.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"]),style:Qe({backgroundColor:oe.hex}),title:oe.name},null,14,go))),128))])]),e("div",po,[e("button",{type:"button",onClick:C,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:!f.value.name.trim()||_.value,class:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},g(_.value?"Guardando...":a.editingFolder?"Actualizar":"Crear"),9,ho)])],32)])])]),_:1})):h("",!0)}},yo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},vo={class:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col"},bo={class:"border-b px-6 py-4 flex-shrink-0"},xo={class:"flex justify-between items-center"},_o={class:"flex items-center gap-3"},wo={class:"text-xl font-semibold text-gray-900"},$o={class:"text-sm text-gray-600"},ko={class:"flex items-center gap-2"},Co={class:"flex-1 overflow-y-auto p-6"},Do={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},So={class:"min-w-full divide-y divide-gray-200"},Fo=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tipo "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),Eo={class:"bg-white divide-y divide-gray-200"},To=["onClick"],Ao={class:"px-6 py-4 whitespace-nowrap"},jo={class:"flex items-center"},Mo={class:"flex-shrink-0 h-10 w-10"},Po={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Lo={class:"ml-4"},Bo={class:"text-sm font-medium text-gray-900"},Ro={class:"px-6 py-4 whitespace-nowrap"},zo={class:"text-sm text-gray-600"},Io={class:"px-6 py-4 whitespace-nowrap"},Uo={class:"px-6 py-4 whitespace-nowrap"},No={class:"flex flex-wrap gap-1"},Oo={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},qo={key:1,class:"text-sm text-gray-400"},Vo={class:"py-1"},Qo=["onClick"],Wo=["onClick"],Ho={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Go=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"Esta carpeta está vacía",-1),Zo=e("p",{class:"text-gray-600 mb-4"},"Agrega documentos para organizar tu trabajo",-1),Ko={__name:"FolderDetailsModalTable",props:{folder:{type:Object,default:null}},emits:["close","add-documents","remove-document","view-document","use-document","document-action"],setup(a,{emit:$}){const i=a,m=$;Ke(),Ve();const D=b({}),_=b({}),f=b(!1),k=b(-1),y=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],C=B(()=>{if(!i.folder)return y[0];if(i.folder.color)return y.find(ee=>ee.name===i.folder.color)||y[0];const A=i.folder.id%y.length;return y[A]}),W=A=>A.state==="Published"||A.state==="Draft"?"Formato":A.state==="PendingSignatures"||A.state==="FullySigned"?"Para Firmar":A.state==="Progress"||A.state==="Completed"?"Mis Documentos":"Documento",U=A=>({Published:"Publicado",Draft:"Borrador",Progress:"En Progreso",Completed:"Completado",PendingSignatures:"Pendiente Firma",FullySigned:"Firmado"})[A.state]||A.state,z=A=>({Published:"bg-green-100 text-green-700 border border-green-200",Draft:"bg-gray-100 text-gray-700 border border-gray-200",Progress:"bg-blue-100 text-blue-700 border border-blue-200",Completed:"bg-green-100 text-green-700 border border-green-200",PendingSignatures:"bg-yellow-100 text-yellow-700 border border-yellow-200",FullySigned:"bg-green-100 text-green-700 border border-green-200"})[A.state]||"bg-gray-100 text-gray-700 border border-gray-200",oe=A=>{const ee=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],Q=A.id%ee.length;return ee[Q]},de=()=>{m("close")},te=()=>{m("add-documents",i.folder)},S=A=>{m("remove-document",{folderId:i.folder.id,documentId:A.id})},d=A=>{const ee=W(A);m(ee==="Formato"?"use-document":"view-document",A)},F=()=>!f.value||!i.folder?"auto":i.folder.documents.length===1?"280px":i.folder.documents.length===2&&k.value===1?"340px":"280px",T=(A,ee)=>{A&&(D.value[ee]=A)},X=(A,ee)=>{A&&(_.value[ee]=A)},v=(A,ee)=>{f.value=!ee,k.value=ee?-1:A,ee||setTimeout(()=>{const Q=_.value[A];if(Q){const Y=Q.$el||Q;if(Y&&Y.getBoundingClientRect){const J=Y.getBoundingClientRect(),H=window.innerHeight;if(A===0){if(J.bottom>H-20){const K=J.bottom-H+40;window.scrollBy({top:K,behavior:"smooth"})}}else if(J.bottom>H-10){const K=J.bottom-H+30;window.scrollBy({top:K,behavior:"smooth"})}else if(J.top<80){const K=J.top-100;window.scrollBy({top:K,behavior:"smooth"})}}}},100)};return(A,ee)=>a.folder?(s(),le(Ze,{key:0},{default:j(()=>[e("div",yo,[e("div",vo,[e("div",bo,[e("div",xo,[e("div",_o,[e("div",{class:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:Qe({backgroundColor:C.value.hex+"20"})},[r(t(kt),{class:"h-6 w-6",style:Qe({color:C.value.hex})},null,8,["style"])],4),e("div",null,[e("h3",wo,g(a.folder.name),1),e("p",$o,g(a.folder.documents.length)+" documento"+g(a.folder.documents.length!==1?"s":""),1)])]),e("div",ko,[e("button",{onClick:te,class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"},[r(t(He),{class:"w-5 h-5"}),re(" Agregar documentos ")]),e("button",{onClick:de,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[r(t(Te),{class:"w-6 h-6"})])])])]),e("div",Co,[a.folder.documents.length>0?(s(),o("div",Do,[e("div",{class:"overflow-x-auto",style:Qe({minHeight:F()})},[e("table",So,[Fo,e("tbody",Eo,[(s(!0),o(ge,null,fe(a.folder.documents,(Q,Y)=>{var J;return s(),o("tr",{key:Q.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:H=>d(Q)},[e("td",Ao,[e("div",jo,[e("div",Mo,[e("div",Po,[r(t(Oe),{class:"h-5 w-5 text-blue-600"})])]),e("div",Lo,[e("div",Bo,g(Q.title),1)])])]),e("td",Ro,[e("span",zo,g(W(Q)),1)]),e("td",Io,[e("span",{class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",z(Q)])},g(U(Q)),3)]),e("td",Uo,[e("div",No,[(s(!0),o(ge,null,fe((J=Q.tags)==null?void 0:J.slice(0,2),H=>(s(),o("span",{key:H.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",oe(H)])},g(H.name),3))),128)),Q.tags&&Q.tags.length>2?(s(),o("span",Oo," +"+g(Q.tags.length-2),1)):h("",!0),!Q.tags||Q.tags.length===0?(s(),o("span",qo,"-")):h("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:ee[0]||(ee[0]=he(()=>{},["stop"]))},[r(t(Le),{as:"div",class:"relative inline-block text-left"},{default:j(({open:H})=>[r(t(Be),{ref_for:!0,ref:K=>T(K,Y),onClick:K=>v(Y,H),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:j(()=>[r(t(lt),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),r(t(Re),{ref_for:!0,ref:K=>X(K,Y),class:P([a.folder.documents.length>2&&Y>0&&Y>=a.folder.documents.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:j(()=>[e("div",Vo,[r(t(ve),null,{default:j(({active:K})=>[e("a",{onClick:L=>d(Q),class:P([K?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver documento ",10,Qo)]),_:2},1024),r(t(ve),null,{default:j(({active:K})=>[e("a",{onClick:L=>S(Q),class:P([K?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Quitar de carpeta ",10,Wo)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,To)}),128))])])],4)])):(s(),o("div",Ho,[r(t(at),{class:"w-12 h-12 text-gray-300 mx-auto mb-4"}),Go,Zo,e("button",{onClick:te,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},[r(t(He),{class:"w-5 h-5"}),re(" Agregar documentos ")])]))])])])]),_:1})):h("",!0)}},yt=a=>(Dt("data-v-d403a707"),a=a(),St(),a),Yo={class:"tag-filter-container"},Jo={class:"relative"},Xo={class:"flex items-center"},ea={key:0,class:"ml-2 inline-flex items-center justify-center h-5 w-5 bg-primary text-white text-xs rounded-full font-medium"},ta={key:0,class:"absolute left-0 mt-2 w-full sm:w-80 bg-white rounded-xl shadow-xl ring-1 ring-black ring-opacity-5 border border-gray-100 z-50 overflow-hidden"},sa={class:"bg-gray-50 p-4 border-b border-gray-200"},oa={class:"flex items-center justify-between mb-3"},aa=yt(()=>e("h3",{class:"text-sm font-semibold text-gray-900"},"Filtrar por etiquetas",-1)),ra={key:0,class:"text-xs text-gray-500"},na={class:"relative"},la={key:0,class:"px-4 py-2 bg-blue-50 border-b border-blue-100"},ia={class:"flex items-center justify-between"},da={class:"text-xs font-medium text-blue-700"},ca={class:"max-h-52 overflow-y-auto"},ua={key:0,class:"px-4 py-8 text-center"},ma=yt(()=>e("p",{class:"text-gray-500 text-sm"},"No hay etiquetas disponibles",-1)),ga={key:1,class:"px-4 py-8 text-center"},pa={class:"text-gray-500 text-sm"},ha={key:2,class:"px-4 py-8 text-center"},fa=yt(()=>e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"}),e("span",{class:"ml-3 text-sm text-gray-600"},"Cargando etiquetas...")],-1)),ya=[fa],va={key:3,class:"py-2"},ba=["onClick"],xa={class:"flex items-center h-5"},_a={class:"relative"},wa=["id","checked","onChange"],$a={key:0,class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},ka=yt(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),Ca=[ka],Da={class:"ml-3 flex items-center flex-1 min-w-0"},Sa={class:"text-sm font-medium text-gray-900 truncate"},Fa={key:0,class:"mt-4"},Ea={class:"flex items-start gap-2"},Ta=yt(()=>e("span",{class:"text-xs font-medium text-gray-500 mt-1.5 flex-shrink-0"},"Activos:",-1)),Aa={class:"flex flex-wrap gap-2"},ja=["onClick"],Ma={class:"mr-1"},Pa={class:"ml-1 p-0.5 rounded-full hover:bg-white/50 transition-colors duration-150"},La={__name:"TagFilter",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(a,{emit:$}){const i=a,m=$,D=Ve(),_=b(!1),f=b([]),k=b(!1),y=b(""),C=B(()=>D.sortedTags),W=B(()=>{if(!y.value.trim())return C.value;const d=y.value.toLowerCase().trim();return C.value.filter(F=>F.name.toLowerCase().includes(d))}),U=d=>{const F=mt(d.color_id);return{hex:F&&F.hex?F.hex:"#9CA3AF",dark:F&&F.dark?F.dark:"#374151"}},z=()=>{_.value=!_.value,_.value&&(y.value="")},oe=d=>f.value.some(F=>F.id===d.id),de=d=>{const F=f.value.findIndex(T=>T.id===d.id);F>=0?f.value.splice(F,1):f.value.push(d),m("update:modelValue",f.value)},te=()=>{f.value=[],m("update:modelValue",[])},S=d=>{d.target.closest(".tag-filter-container")||(_.value=!1,y.value="")};return We(async()=>{try{k.value=!0,await D.initTags()}catch(d){console.error("Error loading tags:",d)}finally{k.value=!1}document.addEventListener("click",S)}),ke(()=>i.modelValue,d=>{f.value=d||[]},{immediate:!0}),pt(()=>{document.removeEventListener("click",S)}),(d,F)=>(s(),o("div",Yo,[e("div",Jo,[e("button",{onClick:z,class:P(["group inline-flex items-center justify-between w-full sm:w-auto sm:min-w-[200px] px-4 py-3 border border-gray-200 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-primary transition-all duration-200",{"ring-2 ring-primary border-primary bg-blue-50":_.value,"border-primary bg-primary/5":f.value.length>0&&!_.value}])},[e("div",Xo,[r(t(Nt),{class:P(["h-5 w-5 mr-2.5 text-gray-500 group-hover:text-gray-600",{"text-primary":f.value.length>0||_.value}])},null,8,["class"]),e("span",{class:P(["text-gray-700",{"text-primary font-semibold":f.value.length>0||_.value}])}," Filtrar por etiquetas ",2),f.value.length>0?(s(),o("span",ea,g(f.value.length),1)):h("",!0)]),r(t(qe),{class:P(["ml-3 h-4 w-4 text-gray-400 transition-all duration-200 group-hover:text-gray-600",{"rotate-180 text-primary":_.value,"text-primary":f.value.length>0&&!_.value}])},null,8,["class"])],2),r(xs,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:j(()=>[_.value?(s(),o("div",ta,[e("div",sa,[e("div",oa,[aa,C.value.length>0?(s(),o("span",ra,g(C.value.length)+" disponibles ",1)):h("",!0)]),e("div",na,[r(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Ce(e("input",{"onUpdate:modelValue":F[0]||(F[0]=T=>y.value=T),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"},null,512),[[Fe,y.value]])])]),f.value.length>0?(s(),o("div",la,[e("div",ia,[e("span",da,g(f.value.length)+" etiqueta"+g(f.value.length!==1?"s":"")+" seleccionada"+g(f.value.length!==1?"s":""),1),e("button",{onClick:te,class:"text-xs text-red-600 hover:text-red-700 font-medium px-2 py-1 rounded-md hover:bg-red-50 transition-all duration-200"}," Limpiar todo ")])])):h("",!0),e("div",ca,[!k.value&&W.value.length===0&&y.value.trim()===""?(s(),o("div",ua,[r(t(Nt),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),ma])):h("",!0),!k.value&&W.value.length===0&&y.value.trim()!==""?(s(),o("div",ga,[r(t(Ge),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e("p",pa,'Sin resultados para "'+g(y.value)+'"',1),e("button",{onClick:F[1]||(F[1]=T=>y.value=""),class:"text-xs text-primary hover:text-primary-dark mt-2 font-medium"}," Ver todas las etiquetas ")])):h("",!0),k.value?(s(),o("div",ha,ya)):h("",!0),!k.value&&W.value.length>0?(s(),o("div",va,[(s(!0),o(ge,null,fe(W.value,T=>(s(),o("div",{key:T.id,class:"group flex items-center px-4 py-2.5 hover:bg-gray-50 cursor-pointer transition-colors duration-150",onClick:X=>de(T)},[e("div",xa,[e("div",_a,[e("input",{id:`tag-${T.id}`,type:"checkbox",checked:oe(T),onChange:X=>de(T),class:"sr-only"},null,40,wa),e("div",{class:P(["w-4 h-4 border-2 rounded transition-all duration-200 flex items-center justify-center",oe(T)?"bg-primary border-primary":"border-gray-300 group-hover:border-gray-400"])},[oe(T)?(s(),o("svg",$a,Ca)):h("",!0)],2)])]),e("div",Da,[e("div",{class:"w-3 h-3 rounded-full mr-2.5 border flex-shrink-0 shadow-sm",style:Qe({backgroundColor:U(T).hex})},null,4),e("span",Sa,g(T.name),1)])],8,ba))),128))])):h("",!0)])])):h("",!0)]),_:1})]),f.value.length>0?(s(),o("div",Fa,[e("div",Ea,[Ta,e("div",Aa,[(s(!0),o(ge,null,fe(f.value,T=>(s(),o("div",{key:T.id,class:"group inline-flex items-center pl-2.5 pr-1.5 py-1.5 rounded-lg text-xs font-medium border shadow-sm cursor-pointer transition-all duration-200 hover:shadow-md",style:Qe({backgroundColor:U(T).hex+"20",borderColor:U(T).hex+"40",color:U(T).dark}),onClick:X=>de(T)},[e("div",{class:"w-2 h-2 rounded-full mr-2 flex-shrink-0",style:Qe({backgroundColor:U(T).hex})},null,4),e("span",Ma,g(T.name),1),e("div",Pa,[r(t(Te),{class:"h-3 w-3 opacity-60 group-hover:opacity-100"})])],12,ja))),128))])])])):h("",!0)]))}},Ba=Tt(La,[["__scopeId","data-v-d403a707"]]),Ra={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},za={class:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden"},Ia={class:"border-b"},Ua={class:"hidden sm:flex justify-between items-center p-6"},Na=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Oa={class:"text-sm text-gray-600"},qa={class:"sm:hidden p-4"},Va={class:"flex justify-between items-start mb-2"},Qa={class:"flex-1 min-w-0 mr-3"},Wa=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Ha={class:"text-sm text-gray-600 truncate"},Ga={class:"border-b"},Za={class:"hidden sm:flex space-x-8 px-6","aria-label":"Tabs"},Ka=["onClick"],Ya={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},Ja={class:"sm:hidden relative px-4 py-3"},Xa={class:"flex items-center"},er={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},tr=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),sr=[tr],or={class:"absolute top-full left-4 right-4 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},ar=["onClick"],rr={class:"border-b bg-gray-50 p-4 sm:p-6"},nr={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},lr={class:"flex-1"},ir={key:0,class:"flex items-center gap-3"},dr={class:"text-sm text-gray-600"},cr={class:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-350px)]"},ur={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},mr=["onClick"],gr=e("span",null,"Etiquetas",-1),pr=[gr],hr={key:5,class:"absolute top-2 left-2 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center shadow-sm"},fr={key:0,class:"text-center py-8 sm:py-12"},yr={class:"text-lg font-medium text-gray-900 mb-2"},vr={class:"text-gray-600 text-sm sm:text-base"},br={class:"border-t bg-gray-50"},xr={class:"hidden sm:flex justify-between items-center p-6"},_r={class:"text-sm text-gray-600"},wr={class:"flex gap-3"},$r=["disabled"],kr={class:"sm:hidden p-4 space-y-3"},Cr={class:"text-center text-sm text-gray-600"},Dr={class:"flex gap-3"},Sr=["disabled"],Fr={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 p-4"},Er={class:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] flex flex-col"},Tr={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},Ar={class:"flex items-center gap-2"},jr=e("h2",{class:"text-sm font-semibold text-gray-900"},"Etiquetas del documento",-1),Mr={class:"px-4 py-3 border-b border-gray-100 text-xs text-gray-500"},Pr=e("span",{class:"font-medium text-gray-700"},"Documento:",-1),Lr={class:"ml-1"},Br={class:"px-4 py-3 overflow-y-auto"},Rr={key:0,class:"text-sm text-gray-500"},zr={key:1,class:"space-y-2 text-sm"},Ir={class:"flex items-center gap-2 min-w-0"},Ur={key:0,class:"text-xs text-gray-500 truncate max-w-[8rem]"},Nr={__name:"AddDocumentsModal",props:{isVisible:{type:Boolean,required:!0},folder:{type:Object,default:null}},emits:["close","add-documents"],setup(a,{emit:$}){const i=a,m=$,D=Ve(),_=Ke(),f=b([]),k=b([]),y=b("my-documents"),C=b(!1),W=b(!1),U=b(!1),z=b(null),oe=[{name:"my-documents",label:"Mis Documentos"},{name:"use-documents",label:"Minutas"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Documentos Firmados"}],de=B(()=>_.currentUser);ke(()=>i.isVisible,H=>{H&&(f.value=[],k.value=[],y.value="my-documents")}),ke(y,()=>{f.value=[]}),ke(k,()=>{f.value=[]},{deep:!0});const te=B(()=>{const H=d(y.value);return H.length===0?!1:H.every(K=>f.value.includes(K.id))}),S=H=>{var M;if(!i.folder)return[];const K=i.folder.documents.map(ie=>ie.id);let L=[];switch(H){case"my-documents":L=D.progressAndCompletedDocumentsByClient((M=de.value)==null?void 0:M.id);break;case"use-documents":L=D.publishedDocumentsUnassigned;break;case"pending-signatures":L=D.documents.filter(ie=>{var pe,q;return ie.state==="PendingSignatures"&&(ie.assigned_to===((pe=de.value)==null?void 0:pe.id)||((q=ie.signatures)==null?void 0:q.some(V=>{var N;return V.signer_email===((N=de.value)==null?void 0:N.email)})))});break;case"signed-documents":L=D.documents.filter(ie=>{var pe,q;return ie.state==="FullySigned"&&(ie.assigned_to===((pe=de.value)==null?void 0:pe.id)||((q=ie.signatures)==null?void 0:q.some(V=>{var N;return V.signer_email===((N=de.value)==null?void 0:N.email)})))});break;default:L=[]}return L.filter(ie=>!K.includes(ie.id))},d=H=>{const K=S(H);if(!k.value||k.value.length===0)return K;const L=k.value.map(M=>M.id);return K.filter(M=>!M.tags||M.tags.length===0?!1:M.tags.some(ie=>L.includes(ie.id)))},F=H=>{const K=f.value.indexOf(H);K>-1?f.value.splice(K,1):f.value.push(H)},T=()=>{const K=d(y.value).map(L=>L.id);if(te.value)f.value=f.value.filter(L=>!K.includes(L));else{const L=K.filter(M=>!f.value.includes(M));f.value.push(...L)}},X=()=>{m("close")},v=async()=>{if(f.value.length!==0){C.value=!0;try{await m("add-documents",f.value)}finally{C.value=!1}}},A=H=>{y.value=H,W.value=!1},ee=H=>{H.target.closest(".relative")||(W.value=!1)};We(()=>{document.addEventListener("click",ee)}),pt(()=>{document.removeEventListener("click",ee)});const Q=H=>{const K=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],L=H.id%K.length;return K[L]},Y=H=>{z.value=H,U.value=!0},J=()=>{U.value=!1,z.value=null};return(H,K)=>a.isVisible&&a.folder?(s(),le(Ze,{key:0},{default:j(()=>{var L;return[e("div",Ra,[e("div",za,[e("div",Ia,[e("div",Ua,[e("div",null,[Na,e("p",Oa,'Selecciona documentos para agregar a "'+g(a.folder.name)+'"',1)]),e("button",{onClick:X,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors"},[r(t(Te),{class:"w-5 h-5"})])]),e("div",qa,[e("div",Va,[e("div",Qa,[Wa,e("p",Ha,'Para "'+g(a.folder.name)+'"',1)]),e("button",{onClick:X,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors flex-shrink-0"},[r(t(Te),{class:"w-5 h-5"})])])])]),e("div",Ga,[e("nav",Za,[(s(),o(ge,null,fe(oe,M=>e("button",{key:M.name,onClick:ie=>y.value=M.name,class:P([y.value===M.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[re(g(M.label)+" ",1),e("span",Ya,g(d(M.name).length),1)],10,Ka)),64))]),e("div",Ja,[e("button",{onClick:K[0]||(K[0]=M=>W.value=!W.value),class:"w-full flex items-center justify-between py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("div",Xa,[e("span",null,g(((L=oe.find(M=>M.name===y.value))==null?void 0:L.label)||"Seleccionar categoría"),1),e("span",er,g(d(y.value).length),1)]),(s(),o("svg",{class:P(["ml-2 h-5 w-5 transition-transform duration-200",W.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},sr,2))]),Ce(e("div",or,[(s(),o(ge,null,fe(oe,M=>e("button",{key:M.name,onClick:ie=>A(M.name),class:P(["w-full text-left px-4 py-3 text-sm transition-colors duration-150 flex items-center justify-between",y.value===M.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},[e("span",null,g(M.label),1),e("span",{class:P(["py-0.5 px-2 rounded-full text-xs",y.value===M.name?"bg-white/20 text-white":"bg-gray-100 text-gray-600"])},g(d(M.name).length),3)],10,ar)),64))],512),[[ht,W.value]])])]),e("div",rr,[e("div",nr,[e("div",lr,[r(Ba,{modelValue:k.value,"onUpdate:modelValue":K[1]||(K[1]=M=>k.value=M),class:"max-w-md"},null,8,["modelValue"])]),d(y.value).length>0?(s(),o("div",ir,[e("span",dr,g(d(y.value).length)+" documento(s) disponible(s) ",1),e("button",{onClick:T,class:P(["px-4 py-2 rounded-lg border font-medium text-sm transition-colors",te.value?"bg-red-50 border-red-200 text-red-700 hover:bg-red-100":"bg-primary text-white border-primary hover:bg-primary-dark"])},g(te.value?"Deseleccionar todos":"Seleccionar todos"),3)])):h("",!0)])]),e("div",cr,[e("div",ur,[(s(!0),o(ge,null,fe(d(y.value),M=>(s(),o("div",{key:M.id,class:"relative"},[y.value==="my-documents"?(s(),le(t(As),{key:0,document:M,"highlighted-doc-id":null,"show-tags":!1,"show-client-name":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":f.value.includes(M.id)?"ring-2 ring-primary bg-primary-50":"",onClick:ie=>F(M.id)},null,8,["document","additional-classes","onClick"])):h("",!0),y.value==="use-documents"?(s(),le(t(Js),{key:1,document:M,"show-tags":!1,"menu-options":[],"show-menu-options":!1,"disable-internal-actions":!0,"additional-classes":f.value.includes(M.id)?"ring-2 ring-primary bg-primary-50":"",onClick:ie=>F(M.id)},null,8,["document","additional-classes","onClick"])):h("",!0),y.value==="pending-signatures"?(s(),le(t(Jt),{key:2,document:M,"highlighted-doc-id":null,"show-tags":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":f.value.includes(M.id)?"ring-2 ring-primary bg-primary-50":"",onClick:ie=>F(M.id)},null,8,["document","additional-classes","onClick"])):h("",!0),y.value==="signed-documents"?(s(),le(t(Jt),{key:3,document:M,"highlighted-doc-id":null,"show-tags":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":f.value.includes(M.id)?"ring-2 ring-primary bg-primary-50":"",onClick:ie=>F(M.id)},null,8,["document","additional-classes","onClick"])):h("",!0),M.tags&&M.tags.length>0?(s(),o("button",{key:4,type:"button",class:"absolute bottom-2 right-2 px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 inline-flex items-center gap-1",onClick:he(ie=>Y(M),["stop"])},pr,8,mr)):h("",!0),f.value.includes(M.id)?(s(),o("div",hr,[r(t(js),{class:"w-4 h-4"})])):h("",!0)]))),128))]),d(y.value).length===0?(s(),o("div",fr,[r(t(at),{class:"w-12 h-12 sm:w-16 sm:h-16 text-gray-300 mx-auto mb-4"}),e("h4",yr,g(k.value.length>0?"No hay documentos que coincidan con el filtro":"No hay documentos disponibles"),1),e("p",vr,g(k.value.length>0?"Intenta ajustar los filtros de etiquetas o selecciona otra categoría":"No tienes documentos de esta categoría que no estén ya en la carpeta"),1)])):h("",!0)]),e("div",br,[e("div",xr,[e("div",_r,g(f.value.length)+" documento(s) seleccionado(s) ",1),e("div",wr,[e("button",{onClick:X,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{onClick:v,disabled:f.value.length===0||C.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},g(C.value?"Agregando...":`Agregar ${f.value.length} documento(s)`),9,$r)])]),e("div",kr,[e("div",Cr,g(f.value.length)+" documento(s) seleccionado(s) ",1),e("div",Dr,[e("button",{onClick:X,class:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center font-medium"}," Cancelar "),e("button",{onClick:v,disabled:f.value.length===0||C.value,class:"flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-center font-medium"},g(C.value?"Agregando...":"Agregar"),9,Sr)])])]),U.value&&z.value?(s(),o("div",Fr,[e("div",Er,[e("div",Tr,[e("div",Ar,[r(t(at),{class:"h-5 w-5 text-gray-500"}),jr]),e("button",{type:"button",class:"text-gray-400 hover:text-gray-600 p-1 rounded-md hover:bg-gray-100",onClick:J},[r(t(Te),{class:"h-5 w-5"})])]),e("div",Mr,[Pr,e("span",Lr,g(z.value.title||"Sin título"),1)]),e("div",Br,[!z.value.tags||z.value.tags.length===0?(s(),o("div",Rr," Este documento no tiene etiquetas. ")):(s(),o("ul",zr,[(s(!0),o(ge,null,fe(z.value.tags,M=>(s(),o("li",{key:M.id,class:"flex items-center justify-between gap-2"},[e("div",Ir,[e("span",{class:P(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",Q(M)])},g(M.name),3)]),M.description?(s(),o("span",Ur,g(M.description),1)):h("",!0)]))),128))]))]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end"},[e("button",{type:"button",class:"px-4 py-2 text-sm font-medium rounded-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-50",onClick:J}," Cerrar ")])])])):h("",!0)])])]}),_:1})):h("",!0)}},it=a=>(Dt("data-v-d9a5a89f"),a=a(),St(),a),Or={class:"folders-table"},qr={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200",style:{"overflow-x":"visible","overflow-y":"hidden"}},Vr={class:"min-w-full divide-y divide-gray-200"},Qr=it(()=>e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Carpeta "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documentos "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Creada "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1)),Wr={class:"bg-white divide-y divide-gray-200"},Hr=["onClick"],Gr={class:"px-6 py-4 whitespace-nowrap"},Zr={class:"flex items-center"},Kr={class:"flex-shrink-0 h-10 w-10"},Yr={class:"ml-4"},Jr={class:"text-sm font-medium text-gray-900"},Xr={class:"px-6 py-4 whitespace-nowrap"},en={class:"flex items-center gap-2"},tn={class:"text-sm text-gray-900"},sn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},on={class:"py-1"},an=["onClick"],rn=["onClick"],nn=["onClick"],ln=["onClick"],dn={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},cn=it(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No tienes carpetas aún",-1)),un=it(()=>e("p",{class:"text-gray-600 mb-6"},"Crea tu primera carpeta para organizar tus documentos",-1)),mn={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},gn=it(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No se encontraron carpetas",-1)),pn=it(()=>e("p",{class:"text-gray-600"},"No hay carpetas que coincidan con tu búsqueda",-1)),hn={key:3,class:"flex justify-center items-center py-12"},fn=it(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)),yn=[fn],vn={__name:"FoldersTable",props:{sortedFolders:{type:Array,required:!0},searchQuery:{type:String,default:""},isLoading:{type:Boolean,default:!1}},emits:["folder-click","edit-folder","delete-folder","add-documents","create-folder"],setup(a,{emit:$}){const i=a,m=$,D=b({}),_=b({}),f=b(!1),k=b(-1),y=B(()=>{if(!i.searchQuery.trim())return i.sortedFolders;const v=i.searchQuery.toLowerCase();return i.sortedFolders.filter(A=>A.name.toLowerCase().includes(v))}),C=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],W=v=>{if(v.color)return C.find(ee=>ee.name===v.color)||C[0];const A=v.id%C.length;return C[A]},U=v=>{if(!v)return"-";const A=new Date(v),Q=Math.abs(new Date-A),Y=Math.ceil(Q/(1e3*60*60*24));return Y===0?"Hoy":Y===1?"Ayer":Y<7?`Hace ${Y} días`:Y<30?`Hace ${Math.floor(Y/7)} semanas`:Y<365?`Hace ${Math.floor(Y/30)} meses`:A.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},z=v=>{m("folder-click",v)},oe=v=>{m("edit-folder",v)},de=v=>{m("delete-folder",v)},te=v=>{m("add-documents",v)},S=()=>{m("create-folder")},d=()=>f.value?y.value.length===1?"280px":y.value.length===2&&k.value===1?"340px":"280px":"auto",F=(v,A)=>{v&&(D.value[A]=v)},T=(v,A)=>{v&&(_.value[A]=v)},X=(v,A)=>{f.value=!A,k.value=A?-1:v,A||setTimeout(()=>{const ee=_.value[v];if(ee){const Q=ee.$el||ee;if(Q&&Q.getBoundingClientRect){const Y=Q.getBoundingClientRect(),J=window.innerHeight;if(v===0){if(Y.bottom>J-20){const H=Y.bottom-J+40;window.scrollBy({top:H,behavior:"smooth"})}}else if(Y.bottom>J-10){const H=Y.bottom-J+30;window.scrollBy({top:H,behavior:"smooth"})}else if(Y.top<80){const H=Y.top-100;window.scrollBy({top:H,behavior:"smooth"})}}}},100)};return(v,A)=>(s(),o("div",Or,[!a.isLoading&&y.value.length>0?(s(),o("div",qr,[e("div",{class:"overflow-x-auto",style:Qe({minHeight:d(),overflowY:"visible"})},[e("table",Vr,[Qr,e("tbody",Wr,[(s(!0),o(ge,null,fe(y.value,(ee,Q)=>{var Y,J;return s(),o("tr",{key:ee.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:H=>z(ee)},[e("td",Gr,[e("div",Zr,[e("div",Kr,[e("div",{class:"h-10 w-10 rounded-lg flex items-center justify-center",style:Qe({backgroundColor:W(ee).hex+"20"})},[r(t(kt),{class:"h-6 w-6",style:Qe({color:W(ee).hex})},null,8,["style"])],4)]),e("div",Yr,[e("div",Jr,g(ee.name),1)])])]),e("td",Xr,[e("div",en,[r(t(Oe),{class:"h-5 w-5 text-gray-400"}),e("span",tn,g(((Y=ee.documents)==null?void 0:Y.length)||0)+" documento"+g((((J=ee.documents)==null?void 0:J.length)||0)!==1?"s":""),1)])]),e("td",sn,g(U(ee.created_at)),1),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:A[0]||(A[0]=he(()=>{},["stop"]))},[r(t(Le),{as:"div",class:"relative inline-block text-left"},{default:j(({open:H})=>[r(t(Be),{ref_for:!0,ref:K=>F(K,Q),onClick:K=>X(Q,H),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:j(()=>[r(t(lt),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),r(t(Re),{ref_for:!0,ref:K=>T(K,Q),class:P([y.value.length>2&&Q>0&&Q>=y.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:j(()=>[e("div",on,[r(t(ve),null,{default:j(({active:K})=>[e("a",{onClick:L=>z(ee),class:P([K?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver carpeta ",10,an)]),_:2},1024),r(t(ve),null,{default:j(({active:K})=>[e("a",{onClick:L=>te(ee),class:P([K?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Agregar documentos ",10,rn)]),_:2},1024),r(t(ve),null,{default:j(({active:K})=>[e("a",{onClick:L=>oe(ee),class:P([K?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Editar ",10,nn)]),_:2},1024),r(t(ve),null,{default:j(({active:K})=>[e("a",{onClick:L=>de(ee),class:P([K?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Eliminar ",10,ln)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,Hr)}),128))])])],4)])):!a.isLoading&&a.sortedFolders.length===0?(s(),o("div",dn,[r(t(kt),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),cn,un,e("button",{onClick:S,class:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"},[r(t(He),{class:"w-5 h-5"}),re(" Crear Primera Carpeta ")])])):!a.isLoading&&a.sortedFolders.length>0&&y.value.length===0?(s(),o("div",mn,[r(t(kt),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),gn,pn])):h("",!0),a.isLoading?(s(),o("div",hn,yn)):h("",!0)]))}},bn=Tt(vn,[["__scopeId","data-v-d9a5a89f"]]),gs=a=>(Dt("data-v-e3f57445"),a=a(),St(),a),xn={class:"folder-management"},_n={class:"mb-6"},wn={class:"hidden sm:flex justify-between items-center"},$n=gs(()=>e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),kn={class:"sm:hidden"},Cn=gs(()=>e("div",{class:"text-center mb-4"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1 px-2"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Dn={__name:"FolderManagement",props:{searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","navigate-to-main","navigate-to-document"],setup(a,{emit:$}){const i=a,m=$,D=Gt(),_=Ve(),f=Ke(),k=b(!1),y=b(null),C=b(null),W=b(!1),U=b(null),z=B(()=>D.isLoading),oe=B(()=>D.sortedFolders);B(()=>f.currentUser),We(async()=>{await D.init(),await _.init()}),ke(()=>i.searchQuery,()=>{}),ke(()=>D.folders,L=>{var M,ie;if(C.value&&L&&L.length>0){const pe=L.find(q=>q.id===C.value.id);pe&&((M=C.value.documents)!=null&&M.length,(ie=pe.documents)!=null&&ie.length,JSON.stringify(C.value)!==JSON.stringify(pe)&&(C.value={...pe}))}},{deep:!0});const de=()=>{y.value=null,k.value=!0},te=L=>{y.value=L,k.value=!0},S=()=>{k.value=!1,y.value=null},d=()=>{S()},F=L=>{C.value=L},T=()=>{C.value=null},X=async L=>{if(confirm(`¿Estás seguro de que quieres eliminar la carpeta "${L.name}"?`))try{await D.deleteFolder(L.id),$e(`Carpeta "${L.name}" eliminada correctamente`,"success")}catch(M){$e("Error al eliminar la carpeta","error"),console.error("Error deleting folder:",M)}},v=L=>{U.value=L,W.value=!0},A=async(L=!1)=>{if(W.value=!1,U.value=null,L&&C.value)try{await ee()}catch(M){console.warn("Error refreshing folder after adding documents:",M)}},ee=async()=>{if(C.value)try{await D.fetchFolder(C.value.id);const L=D.getFolderById(C.value.id);L&&(C.value={...L},console.log("✅ Selected folder refreshed successfully"))}catch(L){throw console.error("❌ Error refreshing selected folder:",L),L}},Q=async L=>{var M,ie,pe;if(!(!U.value||L.length===0))try{const q=U.value.documents.map(G=>G.id).filter(G=>G!=null&&!isNaN(parseInt(G))).map(G=>parseInt(G)),V=L.filter(G=>G!=null&&!isNaN(parseInt(G))).map(G=>parseInt(G)),N=[...new Set([...q,...V])];if(console.log("Current document IDs:",q),console.log("Selected document IDs:",V),console.log("Updated document IDs:",N),N.some(G=>!Number.isInteger(G)||G<=0))throw new Error("IDs de documentos inválidos detectados");await D.updateFolder(U.value.id,{document_ids:N}),await A(!0),$e(`${V.length} documento(s) agregado(s) a la carpeta`,"success"),m("navigate-to-main")}catch(q){console.error("Error adding documents to folder:",q),console.error("Error details:",((M=q.response)==null?void 0:M.data)||q.message),(ie=q.response)!=null&&ie.status?$e(`Error al agregar documentos: ${((pe=q.response.data)==null?void 0:pe.detail)||q.message}`,"error"):$e("Error al agregar documentos a la carpeta","error")}},Y=async L=>{var ie,pe,q;if(!C.value)return;const M=typeof L=="object"&&L!==null?L.documentId:L;try{const V=parseInt(M);if(!Number.isInteger(V)||V<=0)throw new Error("ID de documento inválido");const N=C.value.documents.map(G=>G.id).filter(G=>G!=null&&!isNaN(parseInt(G))).map(G=>parseInt(G)).filter(G=>G!==V);await D.updateFolder(C.value.id,{document_ids:N}),$e("Documento removido de la carpeta","success"),C.value=null,m("navigate-to-main")}catch(V){console.error("Error removing document from folder:",V),console.error("Error details:",((ie=V.response)==null?void 0:ie.data)||V.message),(pe=V.response)!=null&&pe.status?$e(`Error al remover documento: ${((q=V.response.data)==null?void 0:q.detail)||V.message}`,"error"):$e("Error al remover el documento de la carpeta","error")}},J=L=>{let M="legal-documents";L.state==="Published"||L.state==="Draft"?M="legal-documents":L.state==="PendingSignatures"?M="pending-signatures":L.state==="FullySigned"?M="signed-documents":L.state==="Progress"||L.state==="Completed"?M="my-documents":(L.state==="Rejected"||L.state==="Expired"||L.state==="Archived")&&(M="archived-documents"),C.value=null,m("navigate-to-document",{tab:M,searchQuery:L.title})},H=L=>{C.value=null,m("navigate-to-document",{tab:"legal-documents",searchQuery:L.title})},K=(L,M)=>{console.log("Document action:",L,M)};return(L,M)=>(s(),o("div",xn,[e("div",_n,[e("div",wn,[$n,e("button",{onClick:de,class:"inline-flex items-center gap-2 px-4 py-2.5 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md"},[r(t(He),{class:"w-5 h-5"}),re(" Nueva Carpeta ")])]),e("div",kn,[Cn,e("button",{onClick:de,class:"w-full flex items-center justify-center gap-3 px-4 py-4 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium text-base"},[r(t(He),{class:"w-6 h-6"}),re(" Nueva Carpeta ")])])]),r(t(bn),{"sorted-folders":oe.value,"search-query":a.searchQuery,"is-loading":z.value,onFolderClick:F,onEditFolder:te,onDeleteFolder:X,onAddDocuments:v,onCreateFolder:de},null,8,["sorted-folders","search-query","is-loading"]),r(t(fo),{"is-visible":k.value,"editing-folder":y.value,onClose:S,onSuccess:d},null,8,["is-visible","editing-folder"]),r(t(Ko),{folder:C.value,onClose:T,onAddDocuments:v,onRemoveDocument:Y,onViewDocument:J,onUseDocument:H,onDocumentAction:K},null,8,["folder"]),r(t(Nr),{"is-visible":W.value,folder:U.value,onClose:A,onAddDocuments:Q},null,8,["is-visible","folder"])]))}},os=Tt(Dn,[["__scopeId","data-v-e3f57445"]]);function Sn(a){return!a.variables||a.variables.length===0?!0:a.variables.every($=>$.name_es&&$.name_es.trim().length>0)}function $t(a,$){var D;if(!a.requires_signature||a.state!=="PendingSignatures"||!a.signatures||a.signatures.length===0)return!1;const i=(D=$==null?void 0:$.currentUser)==null?void 0:D.email,m=a.signatures.find(_=>_.signer_email===i);return!(!m||m.signed)}const Fn={lawyer:{getMenuOptions:(a,$,i)=>{let m;return $==="legal-documents"&&(a.state==="Draft"||a.state==="Published")?m=[{label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Actualizar nombre",action:"edit"},{label:"Editar documento",action:"editDocument"},{label:"Editar configuración de variables",action:"editForm"}]},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}]:m=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}],a.state!=="Draft"&&a.state!=="Published"&&m.splice(2,0,{label:"Administrar Asociaciones",action:"relationships"}),a.state==="Draft"?m.push({label:"Publicar",action:"publish",disabled:!Sn(a)}):a.state==="Published"&&m.push({label:"Mover a Borrador",action:"draft"}),(a.state==="Completed"||a.state==="Published")&&m.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),a.requires_signature&&(a.state==="PendingSignatures"||a.state==="FullySigned")&&(m.push({label:"Ver Firmas",action:"viewSignatures"}),$t(a,i)&&m.push({label:"Firmar documento",action:"sign"})),m}},signatures:{getMenuOptions:(a,$,i)=>{const m=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}],D=a.relationships_count&&a.relationships_count>0;return m.push({label:"Administrar Asociaciones",action:"relationships",disabled:!D}),a.requires_signature&&["PendingSignatures","FullySigned","Rejected","Expired"].includes(a.state)&&m.push({label:"Estado de las firmas",action:"viewSignatures"}),$t(a,i)&&m.push({label:"Firmar documento",action:"sign"}),a.state==="PendingSignatures"&&$t(a,i)&&m.push({label:"Rechazar documento",action:"reject"}),a.state==="FullySigned"&&m.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),a.state==="PendingSignatures"&&m.push({label:"Descargar PDF",action:"downloadPDF"}),a.state==="Rejected"&&Array.isArray(a.signatures)&&a.signatures.some(f=>f.rejection_comment)&&m.push({label:"Ver motivo del rechazo",action:"viewRejectionReason"}),m}},client:{getMenuOptions:(a,$,i)=>{var y,C,W,U;const m=[],D=((y=i==null?void 0:i.currentUser)==null?void 0:y.role)==="basic",_=((C=i==null?void 0:i.currentUser)==null?void 0:C.role)==="corporate_client"||((W=i==null?void 0:i.currentUser)==null?void 0:W.role)==="client",f=((U=i==null?void 0:i.currentUser)==null?void 0:U.role)==="lawyer",k=a.state==="Progress";if(a.state==="Completed"?(m.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Editar Formulario",action:"editForm"}]}),(_||D||f)&&m.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:D})):a.state==="Progress"?(m.push({label:"Completar",action:"editForm"}),(_||D||f)&&m.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:!0})):m.push({label:"Completar",action:"editForm"}),(a.state==="Completed"||a.state==="Progress")&&m.push({label:"Previsualizar",action:"preview"}),m.push({label:"Eliminar",action:"delete"}),D?m.push({label:"Gestionar Membrete",action:"letterhead",disabled:!0}):m.push({label:"Gestionar Membrete",action:"letterhead"}),m.push({label:"Administrar Asociaciones",action:"relationships",disabled:D||k}),a.requires_signature){const oe=["PendingSignatures","FullySigned","Rejected","Expired"].includes(a.state);$!=="my-documents"&&oe&&(m.push({label:"Ver Firmas",action:"viewSignatures"}),$t(a,i)&&m.push({label:"Firmar documento",action:"sign"}))}if(a.state==="Completed"||a.state==="Progress"){const z=a.state==="Completed";m.push({label:"Descargar PDF",action:"downloadPDF",disabled:!z},{label:"Descargar Word",action:"downloadWord",disabled:D||!z},{label:"Enviar",action:"email",disabled:D||!z})}return m}}};function En(a,$,i="list",m=null){const D=Fn[a];return D?D.getMenuOptions($,i,m):[]}function ps(){const a=Ke(),$=B(()=>{var _;return((_=a.currentUser)==null?void 0:_.role)==="basic"}),i=_=>{$e("Esta funcionalidad está restringida para usuarios básicos. Por favor, contacta a tu abogado para obtener acceso completo.","warning")};return{isBasicUser:$,showRestrictionNotification:i,handleFeatureAccess:(_,f)=>$.value?(i(),!1):(f&&f(),!0),getRestrictedButtonClasses:_=>_?"opacity-60 cursor-not-allowed":""}}const Tn={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},An={class:"px-6 py-4 border-b border-gray-200"},jn=e("h2",{class:"text-xl font-semibold text-gray-800"},"Acciones del Documento",-1),Mn={class:"text-sm text-gray-500 mt-1"},Pn={class:"p-6 overflow-y-auto flex-grow"},Ln={class:"space-y-4"},Bn={key:0,class:"text-sm font-semibold text-gray-700 uppercase tracking-wide px-2"},Rn={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},zn=["onClick","disabled"],In={class:"text-sm font-medium"},Un={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Nn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),On={key:1,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},qn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Vn={key:2,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Qn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Wn={key:3,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Hn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Gn={key:4,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Zn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Kn={key:1,class:"border-t border-gray-200 my-4"},Yn={key:0,class:"text-center py-12"},Jn=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay acciones disponibles",-1),Xn=e("p",{class:"mt-1 text-sm text-gray-500"}," No hay opciones disponibles para este documento. ",-1),Lt={__name:"DocumentActionsModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null},cardType:{type:String,required:!0,validator:a=>["lawyer","client","signatures"].includes(a)},context:{type:String,default:"table"},userStore:{type:Object,default:null}},emits:["close","action"],setup(a,{emit:$}){const i=a,m=$,D=B(()=>i.document?En(i.cardType,i.document,i.context,i.userStore):[]),_=B(()=>{const S=D.value;if(!S||S.length===0)return[];const d=[],F={edit:"Edición",view:"Visualización",share:"Compartir",manage:"Gestión",signatures:"Firmas",delete:"Eliminación"},T={edit:[],view:[],share:[],manage:[],signatures:[],delete:[]};return S.forEach(X=>{if(X.children&&Array.isArray(X.children))X.children.forEach(v=>{const A=v.action.toLowerCase();f(v,A,T)});else{const v=X.action.toLowerCase();f(X,v,T)}}),T.edit.length>0&&d.push({title:F.edit,options:T.edit}),T.view.length>0&&d.push({title:F.view,options:T.view}),T.share.length>0&&d.push({title:F.share,options:T.share}),T.signatures.length>0&&d.push({title:F.signatures,options:T.signatures}),T.manage.length>0&&d.push({title:F.manage,options:T.manage}),T.delete.length>0&&d.push({title:F.delete,options:T.delete}),d}),f=(S,d,F)=>{d.includes("edit")||d.includes("editar")||d==="copy"||d==="draft"||d==="publish"||d==="completar"?F.edit.push(S):d.includes("signature")||d.includes("firma")||d.includes("sign")||d==="reject"?F.signatures.push(S):d.includes("view")||d.includes("preview")||d.includes("ver")||d.includes("previsualización")?F.view.push(S):d.includes("download")||d.includes("email")||d.includes("enviar")||d.includes("descargar")?F.share.push(S):d.includes("permission")||d.includes("relationship")||d.includes("letterhead")||d.includes("permiso")||d.includes("asociación")||d.includes("membrete")||d==="formalize"?F.manage.push(S):d.includes("delete")||d.includes("eliminar")?F.delete.push(S):F.manage.push(S)},k=S=>{const d=S.toLowerCase();return d==="sign"||d.includes("firmar")?Ct:d==="editform"||d.includes("completar")?ss:d==="editdocument"||d.includes("editar documento")?Xt:d.includes("edit")||d==="editar"?Xt:d.includes("delete")||d==="eliminar"?Ot:d.includes("preview")||d.includes("ver")||d.includes("previsualización")?ds:d==="copy"||d.includes("copia")?Ss:d.includes("download")||d.includes("descargar")?ot:d.includes("email")||d.includes("enviar")?ws:d.includes("permission")||d.includes("permiso")?Ms:d.includes("relationship")||d.includes("asociación")?cs:d.includes("letterhead")||d.includes("membrete")?us:d==="reject"||d.includes("rechazar")?Is:d.includes("signature")||d.includes("firma")?Ct:d==="publish"||d.includes("publicar")?zs:d==="draft"||d.includes("borrador")?Oe:d==="formalize"||d.includes("formalizar")?ss:at},y=S=>{const d=S.toLowerCase();return d.includes("delete")||d==="eliminar"||d==="reject"||d.includes("rechazar")?"text-red-600":d==="sign"||d.includes("firmar")?"text-green-600":d.includes("download")||d.includes("descargar")?"text-blue-600":d.includes("email")||d.includes("enviar")?"text-green-600":d.includes("signature")||d.includes("firma")?"text-purple-600":"text-gray-600"},C=S=>{const d=S.toLowerCase();return d.includes("delete")||d==="eliminar"||d==="reject"||d.includes("rechazar")?"border-red-200 bg-red-50 text-red-700 hover:bg-red-100 hover:border-red-300":d==="sign"||d.includes("firmar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":d.includes("download")||d.includes("descargar")?"border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 hover:border-blue-300":d.includes("email")||d.includes("enviar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":d.includes("signature")||d.includes("firma")?"border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-100 hover:border-purple-300":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-300"},{isBasicUser:W,handleFeatureAccess:U}=ps(),z=["formalize","letterhead","relationships","downloadWord","email"],oe=S=>{const d=S.toLowerCase();return z.some(F=>d===F.toLowerCase())},de=S=>{const d=D.value.find(T=>T.action===S?T:T.children?T.children.find(X=>X.action===S):null),F=d!=null&&d.children?d.children.find(T=>T.action===S):d;if(F!=null&&F.disabled){U("Esta funcionalidad",null);return}m("action",S,i.document)},te=()=>{m("close")};return(S,d)=>Ce((s(),le(Ze,null,{default:j(()=>{var F;return[e("div",Tn,[e("div",An,[jn,e("p",Mn,g(((F=a.document)==null?void 0:F.title)||"Cargando..."),1),e("button",{onClick:te,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500 transition-colors"},[r(t(Te),{class:"h-6 w-6"})])]),e("div",Pn,[e("div",Ln,[(s(!0),o(ge,null,fe(_.value,(T,X)=>(s(),o("div",{key:X,class:"space-y-2"},[T.title?(s(),o("h3",Bn,g(T.title),1)):h("",!0),e("div",Rn,[(s(!0),o(ge,null,fe(T.options,v=>{var A,ee,Q;return s(),o("div",{key:v.action,class:"relative group"},[e("button",{onClick:Y=>de(v.action),disabled:v.disabled,class:P(["flex items-center justify-start w-full px-4 py-3 rounded-lg border transition-all duration-200",v.disabled?"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed opacity-60":C(v.action),"hover:shadow-md hover:scale-[1.02]"])},[(s(),le(_s(k(v.action)),{class:P(["h-5 w-5 mr-3 flex-shrink-0",v.disabled?"text-gray-400":y(v.action)])},null,8,["class"])),e("span",In,g(v.label),1),v.disabled?(s(),le(t(Es),{key:0,class:"h-4 w-4 ml-auto text-gray-400"})):h("",!0)],10,zn),v.disabled&&v.action==="relationships"&&!t(W)&&((A=a.document)==null?void 0:A.state)==="Progress"?(s(),o("div",Un,[re(" Solo puedes administrar asociaciones cuando el documento está completado. "),Nn])):v.disabled&&v.action==="relationships"&&!t(W)?(s(),o("div",On,[re(" Este documento no tiene documentos asociados. "),qn])):v.disabled&&v.action==="formalize"&&((ee=a.document)==null?void 0:ee.state)!=="Completed"?(s(),o("div",Vn,[re(" Solo puedes formalizar y agregar firmas cuando el documento está completado. "),Qn])):v.disabled&&["downloadPDF","downloadWord","email"].includes(v.action)&&((Q=a.document)==null?void 0:Q.state)!=="Completed"?(s(),o("div",Wn,[re(" Solo puedes usar esta acción cuando el documento está completado. "),Hn])):v.disabled&&t(W)&&oe(v.action)?(s(),o("div",Gn,[re(" Actualiza tu suscripción para usar esta funcionalidad "),Zn])):h("",!0)])}),128))]),X<_.value.length-1?(s(),o("div",Kn)):h("",!0)]))),128)),_.value.length===0?(s(),o("div",Yn,[r(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),Jn,Xn])):h("",!0)])])])]}),_:1},512)),[[ht,a.isVisible]])}},el={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},tl={class:"mb-4"},sl={class:"relative w-full"},ol={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},al={class:"flex items-center gap-2 min-w-0"},rl={class:"truncate"},nl={class:"py-1"},ll=["onClick"],il={class:"flex items-center gap-2 min-w-0"},dl={class:"truncate"},cl={class:"p-2"},ul={class:"relative mb-2"},ml={class:"max-h-60 overflow-y-auto"},gl=["onClick"],pl={class:"truncate"},hl={class:"flex items-center gap-2 min-w-0"},fl={class:"truncate"},yl={class:"p-2"},vl={class:"relative mb-2"},bl={class:"max-h-60 overflow-y-auto"},xl=["onClick"],_l={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},wl={class:"flex flex-col gap-1"},$l=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),kl={class:"flex flex-col gap-1"},Cl=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),Dl={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Sl={class:"py-1"},Fl=["onClick"],El={class:"flex gap-2 w-full sm:w-auto"},Tl=e("span",null,"Limpiar filtros",-1),Al={key:0,class:"flex justify-center items-center py-12 bg-white rounded-lg shadow-sm border border-gray-200"},jl=e("div",{class:"text-center"},[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e("p",{class:"text-sm text-gray-500"},"Cargando documentos...")],-1),Ml=[jl],Pl={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},Ll={class:"overflow-x-auto"},Bl={class:"min-w-full divide-y divide-gray-200"},Rl={class:"bg-gray-50"},zl={key:0,scope:"col",class:"w-12 px-3 py-3"},Il=["checked"],Ul=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento ",-1),Nl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),Ol=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Contraparte ",-1),ql=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Objeto ",-1),Vl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Valor ",-1),Ql=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plazo ",-1),Wl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha Suscripción ",-1),Hl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha Inicio ",-1),Gl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha Terminación ",-1),Zl={key:1,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Kl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas ",-1),Yl={class:"bg-white divide-y divide-gray-200"},Jl=["onClick"],Xl={key:0,class:"px-3 py-4"},ei=["checked","onChange"],ti={class:"px-6 py-4"},si={class:"flex items-center gap-3"},oi={class:"min-w-0"},ai={class:"text-sm font-medium text-gray-900 hover:text-secondary truncate block max-w-xs text-left"},ri={class:"px-6 py-4 whitespace-nowrap"},ni={class:"px-6 py-4 whitespace-nowrap"},li={class:"text-sm text-gray-900"},ii={class:"px-6 py-4 whitespace-nowrap"},di={class:"text-sm text-gray-900 line-clamp-2 max-w-xs"},ci={class:"px-6 py-4 whitespace-nowrap"},ui={class:"text-sm text-gray-900"},mi={class:"px-6 py-4 whitespace-nowrap"},gi={class:"text-sm text-gray-900"},pi={class:"px-6 py-4 whitespace-nowrap text-xs text-gray-900"},hi={key:0},fi={key:1,class:"text-gray-400"},yi={class:"px-6 py-4 whitespace-nowrap text-xs text-gray-900"},vi={key:0},bi={key:1,class:"text-gray-400"},xi={class:"px-6 py-4 whitespace-nowrap text-xs text-gray-900"},_i={key:0},wi={key:1,class:"text-gray-400"},$i={key:1,class:"px-6 py-4 whitespace-nowrap"},ki=["onClick"],Ci={key:1,class:"text-sm text-gray-400"},Di={class:"px-6 py-4"},Si={class:"flex flex-wrap gap-1"},Fi=["onClick"],Ei={key:0,class:"bg-gray-50 px-4 py-3 border-t border-gray-200 sm:px-6"},Ti={class:"flex items-center justify-between"},Ai={class:"flex-1 flex justify-between sm:hidden"},ji=["disabled"],Mi=["disabled"],Pi={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},Li={class:"text-sm text-gray-700"},Bi={class:"font-medium"},Ri={class:"font-medium"},zi={class:"font-medium"},Ii={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},Ui=["disabled"],Ni=["onClick"],Oi=["disabled"],qi={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Vi=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos",-1),Qi={class:"mt-1 text-sm text-gray-500"},Wi={key:11,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4"},Hi={class:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] flex flex-col"},Gi={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},Zi={class:"flex items-center gap-2"},Ki=e("h2",{class:"text-sm font-semibold text-gray-900"},"Etiquetas del documento",-1),Yi={class:"px-4 py-3 border-b border-gray-100 text-xs text-gray-500"},Ji=e("span",{class:"font-medium text-gray-700"},"Documento:",-1),Xi={class:"ml-1"},ed={class:"px-4 py-3 overflow-y-auto"},td={key:0,class:"text-sm text-gray-500"},sd={key:1,class:"space-y-2 text-sm"},od={class:"flex items-center gap-2 min-w-0"},ad={key:0,class:"text-xs text-gray-500 truncate max-w-[8rem]"},Ut={__name:"DocumentListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null},cardType:{type:String,default:"lawyer",validator:a=>["lawyer","client"].includes(a)},showStateFilter:{type:Boolean,default:!0},showClientFilter:{type:Boolean,default:!1},showAssociationsColumn:{type:Boolean,default:!0},availableStates:{type:Array,default:()=>["Draft","Published","Progress","PendingSignatures","Completed","FullySigned","Rejected","Expired"]},context:{type:String,default:"legal-documents"},isLoading:{type:Boolean,default:!1}},emits:["refresh","open-electronic-signature","update:searchQuery"],setup(a,{emit:$}){const i=Ve(),m=Ke(),D=et(),_=a,f=$,{activeModals:k,openModal:y,closeModal:C}=At(i,m),W=B(()=>(k==null?void 0:k.value)||k||{}),U=B(()=>{const p=W.value;return(p==null?void 0:p.relationships)||{isOpen:!1,document:null}}),{handlePreviewDocument:z,deleteDocument:oe,downloadPDFDocument:de,downloadWordDocument:te,copyDocument:S,publishDocument:d,moveToDraft:F,formalizeDocument:T,signDocument:X,downloadSignedDocument:v}=jt(i,m,f),A=b(""),ee=b(""),Q=b(""),Y=b(null),J=b(null),H=b(null),K=b(""),L=b(""),M=b("recent"),ie=b([]),pe=b(!1),q=b(null),V=b(!1),N=b(null),G=b(1),xe=b(20),we=B(()=>_.cardType==="lawyer"&&_.context==="legal-documents");B(()=>!1);const _e=B(()=>{if(_.promptDocuments)return _.promptDocuments;const p=m.currentUser;return _.cardType==="lawyer"&&_.context==="legal-documents"?!(p!=null&&p.id)||typeof i.getDocumentsByLawyerId!="function"?[]:i.getDocumentsByLawyerId(p.id)||[]:_.cardType==="client"&&_.context==="my-documents"?!(p!=null&&p.id)||typeof i.progressAndCompletedDocumentsByClient!="function"?[]:i.progressAndCompletedDocumentsByClient(p.id)||[]:i.documents||[]}),Ae=B(()=>{const p=new Map;return _e.value.forEach(u=>{var Z;(Z=u.tags)==null||Z.forEach(x=>{p.has(x.id)||p.set(x.id,x)})}),Array.from(p.values())}),Ie=B(()=>{if(!ee.value)return Ae.value;const p=ee.value.toLowerCase();return Ae.value.filter(u=>u.name.toLowerCase().includes(p))}),Ne=B(()=>{if(!J.value)return null;const p=Ae.value.find(u=>u.id===J.value);return(p==null?void 0:p.name)||null}),se=B(()=>{if(_.cardType!=="lawyer")return[];const p=new Map;return _e.value.forEach(u=>{u.client&&p.set(u.client.id,u.client)}),Array.from(p.values())}),ce=B(()=>{if(!Q.value)return se.value;const p=Q.value.toLowerCase();return se.value.filter(u=>`${u.first_name} ${u.last_name}`.toLowerCase().includes(p))}),me=B(()=>{if(!H.value)return null;const p=se.value.find(u=>u.id===H.value);return p?`${p.first_name} ${p.last_name}`:null}),De=B(()=>!_.selectedTags||!_.selectedTags.length?[]:_.selectedTags.map(p=>typeof p=="object"?p.id:p)),Ee=B(()=>{let p=_e.value;const u=(A.value||"").toLowerCase();return u&&(p=p.filter(Z=>{var x,be;return((x=Z.title)==null?void 0:x.toLowerCase().includes(u))||((be=Z.code)==null?void 0:be.toLowerCase().includes(u))})),Y.value&&(p=p.filter(Z=>Z.state===Y.value)),(K.value||L.value)&&(p=p.filter(Z=>{const x=Z.summary_subscription_date||Z.created_at||Z.updated_at;if(!x)return!1;const be=new Date(x);if(isNaN(be.getTime()))return!1;if(K.value){const Me=new Date(K.value);if(be<Me)return!1}if(L.value){const Me=new Date(L.value);if(Me.setHours(23,59,59,999),be>Me)return!1}return!0})),J.value&&(p=p.filter(Z=>{var x;return(x=Z.tags)==null?void 0:x.some(be=>be.id===J.value)})),De.value.length>0&&(p=p.filter(Z=>{var x;return(x=Z.tags)==null?void 0:x.some(be=>De.value.includes(be.id))})),H.value&&_.cardType==="lawyer"&&(p=p.filter(Z=>{var x;return((x=Z.client)==null?void 0:x.id)===H.value})),p}),je=()=>{Y.value=null,J.value=null,H.value=null,K.value="",L.value=""},c=B(()=>{if(_.cardType!=="lawyer"||_.context!=="legal-documents")return!1;const p=Ee.value;return p.length?p.every(u=>u.state==="Draft"||u.state==="Published"):!1}),n=B(()=>{const p=[...Ee.value];switch(M.value){case"recent":return p.sort((u,Z)=>new Date(Z.updated_at)-new Date(u.updated_at));case"oldest":return p.sort((u,Z)=>new Date(u.updated_at)-new Date(Z.updated_at));case"name-asc":return p.sort((u,Z)=>(u.title||"").localeCompare(Z.title||""));case"name-desc":return p.sort((u,Z)=>(Z.title||"").localeCompare(u.title||""));default:return p}}),l=B(()=>{const p=(G.value-1)*xe.value,u=p+xe.value;return n.value.slice(p,u)}),R=B(()=>Math.ceil(n.value.length/xe.value)),O=B(()=>{const p=R.value,u=G.value,Z=[];if(p<=7)for(let x=1;x<=p;x++)Z.push(x);else if(u<=4){for(let x=1;x<=5;x++)Z.push(x);Z.push("..."),Z.push(p)}else if(u>=p-3){Z.push(1),Z.push("...");for(let x=p-4;x<=p;x++)Z.push(x)}else Z.push(1),Z.push("..."),Z.push(u-1),Z.push(u),Z.push(u+1),Z.push("..."),Z.push(p);return Z}),ne=B(()=>l.value.length>0&&l.value.every(p=>ie.value.includes(p.id))),Ue=[{value:"recent",label:"Más recientes"},{value:"oldest",label:"Más antiguos"},{value:"name-asc",label:"Nombre (A-Z)"},{value:"name-desc",label:"Nombre (Z-A)"}],Se=p=>{var u;return((u=Ue.find(Z=>Z.value===p))==null?void 0:u.label)||"Ordenar"},ze=p=>({Draft:"Borrador",Published:"Publicado",Progress:"En Progreso",PendingSignatures:"Pendiente de Firmas",Completed:"Completado",FullySigned:"Firmado",Rejected:"Rechazado",Expired:"Expirado"})[p]||p,Ye=p=>ze(p.state),rt=p=>({Draft:"bg-gray-100 text-gray-800",Published:"bg-blue-100 text-blue-800",Progress:"bg-yellow-100 text-yellow-800",PendingSignatures:"bg-orange-100 text-orange-800",Completed:"bg-green-100 text-green-800",FullySigned:"bg-purple-100 text-purple-800",Rejected:"bg-red-100 text-red-800",Expired:"bg-gray-100 text-gray-800"})[p.state]||"bg-gray-100 text-gray-800",vt=p=>({Draft:"text-gray-500",Published:"text-blue-600",Progress:"text-yellow-600",PendingSignatures:"text-orange-600",Completed:"text-green-600",FullySigned:"text-purple-600",Rejected:"text-red-600",Expired:"text-gray-500"})[p.state]||"text-gray-400",dt=p=>{if(p&&p.color)return{red:"bg-red-100 text-red-800",blue:"bg-blue-100 text-blue-800",green:"bg-green-100 text-green-800",yellow:"bg-yellow-100 text-yellow-800",purple:"bg-purple-100 text-purple-800",pink:"bg-pink-100 text-pink-800",indigo:"bg-indigo-100 text-indigo-800"}[p.color]||"bg-gray-100 text-gray-800";const u=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],Z=p&&typeof p.id=="number"?p.id%u.length:0;return u[Z]},ct=p=>p?new Date(p).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"-",Bt=p=>p.summary_counterparty||"",ut=p=>{if(!p.summary_value)return"";const u=p.summary_value_currency||"";return u?`${u} ${p.summary_value}`:p.summary_value},Rt=p=>["Completed","FullySigned"].includes(p.state),bt=p=>String(i.lastUpdatedDocumentId)===String(p),xt=p=>{const u=ie.value.indexOf(p);u>-1?ie.value.splice(u,1):ie.value.push(p)},zt=p=>{N.value=p,V.value=!0},_t=()=>{V.value=!1,N.value=null},I=()=>{if(ne.value)ie.value=ie.value.filter(p=>!l.value.some(u=>u.id===p));else{const p=l.value.map(u=>u.id).filter(u=>!ie.value.includes(u));ie.value.push(...p)}},E=p=>{q.value=p,pe.value=!0},ae=()=>{const p=ie.value.length>0?n.value.filter(Xe=>ie.value.includes(Xe.id)):n.value,u=["Nombre Minuta","Estado","Etiquetas"],Z=p.map(Xe=>[Xe.title||"",Ye(Xe),Xe.tags?Xe.tags.map(It=>It.name).join(", "):""]),x=[u.join(","),...Z.map(Xe=>Xe.map(It=>`"${It}"`).join(","))].join(`
`),be=new Blob([x],{type:"text/csv;charset=utf-8;"}),Me=document.createElement("a"),Je=URL.createObjectURL(be);Me.setAttribute("href",Je),Me.setAttribute("download",`documentos_${new Date().toISOString().split("T")[0]}.csv`),Me.style.visibility="hidden",document.body.appendChild(Me),Me.click(),document.body.removeChild(Me)},w=async(p,u)=>{var Z,x;switch(p){case"preview":await z(u);break;case"edit":{const be=((Z=m.currentUser)==null?void 0:Z.role)||"client";_.cardType==="lawyer"&&_.context==="legal-documents"?y("edit",u,{userRole:be,renameOnly:!0}):y("edit",u,{userRole:be})}break;case"editForm":if(_.cardType==="lawyer"&&_.context==="legal-documents")try{const be=await i.fetchDocumentById(u.id,!0);i.selectedDocument=be,D.push("/dynamic_document_dashboard/lawyer/variables-config")}catch(be){console.error("Error al abrir la configuración de variables:",be)}else y("edit",u,{userRole:"client"});break;case"editDocument":(((x=m.currentUser)==null?void 0:x.role)||"client")==="lawyer"&&_.cardType==="lawyer"?D.push(`/dynamic_document_dashboard/lawyer/editor/edit/${u.id}`):D.push(`/dynamic_document_dashboard/client/editor/edit/${u.id}`);break;case"permissions":y("permissions",u);break;case"relationships":y("relationships",u);break;case"letterhead":y("letterhead",u);break;case"viewSignatures":case"signatures":y("signatures",u);break;case"publish":await d(u);break;case"draft":case"move-to-draft":await F(u);break;case"formalize":await T(u);break;case"sign":await X(u);break;case"delete":await oe(u);break;case"downloadPDF":case"download-pdf":await de(u);break;case"downloadWord":case"download-word":await te(u);break;case"downloadSignedDocument":case"download-signed":await v(u);break;case"email":case"send":y("email",u);break;case"copy":await S(u);break;default:console.warn("Unknown action:",p)}},ue=async(p,u)=>{pe.value=!1,await w(p,u)},ye=({documentId:p,count:u})=>{const Z=i.documents.find(x=>x.id===p);Z&&(Z.relationships_count=u)};return ke(()=>n.value.length,()=>{G.value>R.value&&(G.value=Math.max(1,R.value))}),ke(A,p=>{f("update:searchQuery",p??"")}),ke(()=>_.searchQuery,p=>{p!=null&&(A.value=p)},{immediate:!0}),We(async()=>{_.promptDocuments||await i.init(),await m.init()}),(p,u)=>{var Z;return s(),o("div",null,[e("div",el,[e("div",tl,[e("div",sl,[r(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Ce(e("input",{"onUpdate:modelValue":u[0]||(u[0]=x=>A.value=x),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Fe,A.value]])])]),e("div",ol,[a.showStateFilter?(s(),le(t(Le),{key:0,as:"div",class:"relative"},{default:j(()=>[r(t(Be),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[e("div",al,[r(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",rl,g(Y.value||"Estado"),1)]),r(t(qe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-full min-w-[14rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",nl,[r(t(ve),null,{default:j(({active:x})=>[e("a",{onClick:u[1]||(u[1]=be=>Y.value=null),class:P([x?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,fe(a.availableStates,x=>(s(),le(t(ve),{key:x},{default:j(({active:be})=>[e("a",{onClick:Me=>Y.value=x,class:P([be?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},g(ze(x)),11,ll)]),_:2},1024))),128))])]),_:1})]),_:1})):h("",!0),r(t(Le),{as:"div",class:"relative"},{default:j(()=>[r(t(Be),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[e("div",il,[r(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",dl,g(Ne.value||"Etiqueta"),1)]),r(t(qe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",cl,[e("div",ul,[r(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Ce(e("input",{"onUpdate:modelValue":u[2]||(u[2]=x=>ee.value=x),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:u[3]||(u[3]=he(()=>{},["stop"]))},null,512),[[Fe,ee.value]])]),e("div",ml,[r(t(ve),null,{default:j(({active:x})=>[e("a",{onClick:u[4]||(u[4]=be=>J.value=null),class:P([x?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,fe(Ie.value,x=>(s(),le(t(ve),{key:x.id},{default:j(({active:be})=>[e("a",{onClick:Me=>J.value=x.id,class:P([be?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:P(["w-3 h-3 rounded-full flex-shrink-0",dt(x)])},null,2),e("span",pl,g(x.name),1)],10,gl)]),_:2},1024))),128))])])]),_:1})]),_:1}),a.showClientFilter?(s(),le(t(Le),{key:1,as:"div",class:"relative"},{default:j(()=>[r(t(Be),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[e("div",hl,[r(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",fl,g(me.value||"Cliente"),1)]),r(t(qe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",yl,[e("div",vl,[r(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Ce(e("input",{"onUpdate:modelValue":u[5]||(u[5]=x=>Q.value=x),type:"text",placeholder:"Buscar clientes...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:u[6]||(u[6]=he(()=>{},["stop"]))},null,512),[[Fe,Q.value]])]),e("div",bl,[r(t(ve),null,{default:j(({active:x})=>[e("a",{onClick:u[7]||(u[7]=be=>H.value=null),class:P([x?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,fe(ce.value,x=>(s(),le(t(ve),{key:x.id},{default:j(({active:be})=>[e("a",{onClick:Me=>H.value=x.id,class:P([be?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])},g(x.first_name)+" "+g(x.last_name),11,xl)]),_:2},1024))),128))])])]),_:1})]),_:1})):h("",!0)]),e("div",_l,[e("div",wl,[$l,Ce(e("input",{"onUpdate:modelValue":u[8]||(u[8]=x=>K.value=x),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Fe,K.value]])]),e("div",kl,[Cl,Ce(e("input",{"onUpdate:modelValue":u[9]||(u[9]=x=>L.value=x),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Fe,L.value]])])]),e("div",Dl,[r(t(Le),{as:"div",class:"relative w-full sm:w-auto"},{default:j(()=>[r(t(Be),{class:"w-full sm:w-auto inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[r(t(Ps),{class:"h-4 w-4"}),e("span",null,g(Se(M.value)),1),r(t(qe),{class:"h-4 w-4"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-56 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",Sl,[(s(),o(ge,null,fe(Ue,x=>r(t(ve),{key:x.value},{default:j(({active:be})=>[e("a",{onClick:Me=>M.value=x.value,class:P([be?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},g(x.label),11,Fl)]),_:2},1024)),64))])]),_:1})]),_:1}),e("div",El,[ie.value.length>0?(s(),o("button",{key:0,onClick:ae,class:"flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[r(t(ot),{class:"h-4 w-4"}),e("span",null,"Exportar ("+g(ie.value.length)+")",1)])):h("",!0),Y.value||J.value||H.value||K.value||L.value?(s(),o("button",{key:1,onClick:je,class:"flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-200 rounded-md bg-white text-xs font-medium text-gray-500 hover:bg-gray-50",title:"Limpiar filtros",type:"button"},[r(t(Te),{class:"h-4 w-4 flex-shrink-0"}),Tl])):h("",!0)])])]),a.isLoading?(s(),o("div",Al,Ml)):!a.isLoading&&l.value.length>0?(s(),o("div",Pl,[e("div",Ll,[e("table",Bl,[e("thead",Rl,[e("tr",null,[we.value?(s(),o("th",zl,[e("input",{type:"checkbox",checked:ne.value,onChange:I,class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded cursor-pointer"},null,40,Il)])):h("",!0),Ul,Nl,Ol,ql,Vl,Ql,Wl,Hl,Gl,a.showAssociationsColumn&&!c.value?(s(),o("th",Zl," Asociaciones ")):h("",!0),Kl])]),e("tbody",Yl,[(s(!0),o(ge,null,fe(l.value,x=>{var be,Me;return s(),o("tr",{key:x.id,class:P(["hover:bg-gray-50 cursor-pointer transition-colors duration-150",bt(x.id)?"bg-yellow-50":""]),onClick:Je=>E(x)},[we.value?(s(),o("td",Xl,[e("input",{type:"checkbox",checked:ie.value.includes(x.id),onChange:he(Je=>xt(x.id),["stop"]),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded cursor-pointer"},null,40,ei)])):h("",!0),e("td",ti,[e("div",si,[r(t(Oe),{class:P(["h-5 w-5 flex-shrink-0",vt(x)])},null,8,["class"]),e("div",oi,[e("span",ai,g(x.title||"Sin título"),1)])])]),e("td",ri,[e("span",{class:P([rt(x),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},g(Ye(x)),3)]),e("td",ni,[e("span",li,g(Bt(x)||"-"),1)]),e("td",ii,[e("span",di,g(x.summary_object||"-"),1)]),e("td",ci,[e("span",ui,g(ut(x)||"-"),1)]),e("td",mi,[e("span",gi,g(x.summary_term||"-"),1)]),e("td",pi,[x.summary_subscription_date?(s(),o("span",hi,g(ct(x.summary_subscription_date)),1)):(s(),o("span",fi,"-"))]),e("td",yi,[x.summary_start_date?(s(),o("span",vi,g(ct(x.summary_start_date)),1)):(s(),o("span",bi,"-"))]),e("td",xi,[x.summary_end_date?(s(),o("span",_i,g(ct(x.summary_end_date)),1)):(s(),o("span",wi,"-"))]),a.showAssociationsColumn&&!c.value?(s(),o("td",$i,[Rt(x)?(s(),o("button",{key:0,onClick:he(Je=>t(y)("relationships",x),["stop"]),class:"inline-flex items-center gap-1 text-sm text-secondary hover:text-blue-700"},[r(t(cs),{class:"h-4 w-4"}),e("span",null,g(x.relationships_count||0),1)],8,ki)):(s(),o("span",Ci,g(x.relationships_count||0),1))])):h("",!0),e("td",Di,[e("div",Si,[(s(!0),o(ge,null,fe((be=x.tags)==null?void 0:be.slice(0,2),Je=>(s(),o("span",{key:Je.id,class:P([dt(Je),"px-2 py-1 text-xs rounded-full"])},g(Je.name),3))),128)),((Me=x.tags)==null?void 0:Me.length)>2?(s(),o("button",{key:0,type:"button",class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 inline-flex items-center gap-1",onClick:he(Je=>zt(x),["stop"])},[e("span",null,"+"+g(x.tags.length-2),1)],8,Fi)):h("",!0)])])],10,Jl)}),128))])])]),R.value>1?(s(),o("div",Ei,[e("div",Ti,[e("div",Ai,[e("button",{onClick:u[10]||(u[10]=x=>G.value--),disabled:G.value===1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Anterior ",8,ji),e("button",{onClick:u[11]||(u[11]=x=>G.value++),disabled:G.value===R.value,class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Siguiente ",8,Mi)]),e("div",Pi,[e("div",null,[e("p",Li,[re(" Mostrando "),e("span",Bi,g((G.value-1)*xe.value+1),1),re(" a "),e("span",Ri,g(Math.min(G.value*xe.value,n.value.length)),1),re(" de "),e("span",zi,g(n.value.length),1),re(" resultados ")])]),e("div",null,[e("nav",Ii,[e("button",{onClick:u[12]||(u[12]=x=>G.value--),disabled:G.value===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[r(t(Ft),{class:"h-5 w-5"})],8,Ui),(s(!0),o(ge,null,fe(O.value,x=>(s(),o("button",{key:x,onClick:be=>typeof x=="number"?G.value=x:null,class:P([x===G.value?"z-10 bg-secondary border-secondary text-white":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50",typeof x=="string"?"cursor-default":"cursor-pointer","relative inline-flex items-center px-4 py-2 border text-sm font-medium"])},g(x),11,Ni))),128)),e("button",{onClick:u[13]||(u[13]=x=>G.value++),disabled:G.value===R.value,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[r(t(ft),{class:"h-5 w-5"})],8,Oi)])])])])])):h("",!0)])):!a.isLoading&&l.value.length===0?(s(),o("div",qi,[r(t(Oe),{class:"mx-auto h-12 w-12 text-gray-400"}),Vi,e("p",Qi,g(_.promptDocuments?"No se encontraron documentos":"Comienza creando un nuevo documento"),1)])):h("",!0),t(tt)?(s(),le(Qt,{key:3,"is-open":t(tt),document:t(Vt),onClose:u[14]||(u[14]=x=>tt.value=!1)},null,8,["is-open","document"])):h("",!0),t(k).edit.isOpen?(s(),le(t(Wt),{key:4,"is-open":t(k).edit.isOpen,document:t(k).edit.document,"user-role":t(k).edit.userRole||((Z=t(m).currentUser)==null?void 0:Z.role)||"client","show-editor-button":!t(k).edit.renameOnly,onClose:u[15]||(u[15]=x=>t(C)("edit")),onRefresh:u[16]||(u[16]=x=>f("refresh"))},null,8,["is-open","document","user-role","show-editor-button"])):h("",!0),W.value.email.isOpen?(s(),le(t(Ht),{key:5,"is-open":W.value.email.isOpen,document:W.value.email.document,onClose:u[17]||(u[17]=x=>t(C)("email")),onRefresh:u[18]||(u[18]=x=>f("refresh"))},null,8,["is-open","document"])):h("",!0),t(k).signatures.isOpen?(s(),le(t(is),{key:6,"is-open":t(k).signatures.isOpen,document:t(k).signatures.document,onClose:u[19]||(u[19]=x=>t(C)("signatures")),onRefresh:u[20]||(u[20]=x=>f("refresh"))},null,8,["is-open","document"])):h("",!0),t(k).permissions.isOpen?(s(),le(t(Ts),{key:7,"is-open":t(k).permissions.isOpen,document:t(k).permissions.document,onClose:u[21]||(u[21]=x=>t(C)("permissions")),onRefresh:u[22]||(u[22]=x=>f("refresh"))},null,8,["is-open","document"])):h("",!0),t(k).letterhead.isOpen?(s(),le(Mt,{key:8,"is-visible":t(k).letterhead.isOpen,document:t(k).letterhead.document,onClose:u[23]||(u[23]=x=>t(C)("letterhead")),onRefresh:u[24]||(u[24]=x=>f("refresh"))},null,8,["is-visible","document"])):h("",!0),U.value.isOpen?(s(),le(Et,{key:9,"is-open":U.value.isOpen,document:U.value.document,onClose:u[25]||(u[25]=x=>t(C)("relationships")),onUpdateCount:ye},null,8,["is-open","document"])):h("",!0),pe.value?(s(),le(Lt,{key:10,"is-visible":pe.value,document:q.value,"card-type":a.cardType,context:_.context||"list","user-store":t(m),onClose:u[26]||(u[26]=x=>pe.value=!1),onRefresh:u[27]||(u[27]=x=>f("refresh")),onAction:ue},null,8,["is-visible","document","card-type","context","user-store"])):h("",!0),V.value&&N.value?(s(),o("div",Wi,[e("div",Hi,[e("div",Gi,[e("div",Zi,[r(t(Nt),{class:"h-5 w-5 text-gray-500"}),Ki]),e("button",{type:"button",class:"text-gray-400 hover:text-gray-600 p-1 rounded-md hover:bg-gray-100",onClick:_t},[r(t(Te),{class:"h-5 w-5"})])]),e("div",Yi,[Ji,e("span",Xi,g(N.value.title||"Sin título"),1)]),e("div",ed,[!N.value.tags||N.value.tags.length===0?(s(),o("div",td," Este documento no tiene etiquetas. ")):(s(),o("ul",sd,[(s(!0),o(ge,null,fe(N.value.tags,x=>(s(),o("li",{key:x.id,class:"flex items-center justify-between gap-2"},[e("div",od,[e("span",{class:P(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",dt(x)])},g(x.name),3)]),x.description?(s(),o("span",ad,g(x.description),1)):h("",!0)]))),128))]))]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end"},[e("button",{type:"button",class:"px-4 py-2 text-sm font-medium rounded-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-50",onClick:_t}," Cerrar ")])])])):h("",!0)])}}},rd={class:"mb-4"},nd={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},ld={class:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"},id={class:"flex flex-col sm:flex-row gap-3 flex-1 w-full lg:w-auto"},dd={class:"relative flex-1 min-w-[200px]"},cd={class:"max-w-[120px] truncate"},ud={class:"p-2"},md={class:"relative mb-2"},gd={class:"max-h-60 overflow-y-auto"},pd=["onClick"],hd={class:"truncate"},fd={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},yd={class:"flex items-center gap-3 w-full lg:w-auto"},vd={class:"text-sm text-gray-500 whitespace-nowrap"},bd={class:"py-1"},xd={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},_d={class:"min-w-full divide-y divide-gray-200"},wd=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plantilla "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),$d={class:"bg-white divide-y divide-gray-200"},kd=["onClick"],Cd={class:"px-6 py-4 whitespace-nowrap"},Dd={class:"flex items-center"},Sd={class:"flex-shrink-0 h-10 w-10"},Fd={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},Ed={class:"ml-4"},Td={class:"text-sm font-medium text-gray-900"},Ad=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-700 border border-purple-200"}," Disponible ")],-1),jd={class:"px-6 py-4 whitespace-nowrap"},Md={class:"flex flex-wrap gap-1"},Pd={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},Ld={key:1,class:"text-sm text-gray-400"},Bd={class:"py-1"},Rd=["onClick"],zd={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Id=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay plantillas disponibles",-1),Ud={class:"mt-1 text-sm text-gray-500"},Nd=e("div",{class:"mt-4"},[e("div",{class:"text-xs text-gray-400 bg-gray-100 px-3 py-2 rounded-lg inline-block"},[re(" 💡 "),e("strong",null,"Tip:"),re(" Las plantillas son creadas por los abogados ")])],-1),as={__name:"UseDocumentTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["go-back"],setup(a,{emit:$}){const i=Ve();Ke();const m=et(),D=$,_=b(""),f=b(""),k=b(null),y=b("recent"),C=b(!1),W=b(null),U=b({}),z=b({}),oe=b(!1),de=b(-1),te=B(()=>i.publishedDocumentsUnassigned||[]),S=B(()=>{let q=[...te.value];const V=_.value.toLowerCase();return V&&(q=q.filter(N=>{var G,xe;return((G=N.title)==null?void 0:G.toLowerCase().includes(V))||((xe=N.tags)==null?void 0:xe.some(we=>{var _e;return(_e=we.name)==null?void 0:_e.toLowerCase().includes(V)}))})),k.value&&(q=q.filter(N=>N.tags&&N.tags.some(G=>G.id===k.value))),y.value==="name"?q.sort((N,G)=>{const xe=(N.title||"").toLowerCase(),we=(G.title||"").toLowerCase();return xe.localeCompare(we)}):y.value==="recent"&&q.sort((N,G)=>G.id-N.id),q}),d=B(()=>{const q=new Map;return te.value.forEach(V=>{V.tags&&V.tags.length>0&&V.tags.forEach(N=>{q.has(N.id)||q.set(N.id,N)})}),Array.from(q.values()).sort((V,N)=>V.name.localeCompare(N.name))}),F=B(()=>{if(!f.value)return d.value;const q=f.value.toLowerCase();return d.value.filter(V=>V.name.toLowerCase().includes(q))}),T=B(()=>{if(!k.value)return null;const q=d.value.find(V=>V.id===k.value);return q?q.name:null}),X=B(()=>{switch(y.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),v=B(()=>{const q=_.value&&_.value.trim().length>0,V=k.value!==null;return q&&V?"No se encontraron plantillas que coincidan con tu búsqueda y filtros":q?"No se encontraron plantillas que coincidan con tu búsqueda":V?"No se encontraron plantillas con la etiqueta seleccionada":"Aún no hay plantillas disponibles para usar"}),A=q=>{const V=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],N=q.id%V.length;return V[N]},ee=q=>{const V=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],N=q.id%V.length;return V[N]},Q=()=>{k.value=null},Y=q=>{q&&(i.selectedDocument=null,W.value=q,C.value=!0)},J=()=>{C.value=!1,W.value=null},H=q=>{if(q.state==="Published"&&!q.assigned_to)Y(q.id);else{const N=`/dynamic_document_dashboard/document/use/editor/${q.id}/${encodeURIComponent(q.title.trim())}`;m.push(N)}},K=()=>{D("go-back")};We(async()=>{(!i.documents||i.documents.length===0)&&await i.init(!0)});const L=()=>oe.value?S.value.length===1?"280px":S.value.length===2&&de.value===1?"340px":"280px":"auto",M=(q,V)=>{q&&(U.value[V]=q)},ie=(q,V)=>{q&&(z.value[V]=q)},pe=(q,V)=>{oe.value=!V,de.value=V?-1:q,V||setTimeout(()=>{const N=z.value[q];if(N){const G=N.$el||N;if(G&&G.getBoundingClientRect){const xe=G.getBoundingClientRect(),we=window.innerHeight;if(q===0){if(xe.bottom>we-20){const _e=xe.bottom-we+40;window.scrollBy({top:_e,behavior:"smooth"})}}else if(xe.bottom>we-10){const _e=xe.bottom-we+30;window.scrollBy({top:_e,behavior:"smooth"})}else if(xe.top<80){const _e=xe.top-100;window.scrollBy({top:_e,behavior:"smooth"})}}}},100)};return(q,V)=>(s(),o("div",null,[e("div",rd,[e("button",{onClick:K,class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors border border-gray-300"},[r(t(Ls),{class:"h-4 w-4"}),re(" Volver a Mis Documentos ")])]),e("div",nd,[e("div",ld,[e("div",id,[e("div",dd,[r(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Ce(e("input",{"onUpdate:modelValue":V[0]||(V[0]=N=>_.value=N),type:"text",placeholder:"Buscar plantillas...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent"},null,512),[[Fe,_.value]])]),r(t(Le),{as:"div",class:"relative"},{default:j(()=>[r(t(Be),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[r(t(st),{class:"h-4 w-4"}),e("span",cd,g(T.value||"Etiqueta"),1),r(t(qe),{class:"h-4 w-4"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",ud,[e("div",md,[r(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Ce(e("input",{"onUpdate:modelValue":V[1]||(V[1]=N=>f.value=N),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:V[2]||(V[2]=he(()=>{},["stop"]))},null,512),[[Fe,f.value]])]),e("div",gd,[r(t(ve),null,{default:j(({active:N})=>[e("a",{onClick:V[3]||(V[3]=G=>k.value=null),class:P([N?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,fe(F.value,N=>(s(),le(t(ve),{key:N.id},{default:j(({active:G})=>[e("a",{onClick:xe=>k.value=N.id,class:P([G?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:P(["w-3 h-3 rounded-full flex-shrink-0",ee(N)])},null,2),e("span",hd,g(N.name),1)],10,pd)]),_:2},1024))),128)),F.value.length===0?(s(),o("div",fd," No se encontraron etiquetas ")):h("",!0)])])]),_:1})]),_:1}),k.value?(s(),o("button",{key:0,onClick:Q,class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[r(t(Te),{class:"h-4 w-4"}),re(" Limpiar ")])):h("",!0)]),e("div",yd,[e("span",vd," Mostrando "+g(S.value.length)+" plantillas ",1),r(t(Le),{as:"div",class:"relative"},{default:j(()=>[r(t(Be),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[re(" Ordenar: "+g(X.value)+" ",1),r(t(qe),{class:"h-4 w-4"})]),_:1}),r(t(Re),{class:"absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",bd,[r(t(ve),null,{default:j(({active:N})=>[e("a",{onClick:V[4]||(V[4]=G=>y.value="recent"),class:P([N?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),r(t(ve),null,{default:j(({active:N})=>[e("a",{onClick:V[5]||(V[5]=G=>y.value="name"),class:P([N?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),S.value.length>0?(s(),o("div",xd,[e("div",{class:"overflow-x-auto",style:Qe({minHeight:L()})},[e("table",_d,[wd,e("tbody",$d,[(s(!0),o(ge,null,fe(S.value,(N,G)=>{var xe;return s(),o("tr",{key:N.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:we=>H(N)},[e("td",Cd,[e("div",Dd,[e("div",Sd,[e("div",Fd,[r(t(Oe),{class:"h-5 w-5 text-purple-600"})])]),e("div",Ed,[e("div",Td,g(N.title),1)])])]),Ad,e("td",jd,[e("div",Md,[(s(!0),o(ge,null,fe((xe=N.tags)==null?void 0:xe.slice(0,2),we=>(s(),o("span",{key:we.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",A(we)])},g(we.name),3))),128)),N.tags&&N.tags.length>2?(s(),o("span",Pd," +"+g(N.tags.length-2),1)):h("",!0),!N.tags||N.tags.length===0?(s(),o("span",Ld,"-")):h("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:V[6]||(V[6]=he(()=>{},["stop"]))},[r(t(Le),{as:"div",class:"relative inline-block text-left"},{default:j(({open:we})=>[r(t(Be),{ref_for:!0,ref:_e=>M(_e,G),onClick:_e=>pe(G,we),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:j(()=>[r(t(lt),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),r(t(Re),{ref_for:!0,ref:_e=>ie(_e,G),class:P([S.value.length>2&&G>0&&G>=S.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:j(()=>[e("div",Bd,[r(t(ve),null,{default:j(({active:_e})=>[e("a",{onClick:Ae=>H(N),class:P([_e?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Usar plantilla ",10,Rd)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,kd)}),128))])])],4)])):(s(),o("div",zd,[r(t(Pt),{class:"mx-auto h-12 w-12 text-gray-400"}),Id,e("p",Ud,g(v.value),1),Nd])),Ce(r(Ze,null,{default:j(()=>[W.value!==null?(s(),le(ms,{key:0,"document-id":W.value,onClose:J},null,8,["document-id"])):h("",!0)]),_:1},512),[[ht,C.value]])]))}},Od={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},qd={class:"mb-4"},Vd={class:"relative w-full"},Qd={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},Wd={class:"flex items-center gap-2 min-w-0"},Hd={class:"truncate"},Gd={class:"py-1"},Zd=["onClick"],Kd={class:"flex items-center justify-stretch"},Yd=e("span",null,"Limpiar",-1),Jd={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},Xd={class:"flex flex-col gap-1"},ec=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),tc={class:"flex flex-col gap-1"},sc=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),oc={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},ac={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},rc={class:"flex items-center gap-2"},nc=e("span",{class:"hidden sm:inline"},"Exportar",-1),lc={class:"py-1"},ic=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),dc={class:"py-1"},cc={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},uc={class:"overflow-x-auto",style:{"overflow-y":"visible"}},mc={class:"min-w-full divide-y divide-gray-200"},gc={class:"bg-gray-50"},pc={scope:"col",class:"w-12 px-6 py-3"},hc=["checked"],fc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),yc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),vc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),bc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Docs. Asociados ",-1),xc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),_c={class:"bg-white divide-y divide-gray-200"},wc=["onClick"],$c=["checked","onChange"],kc={class:"px-6 py-4 whitespace-nowrap"},Cc={class:"flex items-center"},Dc={class:"flex-shrink-0 h-10 w-10"},Sc={class:"h-10 w-10 rounded-lg bg-green-100 flex items-center justify-center"},Fc={class:"ml-4"},Ec={class:"text-sm font-medium text-gray-900"},Tc={class:"px-6 py-4 whitespace-nowrap"},Ac={class:"text-sm text-gray-900"},jc=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-700 border border-green-200"}," Completado ")],-1),Mc={class:"px-6 py-4 whitespace-nowrap"},Pc=["onClick"],Lc={class:"px-6 py-4 whitespace-nowrap"},Bc={class:"flex flex-wrap gap-1"},Rc={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},zc={key:1,class:"text-sm text-gray-400"},Ic={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Uc={class:"flex flex-1 justify-between sm:hidden"},Nc=["disabled"],Oc=["disabled"],qc={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Vc={class:"text-sm text-gray-700"},Qc={class:"font-medium"},Wc={class:"font-medium"},Hc={class:"font-medium"},Gc={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Zc=["disabled"],Kc=e("span",{class:"sr-only"},"Anterior",-1),Yc=["onClick"],Jc={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},Xc=["disabled"],eu=e("span",{class:"sr-only"},"Siguiente",-1),tu={key:0,class:"text-center py-12"},su=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos completados",-1),ou=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos completados por clientes aparecerán aquí.",-1),au={__name:"DocumentFinishedByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(a,{emit:$}){const i=Ve(),m=Ke(),D=et(),_=a,f=$,{activeModals:k,openModal:y,closeModal:C,getUserRole:W}=At(i,m),{handlePreviewDocument:U,deleteDocument:z,downloadPDFDocument:oe,downloadWordDocument:de}=jt(i,m,f),te=b(""),S=b(null),d=b(""),F=b(""),T=b("recent"),X=b([]),v=b(1),A=b(10);We(()=>{i.init(),m.init()});const ee=B(()=>{const c=i.completedDocumentsByClient,n=_.selectedTags?_.selectedTags.map(R=>R.id):[];return i.filteredDocumentsBySearchAndTags(_.searchQuery,m,n).filter(R=>c.some(O=>O.id===R.id))}),Q=B(()=>{let c=[...ee.value];const n=te.value.toLowerCase();return n&&(c=c.filter(l=>{var R,O;return((R=l.title)==null?void 0:R.toLowerCase().includes(n))||((O=l.tags)==null?void 0:O.some(ne=>{var Ue;return(Ue=ne.name)==null?void 0:Ue.toLowerCase().includes(n)}))})),S.value&&(c=c.filter(l=>l.tags&&l.tags.some(R=>R.id===S.value))),(d.value||F.value)&&(c=c.filter(l=>{const R=l.summary_subscription_date||l.created_at||l.updated_at;if(!R)return!1;const O=new Date(R);if(isNaN(O.getTime()))return!1;if(d.value){const ne=new Date(d.value);if(O<ne)return!1}if(F.value){const ne=new Date(F.value);if(ne.setHours(23,59,59,999),O>ne)return!1}return!0})),T.value==="name"?c.sort((l,R)=>{const O=(l.title||"").toLowerCase(),ne=(R.title||"").toLowerCase();return O.localeCompare(ne)}):T.value==="recent"&&c.sort((l,R)=>{const O=new Date(l.updated_at||l.created_at);return new Date(R.updated_at||R.created_at)-O}),c}),Y=B(()=>{const c=(v.value-1)*A.value,n=c+A.value;return Q.value.slice(c,n)}),J=B(()=>Math.ceil(Q.value.length/A.value)),H=B(()=>{const c=(v.value-1)*A.value+1,n=Math.min(v.value*A.value,Q.value.length);return{start:c,end:n,total:Q.value.length}});ke([te,S,d,F],()=>{v.value=1});const K=B(()=>{const c=new Map;return ee.value.forEach(n=>{n.tags&&n.tags.length>0&&n.tags.forEach(l=>{c.has(l.id)||c.set(l.id,l)})}),Array.from(c.values()).sort((n,l)=>n.name.localeCompare(l.name))}),L=B(()=>{if(!S.value)return null;const c=K.value.find(n=>n.id===S.value);return c?c.name:null}),M=B(()=>{switch(T.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),ie=c=>c.summary_counterparty?c.summary_counterparty:"Cliente",pe=c=>{const n=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],l=c.id%n.length;return n[l]},q=B(()=>Q.value.length>0&&X.value.length===Q.value.length),V=()=>{q.value?X.value=[]:X.value=Q.value.map(c=>c.id)},N=c=>{const n=X.value.indexOf(c);n>-1?X.value.splice(n,1):X.value.push(c)},G=()=>{X.value=Q.value.map(c=>c.id)},xe=()=>{X.value=[]},we=()=>{S.value=null,d.value="",F.value=""},_e=()=>{v.value>1&&v.value--},Ae=()=>{v.value<J.value&&v.value++},Ie=c=>{c>=1&&c<=J.value&&(v.value=c)},Ne=B(()=>{const c=J.value,n=v.value,l=[];if(c<=7)for(let R=1;R<=c;R++)l.push(R);else if(n<=4){for(let R=1;R<=5;R++)l.push(R);l.push("..."),l.push(c)}else if(n>=c-3){l.push(1),l.push("...");for(let R=c-4;R<=c;R++)l.push(R)}else l.push(1),l.push("..."),l.push(n-1),l.push(n),l.push(n+1),l.push("..."),l.push(c);return l}),se=()=>{const c=X.value.length>0?Q.value.filter(Se=>X.value.includes(Se.id)):Q.value,n=["Nombre Documento","Cliente","Estado","Etiquetas"],l=c.map(Se=>[Se.title||"",ie(Se),"Completado",Se.tags?Se.tags.map(ze=>ze.name).join(", "):""]),R=[n.join(","),...l.map(Se=>Se.map(ze=>`"${ze}"`).join(","))].join(`
`),O=new Blob([R],{type:"text/csv;charset=utf-8;"}),ne=document.createElement("a"),Ue=URL.createObjectURL(O);ne.setAttribute("href",Ue),ne.setAttribute("download",`documentos_completados_${new Date().toISOString().split("T")[0]}.csv`),ne.style.visibility="hidden",document.body.appendChild(ne),ne.click(),document.body.removeChild(ne)},ce=async(c,n)=>{try{switch(c){case"editForm":y("edit",n,{userRole:W()});break;case"editDocument":D.push(`/dynamic_document_dashboard/client/editor/edit/${n.id}`);break;case"preview":await U(n);break;case"delete":await z(n);break;case"letterhead":y("letterhead",n);break;case"relationships":y("relationships",n);break;case"downloadPDF":await oe(n);break;case"downloadWord":await de(n);break;case"email":y("email",n);break;default:console.warn("Unknown action:",c)}}catch(l){console.error(`Error executing action ${c}:`,l)}},me=b(!1),De=b(null),Ee=c=>{De.value=c,me.value=!0},je=async(c,n)=>{me.value=!1,await ce(c,n)};return(c,n)=>(s(),o("div",null,[e("div",Od,[e("div",qd,[e("div",Vd,[r(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Ce(e("input",{"onUpdate:modelValue":n[0]||(n[0]=l=>te.value=l),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Fe,te.value]])])]),e("div",Qd,[r(t(Le),{as:"div",class:"relative"},{default:j(()=>[r(t(Be),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[e("div",Wd,[r(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",Hd,g(L.value||"Etiqueta"),1)]),r(t(qe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:j(()=>[e("div",Gd,[r(t(ve),null,{default:j(({active:l})=>[e("a",{onClick:n[1]||(n[1]=R=>S.value=null),class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,fe(K.value,l=>(s(),le(t(ve),{key:l.id},{default:j(({active:R})=>[e("a",{onClick:O=>S.value=l.id,class:P([R?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},g(l.name),11,Zd)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",Kd,[S.value||d.value||F.value?(s(),o("button",{key:0,onClick:we,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[r(t(Te),{class:"h-4 w-4 flex-shrink-0"}),Yd])):h("",!0)])]),e("div",Jd,[e("div",Xd,[ec,Ce(e("input",{"onUpdate:modelValue":n[2]||(n[2]=l=>d.value=l),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Fe,d.value]])]),e("div",tc,[sc,Ce(e("input",{"onUpdate:modelValue":n[3]||(n[3]=l=>F.value=l),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Fe,F.value]])])]),e("div",oc,[e("div",ac,[e("div",rc,[e("button",{onClick:se,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[r(t(ot),{class:"h-4 w-4"}),nc]),r(t(Le),{as:"div",class:"relative"},{default:j(()=>[r(t(Be),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:j(()=>[r(t(lt),{class:"h-5 w-5 text-gray-500"})]),_:1}),r(t(Re),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",lc,[r(t(ve),null,{default:j(({active:l})=>[e("a",{onClick:G,class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),r(t(ve),null,{default:j(({active:l})=>[e("a",{onClick:xe,class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),r(t(Le),{as:"div",class:"relative"},{default:j(()=>[r(t(Be),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[ic,re(" "+g(M.value)+" ",1),r(t(qe),{class:"h-4 w-4"})]),_:1}),r(t(Re),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",dc,[r(t(ve),null,{default:j(({active:l})=>[e("a",{onClick:n[4]||(n[4]=R=>T.value="recent"),class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),r(t(ve),null,{default:j(({active:l})=>[e("a",{onClick:n[5]||(n[5]=R=>T.value="name"),class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",cc,[e("div",uc,[e("table",mc,[e("thead",gc,[e("tr",null,[e("th",pc,[e("input",{type:"checkbox",checked:q.value,onChange:V,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,hc)]),fc,yc,vc,bc,xc])]),e("tbody",_c,[(s(!0),o(ge,null,fe(Y.value,(l,R)=>{var O;return s(),o("tr",{key:l.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:ne=>Ee(l)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:n[6]||(n[6]=he(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:X.value.includes(l.id),onChange:ne=>N(l.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,$c)]),e("td",kc,[e("div",Cc,[e("div",Dc,[e("div",Sc,[r(t(Oe),{class:"h-5 w-5 text-green-600"})])]),e("div",Fc,[e("div",Ec,g(l.title),1)])])]),e("td",Tc,[e("div",Ac,g(ie(l)),1)]),jc,e("td",Mc,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100",onClick:he(ne=>t(y)("relationships",l),["stop"])}," Ver asociaciones ",8,Pc)]),e("td",Lc,[e("div",Bc,[(s(!0),o(ge,null,fe((O=l.tags)==null?void 0:O.slice(0,2),ne=>(s(),o("span",{key:ne.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",pe(ne)])},g(ne.name),3))),128)),l.tags&&l.tags.length>2?(s(),o("span",Rc," +"+g(l.tags.length-2),1)):h("",!0),!l.tags||l.tags.length===0?(s(),o("span",zc,"-")):h("",!0)])])],8,wc)}),128))])])]),J.value>1?(s(),o("div",Ic,[e("div",Uc,[e("button",{onClick:_e,disabled:v.value===1,class:P(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",v.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,Nc),e("button",{onClick:Ae,disabled:v.value===J.value,class:P(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",v.value===J.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Oc)]),e("div",qc,[e("div",null,[e("p",Vc,[re(" Mostrando "),e("span",Qc,g(H.value.start),1),re(" a "),e("span",Wc,g(H.value.end),1),re(" de "),e("span",Hc,g(H.value.total),1),re(" resultados ")])]),e("div",null,[e("nav",Gc,[e("button",{onClick:_e,disabled:v.value===1,class:P(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",v.value===1?"opacity-50 cursor-not-allowed":""])},[Kc,r(t(Ft),{class:"h-5 w-5","aria-hidden":"true"})],10,Zc),(s(!0),o(ge,null,fe(Ne.value,l=>(s(),o(ge,{key:l},[l!=="..."?(s(),o("button",{key:0,onClick:R=>Ie(l),class:P(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",v.value===l?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},g(l),11,Yc)):(s(),o("span",Jc," ... "))],64))),128)),e("button",{onClick:Ae,disabled:v.value===J.value,class:P(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",v.value===J.value?"opacity-50 cursor-not-allowed":""])},[eu,r(t(ft),{class:"h-5 w-5","aria-hidden":"true"})],10,Xc)])])])])):h("",!0)]),Q.value.length===0?(s(),o("div",tu,[r(t(Pt),{class:"mx-auto h-12 w-12 text-gray-400"}),su,ou])):h("",!0),(s(),le(qt,{to:"body"},[t(k).edit.isOpen?(s(),le(t(Wt),{key:0,document:t(k).edit.document,"user-role":t(W)(),onClose:n[7]||(n[7]=l=>t(C)("edit")),onRefresh:n[8]||(n[8]=l=>f("refresh"))},null,8,["document","user-role"])):h("",!0),t(k).email.isOpen?(s(),le(t(Ht),{key:1,document:t(k).email.document,onClose:n[9]||(n[9]=l=>t(C)("email"))},null,8,["document"])):h("",!0),t(k).letterhead.isOpen?(s(),le(Mt,{key:2,"is-visible":t(k).letterhead.isOpen,document:t(k).letterhead.document,onClose:n[10]||(n[10]=l=>t(C)("letterhead")),onUploaded:n[11]||(n[11]=l=>f("refresh")),onDeleted:n[12]||(n[12]=l=>f("refresh"))},null,8,["is-visible","document"])):h("",!0),t(k).relationships.isOpen?(s(),le(Et,{key:3,"is-open":t(k).relationships.isOpen,document:t(k).relationships.document,onClose:n[13]||(n[13]=l=>t(C)("relationships")),onRefresh:n[14]||(n[14]=l=>f("refresh"))},null,8,["is-open","document"])):h("",!0),me.value?(s(),le(Lt,{key:4,"is-visible":me.value,document:De.value,"card-type":"client",context:"table","user-store":t(m),onClose:n[15]||(n[15]=l=>me.value=!1),onAction:je},null,8,["is-visible","document","user-store"])):h("",!0)]))]))}},ru={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},nu={class:"mb-4"},lu={class:"relative w-full"},iu={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},du={class:"flex items-center gap-2 min-w-0"},cu={class:"truncate"},uu={class:"py-1"},mu=["onClick"],gu={class:"flex items-center justify-stretch"},pu=e("span",null,"Limpiar",-1),hu={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},fu={class:"flex flex-col gap-1"},yu=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),vu={class:"flex flex-col gap-1"},bu=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),xu={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},_u={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},wu={class:"flex items-center gap-2"},$u=e("span",{class:"hidden sm:inline"},"Exportar",-1),ku={class:"py-1"},Cu=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),Du={class:"py-1"},Su={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Fu={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Eu={class:"min-w-full divide-y divide-gray-200"},Tu={class:"bg-gray-50"},Au={scope:"col",class:"w-12 px-6 py-3"},ju=["checked"],Mu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Pu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),Lu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),Bu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Docs. Asociados ",-1),Ru=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),zu={class:"bg-white divide-y divide-gray-200"},Iu=["onClick"],Uu=["checked","onChange"],Nu={class:"px-6 py-4 whitespace-nowrap"},Ou={class:"flex items-center"},qu={class:"flex-shrink-0 h-10 w-10"},Vu={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Qu={class:"ml-4"},Wu={class:"text-sm font-medium text-gray-900"},Hu={class:"px-6 py-4 whitespace-nowrap"},Gu={class:"text-sm text-gray-900"},Zu=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-700 border border-blue-200"}," En Progreso ")],-1),Ku={class:"px-6 py-4 whitespace-nowrap"},Yu=["onClick"],Ju={class:"px-6 py-4 whitespace-nowrap"},Xu={class:"flex flex-wrap gap-1"},em={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},tm={key:1,class:"text-sm text-gray-400"},sm={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},om={class:"flex flex-1 justify-between sm:hidden"},am=["disabled"],rm=["disabled"],nm={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},lm={class:"text-sm text-gray-700"},im={class:"font-medium"},dm={class:"font-medium"},cm={class:"font-medium"},um={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},mm=["disabled"],gm=e("span",{class:"sr-only"},"Anterior",-1),pm=["onClick"],hm={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},fm=["disabled"],ym=e("span",{class:"sr-only"},"Siguiente",-1),vm={key:0,class:"text-center py-12"},bm=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos en progreso",-1),xm=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos en progreso por clientes aparecerán aquí.",-1),_m={__name:"DocumentInProgressByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(a,{emit:$}){const i=Ve(),m=Ke(),D=et(),_=a,f=$,{activeModals:k,openModal:y,closeModal:C,getUserRole:W}=At(i,m),{handlePreviewDocument:U,deleteDocument:z,downloadPDFDocument:oe,downloadWordDocument:de}=jt(i,m,f),te=b(""),S=b(null),d=b(""),F=b(""),T=b("recent"),X=b([]),v=b(1),A=b(10);We(()=>{i.init(),m.init()});const ee=B(()=>{const c=i.progressDocumentsByClient,n=_.selectedTags?_.selectedTags.map(R=>R.id):[];return i.filteredDocumentsBySearchAndTags(_.searchQuery,m,n).filter(R=>c.some(O=>O.id===R.id))}),Q=B(()=>{let c=[...ee.value];const n=te.value.toLowerCase();return n&&(c=c.filter(l=>{var R,O;return((R=l.title)==null?void 0:R.toLowerCase().includes(n))||((O=l.tags)==null?void 0:O.some(ne=>{var Ue;return(Ue=ne.name)==null?void 0:Ue.toLowerCase().includes(n)}))})),S.value&&(c=c.filter(l=>l.tags&&l.tags.some(R=>R.id===S.value))),(d.value||F.value)&&(c=c.filter(l=>{const R=l.summary_subscription_date||l.created_at||l.updated_at;if(!R)return!1;const O=new Date(R);if(isNaN(O.getTime()))return!1;if(d.value){const ne=new Date(d.value);if(O<ne)return!1}if(F.value){const ne=new Date(F.value);if(ne.setHours(23,59,59,999),O>ne)return!1}return!0})),T.value==="name"?c.sort((l,R)=>{const O=(l.title||"").toLowerCase(),ne=(R.title||"").toLowerCase();return O.localeCompare(ne)}):T.value==="recent"&&c.sort((l,R)=>{const O=new Date(l.updated_at||l.created_at);return new Date(R.updated_at||R.created_at)-O}),c}),Y=B(()=>{const c=(v.value-1)*A.value,n=c+A.value;return Q.value.slice(c,n)}),J=B(()=>Math.ceil(Q.value.length/A.value)),H=B(()=>{const c=(v.value-1)*A.value+1,n=Math.min(v.value*A.value,Q.value.length);return{start:c,end:n,total:Q.value.length}});ke([te,S,d,F],()=>{v.value=1});const K=B(()=>{const c=new Map;return ee.value.forEach(n=>{n.tags&&n.tags.length>0&&n.tags.forEach(l=>{c.has(l.id)||c.set(l.id,l)})}),Array.from(c.values()).sort((n,l)=>n.name.localeCompare(l.name))}),L=B(()=>{if(!S.value)return null;const c=K.value.find(n=>n.id===S.value);return c?c.name:null}),M=B(()=>{switch(T.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),ie=c=>c.summary_counterparty?c.summary_counterparty:"Cliente",pe=c=>{const n=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],l=c.id%n.length;return n[l]},q=B(()=>Q.value.length>0&&X.value.length===Q.value.length),V=()=>{q.value?X.value=[]:X.value=Q.value.map(c=>c.id)},N=c=>{const n=X.value.indexOf(c);n>-1?X.value.splice(n,1):X.value.push(c)},G=()=>{X.value=Q.value.map(c=>c.id)},xe=()=>{X.value=[]},we=()=>{S.value=null,d.value="",F.value=""},_e=()=>{v.value>1&&v.value--},Ae=()=>{v.value<J.value&&v.value++},Ie=c=>{c>=1&&c<=J.value&&(v.value=c)},Ne=B(()=>{const c=J.value,n=v.value,l=[];if(c<=7)for(let R=1;R<=c;R++)l.push(R);else if(n<=4){for(let R=1;R<=5;R++)l.push(R);l.push("..."),l.push(c)}else if(n>=c-3){l.push(1),l.push("...");for(let R=c-4;R<=c;R++)l.push(R)}else l.push(1),l.push("..."),l.push(n-1),l.push(n),l.push(n+1),l.push("..."),l.push(c);return l}),se=()=>{const c=X.value.length>0?Q.value.filter(Se=>X.value.includes(Se.id)):Q.value,n=["Nombre Documento","Cliente","Estado","Etiquetas"],l=c.map(Se=>[Se.title||"",ie(Se),"En Progreso",Se.tags?Se.tags.map(ze=>ze.name).join(", "):""]),R=[n.join(","),...l.map(Se=>Se.map(ze=>`"${ze}"`).join(","))].join(`
`),O=new Blob([R],{type:"text/csv;charset=utf-8;"}),ne=document.createElement("a"),Ue=URL.createObjectURL(O);ne.setAttribute("href",Ue),ne.setAttribute("download",`documentos_en_progreso_${new Date().toISOString().split("T")[0]}.csv`),ne.style.visibility="hidden",document.body.appendChild(ne),ne.click(),document.body.removeChild(ne)},ce=async(c,n)=>{try{switch(c){case"editForm":y("edit",n,{userRole:W()});break;case"editDocument":D.push(`/dynamic_document_dashboard/client/editor/edit/${n.id}`);break;case"preview":await U(n);break;case"delete":await z(n);break;case"letterhead":y("letterhead",n);break;case"relationships":y("relationships",n);break;case"downloadPDF":await oe(n);break;case"downloadWord":await de(n);break;case"email":y("email",n);break;default:console.warn("Unknown action:",c)}}catch(l){console.error(`Error executing action ${c}:`,l)}},me=b(!1),De=b(null),Ee=c=>{De.value=c,me.value=!0},je=async(c,n)=>{me.value=!1,await ce(c,n)};return(c,n)=>(s(),o("div",null,[e("div",ru,[e("div",nu,[e("div",lu,[r(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Ce(e("input",{"onUpdate:modelValue":n[0]||(n[0]=l=>te.value=l),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Fe,te.value]])])]),e("div",iu,[r(t(Le),{as:"div",class:"relative"},{default:j(()=>[r(t(Be),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[e("div",du,[r(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",cu,g(L.value||"Etiqueta"),1)]),r(t(qe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:j(()=>[e("div",uu,[r(t(ve),null,{default:j(({active:l})=>[e("a",{onClick:n[1]||(n[1]=R=>S.value=null),class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,fe(K.value,l=>(s(),le(t(ve),{key:l.id},{default:j(({active:R})=>[e("a",{onClick:O=>S.value=l.id,class:P([R?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},g(l.name),11,mu)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",gu,[S.value||d.value||F.value?(s(),o("button",{key:0,onClick:we,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[r(t(Te),{class:"h-4 w-4 flex-shrink-0"}),pu])):h("",!0)])]),e("div",hu,[e("div",fu,[yu,Ce(e("input",{"onUpdate:modelValue":n[2]||(n[2]=l=>d.value=l),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Fe,d.value]])]),e("div",vu,[bu,Ce(e("input",{"onUpdate:modelValue":n[3]||(n[3]=l=>F.value=l),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Fe,F.value]])])]),e("div",xu,[e("div",_u,[e("div",wu,[e("button",{onClick:se,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[r(t(ot),{class:"h-4 w-4"}),$u]),r(t(Le),{as:"div",class:"relative"},{default:j(()=>[r(t(Be),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:j(()=>[r(t(lt),{class:"h-5 w-5 text-gray-500"})]),_:1}),r(t(Re),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",ku,[r(t(ve),null,{default:j(({active:l})=>[e("a",{onClick:G,class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),r(t(ve),null,{default:j(({active:l})=>[e("a",{onClick:xe,class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),r(t(Le),{as:"div",class:"relative"},{default:j(()=>[r(t(Be),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[Cu,re(" "+g(M.value)+" ",1),r(t(qe),{class:"h-4 w-4"})]),_:1}),r(t(Re),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",Du,[r(t(ve),null,{default:j(({active:l})=>[e("a",{onClick:n[4]||(n[4]=R=>T.value="recent"),class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),r(t(ve),null,{default:j(({active:l})=>[e("a",{onClick:n[5]||(n[5]=R=>T.value="name"),class:P([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Su,[e("div",Fu,[e("table",Eu,[e("thead",Tu,[e("tr",null,[e("th",Au,[e("input",{type:"checkbox",checked:q.value,onChange:V,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,ju)]),Mu,Pu,Lu,Bu,Ru])]),e("tbody",zu,[(s(!0),o(ge,null,fe(Y.value,(l,R)=>{var O;return s(),o("tr",{key:l.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:ne=>Ee(l)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:n[6]||(n[6]=he(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:X.value.includes(l.id),onChange:ne=>N(l.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Uu)]),e("td",Nu,[e("div",Ou,[e("div",qu,[e("div",Vu,[r(t(Oe),{class:"h-5 w-5 text-blue-600"})])]),e("div",Qu,[e("div",Wu,g(l.title),1)])])]),e("td",Hu,[e("div",Gu,g(ie(l)),1)]),Zu,e("td",Ku,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100",onClick:he(ne=>t(y)("relationships",l),["stop"])}," Ver asociaciones ",8,Yu)]),e("td",Ju,[e("div",Xu,[(s(!0),o(ge,null,fe((O=l.tags)==null?void 0:O.slice(0,2),ne=>(s(),o("span",{key:ne.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",pe(ne)])},g(ne.name),3))),128)),l.tags&&l.tags.length>2?(s(),o("span",em," +"+g(l.tags.length-2),1)):h("",!0),!l.tags||l.tags.length===0?(s(),o("span",tm,"-")):h("",!0)])])],8,Iu)}),128))])])]),J.value>1?(s(),o("div",sm,[e("div",om,[e("button",{onClick:_e,disabled:v.value===1,class:P(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",v.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,am),e("button",{onClick:Ae,disabled:v.value===J.value,class:P(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",v.value===J.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,rm)]),e("div",nm,[e("div",null,[e("p",lm,[re(" Mostrando "),e("span",im,g(H.value.start),1),re(" a "),e("span",dm,g(H.value.end),1),re(" de "),e("span",cm,g(H.value.total),1),re(" resultados ")])]),e("div",null,[e("nav",um,[e("button",{onClick:_e,disabled:v.value===1,class:P(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",v.value===1?"opacity-50 cursor-not-allowed":""])},[gm,r(t(Ft),{class:"h-5 w-5","aria-hidden":"true"})],10,mm),(s(!0),o(ge,null,fe(Ne.value,l=>(s(),o(ge,{key:l},[l!=="..."?(s(),o("button",{key:0,onClick:R=>Ie(l),class:P(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",v.value===l?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},g(l),11,pm)):(s(),o("span",hm," ... "))],64))),128)),e("button",{onClick:Ae,disabled:v.value===J.value,class:P(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",v.value===J.value?"opacity-50 cursor-not-allowed":""])},[ym,r(t(ft),{class:"h-5 w-5","aria-hidden":"true"})],10,fm)])])])])):h("",!0)]),Q.value.length===0?(s(),o("div",vm,[r(t(Pt),{class:"mx-auto h-12 w-12 text-gray-400"}),bm,xm])):h("",!0),(s(),le(qt,{to:"body"},[t(k).edit.isOpen?(s(),le(t(Wt),{key:0,document:t(k).edit.document,"user-role":t(W)(),onClose:n[7]||(n[7]=l=>t(C)("edit")),onRefresh:n[8]||(n[8]=l=>f("refresh"))},null,8,["document","user-role"])):h("",!0),t(k).email.isOpen?(s(),le(t(Ht),{key:1,document:t(k).email.document,onClose:n[9]||(n[9]=l=>t(C)("email"))},null,8,["document"])):h("",!0),t(k).letterhead.isOpen?(s(),le(Mt,{key:2,"is-visible":t(k).letterhead.isOpen,document:t(k).letterhead.document,onClose:n[10]||(n[10]=l=>t(C)("letterhead")),onUploaded:n[11]||(n[11]=l=>f("refresh")),onDeleted:n[12]||(n[12]=l=>f("refresh"))},null,8,["is-visible","document"])):h("",!0),t(k).relationships.isOpen?(s(),le(Et,{key:3,"is-open":t(k).relationships.isOpen,document:t(k).relationships.document,onClose:n[13]||(n[13]=l=>t(C)("relationships")),onRefresh:n[14]||(n[14]=l=>f("refresh"))},null,8,["is-open","document"])):h("",!0),me.value?(s(),le(Lt,{key:4,"is-visible":me.value,document:De.value,"card-type":"client",context:"table","user-store":t(m),onClose:n[15]||(n[15]=l=>me.value=!1),onAction:je},null,8,["is-visible","document","user-store"])):h("",!0)]))]))}},wm={class:"bg-white rounded-xl shadow-xl max-w-lg w-full mx-4"},$m={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},km=e("h2",{class:"text-sm font-semibold text-gray-900"}," Información clave del documento ",-1),Cm=e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.8",d:"M6 6l8 8M6 14L14 6"})],-1),Dm=[Cm],Sm={class:"px-4 py-4 space-y-4 text-sm text-gray-800 max-h-[70vh] overflow-y-auto"},Fm={key:0},Em=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Usuario / Contraparte ",-1),Tm={class:"text-gray-900 break-words"},Am={key:1},jm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Objeto ",-1),Mm={class:"text-gray-900 whitespace-pre-line"},Pm={key:2},Lm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Valor ",-1),Bm={class:"text-gray-900 font-medium text-base"},Rm={key:3},zm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Plazo ",-1),Im={class:"text-gray-900"},Um={key:4},Nm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Fechas ",-1),Om={class:"space-y-1 text-gray-900"},qm={key:0},Vm=e("span",{class:"font-medium"},"Suscripción:",-1),Qm={class:"ml-1"},Wm={key:1},Hm=e("span",{class:"font-medium"},"Vigencia:",-1),Gm={class:"ml-1"},Zm={key:0},Km={key:1},Ym={key:2},Jm={key:5,class:"text-gray-400 text-sm"},Xm={class:"px-4 py-3 border-t border-gray-100 flex justify-end"},e0={__name:"DocumentSummaryModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close"],setup(a,{emit:$}){const i=a,m=B(()=>i.document&&i.document.summary_counterparty||""),D=B(()=>{if(!i.document||!i.document.summary_value)return"";const y=i.document.summary_value,C=i.document.summary_value_currency||"",W=new Intl.NumberFormat("es-CO",{minimumFractionDigits:0,maximumFractionDigits:2}).format(y);return C==="USD"?`USD $${W}`:C==="EUR"?`€${W}`:C==="COP"?`$${W} COP`:C?`${C} ${W}`:`$${W}`}),_=B(()=>i.document?!!(i.document.summary_subscription_date||i.document.summary_start_date||i.document.summary_end_date):!1),f=B(()=>i.document?!!(m.value||i.document.summary_object||D.value||i.document.summary_term||_.value):!1),k=y=>y?typeof y=="string"?y.split("T")[0]:y:"";return(y,C)=>a.isVisible&&a.document?(s(),o("div",{key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",onClick:C[2]||(C[2]=he(W=>y.$emit("close"),["self"]))},[e("div",wm,[e("div",$m,[km,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:C[0]||(C[0]=W=>y.$emit("close"))},Dm)]),e("div",Sm,[m.value?(s(),o("div",Fm,[Em,e("div",Tm,g(m.value),1)])):h("",!0),a.document.summary_object?(s(),o("div",Am,[jm,e("div",Mm,g(a.document.summary_object),1)])):h("",!0),D.value?(s(),o("div",Pm,[Lm,e("div",Bm,g(D.value),1)])):h("",!0),a.document.summary_term?(s(),o("div",Rm,[zm,e("div",Im,g(a.document.summary_term),1)])):h("",!0),_.value?(s(),o("div",Um,[Nm,e("div",Om,[a.document.summary_subscription_date?(s(),o("div",qm,[Vm,e("span",Qm,g(k(a.document.summary_subscription_date)),1)])):h("",!0),a.document.summary_start_date||a.document.summary_end_date?(s(),o("div",Wm,[Hm,e("span",Gm,[a.document.summary_start_date?(s(),o("span",Zm,g(k(a.document.summary_start_date)),1)):h("",!0),a.document.summary_start_date&&a.document.summary_end_date?(s(),o("span",Km," → ")):h("",!0),a.document.summary_end_date?(s(),o("span",Ym,g(k(a.document.summary_end_date)),1)):h("",!0)])])):h("",!0)])])):h("",!0),f.value?h("",!0):(s(),o("div",Jm," Este documento aún no tiene campos clasificados para mostrar. "))]),e("div",Xm,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-md text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200",onClick:C[1]||(C[1]=W=>y.$emit("close"))}," Cerrar ")])])])):h("",!0)}},t0={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},s0={class:"mb-4"},o0={class:"relative w-full"},a0={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},r0={class:"flex items-center gap-2 min-w-0"},n0={class:"truncate"},l0={class:"p-2"},i0={class:"relative mb-2"},d0={class:"max-h-60 overflow-y-auto"},c0=["onClick"],u0={class:"truncate"},m0={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},g0={class:"flex items-center justify-stretch"},p0=e("span",null,"Limpiar",-1),h0={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},f0={class:"flex flex-col gap-1"},y0=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),v0={class:"flex flex-col gap-1"},b0=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),x0={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},_0={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},w0={class:"flex items-center gap-2"},$0=e("span",{class:"hidden sm:inline"},"Exportar",-1),k0={class:"py-1"},C0=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),D0={class:"py-1"},S0={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},F0={class:"overflow-x-auto",style:{"overflow-y":"visible"}},E0={class:"min-w-full divide-y divide-gray-200"},T0={class:"bg-gray-50"},A0={scope:"col",class:"w-12 px-6 py-3"},j0=["checked"],M0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),P0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado Firma ",-1),L0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Contraparte ",-1),B0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Objeto ",-1),R0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Valor ",-1),z0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plazo ",-1),I0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fechas ",-1),U0={key:0,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},N0={key:1,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},O0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),q0={class:"bg-white divide-y divide-gray-200"},V0=["onClick"],Q0=["checked","onChange"],W0={class:"px-6 py-4 whitespace-nowrap"},H0={class:"flex items-center"},G0={class:"flex-shrink-0 h-10 w-10"},Z0={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},K0={class:"ml-4"},Y0={class:"text-sm font-medium text-gray-900"},J0={class:"px-6 py-4 whitespace-nowrap"},X0={class:"px-6 py-4 whitespace-nowrap"},eg={class:"text-sm text-gray-900"},tg={class:"px-6 py-4 whitespace-nowrap"},sg={class:"text-sm text-gray-900 line-clamp-2 max-w-xs"},og={class:"px-6 py-4 whitespace-nowrap"},ag={class:"text-sm text-gray-900"},rg={class:"px-6 py-4 whitespace-nowrap"},ng={class:"text-sm text-gray-900"},lg={class:"px-6 py-4 whitespace-nowrap"},ig={class:"text-xs text-gray-900 space-y-0.5"},dg={key:0},cg=e("span",{class:"font-medium"},"Suscripción:",-1),ug={class:"ml-1"},mg={key:1},gg=e("span",{class:"font-medium"},"Vigencia:",-1),pg={class:"ml-1"},hg={key:0},fg={key:1},yg={key:2},vg={key:2,class:"text-gray-400"},bg={key:0,class:"px-6 py-4 whitespace-nowrap"},xg={key:0,class:"text-sm text-gray-900"},_g={key:1,class:"text-sm text-gray-400"},wg={key:1,class:"px-6 py-4 whitespace-nowrap"},$g=["disabled","onClick"],kg={key:0},Cg={key:1},Dg={class:"px-6 py-4 whitespace-nowrap"},Sg={class:"flex flex-wrap gap-1"},Fg={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},Eg={key:1,class:"text-sm text-gray-400"},Tg={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Ag={class:"flex flex-1 justify-between sm:hidden"},jg=["disabled"],Mg=["disabled"],Pg={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Lg={class:"text-sm text-gray-700"},Bg={class:"font-medium"},Rg={class:"font-medium"},zg={class:"font-medium"},Ig={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Ug=["disabled"],Ng=e("span",{class:"sr-only"},"Anterior",-1),Og=["onClick"],qg={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},Vg=["disabled"],Qg=e("span",{class:"sr-only"},"Siguiente",-1),Wg={key:0,class:"text-center py-12"},Hg={class:"mt-2 text-sm font-medium text-gray-900"},Gg={class:"mt-1 text-sm text-gray-500"},Zg={key:1,class:"text-center py-12"},Kg=e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-secondary"},null,-1),Yg=e("p",{class:"mt-2 text-sm text-gray-500"},"Cargando documentos...",-1),Jg=[Kg,Yg],Xg={key:5,class:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40"},ep={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4"},tp={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},sp=e("h2",{class:"text-sm font-semibold text-gray-900"},"Rechazar documento",-1),op={class:"px-4 py-4 space-y-3 text-sm text-gray-700"},ap={class:"font-semibold"},rp=e("p",{class:"text-xs text-gray-500"}," El rechazo devolverá el documento al abogado creador para que pueda revisarlo, editarlo o archivarlo. ",-1),np=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Motivo del rechazo (opcional) ",-1),lp={key:6,class:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40"},ip={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4"},dp={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},cp=e("h2",{class:"text-sm font-semibold text-gray-900"},"Motivo del rechazo",-1),up={class:"px-4 py-4 text-sm text-gray-700 whitespace-pre-line"},mp={class:"px-4 py-3 border-t border-gray-100 flex justify-end bg-gray-50"},nt={__name:"SignaturesListTable",props:{state:{type:String,required:!0,validator:a=>["PendingSignatures","FullySigned","Archived"].includes(a)},searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","document-fully-signed","document-rejected","open-electronic-signature"],setup(a,{expose:$,emit:i}){const m=a,D=i,_=Ke(),f=Ve();et();const{activeModals:k,openModal:y,closeModal:C,getUserRole:W}=At(f,_),{handlePreviewDocument:U,downloadPDFDocument:z,signDocument:oe,downloadSignedDocument:de}=jt(f,_,D);b([]);const te=b(!1),S=b(""),d=b(""),F=b(null),T=b(""),X=b(""),v=b("recent"),A=b([]),ee=b(!1),Q=b(null),Y=b(1),J=b(10),H=B(()=>m.state==="PendingSignatures"?"No tienes documentos pendientes por firmar":m.state==="FullySigned"?"No tienes documentos firmados":"No tienes documentos archivados"),K=B(()=>m.state==="PendingSignatures"?"Cuando tengas documentos que requieran tu firma electrónica aparecerán aquí.":m.state==="FullySigned"?"Una vez que firmes documentos electrónicamente, aparecerán aquí.":"Aquí aparecerán los documentos rechazados o expirados relacionados contigo."),L=B(()=>{const I=_.currentUser.role,E=_.currentUser.id,ae=_.currentUser.email;let w=[];return I==="lawyer"?m.state==="PendingSignatures"?w=f.pendingSignatureDocuments.filter(ue=>{var u;const ye=ue.created_by===E,p=(u=ue.signatures)==null?void 0:u.some(Z=>Z.signer_email===ae);return ye||p}):m.state==="FullySigned"?w=f.fullySignedDocuments.filter(ue=>{var u;const ye=ue.created_by===E,p=(u=ue.signatures)==null?void 0:u.some(Z=>Z.signer_email===ae&&Z.signed);return ye||p}):m.state==="Archived"&&(w=f.documents.filter(ue=>{var u;if(ue.state!=="Rejected"&&ue.state!=="Expired")return!1;const ye=ue.created_by===E,p=(u=ue.signatures)==null?void 0:u.some(Z=>Z.signer_email===ae);return ye||p})):m.state==="PendingSignatures"?w=f.documents.filter(ue=>{var u;if(ue.state!=="PendingSignatures")return!1;const ye=(u=ue.signatures)==null?void 0:u.some(Z=>Z.signer_email===ae),p=ue.created_by===E;return ye||p}):m.state==="FullySigned"?w=f.documents.filter(ue=>{var u;if(ue.state!=="FullySigned")return!1;const ye=(u=ue.signatures)==null?void 0:u.some(Z=>Z.signer_email===ae&&Z.signed),p=ue.created_by===E;return ye||p}):m.state==="Archived"&&(w=f.documents.filter(ue=>{var u;if(ue.state!=="Rejected"&&ue.state!=="Expired")return!1;const ye=(u=ue.signatures)==null?void 0:u.some(Z=>Z.signer_email===ae),p=ue.created_by===E;return ye||p})),w}),M=B(()=>{let I=[...L.value];const E=S.value.toLowerCase();return E&&(I=I.filter(ae=>{var w,ue;return((w=ae.title)==null?void 0:w.toLowerCase().includes(E))||((ue=ae.tags)==null?void 0:ue.some(ye=>{var p;return(p=ye.name)==null?void 0:p.toLowerCase().includes(E)}))})),F.value&&(I=I.filter(ae=>ae.tags&&ae.tags.some(w=>w.id===F.value))),(T.value||X.value)&&(I=I.filter(ae=>{const w=ae.summary_subscription_date||ae.created_at||ae.updated_at;if(!w)return!1;const ue=new Date(w);if(isNaN(ue.getTime()))return!1;if(T.value){const ye=new Date(T.value);if(ue<ye)return!1}if(X.value){const ye=new Date(X.value);if(ye.setHours(23,59,59,999),ue>ye)return!1}return!0})),v.value==="name"?I.sort((ae,w)=>{const ue=(ae.title||"").toLowerCase(),ye=(w.title||"").toLowerCase();return ue.localeCompare(ye)}):v.value==="recent"&&I.sort((ae,w)=>{const ue=new Date(ae.updated_at||ae.created_at);return new Date(w.updated_at||w.created_at)-ue}),I}),ie=B(()=>{const I=(Y.value-1)*J.value,E=I+J.value;return M.value.slice(I,E)}),pe=B(()=>Math.ceil(M.value.length/J.value)),q=B(()=>{const I=(Y.value-1)*J.value+1,E=Math.min(Y.value*J.value,M.value.length);return{start:I,end:E,total:M.value.length}});ke([S,F,T,X],()=>{Y.value=1});const V=B(()=>{const I=new Map;return L.value.forEach(E=>{E.tags&&E.tags.length>0&&E.tags.forEach(ae=>{I.has(ae.id)||I.set(ae.id,ae)})}),Array.from(I.values()).sort((E,ae)=>E.name.localeCompare(ae.name))}),N=B(()=>{if(!d.value)return V.value;const I=d.value.toLowerCase();return V.value.filter(E=>E.name.toLowerCase().includes(I))}),G=B(()=>{if(!F.value)return null;const I=V.value.find(E=>E.id===F.value);return I?I.name:null}),xe=I=>{const E=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],ae=I.id%E.length;return E[ae]},we=B(()=>{switch(v.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),_e=I=>{const E=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],ae=I.id%E.length;return E[ae]},Ae=I=>m.state==="FullySigned"?"bg-green-100 text-green-700 border border-green-200":m.state==="Archived"?I.state==="Rejected"?"bg-red-100 text-red-700 border border-red-200":(I.state==="Expired","bg-gray-100 text-gray-700 border border-gray-200"):"bg-yellow-100 text-yellow-700 border border-yellow-200",Ie=I=>m.state==="FullySigned"?"Firmado":m.state==="Archived"?I.state==="Rejected"?"Rechazado":I.state==="Expired"?"Expirado":"Archivado":"Pendiente",Ne=B(()=>M.value.length>0&&A.value.length===M.value.length),se=()=>{Ne.value?A.value=[]:A.value=M.value.map(I=>I.id)},ce=I=>{const E=A.value.indexOf(I);E>-1?A.value.splice(E,1):A.value.push(I)},me=()=>{A.value=M.value.map(I=>I.id)},De=()=>{A.value=[]},Ee=()=>{F.value=null,T.value="",X.value=""},je=()=>{Y.value>1&&Y.value--},c=()=>{Y.value<pe.value&&Y.value++},n=I=>{I>=1&&I<=pe.value&&(Y.value=I)},l=I=>I?typeof I=="string"?I.split("T")[0]:I:"",R=B(()=>{const I=pe.value,E=Y.value,ae=[];if(I<=7)for(let w=1;w<=I;w++)ae.push(w);else if(E<=4){for(let w=1;w<=5;w++)ae.push(w);ae.push("..."),ae.push(I)}else if(E>=I-3){ae.push(1),ae.push("...");for(let w=I-4;w<=I;w++)ae.push(w)}else ae.push(1),ae.push("..."),ae.push(E-1),ae.push(E),ae.push(E+1),ae.push("..."),ae.push(I);return ae}),O=()=>{const I=A.value.length>0?M.value.filter(u=>A.value.includes(u.id)):M.value,E=["Nombre Documento","Estado Firma","Etiquetas"],ae=I.map(u=>[u.title||"",Ie(u),u.tags?u.tags.map(Z=>Z.name).join(", "):""]),w=[E.join(","),...ae.map(u=>u.map(Z=>`"${Z}"`).join(","))].join(`
`),ue=new Blob([w],{type:"text/csv;charset=utf-8;"}),ye=document.createElement("a"),p=URL.createObjectURL(ue);ye.setAttribute("href",p),ye.setAttribute("download",`documentos_firmas_${new Date().toISOString().split("T")[0]}.csv`),ye.style.visibility="hidden",document.body.appendChild(ye),ye.click(),document.body.removeChild(ye)},ne=b(!1),Ue=b(null),Se=b(!1),ze=b(null),Ye=b(""),rt=b(!1),vt=b(""),dt=I=>{Ue.value=I,ne.value=!0},ct=async(I,E)=>{ne.value=!1,await Bt(I,E)},Bt=async(I,E)=>{try{switch(I){case"preview":await U(E);break;case"letterhead":y("letterhead",E);break;case"relationships":y("relationships",E);break;case"viewSignatures":y("signatures",E);break;case"sign":await oe(E,y);break;case"reject":ze.value=E,Ye.value="",Se.value=!0;break;case"viewRejectionReason":{const ae=(E.signatures||[]).find(w=>w.rejection_comment);ae&&ae.rejection_comment?(vt.value=ae.rejection_comment,rt.value=!0):await $e("Este documento no tiene un motivo de rechazo registrado.","info");break}case"downloadSignedDocument":await de(E);break;case"downloadPDF":await z(E);break;default:console.warn("Unknown action:",I)}}catch(ae){console.error(`Error executing action ${I}:`,ae)}},ut=()=>{Se.value=!1,ze.value=null,Ye.value=""},Rt=async()=>{if(!ze.value)return;const I=ze.value,E=I.id,ae=_.currentUser.id;try{const w=`dynamic-documents/${E}/reject/${ae}/`,ue=Ye.value?{comment:Ye.value}:{},ye=await ls(w,ue);ye&&(ye.status===200||ye.status===201)?(ut(),D("document-rejected",I),Promise.all([$e("Documento rechazado correctamente.","success"),$s(ks.FINISH,`Rechazaste el documento "${I.title}"`).catch(p=>console.warn("No se pudo registrar la actividad de rechazo:",p)),f.init(!0)]).then(()=>{D("refresh")})):await $e("Error al rechazar el documento.","error")}catch(w){console.error("Error rejecting document:",w),await $e("Error al rechazar el documento.","error")}},bt=async()=>{te.value=!0;try{await f.init(!0)}catch(I){console.error("Error refreshing documents:",I),$e("Error al actualizar documentos","error")}finally{te.value=!1}},xt=async()=>{await bt(),D("refresh")};We(async()=>{await bt()}),$({refresh:xt});const zt=I=>{var ae;if(!I.summary_counterparty)return null;const E=(ae=I.variables)==null?void 0:ae.find(w=>w.summary_field==="counterparty");return(E==null?void 0:E.value)||I.summary_counterparty},_t=I=>{if(!I.summary_value)return null;const E=parseFloat(I.summary_value);return isNaN(E)?null:E};return ke(()=>_.currentUser,()=>{xt()}),(I,E)=>{var ae;return s(),o("div",null,[e("div",t0,[e("div",s0,[e("div",o0,[r(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),Ce(e("input",{"onUpdate:modelValue":E[0]||(E[0]=w=>S.value=w),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Fe,S.value]])])]),e("div",a0,[r(t(Le),{as:"div",class:"relative"},{default:j(()=>[r(t(Be),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[e("div",r0,[r(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",n0,g(G.value||"Etiqueta"),1)]),r(t(qe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",l0,[e("div",i0,[r(t(Ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),Ce(e("input",{"onUpdate:modelValue":E[1]||(E[1]=w=>d.value=w),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:E[2]||(E[2]=he(()=>{},["stop"]))},null,512),[[Fe,d.value]])]),e("div",d0,[r(t(ve),null,{default:j(({active:w})=>[e("a",{onClick:E[3]||(E[3]=ue=>F.value=null),class:P([w?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,fe(N.value,w=>(s(),le(t(ve),{key:w.id},{default:j(({active:ue})=>[e("a",{onClick:ye=>F.value=w.id,class:P([ue?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:P(["w-3 h-3 rounded-full flex-shrink-0",xe(w)])},null,2),e("span",u0,g(w.name),1)],10,c0)]),_:2},1024))),128)),N.value.length===0?(s(),o("div",m0," No se encontraron etiquetas ")):h("",!0)])])]),_:1})]),_:1}),e("div",g0,[F.value||T.value||X.value?(s(),o("button",{key:0,onClick:Ee,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[r(t(Te),{class:"h-4 w-4 flex-shrink-0"}),p0])):h("",!0)])]),e("div",h0,[e("div",f0,[y0,Ce(e("input",{"onUpdate:modelValue":E[4]||(E[4]=w=>T.value=w),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Fe,T.value]])]),e("div",v0,[b0,Ce(e("input",{"onUpdate:modelValue":E[5]||(E[5]=w=>X.value=w),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Fe,X.value]])])]),e("div",x0,[e("div",_0,[e("div",w0,[e("button",{onClick:O,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[r(t(ot),{class:"h-4 w-4"}),$0]),r(t(Le),{as:"div",class:"relative"},{default:j(()=>[r(t(Be),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:j(()=>[r(t(lt),{class:"h-5 w-5 text-gray-500"})]),_:1}),r(t(Re),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",k0,[r(t(ve),null,{default:j(({active:w})=>[e("a",{onClick:me,class:P([w?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),r(t(ve),null,{default:j(({active:w})=>[e("a",{onClick:De,class:P([w?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),r(t(Le),{as:"div",class:"relative"},{default:j(()=>[r(t(Be),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:j(()=>[C0,re(" "+g(we.value)+" ",1),r(t(qe),{class:"h-4 w-4"})]),_:1}),r(t(Re),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:j(()=>[e("div",D0,[r(t(ve),null,{default:j(({active:w})=>[e("a",{onClick:E[6]||(E[6]=ue=>v.value="recent"),class:P([w?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),r(t(ve),null,{default:j(({active:w})=>[e("a",{onClick:E[7]||(E[7]=ue=>v.value="name"),class:P([w?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",S0,[e("div",F0,[e("table",E0,[e("thead",T0,[e("tr",null,[e("th",A0,[e("input",{type:"checkbox",checked:Ne.value,onChange:se,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,j0)]),M0,P0,L0,B0,R0,z0,I0,m.state==="PendingSignatures"?(s(),o("th",U0," Fecha Expiración ")):h("",!0),m.state==="PendingSignatures"||m.state==="FullySigned"?(s(),o("th",N0," Docs. Asociados ")):h("",!0),O0])]),e("tbody",q0,[(s(!0),o(ge,null,fe(ie.value,(w,ue)=>{var ye;return s(),o("tr",{key:w.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:p=>dt(w)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:E[8]||(E[8]=he(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:A.value.includes(w.id),onChange:p=>ce(w.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Q0)]),e("td",W0,[e("div",H0,[e("div",G0,[e("div",Z0,[r(t(Oe),{class:"h-5 w-5 text-purple-600"})])]),e("div",K0,[e("div",Y0,g(w.title),1)])])]),e("td",J0,[e("span",{class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",Ae(w)])},g(Ie(w)),3)]),e("td",X0,[e("span",eg,g(zt(w)||"-"),1)]),e("td",tg,[e("span",sg,g(w.summary_object||"-"),1)]),e("td",og,[e("span",ag,g(_t(w)||"-"),1)]),e("td",rg,[e("span",ng,g(w.summary_term||"-"),1)]),e("td",lg,[e("div",ig,[w.summary_subscription_date?(s(),o("div",dg,[cg,e("span",ug,g(l(w.summary_subscription_date)),1)])):h("",!0),w.summary_start_date||w.summary_end_date?(s(),o("div",mg,[gg,e("span",pg,[w.summary_start_date?(s(),o("span",hg,g(l(w.summary_start_date)),1)):h("",!0),w.summary_start_date&&w.summary_end_date?(s(),o("span",fg," → ")):h("",!0),w.summary_end_date?(s(),o("span",yg,g(l(w.summary_end_date)),1)):h("",!0)])])):h("",!0),!w.summary_subscription_date&&!w.summary_start_date&&!w.summary_end_date?(s(),o("span",vg," - ")):h("",!0)])]),m.state==="PendingSignatures"?(s(),o("td",bg,[w.signature_due_date?(s(),o("span",xg,g(l(w.signature_due_date)),1)):(s(),o("span",_g," - "))])):h("",!0),m.state==="PendingSignatures"||m.state==="FullySigned"?(s(),o("td",wg,[e("button",{type:"button",disabled:!w.relationships_count||w.relationships_count===0,class:P(["inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border transition-colors",w.relationships_count&&w.relationships_count>0?"border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100 cursor-pointer":"border-gray-200 text-gray-400 bg-gray-50 cursor-not-allowed opacity-60"]),onClick:he(p=>t(y)("relationships",w),["stop"])},[w.relationships_count&&w.relationships_count>0?(s(),o("span",kg," Ver asociaciones ("+g(w.relationships_count)+") ",1)):(s(),o("span",Cg," Sin asociaciones "))],10,$g)])):h("",!0),e("td",Dg,[e("div",Sg,[(s(!0),o(ge,null,fe((ye=w.tags)==null?void 0:ye.slice(0,2),p=>(s(),o("span",{key:p.id,class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",_e(p)])},g(p.name),3))),128)),w.tags&&w.tags.length>2?(s(),o("span",Fg," +"+g(w.tags.length-2),1)):h("",!0),!w.tags||w.tags.length===0?(s(),o("span",Eg,"-")):h("",!0)])])],8,V0)}),128))])])]),pe.value>1?(s(),o("div",Tg,[e("div",Ag,[e("button",{onClick:je,disabled:Y.value===1,class:P(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",Y.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,jg),e("button",{onClick:c,disabled:Y.value===pe.value,class:P(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",Y.value===pe.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Mg)]),e("div",Pg,[e("div",null,[e("p",Lg,[re(" Mostrando "),e("span",Bg,g(q.value.start),1),re(" a "),e("span",Rg,g(q.value.end),1),re(" de "),e("span",zg,g(q.value.total),1),re(" resultados ")])]),e("div",null,[e("nav",Ig,[e("button",{onClick:je,disabled:Y.value===1,class:P(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",Y.value===1?"opacity-50 cursor-not-allowed":""])},[Ng,r(t(Ft),{class:"h-5 w-5","aria-hidden":"true"})],10,Ug),(s(!0),o(ge,null,fe(R.value,w=>(s(),o(ge,{key:w},[w!=="..."?(s(),o("button",{key:0,onClick:ue=>n(w),class:P(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",Y.value===w?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},g(w),11,Og)):(s(),o("span",qg," ... "))],64))),128)),e("button",{onClick:c,disabled:Y.value===pe.value,class:P(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",Y.value===pe.value?"opacity-50 cursor-not-allowed":""])},[Qg,r(t(ft),{class:"h-5 w-5","aria-hidden":"true"})],10,Vg)])])])])):h("",!0)]),M.value.length===0&&!te.value?(s(),o("div",Wg,[r(t(Pt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",Hg,g(H.value),1),e("p",Gg,g(K.value),1)])):h("",!0),te.value?(s(),o("div",Zg,Jg)):h("",!0),r(Qt,{isVisible:t(tt),documentData:t(Vt),onClose:E[9]||(E[9]=w=>tt.value=!1)},null,8,["isVisible","documentData"]),(s(),le(qt,{to:"body"},[t(k).signatures.isOpen?(s(),le(t(is),{key:0,"document-id":(ae=t(k).signatures.document)==null?void 0:ae.id,onClose:E[10]||(E[10]=w=>t(C)("signatures")),onRefresh:E[11]||(E[11]=w=>D("refresh")),onOpenElectronicSignature:E[12]||(E[12]=w=>D("open-electronic-signature"))},null,8,["document-id"])):h("",!0),t(k).letterhead.isOpen?(s(),le(Mt,{key:1,"is-visible":t(k).letterhead.isOpen,document:t(k).letterhead.document,onClose:E[13]||(E[13]=w=>t(C)("letterhead")),onRefresh:E[14]||(E[14]=w=>D("refresh"))},null,8,["is-visible","document"])):h("",!0),ne.value?(s(),le(Lt,{key:2,"is-visible":ne.value,document:Ue.value,"card-type":"signatures",context:"table","user-store":t(_),onClose:E[15]||(E[15]=w=>ne.value=!1),onAction:ct},null,8,["is-visible","document","user-store"])):h("",!0),t(k).relationships.isOpen?(s(),le(Et,{key:3,"is-open":t(k).relationships.isOpen,document:t(k).relationships.document,readonly:m.state==="PendingSignatures"||m.state==="FullySigned",onClose:E[16]||(E[16]=w=>t(C)("relationships")),onRefresh:E[17]||(E[17]=w=>D("refresh"))},null,8,["is-open","document","readonly"])):h("",!0),ee.value?(s(),le(e0,{key:4,"is-visible":ee.value,document:Q.value,onClose:E[18]||(E[18]=w=>ee.value=!1)},null,8,["is-visible","document"])):h("",!0),Se.value&&ze.value?(s(),o("div",Xg,[e("div",ep,[e("div",tp,[sp,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:ut},[r(t(Te),{class:"h-5 w-5"})])]),e("div",op,[e("p",null,[re(" Estás a punto de rechazar el documento "),e("span",ap,'"'+g(ze.value.title)+'"',1),re(". ")]),rp,e("div",null,[np,Ce(e("textarea",{"onUpdate:modelValue":E[19]||(E[19]=w=>Ye.value=w),rows:"4",class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-secondary focus:border-transparent resize-none",placeholder:"Describe brevemente por qué no estás de acuerdo con el documento..."},null,512),[[Fe,Ye.value]])])]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end gap-2 bg-gray-50"},[e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100",onClick:ut}," Cancelar "),e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700",onClick:Rt}," Rechazar documento ")])])])):h("",!0),rt.value?(s(),o("div",lp,[e("div",ip,[e("div",dp,[cp,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:E[20]||(E[20]=w=>rt.value=!1)},[r(t(Te),{class:"h-5 w-5"})])]),e("div",up,g(vt.value||"No se encontró un motivo de rechazo para este documento."),1),e("div",mp,[e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100",onClick:E[21]||(E[21]=w=>rt.value=!1)}," Cerrar ")])])])):h("",!0)]))])}}},gp={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},pp={class:"flex justify-end"},hp=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[re(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),fp={class:"mt-2"},yp={class:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t border-gray-200"},vp=["disabled"],bp=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),xp=e("span",null,"Actualizar nombre",-1),_p=[bp,xp],wp=["disabled"],$p=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1),kp={__name:"CreateDocumentByLawyer",emits:["close"],setup(a,{emit:$}){const i=et(),m=Ve(),D=$,_=b(""),f=b("");rs(()=>{var oe;(oe=m.selectedDocument)!=null&&oe.title?(_.value=m.selectedDocument.title,f.value=m.selectedDocument.title):(_.value="",f.value="")});const k=oe=>{oe.key==="Escape"&&D("close")};We(()=>{document.addEventListener("keydown",k)}),pt(()=>{document.removeEventListener("keydown",k)});const y=B(()=>_.value.trim().length>0),C=B(()=>{var oe;return!!((oe=m.selectedDocument)!=null&&oe.id)}),W=B(()=>C.value&&_.value.trim()!==f.value.trim()&&_.value.trim().length>0);async function U(){if(C.value&&W.value)try{const oe={title:_.value.trim()};await m.updateDocument(m.selectedDocument.id,oe),f.value=_.value.trim(),m.selectedDocument.title=_.value.trim(),m.lastUpdatedDocumentId=m.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",m.selectedDocument.id);const de=m.selectedDocument.id;D("close",{updatedDocId:de});const te=window.location.pathname;te==="/dynamic_document_dashboard"||te==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(de)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(oe){console.error("Error updating document name:",oe)}}const z=async()=>{if(!y.value)return;const oe=encodeURIComponent(_.value.trim());C.value?(m.selectedDocument.title=_.value,m.selectedDocument.id&&(m.lastUpdatedDocumentId=m.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",m.selectedDocument.id.toString())),i.push(`/dynamic_document_dashboard/lawyer/editor/edit/${m.selectedDocument.id}`)):(m.selectedDocument={title:_.value.trim()},i.push(`/dynamic_document_dashboard/lawyer/editor/create/${oe}`))};return(oe,de)=>(s(),o("div",gp,[e("div",pp,[e("button",{onClick:de[0]||(de[0]=te=>D("close"))},[r(t(Te),{class:"size-6"})])]),e("form",{onSubmit:he(z,["prevent"])},[e("div",null,[hp,e("div",fp,[Ce(e("input",{"onUpdate:modelValue":de[1]||(de[1]=te=>_.value=te),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[Fe,_.value]])])]),e("div",yp,[C.value?(s(),o("button",{key:0,type:"button",onClick:U,disabled:!W.value,class:P(["inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm transition-all duration-200",W.value?"bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500":"bg-gray-100 text-gray-400 border-2 border-dashed border-gray-300 cursor-not-allowed"])},_p,10,vp)):h("",!0),e("button",{type:"submit",class:P(["inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm transition-all duration-200",y.value?"bg-green-600 text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500":"bg-gray-100 text-gray-400 border-2 border-dashed border-gray-300 cursor-not-allowed"]),disabled:!y.value},[$p,e("span",null,g(C.value?"Editar Documento":"Continuar"),1)],10,wp)])],32)]))}},Pe=a=>(Dt("data-v-857c746d"),a=a(),St(),a),Cp={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Dp={class:"px-6 py-4 border-b border-gray-200"},Sp=Pe(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gestión de Membrete Global para PDF",-1)),Fp=Pe(()=>e("p",{class:"text-sm text-gray-500 mt-1"}," La imagen de membrete se usará por defecto solo al generar documentos en PDF. Para documentos Word, se utiliza la plantilla .docx configurada más abajo. ",-1)),Ep={class:"p-6 overflow-y-auto flex-grow"},Tp={key:0,class:"text-center py-10"},Ap=Pe(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),jp={class:"mt-4 text-gray-500"},Mp={key:1,class:"space-y-6"},Pp={key:0,class:"space-y-4"},Lp=Pe(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete de imagen para PDF actual",-1)),Bp={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Rp=["src"],zp={class:"mt-4 flex justify-center space-x-3"},Ip=["disabled"],Up={key:1,class:"text-center py-8"},Np=Pe(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete para PDF",-1)),Op=Pe(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," No tienes una imagen de membrete global configurada para los documentos PDF. ",-1)),qp=Pe(()=>e("p",{class:"mt-1 text-xs text-gray-400"}," Este membrete de imagen se aplicará solo a los PDF que no tengan un membrete específico. ",-1)),Vp={class:"space-y-4"},Qp={class:"text-lg font-medium text-gray-900"},Wp={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},Hp={key:0},Gp={class:"mt-4"},Zp=Pe(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, máximo 10MB. Se usa únicamente para los PDF. ",-1)),Kp=Pe(()=>e("p",{class:"text-xs text-gray-400 mt-1"},' Dimensiones ideales: 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI) ',-1)),Yp={key:1,class:"space-y-4"},Jp={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Xp={class:"text-gray-400"},eh={key:0,class:"mt-4"},th=["src"],sh={class:"flex justify-center space-x-3"},oh=["disabled"],ah={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},rh={class:"space-y-4 border-t border-gray-200 pt-6"},nh=Pe(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Plantilla Word para documentos (.docx)",-1)),lh=Pe(()=>e("p",{class:"text-sm text-gray-500"}," Esta plantilla se usará al descargar documentos en Word. Debe ser un archivo .docx con tu membrete configurado (header, footer o watermark). El contenido del documento se añadirá sobre esa plantilla. ",-1)),ih={key:0,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},dh={class:"text-sm text-gray-700"},ch=Pe(()=>e("div",{class:"font-medium"},"Plantilla actual:",-1)),uh={class:"mt-1 break-words"},mh={class:"font-mono break-all"},gh={key:0,class:"text-gray-400 ml-2"},ph={class:"mt-3 flex flex-wrap gap-3"},hh=["disabled"],fh={key:1,class:"text-sm text-gray-500"},yh={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},vh={key:0},bh={class:"mt-4"},xh=Pe(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos .docx, máximo 10MB. ",-1)),_h={key:1,class:"space-y-4"},wh={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},$h={class:"text-gray-400"},kh={class:"flex justify-center space-x-3"},Ch=["disabled"],Dh={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Sh={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},Fh={class:"flex items-center space-x-2"},Eh=Pe(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete para PDF",-1)),Th=Pe(()=>e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-yellow-800 mb-2"},"🔄 Prioridad de Membrete"),e("div",{class:"text-sm text-yellow-700 space-y-1"},[e("div",null,[e("strong",null,"1º Prioridad:"),re(" Membrete específico del documento")]),e("div",null,[e("strong",null,"2º Prioridad:"),re(" Membrete global de imagen para PDF del usuario (este)")]),e("div",null,[e("strong",null,"3º Prioridad:"),re(" Sin membrete")])])],-1)),Ah=Pe(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"📐 Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"2550 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"3300 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporción:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta, 300 DPI)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"±10%")])])])],-1)),jh=Pe(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🎨 Distribución Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"⚠️ ZONA CRÍTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mantén semi-transparente. El texto del documento se superpone aquí.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, teléfonos, emails, información de contacto.")])])])])])],-1)),Mh=Pe(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🔧 Consideraciones Técnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Posicionamiento:"),re(" La imagen se centra automáticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Transparencia:"),re(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Márgenes:"),re(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Resolución:"),re(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"⚠️"),e("span",null,[e("strong",null,"Zona crítica:"),re(" Evita elementos gráficos densos en el centro (300-400px de altura)")])])])])],-1)),Ph=Pe(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"💡 Tips de Diseño Rápido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"• Si solo tienes header, ubícalo en los primeros 120-150px"),e("div",null,"• El resto de la imagen debe ser transparente o blanco"),e("div",null,"• Para footer, usa los últimos 80-120px"),e("div",null,"• El texto se superpone en toda la imagen, mantén el centro claro")])],-1)),Lh={key:3,class:"space-y-2"},Bh={class:"flex"},Rh={class:"text-sm text-yellow-700"},zh={__name:"GlobalLetterheadModal",props:{isVisible:{type:Boolean,default:!1}},emits:["close","uploaded","deleted"],setup(a,{emit:$}){const i=a,m=$;ke(()=>i.isVisible,se=>{});const D=Ve(),_=b(!1),f=b(""),k=b(!1),y=b(!1),C=b(null),W=b(null),U=b(null),z=b([]),oe=b(null),de=b(!1),te=b(!1),S=b(null),d=b(!1),F=b(null),T=b(""),X=b(null),v=b(!1),A=b(!1),ee=b(null),Q=()=>{H(),m("close")},Y=se=>{const ce=se.target.files[0];if(!ce)return;if(!ce.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(ce.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}C.value=ce,z.value=[];const me=new FileReader;me.onload=De=>{W.value=De.target.result;const Ee=new Image;Ee.onload=()=>{J(Ee.width,Ee.height)},Ee.src=De.target.result},me.readAsDataURL(ce)},J=(se,ce)=>{const je=se/ce,c=2550/3300,n=Math.abs(je-c)/c;if(se===2550&&ce===3300){z.value.push("✅ Dimensiones perfectas: 2550 × 3300 píxeles");return}n<=.1?(z.value.push(`ℹ️ Buenas proporciones detectadas: ${se} × ${ce} píxeles (${je.toFixed(3)})`),(se!==2550||ce!==3300)&&z.value.push('💡 Para mejores resultados, usa exactamente 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI)')):(z.value.push(`⚠️ Proporciones no ideales: ${se} × ${ce} píxeles (${je.toFixed(3)})`),z.value.push(`🎯 Proporciones recomendadas: ${c.toFixed(3)} (8.5:11, tamaño carta)`),z.value.push("📐 Considera redimensionar tu imagen a 2550 × 3300 píxeles (tamaño carta)")),(se<1200||ce<1600)&&z.value.push("⚠️ Imagen muy pequeña - puede verse pixelada en documentos PDF tamaño carta"),(se>4e3||ce>5e3)&&z.value.push("ℹ️ Imagen muy grande - se redimensionará automáticamente para ajustarse al tamaño carta")},H=()=>{C.value=null,W.value=null,z.value=[],de.value=!1,oe.value&&(oe.value.value="")},K=async()=>{var se;if(C.value){k.value=!0,z.value=[];try{const ce=await D.uploadGlobalLetterheadImage(C.value);(se=ce.data)!=null&&se.warnings&&ce.data.warnings.length>0&&(z.value=ce.data.warnings),te.value=!1,await L(),H(),m("uploaded",ce.data)}catch(ce){console.error("Error uploading global letterhead:",ce),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{k.value=!1}}},L=async()=>{if(!(U.value===null&&te.value)){te.value=!0;try{const se=await D.getGlobalLetterheadImage();se.data&&(U.value=URL.createObjectURL(se.data))}catch{U.value=null}}},M=async()=>{await Yt("¿Estás seguro de que deseas eliminar la imagen de membrete global?")&&ie()},ie=async()=>{y.value=!0;try{await D.deleteGlobalLetterheadImage(),U.value&&URL.revokeObjectURL(U.value),U.value=null,te.value=!0,m("deleted")}catch(se){console.error("Error deleting global letterhead:",se),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{y.value=!1}},pe=se=>{const ce=se.target.files[0];if(ce){if(!ce.name.toLowerCase().endsWith(".docx")){alert("Solo se permiten archivos .docx para la plantilla Word");return}if(ce.size>10*1024*1024){alert("El archivo de plantilla no puede ser mayor a 10MB");return}S.value=ce}},q=()=>{S.value=null,ee.value&&(ee.value.value="")},V=async()=>{var se;if(S.value){v.value=!0;try{const me=(se=(await D.uploadGlobalLetterheadWordTemplate(S.value)).data)==null?void 0:se.template_info;d.value=!0,T.value=(me==null?void 0:me.filename)||S.value.name,X.value=(me==null?void 0:me.size_bytes)||S.value.size,await N(),q()}catch(ce){console.error("Error uploading global Word template:",ce),alert("Error al subir la plantilla Word. Por favor intenta nuevamente.")}finally{v.value=!1}}},N=async()=>{var se,ce;try{const me=await D.getGlobalLetterheadWordTemplate("blob");if(!me){d.value=!1,F.value&&URL.revokeObjectURL(F.value),F.value=null,T.value="",X.value=null;return}if(me&&me.data){d.value=!0,F.value&&URL.revokeObjectURL(F.value),F.value=URL.createObjectURL(me.data);const De=((se=me.headers)==null?void 0:se["content-disposition"])||((ce=me.headers)==null?void 0:ce["Content-Disposition"]);let Ee="plantilla_word.docx";if(De){const je=De.match(/filename="?([^";]+)"?/i);je&&je[1]&&(Ee=je[1])}T.value=Ee,X.value=me.data.size||null}}catch(me){console.error("Error loading global Word template:",me)}},G=async()=>{await Yt("¿Estás seguro de que deseas eliminar la plantilla Word de membrete global?")&&xe()},xe=async()=>{A.value=!0;try{await D.deleteGlobalLetterheadWordTemplate(),F.value&&URL.revokeObjectURL(F.value),F.value=null,T.value="",X.value=null,d.value=!1}catch(se){console.error("Error deleting global Word template:",se),alert("Error al eliminar la plantilla Word. Por favor intenta nuevamente.")}finally{A.value=!1}},we=()=>{if(F.value){const se=document.createElement("a");se.href=F.value,se.download=T.value||"membrete-word.docx",document.body.appendChild(se),se.click(),document.body.removeChild(se)}},_e=()=>{if(U.value){const se=document.createElement("a");se.href=U.value,se.download="membrete-global.png",document.body.appendChild(se),se.click(),document.body.removeChild(se)}},Ae=()=>{U.value=null},Ie=se=>{if(se===0)return"0 Bytes";const ce=1024,me=["Bytes","KB","MB","GB"],De=Math.floor(Math.log(se)/Math.log(ce));return parseFloat((se/Math.pow(ce,De)).toFixed(2))+" "+me[De]};ke(()=>i.isVisible,se=>{se&&(L(),N())});const Ne=()=>{U.value&&URL.revokeObjectURL(U.value),W.value&&URL.revokeObjectURL(W.value),F.value&&URL.revokeObjectURL(F.value)};return We(()=>{i.isVisible&&L()}),pt(Ne),(se,ce)=>Ce((s(),le(Ze,null,{default:j(()=>[e("div",Cp,[e("div",Dp,[Sp,Fp,e("button",{onClick:Q,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[r(t(Te),{class:"h-6 w-6"})])]),e("div",Ep,[_.value?(s(),o("div",Tp,[Ap,e("p",jp,g(f.value),1)])):(s(),o("div",Mp,[U.value?(s(),o("div",Pp,[Lp,e("div",Bp,[e("img",{src:U.value,alt:"Membrete de imagen para PDF actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:Ae},null,40,Rp),e("div",zp,[e("button",{onClick:_e,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[r(t(ot),{class:"h-4 w-4 mr-2"}),re(" Descargar ")]),e("button",{onClick:M,disabled:y.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[r(t(Ot),{class:"h-4 w-4 mr-2"}),re(" "+g(y.value?"Eliminando...":"Eliminar"),1)],8,Ip)])])])):(s(),o("div",Up,[r(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),Np,Op,qp])),e("div",Vp,[e("h3",Qp,g(U.value?"Reemplazar Membrete de imagen para PDF":"Subir Membrete de imagen para PDF"),1),e("div",Wp,[e("input",{ref_key:"fileInput",ref:oe,type:"file",accept:".png",onChange:Y,class:"hidden"},null,544),C.value?(s(),o("div",Yp,[e("div",Jp,[r(t(Ct),{class:"h-5 w-5 text-green-500"}),e("span",null,g(C.value.name),1),e("span",Xp,"("+g(Ie(C.value.size))+")",1)]),W.value?(s(),o("div",eh,[e("img",{src:W.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,th)])):h("",!0),e("div",sh,[e("button",{onClick:H,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:K,disabled:k.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[k.value?(s(),o("div",ah)):(s(),le(t(ts),{key:0,class:"h-4 w-4 mr-2"})),re(" "+g(k.value?"Subiendo...":"Subir Imagen para PDF"),1)],8,oh)])])):(s(),o("div",Hp,[r(t(us),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Gp,[e("button",{onClick:ce[0]||(ce[0]=me=>se.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG para PDF "),e("button",{onClick:ce[1]||(ce[1]=me=>de.value=!de.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[r(t(es),{class:"h-4 w-4 mr-2"}),re(" "+g(de.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),Zp,Kp]))])]),e("div",rh,[nh,lh,d.value?(s(),o("div",ih,[e("div",dh,[ch,e("div",uh,[e("span",mh,g(T.value||"plantilla_word.docx"),1),X.value?(s(),o("span",gh,"("+g(Ie(X.value))+")",1)):h("",!0)])]),e("div",ph,[F.value?(s(),o("button",{key:0,onClick:we,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[r(t(ot),{class:"h-4 w-4 mr-2"}),re(" Descargar ")])):h("",!0),e("button",{onClick:G,disabled:A.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[r(t(Ot),{class:"h-4 w-4 mr-2"}),re(" "+g(A.value?"Eliminando...":"Eliminar"),1)],8,hh)])])):(s(),o("div",fh," No tienes una plantilla Word configurada. Puedes subir un archivo .docx con tu membrete. ")),e("div",yh,[e("input",{ref_key:"wordTemplateInput",ref:ee,type:"file",accept:".docx",onChange:pe,class:"hidden"},null,544),S.value?(s(),o("div",_h,[e("div",wh,[r(t(Ct),{class:"h-5 w-5 text-green-500"}),e("span",null,g(S.value.name),1),e("span",$h,"("+g(Ie(S.value.size))+")",1)]),e("div",kh,[e("button",{onClick:q,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:V,disabled:v.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[v.value?(s(),o("div",Dh)):(s(),le(t(ts),{key:0,class:"h-4 w-4 mr-2"})),re(" "+g(v.value?"Subiendo...":"Subir Plantilla"),1)],8,Ch)])])):(s(),o("div",vh,[r(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",bh,[e("button",{onClick:ce[2]||(ce[2]=me=>se.$refs.wordTemplateInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Plantilla .docx (Word) ")]),xh]))])]),de.value?(s(),o("div",Sh,[e("div",Fh,[r(t(es),{class:"h-6 w-6 text-blue-600"}),Eh]),Th,Ah,jh,Mh,Ph])):h("",!0),z.value.length>0?(s(),o("div",Lh,[(s(!0),o(ge,null,fe(z.value,(me,De)=>(s(),o("div",{key:De,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",Bh,[r(t(Bs),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",Rh,g(me),1)])]))),128))])):h("",!0)]))])])]),_:1},512)),[[ht,a.isVisible]])}},Ih=Tt(zh,[["__scopeId","data-v-857c746d"]]),Uh={class:"min-h-screen bg-gray-50"},Nh={class:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8"},Oh={class:"p-4 sm:p-6 lg:p-8"},qh={key:0},Vh={key:0},Qh={key:1},Wh={class:"mb-6 border-b border-gray-200 pb-4"},Hh={class:"hidden md:block"},Gh={class:"flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8 mb-4","aria-label":"Tabs"},Zh=["onClick"],Kh={class:"flex gap-3"},Yh=["disabled"],Jh=e("span",null,"Firma Electrónica",-1),Xh=e("span",null,"Membrete Global",-1),ef=e("span",null,"Nueva Minuta",-1),tf=e("span",null,"Nuevo Documento",-1),sf={class:"md:hidden space-y-3 relative"},of=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),af=[of],rf={key:0,class:"absolute z-20 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden w-full"},nf=["onClick"],lf=["disabled"],df=e("span",{class:"font-medium text-xs leading-tight"},"Firma",-1),cf=e("span",{class:"font-medium text-xs leading-tight"},"Membrete",-1),uf=e("span",{class:"font-medium text-xs leading-tight"},"Nueva Minuta",-1),mf=e("span",{class:"font-medium text-xs leading-tight"},"Nuevo Doc.",-1),gf={key:0},pf={key:1},hf={key:2},ff={key:3},yf={key:4},vf={key:5},bf={key:6},xf={key:7},_f={key:8,class:"mt-6 text-center text-gray-400 font-regular"},wf=e("p",null,"No hay documentos disponibles para mostrar.",-1),$f=[wf],kf={key:1},Cf={class:"mb-6 border-b border-gray-200"},Df={class:"hidden md:flex md:flex-col"},Sf={class:"-mb-px flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},Ff=["onClick"],Ef={class:"flex flex-wrap items-center gap-2 mt-3 mb-4 md:justify-end"},Tf={class:"relative"},Af={class:"relative group"},jf=["disabled"],Mf={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},Pf=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),Lf={class:"md:hidden relative"},Bf=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),Rf=[Bf],zf={key:0,class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},If=["onClick"],Uf={class:"md:hidden mt-4 mb-4 flex flex-col gap-2"},Nf={class:"relative"},Of={class:"relative group"},qf=["disabled"],Vf={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},Qf=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),Wf={key:0},Hf={key:1},Gf={class:"p-4 sm:p-6"},Zf={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},Kf={class:"flex justify-between items-center p-4 border-b"},Yf=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),Jf={class:"p-4 sm:p-6"},Xf={class:"p-4 sm:p-6"},ey={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},ty={class:"flex justify-between items-center p-4 border-b"},sy=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),oy={class:"p-4 sm:p-6"},My={__name:"Dashboard",setup(a){const $=Ke(),i=Ve(),m=Gt(),D=et(),_=Cs(),{isBasicUser:f,handleFeatureAccess:k}=ps(),y=b(""),C=b("default"),W=b(!1),U=b("folders"),z=b("legal-documents"),oe=b(!1),de=b(!1),te=b(!1),S=b(!1),d=b(!1),F=b(null),T=b([]),X=b("recent");ke(z,(c,n)=>{},{immediate:!0}),B(()=>[]),B(()=>X.value==="recent"?"Más recientes":"Nombre (A-Z)");const v=B(()=>$.currentUser),A=B(()=>v.value?v.value.role:(D.push("/login"),null)),ee=B(()=>{let c=[];A.value==="lawyer"?c=i.draftAndPublishedDocumentsUnassigned:(A.value==="client"||A.value==="basic"||A.value==="corporate_client")&&(c=i.progressAndCompletedDocumentsByClient(v.value.id));const n=T.value&&Array.isArray(T.value)?T.value.map(l=>l.id):[];return i.filteredDocumentsBySearchAndTags(y.value,$,n).filter(l=>c.some(R=>R.id===l.id))}),Q=async c=>{C.value=c,i.selectedDocument=null;try{await i.init(!0)}catch(n){console.error("Error loading documents for useDocument section:",n)}},Y=()=>{W.value=!1,C.value="default",i.selectedDocument=null},J=async()=>{await i.init(!0)},H=()=>{if(!v.value){console.error("Cannot open signature modal: currentUser is not loaded");return}de.value=!0},K=()=>{if(!v.value){console.error("Cannot open signature modal: currentUser is not loaded");return}oe.value=!0},L=()=>{if(!v.value){console.error("Cannot open signature modal: currentUser is not loaded");return}oe.value=!0},M=async c=>{z.value="signed-documents"},ie=async c=>{U.value="signed-documents"},pe=async c=>{try{c&&c.id?await i.fetchDocumentById(c.id,!0):await i.init(!0)}catch(n){console.error("Error refreshing rejected document for lawyer:",n)}z.value="archived-documents"},q=async c=>{try{c&&c.id?await i.fetchDocumentById(c.id,!0):await i.init(!0)}catch(n){console.error("Error refreshing rejected document for client:",n)}U.value="archived-documents"},V=()=>{i.selectedDocument=null,W.value=!0},N=()=>{Q("useDocument")},G=c=>{const{tab:n,searchQuery:l}=c;z.value=n,y.value=l,setTimeout(()=>{},100)},xe=()=>{if(!v.value){console.error("Cannot open letterhead modal: currentUser is not loaded");return}k("Membrete Global",()=>{te.value=!0})},we=c=>{$e("Membrete global subido correctamente","success")},_e=()=>{$e("Membrete global eliminado correctamente","success")},Ae=async()=>{if(C.value==="useDocument"){C.value="default",A.value==="lawyer"?z.value="my-documents":U.value="my-documents";return}A.value==="lawyer"?z.value="folders":U.value="folders";try{await new Promise(c=>setTimeout(c,100)),await m.fetchFolders(!0)}catch{}};ke(()=>i.lastUpdatedDocumentId,(c,n)=>{if(c&&c!==n&&C.value==="default"){const l=Date.now();(!ke.lastExecutionTime||l-ke.lastExecutionTime>100)&&(ke.lastExecutionTime=l,C.value="default")}},{immediate:!1}),ke(S,c=>{}),ke(d,c=>{}),ke(F,c=>{}),ke(()=>_.path,(c,n)=>{c==="/dynamic_document_dashboard"&&n&&n.includes("/document/use/")&&i.init()}),ke(()=>_.query,c=>{c.lawyerTab&&(z.value=c.lawyerTab),c.tab&&(U.value=c.tab)},{immediate:!0});const Ie=[{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"archived-documents",label:"Dcs. Archivados"}],Ne=[{name:"legal-documents",label:"Minutas"},{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"archived-documents",label:"Dcs. Archivados"},{name:"finished-documents",label:"Dcs. Clientes"},{name:"in-progress-documents",label:"Dcs. Clientes en Progreso"}],se=b(!1),ce=b(!1),me=()=>{se.value=!1,ce.value=!1},De=c=>{y.value="",z.value=c,se.value=!1,me()},Ee=c=>{C.value="default",y.value="",U.value=c,ce.value=!1,me()};We(async()=>{try{await Promise.all([$.init(),i.init(),m.init()])}catch(n){console.error("Error initializing dynamic document dashboard:",n)}i.selectedDocument=null,C.value="default";const c=localStorage.getItem("lastUpdatedDocumentId");c&&i.documents.some(l=>l.id.toString()===c)&&(i.lastUpdatedDocumentId=parseInt(c))});const je=async c=>{$.currentUser&&($.currentUser.has_signature=!0),$e("Firma electrónica guardada correctamente","success"),setTimeout(()=>{de.value=!1,oe.value=!1},500)};return(c,n)=>{var l,R;return s(),o(ge,null,[e("div",Uh,[e("div",Nh,[ns(c.$slots,"default")]),e("div",Oh,[A.value==="lawyer"?(s(),o("div",qh,[C.value==="useDocument"?(s(),o("div",Vh,[r(as,{searchQuery:y.value,selectedTags:T.value,onGoBack:Ae},null,8,["searchQuery","selectedTags"])])):(s(),o("div",Qh,[e("div",Wh,[e("div",Hh,[e("nav",Gh,[(s(),o(ge,null,fe(Ne,O=>e("button",{key:O.name,onClick:he(ne=>De(O.name),["stop"]),class:P([z.value===O.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},g(O.label),11,Zh)),64))]),e("div",Kh,[e("button",{onClick:he(H,["stop"]),disabled:!v.value,class:P(["inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-purple-200 text-sm font-medium transition-all duration-200",v.value?"bg-white text-gray-700 hover:bg-purple-50 hover:border-purple-300":"bg-gray-50 text-gray-400 cursor-not-allowed opacity-60"])},[r(t(wt),{class:"size-5 text-purple-500"}),Jh],10,Yh),e("button",{onClick:n[0]||(n[0]=he(O=>te.value=!0,["stop"])),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-green-200 bg-white text-sm font-medium text-gray-700 hover:bg-green-50 hover:border-green-300 transition-all duration-200"},[r(t(Oe),{class:"size-5 text-green-500"}),Xh]),z.value==="legal-documents"?(s(),o("button",{key:0,onClick:he(V,["stop"]),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-secondary bg-secondary text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200"},[r(t(He),{class:"size-5"}),ef])):h("",!0),z.value==="my-documents"?(s(),o("button",{key:1,onClick:he(N,["stop"]),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-secondary bg-secondary text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200"},[r(t(He),{class:"size-5"}),tf])):h("",!0)])]),e("div",sf,[e("button",{onClick:n[1]||(n[1]=he(O=>se.value=!se.value,["stop"])),class:"dropdown-button w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,g(((l=Ne.find(O=>O.name===z.value))==null?void 0:l.label)||"Seleccionar sección"),1),(s(),o("svg",{class:P(["ml-2 h-5 w-5 transition-transform duration-200",se.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},af,2))]),se.value?(s(),o("div",rf,[(s(),o(ge,null,fe(Ne,O=>e("button",{key:O.name,onClick:he(ne=>De(O.name),["stop"]),class:P(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",z.value===O.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},g(O.label),11,nf)),64))])):h("",!0),e("div",{class:P(["grid gap-2",z.value==="legal-documents"||z.value==="my-documents"?"grid-cols-3":"grid-cols-2"])},[e("button",{onClick:he(H,["stop"]),disabled:!v.value,class:P(["flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-purple-200 text-center transition-all duration-200",v.value?"bg-white hover:bg-purple-50":"bg-gray-50 cursor-not-allowed opacity-60"])},[r(t(wt),{class:"size-6 text-purple-500 mb-1"}),df],10,lf),e("button",{onClick:n[2]||(n[2]=he(O=>te.value=!0,["stop"])),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-green-200 bg-white text-center transition-all duration-200 hover:bg-green-50"},[r(t(Oe),{class:"size-6 text-green-500 mb-1"}),cf]),z.value==="legal-documents"?(s(),o("button",{key:0,onClick:he(V,["stop"]),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-secondary bg-secondary text-white text-center transition-all duration-200 hover:bg-blue-700"},[r(t(He),{class:"size-6 mb-1"}),uf])):h("",!0),z.value==="my-documents"?(s(),o("button",{key:1,onClick:he(N,["stop"]),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-secondary bg-secondary text-white text-center transition-all duration-200 hover:bg-blue-700"},[r(t(He),{class:"size-6 mb-1"}),mf])):h("",!0)],2)])]),z.value==="legal-documents"?(s(),o("div",gf,[r(Ut,{searchQuery:y.value,"onUpdate:searchQuery":n[3]||(n[3]=O=>y.value=O),selectedTags:T.value,"is-loading":t(i).isLoading,"card-type":"lawyer","show-state-filter":!0,"show-client-filter":!0,"show-associations-column":!0,context:"legal-documents",onRefresh:J},null,8,["searchQuery","selectedTags","is-loading"])])):h("",!0),z.value==="my-documents"?(s(),o("div",pf,[r(Ut,{searchQuery:y.value,"onUpdate:searchQuery":n[4]||(n[4]=O=>y.value=O),selectedTags:T.value,"is-loading":t(i).isLoading,"card-type":"client","show-state-filter":!0,"show-client-filter":!1,"show-associations-column":!0,context:"my-documents",onRefresh:J},null,8,["searchQuery","selectedTags","is-loading"])])):h("",!0),z.value==="folders"?(s(),o("div",hf,[r(os,{searchQuery:y.value,selectedTags:T.value,onRefresh:J,onNavigateToMain:Ae,onNavigateToDocument:G},null,8,["searchQuery","selectedTags"])])):h("",!0),z.value==="pending-signatures"?(s(),o("div",ff,[r(nt,{state:"PendingSignatures",searchQuery:y.value,selectedTags:T.value,onRefresh:J,onOpenElectronicSignature:H,onDocumentFullySigned:M,onDocumentRejected:pe},null,8,["searchQuery","selectedTags"])])):h("",!0),z.value==="signed-documents"?(s(),o("div",yf,[r(nt,{state:"FullySigned",searchQuery:y.value,selectedTags:T.value,onRefresh:J,onOpenElectronicSignature:H},null,8,["searchQuery","selectedTags"])])):h("",!0),z.value==="archived-documents"?(s(),o("div",vf,[r(nt,{state:"Archived",searchQuery:y.value,selectedTags:T.value,onRefresh:J,onOpenElectronicSignature:H},null,8,["searchQuery","selectedTags"])])):h("",!0),z.value==="finished-documents"?(s(),o("div",bf,[r(au,{searchQuery:y.value,selectedTags:T.value},null,8,["searchQuery","selectedTags"])])):h("",!0),z.value==="in-progress-documents"?(s(),o("div",xf,[r(_m,{searchQuery:y.value,selectedTags:T.value},null,8,["searchQuery","selectedTags"])])):h("",!0),ee.value.length===0?(s(),o("div",_f,$f)):h("",!0)]))])):h("",!0),A.value==="client"||A.value==="basic"||A.value==="corporate_client"?(s(),o("div",kf,[e("div",Cf,[e("div",Df,[e("nav",Sf,[(s(),o(ge,null,fe(Ie,O=>e("button",{key:O.name,onClick:he(ne=>Ee(O.name),["stop"]),class:P([U.value===O.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},g(O.label),11,Ff)),64))]),e("div",Ef,[e("div",Tf,[e("button",{onClick:he(K,["stop"]),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border text-purple-600 hover:bg-purple-50 border-purple-200"},[r(t(wt),{class:"h-4 w-4"}),re(" Firma Electrónica ")])]),e("div",Af,[e("button",{onClick:he(xe,["stop"]),disabled:t(f),class:P(["inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border",t(f)?"text-green-400 bg-gray-50 border-gray-200 cursor-not-allowed opacity-60":"text-green-600 hover:bg-green-50 border-green-200"])},[r(t(Oe),{class:"h-4 w-4"}),re(" Membrete Global ")],10,jf),t(f)?(s(),o("div",Mf,[re(" Actualiza tu suscripción para usar esta funcionalidad "),Pf])):h("",!0)]),e("button",{onClick:n[5]||(n[5]=he(O=>Q("useDocument"),["stop"])),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[r(t(He),{class:"h-4 w-4"}),re(" Nuevo Documento ")])])]),e("div",Lf,[e("button",{onClick:n[6]||(n[6]=he(O=>ce.value=!ce.value,["stop"])),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,g(((R=Ie.find(O=>O.name===U.value))==null?void 0:R.label)||"Seleccionar sección"),1),(s(),o("svg",{class:P(["ml-2 h-5 w-5 transition-transform duration-200",ce.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Rf,2))]),ce.value?(s(),o("div",zf,[(s(),o(ge,null,fe(Ie,O=>e("button",{key:O.name,onClick:he(ne=>Ee(O.name),["stop"]),class:P(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",U.value===O.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},g(O.label),11,If)),64))])):h("",!0)]),e("div",Uf,[e("div",Nf,[e("button",{onClick:he(K,["stop"]),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-purple-600 bg-purple-50 hover:bg-purple-100"},[r(t(wt),{class:"h-5 w-5"}),re(" Firma Electrónica ")])]),e("div",Of,[e("button",{onClick:he(xe,["stop"]),disabled:t(f),class:P(["w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors",t(f)?"text-green-400 bg-gray-50 cursor-not-allowed opacity-60":"text-green-600 bg-green-50 hover:bg-green-100"])},[r(t(Oe),{class:"h-5 w-5"}),re(" Membrete Global ")],10,qf),t(f)?(s(),o("div",Vf,[re(" Actualiza tu suscripción para usar esta funcionalidad "),Qf])):h("",!0)]),e("button",{onClick:n[7]||(n[7]=he(O=>Q("useDocument"),["stop"])),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[r(t(He),{class:"h-5 w-5"}),re(" Nuevo Documento ")])])]),C.value==="useDocument"?(s(),o("div",Wf,[r(as,{searchQuery:y.value,selectedTags:T.value,onGoBack:Ae},null,8,["searchQuery","selectedTags"])])):(s(),o("div",Hf,[U.value==="folders"?(s(),le(os,{key:0,searchQuery:y.value,selectedTags:T.value,onRefresh:J,onNavigateToMain:Ae},null,8,["searchQuery","selectedTags"])):U.value==="my-documents"?(s(),le(Ut,{key:1,searchQuery:y.value,"onUpdate:searchQuery":n[8]||(n[8]=O=>y.value=O),selectedTags:T.value,"is-loading":t(i).isLoading,"card-type":"client","show-state-filter":!0,"show-client-filter":!1,"show-associations-column":!0,context:"my-documents",onRefresh:J},null,8,["searchQuery","selectedTags","is-loading"])):U.value==="pending-signatures"?(s(),le(nt,{key:2,state:"PendingSignatures",searchQuery:y.value,selectedTags:T.value,onRefresh:J,onOpenElectronicSignature:L,onDocumentFullySigned:ie,onDocumentRejected:q},null,8,["searchQuery","selectedTags"])):U.value==="signed-documents"?(s(),le(nt,{key:3,state:"FullySigned",searchQuery:y.value,selectedTags:T.value,onRefresh:J,onOpenElectronicSignature:L},null,8,["searchQuery","selectedTags"])):U.value==="archived-documents"?(s(),le(nt,{key:4,state:"Archived",searchQuery:y.value,selectedTags:T.value,onRefresh:J,onOpenElectronicSignature:L},null,8,["searchQuery","selectedTags"])):h("",!0)]))])):h("",!0)])]),W.value?(s(),le(Ze,{key:0},{default:j(()=>[r(kp,{onClose:Y})]),_:1})):h("",!0),de.value&&v.value?(s(),le(Ze,{key:1},{default:j(()=>[e("div",Gf,[e("div",Zf,[e("div",Kf,[Yf,e("button",{onClick:n[9]||(n[9]=O=>de.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[r(t(Te),{class:"h-6 w-6"})])]),e("div",Jf,[r(Kt,{"user-id":v.value.id,"initial-show-options":!v.value.has_signature,onSignatureSaved:je,onCancel:n[10]||(n[10]=O=>de.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):h("",!0),oe.value&&v.value?(s(),le(Ze,{key:2},{default:j(()=>[e("div",Xf,[e("div",ey,[e("div",ty,[sy,e("button",{onClick:n[11]||(n[11]=O=>oe.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[r(t(Te),{class:"h-6 w-6"})])]),e("div",oy,[r(Kt,{"user-id":v.value.id,"initial-show-options":!v.value.has_signature,onSignatureSaved:je,onCancel:n[12]||(n[12]=O=>oe.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):h("",!0),r(Qt,{isVisible:t(tt),documentData:t(Vt),onClose:n[13]||(n[13]=O=>tt.value=!1)},null,8,["isVisible","documentData"]),r(Ih,{isVisible:te.value,onClose:n[14]||(n[14]=O=>te.value=!1),onUploaded:we,onDeleted:_e},null,8,["isVisible"])],64)}}};export{My as default};
