import{e as s,f as o,g as e,u as et,r as _,aL as rs,o as Qe,at as pt,c as B,h as r,j as t,B as Ee,w as ke,v as Fe,n as M,l as f,t as p,m as pe,p as re,s as we,b6 as hs,i as A,ae as Ve,ac as ns,b7 as fs,U as ht,k as ne,a5 as Ge,F as ge,D as Zt,E as ls,G as ys,a3 as vs,C as bs,W as $e,J as he,I as Ze,a4 as Ne,ai as Le,af as Be,ag as Re,ah as fe,b8 as xs,Q as Ct,T as Dt,a8 as _s,aj as ot,aZ as ws,ak as Ft,an as qt,ao as $s,ap as ks,H as Cs,b9 as _t,ba as Jt}from"./index.js";import{u as qe,o as Ds,s as tt,p as Vt}from"./index2.js";import{g as mt,a as gt}from"./DocumentPermissionsManager.js";import{r as Fs,_ as Qt,a as St}from"./DocumentRelationshipsModal.js";import{_ as Et}from"./_plugin-vue_export-helper.js";import{B as Ss,r as Es,a as Tt,b as At,_ as Wt,c as Ht,D as is,d as Ts,L as jt,s as Kt}from"./index3.js";import{r as $t}from"./FolderIcon.js";import{r as We}from"./PlusIcon.js";import{r as it}from"./EllipsisVerticalIcon.js";import{r as at}from"./DocumentIcon.js";import{_ as As}from"./DocumentCard.js";import{r as ds}from"./EyeIcon.js";import{r as ft}from"./ChevronRightIcon.js";import{_ as Yt}from"./SignatureDocumentCard.js";import{r as Nt,a as js,b as Ms}from"./TagIcon.js";import{r as Oe}from"./ChevronDownIcon.js";import{r as He}from"./MagnifyingGlassIcon.js";import{r as kt}from"./CheckCircleIcon.js";import{r as Xt}from"./PencilIcon.js";import{r as Ot}from"./TrashIcon.js";import{a as cs,r as es}from"./LinkIcon.js";import{r as us}from"./PhotoIcon.js";import{r as st,a as Ps}from"./FunnelIcon.js";import{r as Ls}from"./ArrowLeftIcon.js";import{r as Mt}from"./CubeTransparentIcon.js";import{r as ts}from"./CloudArrowUpIcon.js";import{r as Bs}from"./ExclamationTriangleIcon.js";import"./useRecentViews.js";import"./loading_message.js";function ss(a,$){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})])}function Rs(a,$){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})])}function zs(a,$){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})])}function Is(a,$){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const Us={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Ns={class:"flex justify-end"},Os=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[re(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),qs={class:"mt-2"},Vs={class:"flex gap-2 mt-2.5"},Qs=["disabled"],Ws=e("span",null,"Actualizar nombre",-1),Hs=[Ws],Gs=["disabled"],ms={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(a,{emit:$}){const i=a,u=et(),C=qe(),x=$,y=_(""),S=_(""),v=()=>{x("close")};rs(()=>{var ae,F;C.selectedDocument?(y.value=((ae=C.selectedDocument)==null?void 0:ae.title)||"",S.value=((F=C.selectedDocument)==null?void 0:F.title)||""):(y.value="",S.value="")});const k=ae=>{ae.key==="Escape"&&v()};Qe(()=>{document.addEventListener("keydown",k)}),pt(()=>{document.removeEventListener("keydown",k)});const Z=B(()=>y.value.trim().length>0),q=B(()=>{var ae;return!!((ae=C.selectedDocument)!=null&&ae.id)}),z=B(()=>q.value&&y.value.trim()!==S.value.trim()&&y.value.trim().length>0);async function oe(){if(q.value&&z.value)try{const ae={title:y.value.trim()};await C.updateDocument(C.selectedDocument.id,ae),S.value=y.value.trim(),C.selectedDocument.title=y.value.trim();const F=C.selectedDocument.id;we("Document name successfully updated.","success"),x("close",{updatedDocId:F});const T=window.location.pathname;T==="/dynamic_document_dashboard"||T==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(ae){console.error("Error updating document name:",ae),we("Error updating document name.","error")}}function le(){const ae=encodeURIComponent(y.value.trim());i.documentId&&!C.selectedDocument?u.push(`/dynamic_document_dashboard/document/use/creator/${i.documentId}/${ae}`):C.selectedDocument?(C.selectedDocument.title=y.value.trim(),u.push(`/dynamic_document_dashboard/document/use/editor/${C.selectedDocument.id}/${ae}`)):we("Error: No se pudo continuar. Documento no seleccionado.","error")}return(ae,F)=>(s(),o("div",Us,[e("div",Ns,[e("button",{onClick:v},[r(t(Ee),{class:"size-6"})])]),e("form",{onSubmit:pe(le,["prevent"])},[e("div",null,[Os,e("div",qs,[ke(e("input",{"onUpdate:modelValue":F[0]||(F[0]=d=>y.value=d),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[Fe,y.value]])])]),e("div",Vs,[q.value?(s(),o("button",{key:0,type:"button",onClick:oe,disabled:!z.value,class:M(["p-2.5 text-sm font-medium rounded-md flex gap-2",z.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Hs,10,Qs)):f("",!0),e("button",{type:"submit",class:M(["p-2.5 text-sm font-medium rounded-md flex gap-2",Z.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!Z.value},[e("span",null,p(q.value?"Editar Documento":"Continuar"),1)],10,Gs)])],32)]))}},Zs={class:"mt-3 pt-2 border-t border-gray-100"},Js={class:"flex items-center gap-2 text-xs text-gray-500"},Ks=e("span",null,"Hacer clic para usar este documento",-1),Ys={__name:"UseDocumentCard",props:{document:{type:Object,required:!0},showTags:{type:Boolean,default:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null},additionalClasses:{type:String,default:""}},emits:["click","remove-from-folder","document-created"],setup(a,{emit:$}){const i=a,u=$,C=_(!1),x=_(null),y=mt(9),S=B(()=>"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium !bg-purple-100 !text-purple-700 !border !border-purple-200"),v=B(()=>y.dark),k=B(()=>{const F="group !border-purple-400 !bg-purple-50/50 !shadow-purple-100";return i.additionalClasses?`${F} ${i.additionalClasses}`:F}),Z=B(()=>i.menuOptions!==null?i.menuOptions:[{label:"Usar",action:"use",icon:Rs,iconClasses:"w-4 h-4 text-purple-600"},{label:"Previsualización",action:"preview",icon:ds,iconClasses:"w-4 h-4 text-gray-600"}]),q=B(()=>!1),z=(F,d)=>{i.disableInternalActions?u("click",F,d):le(F.id)},oe=(F,d)=>{switch(F){case"use":le(d.id);break;case"preview":Ds(d);break;default:console.warn("Unknown menu action:",F)}};function le(F){F?(x.value=F,C.value=!0):console.error("Document ID is required:",F)}function ae(F){if(C.value=!1,x.value=null,F&&F.updatedDocId){u("document-created",F);const d=window.location.pathname;d==="/dynamic_document_dashboard"||d==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(F.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}}return(F,d)=>(s(),o(ge,null,[r(Ss,{document:a.document,"card-type":a.cardType,"card-context":a.cardContext,"status-icon":t(fs),"status-text":"Disponible","status-badge-classes":S.value,"menu-options":Z.value,"highlighted-doc-id":null,"show-tags":a.showTags,"document-store":a.documentStore,"user-store":a.userStore,"additional-classes":k.value,"disable-internal-actions":a.disableInternalActions,"show-menu-options":a.showMenuOptions,onClick:z,onMenuAction:oe,onRemoveFromFolder:d[0]||(d[0]=T=>F.$emit("remove-from-folder",T))},hs({"additional-actions":A(()=>[ns(F.$slots,"additional-actions")]),_:2},[q.value?{name:"right-action",fn:A(()=>[r(t(ft),{class:"w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors"})]),key:"0"}:void 0,a.disableInternalActions?void 0:{name:"footer",fn:A(()=>[e("div",Zs,[e("div",Js,[e("div",{class:"w-2 h-2 rounded-full",style:Ve({backgroundColor:v.value})},null,4),Ks])])]),key:"1"}]),1032,["document","card-type","card-context","status-icon","status-badge-classes","menu-options","show-tags","document-store","user-store","additional-classes","disable-internal-actions","show-menu-options"]),ke(r(Ge,null,{default:A(()=>[x.value!==null?(s(),ne(ms,{key:0,"document-id":x.value,onClose:ae},null,8,["document-id"])):f("",!0)]),_:1},512),[[ht,C.value]])],64))}},Xs=()=>({folders:[],currentFolder:null,isLoading:!1,error:null,lastUpdatedFolderId:null}),eo={sortedFolders:a=>[...a.folders].sort(($,i)=>new Date(i.created_at)-new Date($.created_at)),getFolderById:a=>$=>a.folders.find(i=>i.id===$),getFoldersByColor:a=>$=>a.folders.filter(i=>i.color_id===$),getFolderWithColor:a=>$=>{const i=a.folders.find(u=>u.id===$);return i?{...i,color:mt(i.color_id)}:null},getFoldersContainingDocument:a=>$=>a.folders.filter(i=>i.document_ids&&i.document_ids.includes($)),totalDocumentsInFolders:a=>a.folders.reduce(($,i)=>$+(i.document_ids?i.document_ids.length:0),0),hasFolders:a=>a.folders.length>0,availableColors:()=>gt()},to={async init(a=!1){if(!(this.folders.length>0&&!a)){this.isLoading=!0,this.error=null;try{await this.fetchFolders()}catch($){console.error("Error initializing document folder store:",$),this.error="Error al inicializar las carpetas"}finally{this.isLoading=!1}}},async fetchFolders(){try{const a=await Zt("dynamic-documents/folders/");if(a.status===200)return this.folders=a.data,a.data;throw new Error(`Error fetching folders: ${a.status}`)}catch(a){throw console.error("Error fetching folders:",a),this.error="Error al obtener las carpetas",a}},async fetchFolder(a){this.isLoading=!0,this.error=null;try{const $=await Zt(`dynamic-documents/folders/${a}/`);if($.status===200){const i=$.data,u=this.folders.findIndex(C=>C.id===i.id);return u!==-1?this.folders[u]=i:this.folders.push(i),this.currentFolder=i,i}else throw new Error(`Error fetching folder: ${$.status}`)}catch($){throw console.error("Error fetching folder:",$),this.error="Error al obtener la carpeta",$}finally{this.isLoading=!1}},async createFolder(a){this.isLoading=!0,this.error=null;try{if(!a.name||a.name.trim()==="")throw new Error("El nombre de la carpeta es requerido");const $=a.color_id??0;if($<0||$>=gt().length)throw new Error("Color de carpeta no válido");const i={name:a.name.trim(),color_id:$,...a.document_ids&&{document_ids:a.document_ids}},u=await ls("dynamic-documents/folders/create/",i);if(u.status===200||u.status===201){const C=u.data;return this.folders.push(C),this.lastUpdatedFolderId=C.id,we("Carpeta creada exitosamente","success"),C}else throw new Error(`Error creating folder: ${u.status}`)}catch($){throw console.error("Error creating folder:",$),this.error=$.message||"Error al crear la carpeta",we(this.error,"error"),$}finally{this.isLoading=!1}},async updateFolder(a,$){this.isLoading=!0,this.error=null;try{if($.name&&$.name.trim()==="")throw new Error("El nombre de la carpeta no puede estar vacío");if($.color_id!==void 0){const C=$.color_id;if(C<0||C>=gt().length)throw new Error("Color de carpeta no válido")}const i={};$.name&&(i.name=$.name.trim()),$.color_id!==void 0&&(i.color_id=$.color_id),$.document_ids!==void 0&&(i.document_ids=$.document_ids);const u=await ys(`dynamic-documents/folders/${a}/update/`,i);if(u.status===200){const C=u.data,x=this.folders.findIndex(y=>y.id===a);return x!==-1&&(this.folders[x]=C),this.currentFolder&&this.currentFolder.id===a&&(this.currentFolder=C),this.lastUpdatedFolderId=a,we("Carpeta actualizada exitosamente","success"),C}else throw new Error(`Error updating folder: ${u.status}`)}catch(i){throw console.error("Error updating folder:",i),this.error=i.message||"Error al actualizar la carpeta",we(this.error,"error"),i}finally{this.isLoading=!1}},async deleteFolder(a){this.isLoading=!0,this.error=null;try{const $=await vs(`dynamic-documents/folders/${a}/delete/`);if($.status===204||$.status===200)return this.folders=this.folders.filter(i=>i.id!==a),this.currentFolder&&this.currentFolder.id===a&&(this.currentFolder=null),await we("Carpeta eliminada exitosamente","success"),!0;throw new Error(`Error deleting folder: ${$.status}`)}catch($){throw console.error("Error deleting folder:",$),this.error=$.message||"Error al eliminar la carpeta",await we(this.error,"error"),$}finally{this.isLoading=!1}},setCurrentFolder(a){this.currentFolder=a},clearCurrentFolder(){this.currentFolder=null},reset(){this.folders=[],this.currentFolder=null,this.isLoading=!1,this.error=null,this.lastUpdatedFolderId=null}},so={async addDocumentsToFolder(a,$){const i=this.getFolderById(a);if(!i)throw new Error("Carpeta no encontrada");const u=i.document_ids||[],C=[...new Set([...u,...$])];return await this.updateFolder(a,{document_ids:C})},async removeDocumentsFromFolder(a,$){const i=this.getFolderById(a);if(!i)throw new Error("Carpeta no encontrada");const C=(i.document_ids||[]).filter(x=>!$.includes(x));return await this.updateFolder(a,{document_ids:C})},async moveDocumentsBetweenFolders(a,$,i){try{$&&await this.removeDocumentsFromFolder($,a),i&&await this.addDocumentsToFolder(i,a),await we("Documentos movidos exitosamente","success")}catch(u){throw console.error("Error moving documents between folders:",u),await we("Error al mover documentos","error"),u}},getFolderColor(a){const $=this.getFolderById(a);return $?mt($.color_id):mt(0)},validateFolderData(a){const $=[];if((!a.name||a.name.trim()==="")&&$.push("El nombre de la carpeta es requerido"),a.name&&a.name.length>100&&$.push("El nombre de la carpeta no puede exceder 100 caracteres"),a.color_id!==void 0){const i=a.color_id;(i<0||i>=gt().length)&&$.push("Color de carpeta no válido")}return a.document_ids&&!Array.isArray(a.document_ids)&&$.push("Los IDs de documentos deben ser un array"),{isValid:$.length===0,errors:$}}},Gt=bs("documentFolder",{state:Xs,getters:eo,actions:{...to,...so}}),oo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ao={class:"bg-white rounded-xl shadow-xl max-w-md w-full"},ro={class:"flex justify-between items-center p-6 border-b"},no={class:"text-lg font-semibold text-gray-900"},lo={class:"mb-4"},io=e("label",{for:"folderName",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la carpeta ",-1),co={class:"mb-6"},uo=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Color de la carpeta ",-1),mo={class:"grid grid-cols-8 gap-2"},go=["onClick","title"],po={class:"flex gap-3"},ho=["disabled"],fo={__name:"CreateEditFolderModal",props:{isVisible:{type:Boolean,required:!0},editingFolder:{type:Object,default:null}},emits:["close","success"],setup(a,{emit:$}){const i=a,u=$,C=Gt(),x=_(!1),y=_({name:"",color_id:0}),S=B(()=>gt()),v=()=>{y.value={name:"",color_id:0}};$e(()=>i.editingFolder,q=>{q?y.value={name:q.name,color_id:q.color_id}:v()},{immediate:!0}),$e(()=>i.isVisible,q=>{q||v()});const k=()=>{u("close")},Z=async()=>{if(y.value.name.trim()){x.value=!0;try{i.editingFolder?await C.updateFolder(i.editingFolder.id,y.value):await C.createFolder(y.value),x.value=!1,u("success")}catch{x.value=!1}}};return(q,z)=>a.isVisible?(s(),ne(Ge,{key:0},{default:A(()=>[e("div",oo,[e("div",ao,[e("div",ro,[e("h3",no,p(a.editingFolder?"Editar Carpeta":"Nueva Carpeta"),1),e("button",{onClick:k,class:"text-gray-400 hover:text-gray-500"},[r(t(Ee),{class:"w-6 h-6"})])]),e("form",{onSubmit:pe(Z,["prevent"]),class:"p-6"},[e("div",lo,[io,ke(e("input",{id:"folderName","onUpdate:modelValue":z[0]||(z[0]=oe=>y.value.name=oe),type:"text",required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ej: Contratos Laborales"},null,512),[[Fe,y.value.name]])]),e("div",co,[uo,e("div",mo,[(s(!0),o(ge,null,he(S.value,oe=>(s(),o("button",{key:oe.id,type:"button",onClick:le=>y.value.color_id=oe.id,class:M(["w-8 h-8 rounded-full border-2 transition-all",y.value.color_id===oe.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"]),style:Ve({backgroundColor:oe.hex}),title:oe.name},null,14,go))),128))])]),e("div",po,[e("button",{type:"button",onClick:k,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:!y.value.name.trim()||x.value,class:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},p(x.value?"Guardando...":a.editingFolder?"Actualizar":"Crear"),9,ho)])],32)])])]),_:1})):f("",!0)}},yo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},vo={class:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col"},bo={class:"border-b px-6 py-4 flex-shrink-0"},xo={class:"flex justify-between items-center"},_o={class:"flex items-center gap-3"},wo={class:"text-xl font-semibold text-gray-900"},$o={class:"text-sm text-gray-600"},ko={class:"flex items-center gap-2"},Co={class:"flex-1 overflow-y-auto p-6"},Do={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},Fo={class:"min-w-full divide-y divide-gray-200"},So=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tipo "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),Eo={class:"bg-white divide-y divide-gray-200"},To=["onClick"],Ao={class:"px-6 py-4 whitespace-nowrap"},jo={class:"flex items-center"},Mo={class:"flex-shrink-0 h-10 w-10"},Po={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Lo={class:"ml-4"},Bo={class:"text-sm font-medium text-gray-900"},Ro={class:"px-6 py-4 whitespace-nowrap"},zo={class:"text-sm text-gray-600"},Io={class:"px-6 py-4 whitespace-nowrap"},Uo={class:"px-6 py-4 whitespace-nowrap"},No={class:"flex flex-wrap gap-1"},Oo={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},qo={key:1,class:"text-sm text-gray-400"},Vo={class:"py-1"},Qo=["onClick"],Wo=["onClick"],Ho={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Go=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"Esta carpeta está vacía",-1),Zo=e("p",{class:"text-gray-600 mb-4"},"Agrega documentos para organizar tu trabajo",-1),Jo={__name:"FolderDetailsModalTable",props:{folder:{type:Object,default:null}},emits:["close","add-documents","remove-document","view-document","use-document","document-action"],setup(a,{emit:$}){const i=a,u=$;Ze(),qe();const C=_({}),x=_({}),y=_(!1),S=_(-1),v=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],k=B(()=>{if(!i.folder)return v[0];if(i.folder.color)return v.find(J=>J.name===i.folder.color)||v[0];const j=i.folder.id%v.length;return v[j]}),Z=j=>j.state==="Published"||j.state==="Draft"?"Formato":j.state==="PendingSignatures"||j.state==="FullySigned"?"Para Firmar":j.state==="Progress"||j.state==="Completed"?"Mis Documentos":"Documento",q=j=>({Published:"Publicado",Draft:"Borrador",Progress:"En Progreso",Completed:"Completado",PendingSignatures:"Pendiente Firma",FullySigned:"Firmado"})[j.state]||j.state,z=j=>({Published:"bg-green-100 text-green-700 border border-green-200",Draft:"bg-gray-100 text-gray-700 border border-gray-200",Progress:"bg-blue-100 text-blue-700 border border-blue-200",Completed:"bg-green-100 text-green-700 border border-green-200",PendingSignatures:"bg-yellow-100 text-yellow-700 border border-yellow-200",FullySigned:"bg-green-100 text-green-700 border border-green-200"})[j.state]||"bg-gray-100 text-gray-700 border border-gray-200",oe=j=>{const J=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],H=j.id%J.length;return J[H]},le=()=>{u("close")},ae=()=>{u("add-documents",i.folder)},F=j=>{u("remove-document",{folderId:i.folder.id,documentId:j.id})},d=j=>{const J=Z(j);u(J==="Formato"?"use-document":"view-document",j)},T=()=>!y.value||!i.folder?"auto":i.folder.documents.length===1?"280px":i.folder.documents.length===2&&S.value===1?"340px":"280px",E=(j,J)=>{j&&(C.value[J]=j)},X=(j,J)=>{j&&(x.value[J]=j)},b=(j,J)=>{y.value=!J,S.value=J?-1:j,J||setTimeout(()=>{const H=x.value[j];if(H){const ce=H.$el||H;if(ce&&ce.getBoundingClientRect){const U=ce.getBoundingClientRect(),G=window.innerHeight;if(j===0){if(U.bottom>G-20){const Y=U.bottom-G+40;window.scrollBy({top:Y,behavior:"smooth"})}}else if(U.bottom>G-10){const Y=U.bottom-G+30;window.scrollBy({top:Y,behavior:"smooth"})}else if(U.top<80){const Y=U.top-100;window.scrollBy({top:Y,behavior:"smooth"})}}}},100)};return(j,J)=>a.folder?(s(),ne(Ge,{key:0},{default:A(()=>[e("div",yo,[e("div",vo,[e("div",bo,[e("div",xo,[e("div",_o,[e("div",{class:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:Ve({backgroundColor:k.value.hex+"20"})},[r(t($t),{class:"h-6 w-6",style:Ve({color:k.value.hex})},null,8,["style"])],4),e("div",null,[e("h3",wo,p(a.folder.name),1),e("p",$o,p(a.folder.documents.length)+" documento"+p(a.folder.documents.length!==1?"s":""),1)])]),e("div",ko,[e("button",{onClick:ae,class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"},[r(t(We),{class:"w-5 h-5"}),re(" Agregar documentos ")]),e("button",{onClick:le,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[r(t(Ee),{class:"w-6 h-6"})])])])]),e("div",Co,[a.folder.documents.length>0?(s(),o("div",Do,[e("div",{class:"overflow-x-auto",style:Ve({minHeight:T()})},[e("table",Fo,[So,e("tbody",Eo,[(s(!0),o(ge,null,he(a.folder.documents,(H,ce)=>{var U;return s(),o("tr",{key:H.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:G=>d(H)},[e("td",Ao,[e("div",jo,[e("div",Mo,[e("div",Po,[r(t(Ne),{class:"h-5 w-5 text-blue-600"})])]),e("div",Lo,[e("div",Bo,p(H.title),1)])])]),e("td",Ro,[e("span",zo,p(Z(H)),1)]),e("td",Io,[e("span",{class:M(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",z(H)])},p(q(H)),3)]),e("td",Uo,[e("div",No,[(s(!0),o(ge,null,he((U=H.tags)==null?void 0:U.slice(0,2),G=>(s(),o("span",{key:G.id,class:M(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",oe(G)])},p(G.name),3))),128)),H.tags&&H.tags.length>2?(s(),o("span",Oo," +"+p(H.tags.length-2),1)):f("",!0),!H.tags||H.tags.length===0?(s(),o("span",qo,"-")):f("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:J[0]||(J[0]=pe(()=>{},["stop"]))},[r(t(Le),{as:"div",class:"relative inline-block text-left"},{default:A(({open:G})=>[r(t(Be),{ref_for:!0,ref:Y=>E(Y,ce),onClick:Y=>b(ce,G),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:A(()=>[r(t(it),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),r(t(Re),{ref_for:!0,ref:Y=>X(Y,ce),class:M([a.folder.documents.length>2&&ce>0&&ce>=a.folder.documents.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:A(()=>[e("div",Vo,[r(t(fe),null,{default:A(({active:Y})=>[e("a",{onClick:P=>d(H),class:M([Y?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver documento ",10,Qo)]),_:2},1024),r(t(fe),null,{default:A(({active:Y})=>[e("a",{onClick:P=>F(H),class:M([Y?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Quitar de carpeta ",10,Wo)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,To)}),128))])])],4)])):(s(),o("div",Ho,[r(t(at),{class:"w-12 h-12 text-gray-300 mx-auto mb-4"}),Go,Zo,e("button",{onClick:ae,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},[r(t(We),{class:"w-5 h-5"}),re(" Agregar documentos ")])]))])])])]),_:1})):f("",!0)}},yt=a=>(Ct("data-v-d403a707"),a=a(),Dt(),a),Ko={class:"tag-filter-container"},Yo={class:"relative"},Xo={class:"flex items-center"},ea={key:0,class:"ml-2 inline-flex items-center justify-center h-5 w-5 bg-primary text-white text-xs rounded-full font-medium"},ta={key:0,class:"absolute left-0 mt-2 w-full sm:w-80 bg-white rounded-xl shadow-xl ring-1 ring-black ring-opacity-5 border border-gray-100 z-50 overflow-hidden"},sa={class:"bg-gray-50 p-4 border-b border-gray-200"},oa={class:"flex items-center justify-between mb-3"},aa=yt(()=>e("h3",{class:"text-sm font-semibold text-gray-900"},"Filtrar por etiquetas",-1)),ra={key:0,class:"text-xs text-gray-500"},na={class:"relative"},la={key:0,class:"px-4 py-2 bg-blue-50 border-b border-blue-100"},ia={class:"flex items-center justify-between"},da={class:"text-xs font-medium text-blue-700"},ca={class:"max-h-52 overflow-y-auto"},ua={key:0,class:"px-4 py-8 text-center"},ma=yt(()=>e("p",{class:"text-gray-500 text-sm"},"No hay etiquetas disponibles",-1)),ga={key:1,class:"px-4 py-8 text-center"},pa={class:"text-gray-500 text-sm"},ha={key:2,class:"px-4 py-8 text-center"},fa=yt(()=>e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"}),e("span",{class:"ml-3 text-sm text-gray-600"},"Cargando etiquetas...")],-1)),ya=[fa],va={key:3,class:"py-2"},ba=["onClick"],xa={class:"flex items-center h-5"},_a={class:"relative"},wa=["id","checked","onChange"],$a={key:0,class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},ka=yt(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),Ca=[ka],Da={class:"ml-3 flex items-center flex-1 min-w-0"},Fa={class:"text-sm font-medium text-gray-900 truncate"},Sa={key:0,class:"mt-4"},Ea={class:"flex items-start gap-2"},Ta=yt(()=>e("span",{class:"text-xs font-medium text-gray-500 mt-1.5 flex-shrink-0"},"Activos:",-1)),Aa={class:"flex flex-wrap gap-2"},ja=["onClick"],Ma={class:"mr-1"},Pa={class:"ml-1 p-0.5 rounded-full hover:bg-white/50 transition-colors duration-150"},La={__name:"TagFilter",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(a,{emit:$}){const i=a,u=$,C=qe(),x=_(!1),y=_([]),S=_(!1),v=_(""),k=B(()=>C.sortedTags),Z=B(()=>{if(!v.value.trim())return k.value;const d=v.value.toLowerCase().trim();return k.value.filter(T=>T.name.toLowerCase().includes(d))}),q=d=>{const T=mt(d.color_id);return{hex:T&&T.hex?T.hex:"#9CA3AF",dark:T&&T.dark?T.dark:"#374151"}},z=()=>{x.value=!x.value,x.value&&(v.value="")},oe=d=>y.value.some(T=>T.id===d.id),le=d=>{const T=y.value.findIndex(E=>E.id===d.id);T>=0?y.value.splice(T,1):y.value.push(d),u("update:modelValue",y.value)},ae=()=>{y.value=[],u("update:modelValue",[])},F=d=>{d.target.closest(".tag-filter-container")||(x.value=!1,v.value="")};return Qe(async()=>{try{S.value=!0,await C.initTags()}catch(d){console.error("Error loading tags:",d)}finally{S.value=!1}document.addEventListener("click",F)}),$e(()=>i.modelValue,d=>{y.value=d||[]},{immediate:!0}),pt(()=>{document.removeEventListener("click",F)}),(d,T)=>(s(),o("div",Ko,[e("div",Yo,[e("button",{onClick:z,class:M(["group inline-flex items-center justify-between w-full sm:w-auto sm:min-w-[200px] px-4 py-3 border border-gray-200 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-primary transition-all duration-200",{"ring-2 ring-primary border-primary bg-blue-50":x.value,"border-primary bg-primary/5":y.value.length>0&&!x.value}])},[e("div",Xo,[r(t(Nt),{class:M(["h-5 w-5 mr-2.5 text-gray-500 group-hover:text-gray-600",{"text-primary":y.value.length>0||x.value}])},null,8,["class"]),e("span",{class:M(["text-gray-700",{"text-primary font-semibold":y.value.length>0||x.value}])}," Filtrar por etiquetas ",2),y.value.length>0?(s(),o("span",ea,p(y.value.length),1)):f("",!0)]),r(t(Oe),{class:M(["ml-3 h-4 w-4 text-gray-400 transition-all duration-200 group-hover:text-gray-600",{"rotate-180 text-primary":x.value,"text-primary":y.value.length>0&&!x.value}])},null,8,["class"])],2),r(xs,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:A(()=>[x.value?(s(),o("div",ta,[e("div",sa,[e("div",oa,[aa,k.value.length>0?(s(),o("span",ra,p(k.value.length)+" disponibles ",1)):f("",!0)]),e("div",na,[r(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":T[0]||(T[0]=E=>v.value=E),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"},null,512),[[Fe,v.value]])])]),y.value.length>0?(s(),o("div",la,[e("div",ia,[e("span",da,p(y.value.length)+" etiqueta"+p(y.value.length!==1?"s":"")+" seleccionada"+p(y.value.length!==1?"s":""),1),e("button",{onClick:ae,class:"text-xs text-red-600 hover:text-red-700 font-medium px-2 py-1 rounded-md hover:bg-red-50 transition-all duration-200"}," Limpiar todo ")])])):f("",!0),e("div",ca,[!S.value&&Z.value.length===0&&v.value.trim()===""?(s(),o("div",ua,[r(t(Nt),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),ma])):f("",!0),!S.value&&Z.value.length===0&&v.value.trim()!==""?(s(),o("div",ga,[r(t(He),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e("p",pa,'Sin resultados para "'+p(v.value)+'"',1),e("button",{onClick:T[1]||(T[1]=E=>v.value=""),class:"text-xs text-primary hover:text-primary-dark mt-2 font-medium"}," Ver todas las etiquetas ")])):f("",!0),S.value?(s(),o("div",ha,ya)):f("",!0),!S.value&&Z.value.length>0?(s(),o("div",va,[(s(!0),o(ge,null,he(Z.value,E=>(s(),o("div",{key:E.id,class:"group flex items-center px-4 py-2.5 hover:bg-gray-50 cursor-pointer transition-colors duration-150",onClick:X=>le(E)},[e("div",xa,[e("div",_a,[e("input",{id:`tag-${E.id}`,type:"checkbox",checked:oe(E),onChange:X=>le(E),class:"sr-only"},null,40,wa),e("div",{class:M(["w-4 h-4 border-2 rounded transition-all duration-200 flex items-center justify-center",oe(E)?"bg-primary border-primary":"border-gray-300 group-hover:border-gray-400"])},[oe(E)?(s(),o("svg",$a,Ca)):f("",!0)],2)])]),e("div",Da,[e("div",{class:"w-3 h-3 rounded-full mr-2.5 border flex-shrink-0 shadow-sm",style:Ve({backgroundColor:q(E).hex})},null,4),e("span",Fa,p(E.name),1)])],8,ba))),128))])):f("",!0)])])):f("",!0)]),_:1})]),y.value.length>0?(s(),o("div",Sa,[e("div",Ea,[Ta,e("div",Aa,[(s(!0),o(ge,null,he(y.value,E=>(s(),o("div",{key:E.id,class:"group inline-flex items-center pl-2.5 pr-1.5 py-1.5 rounded-lg text-xs font-medium border shadow-sm cursor-pointer transition-all duration-200 hover:shadow-md",style:Ve({backgroundColor:q(E).hex+"20",borderColor:q(E).hex+"40",color:q(E).dark}),onClick:X=>le(E)},[e("div",{class:"w-2 h-2 rounded-full mr-2 flex-shrink-0",style:Ve({backgroundColor:q(E).hex})},null,4),e("span",Ma,p(E.name),1),e("div",Pa,[r(t(Ee),{class:"h-3 w-3 opacity-60 group-hover:opacity-100"})])],12,ja))),128))])])])):f("",!0)]))}},Ba=Et(La,[["__scopeId","data-v-d403a707"]]),Ra={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},za={class:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden"},Ia={class:"border-b"},Ua={class:"hidden sm:flex justify-between items-center p-6"},Na=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Oa={class:"text-sm text-gray-600"},qa={class:"sm:hidden p-4"},Va={class:"flex justify-between items-start mb-2"},Qa={class:"flex-1 min-w-0 mr-3"},Wa=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Ha={class:"text-sm text-gray-600 truncate"},Ga={class:"border-b"},Za={class:"hidden sm:flex space-x-8 px-6","aria-label":"Tabs"},Ja=["onClick"],Ka={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},Ya={class:"sm:hidden relative px-4 py-3"},Xa={class:"flex items-center"},er={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},tr=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),sr=[tr],or={class:"absolute top-full left-4 right-4 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},ar=["onClick"],rr={class:"border-b bg-gray-50 p-4 sm:p-6"},nr={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},lr={class:"flex-1"},ir={key:0,class:"flex items-center gap-3"},dr={class:"text-sm text-gray-600"},cr={class:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-350px)]"},ur={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},mr=["onClick"],gr=e("span",null,"Etiquetas",-1),pr=[gr],hr={key:5,class:"absolute top-2 left-2 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center shadow-sm"},fr={key:0,class:"text-center py-8 sm:py-12"},yr={class:"text-lg font-medium text-gray-900 mb-2"},vr={class:"text-gray-600 text-sm sm:text-base"},br={class:"border-t bg-gray-50"},xr={class:"hidden sm:flex justify-between items-center p-6"},_r={class:"text-sm text-gray-600"},wr={class:"flex gap-3"},$r=["disabled"],kr={class:"sm:hidden p-4 space-y-3"},Cr={class:"text-center text-sm text-gray-600"},Dr={class:"flex gap-3"},Fr=["disabled"],Sr={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 p-4"},Er={class:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] flex flex-col"},Tr={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},Ar={class:"flex items-center gap-2"},jr=e("h2",{class:"text-sm font-semibold text-gray-900"},"Etiquetas del documento",-1),Mr={class:"px-4 py-3 border-b border-gray-100 text-xs text-gray-500"},Pr=e("span",{class:"font-medium text-gray-700"},"Documento:",-1),Lr={class:"ml-1"},Br={class:"px-4 py-3 overflow-y-auto"},Rr={key:0,class:"text-sm text-gray-500"},zr={key:1,class:"space-y-2 text-sm"},Ir={class:"flex items-center gap-2 min-w-0"},Ur={key:0,class:"text-xs text-gray-500 truncate max-w-[8rem]"},Nr={__name:"AddDocumentsModal",props:{isVisible:{type:Boolean,required:!0},folder:{type:Object,default:null}},emits:["close","add-documents"],setup(a,{emit:$}){const i=a,u=$,C=qe(),x=Ze(),y=_([]),S=_([]),v=_("my-documents"),k=_(!1),Z=_(!1),q=_(!1),z=_(null),oe=[{name:"my-documents",label:"Mis Documentos"},{name:"use-documents",label:"Minutas"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Documentos Firmados"}],le=B(()=>x.currentUser);$e(()=>i.isVisible,G=>{G&&(y.value=[],S.value=[],v.value="my-documents")}),$e(v,()=>{y.value=[]}),$e(S,()=>{y.value=[]},{deep:!0});const ae=B(()=>{const G=d(v.value);return G.length===0?!1:G.every(Y=>y.value.includes(Y.id))}),F=G=>{var R;if(!i.folder)return[];const Y=i.folder.documents.map(te=>te.id);let P=[];switch(G){case"my-documents":P=C.progressAndCompletedDocumentsByClient((R=le.value)==null?void 0:R.id);break;case"use-documents":P=C.publishedDocumentsUnassigned;break;case"pending-signatures":P=C.documents.filter(te=>{var ve,I;return te.state==="PendingSignatures"&&(te.assigned_to===((ve=le.value)==null?void 0:ve.id)||((I=te.signatures)==null?void 0:I.some(W=>{var N;return W.signer_email===((N=le.value)==null?void 0:N.email)})))});break;case"signed-documents":P=C.documents.filter(te=>{var ve,I;return te.state==="FullySigned"&&(te.assigned_to===((ve=le.value)==null?void 0:ve.id)||((I=te.signatures)==null?void 0:I.some(W=>{var N;return W.signer_email===((N=le.value)==null?void 0:N.email)})))});break;default:P=[]}return P.filter(te=>!Y.includes(te.id))},d=G=>{const Y=F(G);if(!S.value||S.value.length===0)return Y;const P=S.value.map(R=>R.id);return Y.filter(R=>!R.tags||R.tags.length===0?!1:R.tags.some(te=>P.includes(te.id)))},T=G=>{const Y=y.value.indexOf(G);Y>-1?y.value.splice(Y,1):y.value.push(G)},E=()=>{const Y=d(v.value).map(P=>P.id);if(ae.value)y.value=y.value.filter(P=>!Y.includes(P));else{const P=Y.filter(R=>!y.value.includes(R));y.value.push(...P)}},X=()=>{u("close")},b=async()=>{if(y.value.length!==0){k.value=!0;try{await u("add-documents",y.value)}finally{k.value=!1}}},j=G=>{v.value=G,Z.value=!1},J=G=>{G.target.closest(".relative")||(Z.value=!1)};Qe(()=>{document.addEventListener("click",J)}),pt(()=>{document.removeEventListener("click",J)});const H=G=>{const Y=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],P=G.id%Y.length;return Y[P]},ce=G=>{z.value=G,q.value=!0},U=()=>{q.value=!1,z.value=null};return(G,Y)=>a.isVisible&&a.folder?(s(),ne(Ge,{key:0},{default:A(()=>{var P;return[e("div",Ra,[e("div",za,[e("div",Ia,[e("div",Ua,[e("div",null,[Na,e("p",Oa,'Selecciona documentos para agregar a "'+p(a.folder.name)+'"',1)]),e("button",{onClick:X,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors"},[r(t(Ee),{class:"w-5 h-5"})])]),e("div",qa,[e("div",Va,[e("div",Qa,[Wa,e("p",Ha,'Para "'+p(a.folder.name)+'"',1)]),e("button",{onClick:X,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors flex-shrink-0"},[r(t(Ee),{class:"w-5 h-5"})])])])]),e("div",Ga,[e("nav",Za,[(s(),o(ge,null,he(oe,R=>e("button",{key:R.name,onClick:te=>v.value=R.name,class:M([v.value===R.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[re(p(R.label)+" ",1),e("span",Ka,p(d(R.name).length),1)],10,Ja)),64))]),e("div",Ya,[e("button",{onClick:Y[0]||(Y[0]=R=>Z.value=!Z.value),class:"w-full flex items-center justify-between py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("div",Xa,[e("span",null,p(((P=oe.find(R=>R.name===v.value))==null?void 0:P.label)||"Seleccionar categoría"),1),e("span",er,p(d(v.value).length),1)]),(s(),o("svg",{class:M(["ml-2 h-5 w-5 transition-transform duration-200",Z.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},sr,2))]),ke(e("div",or,[(s(),o(ge,null,he(oe,R=>e("button",{key:R.name,onClick:te=>j(R.name),class:M(["w-full text-left px-4 py-3 text-sm transition-colors duration-150 flex items-center justify-between",v.value===R.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},[e("span",null,p(R.label),1),e("span",{class:M(["py-0.5 px-2 rounded-full text-xs",v.value===R.name?"bg-white/20 text-white":"bg-gray-100 text-gray-600"])},p(d(R.name).length),3)],10,ar)),64))],512),[[ht,Z.value]])])]),e("div",rr,[e("div",nr,[e("div",lr,[r(Ba,{modelValue:S.value,"onUpdate:modelValue":Y[1]||(Y[1]=R=>S.value=R),class:"max-w-md"},null,8,["modelValue"])]),d(v.value).length>0?(s(),o("div",ir,[e("span",dr,p(d(v.value).length)+" documento(s) disponible(s) ",1),e("button",{onClick:E,class:M(["px-4 py-2 rounded-lg border font-medium text-sm transition-colors",ae.value?"bg-red-50 border-red-200 text-red-700 hover:bg-red-100":"bg-primary text-white border-primary hover:bg-primary-dark"])},p(ae.value?"Deseleccionar todos":"Seleccionar todos"),3)])):f("",!0)])]),e("div",cr,[e("div",ur,[(s(!0),o(ge,null,he(d(v.value),R=>(s(),o("div",{key:R.id,class:"relative"},[v.value==="my-documents"?(s(),ne(t(As),{key:0,document:R,"highlighted-doc-id":null,"show-tags":!1,"show-client-name":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":y.value.includes(R.id)?"ring-2 ring-primary bg-primary-50":"",onClick:te=>T(R.id)},null,8,["document","additional-classes","onClick"])):f("",!0),v.value==="use-documents"?(s(),ne(t(Ys),{key:1,document:R,"show-tags":!1,"menu-options":[],"show-menu-options":!1,"disable-internal-actions":!0,"additional-classes":y.value.includes(R.id)?"ring-2 ring-primary bg-primary-50":"",onClick:te=>T(R.id)},null,8,["document","additional-classes","onClick"])):f("",!0),v.value==="pending-signatures"?(s(),ne(t(Yt),{key:2,document:R,"highlighted-doc-id":null,"show-tags":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":y.value.includes(R.id)?"ring-2 ring-primary bg-primary-50":"",onClick:te=>T(R.id)},null,8,["document","additional-classes","onClick"])):f("",!0),v.value==="signed-documents"?(s(),ne(t(Yt),{key:3,document:R,"highlighted-doc-id":null,"show-tags":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":y.value.includes(R.id)?"ring-2 ring-primary bg-primary-50":"",onClick:te=>T(R.id)},null,8,["document","additional-classes","onClick"])):f("",!0),R.tags&&R.tags.length>0?(s(),o("button",{key:4,type:"button",class:"absolute bottom-2 right-2 px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 inline-flex items-center gap-1",onClick:pe(te=>ce(R),["stop"])},pr,8,mr)):f("",!0),y.value.includes(R.id)?(s(),o("div",hr,[r(t(js),{class:"w-4 h-4"})])):f("",!0)]))),128))]),d(v.value).length===0?(s(),o("div",fr,[r(t(at),{class:"w-12 h-12 sm:w-16 sm:h-16 text-gray-300 mx-auto mb-4"}),e("h4",yr,p(S.value.length>0?"No hay documentos que coincidan con el filtro":"No hay documentos disponibles"),1),e("p",vr,p(S.value.length>0?"Intenta ajustar los filtros de etiquetas o selecciona otra categoría":"No tienes documentos de esta categoría que no estén ya en la carpeta"),1)])):f("",!0)]),e("div",br,[e("div",xr,[e("div",_r,p(y.value.length)+" documento(s) seleccionado(s) ",1),e("div",wr,[e("button",{onClick:X,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{onClick:b,disabled:y.value.length===0||k.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},p(k.value?"Agregando...":`Agregar ${y.value.length} documento(s)`),9,$r)])]),e("div",kr,[e("div",Cr,p(y.value.length)+" documento(s) seleccionado(s) ",1),e("div",Dr,[e("button",{onClick:X,class:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center font-medium"}," Cancelar "),e("button",{onClick:b,disabled:y.value.length===0||k.value,class:"flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-center font-medium"},p(k.value?"Agregando...":"Agregar"),9,Fr)])])]),q.value&&z.value?(s(),o("div",Sr,[e("div",Er,[e("div",Tr,[e("div",Ar,[r(t(at),{class:"h-5 w-5 text-gray-500"}),jr]),e("button",{type:"button",class:"text-gray-400 hover:text-gray-600 p-1 rounded-md hover:bg-gray-100",onClick:U},[r(t(Ee),{class:"h-5 w-5"})])]),e("div",Mr,[Pr,e("span",Lr,p(z.value.title||"Sin título"),1)]),e("div",Br,[!z.value.tags||z.value.tags.length===0?(s(),o("div",Rr," Este documento no tiene etiquetas. ")):(s(),o("ul",zr,[(s(!0),o(ge,null,he(z.value.tags,R=>(s(),o("li",{key:R.id,class:"flex items-center justify-between gap-2"},[e("div",Ir,[e("span",{class:M(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",H(R)])},p(R.name),3)]),R.description?(s(),o("span",Ur,p(R.description),1)):f("",!0)]))),128))]))]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end"},[e("button",{type:"button",class:"px-4 py-2 text-sm font-medium rounded-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-50",onClick:U}," Cerrar ")])])])):f("",!0)])])]}),_:1})):f("",!0)}},dt=a=>(Ct("data-v-d9a5a89f"),a=a(),Dt(),a),Or={class:"folders-table"},qr={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200",style:{"overflow-x":"visible","overflow-y":"hidden"}},Vr={class:"min-w-full divide-y divide-gray-200"},Qr=dt(()=>e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Carpeta "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documentos "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Creada "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1)),Wr={class:"bg-white divide-y divide-gray-200"},Hr=["onClick"],Gr={class:"px-6 py-4 whitespace-nowrap"},Zr={class:"flex items-center"},Jr={class:"flex-shrink-0 h-10 w-10"},Kr={class:"ml-4"},Yr={class:"text-sm font-medium text-gray-900"},Xr={class:"px-6 py-4 whitespace-nowrap"},en={class:"flex items-center gap-2"},tn={class:"text-sm text-gray-900"},sn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},on={class:"py-1"},an=["onClick"],rn=["onClick"],nn=["onClick"],ln=["onClick"],dn={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},cn=dt(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No tienes carpetas aún",-1)),un=dt(()=>e("p",{class:"text-gray-600 mb-6"},"Crea tu primera carpeta para organizar tus documentos",-1)),mn={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},gn=dt(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No se encontraron carpetas",-1)),pn=dt(()=>e("p",{class:"text-gray-600"},"No hay carpetas que coincidan con tu búsqueda",-1)),hn={key:3,class:"flex justify-center items-center py-12"},fn=dt(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)),yn=[fn],vn={__name:"FoldersTable",props:{sortedFolders:{type:Array,required:!0},searchQuery:{type:String,default:""},isLoading:{type:Boolean,default:!1}},emits:["folder-click","edit-folder","delete-folder","add-documents","create-folder"],setup(a,{emit:$}){const i=a,u=$,C=_({}),x=_({}),y=_(!1),S=_(-1),v=B(()=>{if(!i.searchQuery.trim())return i.sortedFolders;const b=i.searchQuery.toLowerCase();return i.sortedFolders.filter(j=>j.name.toLowerCase().includes(b))}),k=[{name:"blue",hex:"#3B82F6"},{name:"purple",hex:"#8B5CF6"},{name:"pink",hex:"#EC4899"},{name:"green",hex:"#10B981"},{name:"yellow",hex:"#F59E0B"},{name:"red",hex:"#EF4444"},{name:"indigo",hex:"#6366F1"},{name:"teal",hex:"#14B8A6"}],Z=b=>{if(b.color)return k.find(J=>J.name===b.color)||k[0];const j=b.id%k.length;return k[j]},q=b=>{if(!b)return"-";const j=new Date(b),H=Math.abs(new Date-j),ce=Math.ceil(H/(1e3*60*60*24));return ce===0?"Hoy":ce===1?"Ayer":ce<7?`Hace ${ce} días`:ce<30?`Hace ${Math.floor(ce/7)} semanas`:ce<365?`Hace ${Math.floor(ce/30)} meses`:j.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},z=b=>{u("folder-click",b)},oe=b=>{u("edit-folder",b)},le=b=>{u("delete-folder",b)},ae=b=>{u("add-documents",b)},F=()=>{u("create-folder")},d=()=>y.value?v.value.length===1?"280px":v.value.length===2&&S.value===1?"340px":"280px":"auto",T=(b,j)=>{b&&(C.value[j]=b)},E=(b,j)=>{b&&(x.value[j]=b)},X=(b,j)=>{y.value=!j,S.value=j?-1:b,j||setTimeout(()=>{const J=x.value[b];if(J){const H=J.$el||J;if(H&&H.getBoundingClientRect){const ce=H.getBoundingClientRect(),U=window.innerHeight;if(b===0){if(ce.bottom>U-20){const G=ce.bottom-U+40;window.scrollBy({top:G,behavior:"smooth"})}}else if(ce.bottom>U-10){const G=ce.bottom-U+30;window.scrollBy({top:G,behavior:"smooth"})}else if(ce.top<80){const G=ce.top-100;window.scrollBy({top:G,behavior:"smooth"})}}}},100)};return(b,j)=>(s(),o("div",Or,[!a.isLoading&&v.value.length>0?(s(),o("div",qr,[e("div",{class:"overflow-x-auto",style:Ve({minHeight:d(),overflowY:"visible"})},[e("table",Vr,[Qr,e("tbody",Wr,[(s(!0),o(ge,null,he(v.value,(J,H)=>{var ce,U;return s(),o("tr",{key:J.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:G=>z(J)},[e("td",Gr,[e("div",Zr,[e("div",Jr,[e("div",{class:"h-10 w-10 rounded-lg flex items-center justify-center",style:Ve({backgroundColor:Z(J).hex+"20"})},[r(t($t),{class:"h-6 w-6",style:Ve({color:Z(J).hex})},null,8,["style"])],4)]),e("div",Kr,[e("div",Yr,p(J.name),1)])])]),e("td",Xr,[e("div",en,[r(t(Ne),{class:"h-5 w-5 text-gray-400"}),e("span",tn,p(((ce=J.documents)==null?void 0:ce.length)||0)+" documento"+p((((U=J.documents)==null?void 0:U.length)||0)!==1?"s":""),1)])]),e("td",sn,p(q(J.created_at)),1),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:j[0]||(j[0]=pe(()=>{},["stop"]))},[r(t(Le),{as:"div",class:"relative inline-block text-left"},{default:A(({open:G})=>[r(t(Be),{ref_for:!0,ref:Y=>T(Y,H),onClick:Y=>X(H,G),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:A(()=>[r(t(it),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),r(t(Re),{ref_for:!0,ref:Y=>E(Y,H),class:M([v.value.length>2&&H>0&&H>=v.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:A(()=>[e("div",on,[r(t(fe),null,{default:A(({active:Y})=>[e("a",{onClick:P=>z(J),class:M([Y?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Ver carpeta ",10,an)]),_:2},1024),r(t(fe),null,{default:A(({active:Y})=>[e("a",{onClick:P=>ae(J),class:M([Y?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Agregar documentos ",10,rn)]),_:2},1024),r(t(fe),null,{default:A(({active:Y})=>[e("a",{onClick:P=>oe(J),class:M([Y?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Editar ",10,nn)]),_:2},1024),r(t(fe),null,{default:A(({active:Y})=>[e("a",{onClick:P=>le(J),class:M([Y?"bg-gray-100":"","block px-4 py-2 text-sm text-red-600 cursor-pointer"])}," Eliminar ",10,ln)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,Hr)}),128))])])],4)])):!a.isLoading&&a.sortedFolders.length===0?(s(),o("div",dn,[r(t($t),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),cn,un,e("button",{onClick:F,class:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"},[r(t(We),{class:"w-5 h-5"}),re(" Crear Primera Carpeta ")])])):!a.isLoading&&a.sortedFolders.length>0&&v.value.length===0?(s(),o("div",mn,[r(t($t),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),gn,pn])):f("",!0),a.isLoading?(s(),o("div",hn,yn)):f("",!0)]))}},bn=Et(vn,[["__scopeId","data-v-d9a5a89f"]]),gs=a=>(Ct("data-v-e3f57445"),a=a(),Dt(),a),xn={class:"folder-management"},_n={class:"mb-6"},wn={class:"hidden sm:flex justify-between items-center"},$n=gs(()=>e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),kn={class:"sm:hidden"},Cn=gs(()=>e("div",{class:"text-center mb-4"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1 px-2"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Dn={__name:"FolderManagement",props:{searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","navigate-to-main","navigate-to-document"],setup(a,{emit:$}){const i=a,u=$,C=Gt(),x=qe(),y=Ze(),S=_(!1),v=_(null),k=_(null),Z=_(!1),q=_(null),z=B(()=>C.isLoading),oe=B(()=>C.sortedFolders);B(()=>y.currentUser),Qe(async()=>{await C.init(),await x.init()}),$e(()=>i.searchQuery,()=>{}),$e(()=>C.folders,P=>{var R,te;if(k.value&&P&&P.length>0){const ve=P.find(I=>I.id===k.value.id);ve&&((R=k.value.documents)!=null&&R.length,(te=ve.documents)!=null&&te.length,JSON.stringify(k.value)!==JSON.stringify(ve)&&(k.value={...ve}))}},{deep:!0});const le=()=>{v.value=null,S.value=!0},ae=P=>{v.value=P,S.value=!0},F=()=>{S.value=!1,v.value=null},d=()=>{F()},T=P=>{k.value=P},E=()=>{k.value=null},X=async P=>{if(confirm(`¿Estás seguro de que quieres eliminar la carpeta "${P.name}"?`))try{await C.deleteFolder(P.id),we(`Carpeta "${P.name}" eliminada correctamente`,"success")}catch(R){we("Error al eliminar la carpeta","error"),console.error("Error deleting folder:",R)}},b=P=>{q.value=P,Z.value=!0},j=async(P=!1)=>{if(Z.value=!1,q.value=null,P&&k.value)try{await J()}catch(R){console.warn("Error refreshing folder after adding documents:",R)}},J=async()=>{if(k.value)try{await C.fetchFolder(k.value.id);const P=C.getFolderById(k.value.id);P&&(k.value={...P},console.log("✅ Selected folder refreshed successfully"))}catch(P){throw console.error("❌ Error refreshing selected folder:",P),P}},H=async P=>{var R,te,ve;if(!(!q.value||P.length===0))try{const I=q.value.documents.map(K=>K.id).filter(K=>K!=null&&!isNaN(parseInt(K))).map(K=>parseInt(K)),W=P.filter(K=>K!=null&&!isNaN(parseInt(K))).map(K=>parseInt(K)),N=[...new Set([...I,...W])];if(console.log("Current document IDs:",I),console.log("Selected document IDs:",W),console.log("Updated document IDs:",N),N.some(K=>!Number.isInteger(K)||K<=0))throw new Error("IDs de documentos inválidos detectados");await C.updateFolder(q.value.id,{document_ids:N}),await j(!0),we(`${W.length} documento(s) agregado(s) a la carpeta`,"success"),u("navigate-to-main")}catch(I){console.error("Error adding documents to folder:",I),console.error("Error details:",((R=I.response)==null?void 0:R.data)||I.message),(te=I.response)!=null&&te.status?we(`Error al agregar documentos: ${((ve=I.response.data)==null?void 0:ve.detail)||I.message}`,"error"):we("Error al agregar documentos a la carpeta","error")}},ce=async P=>{var te,ve,I;if(!k.value)return;const R=typeof P=="object"&&P!==null?P.documentId:P;try{const W=parseInt(R);if(!Number.isInteger(W)||W<=0)throw new Error("ID de documento inválido");const N=k.value.documents.map(K=>K.id).filter(K=>K!=null&&!isNaN(parseInt(K))).map(K=>parseInt(K)).filter(K=>K!==W);await C.updateFolder(k.value.id,{document_ids:N}),we("Documento removido de la carpeta","success"),k.value=null,u("navigate-to-main")}catch(W){console.error("Error removing document from folder:",W),console.error("Error details:",((te=W.response)==null?void 0:te.data)||W.message),(ve=W.response)!=null&&ve.status?we(`Error al remover documento: ${((I=W.response.data)==null?void 0:I.detail)||W.message}`,"error"):we("Error al remover el documento de la carpeta","error")}},U=P=>{let R="legal-documents";P.state==="Published"||P.state==="Draft"?R="legal-documents":P.state==="PendingSignatures"?R="pending-signatures":P.state==="FullySigned"?R="signed-documents":P.state==="Progress"||P.state==="Completed"?R="my-documents":(P.state==="Rejected"||P.state==="Expired"||P.state==="Archived")&&(R="archived-documents"),k.value=null,u("navigate-to-document",{tab:R,searchQuery:P.title})},G=P=>{k.value=null,u("navigate-to-document",{tab:"legal-documents",searchQuery:P.title})},Y=(P,R)=>{console.log("Document action:",P,R)};return(P,R)=>(s(),o("div",xn,[e("div",_n,[e("div",wn,[$n,e("button",{onClick:le,class:"inline-flex items-center gap-2 px-4 py-2.5 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md"},[r(t(We),{class:"w-5 h-5"}),re(" Nueva Carpeta ")])]),e("div",kn,[Cn,e("button",{onClick:le,class:"w-full flex items-center justify-center gap-3 px-4 py-4 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium text-base"},[r(t(We),{class:"w-6 h-6"}),re(" Nueva Carpeta ")])])]),r(t(bn),{"sorted-folders":oe.value,"search-query":a.searchQuery,"is-loading":z.value,onFolderClick:T,onEditFolder:ae,onDeleteFolder:X,onAddDocuments:b,onCreateFolder:le},null,8,["sorted-folders","search-query","is-loading"]),r(t(fo),{"is-visible":S.value,"editing-folder":v.value,onClose:F,onSuccess:d},null,8,["is-visible","editing-folder"]),r(t(Jo),{folder:k.value,onClose:E,onAddDocuments:b,onRemoveDocument:ce,onViewDocument:U,onUseDocument:G,onDocumentAction:Y},null,8,["folder"]),r(t(Nr),{"is-visible":Z.value,folder:q.value,onClose:j,onAddDocuments:H},null,8,["is-visible","folder"])]))}},os=Et(Dn,[["__scopeId","data-v-e3f57445"]]);function Fn(a){return!a.variables||a.variables.length===0?!0:a.variables.every($=>$.name_es&&$.name_es.trim().length>0)}function wt(a,$){var C;if(!a.requires_signature||a.state!=="PendingSignatures"||!a.signatures||a.signatures.length===0)return!1;const i=(C=$==null?void 0:$.currentUser)==null?void 0:C.email,u=a.signatures.find(x=>x.signer_email===i);return!(!u||u.signed)}const Sn={lawyer:{getMenuOptions:(a,$,i)=>{let u;return $==="legal-documents"&&(a.state==="Draft"||a.state==="Published")?u=[{label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Actualizar nombre",action:"edit"},{label:"Editar documento",action:"editDocument"},{label:"Editar configuración de variables",action:"editForm"}]},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}]:u=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}],a.state!=="Draft"&&a.state!=="Published"&&u.splice(2,0,{label:"Administrar Asociaciones",action:"relationships"}),a.state==="Draft"?u.push({label:"Publicar",action:"publish",disabled:!Fn(a)}):a.state==="Published"&&u.push({label:"Mover a Borrador",action:"draft"}),(a.state==="Completed"||a.state==="Published")&&u.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),a.requires_signature&&(a.state==="PendingSignatures"||a.state==="FullySigned")&&(u.push({label:"Ver Firmas",action:"viewSignatures"}),wt(a,i)&&u.push({label:"Firmar documento",action:"sign"})),u}},signatures:{getMenuOptions:(a,$,i)=>{const u=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}],C=a.relationships_count&&a.relationships_count>0;if(u.push({label:"Administrar Asociaciones",action:"relationships",disabled:!C}),a.requires_signature&&["PendingSignatures","FullySigned","Rejected","Expired"].includes(a.state)&&u.push({label:"Estado de las firmas",action:"viewSignatures"}),wt(a,i)&&u.push({label:"Firmar documento",action:"sign"}),a.state==="PendingSignatures"&&wt(a,i)&&u.push({label:"Rechazar documento",action:"reject"}),a.state==="FullySigned"&&u.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),a.state==="PendingSignatures"&&u.push({label:"Descargar PDF",action:"downloadPDF"}),a.state==="Rejected"){const x=i==null?void 0:i.currentUser,y=(x==null?void 0:x.role)==="lawyer",S=a.created_by===(x==null?void 0:x.id);(y||S)&&u.push({label:"Editar y reenviar para firma",action:"editAndResend"}),Array.isArray(a.signatures)&&a.signatures.some(k=>k.rejection_comment)&&u.push({label:"Ver motivo del rechazo",action:"viewRejectionReason"})}return u}},client:{getMenuOptions:(a,$,i)=>{var v,k,Z,q;const u=[],C=((v=i==null?void 0:i.currentUser)==null?void 0:v.role)==="basic",x=((k=i==null?void 0:i.currentUser)==null?void 0:k.role)==="corporate_client"||((Z=i==null?void 0:i.currentUser)==null?void 0:Z.role)==="client",y=((q=i==null?void 0:i.currentUser)==null?void 0:q.role)==="lawyer",S=a.state==="Progress";if(a.state==="Completed"){const z=[{label:"Editar Formulario",action:"editForm"}];C||z.push({label:"Editar Documento",action:"editDocument"}),u.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:z}),(x||C||y)&&u.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:C})}else a.state==="Progress"?(u.push({label:"Completar",action:"editForm"}),(x||C||y)&&u.push({label:"Formalizar y Agregar Firmas",action:"formalize",disabled:!0})):u.push({label:"Completar",action:"editForm"});if((a.state==="Completed"||a.state==="Progress")&&u.push({label:"Previsualizar",action:"preview"}),u.push({label:"Eliminar",action:"delete"}),C?u.push({label:"Gestionar Membrete",action:"letterhead",disabled:!0}):u.push({label:"Gestionar Membrete",action:"letterhead"}),u.push({label:"Administrar Asociaciones",action:"relationships",disabled:C||S}),a.requires_signature){const oe=["PendingSignatures","FullySigned","Rejected","Expired"].includes(a.state);$!=="my-documents"&&oe&&(u.push({label:"Ver Firmas",action:"viewSignatures"}),wt(a,i)&&u.push({label:"Firmar documento",action:"sign"}))}if(a.state==="Completed"||a.state==="Progress"){const z=a.state==="Completed";u.push({label:"Descargar PDF",action:"downloadPDF",disabled:!z},{label:"Descargar Word",action:"downloadWord",disabled:C||!z},{label:"Enviar",action:"email",disabled:C||!z})}return u}}};function En(a,$,i="list",u=null){const C=Sn[a];return C?C.getMenuOptions($,i,u):[]}function ps(){const a=Ze(),$=B(()=>{var x;return((x=a.currentUser)==null?void 0:x.role)==="basic"}),i=x=>{we("Esta funcionalidad está restringida para usuarios básicos. Por favor, contacta a tu abogado para obtener acceso completo.","warning")};return{isBasicUser:$,showRestrictionNotification:i,handleFeatureAccess:(x,y)=>$.value?(i(),!1):(y&&y(),!0),getRestrictedButtonClasses:x=>x?"opacity-60 cursor-not-allowed":""}}const Tn={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},An={class:"px-6 py-4 border-b border-gray-200"},jn=e("h2",{class:"text-xl font-semibold text-gray-800"},"Acciones del Documento",-1),Mn={class:"text-sm text-gray-500 mt-1"},Pn={class:"p-6 overflow-y-auto flex-grow"},Ln={class:"space-y-4"},Bn={key:0,class:"text-sm font-semibold text-gray-700 uppercase tracking-wide px-2"},Rn={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},zn=["onClick","disabled"],In={class:"text-sm font-medium"},Un={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Nn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),On={key:1,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},qn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Vn={key:2,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Qn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Wn={key:3,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Hn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Gn={key:4,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 max-w-xs w-max"},Zn=e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-900"},null,-1),Jn={key:1,class:"border-t border-gray-200 my-4"},Kn={key:0,class:"text-center py-12"},Yn=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay acciones disponibles",-1),Xn=e("p",{class:"mt-1 text-sm text-gray-500"}," No hay opciones disponibles para este documento. ",-1),Pt={__name:"DocumentActionsModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null},cardType:{type:String,required:!0,validator:a=>["lawyer","client","signatures"].includes(a)},context:{type:String,default:"table"},userStore:{type:Object,default:null}},emits:["close","action"],setup(a,{emit:$}){const i=a,u=$,C=B(()=>i.document?En(i.cardType,i.document,i.context,i.userStore):[]),x=B(()=>{const F=C.value;if(!F||F.length===0)return[];const d=[],T={edit:"Edición",view:"Visualización",share:"Compartir",manage:"Gestión",signatures:"Firmas",delete:"Eliminación"},E={edit:[],view:[],share:[],manage:[],signatures:[],delete:[]};return F.forEach(X=>{if(X.children&&Array.isArray(X.children))X.children.forEach(b=>{const j=b.action.toLowerCase();y(b,j,E)});else{const b=X.action.toLowerCase();y(X,b,E)}}),E.edit.length>0&&d.push({title:T.edit,options:E.edit}),E.view.length>0&&d.push({title:T.view,options:E.view}),E.share.length>0&&d.push({title:T.share,options:E.share}),E.signatures.length>0&&d.push({title:T.signatures,options:E.signatures}),E.manage.length>0&&d.push({title:T.manage,options:E.manage}),E.delete.length>0&&d.push({title:T.delete,options:E.delete}),d}),y=(F,d,T)=>{d.includes("edit")||d.includes("editar")||d==="copy"||d==="draft"||d==="publish"||d==="completar"?T.edit.push(F):d.includes("signature")||d.includes("firma")||d.includes("sign")||d==="reject"?T.signatures.push(F):d.includes("view")||d.includes("preview")||d.includes("ver")||d.includes("previsualización")?T.view.push(F):d.includes("download")||d.includes("email")||d.includes("enviar")||d.includes("descargar")?T.share.push(F):d.includes("permission")||d.includes("relationship")||d.includes("letterhead")||d.includes("permiso")||d.includes("asociación")||d.includes("membrete")||d==="formalize"?T.manage.push(F):d.includes("delete")||d.includes("eliminar")?T.delete.push(F):T.manage.push(F)},S=F=>{const d=F.toLowerCase();return d==="sign"||d.includes("firmar")?kt:d==="editform"||d.includes("completar")?ss:d==="editdocument"||d.includes("editar documento")?Xt:d.includes("edit")||d==="editar"?Xt:d.includes("delete")||d==="eliminar"?Ot:d.includes("preview")||d.includes("ver")||d.includes("previsualización")?ds:d==="copy"||d.includes("copia")?Fs:d.includes("download")||d.includes("descargar")?ot:d.includes("email")||d.includes("enviar")?ws:d.includes("permission")||d.includes("permiso")?Ms:d.includes("relationship")||d.includes("asociación")?cs:d.includes("letterhead")||d.includes("membrete")?us:d==="reject"||d.includes("rechazar")?Is:d.includes("signature")||d.includes("firma")?kt:d==="publish"||d.includes("publicar")?zs:d==="draft"||d.includes("borrador")?Ne:d==="formalize"||d.includes("formalizar")?ss:at},v=F=>{const d=F.toLowerCase();return d.includes("delete")||d==="eliminar"||d==="reject"||d.includes("rechazar")?"text-red-600":d==="sign"||d.includes("firmar")?"text-green-600":d.includes("download")||d.includes("descargar")?"text-blue-600":d.includes("email")||d.includes("enviar")?"text-green-600":d.includes("signature")||d.includes("firma")?"text-purple-600":"text-gray-600"},k=F=>{const d=F.toLowerCase();return d.includes("delete")||d==="eliminar"||d==="reject"||d.includes("rechazar")?"border-red-200 bg-red-50 text-red-700 hover:bg-red-100 hover:border-red-300":d==="sign"||d.includes("firmar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":d.includes("download")||d.includes("descargar")?"border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 hover:border-blue-300":d.includes("email")||d.includes("enviar")?"border-green-200 bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300":d.includes("signature")||d.includes("firma")?"border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-100 hover:border-purple-300":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-300"},{isBasicUser:Z,handleFeatureAccess:q}=ps(),z=["formalize","letterhead","relationships","downloadWord","email"],oe=F=>{const d=F.toLowerCase();return z.some(T=>d===T.toLowerCase())},le=F=>{const d=C.value.find(E=>E.action===F?E:E.children?E.children.find(X=>X.action===F):null),T=d!=null&&d.children?d.children.find(E=>E.action===F):d;if(T!=null&&T.disabled){q("Esta funcionalidad",null);return}u("action",F,i.document)},ae=()=>{u("close")};return(F,d)=>ke((s(),ne(Ge,null,{default:A(()=>{var T;return[e("div",Tn,[e("div",An,[jn,e("p",Mn,p(((T=a.document)==null?void 0:T.title)||"Cargando..."),1),e("button",{onClick:ae,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500 transition-colors"},[r(t(Ee),{class:"h-6 w-6"})])]),e("div",Pn,[e("div",Ln,[(s(!0),o(ge,null,he(x.value,(E,X)=>(s(),o("div",{key:X,class:"space-y-2"},[E.title?(s(),o("h3",Bn,p(E.title),1)):f("",!0),e("div",Rn,[(s(!0),o(ge,null,he(E.options,b=>{var j,J,H;return s(),o("div",{key:b.action,class:"relative group"},[e("button",{onClick:ce=>le(b.action),disabled:b.disabled,class:M(["flex items-center justify-start w-full px-4 py-3 rounded-lg border transition-all duration-200",b.disabled?"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed opacity-60":k(b.action),"hover:shadow-md hover:scale-[1.02]"])},[(s(),ne(_s(S(b.action)),{class:M(["h-5 w-5 mr-3 flex-shrink-0",b.disabled?"text-gray-400":v(b.action)])},null,8,["class"])),e("span",In,p(b.label),1),b.disabled?(s(),ne(t(Es),{key:0,class:"h-4 w-4 ml-auto text-gray-400"})):f("",!0)],10,zn),b.disabled&&b.action==="relationships"&&!t(Z)&&((j=a.document)==null?void 0:j.state)==="Progress"?(s(),o("div",Un,[re(" Solo puedes administrar asociaciones cuando el documento está completado. "),Nn])):b.disabled&&b.action==="relationships"&&!t(Z)?(s(),o("div",On,[re(" Este documento no tiene documentos asociados. "),qn])):b.disabled&&b.action==="formalize"&&((J=a.document)==null?void 0:J.state)!=="Completed"?(s(),o("div",Vn,[re(" Solo puedes formalizar y agregar firmas cuando el documento está completado. "),Qn])):b.disabled&&["downloadPDF","downloadWord","email"].includes(b.action)&&((H=a.document)==null?void 0:H.state)!=="Completed"?(s(),o("div",Wn,[re(" Solo puedes usar esta acción cuando el documento está completado. "),Hn])):b.disabled&&t(Z)&&oe(b.action)?(s(),o("div",Gn,[re(" Actualiza tu suscripción para usar esta funcionalidad "),Zn])):f("",!0)])}),128))]),X<x.value.length-1?(s(),o("div",Jn)):f("",!0)]))),128)),x.value.length===0?(s(),o("div",Kn,[r(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),Yn,Xn])):f("",!0)])])])]}),_:1},512)),[[ht,a.isVisible]])}},el={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},tl={class:"mb-4"},sl={class:"relative w-full"},ol={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},al={class:"flex items-center gap-2 min-w-0"},rl={class:"truncate"},nl={class:"py-1"},ll=["onClick"],il={class:"flex items-center gap-2 min-w-0"},dl={class:"truncate"},cl={class:"p-2"},ul={class:"relative mb-2"},ml={class:"max-h-60 overflow-y-auto"},gl=["onClick"],pl={class:"truncate"},hl={class:"flex items-center gap-2 min-w-0"},fl={class:"truncate"},yl={class:"p-2"},vl={class:"relative mb-2"},bl={class:"max-h-60 overflow-y-auto"},xl=["onClick"],_l={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},wl={class:"flex flex-col gap-1"},$l=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),kl={class:"flex flex-col gap-1"},Cl=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),Dl={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},Fl={class:"py-1"},Sl=["onClick"],El={class:"flex gap-2 w-full sm:w-auto"},Tl=e("span",null,"Limpiar filtros",-1),Al={key:0,class:"flex justify-center items-center py-12 bg-white rounded-lg shadow-sm border border-gray-200"},jl=e("div",{class:"text-center"},[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e("p",{class:"text-sm text-gray-500"},"Cargando documentos...")],-1),Ml=[jl],Pl={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},Ll={class:"overflow-x-auto"},Bl={class:"min-w-full divide-y divide-gray-200"},Rl={class:"bg-gray-50"},zl={key:0,scope:"col",class:"w-12 px-3 py-3"},Il=["checked"],Ul=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento ",-1),Nl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),Ol=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Contraparte ",-1),ql=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Objeto ",-1),Vl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Valor ",-1),Ql=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plazo ",-1),Wl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha Suscripción ",-1),Hl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha Inicio ",-1),Gl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha Terminación ",-1),Zl={key:1,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Jl=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas ",-1),Kl={class:"bg-white divide-y divide-gray-200"},Yl=["onClick"],Xl={key:0,class:"px-3 py-4"},ei=["checked","onChange"],ti={class:"px-6 py-4"},si={class:"flex items-center gap-3"},oi={class:"min-w-0"},ai={class:"text-sm font-medium text-gray-900 hover:text-secondary truncate block max-w-xs text-left"},ri={class:"px-6 py-4 whitespace-nowrap"},ni={class:"px-6 py-4 whitespace-nowrap"},li={class:"text-sm text-gray-900"},ii={class:"px-6 py-4 whitespace-nowrap"},di={class:"text-sm text-gray-900 line-clamp-2 max-w-xs"},ci={class:"px-6 py-4 whitespace-nowrap"},ui={class:"text-sm text-gray-900"},mi={class:"px-6 py-4 whitespace-nowrap"},gi={class:"text-sm text-gray-900"},pi={class:"px-6 py-4 whitespace-nowrap text-xs text-gray-900"},hi={key:0},fi={key:1,class:"text-gray-400"},yi={class:"px-6 py-4 whitespace-nowrap text-xs text-gray-900"},vi={key:0},bi={key:1,class:"text-gray-400"},xi={class:"px-6 py-4 whitespace-nowrap text-xs text-gray-900"},_i={key:0},wi={key:1,class:"text-gray-400"},$i={key:1,class:"px-6 py-4 whitespace-nowrap"},ki=["onClick"],Ci={key:1,class:"text-sm text-gray-400"},Di={class:"px-6 py-4"},Fi={class:"flex flex-wrap gap-1"},Si=["onClick"],Ei={key:0,class:"bg-gray-50 px-4 py-3 border-t border-gray-200 sm:px-6"},Ti={class:"flex items-center justify-between"},Ai={class:"flex-1 flex justify-between sm:hidden"},ji=["disabled"],Mi=["disabled"],Pi={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},Li={class:"text-sm text-gray-700"},Bi={class:"font-medium"},Ri={class:"font-medium"},zi={class:"font-medium"},Ii={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},Ui=["disabled"],Ni=["onClick"],Oi=["disabled"],qi={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Vi=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos",-1),Qi={class:"mt-1 text-sm text-gray-500"},Wi={key:11,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4"},Hi={class:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] flex flex-col"},Gi={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},Zi={class:"flex items-center gap-2"},Ji=e("h2",{class:"text-sm font-semibold text-gray-900"},"Etiquetas del documento",-1),Ki={class:"px-4 py-3 border-b border-gray-100 text-xs text-gray-500"},Yi=e("span",{class:"font-medium text-gray-700"},"Documento:",-1),Xi={class:"ml-1"},ed={class:"px-4 py-3 overflow-y-auto"},td={key:0,class:"text-sm text-gray-500"},sd={key:1,class:"space-y-2 text-sm"},od={class:"flex items-center gap-2 min-w-0"},ad={key:0,class:"text-xs text-gray-500 truncate max-w-[8rem]"},Ut={__name:"DocumentListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null},cardType:{type:String,default:"lawyer",validator:a=>["lawyer","client"].includes(a)},showStateFilter:{type:Boolean,default:!0},showClientFilter:{type:Boolean,default:!1},showAssociationsColumn:{type:Boolean,default:!0},availableStates:{type:Array,default:()=>["Draft","Published","Progress","PendingSignatures","Completed","FullySigned","Rejected","Expired"]},context:{type:String,default:"legal-documents"},isLoading:{type:Boolean,default:!1}},emits:["refresh","open-electronic-signature","update:searchQuery"],setup(a,{emit:$}){const i=qe(),u=Ze(),C=et(),x=a,y=$,{activeModals:S,openModal:v,closeModal:k}=Tt(i,u),Z=B(()=>(S==null?void 0:S.value)||S||{}),q=B(()=>{const g=Z.value;return(g==null?void 0:g.relationships)||{isOpen:!1,document:null}}),{handlePreviewDocument:z,deleteDocument:oe,downloadPDFDocument:le,downloadWordDocument:ae,copyDocument:F,publishDocument:d,moveToDraft:T,formalizeDocument:E,signDocument:X,downloadSignedDocument:b}=At(i,u,y),j=_(""),J=_(""),H=_(""),ce=_(null),U=_(null),G=_(null),Y=_(""),P=_(""),R=_("recent"),te=_([]),ve=_(!1),I=_(null),W=_(!1),N=_(null),K=_(1),be=_(20),_e=B(()=>x.cardType==="lawyer"&&x.context==="legal-documents");B(()=>!1);const xe=B(()=>{if(x.promptDocuments)return x.promptDocuments;const g=u.currentUser;return x.cardType==="lawyer"&&x.context==="legal-documents"?!(g!=null&&g.id)||typeof i.getDocumentsByLawyerId!="function"?[]:i.getDocumentsByLawyerId(g.id)||[]:x.cardType==="client"&&x.context==="my-documents"?!(g!=null&&g.id)||typeof i.progressAndCompletedDocumentsByClient!="function"?[]:i.progressAndCompletedDocumentsByClient(g.id)||[]:i.documents||[]}),Te=B(()=>{const g=new Map;return xe.value.forEach(m=>{var Q;(Q=m.tags)==null||Q.forEach(h=>{g.has(h.id)||g.set(h.id,h)})}),Array.from(g.values())}),ze=B(()=>{if(!J.value)return Te.value;const g=J.value.toLowerCase();return Te.value.filter(m=>m.name.toLowerCase().includes(g))}),Ie=B(()=>{if(!U.value)return null;const g=Te.value.find(m=>m.id===U.value);return(g==null?void 0:g.name)||null}),ee=B(()=>{if(x.cardType!=="lawyer")return[];const g=new Map;return xe.value.forEach(m=>{m.client&&g.set(m.client.id,m.client)}),Array.from(g.values())}),ie=B(()=>{if(!H.value)return ee.value;const g=H.value.toLowerCase();return ee.value.filter(m=>`${m.first_name} ${m.last_name}`.toLowerCase().includes(g))}),me=B(()=>{if(!G.value)return null;const g=ee.value.find(m=>m.id===G.value);return g?`${g.first_name} ${g.last_name}`:null}),Ce=B(()=>!x.selectedTags||!x.selectedTags.length?[]:x.selectedTags.map(g=>typeof g=="object"?g.id:g)),Se=B(()=>{let g=xe.value;const m=(j.value||"").toLowerCase();return m&&(g=g.filter(Q=>{var h,ye;return((h=Q.title)==null?void 0:h.toLowerCase().includes(m))||((ye=Q.code)==null?void 0:ye.toLowerCase().includes(m))})),ce.value&&(g=g.filter(Q=>Q.state===ce.value)),(Y.value||P.value)&&(g=g.filter(Q=>{const h=Q.summary_subscription_date||Q.created_at||Q.updated_at;if(!h)return!1;const ye=new Date(h);if(isNaN(ye.getTime()))return!1;if(Y.value){const Ae=new Date(Y.value);if(ye<Ae)return!1}if(P.value){const Ae=new Date(P.value);if(Ae.setHours(23,59,59,999),ye>Ae)return!1}return!0})),U.value&&(g=g.filter(Q=>{var h;return(h=Q.tags)==null?void 0:h.some(ye=>ye.id===U.value)})),Ce.value.length>0&&(g=g.filter(Q=>{var h;return(h=Q.tags)==null?void 0:h.some(ye=>Ce.value.includes(ye.id))})),G.value&&x.cardType==="lawyer"&&(g=g.filter(Q=>{var h;return((h=Q.client)==null?void 0:h.id)===G.value})),g}),Me=()=>{ce.value=null,U.value=null,G.value=null,Y.value="",P.value=""},c=B(()=>{if(x.cardType!=="lawyer"||x.context!=="legal-documents")return!1;const g=Se.value;return g.length?g.every(m=>m.state==="Draft"||m.state==="Published"):!1}),n=B(()=>{const g=[...Se.value];switch(R.value){case"recent":return g.sort((m,Q)=>new Date(Q.updated_at)-new Date(m.updated_at));case"oldest":return g.sort((m,Q)=>new Date(m.updated_at)-new Date(Q.updated_at));case"name-asc":return g.sort((m,Q)=>(m.title||"").localeCompare(Q.title||""));case"name-desc":return g.sort((m,Q)=>(Q.title||"").localeCompare(m.title||""));default:return g}}),l=B(()=>{const g=(K.value-1)*be.value,m=g+be.value;return n.value.slice(g,m)}),L=B(()=>Math.ceil(n.value.length/be.value)),V=B(()=>{const g=L.value,m=K.value,Q=[];if(g<=7)for(let h=1;h<=g;h++)Q.push(h);else if(m<=4){for(let h=1;h<=5;h++)Q.push(h);Q.push("..."),Q.push(g)}else if(m>=g-3){Q.push(1),Q.push("...");for(let h=g-4;h<=g;h++)Q.push(h)}else Q.push(1),Q.push("..."),Q.push(m-1),Q.push(m),Q.push(m+1),Q.push("..."),Q.push(g);return Q}),de=B(()=>l.value.length>0&&l.value.every(g=>te.value.includes(g.id))),Pe=[{value:"recent",label:"Más recientes"},{value:"oldest",label:"Más antiguos"},{value:"name-asc",label:"Nombre (A-Z)"},{value:"name-desc",label:"Nombre (Z-A)"}],De=g=>{var m;return((m=Pe.find(Q=>Q.value===g))==null?void 0:m.label)||"Ordenar"},Ue=g=>({Draft:"Borrador",Published:"Publicado",Progress:"En Progreso",PendingSignatures:"Pendiente de Firmas",Completed:"Completado",FullySigned:"Firmado",Rejected:"Rechazado",Expired:"Expirado"})[g]||g,Je=g=>Ue(g.state),Ye=g=>({Draft:"bg-gray-100 text-gray-800",Published:"bg-blue-100 text-blue-800",Progress:"bg-yellow-100 text-yellow-800",PendingSignatures:"bg-orange-100 text-orange-800",Completed:"bg-green-100 text-green-800",FullySigned:"bg-purple-100 text-purple-800",Rejected:"bg-red-100 text-red-800",Expired:"bg-gray-100 text-gray-800"})[g.state]||"bg-gray-100 text-gray-800",rt=g=>({Draft:"text-gray-500",Published:"text-blue-600",Progress:"text-yellow-600",PendingSignatures:"text-orange-600",Completed:"text-green-600",FullySigned:"text-purple-600",Rejected:"text-red-600",Expired:"text-gray-500"})[g.state]||"text-gray-400",nt=g=>{if(g&&g.color)return{red:"bg-red-100 text-red-800",blue:"bg-blue-100 text-blue-800",green:"bg-green-100 text-green-800",yellow:"bg-yellow-100 text-yellow-800",purple:"bg-purple-100 text-purple-800",pink:"bg-pink-100 text-pink-800",indigo:"bg-indigo-100 text-indigo-800"}[g.color]||"bg-gray-100 text-gray-800";const m=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],Q=g&&typeof g.id=="number"?g.id%m.length:0;return m[Q]},ct=g=>g?new Date(g).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"-",Lt=g=>g.summary_counterparty||"",Bt=g=>{if(!g.summary_value)return"";const m=g.summary_value_currency||"";return m?`${m} ${g.summary_value}`:g.summary_value},ut=g=>["Completed","FullySigned"].includes(g.state),Rt=g=>String(i.lastUpdatedDocumentId)===String(g),vt=g=>{const m=te.value.indexOf(g);m>-1?te.value.splice(m,1):te.value.push(g)},bt=g=>{N.value=g,W.value=!0},xt=()=>{W.value=!1,N.value=null},zt=()=>{if(de.value)te.value=te.value.filter(g=>!l.value.some(m=>m.id===g));else{const g=l.value.map(m=>m.id).filter(m=>!te.value.includes(m));te.value.push(...g)}},O=g=>{I.value=g,ve.value=!0},D=()=>{const g=te.value.length>0?n.value.filter(Xe=>te.value.includes(Xe.id)):n.value,m=["Nombre Minuta","Estado","Etiquetas"],Q=g.map(Xe=>[Xe.title||"",Je(Xe),Xe.tags?Xe.tags.map(It=>It.name).join(", "):""]),h=[m.join(","),...Q.map(Xe=>Xe.map(It=>`"${It}"`).join(","))].join(`
`),ye=new Blob([h],{type:"text/csv;charset=utf-8;"}),Ae=document.createElement("a"),Ke=URL.createObjectURL(ye);Ae.setAttribute("href",Ke),Ae.setAttribute("download",`documentos_${new Date().toISOString().split("T")[0]}.csv`),Ae.style.visibility="hidden",document.body.appendChild(Ae),Ae.click(),document.body.removeChild(Ae)},se=async(g,m)=>{var Q,h;switch(g){case"preview":await z(m);break;case"edit":{const ye=((Q=u.currentUser)==null?void 0:Q.role)||"client";x.cardType==="lawyer"&&x.context==="legal-documents"?v("edit",m,{userRole:ye,renameOnly:!0}):v("edit",m,{userRole:ye})}break;case"editForm":if(x.cardType==="lawyer"&&x.context==="legal-documents")try{const ye=await i.fetchDocumentById(m.id,!0);i.selectedDocument=ye,C.push("/dynamic_document_dashboard/lawyer/variables-config")}catch(ye){console.error("Error al abrir la configuración de variables:",ye)}else v("edit",m,{userRole:"client"});break;case"editDocument":(((h=u.currentUser)==null?void 0:h.role)||"client")==="lawyer"&&x.cardType==="lawyer"?C.push(`/dynamic_document_dashboard/lawyer/editor/edit/${m.id}`):C.push(`/dynamic_document_dashboard/client/editor/edit/${m.id}`);break;case"permissions":v("permissions",m);break;case"relationships":v("relationships",m);break;case"letterhead":v("letterhead",m);break;case"viewSignatures":case"signatures":v("signatures",m);break;case"publish":await d(m);break;case"draft":case"move-to-draft":await T(m);break;case"formalize":await E(m);break;case"sign":await X(m);break;case"delete":await oe(m);break;case"downloadPDF":case"download-pdf":await le(m);break;case"downloadWord":case"download-word":await ae(m);break;case"downloadSignedDocument":case"download-signed":await b(m);break;case"email":case"send":v("email",m);break;case"copy":await F(m);break;default:console.warn("Unknown action:",g)}},w=async(g,m)=>{ve.value=!1,await se(g,m)},ue=({documentId:g,count:m})=>{const Q=i.documents.find(h=>h.id===g);Q&&(Q.relationships_count=m)};return $e(()=>n.value.length,()=>{K.value>L.value&&(K.value=Math.max(1,L.value))}),$e(j,g=>{y("update:searchQuery",g??"")}),$e(()=>x.searchQuery,g=>{g!=null&&(j.value=g)},{immediate:!0}),Qe(async()=>{x.promptDocuments||await i.init(),await u.init()}),(g,m)=>{var Q;return s(),o("div",null,[e("div",el,[e("div",tl,[e("div",sl,[r(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":m[0]||(m[0]=h=>j.value=h),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Fe,j.value]])])]),e("div",ol,[a.showStateFilter?(s(),ne(t(Le),{key:0,as:"div",class:"relative"},{default:A(()=>[r(t(Be),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[e("div",al,[r(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",rl,p(ce.value||"Estado"),1)]),r(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-full min-w-[14rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",nl,[r(t(fe),null,{default:A(({active:h})=>[e("a",{onClick:m[1]||(m[1]=ye=>ce.value=null),class:M([h?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,he(a.availableStates,h=>(s(),ne(t(fe),{key:h},{default:A(({active:ye})=>[e("a",{onClick:Ae=>ce.value=h,class:M([ye?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},p(Ue(h)),11,ll)]),_:2},1024))),128))])]),_:1})]),_:1})):f("",!0),r(t(Le),{as:"div",class:"relative"},{default:A(()=>[r(t(Be),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[e("div",il,[r(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",dl,p(Ie.value||"Etiqueta"),1)]),r(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",cl,[e("div",ul,[r(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":m[2]||(m[2]=h=>J.value=h),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:m[3]||(m[3]=pe(()=>{},["stop"]))},null,512),[[Fe,J.value]])]),e("div",ml,[r(t(fe),null,{default:A(({active:h})=>[e("a",{onClick:m[4]||(m[4]=ye=>U.value=null),class:M([h?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,he(ze.value,h=>(s(),ne(t(fe),{key:h.id},{default:A(({active:ye})=>[e("a",{onClick:Ae=>U.value=h.id,class:M([ye?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:M(["w-3 h-3 rounded-full flex-shrink-0",nt(h)])},null,2),e("span",pl,p(h.name),1)],10,gl)]),_:2},1024))),128))])])]),_:1})]),_:1}),a.showClientFilter?(s(),ne(t(Le),{key:1,as:"div",class:"relative"},{default:A(()=>[r(t(Be),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[e("div",hl,[r(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",fl,p(me.value||"Cliente"),1)]),r(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",yl,[e("div",vl,[r(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":m[5]||(m[5]=h=>H.value=h),type:"text",placeholder:"Buscar clientes...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:m[6]||(m[6]=pe(()=>{},["stop"]))},null,512),[[Fe,H.value]])]),e("div",bl,[r(t(fe),null,{default:A(({active:h})=>[e("a",{onClick:m[7]||(m[7]=ye=>G.value=null),class:M([h?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,he(ie.value,h=>(s(),ne(t(fe),{key:h.id},{default:A(({active:ye})=>[e("a",{onClick:Ae=>G.value=h.id,class:M([ye?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])},p(h.first_name)+" "+p(h.last_name),11,xl)]),_:2},1024))),128))])])]),_:1})]),_:1})):f("",!0)]),e("div",_l,[e("div",wl,[$l,ke(e("input",{"onUpdate:modelValue":m[8]||(m[8]=h=>Y.value=h),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Fe,Y.value]])]),e("div",kl,[Cl,ke(e("input",{"onUpdate:modelValue":m[9]||(m[9]=h=>P.value=h),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Fe,P.value]])])]),e("div",Dl,[r(t(Le),{as:"div",class:"relative w-full sm:w-auto"},{default:A(()=>[r(t(Be),{class:"w-full sm:w-auto inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[r(t(Ps),{class:"h-4 w-4"}),e("span",null,p(De(R.value)),1),r(t(Oe),{class:"h-4 w-4"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-56 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",Fl,[(s(),o(ge,null,he(Pe,h=>r(t(fe),{key:h.value},{default:A(({active:ye})=>[e("a",{onClick:Ae=>R.value=h.value,class:M([ye?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},p(h.label),11,Sl)]),_:2},1024)),64))])]),_:1})]),_:1}),e("div",El,[te.value.length>0?(s(),o("button",{key:0,onClick:D,class:"flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[r(t(ot),{class:"h-4 w-4"}),e("span",null,"Exportar ("+p(te.value.length)+")",1)])):f("",!0),ce.value||U.value||G.value||Y.value||P.value?(s(),o("button",{key:1,onClick:Me,class:"flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-200 rounded-md bg-white text-xs font-medium text-gray-500 hover:bg-gray-50",title:"Limpiar filtros",type:"button"},[r(t(Ee),{class:"h-4 w-4 flex-shrink-0"}),Tl])):f("",!0)])])]),a.isLoading?(s(),o("div",Al,Ml)):!a.isLoading&&l.value.length>0?(s(),o("div",Pl,[e("div",Ll,[e("table",Bl,[e("thead",Rl,[e("tr",null,[_e.value?(s(),o("th",zl,[e("input",{type:"checkbox",checked:de.value,onChange:zt,class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded cursor-pointer"},null,40,Il)])):f("",!0),Ul,Nl,Ol,ql,Vl,Ql,Wl,Hl,Gl,a.showAssociationsColumn&&!c.value?(s(),o("th",Zl," Asociaciones ")):f("",!0),Jl])]),e("tbody",Kl,[(s(!0),o(ge,null,he(l.value,h=>{var ye,Ae;return s(),o("tr",{key:h.id,class:M(["hover:bg-gray-50 cursor-pointer transition-colors duration-150",Rt(h.id)?"bg-yellow-50":""]),onClick:Ke=>O(h)},[_e.value?(s(),o("td",Xl,[e("input",{type:"checkbox",checked:te.value.includes(h.id),onChange:pe(Ke=>vt(h.id),["stop"]),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded cursor-pointer"},null,40,ei)])):f("",!0),e("td",ti,[e("div",si,[r(t(Ne),{class:M(["h-5 w-5 flex-shrink-0",rt(h)])},null,8,["class"]),e("div",oi,[e("span",ai,p(h.title||"Sin título"),1)])])]),e("td",ri,[e("span",{class:M([Ye(h),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},p(Je(h)),3)]),e("td",ni,[e("span",li,p(Lt(h)||"-"),1)]),e("td",ii,[e("span",di,p(h.summary_object||"-"),1)]),e("td",ci,[e("span",ui,p(Bt(h)||"-"),1)]),e("td",mi,[e("span",gi,p(h.summary_term||"-"),1)]),e("td",pi,[h.summary_subscription_date?(s(),o("span",hi,p(ct(h.summary_subscription_date)),1)):(s(),o("span",fi,"-"))]),e("td",yi,[h.summary_start_date?(s(),o("span",vi,p(ct(h.summary_start_date)),1)):(s(),o("span",bi,"-"))]),e("td",xi,[h.summary_end_date?(s(),o("span",_i,p(ct(h.summary_end_date)),1)):(s(),o("span",wi,"-"))]),a.showAssociationsColumn&&!c.value?(s(),o("td",$i,[ut(h)?(s(),o("button",{key:0,onClick:pe(Ke=>t(v)("relationships",h),["stop"]),class:"inline-flex items-center gap-1 text-sm text-secondary hover:text-blue-700"},[r(t(cs),{class:"h-4 w-4"}),e("span",null,p(h.relationships_count||0),1)],8,ki)):(s(),o("span",Ci,p(h.relationships_count||0),1))])):f("",!0),e("td",Di,[e("div",Fi,[(s(!0),o(ge,null,he((ye=h.tags)==null?void 0:ye.slice(0,2),Ke=>(s(),o("span",{key:Ke.id,class:M([nt(Ke),"px-2 py-1 text-xs rounded-full"])},p(Ke.name),3))),128)),((Ae=h.tags)==null?void 0:Ae.length)>2?(s(),o("button",{key:0,type:"button",class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 inline-flex items-center gap-1",onClick:pe(Ke=>bt(h),["stop"])},[e("span",null,"+"+p(h.tags.length-2),1)],8,Si)):f("",!0)])])],10,Yl)}),128))])])]),L.value>1?(s(),o("div",Ei,[e("div",Ti,[e("div",Ai,[e("button",{onClick:m[10]||(m[10]=h=>K.value--),disabled:K.value===1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Anterior ",8,ji),e("button",{onClick:m[11]||(m[11]=h=>K.value++),disabled:K.value===L.value,class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Siguiente ",8,Mi)]),e("div",Pi,[e("div",null,[e("p",Li,[re(" Mostrando "),e("span",Bi,p((K.value-1)*be.value+1),1),re(" a "),e("span",Ri,p(Math.min(K.value*be.value,n.value.length)),1),re(" de "),e("span",zi,p(n.value.length),1),re(" resultados ")])]),e("div",null,[e("nav",Ii,[e("button",{onClick:m[12]||(m[12]=h=>K.value--),disabled:K.value===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[r(t(Ft),{class:"h-5 w-5"})],8,Ui),(s(!0),o(ge,null,he(V.value,h=>(s(),o("button",{key:h,onClick:ye=>typeof h=="number"?K.value=h:null,class:M([h===K.value?"z-10 bg-secondary border-secondary text-white":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50",typeof h=="string"?"cursor-default":"cursor-pointer","relative inline-flex items-center px-4 py-2 border text-sm font-medium"])},p(h),11,Ni))),128)),e("button",{onClick:m[13]||(m[13]=h=>K.value++),disabled:K.value===L.value,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[r(t(ft),{class:"h-5 w-5"})],8,Oi)])])])])])):f("",!0)])):!a.isLoading&&l.value.length===0?(s(),o("div",qi,[r(t(Ne),{class:"mx-auto h-12 w-12 text-gray-400"}),Vi,e("p",Qi,p(x.promptDocuments?"No se encontraron documentos":"Comienza creando un nuevo documento"),1)])):f("",!0),t(tt)?(s(),ne(Qt,{key:3,"is-open":t(tt),document:t(Vt),onClose:m[14]||(m[14]=h=>tt.value=!1)},null,8,["is-open","document"])):f("",!0),t(S).edit.isOpen?(s(),ne(t(Wt),{key:4,"is-open":t(S).edit.isOpen,document:t(S).edit.document,"user-role":t(S).edit.userRole||((Q=t(u).currentUser)==null?void 0:Q.role)||"client","show-editor-button":!t(S).edit.renameOnly,onClose:m[15]||(m[15]=h=>t(k)("edit")),onRefresh:m[16]||(m[16]=h=>y("refresh"))},null,8,["is-open","document","user-role","show-editor-button"])):f("",!0),Z.value.email.isOpen?(s(),ne(t(Ht),{key:5,"is-open":Z.value.email.isOpen,document:Z.value.email.document,onClose:m[17]||(m[17]=h=>t(k)("email")),onRefresh:m[18]||(m[18]=h=>y("refresh"))},null,8,["is-open","document"])):f("",!0),t(S).signatures.isOpen?(s(),ne(t(is),{key:6,"is-open":t(S).signatures.isOpen,document:t(S).signatures.document,onClose:m[19]||(m[19]=h=>t(k)("signatures")),onRefresh:m[20]||(m[20]=h=>y("refresh"))},null,8,["is-open","document"])):f("",!0),t(S).permissions.isOpen?(s(),ne(t(Ts),{key:7,"is-open":t(S).permissions.isOpen,document:t(S).permissions.document,onClose:m[21]||(m[21]=h=>t(k)("permissions")),onRefresh:m[22]||(m[22]=h=>y("refresh"))},null,8,["is-open","document"])):f("",!0),t(S).letterhead.isOpen?(s(),ne(jt,{key:8,"is-visible":t(S).letterhead.isOpen,document:t(S).letterhead.document,onClose:m[23]||(m[23]=h=>t(k)("letterhead")),onRefresh:m[24]||(m[24]=h=>y("refresh"))},null,8,["is-visible","document"])):f("",!0),q.value.isOpen?(s(),ne(St,{key:9,"is-open":q.value.isOpen,document:q.value.document,onClose:m[25]||(m[25]=h=>t(k)("relationships")),onUpdateCount:ue},null,8,["is-open","document"])):f("",!0),ve.value?(s(),ne(Pt,{key:10,"is-visible":ve.value,document:I.value,"card-type":a.cardType,context:x.context||"list","user-store":t(u),onClose:m[26]||(m[26]=h=>ve.value=!1),onRefresh:m[27]||(m[27]=h=>y("refresh")),onAction:w},null,8,["is-visible","document","card-type","context","user-store"])):f("",!0),W.value&&N.value?(s(),o("div",Wi,[e("div",Hi,[e("div",Gi,[e("div",Zi,[r(t(Nt),{class:"h-5 w-5 text-gray-500"}),Ji]),e("button",{type:"button",class:"text-gray-400 hover:text-gray-600 p-1 rounded-md hover:bg-gray-100",onClick:xt},[r(t(Ee),{class:"h-5 w-5"})])]),e("div",Ki,[Yi,e("span",Xi,p(N.value.title||"Sin título"),1)]),e("div",ed,[!N.value.tags||N.value.tags.length===0?(s(),o("div",td," Este documento no tiene etiquetas. ")):(s(),o("ul",sd,[(s(!0),o(ge,null,he(N.value.tags,h=>(s(),o("li",{key:h.id,class:"flex items-center justify-between gap-2"},[e("div",od,[e("span",{class:M(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",nt(h)])},p(h.name),3)]),h.description?(s(),o("span",ad,p(h.description),1)):f("",!0)]))),128))]))]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end"},[e("button",{type:"button",class:"px-4 py-2 text-sm font-medium rounded-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-50",onClick:xt}," Cerrar ")])])])):f("",!0)])}}},rd={class:"mb-4"},nd={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},ld={class:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"},id={class:"flex flex-col sm:flex-row gap-3 flex-1 w-full lg:w-auto"},dd={class:"relative flex-1 min-w-[200px]"},cd={class:"max-w-[120px] truncate"},ud={class:"p-2"},md={class:"relative mb-2"},gd={class:"max-h-60 overflow-y-auto"},pd=["onClick"],hd={class:"truncate"},fd={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},yd={class:"flex items-center gap-3 w-full lg:w-auto"},vd={class:"text-sm text-gray-500 whitespace-nowrap"},bd={class:"py-1"},xd={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200"},_d={class:"min-w-full divide-y divide-gray-200"},wd=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plantilla "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiquetas "),e("th",{scope:"col",class:"w-16 px-6 py-3"})])],-1),$d={class:"bg-white divide-y divide-gray-200"},kd=["onClick"],Cd={class:"px-6 py-4 whitespace-nowrap"},Dd={class:"flex items-center"},Fd={class:"flex-shrink-0 h-10 w-10"},Sd={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},Ed={class:"ml-4"},Td={class:"text-sm font-medium text-gray-900"},Ad=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-700 border border-purple-200"}," Disponible ")],-1),jd={class:"px-6 py-4 whitespace-nowrap"},Md={class:"flex flex-wrap gap-1"},Pd={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},Ld={key:1,class:"text-sm text-gray-400"},Bd={class:"py-1"},Rd=["onClick"],zd={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"},Id=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay plantillas disponibles",-1),Ud={class:"mt-1 text-sm text-gray-500"},Nd=e("div",{class:"mt-4"},[e("div",{class:"text-xs text-gray-400 bg-gray-100 px-3 py-2 rounded-lg inline-block"},[re(" 💡 "),e("strong",null,"Tip:"),re(" Las plantillas son creadas por los abogados ")])],-1),as={__name:"UseDocumentTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["go-back"],setup(a,{emit:$}){const i=qe();Ze();const u=et(),C=$,x=_(""),y=_(""),S=_(null),v=_("recent"),k=_(!1),Z=_(null),q=_({}),z=_({}),oe=_(!1),le=_(-1),ae=B(()=>i.publishedDocumentsUnassigned||[]),F=B(()=>{let I=[...ae.value];const W=x.value.toLowerCase();return W&&(I=I.filter(N=>{var K,be;return((K=N.title)==null?void 0:K.toLowerCase().includes(W))||((be=N.tags)==null?void 0:be.some(_e=>{var xe;return(xe=_e.name)==null?void 0:xe.toLowerCase().includes(W)}))})),S.value&&(I=I.filter(N=>N.tags&&N.tags.some(K=>K.id===S.value))),v.value==="name"?I.sort((N,K)=>{const be=(N.title||"").toLowerCase(),_e=(K.title||"").toLowerCase();return be.localeCompare(_e)}):v.value==="recent"&&I.sort((N,K)=>K.id-N.id),I}),d=B(()=>{const I=new Map;return ae.value.forEach(W=>{W.tags&&W.tags.length>0&&W.tags.forEach(N=>{I.has(N.id)||I.set(N.id,N)})}),Array.from(I.values()).sort((W,N)=>W.name.localeCompare(N.name))}),T=B(()=>{if(!y.value)return d.value;const I=y.value.toLowerCase();return d.value.filter(W=>W.name.toLowerCase().includes(I))}),E=B(()=>{if(!S.value)return null;const I=d.value.find(W=>W.id===S.value);return I?I.name:null}),X=B(()=>{switch(v.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),b=B(()=>{const I=x.value&&x.value.trim().length>0,W=S.value!==null;return I&&W?"No se encontraron plantillas que coincidan con tu búsqueda y filtros":I?"No se encontraron plantillas que coincidan con tu búsqueda":W?"No se encontraron plantillas con la etiqueta seleccionada":"Aún no hay plantillas disponibles para usar"}),j=I=>{const W=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],N=I.id%W.length;return W[N]},J=I=>{const W=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],N=I.id%W.length;return W[N]},H=()=>{S.value=null},ce=I=>{I&&(i.selectedDocument=null,Z.value=I,k.value=!0)},U=()=>{k.value=!1,Z.value=null},G=I=>{if(I.state==="Published"&&!I.assigned_to)ce(I.id);else{const N=`/dynamic_document_dashboard/document/use/editor/${I.id}/${encodeURIComponent(I.title.trim())}`;u.push(N)}},Y=()=>{C("go-back")};Qe(async()=>{(!i.documents||i.documents.length===0)&&await i.init(!0)});const P=()=>oe.value?F.value.length===1?"280px":F.value.length===2&&le.value===1?"340px":"280px":"auto",R=(I,W)=>{I&&(q.value[W]=I)},te=(I,W)=>{I&&(z.value[W]=I)},ve=(I,W)=>{oe.value=!W,le.value=W?-1:I,W||setTimeout(()=>{const N=z.value[I];if(N){const K=N.$el||N;if(K&&K.getBoundingClientRect){const be=K.getBoundingClientRect(),_e=window.innerHeight;if(I===0){if(be.bottom>_e-20){const xe=be.bottom-_e+40;window.scrollBy({top:xe,behavior:"smooth"})}}else if(be.bottom>_e-10){const xe=be.bottom-_e+30;window.scrollBy({top:xe,behavior:"smooth"})}else if(be.top<80){const xe=be.top-100;window.scrollBy({top:xe,behavior:"smooth"})}}}},100)};return(I,W)=>(s(),o("div",null,[e("div",rd,[e("button",{onClick:Y,class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors border border-gray-300"},[r(t(Ls),{class:"h-4 w-4"}),re(" Volver a Mis Documentos ")])]),e("div",nd,[e("div",ld,[e("div",id,[e("div",dd,[r(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":W[0]||(W[0]=N=>x.value=N),type:"text",placeholder:"Buscar plantillas...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent"},null,512),[[Fe,x.value]])]),r(t(Le),{as:"div",class:"relative"},{default:A(()=>[r(t(Be),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[r(t(st),{class:"h-4 w-4"}),e("span",cd,p(E.value||"Etiqueta"),1),r(t(Oe),{class:"h-4 w-4"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-64 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",ud,[e("div",md,[r(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":W[1]||(W[1]=N=>y.value=N),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:W[2]||(W[2]=pe(()=>{},["stop"]))},null,512),[[Fe,y.value]])]),e("div",gd,[r(t(fe),null,{default:A(({active:N})=>[e("a",{onClick:W[3]||(W[3]=K=>S.value=null),class:M([N?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,he(T.value,N=>(s(),ne(t(fe),{key:N.id},{default:A(({active:K})=>[e("a",{onClick:be=>S.value=N.id,class:M([K?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:M(["w-3 h-3 rounded-full flex-shrink-0",J(N)])},null,2),e("span",hd,p(N.name),1)],10,pd)]),_:2},1024))),128)),T.value.length===0?(s(),o("div",fd," No se encontraron etiquetas ")):f("",!0)])])]),_:1})]),_:1}),S.value?(s(),o("button",{key:0,onClick:H,class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[r(t(Ee),{class:"h-4 w-4"}),re(" Limpiar ")])):f("",!0)]),e("div",yd,[e("span",vd," Mostrando "+p(F.value.length)+" plantillas ",1),r(t(Le),{as:"div",class:"relative"},{default:A(()=>[r(t(Be),{class:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[re(" Ordenar: "+p(X.value)+" ",1),r(t(Oe),{class:"h-4 w-4"})]),_:1}),r(t(Re),{class:"absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",bd,[r(t(fe),null,{default:A(({active:N})=>[e("a",{onClick:W[4]||(W[4]=K=>v.value="recent"),class:M([N?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),r(t(fe),null,{default:A(({active:N})=>[e("a",{onClick:W[5]||(W[5]=K=>v.value="name"),class:M([N?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),F.value.length>0?(s(),o("div",xd,[e("div",{class:"overflow-x-auto",style:Ve({minHeight:P()})},[e("table",_d,[wd,e("tbody",$d,[(s(!0),o(ge,null,he(F.value,(N,K)=>{var be;return s(),o("tr",{key:N.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:_e=>G(N)},[e("td",Cd,[e("div",Dd,[e("div",Fd,[e("div",Sd,[r(t(Ne),{class:"h-5 w-5 text-purple-600"})])]),e("div",Ed,[e("div",Td,p(N.title),1)])])]),Ad,e("td",jd,[e("div",Md,[(s(!0),o(ge,null,he((be=N.tags)==null?void 0:be.slice(0,2),_e=>(s(),o("span",{key:_e.id,class:M(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",j(_e)])},p(_e.name),3))),128)),N.tags&&N.tags.length>2?(s(),o("span",Pd," +"+p(N.tags.length-2),1)):f("",!0),!N.tags||N.tags.length===0?(s(),o("span",Ld,"-")):f("",!0)])]),e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:W[6]||(W[6]=pe(()=>{},["stop"]))},[r(t(Le),{as:"div",class:"relative inline-block text-left"},{default:A(({open:_e})=>[r(t(Be),{ref_for:!0,ref:xe=>R(xe,K),onClick:xe=>ve(K,_e),class:"inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100"},{default:A(()=>[r(t(it),{class:"h-5 w-5 text-gray-500"})]),_:2},1032,["onClick"]),r(t(Re),{ref_for:!0,ref:xe=>te(xe,K),class:M([F.value.length>2&&K>0&&K>=F.value.length-3?"absolute right-0 z-[9999] bottom-full mb-2 w-48 origin-bottom-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none":"absolute right-0 z-[9999] mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"])},{default:A(()=>[e("div",Bd,[r(t(fe),null,{default:A(({active:xe})=>[e("a",{onClick:Te=>G(N),class:M([xe?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Usar plantilla ",10,Rd)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1024)])],8,kd)}),128))])])],4)])):(s(),o("div",zd,[r(t(Mt),{class:"mx-auto h-12 w-12 text-gray-400"}),Id,e("p",Ud,p(b.value),1),Nd])),ke(r(Ge,null,{default:A(()=>[Z.value!==null?(s(),ne(ms,{key:0,"document-id":Z.value,onClose:U},null,8,["document-id"])):f("",!0)]),_:1},512),[[ht,k.value]])]))}},Od={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},qd={class:"mb-4"},Vd={class:"relative w-full"},Qd={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},Wd={class:"flex items-center gap-2 min-w-0"},Hd={class:"truncate"},Gd={class:"py-1"},Zd=["onClick"],Jd={class:"flex items-center justify-stretch"},Kd=e("span",null,"Limpiar",-1),Yd={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},Xd={class:"flex flex-col gap-1"},ec=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),tc={class:"flex flex-col gap-1"},sc=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),oc={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},ac={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},rc={class:"flex items-center gap-2"},nc=e("span",{class:"hidden sm:inline"},"Exportar",-1),lc={class:"py-1"},ic=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),dc={class:"py-1"},cc={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},uc={class:"overflow-x-auto",style:{"overflow-y":"visible"}},mc={class:"min-w-full divide-y divide-gray-200"},gc={class:"bg-gray-50"},pc={scope:"col",class:"w-12 px-6 py-3"},hc=["checked"],fc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),yc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),vc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),bc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Docs. Asociados ",-1),xc=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),_c={class:"bg-white divide-y divide-gray-200"},wc=["onClick"],$c=["checked","onChange"],kc={class:"px-6 py-4 whitespace-nowrap"},Cc={class:"flex items-center"},Dc={class:"flex-shrink-0 h-10 w-10"},Fc={class:"h-10 w-10 rounded-lg bg-green-100 flex items-center justify-center"},Sc={class:"ml-4"},Ec={class:"text-sm font-medium text-gray-900"},Tc={class:"px-6 py-4 whitespace-nowrap"},Ac={class:"text-sm text-gray-900"},jc=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-700 border border-green-200"}," Completado ")],-1),Mc={class:"px-6 py-4 whitespace-nowrap"},Pc=["onClick"],Lc={class:"px-6 py-4 whitespace-nowrap"},Bc={class:"flex flex-wrap gap-1"},Rc={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},zc={key:1,class:"text-sm text-gray-400"},Ic={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Uc={class:"flex flex-1 justify-between sm:hidden"},Nc=["disabled"],Oc=["disabled"],qc={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Vc={class:"text-sm text-gray-700"},Qc={class:"font-medium"},Wc={class:"font-medium"},Hc={class:"font-medium"},Gc={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Zc=["disabled"],Jc=e("span",{class:"sr-only"},"Anterior",-1),Kc=["onClick"],Yc={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},Xc=["disabled"],eu=e("span",{class:"sr-only"},"Siguiente",-1),tu={key:0,class:"text-center py-12"},su=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos completados",-1),ou=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos completados por clientes aparecerán aquí.",-1),au={__name:"DocumentFinishedByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(a,{emit:$}){const i=qe(),u=Ze(),C=et(),x=a,y=$,{activeModals:S,openModal:v,closeModal:k,getUserRole:Z}=Tt(i,u),{handlePreviewDocument:q,deleteDocument:z,downloadPDFDocument:oe,downloadWordDocument:le}=At(i,u,y),ae=_(""),F=_(null),d=_(""),T=_(""),E=_("recent"),X=_([]),b=_(1),j=_(10);Qe(()=>{i.init(),u.init()});const J=B(()=>{const c=i.completedDocumentsByClient,n=x.selectedTags?x.selectedTags.map(L=>L.id):[];return i.filteredDocumentsBySearchAndTags(x.searchQuery,u,n).filter(L=>c.some(V=>V.id===L.id))}),H=B(()=>{let c=[...J.value];const n=ae.value.toLowerCase();return n&&(c=c.filter(l=>{var L,V;return((L=l.title)==null?void 0:L.toLowerCase().includes(n))||((V=l.tags)==null?void 0:V.some(de=>{var Pe;return(Pe=de.name)==null?void 0:Pe.toLowerCase().includes(n)}))})),F.value&&(c=c.filter(l=>l.tags&&l.tags.some(L=>L.id===F.value))),(d.value||T.value)&&(c=c.filter(l=>{const L=l.summary_subscription_date||l.created_at||l.updated_at;if(!L)return!1;const V=new Date(L);if(isNaN(V.getTime()))return!1;if(d.value){const de=new Date(d.value);if(V<de)return!1}if(T.value){const de=new Date(T.value);if(de.setHours(23,59,59,999),V>de)return!1}return!0})),E.value==="name"?c.sort((l,L)=>{const V=(l.title||"").toLowerCase(),de=(L.title||"").toLowerCase();return V.localeCompare(de)}):E.value==="recent"&&c.sort((l,L)=>{const V=new Date(l.updated_at||l.created_at);return new Date(L.updated_at||L.created_at)-V}),c}),ce=B(()=>{const c=(b.value-1)*j.value,n=c+j.value;return H.value.slice(c,n)}),U=B(()=>Math.ceil(H.value.length/j.value)),G=B(()=>{const c=(b.value-1)*j.value+1,n=Math.min(b.value*j.value,H.value.length);return{start:c,end:n,total:H.value.length}});$e([ae,F,d,T],()=>{b.value=1});const Y=B(()=>{const c=new Map;return J.value.forEach(n=>{n.tags&&n.tags.length>0&&n.tags.forEach(l=>{c.has(l.id)||c.set(l.id,l)})}),Array.from(c.values()).sort((n,l)=>n.name.localeCompare(l.name))}),P=B(()=>{if(!F.value)return null;const c=Y.value.find(n=>n.id===F.value);return c?c.name:null}),R=B(()=>{switch(E.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),te=c=>c.summary_counterparty?c.summary_counterparty:"Cliente",ve=c=>{const n=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],l=c.id%n.length;return n[l]},I=B(()=>H.value.length>0&&X.value.length===H.value.length),W=()=>{I.value?X.value=[]:X.value=H.value.map(c=>c.id)},N=c=>{const n=X.value.indexOf(c);n>-1?X.value.splice(n,1):X.value.push(c)},K=()=>{X.value=H.value.map(c=>c.id)},be=()=>{X.value=[]},_e=()=>{F.value=null,d.value="",T.value=""},xe=()=>{b.value>1&&b.value--},Te=()=>{b.value<U.value&&b.value++},ze=c=>{c>=1&&c<=U.value&&(b.value=c)},Ie=B(()=>{const c=U.value,n=b.value,l=[];if(c<=7)for(let L=1;L<=c;L++)l.push(L);else if(n<=4){for(let L=1;L<=5;L++)l.push(L);l.push("..."),l.push(c)}else if(n>=c-3){l.push(1),l.push("...");for(let L=c-4;L<=c;L++)l.push(L)}else l.push(1),l.push("..."),l.push(n-1),l.push(n),l.push(n+1),l.push("..."),l.push(c);return l}),ee=()=>{const c=X.value.length>0?H.value.filter(De=>X.value.includes(De.id)):H.value,n=["Nombre Documento","Cliente","Estado","Etiquetas"],l=c.map(De=>[De.title||"",te(De),"Completado",De.tags?De.tags.map(Ue=>Ue.name).join(", "):""]),L=[n.join(","),...l.map(De=>De.map(Ue=>`"${Ue}"`).join(","))].join(`
`),V=new Blob([L],{type:"text/csv;charset=utf-8;"}),de=document.createElement("a"),Pe=URL.createObjectURL(V);de.setAttribute("href",Pe),de.setAttribute("download",`documentos_completados_${new Date().toISOString().split("T")[0]}.csv`),de.style.visibility="hidden",document.body.appendChild(de),de.click(),document.body.removeChild(de)},ie=async(c,n)=>{try{switch(c){case"editForm":v("edit",n,{userRole:Z()});break;case"editDocument":C.push(`/dynamic_document_dashboard/client/editor/edit/${n.id}`);break;case"preview":await q(n);break;case"delete":await z(n);break;case"letterhead":v("letterhead",n);break;case"relationships":v("relationships",n);break;case"downloadPDF":await oe(n);break;case"downloadWord":await le(n);break;case"email":v("email",n);break;default:console.warn("Unknown action:",c)}}catch(l){console.error(`Error executing action ${c}:`,l)}},me=_(!1),Ce=_(null),Se=c=>{Ce.value=c,me.value=!0},Me=async(c,n)=>{me.value=!1,await ie(c,n)};return(c,n)=>(s(),o("div",null,[e("div",Od,[e("div",qd,[e("div",Vd,[r(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":n[0]||(n[0]=l=>ae.value=l),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Fe,ae.value]])])]),e("div",Qd,[r(t(Le),{as:"div",class:"relative"},{default:A(()=>[r(t(Be),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[e("div",Wd,[r(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",Hd,p(P.value||"Etiqueta"),1)]),r(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:A(()=>[e("div",Gd,[r(t(fe),null,{default:A(({active:l})=>[e("a",{onClick:n[1]||(n[1]=L=>F.value=null),class:M([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,he(Y.value,l=>(s(),ne(t(fe),{key:l.id},{default:A(({active:L})=>[e("a",{onClick:V=>F.value=l.id,class:M([L?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},p(l.name),11,Zd)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",Jd,[F.value||d.value||T.value?(s(),o("button",{key:0,onClick:_e,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[r(t(Ee),{class:"h-4 w-4 flex-shrink-0"}),Kd])):f("",!0)])]),e("div",Yd,[e("div",Xd,[ec,ke(e("input",{"onUpdate:modelValue":n[2]||(n[2]=l=>d.value=l),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Fe,d.value]])]),e("div",tc,[sc,ke(e("input",{"onUpdate:modelValue":n[3]||(n[3]=l=>T.value=l),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Fe,T.value]])])]),e("div",oc,[e("div",ac,[e("div",rc,[e("button",{onClick:ee,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[r(t(ot),{class:"h-4 w-4"}),nc]),r(t(Le),{as:"div",class:"relative"},{default:A(()=>[r(t(Be),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:A(()=>[r(t(it),{class:"h-5 w-5 text-gray-500"})]),_:1}),r(t(Re),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",lc,[r(t(fe),null,{default:A(({active:l})=>[e("a",{onClick:K,class:M([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),r(t(fe),null,{default:A(({active:l})=>[e("a",{onClick:be,class:M([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),r(t(Le),{as:"div",class:"relative"},{default:A(()=>[r(t(Be),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[ic,re(" "+p(R.value)+" ",1),r(t(Oe),{class:"h-4 w-4"})]),_:1}),r(t(Re),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",dc,[r(t(fe),null,{default:A(({active:l})=>[e("a",{onClick:n[4]||(n[4]=L=>E.value="recent"),class:M([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),r(t(fe),null,{default:A(({active:l})=>[e("a",{onClick:n[5]||(n[5]=L=>E.value="name"),class:M([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",cc,[e("div",uc,[e("table",mc,[e("thead",gc,[e("tr",null,[e("th",pc,[e("input",{type:"checkbox",checked:I.value,onChange:W,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,hc)]),fc,yc,vc,bc,xc])]),e("tbody",_c,[(s(!0),o(ge,null,he(ce.value,(l,L)=>{var V;return s(),o("tr",{key:l.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:de=>Se(l)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:n[6]||(n[6]=pe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:X.value.includes(l.id),onChange:de=>N(l.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,$c)]),e("td",kc,[e("div",Cc,[e("div",Dc,[e("div",Fc,[r(t(Ne),{class:"h-5 w-5 text-green-600"})])]),e("div",Sc,[e("div",Ec,p(l.title),1)])])]),e("td",Tc,[e("div",Ac,p(te(l)),1)]),jc,e("td",Mc,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100",onClick:pe(de=>t(v)("relationships",l),["stop"])}," Ver asociaciones ",8,Pc)]),e("td",Lc,[e("div",Bc,[(s(!0),o(ge,null,he((V=l.tags)==null?void 0:V.slice(0,2),de=>(s(),o("span",{key:de.id,class:M(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ve(de)])},p(de.name),3))),128)),l.tags&&l.tags.length>2?(s(),o("span",Rc," +"+p(l.tags.length-2),1)):f("",!0),!l.tags||l.tags.length===0?(s(),o("span",zc,"-")):f("",!0)])])],8,wc)}),128))])])]),U.value>1?(s(),o("div",Ic,[e("div",Uc,[e("button",{onClick:xe,disabled:b.value===1,class:M(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",b.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,Nc),e("button",{onClick:Te,disabled:b.value===U.value,class:M(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",b.value===U.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Oc)]),e("div",qc,[e("div",null,[e("p",Vc,[re(" Mostrando "),e("span",Qc,p(G.value.start),1),re(" a "),e("span",Wc,p(G.value.end),1),re(" de "),e("span",Hc,p(G.value.total),1),re(" resultados ")])]),e("div",null,[e("nav",Gc,[e("button",{onClick:xe,disabled:b.value===1,class:M(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",b.value===1?"opacity-50 cursor-not-allowed":""])},[Jc,r(t(Ft),{class:"h-5 w-5","aria-hidden":"true"})],10,Zc),(s(!0),o(ge,null,he(Ie.value,l=>(s(),o(ge,{key:l},[l!=="..."?(s(),o("button",{key:0,onClick:L=>ze(l),class:M(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",b.value===l?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},p(l),11,Kc)):(s(),o("span",Yc," ... "))],64))),128)),e("button",{onClick:Te,disabled:b.value===U.value,class:M(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",b.value===U.value?"opacity-50 cursor-not-allowed":""])},[eu,r(t(ft),{class:"h-5 w-5","aria-hidden":"true"})],10,Xc)])])])])):f("",!0)]),H.value.length===0?(s(),o("div",tu,[r(t(Mt),{class:"mx-auto h-12 w-12 text-gray-400"}),su,ou])):f("",!0),(s(),ne(qt,{to:"body"},[t(S).edit.isOpen?(s(),ne(t(Wt),{key:0,document:t(S).edit.document,"user-role":t(Z)(),onClose:n[7]||(n[7]=l=>t(k)("edit")),onRefresh:n[8]||(n[8]=l=>y("refresh"))},null,8,["document","user-role"])):f("",!0),t(S).email.isOpen?(s(),ne(t(Ht),{key:1,document:t(S).email.document,onClose:n[9]||(n[9]=l=>t(k)("email"))},null,8,["document"])):f("",!0),t(S).letterhead.isOpen?(s(),ne(jt,{key:2,"is-visible":t(S).letterhead.isOpen,document:t(S).letterhead.document,onClose:n[10]||(n[10]=l=>t(k)("letterhead")),onUploaded:n[11]||(n[11]=l=>y("refresh")),onDeleted:n[12]||(n[12]=l=>y("refresh"))},null,8,["is-visible","document"])):f("",!0),t(S).relationships.isOpen?(s(),ne(St,{key:3,"is-open":t(S).relationships.isOpen,document:t(S).relationships.document,onClose:n[13]||(n[13]=l=>t(k)("relationships")),onRefresh:n[14]||(n[14]=l=>y("refresh"))},null,8,["is-open","document"])):f("",!0),me.value?(s(),ne(Pt,{key:4,"is-visible":me.value,document:Ce.value,"card-type":"client",context:"table","user-store":t(u),onClose:n[15]||(n[15]=l=>me.value=!1),onAction:Me},null,8,["is-visible","document","user-store"])):f("",!0)]))]))}},ru={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},nu={class:"mb-4"},lu={class:"relative w-full"},iu={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},du={class:"flex items-center gap-2 min-w-0"},cu={class:"truncate"},uu={class:"py-1"},mu=["onClick"],gu={class:"flex items-center justify-stretch"},pu=e("span",null,"Limpiar",-1),hu={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},fu={class:"flex flex-col gap-1"},yu=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),vu={class:"flex flex-col gap-1"},bu=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),xu={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},_u={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},wu={class:"flex items-center gap-2"},$u=e("span",{class:"hidden sm:inline"},"Exportar",-1),ku={class:"py-1"},Cu=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),Du={class:"py-1"},Fu={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},Su={class:"overflow-x-auto",style:{"overflow-y":"visible"}},Eu={class:"min-w-full divide-y divide-gray-200"},Tu={class:"bg-gray-50"},Au={scope:"col",class:"w-12 px-6 py-3"},ju=["checked"],Mu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),Pu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Cliente ",-1),Lu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1),Bu=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Docs. Asociados ",-1),Ru=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),zu={class:"bg-white divide-y divide-gray-200"},Iu=["onClick"],Uu=["checked","onChange"],Nu={class:"px-6 py-4 whitespace-nowrap"},Ou={class:"flex items-center"},qu={class:"flex-shrink-0 h-10 w-10"},Vu={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},Qu={class:"ml-4"},Wu={class:"text-sm font-medium text-gray-900"},Hu={class:"px-6 py-4 whitespace-nowrap"},Gu={class:"text-sm text-gray-900"},Zu=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-700 border border-blue-200"}," En Progreso ")],-1),Ju={class:"px-6 py-4 whitespace-nowrap"},Ku=["onClick"],Yu={class:"px-6 py-4 whitespace-nowrap"},Xu={class:"flex flex-wrap gap-1"},em={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},tm={key:1,class:"text-sm text-gray-400"},sm={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},om={class:"flex flex-1 justify-between sm:hidden"},am=["disabled"],rm=["disabled"],nm={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},lm={class:"text-sm text-gray-700"},im={class:"font-medium"},dm={class:"font-medium"},cm={class:"font-medium"},um={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},mm=["disabled"],gm=e("span",{class:"sr-only"},"Anterior",-1),pm=["onClick"],hm={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},fm=["disabled"],ym=e("span",{class:"sr-only"},"Siguiente",-1),vm={key:0,class:"text-center py-12"},bm=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay documentos en progreso",-1),xm=e("p",{class:"mt-1 text-sm text-gray-500"},"Los documentos en progreso por clientes aparecerán aquí.",-1),_m={__name:"DocumentInProgressByClientListTable",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(a,{emit:$}){const i=qe(),u=Ze(),C=et(),x=a,y=$,{activeModals:S,openModal:v,closeModal:k,getUserRole:Z}=Tt(i,u),{handlePreviewDocument:q,deleteDocument:z,downloadPDFDocument:oe,downloadWordDocument:le}=At(i,u,y),ae=_(""),F=_(null),d=_(""),T=_(""),E=_("recent"),X=_([]),b=_(1),j=_(10);Qe(()=>{i.init(),u.init()});const J=B(()=>{const c=i.progressDocumentsByClient,n=x.selectedTags?x.selectedTags.map(L=>L.id):[];return i.filteredDocumentsBySearchAndTags(x.searchQuery,u,n).filter(L=>c.some(V=>V.id===L.id))}),H=B(()=>{let c=[...J.value];const n=ae.value.toLowerCase();return n&&(c=c.filter(l=>{var L,V;return((L=l.title)==null?void 0:L.toLowerCase().includes(n))||((V=l.tags)==null?void 0:V.some(de=>{var Pe;return(Pe=de.name)==null?void 0:Pe.toLowerCase().includes(n)}))})),F.value&&(c=c.filter(l=>l.tags&&l.tags.some(L=>L.id===F.value))),(d.value||T.value)&&(c=c.filter(l=>{const L=l.summary_subscription_date||l.created_at||l.updated_at;if(!L)return!1;const V=new Date(L);if(isNaN(V.getTime()))return!1;if(d.value){const de=new Date(d.value);if(V<de)return!1}if(T.value){const de=new Date(T.value);if(de.setHours(23,59,59,999),V>de)return!1}return!0})),E.value==="name"?c.sort((l,L)=>{const V=(l.title||"").toLowerCase(),de=(L.title||"").toLowerCase();return V.localeCompare(de)}):E.value==="recent"&&c.sort((l,L)=>{const V=new Date(l.updated_at||l.created_at);return new Date(L.updated_at||L.created_at)-V}),c}),ce=B(()=>{const c=(b.value-1)*j.value,n=c+j.value;return H.value.slice(c,n)}),U=B(()=>Math.ceil(H.value.length/j.value)),G=B(()=>{const c=(b.value-1)*j.value+1,n=Math.min(b.value*j.value,H.value.length);return{start:c,end:n,total:H.value.length}});$e([ae,F,d,T],()=>{b.value=1});const Y=B(()=>{const c=new Map;return J.value.forEach(n=>{n.tags&&n.tags.length>0&&n.tags.forEach(l=>{c.has(l.id)||c.set(l.id,l)})}),Array.from(c.values()).sort((n,l)=>n.name.localeCompare(l.name))}),P=B(()=>{if(!F.value)return null;const c=Y.value.find(n=>n.id===F.value);return c?c.name:null}),R=B(()=>{switch(E.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),te=c=>c.summary_counterparty?c.summary_counterparty:"Cliente",ve=c=>{const n=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],l=c.id%n.length;return n[l]},I=B(()=>H.value.length>0&&X.value.length===H.value.length),W=()=>{I.value?X.value=[]:X.value=H.value.map(c=>c.id)},N=c=>{const n=X.value.indexOf(c);n>-1?X.value.splice(n,1):X.value.push(c)},K=()=>{X.value=H.value.map(c=>c.id)},be=()=>{X.value=[]},_e=()=>{F.value=null,d.value="",T.value=""},xe=()=>{b.value>1&&b.value--},Te=()=>{b.value<U.value&&b.value++},ze=c=>{c>=1&&c<=U.value&&(b.value=c)},Ie=B(()=>{const c=U.value,n=b.value,l=[];if(c<=7)for(let L=1;L<=c;L++)l.push(L);else if(n<=4){for(let L=1;L<=5;L++)l.push(L);l.push("..."),l.push(c)}else if(n>=c-3){l.push(1),l.push("...");for(let L=c-4;L<=c;L++)l.push(L)}else l.push(1),l.push("..."),l.push(n-1),l.push(n),l.push(n+1),l.push("..."),l.push(c);return l}),ee=()=>{const c=X.value.length>0?H.value.filter(De=>X.value.includes(De.id)):H.value,n=["Nombre Documento","Cliente","Estado","Etiquetas"],l=c.map(De=>[De.title||"",te(De),"En Progreso",De.tags?De.tags.map(Ue=>Ue.name).join(", "):""]),L=[n.join(","),...l.map(De=>De.map(Ue=>`"${Ue}"`).join(","))].join(`
`),V=new Blob([L],{type:"text/csv;charset=utf-8;"}),de=document.createElement("a"),Pe=URL.createObjectURL(V);de.setAttribute("href",Pe),de.setAttribute("download",`documentos_en_progreso_${new Date().toISOString().split("T")[0]}.csv`),de.style.visibility="hidden",document.body.appendChild(de),de.click(),document.body.removeChild(de)},ie=async(c,n)=>{try{switch(c){case"editForm":v("edit",n,{userRole:Z()});break;case"editDocument":C.push(`/dynamic_document_dashboard/client/editor/edit/${n.id}`);break;case"preview":await q(n);break;case"delete":await z(n);break;case"letterhead":v("letterhead",n);break;case"relationships":v("relationships",n);break;case"downloadPDF":await oe(n);break;case"downloadWord":await le(n);break;case"email":v("email",n);break;default:console.warn("Unknown action:",c)}}catch(l){console.error(`Error executing action ${c}:`,l)}},me=_(!1),Ce=_(null),Se=c=>{Ce.value=c,me.value=!0},Me=async(c,n)=>{me.value=!1,await ie(c,n)};return(c,n)=>(s(),o("div",null,[e("div",ru,[e("div",nu,[e("div",lu,[r(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":n[0]||(n[0]=l=>ae.value=l),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Fe,ae.value]])])]),e("div",iu,[r(t(Le),{as:"div",class:"relative"},{default:A(()=>[r(t(Be),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[e("div",du,[r(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",cu,p(P.value||"Etiqueta"),1)]),r(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto"},{default:A(()=>[e("div",uu,[r(t(fe),null,{default:A(({active:l})=>[e("a",{onClick:n[1]||(n[1]=L=>F.value=null),class:M([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,he(Y.value,l=>(s(),ne(t(fe),{key:l.id},{default:A(({active:L})=>[e("a",{onClick:V=>F.value=l.id,class:M([L?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])},p(l.name),11,mu)]),_:2},1024))),128))])]),_:1})]),_:1}),e("div",gu,[F.value||d.value||T.value?(s(),o("button",{key:0,onClick:_e,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[r(t(Ee),{class:"h-4 w-4 flex-shrink-0"}),pu])):f("",!0)])]),e("div",hu,[e("div",fu,[yu,ke(e("input",{"onUpdate:modelValue":n[2]||(n[2]=l=>d.value=l),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Fe,d.value]])]),e("div",vu,[bu,ke(e("input",{"onUpdate:modelValue":n[3]||(n[3]=l=>T.value=l),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Fe,T.value]])])]),e("div",xu,[e("div",_u,[e("div",wu,[e("button",{onClick:ee,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[r(t(ot),{class:"h-4 w-4"}),$u]),r(t(Le),{as:"div",class:"relative"},{default:A(()=>[r(t(Be),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:A(()=>[r(t(it),{class:"h-5 w-5 text-gray-500"})]),_:1}),r(t(Re),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",ku,[r(t(fe),null,{default:A(({active:l})=>[e("a",{onClick:K,class:M([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),r(t(fe),null,{default:A(({active:l})=>[e("a",{onClick:be,class:M([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),r(t(Le),{as:"div",class:"relative"},{default:A(()=>[r(t(Be),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[Cu,re(" "+p(R.value)+" ",1),r(t(Oe),{class:"h-4 w-4"})]),_:1}),r(t(Re),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",Du,[r(t(fe),null,{default:A(({active:l})=>[e("a",{onClick:n[4]||(n[4]=L=>E.value="recent"),class:M([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),r(t(fe),null,{default:A(({active:l})=>[e("a",{onClick:n[5]||(n[5]=L=>E.value="name"),class:M([l?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",Fu,[e("div",Su,[e("table",Eu,[e("thead",Tu,[e("tr",null,[e("th",Au,[e("input",{type:"checkbox",checked:I.value,onChange:W,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,ju)]),Mu,Pu,Lu,Bu,Ru])]),e("tbody",zu,[(s(!0),o(ge,null,he(ce.value,(l,L)=>{var V;return s(),o("tr",{key:l.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:de=>Se(l)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:n[6]||(n[6]=pe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:X.value.includes(l.id),onChange:de=>N(l.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Uu)]),e("td",Nu,[e("div",Ou,[e("div",qu,[e("div",Vu,[r(t(Ne),{class:"h-5 w-5 text-blue-600"})])]),e("div",Qu,[e("div",Wu,p(l.title),1)])])]),e("td",Hu,[e("div",Gu,p(te(l)),1)]),Zu,e("td",Ju,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100",onClick:pe(de=>t(v)("relationships",l),["stop"])}," Ver asociaciones ",8,Ku)]),e("td",Yu,[e("div",Xu,[(s(!0),o(ge,null,he((V=l.tags)==null?void 0:V.slice(0,2),de=>(s(),o("span",{key:de.id,class:M(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ve(de)])},p(de.name),3))),128)),l.tags&&l.tags.length>2?(s(),o("span",em," +"+p(l.tags.length-2),1)):f("",!0),!l.tags||l.tags.length===0?(s(),o("span",tm,"-")):f("",!0)])])],8,Iu)}),128))])])]),U.value>1?(s(),o("div",sm,[e("div",om,[e("button",{onClick:xe,disabled:b.value===1,class:M(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",b.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,am),e("button",{onClick:Te,disabled:b.value===U.value,class:M(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",b.value===U.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,rm)]),e("div",nm,[e("div",null,[e("p",lm,[re(" Mostrando "),e("span",im,p(G.value.start),1),re(" a "),e("span",dm,p(G.value.end),1),re(" de "),e("span",cm,p(G.value.total),1),re(" resultados ")])]),e("div",null,[e("nav",um,[e("button",{onClick:xe,disabled:b.value===1,class:M(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",b.value===1?"opacity-50 cursor-not-allowed":""])},[gm,r(t(Ft),{class:"h-5 w-5","aria-hidden":"true"})],10,mm),(s(!0),o(ge,null,he(Ie.value,l=>(s(),o(ge,{key:l},[l!=="..."?(s(),o("button",{key:0,onClick:L=>ze(l),class:M(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",b.value===l?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},p(l),11,pm)):(s(),o("span",hm," ... "))],64))),128)),e("button",{onClick:Te,disabled:b.value===U.value,class:M(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",b.value===U.value?"opacity-50 cursor-not-allowed":""])},[ym,r(t(ft),{class:"h-5 w-5","aria-hidden":"true"})],10,fm)])])])])):f("",!0)]),H.value.length===0?(s(),o("div",vm,[r(t(Mt),{class:"mx-auto h-12 w-12 text-gray-400"}),bm,xm])):f("",!0),(s(),ne(qt,{to:"body"},[t(S).edit.isOpen?(s(),ne(t(Wt),{key:0,document:t(S).edit.document,"user-role":t(Z)(),onClose:n[7]||(n[7]=l=>t(k)("edit")),onRefresh:n[8]||(n[8]=l=>y("refresh"))},null,8,["document","user-role"])):f("",!0),t(S).email.isOpen?(s(),ne(t(Ht),{key:1,document:t(S).email.document,onClose:n[9]||(n[9]=l=>t(k)("email"))},null,8,["document"])):f("",!0),t(S).letterhead.isOpen?(s(),ne(jt,{key:2,"is-visible":t(S).letterhead.isOpen,document:t(S).letterhead.document,onClose:n[10]||(n[10]=l=>t(k)("letterhead")),onUploaded:n[11]||(n[11]=l=>y("refresh")),onDeleted:n[12]||(n[12]=l=>y("refresh"))},null,8,["is-visible","document"])):f("",!0),t(S).relationships.isOpen?(s(),ne(St,{key:3,"is-open":t(S).relationships.isOpen,document:t(S).relationships.document,onClose:n[13]||(n[13]=l=>t(k)("relationships")),onRefresh:n[14]||(n[14]=l=>y("refresh"))},null,8,["is-open","document"])):f("",!0),me.value?(s(),ne(Pt,{key:4,"is-visible":me.value,document:Ce.value,"card-type":"client",context:"table","user-store":t(u),onClose:n[15]||(n[15]=l=>me.value=!1),onAction:Me},null,8,["is-visible","document","user-store"])):f("",!0)]))]))}},wm={class:"bg-white rounded-xl shadow-xl max-w-lg w-full mx-4"},$m={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},km=e("h2",{class:"text-sm font-semibold text-gray-900"}," Información clave del documento ",-1),Cm=e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.8",d:"M6 6l8 8M6 14L14 6"})],-1),Dm=[Cm],Fm={class:"px-4 py-4 space-y-4 text-sm text-gray-800 max-h-[70vh] overflow-y-auto"},Sm={key:0},Em=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Usuario / Contraparte ",-1),Tm={class:"text-gray-900 break-words"},Am={key:1},jm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Objeto ",-1),Mm={class:"text-gray-900 whitespace-pre-line"},Pm={key:2},Lm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Valor ",-1),Bm={class:"text-gray-900 font-medium text-base"},Rm={key:3},zm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Plazo ",-1),Im={class:"text-gray-900"},Um={key:4},Nm=e("div",{class:"text-[11px] font-medium uppercase tracking-wide text-gray-400 mb-0.5"}," Fechas ",-1),Om={class:"space-y-1 text-gray-900"},qm={key:0},Vm=e("span",{class:"font-medium"},"Suscripción:",-1),Qm={class:"ml-1"},Wm={key:1},Hm=e("span",{class:"font-medium"},"Vigencia:",-1),Gm={class:"ml-1"},Zm={key:0},Jm={key:1},Km={key:2},Ym={key:5,class:"text-gray-400 text-sm"},Xm={class:"px-4 py-3 border-t border-gray-100 flex justify-end"},e0={__name:"DocumentSummaryModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close"],setup(a,{emit:$}){const i=a,u=B(()=>i.document&&i.document.summary_counterparty||""),C=B(()=>{if(!i.document||!i.document.summary_value)return"";const v=i.document.summary_value,k=i.document.summary_value_currency||"",Z=new Intl.NumberFormat("es-CO",{minimumFractionDigits:0,maximumFractionDigits:2}).format(v);return k==="USD"?`USD $${Z}`:k==="EUR"?`€${Z}`:k==="COP"?`$${Z} COP`:k?`${k} ${Z}`:`$${Z}`}),x=B(()=>i.document?!!(i.document.summary_subscription_date||i.document.summary_start_date||i.document.summary_end_date):!1),y=B(()=>i.document?!!(u.value||i.document.summary_object||C.value||i.document.summary_term||x.value):!1),S=v=>v?typeof v=="string"?v.split("T")[0]:v:"";return(v,k)=>a.isVisible&&a.document?(s(),o("div",{key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-sm",onClick:k[2]||(k[2]=pe(Z=>v.$emit("close"),["self"]))},[e("div",wm,[e("div",$m,[km,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:k[0]||(k[0]=Z=>v.$emit("close"))},Dm)]),e("div",Fm,[u.value?(s(),o("div",Sm,[Em,e("div",Tm,p(u.value),1)])):f("",!0),a.document.summary_object?(s(),o("div",Am,[jm,e("div",Mm,p(a.document.summary_object),1)])):f("",!0),C.value?(s(),o("div",Pm,[Lm,e("div",Bm,p(C.value),1)])):f("",!0),a.document.summary_term?(s(),o("div",Rm,[zm,e("div",Im,p(a.document.summary_term),1)])):f("",!0),x.value?(s(),o("div",Um,[Nm,e("div",Om,[a.document.summary_subscription_date?(s(),o("div",qm,[Vm,e("span",Qm,p(S(a.document.summary_subscription_date)),1)])):f("",!0),a.document.summary_start_date||a.document.summary_end_date?(s(),o("div",Wm,[Hm,e("span",Gm,[a.document.summary_start_date?(s(),o("span",Zm,p(S(a.document.summary_start_date)),1)):f("",!0),a.document.summary_start_date&&a.document.summary_end_date?(s(),o("span",Jm," → ")):f("",!0),a.document.summary_end_date?(s(),o("span",Km,p(S(a.document.summary_end_date)),1)):f("",!0)])])):f("",!0)])])):f("",!0),y.value?f("",!0):(s(),o("div",Ym," Este documento aún no tiene campos clasificados para mostrar. "))]),e("div",Xm,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 rounded-md text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200",onClick:k[1]||(k[1]=Z=>v.$emit("close"))}," Cerrar ")])])])):f("",!0)}},t0={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-6"},s0={class:"mb-4"},o0={class:"relative w-full"},a0={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3"},r0={class:"flex items-center gap-2 min-w-0"},n0={class:"truncate"},l0={class:"p-2"},i0={class:"relative mb-2"},d0={class:"max-h-60 overflow-y-auto"},c0=["onClick"],u0={class:"truncate"},m0={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},g0={class:"flex items-center justify-stretch"},p0=e("span",null,"Limpiar",-1),h0={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},f0={class:"flex flex-col gap-1"},y0=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha inicio",-1),v0={class:"flex flex-col gap-1"},b0=e("label",{class:"text-xs font-medium text-gray-600"},"Fecha fin",-1),x0={class:"flex flex-col gap-3 pt-4 border-t border-gray-200"},_0={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between"},w0={class:"flex items-center gap-2"},$0=e("span",{class:"hidden sm:inline"},"Exportar",-1),k0={class:"py-1"},C0=e("span",{class:"hidden sm:inline"},"Ordenar:",-1),D0={class:"py-1"},F0={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",style:{"overflow-x":"visible","overflow-y":"hidden"}},S0={class:"overflow-x-auto",style:{"overflow-y":"visible"}},E0={class:"min-w-full divide-y divide-gray-200"},T0={class:"bg-gray-50"},A0={scope:"col",class:"w-12 px-6 py-3"},j0=["checked"],M0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre Documento ",-1),P0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado Firma ",-1),L0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Contraparte ",-1),B0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Objeto ",-1),R0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Valor ",-1),z0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Plazo ",-1),I0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fechas ",-1),U0={key:0,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},N0={key:1,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},O0=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Etiqueta ",-1),q0={class:"bg-white divide-y divide-gray-200"},V0=["onClick"],Q0=["checked","onChange"],W0={class:"px-6 py-4 whitespace-nowrap"},H0={class:"flex items-center"},G0={class:"flex-shrink-0 h-10 w-10"},Z0={class:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center"},J0={class:"ml-4"},K0={class:"text-sm font-medium text-gray-900"},Y0={class:"px-6 py-4 whitespace-nowrap"},X0={class:"px-6 py-4 whitespace-nowrap"},eg={class:"text-sm text-gray-900"},tg={class:"px-6 py-4 whitespace-nowrap"},sg={class:"text-sm text-gray-900 line-clamp-2 max-w-xs"},og={class:"px-6 py-4 whitespace-nowrap"},ag={class:"text-sm text-gray-900"},rg={class:"px-6 py-4 whitespace-nowrap"},ng={class:"text-sm text-gray-900"},lg={class:"px-6 py-4 whitespace-nowrap"},ig={class:"text-xs text-gray-900 space-y-0.5"},dg={key:0},cg=e("span",{class:"font-medium"},"Suscripción:",-1),ug={class:"ml-1"},mg={key:1},gg=e("span",{class:"font-medium"},"Vigencia:",-1),pg={class:"ml-1"},hg={key:0},fg={key:1},yg={key:2},vg={key:2,class:"text-gray-400"},bg={key:0,class:"px-6 py-4 whitespace-nowrap"},xg={key:0,class:"text-sm text-gray-900"},_g={key:1,class:"text-sm text-gray-400"},wg={key:1,class:"px-6 py-4 whitespace-nowrap"},$g=["disabled","onClick"],kg={key:0},Cg={key:1},Dg={class:"px-6 py-4 whitespace-nowrap"},Fg={class:"flex flex-wrap gap-1"},Sg={key:0,class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600"},Eg={key:1,class:"text-sm text-gray-400"},Tg={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Ag={class:"flex flex-1 justify-between sm:hidden"},jg=["disabled"],Mg=["disabled"],Pg={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Lg={class:"text-sm text-gray-700"},Bg={class:"font-medium"},Rg={class:"font-medium"},zg={class:"font-medium"},Ig={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Ug=["disabled"],Ng=e("span",{class:"sr-only"},"Anterior",-1),Og=["onClick"],qg={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700"},Vg=["disabled"],Qg=e("span",{class:"sr-only"},"Siguiente",-1),Wg={key:0,class:"text-center py-12"},Hg={class:"mt-2 text-sm font-medium text-gray-900"},Gg={class:"mt-1 text-sm text-gray-500"},Zg={key:1,class:"text-center py-12"},Jg=e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-secondary"},null,-1),Kg=e("p",{class:"mt-2 text-sm text-gray-500"},"Cargando documentos...",-1),Yg=[Jg,Kg],Xg={key:5,class:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40"},ep={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4"},tp={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},sp=e("h2",{class:"text-sm font-semibold text-gray-900"},"Rechazar documento",-1),op={class:"px-4 py-4 space-y-3 text-sm text-gray-700"},ap={class:"font-semibold"},rp=e("p",{class:"text-xs text-gray-500"}," El rechazo devolverá el documento al abogado creador para que pueda revisarlo, editarlo o archivarlo. ",-1),np=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Motivo del rechazo (opcional) ",-1),lp={key:6,class:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40"},ip={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4"},dp={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},cp=e("h2",{class:"text-sm font-semibold text-gray-900"},"Motivo del rechazo",-1),up={class:"px-4 py-4 text-sm text-gray-700 whitespace-pre-line"},mp={class:"px-4 py-3 border-t border-gray-100 flex justify-end bg-gray-50"},lt={__name:"SignaturesListTable",props:{state:{type:String,required:!0,validator:a=>["PendingSignatures","FullySigned","Archived"].includes(a)},searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","document-fully-signed","document-rejected","open-electronic-signature"],setup(a,{expose:$,emit:i}){const u=a,C=i,x=Ze(),y=qe(),S=et(),{activeModals:v,openModal:k,closeModal:Z,getUserRole:q}=Tt(y,x),{handlePreviewDocument:z,downloadPDFDocument:oe,signDocument:le,downloadSignedDocument:ae}=At(y,x,C);_([]);const F=_(!1),d=_(""),T=_(""),E=_(null),X=_(""),b=_(""),j=_("recent"),J=_([]),H=_(!1),ce=_(null),U=_(1),G=_(10),Y=B(()=>u.state==="PendingSignatures"?"No tienes documentos pendientes por firmar":u.state==="FullySigned"?"No tienes documentos firmados":"No tienes documentos archivados"),P=B(()=>u.state==="PendingSignatures"?"Cuando tengas documentos que requieran tu firma electrónica aparecerán aquí.":u.state==="FullySigned"?"Una vez que firmes documentos electrónicamente, aparecerán aquí.":"Aquí aparecerán los documentos rechazados o expirados relacionados contigo."),R=B(()=>{const O=x.currentUser.role,D=x.currentUser.id,se=x.currentUser.email;let w=[];return O==="lawyer"?u.state==="PendingSignatures"?w=y.pendingSignatureDocuments.filter(ue=>{var Q;const g=ue.created_by===D,m=(Q=ue.signatures)==null?void 0:Q.some(h=>h.signer_email===se);return g||m}):u.state==="FullySigned"?w=y.fullySignedDocuments.filter(ue=>{var Q;const g=ue.created_by===D,m=(Q=ue.signatures)==null?void 0:Q.some(h=>h.signer_email===se&&h.signed);return g||m}):u.state==="Archived"&&(w=y.documents.filter(ue=>{var Q;if(ue.state!=="Rejected"&&ue.state!=="Expired")return!1;const g=ue.created_by===D,m=(Q=ue.signatures)==null?void 0:Q.some(h=>h.signer_email===se);return g||m})):u.state==="PendingSignatures"?w=y.documents.filter(ue=>{var Q;if(ue.state!=="PendingSignatures")return!1;const g=(Q=ue.signatures)==null?void 0:Q.some(h=>h.signer_email===se),m=ue.created_by===D;return g||m}):u.state==="FullySigned"?w=y.documents.filter(ue=>{var Q;if(ue.state!=="FullySigned")return!1;const g=(Q=ue.signatures)==null?void 0:Q.some(h=>h.signer_email===se&&h.signed),m=ue.created_by===D;return g||m}):u.state==="Archived"&&(w=y.documents.filter(ue=>{var Q;if(ue.state!=="Rejected"&&ue.state!=="Expired")return!1;const g=(Q=ue.signatures)==null?void 0:Q.some(h=>h.signer_email===se),m=ue.created_by===D;return g||m})),w}),te=B(()=>{let O=[...R.value];const D=d.value.toLowerCase();return D&&(O=O.filter(se=>{var w,ue;return((w=se.title)==null?void 0:w.toLowerCase().includes(D))||((ue=se.tags)==null?void 0:ue.some(g=>{var m;return(m=g.name)==null?void 0:m.toLowerCase().includes(D)}))})),E.value&&(O=O.filter(se=>se.tags&&se.tags.some(w=>w.id===E.value))),(X.value||b.value)&&(O=O.filter(se=>{const w=se.summary_subscription_date||se.created_at||se.updated_at;if(!w)return!1;const ue=new Date(w);if(isNaN(ue.getTime()))return!1;if(X.value){const g=new Date(X.value);if(ue<g)return!1}if(b.value){const g=new Date(b.value);if(g.setHours(23,59,59,999),ue>g)return!1}return!0})),j.value==="name"?O.sort((se,w)=>{const ue=(se.title||"").toLowerCase(),g=(w.title||"").toLowerCase();return ue.localeCompare(g)}):j.value==="recent"&&O.sort((se,w)=>{const ue=new Date(se.updated_at||se.created_at);return new Date(w.updated_at||w.created_at)-ue}),O}),ve=B(()=>{const O=(U.value-1)*G.value,D=O+G.value;return te.value.slice(O,D)}),I=B(()=>Math.ceil(te.value.length/G.value)),W=B(()=>{const O=(U.value-1)*G.value+1,D=Math.min(U.value*G.value,te.value.length);return{start:O,end:D,total:te.value.length}});$e([d,E,X,b],()=>{U.value=1});const N=B(()=>{const O=new Map;return R.value.forEach(D=>{D.tags&&D.tags.length>0&&D.tags.forEach(se=>{O.has(se.id)||O.set(se.id,se)})}),Array.from(O.values()).sort((D,se)=>D.name.localeCompare(se.name))}),K=B(()=>{if(!T.value)return N.value;const O=T.value.toLowerCase();return N.value.filter(D=>D.name.toLowerCase().includes(O))}),be=B(()=>{if(!E.value)return null;const O=N.value.find(D=>D.id===E.value);return O?O.name:null}),_e=O=>{const D=["bg-blue-500","bg-purple-500","bg-pink-500","bg-yellow-500","bg-green-500","bg-red-500","bg-indigo-500","bg-orange-500"],se=O.id%D.length;return D[se]},xe=B(()=>{switch(j.value){case"name":return"Nombre (A-Z)";case"recent":default:return"Más recientes"}}),Te=O=>{const D=["bg-blue-100 text-blue-700","bg-purple-100 text-purple-700","bg-pink-100 text-pink-700","bg-yellow-100 text-yellow-700","bg-green-100 text-green-700"],se=O.id%D.length;return D[se]},ze=O=>u.state==="FullySigned"?"bg-green-100 text-green-700 border border-green-200":u.state==="Archived"?O.state==="Rejected"?"bg-red-100 text-red-700 border border-red-200":(O.state==="Expired","bg-gray-100 text-gray-700 border border-gray-200"):"bg-yellow-100 text-yellow-700 border border-yellow-200",Ie=O=>u.state==="FullySigned"?"Firmado":u.state==="Archived"?O.state==="Rejected"?"Rechazado":O.state==="Expired"?"Expirado":"Archivado":"Pendiente",ee=B(()=>te.value.length>0&&J.value.length===te.value.length),ie=()=>{ee.value?J.value=[]:J.value=te.value.map(O=>O.id)},me=O=>{const D=J.value.indexOf(O);D>-1?J.value.splice(D,1):J.value.push(O)},Ce=()=>{J.value=te.value.map(O=>O.id)},Se=()=>{J.value=[]},Me=()=>{E.value=null,X.value="",b.value=""},c=()=>{U.value>1&&U.value--},n=()=>{U.value<I.value&&U.value++},l=O=>{O>=1&&O<=I.value&&(U.value=O)},L=O=>O?typeof O=="string"?O.split("T")[0]:O:"",V=B(()=>{const O=I.value,D=U.value,se=[];if(O<=7)for(let w=1;w<=O;w++)se.push(w);else if(D<=4){for(let w=1;w<=5;w++)se.push(w);se.push("..."),se.push(O)}else if(D>=O-3){se.push(1),se.push("...");for(let w=O-4;w<=O;w++)se.push(w)}else se.push(1),se.push("..."),se.push(D-1),se.push(D),se.push(D+1),se.push("..."),se.push(O);return se}),de=()=>{const O=J.value.length>0?te.value.filter(Q=>J.value.includes(Q.id)):te.value,D=["Nombre Documento","Estado Firma","Etiquetas"],se=O.map(Q=>[Q.title||"",Ie(Q),Q.tags?Q.tags.map(h=>h.name).join(", "):""]),w=[D.join(","),...se.map(Q=>Q.map(h=>`"${h}"`).join(","))].join(`
`),ue=new Blob([w],{type:"text/csv;charset=utf-8;"}),g=document.createElement("a"),m=URL.createObjectURL(ue);g.setAttribute("href",m),g.setAttribute("download",`documentos_firmas_${new Date().toISOString().split("T")[0]}.csv`),g.style.visibility="hidden",document.body.appendChild(g),g.click(),document.body.removeChild(g)},Pe=_(!1),De=_(null),Ue=_(!1),Je=_(null),Ye=_(""),rt=_(!1),nt=_(""),ct=O=>{De.value=O,Pe.value=!0},Lt=async(O,D)=>{Pe.value=!1,await Bt(O,D)},Bt=async(O,D)=>{try{switch(O){case"preview":await z(D);break;case"letterhead":k("letterhead",D);break;case"relationships":k("relationships",D);break;case"viewSignatures":k("signatures",D);break;case"sign":await le(D,k);break;case"reject":Je.value=D,Ye.value="",Ue.value=!0;break;case"viewRejectionReason":{const se=(D.signatures||[]).find(w=>w.rejection_comment);se&&se.rejection_comment?(nt.value=se.rejection_comment,rt.value=!0):await we("Este documento no tiene un motivo de rechazo registrado.","info");break}case"downloadSignedDocument":await ae(D);break;case"downloadPDF":await oe(D);break;case"editAndResend":{if(D&&D.id&&D.title){const se=encodeURIComponent(D.title.trim()),w=`/dynamic_document_dashboard/document/use/correction/${D.id}/${se}`;S.push(w)}else console.warn("Cannot navigate to correction mode: invalid document data",D);break}default:console.warn("Unknown action:",O)}}catch(se){console.error(`Error executing action ${O}:`,se)}},ut=()=>{Ue.value=!1,Je.value=null,Ye.value=""},Rt=async()=>{if(!Je.value)return;const O=Je.value,D=O.id,se=x.currentUser.id;try{const w=`dynamic-documents/${D}/reject/${se}/`,ue=Ye.value?{comment:Ye.value}:{},g=await ls(w,ue);g&&(g.status===200||g.status===201)?(ut(),C("document-rejected",O),Promise.all([we("Documento rechazado correctamente.","success"),$s(ks.FINISH,`Rechazaste el documento "${O.title}"`).catch(m=>console.warn("No se pudo registrar la actividad de rechazo:",m)),y.init(!0)]).then(()=>{C("refresh")})):await we("Error al rechazar el documento.","error")}catch(w){console.error("Error rejecting document:",w),await we("Error al rechazar el documento.","error")}},vt=async()=>{F.value=!0;try{await y.init(!0)}catch(O){console.error("Error refreshing documents:",O),we("Error al actualizar documentos","error")}finally{F.value=!1}},bt=async()=>{await vt(),C("refresh")};Qe(async()=>{await vt()}),$({refresh:bt});const xt=O=>{var se;if(!O.summary_counterparty)return null;const D=(se=O.variables)==null?void 0:se.find(w=>w.summary_field==="counterparty");return(D==null?void 0:D.value)||O.summary_counterparty},zt=O=>{if(!O.summary_value)return null;const D=parseFloat(O.summary_value);return isNaN(D)?null:D};return $e(()=>x.currentUser,()=>{bt()}),(O,D)=>{var se;return s(),o("div",null,[e("div",t0,[e("div",s0,[e("div",o0,[r(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":D[0]||(D[0]=w=>d.value=w),type:"text",placeholder:"Buscar...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm"},null,512),[[Fe,d.value]])])]),e("div",a0,[r(t(Le),{as:"div",class:"relative"},{default:A(()=>[r(t(Be),{class:"w-full inline-flex items-center justify-between gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[e("div",r0,[r(t(st),{class:"h-4 w-4 flex-shrink-0"}),e("span",n0,p(be.value||"Etiqueta"),1)]),r(t(Oe),{class:"h-4 w-4 flex-shrink-0"})]),_:1}),r(t(Re),{class:"absolute left-0 z-10 mt-2 w-full min-w-[16rem] origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",l0,[e("div",i0,[r(t(He),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),ke(e("input",{"onUpdate:modelValue":D[1]||(D[1]=w=>T.value=w),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent",onClick:D[2]||(D[2]=pe(()=>{},["stop"]))},null,512),[[Fe,T.value]])]),e("div",d0,[r(t(fe),null,{default:A(({active:w})=>[e("a",{onClick:D[3]||(D[3]=ue=>E.value=null),class:M([w?"bg-gray-100":"","block px-3 py-2 text-sm text-gray-700 cursor-pointer rounded-md"])}," Todos ",2)]),_:1}),(s(!0),o(ge,null,he(K.value,w=>(s(),ne(t(fe),{key:w.id},{default:A(({active:ue})=>[e("a",{onClick:g=>E.value=w.id,class:M([ue?"bg-gray-100":"","flex items-center gap-2 px-3 py-2 text-sm cursor-pointer rounded-md"])},[e("span",{class:M(["w-3 h-3 rounded-full flex-shrink-0",_e(w)])},null,2),e("span",u0,p(w.name),1)],10,c0)]),_:2},1024))),128)),K.value.length===0?(s(),o("div",m0," No se encontraron etiquetas ")):f("",!0)])])]),_:1})]),_:1}),e("div",g0,[E.value||X.value||b.value?(s(),o("button",{key:0,onClick:Me,class:"w-full inline-flex items-center justify-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Limpiar filtros"},[r(t(Ee),{class:"h-4 w-4 flex-shrink-0"}),p0])):f("",!0)])]),e("div",h0,[e("div",f0,[y0,ke(e("input",{"onUpdate:modelValue":D[4]||(D[4]=w=>X.value=w),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha inicio"},null,512),[[Fe,X.value]])]),e("div",v0,[b0,ke(e("input",{"onUpdate:modelValue":D[5]||(D[5]=w=>b.value=w),type:"date",class:"w-full min-w-0 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent text-sm",placeholder:"Fecha fin"},null,512),[[Fe,b.value]])])]),e("div",x0,[e("div",_0,[e("div",w0,[e("button",{onClick:de,class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},[r(t(ot),{class:"h-4 w-4"}),$0]),r(t(Le),{as:"div",class:"relative"},{default:A(()=>[r(t(Be),{class:"inline-flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-100"},{default:A(()=>[r(t(it),{class:"h-5 w-5 text-gray-500"})]),_:1}),r(t(Re),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",k0,[r(t(fe),null,{default:A(({active:w})=>[e("a",{onClick:Ce,class:M([w?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Seleccionar todo ",2)]),_:1}),r(t(fe),null,{default:A(({active:w})=>[e("a",{onClick:Se,class:M([w?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Deseleccionar todo ",2)]),_:1})])]),_:1})]),_:1})]),r(t(Le),{as:"div",class:"relative"},{default:A(()=>[r(t(Be),{class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:A(()=>[C0,re(" "+p(xe.value)+" ",1),r(t(Oe),{class:"h-4 w-4"})]),_:1}),r(t(Re),{class:"absolute left-0 sm:left-auto sm:right-0 z-10 mt-2 w-48 origin-top-left sm:origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:A(()=>[e("div",D0,[r(t(fe),null,{default:A(({active:w})=>[e("a",{onClick:D[6]||(D[6]=ue=>j.value="recent"),class:M([w?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Más recientes ",2)]),_:1}),r(t(fe),null,{default:A(({active:w})=>[e("a",{onClick:D[7]||(D[7]=ue=>j.value="name"),class:M([w?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700 cursor-pointer"])}," Nombre (A-Z) ",2)]),_:1})])]),_:1})]),_:1})])])]),e("div",F0,[e("div",S0,[e("table",E0,[e("thead",T0,[e("tr",null,[e("th",A0,[e("input",{type:"checkbox",checked:ee.value,onChange:ie,class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,j0)]),M0,P0,L0,B0,R0,z0,I0,u.state==="PendingSignatures"?(s(),o("th",U0," Fecha Expiración ")):f("",!0),u.state==="PendingSignatures"||u.state==="FullySigned"?(s(),o("th",N0," Docs. Asociados ")):f("",!0),O0])]),e("tbody",q0,[(s(!0),o(ge,null,he(ve.value,(w,ue)=>{var g;return s(),o("tr",{key:w.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:m=>ct(w)},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:D[8]||(D[8]=pe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:J.value.includes(w.id),onChange:m=>me(w.id),class:"h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary cursor-pointer"},null,40,Q0)]),e("td",W0,[e("div",H0,[e("div",G0,[e("div",Z0,[r(t(Ne),{class:"h-5 w-5 text-purple-600"})])]),e("div",J0,[e("div",K0,p(w.title),1)])])]),e("td",Y0,[e("span",{class:M(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",ze(w)])},p(Ie(w)),3)]),e("td",X0,[e("span",eg,p(xt(w)||"-"),1)]),e("td",tg,[e("span",sg,p(w.summary_object||"-"),1)]),e("td",og,[e("span",ag,p(zt(w)||"-"),1)]),e("td",rg,[e("span",ng,p(w.summary_term||"-"),1)]),e("td",lg,[e("div",ig,[w.summary_subscription_date?(s(),o("div",dg,[cg,e("span",ug,p(L(w.summary_subscription_date)),1)])):f("",!0),w.summary_start_date||w.summary_end_date?(s(),o("div",mg,[gg,e("span",pg,[w.summary_start_date?(s(),o("span",hg,p(L(w.summary_start_date)),1)):f("",!0),w.summary_start_date&&w.summary_end_date?(s(),o("span",fg," → ")):f("",!0),w.summary_end_date?(s(),o("span",yg,p(L(w.summary_end_date)),1)):f("",!0)])])):f("",!0),!w.summary_subscription_date&&!w.summary_start_date&&!w.summary_end_date?(s(),o("span",vg," - ")):f("",!0)])]),u.state==="PendingSignatures"?(s(),o("td",bg,[w.signature_due_date?(s(),o("span",xg,p(L(w.signature_due_date)),1)):(s(),o("span",_g," - "))])):f("",!0),u.state==="PendingSignatures"||u.state==="FullySigned"?(s(),o("td",wg,[e("button",{type:"button",disabled:!w.relationships_count||w.relationships_count===0,class:M(["inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border transition-colors",w.relationships_count&&w.relationships_count>0?"border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100 cursor-pointer":"border-gray-200 text-gray-400 bg-gray-50 cursor-not-allowed opacity-60"]),onClick:pe(m=>t(k)("relationships",w),["stop"])},[w.relationships_count&&w.relationships_count>0?(s(),o("span",kg," Ver asociaciones ("+p(w.relationships_count)+") ",1)):(s(),o("span",Cg," Sin asociaciones "))],10,$g)])):f("",!0),e("td",Dg,[e("div",Fg,[(s(!0),o(ge,null,he((g=w.tags)==null?void 0:g.slice(0,2),m=>(s(),o("span",{key:m.id,class:M(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",Te(m)])},p(m.name),3))),128)),w.tags&&w.tags.length>2?(s(),o("span",Sg," +"+p(w.tags.length-2),1)):f("",!0),!w.tags||w.tags.length===0?(s(),o("span",Eg,"-")):f("",!0)])])],8,V0)}),128))])])]),I.value>1?(s(),o("div",Tg,[e("div",Ag,[e("button",{onClick:c,disabled:U.value===1,class:M(["relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",U.value===1?"opacity-50 cursor-not-allowed":""])}," Anterior ",10,jg),e("button",{onClick:n,disabled:U.value===I.value,class:M(["relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",U.value===I.value?"opacity-50 cursor-not-allowed":""])}," Siguiente ",10,Mg)]),e("div",Pg,[e("div",null,[e("p",Lg,[re(" Mostrando "),e("span",Bg,p(W.value.start),1),re(" a "),e("span",Rg,p(W.value.end),1),re(" de "),e("span",zg,p(W.value.total),1),re(" resultados ")])]),e("div",null,[e("nav",Ig,[e("button",{onClick:c,disabled:U.value===1,class:M(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",U.value===1?"opacity-50 cursor-not-allowed":""])},[Ng,r(t(Ft),{class:"h-5 w-5","aria-hidden":"true"})],10,Ug),(s(!0),o(ge,null,he(V.value,w=>(s(),o(ge,{key:w},[w!=="..."?(s(),o("button",{key:0,onClick:ue=>l(w),class:M(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus:outline-offset-0",U.value===w?"z-10 bg-secondary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"])},p(w),11,Og)):(s(),o("span",qg," ... "))],64))),128)),e("button",{onClick:n,disabled:U.value===I.value,class:M(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",U.value===I.value?"opacity-50 cursor-not-allowed":""])},[Qg,r(t(ft),{class:"h-5 w-5","aria-hidden":"true"})],10,Vg)])])])])):f("",!0)]),te.value.length===0&&!F.value?(s(),o("div",Wg,[r(t(Mt),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",Hg,p(Y.value),1),e("p",Gg,p(P.value),1)])):f("",!0),F.value?(s(),o("div",Zg,Yg)):f("",!0),r(Qt,{isVisible:t(tt),documentData:t(Vt),onClose:D[9]||(D[9]=w=>tt.value=!1)},null,8,["isVisible","documentData"]),(s(),ne(qt,{to:"body"},[t(v).signatures.isOpen?(s(),ne(t(is),{key:0,"document-id":(se=t(v).signatures.document)==null?void 0:se.id,onClose:D[10]||(D[10]=w=>t(Z)("signatures")),onRefresh:D[11]||(D[11]=w=>C("refresh")),onOpenElectronicSignature:D[12]||(D[12]=w=>C("open-electronic-signature"))},null,8,["document-id"])):f("",!0),t(v).letterhead.isOpen?(s(),ne(jt,{key:1,"is-visible":t(v).letterhead.isOpen,document:t(v).letterhead.document,onClose:D[13]||(D[13]=w=>t(Z)("letterhead")),onRefresh:D[14]||(D[14]=w=>C("refresh"))},null,8,["is-visible","document"])):f("",!0),Pe.value?(s(),ne(Pt,{key:2,"is-visible":Pe.value,document:De.value,"card-type":"signatures",context:"table","user-store":t(x),onClose:D[15]||(D[15]=w=>Pe.value=!1),onAction:Lt},null,8,["is-visible","document","user-store"])):f("",!0),t(v).relationships.isOpen?(s(),ne(St,{key:3,"is-open":t(v).relationships.isOpen,document:t(v).relationships.document,readonly:u.state==="PendingSignatures"||u.state==="FullySigned",onClose:D[16]||(D[16]=w=>t(Z)("relationships")),onRefresh:D[17]||(D[17]=w=>C("refresh"))},null,8,["is-open","document","readonly"])):f("",!0),H.value?(s(),ne(e0,{key:4,"is-visible":H.value,document:ce.value,onClose:D[18]||(D[18]=w=>H.value=!1)},null,8,["is-visible","document"])):f("",!0),Ue.value&&Je.value?(s(),o("div",Xg,[e("div",ep,[e("div",tp,[sp,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:ut},[r(t(Ee),{class:"h-5 w-5"})])]),e("div",op,[e("p",null,[re(" Estás a punto de rechazar el documento "),e("span",ap,'"'+p(Je.value.title)+'"',1),re(". ")]),rp,e("div",null,[np,ke(e("textarea",{"onUpdate:modelValue":D[19]||(D[19]=w=>Ye.value=w),rows:"4",class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-secondary focus:border-transparent resize-none",placeholder:"Describe brevemente por qué no estás de acuerdo con el documento..."},null,512),[[Fe,Ye.value]])])]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end gap-2 bg-gray-50"},[e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100",onClick:ut}," Cancelar "),e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700",onClick:Rt}," Rechazar documento ")])])])):f("",!0),rt.value?(s(),o("div",lp,[e("div",ip,[e("div",dp,[cp,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:D[20]||(D[20]=w=>rt.value=!1)},[r(t(Ee),{class:"h-5 w-5"})])]),e("div",up,p(nt.value||"No se encontró un motivo de rechazo para este documento."),1),e("div",mp,[e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100",onClick:D[21]||(D[21]=w=>rt.value=!1)}," Cerrar ")])])])):f("",!0)]))])}}},gp={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},pp={class:"flex justify-end"},hp=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[re(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),fp={class:"mt-2"},yp={class:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t border-gray-200"},vp=["disabled"],bp=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),xp=e("span",null,"Actualizar nombre",-1),_p=[bp,xp],wp=["disabled"],$p=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1),kp={__name:"CreateDocumentByLawyer",emits:["close"],setup(a,{emit:$}){const i=et(),u=qe(),C=$,x=_(""),y=_("");rs(()=>{var oe;(oe=u.selectedDocument)!=null&&oe.title?(x.value=u.selectedDocument.title,y.value=u.selectedDocument.title):(x.value="",y.value="")});const S=oe=>{oe.key==="Escape"&&C("close")};Qe(()=>{document.addEventListener("keydown",S)}),pt(()=>{document.removeEventListener("keydown",S)});const v=B(()=>x.value.trim().length>0),k=B(()=>{var oe;return!!((oe=u.selectedDocument)!=null&&oe.id)}),Z=B(()=>k.value&&x.value.trim()!==y.value.trim()&&x.value.trim().length>0);async function q(){if(k.value&&Z.value)try{const oe={title:x.value.trim()};await u.updateDocument(u.selectedDocument.id,oe),y.value=x.value.trim(),u.selectedDocument.title=x.value.trim(),u.lastUpdatedDocumentId=u.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",u.selectedDocument.id);const le=u.selectedDocument.id;C("close",{updatedDocId:le});const ae=window.location.pathname;ae==="/dynamic_document_dashboard"||ae==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(le)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(oe){console.error("Error updating document name:",oe)}}const z=async()=>{if(!v.value)return;const oe=encodeURIComponent(x.value.trim());k.value?(u.selectedDocument.title=x.value,u.selectedDocument.id&&(u.lastUpdatedDocumentId=u.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",u.selectedDocument.id.toString())),i.push(`/dynamic_document_dashboard/lawyer/editor/edit/${u.selectedDocument.id}`)):(u.selectedDocument={title:x.value.trim()},i.push(`/dynamic_document_dashboard/lawyer/editor/create/${oe}`))};return(oe,le)=>(s(),o("div",gp,[e("div",pp,[e("button",{onClick:le[0]||(le[0]=ae=>C("close"))},[r(t(Ee),{class:"size-6"})])]),e("form",{onSubmit:pe(z,["prevent"])},[e("div",null,[hp,e("div",fp,[ke(e("input",{"onUpdate:modelValue":le[1]||(le[1]=ae=>x.value=ae),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[Fe,x.value]])])]),e("div",yp,[k.value?(s(),o("button",{key:0,type:"button",onClick:q,disabled:!Z.value,class:M(["inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm transition-all duration-200",Z.value?"bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500":"bg-gray-100 text-gray-400 border-2 border-dashed border-gray-300 cursor-not-allowed"])},_p,10,vp)):f("",!0),e("button",{type:"submit",class:M(["inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm transition-all duration-200",v.value?"bg-green-600 text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500":"bg-gray-100 text-gray-400 border-2 border-dashed border-gray-300 cursor-not-allowed"]),disabled:!v.value},[$p,e("span",null,p(k.value?"Editar Documento":"Continuar"),1)],10,wp)])],32)]))}},je=a=>(Ct("data-v-857c746d"),a=a(),Dt(),a),Cp={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Dp={class:"px-6 py-4 border-b border-gray-200"},Fp=je(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gestión de Membrete Global para PDF",-1)),Sp=je(()=>e("p",{class:"text-sm text-gray-500 mt-1"}," La imagen de membrete se usará por defecto solo al generar documentos en PDF. Para documentos Word, se utiliza la plantilla .docx configurada más abajo. ",-1)),Ep={class:"p-6 overflow-y-auto flex-grow"},Tp={key:0,class:"text-center py-10"},Ap=je(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),jp={class:"mt-4 text-gray-500"},Mp={key:1,class:"space-y-6"},Pp={key:0,class:"space-y-4"},Lp=je(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete de imagen para PDF actual",-1)),Bp={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Rp=["src"],zp={class:"mt-4 flex justify-center space-x-3"},Ip=["disabled"],Up={key:1,class:"text-center py-8"},Np=je(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete para PDF",-1)),Op=je(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," No tienes una imagen de membrete global configurada para los documentos PDF. ",-1)),qp=je(()=>e("p",{class:"mt-1 text-xs text-gray-400"}," Este membrete de imagen se aplicará solo a los PDF que no tengan un membrete específico. ",-1)),Vp={class:"space-y-4"},Qp={class:"text-lg font-medium text-gray-900"},Wp={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},Hp={key:0},Gp={class:"mt-4"},Zp=je(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, máximo 10MB. Se usa únicamente para los PDF. ",-1)),Jp=je(()=>e("p",{class:"text-xs text-gray-400 mt-1"},' Dimensiones ideales: 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI) ',-1)),Kp={key:1,class:"space-y-4"},Yp={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Xp={class:"text-gray-400"},eh={key:0,class:"mt-4"},th=["src"],sh={class:"flex justify-center space-x-3"},oh=["disabled"],ah={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},rh={class:"space-y-4 border-t border-gray-200 pt-6"},nh=je(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Plantilla Word para documentos (.docx)",-1)),lh=je(()=>e("p",{class:"text-sm text-gray-500"}," Esta plantilla se usará al descargar documentos en Word. Debe ser un archivo .docx con tu membrete configurado (header, footer o watermark). El contenido del documento se añadirá sobre esa plantilla. ",-1)),ih={key:0,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},dh={class:"text-sm text-gray-700"},ch=je(()=>e("div",{class:"font-medium"},"Plantilla actual:",-1)),uh={class:"mt-1 break-words"},mh={class:"font-mono break-all"},gh={key:0,class:"text-gray-400 ml-2"},ph={class:"mt-3 flex flex-wrap gap-3"},hh=["disabled"],fh={key:1,class:"text-sm text-gray-500"},yh={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},vh={key:0},bh={class:"mt-4"},xh=je(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos .docx, máximo 10MB. ",-1)),_h={key:1,class:"space-y-4"},wh={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},$h={class:"text-gray-400"},kh={class:"flex justify-center space-x-3"},Ch=["disabled"],Dh={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Fh={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},Sh={class:"flex items-center space-x-2"},Eh=je(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete para PDF",-1)),Th=je(()=>e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-yellow-800 mb-2"},"🔄 Prioridad de Membrete"),e("div",{class:"text-sm text-yellow-700 space-y-1"},[e("div",null,[e("strong",null,"1º Prioridad:"),re(" Membrete específico del documento")]),e("div",null,[e("strong",null,"2º Prioridad:"),re(" Membrete global de imagen para PDF del usuario (este)")]),e("div",null,[e("strong",null,"3º Prioridad:"),re(" Sin membrete")])])],-1)),Ah=je(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"📐 Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"2550 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"3300 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporción:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta, 300 DPI)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"±10%")])])])],-1)),jh=je(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🎨 Distribución Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"⚠️ ZONA CRÍTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mantén semi-transparente. El texto del documento se superpone aquí.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, teléfonos, emails, información de contacto.")])])])])])],-1)),Mh=je(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🔧 Consideraciones Técnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Posicionamiento:"),re(" La imagen se centra automáticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Transparencia:"),re(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Márgenes:"),re(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Resolución:"),re(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"⚠️"),e("span",null,[e("strong",null,"Zona crítica:"),re(" Evita elementos gráficos densos en el centro (300-400px de altura)")])])])])],-1)),Ph=je(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"💡 Tips de Diseño Rápido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"• Si solo tienes header, ubícalo en los primeros 120-150px"),e("div",null,"• El resto de la imagen debe ser transparente o blanco"),e("div",null,"• Para footer, usa los últimos 80-120px"),e("div",null,"• El texto se superpone en toda la imagen, mantén el centro claro")])],-1)),Lh={key:3,class:"space-y-2"},Bh={class:"flex"},Rh={class:"text-sm text-yellow-700"},zh={__name:"GlobalLetterheadModal",props:{isVisible:{type:Boolean,default:!1}},emits:["close","uploaded","deleted"],setup(a,{emit:$}){const i=a,u=$;$e(()=>i.isVisible,ee=>{});const C=qe(),x=_(!1),y=_(""),S=_(!1),v=_(!1),k=_(null),Z=_(null),q=_(null),z=_([]),oe=_(null),le=_(!1),ae=_(!1),F=_(null),d=_(!1),T=_(null),E=_(""),X=_(null),b=_(!1),j=_(!1),J=_(null),H=()=>{G(),u("close")},ce=ee=>{const ie=ee.target.files[0];if(!ie)return;if(!ie.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(ie.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}k.value=ie,z.value=[];const me=new FileReader;me.onload=Ce=>{Z.value=Ce.target.result;const Se=new Image;Se.onload=()=>{U(Se.width,Se.height)},Se.src=Ce.target.result},me.readAsDataURL(ie)},U=(ee,ie)=>{const Me=ee/ie,c=2550/3300,n=Math.abs(Me-c)/c;if(ee===2550&&ie===3300){z.value.push("✅ Dimensiones perfectas: 2550 × 3300 píxeles");return}n<=.1?(z.value.push(`ℹ️ Buenas proporciones detectadas: ${ee} × ${ie} píxeles (${Me.toFixed(3)})`),(ee!==2550||ie!==3300)&&z.value.push('💡 Para mejores resultados, usa exactamente 2550 × 3300 píxeles (tamaño carta, 8.5" × 11" a 300 DPI)')):(z.value.push(`⚠️ Proporciones no ideales: ${ee} × ${ie} píxeles (${Me.toFixed(3)})`),z.value.push(`🎯 Proporciones recomendadas: ${c.toFixed(3)} (8.5:11, tamaño carta)`),z.value.push("📐 Considera redimensionar tu imagen a 2550 × 3300 píxeles (tamaño carta)")),(ee<1200||ie<1600)&&z.value.push("⚠️ Imagen muy pequeña - puede verse pixelada en documentos PDF tamaño carta"),(ee>4e3||ie>5e3)&&z.value.push("ℹ️ Imagen muy grande - se redimensionará automáticamente para ajustarse al tamaño carta")},G=()=>{k.value=null,Z.value=null,z.value=[],le.value=!1,oe.value&&(oe.value.value="")},Y=async()=>{var ee;if(k.value){S.value=!0,z.value=[];try{const ie=await C.uploadGlobalLetterheadImage(k.value);(ee=ie.data)!=null&&ee.warnings&&ie.data.warnings.length>0&&(z.value=ie.data.warnings),ae.value=!1,await P(),G(),u("uploaded",ie.data)}catch(ie){console.error("Error uploading global letterhead:",ie),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{S.value=!1}}},P=async()=>{if(!(q.value===null&&ae.value)){ae.value=!0;try{const ee=await C.getGlobalLetterheadImage();ee.data&&(q.value=URL.createObjectURL(ee.data))}catch{q.value=null}}},R=async()=>{await Kt("¿Estás seguro de que deseas eliminar la imagen de membrete global?")&&te()},te=async()=>{v.value=!0;try{await C.deleteGlobalLetterheadImage(),q.value&&URL.revokeObjectURL(q.value),q.value=null,ae.value=!0,u("deleted")}catch(ee){console.error("Error deleting global letterhead:",ee),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{v.value=!1}},ve=ee=>{const ie=ee.target.files[0];if(ie){if(!ie.name.toLowerCase().endsWith(".docx")){alert("Solo se permiten archivos .docx para la plantilla Word");return}if(ie.size>10*1024*1024){alert("El archivo de plantilla no puede ser mayor a 10MB");return}F.value=ie}},I=()=>{F.value=null,J.value&&(J.value.value="")},W=async()=>{var ee;if(F.value){b.value=!0;try{const me=(ee=(await C.uploadGlobalLetterheadWordTemplate(F.value)).data)==null?void 0:ee.template_info;d.value=!0,E.value=(me==null?void 0:me.filename)||F.value.name,X.value=(me==null?void 0:me.size_bytes)||F.value.size,await N(),I()}catch(ie){console.error("Error uploading global Word template:",ie),alert("Error al subir la plantilla Word. Por favor intenta nuevamente.")}finally{b.value=!1}}},N=async()=>{var ee,ie;try{const me=await C.getGlobalLetterheadWordTemplate("blob");if(!me){d.value=!1,T.value&&URL.revokeObjectURL(T.value),T.value=null,E.value="",X.value=null;return}if(me&&me.data){d.value=!0,T.value&&URL.revokeObjectURL(T.value),T.value=URL.createObjectURL(me.data);const Ce=((ee=me.headers)==null?void 0:ee["content-disposition"])||((ie=me.headers)==null?void 0:ie["Content-Disposition"]);let Se="plantilla_word.docx";if(Ce){const Me=Ce.match(/filename="?([^";]+)"?/i);Me&&Me[1]&&(Se=Me[1])}E.value=Se,X.value=me.data.size||null}}catch(me){console.error("Error loading global Word template:",me)}},K=async()=>{await Kt("¿Estás seguro de que deseas eliminar la plantilla Word de membrete global?")&&be()},be=async()=>{j.value=!0;try{await C.deleteGlobalLetterheadWordTemplate(),T.value&&URL.revokeObjectURL(T.value),T.value=null,E.value="",X.value=null,d.value=!1}catch(ee){console.error("Error deleting global Word template:",ee),alert("Error al eliminar la plantilla Word. Por favor intenta nuevamente.")}finally{j.value=!1}},_e=()=>{if(T.value){const ee=document.createElement("a");ee.href=T.value,ee.download=E.value||"membrete-word.docx",document.body.appendChild(ee),ee.click(),document.body.removeChild(ee)}},xe=()=>{if(q.value){const ee=document.createElement("a");ee.href=q.value,ee.download="membrete-global.png",document.body.appendChild(ee),ee.click(),document.body.removeChild(ee)}},Te=()=>{q.value=null},ze=ee=>{if(ee===0)return"0 Bytes";const ie=1024,me=["Bytes","KB","MB","GB"],Ce=Math.floor(Math.log(ee)/Math.log(ie));return parseFloat((ee/Math.pow(ie,Ce)).toFixed(2))+" "+me[Ce]};$e(()=>i.isVisible,ee=>{ee&&(P(),N())});const Ie=()=>{q.value&&URL.revokeObjectURL(q.value),Z.value&&URL.revokeObjectURL(Z.value),T.value&&URL.revokeObjectURL(T.value)};return Qe(()=>{i.isVisible&&P()}),pt(Ie),(ee,ie)=>ke((s(),ne(Ge,null,{default:A(()=>[e("div",Cp,[e("div",Dp,[Fp,Sp,e("button",{onClick:H,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[r(t(Ee),{class:"h-6 w-6"})])]),e("div",Ep,[x.value?(s(),o("div",Tp,[Ap,e("p",jp,p(y.value),1)])):(s(),o("div",Mp,[q.value?(s(),o("div",Pp,[Lp,e("div",Bp,[e("img",{src:q.value,alt:"Membrete de imagen para PDF actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:Te},null,40,Rp),e("div",zp,[e("button",{onClick:xe,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[r(t(ot),{class:"h-4 w-4 mr-2"}),re(" Descargar ")]),e("button",{onClick:R,disabled:v.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[r(t(Ot),{class:"h-4 w-4 mr-2"}),re(" "+p(v.value?"Eliminando...":"Eliminar"),1)],8,Ip)])])])):(s(),o("div",Up,[r(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),Np,Op,qp])),e("div",Vp,[e("h3",Qp,p(q.value?"Reemplazar Membrete de imagen para PDF":"Subir Membrete de imagen para PDF"),1),e("div",Wp,[e("input",{ref_key:"fileInput",ref:oe,type:"file",accept:".png",onChange:ce,class:"hidden"},null,544),k.value?(s(),o("div",Kp,[e("div",Yp,[r(t(kt),{class:"h-5 w-5 text-green-500"}),e("span",null,p(k.value.name),1),e("span",Xp,"("+p(ze(k.value.size))+")",1)]),Z.value?(s(),o("div",eh,[e("img",{src:Z.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,th)])):f("",!0),e("div",sh,[e("button",{onClick:G,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:Y,disabled:S.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[S.value?(s(),o("div",ah)):(s(),ne(t(ts),{key:0,class:"h-4 w-4 mr-2"})),re(" "+p(S.value?"Subiendo...":"Subir Imagen para PDF"),1)],8,oh)])])):(s(),o("div",Hp,[r(t(us),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Gp,[e("button",{onClick:ie[0]||(ie[0]=me=>ee.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG para PDF "),e("button",{onClick:ie[1]||(ie[1]=me=>le.value=!le.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[r(t(es),{class:"h-4 w-4 mr-2"}),re(" "+p(le.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),Zp,Jp]))])]),e("div",rh,[nh,lh,d.value?(s(),o("div",ih,[e("div",dh,[ch,e("div",uh,[e("span",mh,p(E.value||"plantilla_word.docx"),1),X.value?(s(),o("span",gh,"("+p(ze(X.value))+")",1)):f("",!0)])]),e("div",ph,[T.value?(s(),o("button",{key:0,onClick:_e,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[r(t(ot),{class:"h-4 w-4 mr-2"}),re(" Descargar ")])):f("",!0),e("button",{onClick:K,disabled:j.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[r(t(Ot),{class:"h-4 w-4 mr-2"}),re(" "+p(j.value?"Eliminando...":"Eliminar"),1)],8,hh)])])):(s(),o("div",fh," No tienes una plantilla Word configurada. Puedes subir un archivo .docx con tu membrete. ")),e("div",yh,[e("input",{ref_key:"wordTemplateInput",ref:J,type:"file",accept:".docx",onChange:ve,class:"hidden"},null,544),F.value?(s(),o("div",_h,[e("div",wh,[r(t(kt),{class:"h-5 w-5 text-green-500"}),e("span",null,p(F.value.name),1),e("span",$h,"("+p(ze(F.value.size))+")",1)]),e("div",kh,[e("button",{onClick:I,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:W,disabled:b.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[b.value?(s(),o("div",Dh)):(s(),ne(t(ts),{key:0,class:"h-4 w-4 mr-2"})),re(" "+p(b.value?"Subiendo...":"Subir Plantilla"),1)],8,Ch)])])):(s(),o("div",vh,[r(t(at),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",bh,[e("button",{onClick:ie[2]||(ie[2]=me=>ee.$refs.wordTemplateInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Plantilla .docx (Word) ")]),xh]))])]),le.value?(s(),o("div",Fh,[e("div",Sh,[r(t(es),{class:"h-6 w-6 text-blue-600"}),Eh]),Th,Ah,jh,Mh,Ph])):f("",!0),z.value.length>0?(s(),o("div",Lh,[(s(!0),o(ge,null,he(z.value,(me,Ce)=>(s(),o("div",{key:Ce,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",Bh,[r(t(Bs),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",Rh,p(me),1)])]))),128))])):f("",!0)]))])])]),_:1},512)),[[ht,a.isVisible]])}},Ih=Et(zh,[["__scopeId","data-v-857c746d"]]),Uh={class:"min-h-screen bg-gray-50"},Nh={class:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8"},Oh={class:"p-4 sm:p-6 lg:p-8"},qh={key:0},Vh={key:0},Qh={key:1},Wh={class:"mb-6 border-b border-gray-200 pb-4"},Hh={class:"hidden md:block"},Gh={class:"flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8 mb-4","aria-label":"Tabs"},Zh=["onClick"],Jh={class:"flex gap-3"},Kh=["disabled"],Yh=e("span",null,"Firma Electrónica",-1),Xh=e("span",null,"Membrete Global",-1),ef=e("span",null,"Nueva Minuta",-1),tf=e("span",null,"Nuevo Documento",-1),sf={class:"md:hidden space-y-3 relative"},of=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),af=[of],rf={key:0,class:"absolute z-20 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden w-full"},nf=["onClick"],lf=["disabled"],df=e("span",{class:"font-medium text-xs leading-tight"},"Firma",-1),cf=e("span",{class:"font-medium text-xs leading-tight"},"Membrete",-1),uf=e("span",{class:"font-medium text-xs leading-tight"},"Nueva Minuta",-1),mf=e("span",{class:"font-medium text-xs leading-tight"},"Nuevo Doc.",-1),gf={key:0},pf={key:1},hf={key:2},ff={key:3},yf={key:4},vf={key:5},bf={key:6},xf={key:7},_f={key:8,class:"mt-6 text-center text-gray-400 font-regular"},wf=e("p",null,"No hay documentos disponibles para mostrar.",-1),$f=[wf],kf={key:1},Cf={class:"mb-6 border-b border-gray-200"},Df={class:"hidden md:flex md:flex-col"},Ff={class:"-mb-px flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},Sf=["onClick"],Ef={class:"flex flex-wrap items-center gap-2 mt-3 mb-4 md:justify-end"},Tf={class:"relative"},Af={class:"relative group"},jf=["disabled"],Mf={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},Pf=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),Lf={class:"md:hidden relative"},Bf=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),Rf=[Bf],zf={key:0,class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},If=["onClick"],Uf={class:"md:hidden mt-4 mb-4 flex flex-col gap-2"},Nf={class:"relative"},Of={class:"relative group"},qf=["disabled"],Vf={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50"},Qf=e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1),Wf={key:0},Hf={key:1},Gf={class:"p-4 sm:p-6"},Zf={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},Jf={class:"flex justify-between items-center p-4 border-b"},Kf=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),Yf={class:"p-4 sm:p-6"},Xf={class:"p-4 sm:p-6"},ey={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},ty={class:"flex justify-between items-center p-4 border-b"},sy=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),oy={class:"p-4 sm:p-6"},My={__name:"Dashboard",setup(a){const $=Ze(),i=qe(),u=Gt(),C=et(),x=Cs(),{isBasicUser:y,handleFeatureAccess:S}=ps(),v=_(""),k=_("default"),Z=_(!1),q=_("folders"),z=_("legal-documents"),oe=_(!1),le=_(!1),ae=_(!1),F=_(!1),d=_(!1),T=_(null),E=_([]),X=_("recent");$e(z,(c,n)=>{},{immediate:!0}),B(()=>[]),B(()=>X.value==="recent"?"Más recientes":"Nombre (A-Z)");const b=B(()=>$.currentUser),j=B(()=>b.value?b.value.role:(C.push("/login"),null)),J=B(()=>{let c=[];j.value==="lawyer"?c=i.draftAndPublishedDocumentsUnassigned:(j.value==="client"||j.value==="basic"||j.value==="corporate_client")&&(c=i.progressAndCompletedDocumentsByClient(b.value.id));const n=E.value&&Array.isArray(E.value)?E.value.map(l=>l.id):[];return i.filteredDocumentsBySearchAndTags(v.value,$,n).filter(l=>c.some(L=>L.id===l.id))}),H=async c=>{k.value=c,i.selectedDocument=null;try{await i.init(!0)}catch(n){console.error("Error loading documents for useDocument section:",n)}},ce=()=>{Z.value=!1,k.value="default",i.selectedDocument=null},U=async()=>{await i.init(!0)},G=()=>{if(!b.value){console.error("Cannot open signature modal: currentUser is not loaded");return}le.value=!0},Y=()=>{if(!b.value){console.error("Cannot open signature modal: currentUser is not loaded");return}oe.value=!0},P=()=>{if(!b.value){console.error("Cannot open signature modal: currentUser is not loaded");return}oe.value=!0},R=async c=>{z.value="signed-documents"},te=async c=>{q.value="signed-documents"},ve=async c=>{try{c&&c.id?await i.fetchDocumentById(c.id,!0):await i.init(!0)}catch(n){console.error("Error refreshing rejected document for lawyer:",n)}z.value="archived-documents"},I=async c=>{try{c&&c.id?await i.fetchDocumentById(c.id,!0):await i.init(!0)}catch(n){console.error("Error refreshing rejected document for client:",n)}q.value="archived-documents"},W=()=>{i.selectedDocument=null,Z.value=!0},N=()=>{H("useDocument")},K=c=>{const{tab:n,searchQuery:l}=c;z.value=n,v.value=l,setTimeout(()=>{},100)},be=()=>{if(!b.value){console.error("Cannot open letterhead modal: currentUser is not loaded");return}S("Membrete Global",()=>{ae.value=!0})},_e=c=>{we("Membrete global subido correctamente","success")},xe=()=>{we("Membrete global eliminado correctamente","success")},Te=async()=>{if(k.value==="useDocument"){k.value="default",j.value==="lawyer"?z.value="my-documents":q.value="my-documents";return}j.value==="lawyer"?z.value="folders":q.value="folders";try{await new Promise(c=>setTimeout(c,100)),await u.fetchFolders(!0)}catch{}};$e(()=>i.lastUpdatedDocumentId,(c,n)=>{if(c&&c!==n&&k.value==="default"){const l=Date.now();(!$e.lastExecutionTime||l-$e.lastExecutionTime>100)&&($e.lastExecutionTime=l,k.value="default")}},{immediate:!1}),$e(F,c=>{}),$e(d,c=>{}),$e(T,c=>{}),$e(()=>x.path,(c,n)=>{c==="/dynamic_document_dashboard"&&n&&n.includes("/document/use/")&&i.init()}),$e(()=>x.query,c=>{c.lawyerTab&&(z.value=c.lawyerTab),c.tab&&(q.value=c.tab)},{immediate:!0});const ze=[{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"archived-documents",label:"Dcs. Archivados"}],Ie=[{name:"legal-documents",label:"Minutas"},{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"archived-documents",label:"Dcs. Archivados"},{name:"finished-documents",label:"Dcs. Clientes"},{name:"in-progress-documents",label:"Dcs. Clientes en Progreso"}],ee=_(!1),ie=_(!1),me=()=>{ee.value=!1,ie.value=!1},Ce=c=>{v.value="",z.value=c,ee.value=!1,me()},Se=c=>{k.value="default",v.value="",q.value=c,ie.value=!1,me()};Qe(async()=>{try{await Promise.all([$.init(),i.init(),u.init()])}catch(n){console.error("Error initializing dynamic document dashboard:",n)}i.selectedDocument=null,k.value="default";const c=localStorage.getItem("lastUpdatedDocumentId");c&&i.documents.some(l=>l.id.toString()===c)&&(i.lastUpdatedDocumentId=parseInt(c))});const Me=async c=>{$.currentUser&&($.currentUser.has_signature=!0),we("Firma electrónica guardada correctamente","success"),setTimeout(()=>{le.value=!1,oe.value=!1},500)};return(c,n)=>{var l,L;return s(),o(ge,null,[e("div",Uh,[e("div",Nh,[ns(c.$slots,"default")]),e("div",Oh,[j.value==="lawyer"?(s(),o("div",qh,[k.value==="useDocument"?(s(),o("div",Vh,[r(as,{searchQuery:v.value,selectedTags:E.value,onGoBack:Te},null,8,["searchQuery","selectedTags"])])):(s(),o("div",Qh,[e("div",Wh,[e("div",Hh,[e("nav",Gh,[(s(),o(ge,null,he(Ie,V=>e("button",{key:V.name,onClick:pe(de=>Ce(V.name),["stop"]),class:M([z.value===V.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},p(V.label),11,Zh)),64))]),e("div",Jh,[e("button",{onClick:pe(G,["stop"]),disabled:!b.value,class:M(["inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-purple-200 text-sm font-medium transition-all duration-200",b.value?"bg-white text-gray-700 hover:bg-purple-50 hover:border-purple-300":"bg-gray-50 text-gray-400 cursor-not-allowed opacity-60"])},[r(t(_t),{class:"size-5 text-purple-500"}),Yh],10,Kh),e("button",{onClick:n[0]||(n[0]=pe(V=>ae.value=!0,["stop"])),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-green-200 bg-white text-sm font-medium text-gray-700 hover:bg-green-50 hover:border-green-300 transition-all duration-200"},[r(t(Ne),{class:"size-5 text-green-500"}),Xh]),z.value==="legal-documents"?(s(),o("button",{key:0,onClick:pe(W,["stop"]),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-secondary bg-secondary text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200"},[r(t(We),{class:"size-5"}),ef])):f("",!0),z.value==="my-documents"?(s(),o("button",{key:1,onClick:pe(N,["stop"]),class:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-secondary bg-secondary text-sm font-medium text-white hover:bg-blue-700 transition-all duration-200"},[r(t(We),{class:"size-5"}),tf])):f("",!0)])]),e("div",sf,[e("button",{onClick:n[1]||(n[1]=pe(V=>ee.value=!ee.value,["stop"])),class:"dropdown-button w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,p(((l=Ie.find(V=>V.name===z.value))==null?void 0:l.label)||"Seleccionar sección"),1),(s(),o("svg",{class:M(["ml-2 h-5 w-5 transition-transform duration-200",ee.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},af,2))]),ee.value?(s(),o("div",rf,[(s(),o(ge,null,he(Ie,V=>e("button",{key:V.name,onClick:pe(de=>Ce(V.name),["stop"]),class:M(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",z.value===V.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},p(V.label),11,nf)),64))])):f("",!0),e("div",{class:M(["grid gap-2",z.value==="legal-documents"||z.value==="my-documents"?"grid-cols-3":"grid-cols-2"])},[e("button",{onClick:pe(G,["stop"]),disabled:!b.value,class:M(["flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-purple-200 text-center transition-all duration-200",b.value?"bg-white hover:bg-purple-50":"bg-gray-50 cursor-not-allowed opacity-60"])},[r(t(_t),{class:"size-6 text-purple-500 mb-1"}),df],10,lf),e("button",{onClick:n[2]||(n[2]=pe(V=>ae.value=!0,["stop"])),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-green-200 bg-white text-center transition-all duration-200 hover:bg-green-50"},[r(t(Ne),{class:"size-6 text-green-500 mb-1"}),cf]),z.value==="legal-documents"?(s(),o("button",{key:0,onClick:pe(W,["stop"]),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-secondary bg-secondary text-white text-center transition-all duration-200 hover:bg-blue-700"},[r(t(We),{class:"size-6 mb-1"}),uf])):f("",!0),z.value==="my-documents"?(s(),o("button",{key:1,onClick:pe(N,["stop"]),class:"flex flex-col items-center justify-center py-3 px-2 rounded-lg border border-secondary bg-secondary text-white text-center transition-all duration-200 hover:bg-blue-700"},[r(t(We),{class:"size-6 mb-1"}),mf])):f("",!0)],2)])]),z.value==="legal-documents"?(s(),o("div",gf,[r(Ut,{searchQuery:v.value,"onUpdate:searchQuery":n[3]||(n[3]=V=>v.value=V),selectedTags:E.value,"is-loading":t(i).isLoading,"card-type":"lawyer","show-state-filter":!0,"show-client-filter":!0,"show-associations-column":!0,context:"legal-documents",onRefresh:U},null,8,["searchQuery","selectedTags","is-loading"])])):f("",!0),z.value==="my-documents"?(s(),o("div",pf,[r(Ut,{searchQuery:v.value,"onUpdate:searchQuery":n[4]||(n[4]=V=>v.value=V),selectedTags:E.value,"is-loading":t(i).isLoading,"card-type":"client","show-state-filter":!0,"show-client-filter":!1,"show-associations-column":!0,context:"my-documents",onRefresh:U},null,8,["searchQuery","selectedTags","is-loading"])])):f("",!0),z.value==="folders"?(s(),o("div",hf,[r(os,{searchQuery:v.value,selectedTags:E.value,onRefresh:U,onNavigateToMain:Te,onNavigateToDocument:K},null,8,["searchQuery","selectedTags"])])):f("",!0),z.value==="pending-signatures"?(s(),o("div",ff,[r(lt,{state:"PendingSignatures",searchQuery:v.value,selectedTags:E.value,onRefresh:U,onOpenElectronicSignature:G,onDocumentFullySigned:R,onDocumentRejected:ve},null,8,["searchQuery","selectedTags"])])):f("",!0),z.value==="signed-documents"?(s(),o("div",yf,[r(lt,{state:"FullySigned",searchQuery:v.value,selectedTags:E.value,onRefresh:U,onOpenElectronicSignature:G},null,8,["searchQuery","selectedTags"])])):f("",!0),z.value==="archived-documents"?(s(),o("div",vf,[r(lt,{state:"Archived",searchQuery:v.value,selectedTags:E.value,onRefresh:U,onOpenElectronicSignature:G},null,8,["searchQuery","selectedTags"])])):f("",!0),z.value==="finished-documents"?(s(),o("div",bf,[r(au,{searchQuery:v.value,selectedTags:E.value},null,8,["searchQuery","selectedTags"])])):f("",!0),z.value==="in-progress-documents"?(s(),o("div",xf,[r(_m,{searchQuery:v.value,selectedTags:E.value},null,8,["searchQuery","selectedTags"])])):f("",!0),J.value.length===0?(s(),o("div",_f,$f)):f("",!0)]))])):f("",!0),j.value==="client"||j.value==="basic"||j.value==="corporate_client"?(s(),o("div",kf,[e("div",Cf,[e("div",Df,[e("nav",Ff,[(s(),o(ge,null,he(ze,V=>e("button",{key:V.name,onClick:pe(de=>Se(V.name),["stop"]),class:M([q.value===V.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},p(V.label),11,Sf)),64))]),e("div",Ef,[e("div",Tf,[e("button",{onClick:pe(Y,["stop"]),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border text-purple-600 hover:bg-purple-50 border-purple-200"},[r(t(_t),{class:"h-4 w-4"}),re(" Firma Electrónica ")])]),e("div",Af,[e("button",{onClick:pe(be,["stop"]),disabled:t(y),class:M(["inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border",t(y)?"text-green-400 bg-gray-50 border-gray-200 cursor-not-allowed opacity-60":"text-green-600 hover:bg-green-50 border-green-200"])},[r(t(Ne),{class:"h-4 w-4"}),re(" Membrete Global ")],10,jf),t(y)?(s(),o("div",Mf,[re(" Actualiza tu suscripción para usar esta funcionalidad "),Pf])):f("",!0)]),e("button",{onClick:n[5]||(n[5]=pe(V=>H("useDocument"),["stop"])),class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[r(t(We),{class:"h-4 w-4"}),re(" Nuevo Documento ")])])]),e("div",Lf,[e("button",{onClick:n[6]||(n[6]=pe(V=>ie.value=!ie.value,["stop"])),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,p(((L=ze.find(V=>V.name===q.value))==null?void 0:L.label)||"Seleccionar sección"),1),(s(),o("svg",{class:M(["ml-2 h-5 w-5 transition-transform duration-200",ie.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Rf,2))]),ie.value?(s(),o("div",zf,[(s(),o(ge,null,he(ze,V=>e("button",{key:V.name,onClick:pe(de=>Se(V.name),["stop"]),class:M(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",q.value===V.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},p(V.label),11,If)),64))])):f("",!0)]),e("div",Uf,[e("div",Nf,[e("button",{onClick:pe(Y,["stop"]),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-purple-600 bg-purple-50 hover:bg-purple-100"},[r(t(_t),{class:"h-5 w-5"}),re(" Firma Electrónica ")])]),e("div",Of,[e("button",{onClick:pe(be,["stop"]),disabled:t(y),class:M(["w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium rounded-lg transition-colors",t(y)?"text-green-400 bg-gray-50 cursor-not-allowed opacity-60":"text-green-600 bg-green-50 hover:bg-green-100"])},[r(t(Ne),{class:"h-5 w-5"}),re(" Membrete Global ")],10,qf),t(y)?(s(),o("div",Vf,[re(" Actualiza tu suscripción para usar esta funcionalidad "),Qf])):f("",!0)]),e("button",{onClick:n[7]||(n[7]=pe(V=>H("useDocument"),["stop"])),class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-white bg-secondary hover:bg-blue-700 rounded-lg transition-colors",type:"button"},[r(t(We),{class:"h-5 w-5"}),re(" Nuevo Documento ")])])]),k.value==="useDocument"?(s(),o("div",Wf,[r(as,{searchQuery:v.value,selectedTags:E.value,onGoBack:Te},null,8,["searchQuery","selectedTags"])])):(s(),o("div",Hf,[q.value==="folders"?(s(),ne(os,{key:0,searchQuery:v.value,selectedTags:E.value,onRefresh:U,onNavigateToMain:Te},null,8,["searchQuery","selectedTags"])):q.value==="my-documents"?(s(),ne(Ut,{key:1,searchQuery:v.value,"onUpdate:searchQuery":n[8]||(n[8]=V=>v.value=V),selectedTags:E.value,"is-loading":t(i).isLoading,"card-type":"client","show-state-filter":!0,"show-client-filter":!1,"show-associations-column":!0,context:"my-documents",onRefresh:U},null,8,["searchQuery","selectedTags","is-loading"])):q.value==="pending-signatures"?(s(),ne(lt,{key:2,state:"PendingSignatures",searchQuery:v.value,selectedTags:E.value,onRefresh:U,onOpenElectronicSignature:P,onDocumentFullySigned:te,onDocumentRejected:I},null,8,["searchQuery","selectedTags"])):q.value==="signed-documents"?(s(),ne(lt,{key:3,state:"FullySigned",searchQuery:v.value,selectedTags:E.value,onRefresh:U,onOpenElectronicSignature:P},null,8,["searchQuery","selectedTags"])):q.value==="archived-documents"?(s(),ne(lt,{key:4,state:"Archived",searchQuery:v.value,selectedTags:E.value,onRefresh:U,onOpenElectronicSignature:P},null,8,["searchQuery","selectedTags"])):f("",!0)]))])):f("",!0)])]),Z.value?(s(),ne(Ge,{key:0},{default:A(()=>[r(kp,{onClose:ce})]),_:1})):f("",!0),le.value&&b.value?(s(),ne(Ge,{key:1},{default:A(()=>[e("div",Gf,[e("div",Zf,[e("div",Jf,[Kf,e("button",{onClick:n[9]||(n[9]=V=>le.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[r(t(Ee),{class:"h-6 w-6"})])]),e("div",Yf,[r(Jt,{"user-id":b.value.id,"initial-show-options":!b.value.has_signature,onSignatureSaved:Me,onCancel:n[10]||(n[10]=V=>le.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):f("",!0),oe.value&&b.value?(s(),ne(Ge,{key:2},{default:A(()=>[e("div",Xf,[e("div",ey,[e("div",ty,[sy,e("button",{onClick:n[11]||(n[11]=V=>oe.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[r(t(Ee),{class:"h-6 w-6"})])]),e("div",oy,[r(Jt,{"user-id":b.value.id,"initial-show-options":!b.value.has_signature,onSignatureSaved:Me,onCancel:n[12]||(n[12]=V=>oe.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):f("",!0),r(Qt,{isVisible:t(tt),documentData:t(Vt),onClose:n[13]||(n[13]=V=>tt.value=!1)},null,8,["isVisible","documentData"]),r(Ih,{isVisible:ae.value,onClose:n[14]||(n[14]=V=>ae.value=!1),onUploaded:_e,onDeleted:xe},null,8,["isVisible"])],64)}}};export{My as default};
