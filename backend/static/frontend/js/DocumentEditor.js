import{D as w,a3 as P,aC as M,r as k,au as E,o as I,aD as U,aE as V,aF as x,ac as R,u as L,A as F,e as $,f as N,j as K,l as T,s as G}from"./index.js";import{u as H}from"./dynamicDocument.js";var q=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],W=function(e){return q.map(function(o){return o.toLowerCase()}).indexOf(e.toLowerCase())!==-1},J=function(e,o,n){Object.keys(o).filter(W).forEach(function(u){var t=o[u];typeof t=="function"&&(u==="onInit"?t(e,n):n.on(u.substring(2),function(c){return t(c,n)}))})},Q=function(e,o,n,u){var t=e.modelEvents?e.modelEvents:null,c=Array.isArray(t)?t.join(" "):t;w(u,function(v,f){n&&typeof v=="string"&&v!==f&&v!==n.getContent({format:e.outputFormat})&&n.setContent(v)}),n.on(c||"change input undo redo",function(){o.emit("update:modelValue",n.getContent({format:e.outputFormat}))})},X=function(e,o,n,u,t,c){u.setContent(c()),n.attrs["onUpdate:modelValue"]&&Q(o,n,u,t),J(e,n.attrs,u)},B=0,j=function(e){var o=Date.now(),n=Math.floor(Math.random()*1e9);return B++,e+"_"+n+B+String(o)},Y=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},A=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},Z=function(e,o){return A(e).concat(A(o))},ee=function(e){return e==null},O=function(){return{listeners:[],scriptId:j("tiny-script"),scriptLoaded:!1}},te=function(){var e=O(),o=function(t,c,v,f){var l=c.createElement("script");l.referrerPolicy="origin",l.type="application/javascript",l.id=t,l.src=v;var y=function(){l.removeEventListener("load",y),f()};l.addEventListener("load",y),c.head&&c.head.appendChild(l)},n=function(t,c,v){e.scriptLoaded?v():(e.listeners.push(v),t.getElementById(e.scriptId)||o(e.scriptId,t,c,function(){e.listeners.forEach(function(f){return f()}),e.scriptLoaded=!0}))},u=function(){e=O()};return{load:n,reinitialize:u}},ne=te(),oe=function(){return typeof window<"u"?window:global},C=function(){var e=oe();return e&&e.tinymce?e.tinymce:null},re={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},g=function(){return g=Object.assign||function(e){for(var o,n=1,u=arguments.length;n<u;n++){o=arguments[n];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=o[t])}return e},g.apply(this,arguments)},ae=function(e,o,n,u){return e(u||"div",{id:o,ref:n})},ie=function(e,o,n){return e("textarea",{id:o,visibility:"hidden",ref:n})},S={selector:void 0,target:void 0},ue=P({props:re,setup:function(e,o){var n=e.init?g(g({},e.init),S):g({},S),u=M(e),t=u.disabled,c=u.modelValue,v=u.tagName,f=k(null),l=null,y=e.id||j("tiny-vue"),_=e.init&&e.init.inline||e.inline,D=!!o.attrs["onUpdate:modelValue"],b=!0,a=e.initialValue?e.initialValue:"",r="",s=function(i){return D?function(){return c!=null&&c.value?c.value:""}:function(){return i?a:r}},m=function(){var i=s(b),d=g(g({},n),{readonly:e.disabled,target:f.value,plugins:Z(n.plugins,e.plugins),toolbar:e.toolbar||n.toolbar,inline:_,setup:function(h){l=h,h.on("init",function(z){return X(z,e,o,h,c,i)}),typeof n.setup=="function"&&n.setup(h)}});Y(f.value)&&(f.value.style.visibility=""),C().init(d),b=!1};w(t,function(i){var d;l!==null&&(typeof((d=l.mode)===null||d===void 0?void 0:d.set)=="function"?l.mode.set(i?"readonly":"design"):l.setMode(i?"readonly":"design"))}),w(v,function(i){var d;D||(r=l.getContent()),(d=C())===null||d===void 0||d.remove(l),E(function(){return m()})}),I(function(){if(C()!==null)m();else if(f.value&&f.value.ownerDocument){var i=e.cloudChannel?e.cloudChannel:"6",d=e.apiKey?e.apiKey:"no-api-key",h=ee(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(d,"/tinymce/").concat(i,"/tinymce.min.js"):e.tinymceScriptSrc;ne.load(f.value.ownerDocument,h,m)}}),U(function(){C()!==null&&C().remove(l)}),_||(V(function(){b||m()}),x(function(){var i;D||(r=l.getContent()),(i=C())===null||i===void 0||i.remove(l)}));var p=function(i){var d;r=l.getContent(),(d=C())===null||d===void 0||d.remove(l),n=g(g(g({},n),i),S),E(function(){return m()})};return o.expose({rerender:p,getEditor:function(){return l}}),function(){return _?ae(R,y,f,e.tagName):ie(R,y,f)}}});const le={class:"flex h-screen w-full"},de={__name:"DocumentEditor",setup(e){const o=k(""),n=L(),u=F(),t=H();I(async()=>{var r;const a=u.params.id;a&&(t.selectedDocument=await t.documentById(a),o.value=((r=t.selectedDocument)==null?void 0:r.content)||"")});const c=()=>{const a=/{{(.*?)}}/g;return Array.from(new Set([...o.value.matchAll(a)].map(r=>r[1])))},v=a=>{var m;const r=((m=t.selectedDocument)==null?void 0:m.variables)||[],s=a.map(p=>{const i=r.find(d=>d.name_en===p);return{name_en:p,name_es:(i==null?void 0:i.name_es)||"",tooltip:(i==null?void 0:i.tooltip)||"",field_type:(i==null?void 0:i.field_type)||"input",value:(i==null?void 0:i.value)||""}});t.selectedDocument.variables=s},f=async()=>{var a,r;t.selectedDocument?(t.selectedDocument.content=o.value,t.selectedDocument.state="Draft"):t.selectedDocument={title:((a=t.selectedDocument)==null?void 0:a.title)||u.params.title||"Untitled Document",content:o.value,state:"Draft"};try{(r=t.selectedDocument)!=null&&r.id?await t.updateDocument(t.selectedDocument.id,t.selectedDocument):await t.createDocument(t.selectedDocument),t.selectedDocument=null,await t.init(),await G("Â¡Borrador guardado exitosamente!","success"),n.push("/dynamic_document_dashboard")}catch(s){console.error("Error saving draft:",s)}},l=async()=>{const a=c();a.length>0?(t.selectedDocument?t.selectedDocument.content=o.value:t.selectedDocument={title:u.params.title||"Untitled Document",content:o.value,variables:[]},v(a),n.push("/dynamic_document_dashboard/lawyer/variables-config")):f()};let y=!1;function _(a){if(!a||typeof a!="string")return a;try{return a.replace(/(font-family\s*:\s*)([^;!]*)([;!])/gi,"font-family: 'Carlito', sans-serif$3").replace(/<([a-z][a-z0-9]*)\b([^>]*)(?!\bstyle=)([^>]*)>/gi,function(r,s,m,p){return/style=/i.test(m)?r:`<${s}${m} style="font-family: 'Carlito', sans-serif;"${p}>`})}catch(r){return console.error("[ERROR] Failed to apply Carlito font:",r),a}}const D={language:"es",plugins:"lists link image table code wordcount autolink searchreplace textpattern",menubar:"",toolbar:"save continue return | undo redo | formatselect | bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | outdent indent | blocks fontsize lineheight | forecolor | removeformat | hr",height:"100vh",width:"100%",content_style:`
    @import url('https://fonts.googleapis.com/css2?family=Carlito&display=swap');
    body, p, span, div, strong, em, u, i, b {
      font-family: 'Carlito', sans-serif !important;
    }
  `,font_formats:"Carlito=Carlito, sans-serif;",paste_webkit_styles:"all",paste_remove_styles_if_webkit:!1,paste_merge_formats:!0,paste_as_text:!1,keep_styles:!0,forced_root_block:"p",forced_root_block_attrs:{style:"font-family: 'Carlito', sans-serif;"},setup:a=>{a.ui.registry.addButton("save",{text:"Guardar como borrador",icon:"save",onAction:()=>{f()}}),a.ui.registry.addButton("continue",{text:"Continuar",icon:"chevron-right",onAction:()=>{l()}}),a.ui.registry.addButton("return",{text:"Regresar",icon:"chevron-left",onAction:()=>{b()}}),a.on("init",()=>{try{setTimeout(()=>{try{const r=a.getContent(),s=_(r);r!==s&&(y=!0,a.setContent(s),y=!1)}catch(r){console.error("[ERROR] Failed to initialize content:",r)}},100)}catch(r){console.error("[ERROR] Initialization failed:",r)}}),a.on("BeforeSetContent",r=>{r.content&&(r.content=r.content.replace(/<([a-z][a-z0-9]*)\b([^>]*)(style=["'])([^"']*)["']([^>]*)>/gi,function(s,m,p,i,d,h){return d.includes("font-family")?s.replace(/(font-family\s*:\s*)([^;"]*)([;"])/gi,"font-family: 'Carlito', sans-serif$3"):`<${m}${p}${i}font-family: 'Carlito', sans-serif; ${d}"${h}>`}))}),a.on("SetContent",r=>{if(!y)try{(r.source_view||r.paste||r.setup)&&(y=!0,setTimeout(()=>{try{const s=a.getContent(),m=_(s);s!==m&&a.setContent(m,{format:"raw",no_events:!0})}catch(s){console.error("[ERROR] Failed to process SetContent:",s)}finally{y=!1}},50))}catch(s){console.error("[ERROR] SetContent event error:",s),y=!1}}),a.on("input",()=>{})}},b=()=>{n.push("/dynamic_document_dashboard")};return(a,r)=>($(),N("main",le,[K(T(ue),{"api-key":"tmizyezb3c6j68qwkp8d5hrr3vgk5va6uouidoe2hj7nxp3p",modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=s=>o.value=s),init:D},null,8,["modelValue"])]))}};export{de as default};
