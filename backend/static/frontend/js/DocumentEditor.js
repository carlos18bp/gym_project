import{C as w,a2 as V,aA as L,r as M,at as E,o as O,aB as R,aC as k,aD as x,ab as B,u as z,z as N,e as K,f as F,j as G,l as T,s as H}from"./index.js";import{u as q}from"./dynamicDocument.js";var W=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],J=function(e){return W.map(function(o){return o.toLowerCase()}).indexOf(e.toLowerCase())!==-1},Q=function(e,o,t){Object.keys(o).filter(J).forEach(function(a){var n=o[a];typeof n=="function"&&(a==="onInit"?n(e,t):t.on(a.substring(2),function(u){return n(u,t)}))})},X=function(e,o,t,a){var n=e.modelEvents?e.modelEvents:null,u=Array.isArray(n)?n.join(" "):n;w(a,function(v,l){t&&typeof v=="string"&&v!==l&&v!==t.getContent({format:e.outputFormat})&&t.setContent(v)}),t.on(u||"change input undo redo",function(){o.emit("update:modelValue",t.getContent({format:e.outputFormat}))})},Y=function(e,o,t,a,n,u){a.setContent(u()),t.attrs["onUpdate:modelValue"]&&X(o,t,a,n),Q(e,t.attrs,a)},A=0,P=function(e){var o=Date.now(),t=Math.floor(Math.random()*1e9);return A++,e+"_"+t+A+String(o)},Z=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},j=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},$=function(e,o){return j(e).concat(j(o))},ee=function(e){return e==null},I=function(){return{listeners:[],scriptId:P("tiny-script"),scriptLoaded:!1}},ne=function(){var e=I(),o=function(n,u,v,l){var r=u.createElement("script");r.referrerPolicy="origin",r.type="application/javascript",r.id=n,r.src=v;var g=function(){r.removeEventListener("load",g),l()};r.addEventListener("load",g),u.head&&u.head.appendChild(r)},t=function(n,u,v){e.scriptLoaded?v():(e.listeners.push(v),n.getElementById(e.scriptId)||o(e.scriptId,n,u,function(){e.listeners.forEach(function(l){return l()}),e.scriptLoaded=!0}))},a=function(){e=I()};return{load:t,reinitialize:a}},te=ne(),oe=function(){return typeof window<"u"?window:global},p=function(){var e=oe();return e&&e.tinymce?e.tinymce:null},ae={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},m=function(){return m=Object.assign||function(e){for(var o,t=1,a=arguments.length;t<a;t++){o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},m.apply(this,arguments)},re=function(e,o,t,a){return e(a||"div",{id:o,ref:t})},ie=function(e,o,t){return e("textarea",{id:o,visibility:"hidden",ref:t})},_={selector:void 0,target:void 0},ue=V({props:ae,setup:function(e,o){var t=e.init?m(m({},e.init),_):m({},_),a=L(e),n=a.disabled,u=a.modelValue,v=a.tagName,l=M(null),r=null,g=e.id||P("tiny-vue"),C=e.init&&e.init.inline||e.inline,i=!!o.attrs["onUpdate:modelValue"],d=!0,y=e.initialValue?e.initialValue:"",h="",b=function(s){return i?function(){return u!=null&&u.value?u.value:""}:function(){return s?y:h}},c=function(){var s=b(d),f=m(m({},t),{readonly:e.disabled,target:l.value,plugins:$(t.plugins,e.plugins),toolbar:e.toolbar||t.toolbar,inline:C,setup:function(D){r=D,D.on("init",function(U){return Y(U,e,o,D,u,s)}),typeof t.setup=="function"&&t.setup(D)}});Z(l.value)&&(l.value.style.visibility=""),p().init(f),d=!1};w(n,function(s){var f;r!==null&&(typeof((f=r.mode)===null||f===void 0?void 0:f.set)=="function"?r.mode.set(s?"readonly":"design"):r.setMode(s?"readonly":"design"))}),w(v,function(s){var f;i||(h=r.getContent()),(f=p())===null||f===void 0||f.remove(r),E(function(){return c()})}),O(function(){if(p()!==null)c();else if(l.value&&l.value.ownerDocument){var s=e.cloudChannel?e.cloudChannel:"6",f=e.apiKey?e.apiKey:"no-api-key",D=ee(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(f,"/tinymce/").concat(s,"/tinymce.min.js"):e.tinymceScriptSrc;te.load(l.value.ownerDocument,D,c)}}),R(function(){p()!==null&&p().remove(r)}),C||(k(function(){d||c()}),x(function(){var s;i||(h=r.getContent()),(s=p())===null||s===void 0||s.remove(r)}));var S=function(s){var f;h=r.getContent(),(f=p())===null||f===void 0||f.remove(r),t=m(m(m({},t),s),_),E(function(){return c()})};return o.expose({rerender:S,getEditor:function(){return r}}),function(){return C?re(B,g,l,e.tagName):ie(B,g,l)}}});const ce={class:"flex h-screen w-full"},se={__name:"DocumentEditor",setup(e){const o=M(""),t=z(),a=N(),n=q();O(async()=>{var d;const i=a.params.id;i&&(n.selectedDocument=await n.documentById(i),o.value=((d=n.selectedDocument)==null?void 0:d.content)||"")});const u=()=>{const i=/{{(.*?)}}/g;return Array.from(new Set([...o.value.matchAll(i)].map(d=>d[1])))},v=i=>{var h;const d=((h=n.selectedDocument)==null?void 0:h.variables)||[],y=i.map(b=>{const c=d.find(S=>S.name_en===b);return{name_en:b,name_es:(c==null?void 0:c.name_es)||"",tooltip:(c==null?void 0:c.tooltip)||"",field_type:(c==null?void 0:c.field_type)||"input",value:(c==null?void 0:c.value)||""}});n.selectedDocument.variables=y},l=async()=>{var i,d;n.selectedDocument?(n.selectedDocument.content=o.value,n.selectedDocument.state="Draft"):n.selectedDocument={title:((i=n.selectedDocument)==null?void 0:i.title)||a.params.title||"Untitled Document",content:o.value,state:"Draft"};try{(d=n.selectedDocument)!=null&&d.id?await n.updateDocument(n.selectedDocument.id,n.selectedDocument):await n.createDocument(n.selectedDocument),n.selectedDocument=null,await n.init(),await H("Â¡Borrador guardado exitosamente!","success"),t.push("/dynamic_document_dashboard")}catch(y){console.error("Error saving draft:",y)}},r=async()=>{const i=u();i.length>0?(n.selectedDocument?n.selectedDocument.content=o.value:n.selectedDocument={title:a.params.title||"Untitled Document",content:o.value,variables:[]},v(i),t.push("/dynamic_document_dashboard/lawyer/variables-config")):l()},g={language:"es",plugins:"lists",menubar:"",toolbar:"save continue return | undo redo| formatselect | bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | outdent indent | blocks fontfamily fontsize lineheight | forecolor | removeformat | hr",setup:i=>{i.ui.registry.addButton("save",{text:"Guardar como borrador",icon:"save",onAction:l}),i.ui.registry.addButton("continue",{text:"Continuar",icon:"chevron-right",onAction:r}),i.ui.registry.addButton("return",{text:"Regresar",icon:"chevron-left",onAction:C})},height:"100vh",width:"100%"},C=()=>{t.push("/dynamic_document_dashboard")};return(i,d)=>(K(),F("main",ce,[G(T(ue),{"api-key":"tmizyezb3c6j68qwkp8d5hrr3vgk5va6uouidoe2hj7nxp3p",modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=y=>o.value=y),init:g},null,8,["modelValue"])]))}};export{se as default};
