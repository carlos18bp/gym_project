import{e as r,f as l,g as e,w as W,U as he,k as O,i as fe,t as h,h as x,j as y,B as Z,m as U,a5 as ge,r as D,c as L,v as ee,F as N,J as q,n as B,a4 as te,p as A,l as $,Q as se,T as oe,D as I,E as ye,ao as K,ap as X,a3 as ve,W as be,o as _e,a8 as xe,s as S}from"./index-BWL8Y4C8.js";import{o as ne,g as ae}from"./index-B3uj7xYX.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as le}from"./MagnifyingGlassIcon-BigcnpWN.js";import{r as ie}from"./DocumentIcon-B6a6hSZ_.js";import{a as H}from"./LinkIcon-Bs7Xg6iM.js";import{r as we}from"./TrashIcon-DKnvP76G.js";function ce(o,c){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"})])}const De={class:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] overflow-hidden flex flex-col"},$e={class:"flex justify-between items-center px-6 pt-6 pb-4 flex-shrink-0"},Re={class:"text-lg font-bold"},Se=["innerHTML"],xs={__name:"DocumentPreviewModal",props:{isVisible:Boolean,documentData:{type:Object,default:()=>({title:"",content:""})}},emits:["close"],setup(o,{emit:c}){const t=c,d=()=>{t("close")};return(f,g)=>W((r(),O(ge,null,{default:fe(()=>[e("div",{class:"w-full h-full flex items-center justify-center p-4",onClick:U(d,["self"])},[e("div",De,[e("div",$e,[e("h2",Re," Previsualización del Documento: "+h(o.documentData.title),1),e("button",{onClick:d},[x(y(Z),{class:"size-6 text-gray-500 hover:text-gray-700"})])]),e("div",{class:"px-6 pb-6 overflow-y-auto flex-1 prose max-w-none",innerHTML:o.documentData.content},null,8,Se)])])]),_:1},512)),[[he,o.isVisible]])}},V=o=>(se("data-v-09dbf62b"),o=o(),oe(),o),ke={class:"space-y-6"},Ce=V(()=>e("h4",{class:"text-lg font-semibold text-gray-900"},"Relacionar Documentos Jurídicos",-1)),Pe={class:"text-sm text-gray-600 mt-1"},Ee=V(()=>e("p",{class:"text-xs text-blue-600 mt-1"}," Solo se muestran documentos disponibles que te pertenecen ",-1)),Te={class:"bg-gray-50 p-4 rounded-lg"},Le={class:"relative"},je={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},Fe={key:0,class:"flex items-center justify-center py-12"},Ae=V(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),Be=V(()=>e("span",{class:"ml-3 text-gray-600"},"Cargando documentos disponibles...",-1)),Me=[Ae,Be],Ne={key:1,class:"text-center py-12"},qe={class:"mt-2 text-sm font-medium text-gray-900"},Ve={class:"mt-1 text-sm text-gray-500"},He={key:2,class:"space-y-4"},Oe={class:"grid grid-cols-1 gap-4"},Ue={class:"flex items-start justify-between"},ze={class:"flex-1 min-w-0"},Qe={class:"flex items-center space-x-3"},Je={class:"flex-shrink-0"},Ie={class:"flex-1 min-w-0"},We={class:"text-sm font-medium text-gray-900 truncate"},Ye={class:"mt-1 flex items-center space-x-4 text-xs text-gray-500"},Ge={class:"inline-flex items-center"},Ke={key:0},Xe={key:0,class:"mt-3 text-sm text-gray-600 line-clamp-2"},Ze={key:1,class:"mt-3 flex flex-wrap gap-1"},et={class:"flex-shrink-0 ml-4 flex flex-col space-y-2"},tt=["onClick"],st=["onClick","disabled"],ot={key:1,class:"w-4 h-4 mr-2 animate-spin rounded-full border-2 border-white border-t-transparent"},nt={key:0,class:"flex justify-center mt-6"},at=V(()=>e("nav",{class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px"},null,-1)),rt=[at],lt={__name:"RelateDocumentsTab",props:{document:{type:Object,required:!0},availableDocuments:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},deferSave:{type:Boolean,default:!1},pendingRelationships:{type:Array,default:()=>[]}},emits:["relate-document"],setup(o,{emit:c}){const t=o,d=c,f=D(""),g=D(!1),b=L(()=>{if(!t.availableDocuments)return[];let u=t.availableDocuments;if(t.deferSave&&t.pendingRelationships.length>0&&(u=u.filter(n=>!t.pendingRelationships.includes(n.id))),f.value.trim()){const n=f.value.toLowerCase();u=u.filter(a=>{var s,i;return((s=a.title)==null?void 0:s.toLowerCase().includes(n))||((i=a.content)==null?void 0:i.toLowerCase().includes(n))})}return u}),w=async u=>{g.value=!0;try{await d("relate-document",u,"related")}finally{g.value=!1}},R=u=>({Draft:"bg-gray-500",Published:"bg-green-500",Progress:"bg-blue-500",Completed:"bg-purple-500",FullySigned:"bg-emerald-500",PendingSignatures:"bg-yellow-500"})[u]||"bg-gray-500",k=u=>({Draft:"bg-gray-400",Published:"bg-green-400",Progress:"bg-blue-400",Completed:"bg-purple-400",FullySigned:"bg-emerald-400",PendingSignatures:"bg-yellow-400"})[u]||"bg-gray-400",C=u=>({Draft:"Borrador",Published:"Publicado",Progress:"En Progreso",Completed:"Completado",FullySigned:"Firmado",PendingSignatures:"Pendiente de Firma"})[u]||u,P=u=>{if(!u)return"";try{return new Date(u).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}catch{return u}},E=u=>{if(!u)return"";const n=document.createElement("div");return n.innerHTML=u,n.textContent||n.innerText||""},T=u=>{const n=ae(u);return E(n)};return(u,n)=>(r(),l("div",ke,[e("div",null,[Ce,e("p",Pe,' Selecciona documentos para asociar con "'+h(o.document.title)+'" ',1),Ee]),e("div",Te,[e("div",Le,[e("div",je,[x(y(le),{class:"h-5 w-5 text-gray-400"})]),W(e("input",{id:"search","onUpdate:modelValue":n[0]||(n[0]=a=>f.value=a),type:"text",placeholder:"Buscar por título...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md text-sm placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[ee,f.value]])])]),o.isLoading?(r(),l("div",Fe,Me)):b.value.length===0?(r(),l("div",Ne,[x(y(ie),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",qe,h(o.availableDocuments.length===0?"No hay documentos disponibles":"No se encontraron documentos"),1),e("p",Ve,h(o.availableDocuments.length===0?"No tienes otros documentos completados disponibles para relacionar, o todos ya están relacionados con este documento.":"Intenta ajustar tu búsqueda para encontrar documentos."),1)])):(r(),l("div",He,[e("div",Oe,[(r(!0),l(N,null,q(b.value,a=>(r(),l("div",{key:a.id,class:"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors"},[e("div",Ue,[e("div",ze,[e("div",Qe,[e("div",Je,[e("div",{class:B(["w-10 h-10 rounded-lg flex items-center justify-center",R(a.state)])},[x(y(te),{class:"w-5 h-5 text-white"})],2)]),e("div",Ie,[e("h5",We,h(a.title),1),e("div",Ye,[e("span",Ge,[e("span",{class:B(["w-2 h-2 rounded-full mr-1.5",k(a.state)])},null,2),A(" "+h(C(a.state)),1)]),a.created_at?(r(),l("span",Ke,h(P(a.created_at)),1)):$("",!0)])])]),a.content?(r(),l("div",Xe,h(T(a)),1)):$("",!0),a.tags&&a.tags.length>0?(r(),l("div",Ze,[(r(!0),l(N,null,q(a.tags,s=>(r(),l("span",{key:s.id,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800"},h(s.name),1))),128))])):$("",!0)]),e("div",et,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1.5 border border-gray-200 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors",onClick:U(s=>y(ne)(a),["stop"])}," Ver documento ",8,tt),e("button",{onClick:s=>w(a),disabled:g.value,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[g.value?(r(),l("div",ot)):(r(),O(y(H),{key:0,class:"w-4 h-4 mr-2"})),A(" "+h(g.value?"Relacionando...":"Relacionar"),1)],8,st)])])]))),128))]),b.value.length>=10?(r(),l("div",nt,rt)):$("",!0)]))]))}},it=re(lt,[["__scopeId","data-v-09dbf62b"]]),z=o=>(se("data-v-78d14788"),o=o(),oe(),o),ct={class:"space-y-6"},dt=z(()=>e("h4",{class:"text-lg font-semibold text-gray-900"},"Documentos Relacionados",-1)),ut={class:"text-sm text-gray-600 mt-1"},mt=z(()=>e("p",{class:"text-xs text-blue-600 mt-1"}," Solo se muestran documentos completados que te pertenecen ",-1)),pt={class:"bg-gray-50 p-4 rounded-lg"},ht={class:"relative"},ft={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},gt={key:0,class:"flex items-center justify-center py-12"},yt=z(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),vt=z(()=>e("span",{class:"ml-3 text-gray-600"},"Cargando documentos relacionados...",-1)),bt=[yt,vt],_t={key:1,class:"text-center py-12"},xt={class:"mt-2 text-sm font-medium text-gray-900"},wt={class:"mt-1 text-sm text-gray-500"},Dt={key:2,class:"space-y-4"},$t={class:"grid grid-cols-1 gap-4"},Rt={class:"flex items-start justify-between"},St={class:"flex-1 min-w-0"},kt={class:"flex items-center space-x-3"},Ct={class:"flex-shrink-0"},Pt={class:"flex-1 min-w-0"},Et={class:"text-sm font-medium text-gray-900 truncate"},Tt={class:"mt-1 flex items-center space-x-4 text-xs text-gray-500"},Lt={class:"inline-flex items-center"},jt={key:0},Ft={class:"mt-3"},At={class:"flex items-center space-x-2"},Bt={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-800"},Mt={key:1,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Nt={key:0,class:"mt-2 text-xs text-gray-500"},qt={key:0,class:"mt-3 text-sm text-gray-600 line-clamp-2"},Vt={key:1,class:"mt-3 flex flex-wrap gap-1"},Ht={class:"flex-shrink-0 ml-4 flex flex-col space-y-2"},Ot=["onClick"],Ut=["onClick","disabled"],zt={key:1,class:"w-4 h-4 mr-2 animate-spin rounded-full border-2 border-red-600 border-t-transparent"},Qt={__name:"RelatedDocumentsTab",props:{document:{type:Object,required:!0},relatedDocuments:{type:Array,default:()=>[]},relationships:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},deferSave:{type:Boolean,default:!1},pendingRelationships:{type:Array,default:()=>[]},availableDocuments:{type:Array,default:()=>[]}},emits:["unrelate-document"],setup(o,{emit:c}){const t=o,d=c,f=D(""),g=D(!1),b=L(()=>{let n=[];if(t.deferSave&&t.pendingRelationships.length>0?n=[...t.availableDocuments.filter(s=>t.pendingRelationships.includes(s.id)).map(s=>({...s,isPending:!0}))]:n=t.relatedDocuments||[],f.value.trim()){const a=f.value.toLowerCase();n=n.filter(s=>{var i,p;return((i=s.title)==null?void 0:i.toLowerCase().includes(a))||((p=s.content)==null?void 0:p.toLowerCase().includes(a))})}return n}),w=n=>{const a=t.relationships.find(s=>s.source_document===n||s.target_document===n);return a?{id:a.id,created_by:a.created_by_name,created_at:a.created_at}:null},R=async n=>{if(t.deferSave){d("unrelate-document",n.id);return}const a=w(n.id);if(a){g.value=!0;try{await d("unrelate-document",a.id)}finally{g.value=!1}}},k=n=>({Draft:"bg-gray-500",Published:"bg-green-500",Progress:"bg-blue-500",Completed:"bg-purple-500",FullySigned:"bg-emerald-500",PendingSignatures:"bg-yellow-500"})[n]||"bg-gray-500",C=n=>({Draft:"bg-gray-400",Published:"bg-green-400",Progress:"bg-blue-400",Completed:"bg-purple-400",FullySigned:"bg-emerald-400",PendingSignatures:"bg-yellow-400"})[n]||"bg-gray-400",P=n=>({Draft:"Borrador",Published:"Publicado",Progress:"En Progreso",Completed:"Completado",FullySigned:"Firmado",PendingSignatures:"Pendiente de Firma"})[n]||n,E=n=>{if(!n)return"";try{return new Date(n).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}catch{return n}},T=n=>{if(!n)return"";const a=document.createElement("div");return a.innerHTML=n,a.textContent||a.innerText||""},u=n=>{const a=ae(n);return T(a)};return(n,a)=>(r(),l("div",ct,[e("div",null,[dt,e("p",ut,' Documentos asociados con "'+h(o.document.title)+'" ',1),mt]),e("div",pt,[e("div",ht,[e("div",ft,[x(y(le),{class:"h-5 w-5 text-gray-400"})]),W(e("input",{"onUpdate:modelValue":a[0]||(a[0]=s=>f.value=s),type:"text",placeholder:"Buscar en documentos relacionados...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md text-sm placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[ee,f.value]])])]),o.isLoading?(r(),l("div",gt,bt)):b.value.length===0?(r(),l("div",_t,[x(y(ce),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",xt,h(o.relatedDocuments.length===0?"No hay documentos relacionados":"No se encontraron documentos"),1),e("p",wt,h(o.relatedDocuments.length===0?'Este documento aún no tiene documentos relacionados. Utiliza la pestaña "Relacionar Documentos" para crear asociaciones.':"Intenta ajustar tu búsqueda para encontrar documentos relacionados."),1)])):(r(),l("div",Dt,[e("div",$t,[(r(!0),l(N,null,q(b.value,s=>{var i;return r(),l("div",{key:s.id,class:"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors"},[e("div",Rt,[e("div",St,[e("div",kt,[e("div",Ct,[e("div",{class:B(["w-10 h-10 rounded-lg flex items-center justify-center",k(s.state)])},[x(y(te),{class:"w-5 h-5 text-white"})],2)]),e("div",Pt,[e("h5",Et,h(s.title),1),e("div",Tt,[e("span",Lt,[e("span",{class:B(["w-2 h-2 rounded-full mr-1.5",C(s.state)])},null,2),A(" "+h(P(s.state)),1)]),s.created_at?(r(),l("span",jt,h(E(s.created_at)),1)):$("",!0)])])]),e("div",Ft,[e("div",At,[s.isPending?(r(),l("span",Bt,[x(y(H),{class:"w-3 h-3 mr-1"}),A(" Pendiente (se creará al formalizar) ")])):(r(),l("span",Mt,[x(y(H),{class:"w-3 h-3 mr-1"}),A(" Relacionado ")]))]),(i=w(s.id))!=null&&i.created_by?(r(),l("div",Nt," Relacionado por "+h(w(s.id).created_by)+" el "+h(E(w(s.id).created_at)),1)):$("",!0)]),s.content?(r(),l("div",qt,h(u(s)),1)):$("",!0),s.tags&&s.tags.length>0?(r(),l("div",Vt,[(r(!0),l(N,null,q(s.tags,p=>(r(),l("span",{key:p.id,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800"},h(p.name),1))),128))])):$("",!0)]),e("div",Ht,[e("button",{type:"button",class:"inline-flex items-center justify-center px-3 py-1.5 border border-gray-200 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors",onClick:U(p=>y(ne)(s),["stop"])}," Ver documento ",8,Ot),o.readonly?$("",!0):(r(),l("button",{key:0,onClick:p=>R(s),disabled:g.value,class:"inline-flex items-center justify-center px-3 py-2 border border-red-300 shadow-sm text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 disabled:opacity-50 transition-colors"},[g.value?(r(),l("div",zt)):(r(),O(y(we),{key:0,class:"w-4 h-4 mr-2"})),A(" "+h(g.value?"Eliminando...":"Desrelacionar"),1)],8,Ut))])])])}),128))])]))]))}},Jt=re(Qt,[["__scopeId","data-v-78d14788"]]),F={async getDocumentRelationships(o){try{return(await I(`dynamic-documents/${o}/relationships/`)).data||[]}catch(c){throw console.error("Error fetching document relationships:",c),c}},async getRelatedDocuments(o){try{return(await I(`dynamic-documents/${o}/related-documents/`)).data||[]}catch(c){throw c}},async getAvailableDocumentsForRelationship(o,c={}){try{const t=new URLSearchParams;c.allowPendingSignatures&&t.set("allow_pending_signatures","true");const d=t.toString(),f=`dynamic-documents/${o}/available-for-relationship/${d?`?${d}`:""}`;return(await I(f)).data||[]}catch(t){throw console.error("Error fetching available documents:",t),t}},async createDocumentRelationship(o){try{const t=(await ye("dynamic-documents/relationships/create/",o)).data;try{const d=t.source_document_title||"documento origen",f=t.target_document_title||"documento relacionado";await K(X.CREATE,`Relacionaste el documento "${d}" con "${f}"`)}catch(d){console.warn("No se pudo registrar la actividad de asociación:",d)}return t}catch(c){throw console.error("Error creating document relationship:",c),c}},async deleteDocumentRelationship(o){try{const c=await ve(`dynamic-documents/relationships/${o}/delete/`),t=c.status===200||c.status===204;if(t)try{await K(X.DELETE,"Eliminaste una asociación entre documentos")}catch(d){console.warn("No se pudo registrar la actividad al eliminar asociación:",d)}return t}catch(c){throw console.error("Error deleting document relationship:",c),c}}},ws=Object.freeze(Object.defineProperty({__proto__:null,documentRelationshipsActions:F},Symbol.toStringTag,{value:"Module"}));function It(o,c={}){const t=D([]),d=D([]),f=D([]),g=D(!1),b=D(!1),w=D(!1),R=D(!1),k=async(s={})=>{if(o){b.value=!0;try{const i=s.allowPendingSignatures||c.allowPendingSignatures;let p=await F.getAvailableDocumentsForRelationship(o,{allowPendingSignatures:i});(s.filterCompleted||c.filterCompleted)&&!i?p=p.filter(M=>M.state==="Completed"):(s.filterFullySigned||c.filterFullySigned)&&(p=p.filter(M=>M.state==="FullySigned")),t.value=p}catch(i){if(i.response&&i.response.status===404)console.warn(`Document ${o} not found when loading available documents`),t.value=[];else throw console.error("Error loading available documents:",i),t.value=[],i}finally{b.value=!1}}},C=async()=>{if(o){w.value=!0;try{const s=await F.getRelatedDocuments(o);d.value=s}catch(s){if(s.response&&s.response.status===404)console.warn(`Document ${o} not found when loading related documents`),d.value=[];else throw d.value=[],s}finally{w.value=!1}}},P=async()=>{if(o){R.value=!0;try{f.value=await F.getDocumentRelationships(o)}catch(s){if(s.response&&s.response.status===404)console.warn(`Document ${o} not found when loading relationships`),f.value=[];else throw console.error("Error loading relationships:",s),f.value=[],s}finally{R.value=!1}}},E=async s=>{g.value=!0;try{return await F.createDocumentRelationship(s)}catch(i){throw console.error("Error creating relationship:",i),i}finally{g.value=!1}},T=async s=>{g.value=!0;try{return await F.deleteDocumentRelationship(s)}catch(i){throw console.error("Error deleting relationship:",i),i}finally{g.value=!1}},u=(s,i)=>f.value.find(p=>p.source_document===s&&p.target_document===i||p.source_document===i&&p.target_document===s);return{availableDocuments:t,relatedDocuments:d,relationships:f,isLoading:g,isLoadingAvailable:b,isLoadingRelated:w,isLoadingRelationships:R,loadAvailableDocuments:k,loadRelatedDocuments:C,loadRelationships:P,loadAllData:async()=>{await Promise.all([k(),C(),P()])},createRelationship:E,deleteRelationship:T,findRelationship:u,areDocumentsRelated:(s,i)=>!!u(s,i)}}const Wt={class:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col"},Yt={class:"bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-6 rounded-t-lg flex-shrink-0"},Gt={class:"flex items-start justify-between gap-4"},Kt={class:"flex items-start space-x-3 flex-1 min-w-0"},Xt={class:"p-2 bg-white bg-opacity-20 rounded-lg flex-shrink-0"},Zt={class:"flex-1 min-w-0"},es=e("h3",{class:"text-lg font-semibold text-white"}," Administrar Asociaciones de Documentos ",-1),ts={class:"text-blue-100 text-sm truncate"},ss={class:"text-blue-200 text-xs mt-1"},os={class:"border-b border-gray-200 bg-gray-50 flex-shrink-0"},ns={class:"flex"},as=["onClick"],rs={class:"flex items-center space-x-2"},ls={class:"p-6 overflow-y-auto flex-1"},is={key:0,class:"flex items-center justify-center py-12"},cs=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),ds=e("span",{class:"ml-3 text-gray-600"},"Cargando...",-1),us=[cs,ds],ms={key:1,class:"space-y-6"},ps={key:2,class:"space-y-6"},Ds={__name:"DocumentRelationshipsModal",props:{isOpen:{type:Boolean,default:!1},document:{type:Object,required:!0},readonly:{type:Boolean,default:!1},filterFullySigned:{type:Boolean,default:!1},forceRelateTab:{type:Boolean,default:!1},deferSave:{type:Boolean,default:!1},pendingRelationships:{type:Array,default:()=>[]}},emits:["close","refresh","update-pending","update-count"],setup(o,{emit:c}){var Y;const t=o,d=c,{availableDocuments:f,relatedDocuments:g,relationships:b,isLoading:w,isLoadingAvailable:R,isLoadingRelated:k,loadAvailableDocuments:C,loadRelatedDocuments:P,loadRelationships:E,createRelationship:T,deleteRelationship:u}=It((Y=t.document)==null?void 0:Y.id,{filterFullySigned:t.filterFullySigned}),n=L(()=>{var m;return((m=t.document)==null?void 0:m.state)==="Completed"}),a=L(()=>{var m;return["PendingSignatures","FullySigned"].includes((m=t.document)==null?void 0:m.state)}),s=L(()=>t.forceRelateTab||t.deferSave?"Solo documentos completados, firmados o pendientes de firma de tu propiedad":t.filterFullySigned?"Solo documentos firmados disponibles para asociar":"Solo documentos completados de tu propiedad"),i=L(()=>t.forceRelateTab?t.readonly:t.readonly||!n.value||a.value),p=D(i.value?"related":"relate"),M=()=>{var m;return t.forceRelateTab?"relate":i.value||((m=g.value)==null?void 0:m.length)>0?"related":"relate"},de=L(()=>{var _,J,G;const m=t.deferSave?((_=t.pendingRelationships)==null?void 0:_.length)||0:((J=g.value)==null?void 0:J.length)||0,v=[{id:"related",label:"Documentos Relacionados",icon:ce,count:m},{id:"relate",label:"Relacionar Documentos",icon:H,count:(G=f.value)==null?void 0:G.length}];return t.forceRelateTab?v:i.value?v.filter(pe=>pe.id==="related"):v}),Q=()=>{d("update-count",{documentId:t.document.id,count:b.value.length}),d("refresh"),d("close")},j=async()=>{var m;if((m=t.document)!=null&&m.id)try{const v=[];if(!i.value){const _=t.forceRelateTab||t.deferSave?{allowPendingSignatures:!0}:t.filterFullySigned?{filterFullySigned:!0}:{filterCompleted:!0};v.push(C(_))}v.push(P(),E()),await Promise.all(v),p.value=M()}catch{await S("Error al cargar los datos","error")}},ue=async m=>{try{if(!n.value&&!t.forceRelateTab){a.value?await S("No puedes modificar asociaciones cuando el documento está pendiente de firma o firmado.","warning"):await S("Solo puedes crear asociaciones para documentos completados.","warning");return}if(t.deferSave){if(!t.pendingRelationships.includes(m.id)){const v=[...t.pendingRelationships,m.id];d("update-pending",v),await S("Documento agregado a relaciones pendientes","success")}return}await T({source_document:t.document.id,target_document:m.id}),await S("Documentos relacionados exitosamente","success"),await j(),d("update-count",{documentId:t.document.id,count:b.value.length}),d("refresh")}catch(v){console.error("Error relating document:",v),await S("Error al relacionar los documentos","error")}},me=async m=>{try{if(t.deferSave){const v=t.pendingRelationships.filter(_=>_!==m);d("update-pending",v),await S("Documento removido de relaciones pendientes","success");return}await u(m),await S("Relación eliminada exitosamente","success"),await j(),d("update-count",{documentId:t.document.id,count:b.value.length}),d("refresh")}catch(v){console.error("Error unrelating document:",v),await S("Error al eliminar la relación","error")}};return be(()=>t.isOpen,m=>{var v;m&&((v=t.document)!=null&&v.id)&&j()}),_e(()=>{var m;t.isOpen&&((m=t.document)!=null&&m.id)&&j()}),(m,v)=>o.isOpen?(r(),l("div",{key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center p-4",onClick:U(Q,["self"])},[e("div",Wt,[e("div",Yt,[e("div",Gt,[e("div",Kt,[e("div",Xt,[x(y(ie),{class:"w-6 h-6 text-white"})]),e("div",Zt,[es,e("p",ts,h(o.document.title),1),e("p",ss,h(s.value),1)])]),e("button",{onClick:Q,class:"text-white hover:text-blue-200 transition-colors p-3 hover:bg-white hover:bg-opacity-10 rounded-lg flex-shrink-0"},[x(y(Z),{class:"w-6 h-6"})])])]),e("div",os,[e("nav",ns,[(r(!0),l(N,null,q(de.value,_=>(r(),l("button",{key:_.id,onClick:J=>p.value=_.id,class:B(["py-3 px-6 text-sm font-medium border-b-2 transition-colors",p.value===_.id?"border-blue-500 text-blue-600 bg-white":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},[e("div",rs,[(r(),O(xe(_.icon),{class:"w-4 h-4"})),e("span",null,h(_.label),1),_.count!==void 0?(r(),l("span",{key:0,class:B(["px-2 py-0.5 rounded-full text-xs",p.value===_.id?"bg-blue-100 text-blue-600":"bg-gray-200 text-gray-600"])},h(_.count),3)):$("",!0)])],10,as))),128))])]),e("div",ls,[y(w)?(r(),l("div",is,us)):p.value==="relate"?(r(),l("div",ms,[x(it,{document:o.document,"available-documents":y(f),"is-loading":y(R),readonly:i.value,"defer-save":o.deferSave,"pending-relationships":o.pendingRelationships,onRelateDocument:ue,onRefresh:j},null,8,["document","available-documents","is-loading","readonly","defer-save","pending-relationships"])])):p.value==="related"?(r(),l("div",ps,[x(Jt,{document:o.document,"related-documents":y(g),relationships:y(b),"is-loading":y(k),readonly:i.value,"defer-save":o.deferSave,"pending-relationships":o.pendingRelationships,"available-documents":y(f),onUnrelateDocument:me,onRefresh:j},null,8,["document","related-documents","relationships","is-loading","readonly","defer-save","pending-relationships","available-documents"])])):$("",!0)]),e("div",{class:"bg-gray-50 px-6 py-4 border-t border-gray-200 rounded-b-lg flex-shrink-0"},[e("div",{class:"flex justify-end space-x-3"},[e("button",{onClick:Q,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"}," Cerrar ")])])])])):$("",!0)}};export{xs as _,Ds as a,ws as b,ce as r};
