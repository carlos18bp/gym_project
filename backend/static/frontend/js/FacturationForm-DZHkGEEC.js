import{C as $,D as U,E as z,ao as B,ap as G,u as I,I as V,r as T,b as j,o as O,c as R,e as m,f as y,g as e,h as x,j as b,B as F,m as v,w as p,v as h,F as J,J as X,n as w,U as H,k as Z,a8 as Y,t as K,p as f,s as g}from"./index-BWL8Y4C8.js";import{s as Q,h as W}from"./loading_message-CJtQO8sa.js";import{r as ee}from"./CloudArrowUpIcon-C8Wj7AzK.js";import{r as N}from"./DocumentIcon-B6a6hSZ_.js";import{r as te}from"./PhotoIcon-seYPDBFV.js";const se=$("intranetGymStore",{state:()=>({legalDocuments:[],profile:{cover_image_url:"",profile_image_url:""},lawyers_count:0,users_count:0,dataLoaded:!1}),actions:{async init(){this.dataLoaded||await this.fetchLegalDocuments()},async fetchLegalDocuments(){try{const r=await U("list_legal_intranet_documents/");this.legalDocuments=r.data.documents||[],this.profile=r.data.profile||{cover_image_url:"",profile_image_url:""},this.lawyers_count=r.data.lawyers_count||0,this.users_count=r.data.users_count||0,this.dataLoaded=!0}catch(r){console.error("Error fetching legal documents:",r),this.legalDocuments=[],this.profile={cover_image_url:"",profile_image_url:""},this.lawyers_count=0,this.users_count=0,this.dataLoaded=!1}},async createReportRequest(r){const o=new FormData;o.append("contract",r.document),o.append("initialDate",r.initialDate),o.append("endDate",r.endDate),o.append("paymentConcept",r.paymentConcept),o.append("paymentAmount",r.paymentAmount),o.append("userName",r.userName),o.append("userLastName",r.userLastName),o.append("userEmail",r.userEmail),r.files&&r.files.length>0&&r.files.forEach((i,_)=>{o.append(`files[${_}]`,i)});try{const i=await z("create_report_request/",o);return i.status===201?(await B(G.CREATE,`Enviaste un informe de facturación por ${r.paymentAmount} - ${r.paymentConcept}.`),this.dataLoaded=!1,i.status):(console.error("Failed to create report request:",i.status),null)}catch(i){return console.error("Error creating report request:",i.message),null}}}}),ae={class:"px-4 pb-10 sm:px-6 lg:px-8"},re={class:"w-full p-5 rounded-lg border-2 border-stroke bg-terciary space-y-3"},ne={class:"flex items-center justify-between"},oe=e("h1",{class:"text-primary text-xl font-semibold"},"Presentar Informe",-1),ie={class:"mt-4 space-y-3"},le={class:"grid md:grid-cols-2 xl:grid-cols-4 gap-3"},de=e("label",{for:"document-number",class:"block text-base font-medium leading-6 text-primary"},[f(" No. Contrato "),e("span",{class:"text-red-500"},"*")],-1),ce={class:"mt-2"},ue=e("label",{for:"initial-report-period",class:"block text-base font-medium leading-6 text-primary"},[f(" Fecha Inicial "),e("span",{class:"text-red-500"},"*")],-1),me={class:"mt-2"},pe=e("label",{for:"final-report-period",class:"block text-base font-medium leading-6 text-primary"},[f(" Fecha Final "),e("span",{class:"text-red-500"},"*")],-1),ge={class:"mt-2"},ye=e("label",{for:"payment-concept",class:"block text-base font-medium leading-6 text-primary"},[f(" Concepto de Pago "),e("span",{class:"text-red-500"},"*")],-1),he={class:"mt-2"},fe=e("label",{for:"payment-concept",class:"block text-base font-medium leading-6 text-primary"},[f(" Valor a Cobrar y/o Facturar "),e("span",{class:"text-red-500"},"*")],-1),_e={class:"mt-2"},xe={class:"flex items-center rounded-md bg-white px-3 outline outline-1 -outline-offset-1 outline-gray-300 focus-within:outline focus-within:outline-2 focus-within:outline-secondary"},be=e("div",{class:"shrink-0 select-none text-base text-gray-500 sm:text-sm"}," $ ",-1),ve=e("div",{id:"payment-currency",class:"shrink-0 select-none text-base text-gray-500 sm:text-sm"}," COP ",-1),we={class:"col-span-full"},ke=e("label",{for:"files",class:"block text-base font-medium leading-6 text-primary"}," Anexos ",-1),Ce={key:0,class:"text-center"},Ee={class:"mt-4 flex text-sm/6 text-gray-600"},De={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"},Fe=e("span",null,"Sube un archivo",-1),Ne=e("p",{class:"pl-1"},"o arrastra y suelta",-1),Ae=e("p",{class:"text-xs/5 text-gray-600"}," PNG, JPG, PDF, DOCX de hasta 20MB ",-1),Le={key:1,class:"w-full flex flex-wrap gap-3"},Me=["onMouseenter","onMouseleave"],Se=["onClick"],qe={class:"text-center text-xs truncate w-20"},Pe={class:"flex gap-3 span-col-full"},$e=["disabled"],Ue=e("span",null,"Guardar",-1),ze=[Ue],Be=20*1024*1024,Ge=20*1024*1024,Re={__name:"FacturationForm",emits:["close"],setup(r,{emit:o}){const i=o,_=I(),A=se(),k=V(),l=T([]),t=j({document:null,initialDate:null,endDate:null,paymentConcept:"",paymentAmount:null,files:[],userName:"",userLastName:"",userEmail:""});O(async()=>{await k.init();const n=k.getCurrentUser;n&&(t.userName=n.first_name||"",t.userLastName=n.last_name||"",t.userEmail=n.email||"")});const C=()=>{i("close")},L=n=>{const a=Array.from(n.target.files);E(a),n.target.value=null},M=n=>{n.preventDefault();const a=Array.from(n.dataTransfer.files);E(a)},E=n=>{let a=l.value.reduce((s,u)=>s+u.file.size,0);n.forEach(s=>{if(s.size>Be){g(`El archivo "${s.name}" excede el límite de 20 MB. Por favor, selecciona un archivo más pequeño.`,"warning");return}if(a+s.size>Ge){g("No se pueden agregar más archivos porque el tamaño total excede el límite de 20 MB.","warning");return}const u=s.name.split(".").pop().toLowerCase();let d="",c={general:"",xMark:""};switch(u){case"png":case"jpg":case"jpeg":d=te,c.general="border-gray-200 text-gray-400",c.xMark="bg-gray-400";break;case"pdf":d=N,c.general="border-red-600/20 text-red-600/60",c.xMark="bg-red-600/60";break;case"docx":d=N,c.general="border-blue-600/20 text-blue-600/60",c.xMark="bg-blue-600/60";break;default:g("¡Ups! Ese tipo de archivo no es compatible. Asegúrate de que el archivo sea PDF, DOCX, JPG, PNG, JPEG.","warning");return}l.value.push({name:s.name,icon:d,style:c,hover:!1,file:s}),a+=s.size})},S=n=>{l.value.splice(n,1)},D=R(()=>t.document!==null&&t.initialDate!==null&&t.endDate!==null&&t.paymentConcept.trim()&&t.paymentAmount!==null&&!isNaN(t.paymentAmount)),q=async()=>{Q();const n=l.value.map(a=>a.file);t.files=n;try{const a=await A.createReportRequest(t);W(),a===201?(g("¡Solicitud creada exitosamente!","success"),P(),C(),_.push({name:"dashboard"})):g("Error al crear la solicitud. Intenta nuevamente.","error")}catch(a){console.error("Error al enviar la solicitud:",a),g("Hubo un error inesperado. Por favor, inténtalo más tarde.","error")}},P=()=>{t.document=null,t.initialDate=null,t.endDate=null,t.paymentConcept="",t.paymentAmount=null,l.value=[],t.userName="",t.userLastName="",t.userEmail=""};return(n,a)=>(m(),y("div",ae,[e("div",re,[e("div",ne,[oe,x(b(F),{class:"size-6 text-primary cursor-pointer",onClick:C})]),e("form",{onSubmit:a[6]||(a[6]=v(s=>q(),["prevent"]))},[e("div",ie,[e("div",le,[e("div",null,[de,e("div",ce,[p(e("input",{"onUpdate:modelValue":a[0]||(a[0]=s=>t.document=s),type:"text",name:"document-number",id:"document-number",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,t.document]])])]),e("div",null,[ue,e("div",me,[p(e("input",{"onUpdate:modelValue":a[1]||(a[1]=s=>t.initialDate=s),type:"date",name:"initial-report-period",id:"initial-report-period",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,t.initialDate]])])]),e("div",null,[pe,e("div",ge,[p(e("input",{"onUpdate:modelValue":a[2]||(a[2]=s=>t.endDate=s),type:"date",name:"final-report-period",id:"final-report-period",placeholder:"Fecha inicial",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,t.endDate]])])]),e("div",null,[ye,e("div",he,[p(e("input",{"onUpdate:modelValue":a[3]||(a[3]=s=>t.paymentConcept=s),type:"text",name:"payment-concept",id:"payment-concept",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,t.paymentConcept]])])]),e("div",null,[fe,e("div",_e,[e("div",xe,[be,p(e("input",{"onUpdate:modelValue":a[4]||(a[4]=s=>t.paymentAmount=s),type:"text",name:"payment-concept",id:"payment-concept",class:"block min-w-0 grow py-1.5 pl-1 pr-3 text-base text-primary border-none placeholder:text-gray-400 focus-within:outline-none focus-within:border-none focus-within:ring-0 sm:text-sm",placeholder:"0.00","aria-describedby":"payment-currency",required:""},null,512),[[h,t.paymentAmount]]),ve])])]),e("div",we,[ke,e("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 bg-white px-6 py-10",onDragover:a[5]||(a[5]=v(()=>{},["prevent"])),onDrop:v(M,["prevent"])},[l.value.length<1?(m(),y("div",Ce,[x(b(ee),{class:"mx-auto size-12 text-gray-300","aria-hidden":"true"}),e("div",Ee,[e("label",De,[Fe,e("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",onChange:L},null,32)]),Ne]),Ae])):(m(),y("div",Le,[(m(!0),y(J,null,X(l.value,(s,u)=>(m(),y("div",{key:u,class:w(["relative p-4 grid rounded-md bg-white border-2",s.style.general]),onMouseenter:d=>s.hover=!0,onMouseleave:d=>s.hover=!1},[p(e("div",{class:w(["absolute p-0.5 mt-2 ml-2 rounded-full",s.style.xMark]),onClick:d=>S(u)},[x(b(F),{class:"size-3 text-white"})],10,Se),[[H,s.hover]]),(m(),Z(Y(s.icon),{class:"size-12 mx-auto"})),e("span",qe,K(s.name),1)],42,Me))),128))]))],32)]),e("div",Pe,[e("button",{type:"submit",class:w(["p-2.5 text-sm font-medium rounded-md flex gap-2",D.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!D.value},ze,10,$e)])])])],32)])]))}};export{Re as _,se as u};
