import{e as d,f as c,g as r,c as v,k as D,a5 as k,p as N,t as u,n as M,C as P,D as w,$ as B,E as b,a0 as F,q as V,r as x,h as _,j as y,G as $,w as S,S as L,x as j,u as Z,v as T,aS as z,l as R}from"./index.js";import{r as A}from"./ExclamationTriangleIcon.js";function I(e,t){return d(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z","clip-rule":"evenodd"})])}function E(e,t){return d(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z","clip-rule":"evenodd"})])}function O(e,t){return d(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),r("path",{"fill-rule":"evenodd",d:"M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z","clip-rule":"evenodd"})])}function G(e,t){return d(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-1.72 6.97a.75.75 0 1 0-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 1 0 1.06 1.06L12 13.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L13.06 12l1.72-1.72a.75.75 0 1 0-1.06-1.06L12 10.94l-1.72-1.72Z","clip-rule":"evenodd"})])}const U={__name:"StatusBadge",props:{status:{type:String,required:!0}},setup(e){const t=e,s=v(()=>({PENDING:{text:"Pendiente",classes:"bg-yellow-100 text-yellow-800",icon:E},IN_REVIEW:{text:"En Revisi√≥n",classes:"bg-blue-100 text-blue-800",icon:O},RESPONDED:{text:"Respondida",classes:"bg-green-100 text-green-800",icon:I},CLOSED:{text:"Cerrada",classes:"bg-gray-100 text-gray-800",icon:G}})[t.status]||{text:t.status,classes:"bg-gray-100 text-gray-800",icon:E}),o=v(()=>s.value.classes),n=v(()=>s.value.text),a=v(()=>s.value.icon);return(i,g)=>(d(),c("span",{class:M([o.value,"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},[(d(),D(k(a.value),{class:"w-3 h-3 mr-1"})),N(" "+u(n.value),1)],2))}},C=P("legalRequestsManagement",{state:()=>({requests:[],currentRequest:null,loading:!1,error:null,userRole:"client"}),getters:{getRequestsByStatus:e=>t=>e.requests.filter(s=>s.status===t),pendingRequestsCount:e=>e.requests.filter(t=>t.status==="PENDING").length,requestsWithResponses:e=>e.requests.filter(t=>t.response_count>0)},actions:{async fetchRequests(e={}){this.loading=!0,this.error=null;try{const t=new URLSearchParams;e.search&&t.append("search",e.search),e.status&&t.append("status",e.status),e.page&&t.append("page",e.page),e.date_from&&t.append("date_from",e.date_from),e.date_to&&t.append("date_to",e.date_to);const s=`legal_requests/${t.toString()?"?"+t.toString():""}`,o=await w(s);if(o.status===200)return this.requests=o.data.requests,this.userRole=o.data.user_role,{requests:o.data.requests,count:o.data.count,userRole:o.data.user_role};throw new Error("Failed to fetch requests")}catch(t){throw this.error=t.message,console.error("Error fetching legal requests:",t),t}finally{this.loading=!1}},async fetchRequestDetail(e){this.loading=!0,this.error=null;try{const t=await w(`legal_requests/${e}/`);if(t.status===200)return this.currentRequest=t.data,t.data;throw new Error("Failed to fetch request detail")}catch(t){throw this.error=t.message,console.error("Error fetching request detail:",t),t}finally{this.loading=!1}},async updateRequestStatus(e,t){try{const s=await B(`legal_requests/${e}/status/`,{status:t});if(s.status===200){const o=this.requests.findIndex(n=>n.id===e);return o!==-1&&(this.requests[o]={...this.requests[o],status:t,status_display:s.data.request.status_display}),this.currentRequest&&this.currentRequest.id===e&&(this.currentRequest=s.data.request),s.data.request}throw new Error("Failed to update request status")}catch(s){throw console.error("Error updating request status:",s),s}},async createResponse(e,t){try{const s=new FormData;s.append("response_text",t);const o=await b(`legal_requests/${e}/responses/`,s);if(o.status===201){this.currentRequest&&this.currentRequest.id===e&&(this.currentRequest.responses||(this.currentRequest.responses=[]),this.currentRequest.responses.push(o.data.response));const n=this.requests.findIndex(a=>a.id===e);return n!==-1&&(this.requests[n].response_count+=1),o.data.response}throw new Error("Failed to create response")}catch(s){throw console.error("Error creating response:",s),s}},async deleteRequest(e){var t,s,o,n;try{console.log(`üóëÔ∏è Attempting to delete legal request ID: ${e}`);const a=await F(`legal_requests/${e}/delete/`);if(console.log(`‚úÖ Delete response status: ${a.status}`,a.data),a.status===200||a.status===204)return this.requests=this.requests.filter(i=>i.id!==e),this.currentRequest&&this.currentRequest.id===e&&(this.currentRequest=null),!0;throw new Error(`Failed to delete request: Status ${a.status}`)}catch(a){console.error("‚ùå Error deleting request:",a),a.response?(console.error("Response status:",a.response.status),console.error("Response data:",a.response.data),console.error("Response headers:",a.response.headers)):a.request?console.error("Request made but no response received:",a.request):console.error("Error setting up request:",a.message);const i=((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.detail)||((n=(o=a.response)==null?void 0:o.data)==null?void 0:n.message)||a.message||"Error desconocido al eliminar la solicitud";throw new Error(i)}},async addFilesToRequest(e,t){try{const s=new FormData;t.forEach(n=>{s.append("files",n)});const o=await b(`legal_requests/${e}/files/`,s);if(o.status===200)return this.currentRequest&&this.currentRequest.id===e&&await this.fetchRequestDetail(e),{success:!0,data:o.data,message:o.data.message};throw new Error("Failed to add files")}catch(s){throw console.error("Error adding files to request:",s),s}},async downloadFile(e,t){try{const s=localStorage.getItem("token"),o={...s&&{Authorization:`Bearer ${s}`},Accept:"application/octet-stream, */*"},n=await V.get(`/api/legal_requests/${e}/files/${t}/download/`,{responseType:"arraybuffer",timeout:3e4,headers:o});if(n.status===200)return n;throw new Error(`Failed to download file: HTTP ${n.status}`)}catch(s){throw console.error("Error downloading file:",s),s}}}}),K={class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},W={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},H={class:"flex items-center justify-between mb-4"},J=r("h3",{class:"text-lg font-medium text-gray-900"}," Actualizar Estado ",-1),Q={class:"mb-4 p-3 bg-gray-50 rounded-lg"},X={class:"text-sm font-medium text-gray-900"},Y={class:"text-sm text-gray-600"},ee={class:"mb-4"},te=r("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Estado actual: ",-1),se={class:"mb-6"},re=r("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nuevo estado: ",-1),ae=j('<option value="">Seleccionar estado...</option><option value="PENDING">Pendiente</option><option value="IN_REVIEW">En Revisi√≥n</option><option value="RESPONDED">Respondida</option><option value="CLOSED">Cerrada</option>',5),oe=[ae],ne={class:"flex justify-end space-x-3"},ie=["disabled"],De={__name:"StatusUpdateModal",props:{request:{type:Object,required:!0}},emits:["close","updated"],setup(e,{emit:t}){const s=e,o=t,n=C(),a=x(""),i=x(!1),g=async()=>{if(!(!a.value||a.value===s.request.status)){i.value=!0;try{const l=await n.updateRequestStatus(s.request.id,a.value);o("updated",l)}catch(l){console.error("Error updating status:",l)}finally{i.value=!1}}};return(l,m)=>(d(),c("div",K,[r("div",W,[r("div",H,[J,r("button",{onClick:m[0]||(m[0]=h=>l.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[_(y($),{class:"h-6 w-6"})])]),r("div",Q,[r("p",X,u(e.request.request_number),1),r("p",Y,u(e.request.first_name)+" "+u(e.request.last_name),1)]),r("div",ee,[te,_(U,{status:e.request.status},null,8,["status"])]),r("div",se,[re,S(r("select",{"onUpdate:modelValue":m[1]||(m[1]=h=>a.value=h),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},oe,512),[[L,a.value]])]),r("div",ne,[r("button",{onClick:m[2]||(m[2]=h=>l.$emit("close")),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md"}," Cancelar "),r("button",{onClick:g,disabled:!a.value||a.value===e.request.status||i.value,class:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-md"},u(i.value?"Actualizando...":"Actualizar"),9,ie)])])]))}},le={class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},ue={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},de={class:"flex items-center justify-between mb-4"},ce=r("h3",{class:"text-lg font-medium text-red-900"}," Eliminar Solicitud ",-1),ge={class:"flex items-center justify-center mb-4"},me={class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100"},pe={class:"mb-4 p-3 bg-gray-50 rounded-lg"},he={class:"text-sm font-medium text-gray-900"},fe={class:"text-sm text-gray-600"},ve={class:"text-sm text-gray-600"},xe=r("div",{class:"mb-6"},[r("p",{class:"text-sm text-gray-700 mb-2"}," ¬øEst√°s seguro de que deseas eliminar esta solicitud? "),r("p",{class:"text-sm text-red-600 font-medium"}," Esta acci√≥n no se puede deshacer. Se eliminar√°n todos los archivos y respuestas asociadas. ")],-1),_e={class:"mb-6"},qe=r("label",{class:"block text-sm font-medium text-gray-700 mb-2"},' Para confirmar, escribe "eliminar": ',-1),ye={key:0,class:"mt-1 text-xs text-red-600"},we={key:0,class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md"},be={class:"text-sm text-red-800"},Re={class:"flex justify-end space-x-3"},Ee=["disabled"],$e=["disabled"],ke={__name:"DeleteConfirmModal",props:{request:{type:Object,required:!0}},emits:["close","deleted"],setup(e,{emit:t}){const s=e,o=t,n=C();Z();const a=x(""),i=x(!1),g=x(""),l=v(()=>a.value.toLowerCase().trim()==="eliminar"),m=()=>{l.value&&!i.value&&h()},h=async()=>{if(!l.value){g.value='Debes escribir "eliminar" para confirmar';return}i.value=!0,g.value="";try{console.log(`üóëÔ∏è Deleting legal request ID: ${s.request.id}`),await n.deleteRequest(s.request.id),console.log("‚úÖ Solicitud eliminada exitosamente"),o("deleted"),o("close"),console.log("üîÑ Redirigiendo a lista de solicitudes..."),window.location.href="/legal_requests_list"}catch(p){console.error("‚ùå Error deleting request:",p),g.value=p.message||"Error al eliminar la solicitud. Por favor intenta nuevamente.",p.response&&(console.error("Response status:",p.response.status),console.error("Response data:",p.response.data))}finally{i.value=!1}};return(p,f)=>(d(),c("div",le,[r("div",ue,[r("div",de,[ce,r("button",{onClick:f[0]||(f[0]=q=>p.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[_(y($),{class:"h-6 w-6"})])]),r("div",ge,[r("div",me,[_(y(A),{class:"h-6 w-6 text-red-600"})])]),r("div",pe,[r("p",he,u(e.request.request_number),1),r("p",fe,u(e.request.first_name)+" "+u(e.request.last_name),1),r("p",ve,u(e.request.email),1)]),xe,r("div",_e,[qe,S(r("input",{"onUpdate:modelValue":f[1]||(f[1]=q=>a.value=q),type:"text",placeholder:"eliminar",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500",onKeyup:z(m,["enter"])},null,544),[[T,a.value]]),a.value&&!l.value?(d(),c("p",ye,' Debes escribir exactamente "eliminar" para confirmar ')):R("",!0)]),g.value?(d(),c("div",we,[r("p",be,u(g.value),1)])):R("",!0),r("div",Re,[r("button",{onClick:f[2]||(f[2]=q=>p.$emit("close")),disabled:i.value,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md disabled:opacity-50 disabled:cursor-not-allowed"}," Cancelar ",8,Ee),r("button",{onClick:h,disabled:!l.value||i.value,class:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-md"},u(i.value?"Eliminando...":"Eliminar Solicitud"),9,$e)])])]))}};export{U as _,De as a,ke as b,C as u};
