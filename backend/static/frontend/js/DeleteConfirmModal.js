import{e as c,f as g,g as r,c as m,k as E,a4 as $,p as S,t as d,n as C,C as D,D as q,$ as N,E as w,a0 as k,q as M,r as p,h as x,j as v,G as y,w as b,S as I,x as L,u as B,v as F}from"./index.js";import{r as P}from"./ExclamationTriangleIcon.js";function j(e,t){return c(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z","clip-rule":"evenodd"})])}function _(e,t){return c(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z","clip-rule":"evenodd"})])}function A(e,t){return c(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),r("path",{"fill-rule":"evenodd",d:"M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z","clip-rule":"evenodd"})])}function V(e,t){return c(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-1.72 6.97a.75.75 0 1 0-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 1 0 1.06 1.06L12 13.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L13.06 12l1.72-1.72a.75.75 0 1 0-1.06-1.06L12 10.94l-1.72-1.72Z","clip-rule":"evenodd"})])}const Z={__name:"StatusBadge",props:{status:{type:String,required:!0}},setup(e){const t=e,s=m(()=>({PENDING:{text:"Pendiente",classes:"bg-yellow-100 text-yellow-800",icon:_},IN_REVIEW:{text:"En Revisión",classes:"bg-blue-100 text-blue-800",icon:A},RESPONDED:{text:"Respondida",classes:"bg-green-100 text-green-800",icon:j},CLOSED:{text:"Cerrada",classes:"bg-gray-100 text-gray-800",icon:V}})[t.status]||{text:t.status,classes:"bg-gray-100 text-gray-800",icon:_}),a=m(()=>s.value.classes),o=m(()=>s.value.text),n=m(()=>s.value.icon);return(l,f)=>(c(),g("span",{class:C([a.value,"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},[(c(),E($(n.value),{class:"w-3 h-3 mr-1"})),S(" "+d(o.value),1)],2))}},R=D("legalRequestsManagement",{state:()=>({requests:[],currentRequest:null,loading:!1,error:null,userRole:"client"}),getters:{getRequestsByStatus:e=>t=>e.requests.filter(s=>s.status===t),pendingRequestsCount:e=>e.requests.filter(t=>t.status==="PENDING").length,requestsWithResponses:e=>e.requests.filter(t=>t.response_count>0)},actions:{async fetchRequests(e={}){this.loading=!0,this.error=null;try{const t=new URLSearchParams;e.search&&t.append("search",e.search),e.status&&t.append("status",e.status),e.page&&t.append("page",e.page),e.date_from&&t.append("date_from",e.date_from),e.date_to&&t.append("date_to",e.date_to);const s=`legal_requests/${t.toString()?"?"+t.toString():""}`,a=await q(s);if(a.status===200)return this.requests=a.data.requests,this.userRole=a.data.user_role,{requests:a.data.requests,count:a.data.count,userRole:a.data.user_role};throw new Error("Failed to fetch requests")}catch(t){throw this.error=t.message,console.error("Error fetching legal requests:",t),t}finally{this.loading=!1}},async fetchRequestDetail(e){this.loading=!0,this.error=null;try{const t=await q(`legal_requests/${e}/`);if(t.status===200)return this.currentRequest=t.data,t.data;throw new Error("Failed to fetch request detail")}catch(t){throw this.error=t.message,console.error("Error fetching request detail:",t),t}finally{this.loading=!1}},async updateRequestStatus(e,t){try{const s=await N(`legal_requests/${e}/status/`,{status:t});if(s.status===200){const a=this.requests.findIndex(o=>o.id===e);return a!==-1&&(this.requests[a]={...this.requests[a],status:t,status_display:s.data.request.status_display}),this.currentRequest&&this.currentRequest.id===e&&(this.currentRequest=s.data.request),s.data.request}throw new Error("Failed to update request status")}catch(s){throw console.error("Error updating request status:",s),s}},async createResponse(e,t){try{const s=new FormData;s.append("response_text",t);const a=await w(`legal_requests/${e}/responses/`,s);if(a.status===201){this.currentRequest&&this.currentRequest.id===e&&(this.currentRequest.responses||(this.currentRequest.responses=[]),this.currentRequest.responses.push(a.data.response));const o=this.requests.findIndex(n=>n.id===e);return o!==-1&&(this.requests[o].response_count+=1),a.data.response}throw new Error("Failed to create response")}catch(s){throw console.error("Error creating response:",s),s}},async deleteRequest(e){try{if((await k(`legal_requests/${e}/`)).status===200)return this.requests=this.requests.filter(s=>s.id!==e),this.currentRequest&&this.currentRequest.id===e&&(this.currentRequest=null),!0;throw new Error("Failed to delete request")}catch(t){throw console.error("Error deleting request:",t),t}},async addFilesToRequest(e,t){try{const s=new FormData;t.forEach(o=>{s.append("files",o)});const a=await w(`legal_requests/${e}/files/`,s);if(a.status===200)return this.currentRequest&&this.currentRequest.id===e&&await this.fetchRequestDetail(e),{success:!0,data:a.data,message:a.data.message};throw new Error("Failed to add files")}catch(s){throw console.error("Error adding files to request:",s),s}},async downloadFile(e,t){try{const s=localStorage.getItem("token"),a={...s&&{Authorization:`Bearer ${s}`},Accept:"application/octet-stream, */*"},o=await M.get(`/api/legal_requests/${e}/files/${t}/download/`,{responseType:"arraybuffer",timeout:3e4,headers:a});if(o.status===200)return o;throw new Error(`Failed to download file: HTTP ${o.status}`)}catch(s){throw console.error("Error downloading file:",s),s}}}}),T={class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},z={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},O={class:"flex items-center justify-between mb-4"},G=r("h3",{class:"text-lg font-medium text-gray-900"}," Actualizar Estado ",-1),U={class:"mb-4 p-3 bg-gray-50 rounded-lg"},W={class:"text-sm font-medium text-gray-900"},H={class:"text-sm text-gray-600"},J={class:"mb-4"},K=r("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Estado actual: ",-1),Q={class:"mb-6"},X=r("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nuevo estado: ",-1),Y=L('<option value="">Seleccionar estado...</option><option value="PENDING">Pendiente</option><option value="IN_REVIEW">En Revisión</option><option value="RESPONDED">Respondida</option><option value="CLOSED">Cerrada</option>',5),ee=[Y],te={class:"flex justify-end space-x-3"},se=["disabled"],we={__name:"StatusUpdateModal",props:{request:{type:Object,required:!0}},emits:["close","updated"],setup(e,{emit:t}){const s=e,a=t,o=R(),n=p(""),l=p(!1),f=async()=>{if(!(!n.value||n.value===s.request.status)){l.value=!0;try{const u=await o.updateRequestStatus(s.request.id,n.value);a("updated",u)}catch(u){console.error("Error updating status:",u)}finally{l.value=!1}}};return(u,i)=>(c(),g("div",T,[r("div",z,[r("div",O,[G,r("button",{onClick:i[0]||(i[0]=h=>u.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[x(v(y),{class:"h-6 w-6"})])]),r("div",U,[r("p",W,d(e.request.request_number),1),r("p",H,d(e.request.first_name)+" "+d(e.request.last_name),1)]),r("div",J,[K,x(Z,{status:e.request.status},null,8,["status"])]),r("div",Q,[X,b(r("select",{"onUpdate:modelValue":i[1]||(i[1]=h=>n.value=h),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},ee,512),[[I,n.value]])]),r("div",te,[r("button",{onClick:i[2]||(i[2]=h=>u.$emit("close")),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md"}," Cancelar "),r("button",{onClick:f,disabled:!n.value||n.value===e.request.status||l.value,class:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-md"},d(l.value?"Actualizando...":"Actualizar"),9,se)])])]))}},re={class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},ae={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},oe={class:"flex items-center justify-between mb-4"},ne=r("h3",{class:"text-lg font-medium text-red-900"}," Eliminar Solicitud ",-1),ie={class:"flex items-center justify-center mb-4"},le={class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100"},ue={class:"mb-4 p-3 bg-gray-50 rounded-lg"},de={class:"text-sm font-medium text-gray-900"},ce={class:"text-sm text-gray-600"},he={class:"text-sm text-gray-600"},ge=r("div",{class:"mb-6"},[r("p",{class:"text-sm text-gray-700 mb-2"}," ¿Estás seguro de que deseas eliminar esta solicitud? "),r("p",{class:"text-sm text-red-600 font-medium"}," Esta acción no se puede deshacer. Se eliminarán todos los archivos y respuestas asociadas. ")],-1),fe={class:"mb-6"},me=r("label",{class:"block text-sm font-medium text-gray-700 mb-2"},' Para confirmar, escribe "ELIMINAR": ',-1),pe={class:"flex justify-end space-x-3"},xe=["disabled"],_e={__name:"DeleteConfirmModal",props:{request:{type:Object,required:!0}},emits:["close","deleted"],setup(e,{emit:t}){const s=e,a=t,o=R();B();const n=p(""),l=p(!1),f=async()=>{if(n.value==="ELIMINAR"){l.value=!0;try{await o.deleteRequest(s.request.id),a("deleted"),a("close"),console.log("🔄 Redirigiendo a lista de solicitudes..."),window.location.href="/legal_requests_list",console.log("✅ Solicitud eliminada exitosamente")}catch(u){console.error("Error deleting request:",u)}finally{l.value=!1}}};return(u,i)=>(c(),g("div",re,[r("div",ae,[r("div",oe,[ne,r("button",{onClick:i[0]||(i[0]=h=>u.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[x(v(y),{class:"h-6 w-6"})])]),r("div",ie,[r("div",le,[x(v(P),{class:"h-6 w-6 text-red-600"})])]),r("div",ue,[r("p",de,d(e.request.request_number),1),r("p",ce,d(e.request.first_name)+" "+d(e.request.last_name),1),r("p",he,d(e.request.email),1)]),ge,r("div",fe,[me,b(r("input",{"onUpdate:modelValue":i[1]||(i[1]=h=>n.value=h),type:"text",placeholder:"ELIMINAR",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"},null,512),[[F,n.value]])]),r("div",pe,[r("button",{onClick:i[2]||(i[2]=h=>u.$emit("close")),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md"}," Cancelar "),r("button",{onClick:f,disabled:n.value!=="ELIMINAR"||l.value,class:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-md"},d(l.value?"Eliminando...":"Eliminar Solicitud"),9,xe)])])]))}};export{Z as _,we as a,_e as b,R as u};
