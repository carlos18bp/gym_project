import{e as c,f as h,g as s,c as m,m as E,a4 as $,p as S,t as d,n as C,C as D,D as q,$ as N,E as _,a0 as M,r as p,j as x,l as v,G as w,w as b,S as k,x as L,u as I,v as B}from"./index.js";import{r as P}from"./ExclamationTriangleIcon.js";function j(e,t){return c(),h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z","clip-rule":"evenodd"})])}function y(e,t){return c(),h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z","clip-rule":"evenodd"})])}function F(e,t){return c(),h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),s("path",{"fill-rule":"evenodd",d:"M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z","clip-rule":"evenodd"})])}function V(e,t){return c(),h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-1.72 6.97a.75.75 0 1 0-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 1 0 1.06 1.06L12 13.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L13.06 12l1.72-1.72a.75.75 0 1 0-1.06-1.06L12 10.94l-1.72-1.72Z","clip-rule":"evenodd"})])}const Z={__name:"StatusBadge",props:{status:{type:String,required:!0}},setup(e){const t=e,r=m(()=>({PENDING:{text:"Pendiente",classes:"bg-yellow-100 text-yellow-800",icon:y},IN_REVIEW:{text:"En Revisi√≥n",classes:"bg-blue-100 text-blue-800",icon:F},RESPONDED:{text:"Respondida",classes:"bg-green-100 text-green-800",icon:j},CLOSED:{text:"Cerrada",classes:"bg-gray-100 text-gray-800",icon:V}})[t.status]||{text:t.status,classes:"bg-gray-100 text-gray-800",icon:y}),a=m(()=>r.value.classes),i=m(()=>r.value.text),o=m(()=>r.value.icon);return(l,f)=>(c(),h("span",{class:C([a.value,"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},[(c(),E($(o.value),{class:"w-3 h-3 mr-1"})),S(" "+d(i.value),1)],2))}},R=D("legalRequestsManagement",{state:()=>({requests:[],currentRequest:null,loading:!1,error:null,userRole:"client"}),getters:{getRequestsByStatus:e=>t=>e.requests.filter(r=>r.status===t),pendingRequestsCount:e=>e.requests.filter(t=>t.status==="PENDING").length,requestsWithResponses:e=>e.requests.filter(t=>t.response_count>0)},actions:{async fetchRequests(e={}){this.loading=!0,this.error=null;try{const t=new URLSearchParams;e.search&&t.append("search",e.search),e.status&&t.append("status",e.status),e.page&&t.append("page",e.page),e.date_from&&t.append("date_from",e.date_from),e.date_to&&t.append("date_to",e.date_to);const r=`legal_requests/${t.toString()?"?"+t.toString():""}`,a=await q(r);if(a.status===200)return this.requests=a.data.requests,this.userRole=a.data.user_role,{requests:a.data.requests,count:a.data.count,userRole:a.data.user_role};throw new Error("Failed to fetch requests")}catch(t){throw this.error=t.message,console.error("Error fetching legal requests:",t),t}finally{this.loading=!1}},async fetchRequestDetail(e){this.loading=!0,this.error=null;try{const t=await q(`legal_requests/${e}/`);if(t.status===200)return this.currentRequest=t.data,t.data;throw new Error("Failed to fetch request detail")}catch(t){throw this.error=t.message,console.error("Error fetching request detail:",t),t}finally{this.loading=!1}},async updateRequestStatus(e,t){try{const r=await N(`legal_requests/${e}/status/`,{status:t});if(r.status===200){const a=this.requests.findIndex(i=>i.id===e);return a!==-1&&(this.requests[a]={...this.requests[a],status:t,status_display:r.data.request.status_display}),this.currentRequest&&this.currentRequest.id===e&&(this.currentRequest=r.data.request),r.data.request}throw new Error("Failed to update request status")}catch(r){throw console.error("Error updating request status:",r),r}},async createResponse(e,t){try{const r=new FormData;r.append("response_text",t);const a=await _(`legal_requests/${e}/responses/`,r);if(a.status===201){this.currentRequest&&this.currentRequest.id===e&&(this.currentRequest.responses||(this.currentRequest.responses=[]),this.currentRequest.responses.push(a.data.response));const i=this.requests.findIndex(o=>o.id===e);return i!==-1&&(this.requests[i].response_count+=1),a.data.response}throw new Error("Failed to create response")}catch(r){throw console.error("Error creating response:",r),r}},async deleteRequest(e){try{if((await M(`legal_requests/${e}/`)).status===200)return this.requests=this.requests.filter(r=>r.id!==e),this.currentRequest&&this.currentRequest.id===e&&(this.currentRequest=null),!0;throw new Error("Failed to delete request")}catch(t){throw console.error("Error deleting request:",t),t}},async addFilesToRequest(e,t){try{const r=new FormData;t.forEach(i=>{r.append("files",i)});const a=await _(`legal_requests/${e}/files/`,r);if(a.status===200)return this.currentRequest&&this.currentRequest.id===e&&await this.fetchRequestDetail(e),{success:!0,data:a.data,message:a.data.message};throw new Error("Failed to add files")}catch(r){throw console.error("Error adding files to request:",r),r}}}}),A={class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},z={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},O={class:"flex items-center justify-between mb-4"},T=s("h3",{class:"text-lg font-medium text-gray-900"}," Actualizar Estado ",-1),G={class:"mb-4 p-3 bg-gray-50 rounded-lg"},U={class:"text-sm font-medium text-gray-900"},W={class:"text-sm text-gray-600"},H={class:"mb-4"},J=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Estado actual: ",-1),K={class:"mb-6"},Q=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nuevo estado: ",-1),X=L('<option value="">Seleccionar estado...</option><option value="PENDING">Pendiente</option><option value="IN_REVIEW">En Revisi√≥n</option><option value="RESPONDED">Respondida</option><option value="CLOSED">Cerrada</option>',5),Y=[X],ee={class:"flex justify-end space-x-3"},te=["disabled"],qe={__name:"StatusUpdateModal",props:{request:{type:Object,required:!0}},emits:["close","updated"],setup(e,{emit:t}){const r=e,a=t,i=R(),o=p(""),l=p(!1),f=async()=>{if(!(!o.value||o.value===r.request.status)){l.value=!0;try{const u=await i.updateRequestStatus(r.request.id,o.value);a("updated",u)}catch(u){console.error("Error updating status:",u)}finally{l.value=!1}}};return(u,n)=>(c(),h("div",A,[s("div",z,[s("div",O,[T,s("button",{onClick:n[0]||(n[0]=g=>u.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[x(v(w),{class:"h-6 w-6"})])]),s("div",G,[s("p",U,d(e.request.request_number),1),s("p",W,d(e.request.first_name)+" "+d(e.request.last_name),1)]),s("div",H,[J,x(Z,{status:e.request.status},null,8,["status"])]),s("div",K,[Q,b(s("select",{"onUpdate:modelValue":n[1]||(n[1]=g=>o.value=g),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},Y,512),[[k,o.value]])]),s("div",ee,[s("button",{onClick:n[2]||(n[2]=g=>u.$emit("close")),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md"}," Cancelar "),s("button",{onClick:f,disabled:!o.value||o.value===e.request.status||l.value,class:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-md"},d(l.value?"Actualizando...":"Actualizar"),9,te)])])]))}},se={class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},re={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},ae={class:"flex items-center justify-between mb-4"},oe=s("h3",{class:"text-lg font-medium text-red-900"}," Eliminar Solicitud ",-1),ne={class:"flex items-center justify-center mb-4"},ie={class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100"},le={class:"mb-4 p-3 bg-gray-50 rounded-lg"},ue={class:"text-sm font-medium text-gray-900"},de={class:"text-sm text-gray-600"},ce={class:"text-sm text-gray-600"},ge=s("div",{class:"mb-6"},[s("p",{class:"text-sm text-gray-700 mb-2"}," ¬øEst√°s seguro de que deseas eliminar esta solicitud? "),s("p",{class:"text-sm text-red-600 font-medium"}," Esta acci√≥n no se puede deshacer. Se eliminar√°n todos los archivos y respuestas asociadas. ")],-1),he={class:"mb-6"},fe=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},' Para confirmar, escribe "ELIMINAR": ',-1),me={class:"flex justify-end space-x-3"},pe=["disabled"],_e={__name:"DeleteConfirmModal",props:{request:{type:Object,required:!0}},emits:["close","deleted"],setup(e,{emit:t}){const r=e,a=t,i=R();I();const o=p(""),l=p(!1),f=async()=>{if(o.value==="ELIMINAR"){l.value=!0;try{await i.deleteRequest(r.request.id),a("deleted"),a("close"),console.log("üîÑ Redirigiendo a lista de solicitudes..."),window.location.href="/legal_requests_list",console.log("‚úÖ Solicitud eliminada exitosamente")}catch(u){console.error("Error deleting request:",u)}finally{l.value=!1}}};return(u,n)=>(c(),h("div",se,[s("div",re,[s("div",ae,[oe,s("button",{onClick:n[0]||(n[0]=g=>u.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[x(v(w),{class:"h-6 w-6"})])]),s("div",ne,[s("div",ie,[x(v(P),{class:"h-6 w-6 text-red-600"})])]),s("div",le,[s("p",ue,d(e.request.request_number),1),s("p",de,d(e.request.first_name)+" "+d(e.request.last_name),1),s("p",ce,d(e.request.email),1)]),ge,s("div",he,[fe,b(s("input",{"onUpdate:modelValue":n[1]||(n[1]=g=>o.value=g),type:"text",placeholder:"ELIMINAR",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"},null,512),[[B,o.value]])]),s("div",me,[s("button",{onClick:n[2]||(n[2]=g=>u.$emit("close")),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md"}," Cancelar "),s("button",{onClick:f,disabled:o.value!=="ELIMINAR"||l.value,class:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-md"},d(l.value?"Eliminando...":"Eliminar Solicitud"),9,pe)])])]))}};export{Z as _,qe as a,_e as b,R as u};
