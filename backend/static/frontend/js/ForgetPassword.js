import{u as U,r,o as T,d as S,e as f,f as x,g as e,h as C,w as p,v,n as D,t as R,i as w,m as F,l as M,j as b,k as y,p as g,F as K,_ as L,s,q as I}from"./index.js";import{u as $,_ as z,a as A,b as G}from"./captcha.js";const H=e("div",{class:"relative xl:absolute"},[e("div",{class:"flex justify-start p-4"},[e("img",{class:"w-40 hidden xl:block",src:z}),e("img",{class:"w-20 block xl:hidden",src:L})])],-1),J={class:"flex mt-6 justify-center xl:mt-0 xl:h-screen xl:items-center"},O=e("h1",{class:"font-bold text-center text-2xl xl:text-3xl 2xl:text-4xl"}," No te preocupes, vamos ayudarte ",-1),Q={class:"grid"},W=e("label",{for:"email",class:"block mb-2 text-sm font-medium text-gray-900"}," Correo electronico ",-1),X=e("label",{for:"passcode",class:"block mb-2 text-sm font-medium text-gray-900"}," Código de verificación ",-1),Y=["disabled"],Z={key:0,class:"text-start text-sm mt-2 text-gray-600"},ee=e("span",{class:"font-regular"},"Enviar nuevo código en ",-1),se={class:"font-bold"},te=e("span",{class:"font-regular"}," segundos.",-1),oe=e("label",{for:"password",class:"block mb-2 text-sm font-medium text-gray-900"}," Contraseña ",-1),ae=e("label",{for:"confirm_password",class:"block mb-2 text-sm font-medium text-gray-900"}," Confirmar contraseña ",-1),re={class:"grid"},ne=e("button",{type:"submit",class:"w-full text-white bg-secondary hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center"}," Iniciar sesión ",-1),le={class:"w-full font-medium rounded-lg text-sm py-2.5 text-start"},ie=e("span",null,"¿Recordaste tu contraseña? ",-1),ce=e("span",{class:"text-secondary"},"Iniciar sesión",-1),de={key:0,class:"text-center mt-2 text-gray-600"},ue={class:"font-bold"},me={class:"w-full py-12 flex justify-around items-center text-center text-secondary font font-regular text-sm"},fe=e("div",{class:"h-screen hidden overflow-hidden order-1 xl:w-1/2 2xl:w-1/3 xl:block"},[e("img",{src:A,alt:"illustration",class:"w-full h-full object-cover"})],-1),_e={__name:"ForgetPassword",setup(pe){const q=U(),d=r(""),u=r(""),i=r(""),m=r(""),a=r(0),c=r(!1),h=$(),_=r(""),n=r(""),V=async t=>{await h.verify(t)?n.value=t:(s("Error verificando captcha","error"),n.value="")},E=()=>{n.value=""};T(async()=>{_.value=await h.fetchSiteKey(),parseInt(localStorage.getItem("forgetPasswordSecondsRemaining"),10)&&k()});const N=async()=>{if(!d.value){s("Email is required!","warning");return}if(!n.value){s("Por favor verifica que no eres un robot","warning");return}try{await I.post("/api/send_passcode/",{email:d.value,subject_email:"Password Reset Code",captcha_token:n.value}),s("Password reset code sent to your email","info"),k()}catch(t){console.error("Error when password reset is requested:",t),s("User not found","warning")}},k=()=>{parseInt(localStorage.getItem("forgetPasswordSecondsRemaining"),10)||localStorage.setItem("forgetPasswordSecondsRemaining",180),c.value=!0,a.value=parseInt(localStorage.getItem("forgetPasswordSecondsRemaining"),10);const t=setInterval(()=>{a.value--,localStorage.setItem("forgetPasswordSecondsRemaining",a.value),a.value<=0&&(clearInterval(t),c.value=!1,localStorage.removeItem("forgetPasswordSecondsRemaining"))},1e3)},j=async()=>{if(!u.value){s("Passcode is required!","warning");return}if(!i.value){s("New Password is required!","warning");return}if(!m.value){s("Confirm Password is required!","warning");return}if(i.value!==m.value){s("Passwords do not match!","warning");return}if(!n.value){s("Por favor verifica que no eres un robot","warning");return}try{await I.post("/api/verify_passcode_and_reset_password/",{passcode:u.value,new_password:i.value,captcha_token:n.value}),s("Password reset successful!","success"),q.push({name:"sign_in"})}catch(t){s(t.response.data.error,"error")}};return(t,o)=>{const B=S("RouterLink"),P=S("router-link");return f(),x(K,null,[H,e("section",J,[e("form",{class:"space-y-5 px-8 w-full md:px-32 2xl:px-72 xl:w-1/2 2xl:w-2/3 order-2",onSubmit:C(j,["prevent"])},[O,e("div",Q,[e("div",null,[W,p(e("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>d.value=l),type:"email",id:"email",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5",required:""},null,512),[[v,d.value]])])]),e("div",null,[X,p(e("input",{"onUpdate:modelValue":o[1]||(o[1]=l=>u.value=l),type:"number",id:"passcode",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"},null,512),[[v,u.value]]),e("button",{class:D({"text-sm font-medium text-secondary cursor-pointer":!c.value,hidden:c.value}),onClick:C(N,["prevent"]),disabled:c.value}," Enviar código ",10,Y),a.value>0?(f(),x("div",Z,[ee,e("span",se,R(a.value),1),te])):w("",!0)]),e("div",null,[oe,p(e("input",{"onUpdate:modelValue":o[2]||(o[2]=l=>i.value=l),type:"password",id:"password",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"},null,512),[[v,i.value]])]),e("div",null,[ae,p(e("input",{"onUpdate:modelValue":o[3]||(o[3]=l=>m.value=l),type:"password",id:"confirm_password",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"},null,512),[[v,m.value]])]),e("div",null,[_.value?(f(),F(M(G),{key:0,sitekey:_.value,onVerify:V,onExpire:E,hl:"es",class:"mx-auto"},null,8,["sitekey"])):w("",!0)]),e("div",re,[ne,e("p",le,[ie,b(B,{to:{name:"sign_in"}},{default:y(()=>[ce]),_:1})])]),a.value>0?(f(),x("div",de,[g(" Por favor espere "),e("span",ue,R(a.value),1),g(" antes de enviar un nuevo código. ")])):w("",!0),e("div",me,[b(P,{to:{name:"terms_of_use"},class:"cursor-pointer"},{default:y(()=>[g("Condiciones de uso")]),_:1}),b(P,{to:{name:"privacy_policy"},class:"cursor-pointer"},{default:y(()=>[g("Aviso de privacidad")]),_:1})])],32),fe])],64)}}};export{_e as default};
