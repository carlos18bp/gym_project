import{u as U,r as o,o as T,d as P,e as d,f as p,g as e,m as I,w,v as b,n as V,l as v,p as u,t as y,k as A,j as D,h as k,i as C,F,_ as H,s,q}from"./index.js";import{u as K,_ as $,a as G,b as J}from"./captcha.js";const O=e("div",{class:"relative xl:absolute"},[e("div",{class:"flex justify-start p-4"},[e("img",{class:"w-40 hidden xl:block",src:$}),e("img",{class:"w-20 block xl:hidden",src:H})])],-1),Q={class:"flex mt-6 justify-center xl:mt-0 xl:h-screen xl:items-center"},W=e("h1",{class:"font-bold text-center text-2xl xl:text-3xl 2xl:text-4xl"}," No te preocupes, vamos ayudarte ",-1),X={class:"grid"},Y=e("label",{for:"email",class:"block mb-2 text-sm font-medium text-gray-900"}," Correo electronico ",-1),Z=e("label",{for:"passcode",class:"block mb-2 text-sm font-medium text-gray-900"}," Código de verificación ",-1),ee=["disabled"],te={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},se=e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),oe=e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1),ae=[se,oe],re={key:0,class:"text-start text-sm mt-2 text-gray-600"},ne=e("span",{class:"font-regular"},"Enviar nuevo código en ",-1),le={class:"font-bold"},ie=e("span",{class:"font-regular"}," segundos.",-1),ce=e("label",{for:"password",class:"block mb-2 text-sm font-medium text-gray-900"}," Contraseña ",-1),de=e("label",{for:"confirm_password",class:"block mb-2 text-sm font-medium text-gray-900"}," Confirmar contraseña ",-1),ue={class:"grid"},me=["disabled"],fe={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},pe=e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),ve=e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1),ge=[pe,ve],_e={class:"w-full font-medium rounded-lg text-sm py-2.5 text-start"},xe=e("span",null,"¿Recordaste tu contraseña? ",-1),we=e("span",{class:"text-secondary"},"Iniciar sesión",-1),be={key:0,class:"text-center mt-2 text-gray-600"},ye={class:"font-bold"},he={class:"w-full py-12 flex justify-around items-center text-center text-secondary font font-regular text-sm"},ke=e("div",{class:"h-screen hidden overflow-hidden order-1 xl:w-1/2 2xl:w-1/3 xl:block"},[e("img",{src:G,alt:"illustration",class:"w-full h-full object-cover"})],-1),Pe={__name:"ForgetPassword",setup(Ce){const E=U(),g=o(""),_=o(""),m=o(""),x=o(""),r=o(0),f=o(!1),a=o(!1),n=o(!1),j=K(),h=o(""),c=o(""),B=async t=>{c.value=t},N=()=>{c.value=""};T(async()=>{h.value=await j.fetchSiteKey(),parseInt(localStorage.getItem("forgetPasswordSecondsRemaining"),10)&&S()});const z=async()=>{if(!g.value){s("Email is required!","warning");return}if(!c.value){s("Por favor verifica que no eres un robot","warning");return}if(!a.value){a.value=!0;try{await q.post("/api/send_passcode/",{email:g.value,subject_email:"Password Reset Code",captcha_token:c.value}),s("Código de restablecimiento enviado a tu correo","info"),S()}catch(t){console.error("Error when password reset is requested:",t),t.response&&t.response.status===400?s(t.response.data.error||"Error de validación","error"):s("Usuario no encontrado","warning")}finally{a.value=!1}}},S=()=>{parseInt(localStorage.getItem("forgetPasswordSecondsRemaining"),10)||localStorage.setItem("forgetPasswordSecondsRemaining",180),f.value=!0,r.value=parseInt(localStorage.getItem("forgetPasswordSecondsRemaining"),10);const t=setInterval(()=>{r.value--,localStorage.setItem("forgetPasswordSecondsRemaining",r.value),r.value<=0&&(clearInterval(t),f.value=!1,localStorage.removeItem("forgetPasswordSecondsRemaining"))},1e3)},L=async()=>{if(!_.value){s("Código es requerido!","warning");return}if(!m.value){s("Nueva contraseña es requerida!","warning");return}if(!x.value){s("Confirmar contraseña es requerido!","warning");return}if(m.value!==x.value){s("Las contraseñas no coinciden!","warning");return}if(!c.value){s("Por favor verifica que no eres un robot","warning");return}if(!n.value){n.value=!0;try{await q.post("/api/verify_passcode_and_reset_password/",{passcode:_.value,new_password:m.value,captcha_token:c.value}),s("¡Contraseña restablecida exitosamente!","success"),E.push({name:"sign_in"})}catch(t){t.response&&t.response.data?s(t.response.data.error,"error"):s("Error al restablecer contraseña","error")}finally{n.value=!1}}};return(t,l)=>{const M=P("RouterLink"),R=P("router-link");return d(),p(F,null,[O,e("section",Q,[e("form",{class:"space-y-5 px-8 w-full md:px-32 2xl:px-72 xl:w-1/2 2xl:w-2/3 order-2",onSubmit:I(L,["prevent"])},[W,e("div",X,[e("div",null,[Y,w(e("input",{"onUpdate:modelValue":l[0]||(l[0]=i=>g.value=i),type:"email",id:"email",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5",required:""},null,512),[[b,g.value]])])]),e("div",null,[Z,w(e("input",{"onUpdate:modelValue":l[1]||(l[1]=i=>_.value=i),type:"number",id:"passcode",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"},null,512),[[b,_.value]]),e("button",{class:V({"text-sm font-medium text-secondary cursor-pointer flex items-center":!f.value&&!a.value,"text-sm font-medium text-gray-400 cursor-not-allowed flex items-center":a.value,hidden:f.value&&!a.value}),onClick:I(z,["prevent"]),disabled:f.value||a.value},[a.value?(d(),p("svg",te,ae)):v("",!0),u(" "+y(a.value?"Enviando...":"Enviar código"),1)],10,ee),r.value>0?(d(),p("div",re,[ne,e("span",le,y(r.value),1),ie])):v("",!0)]),e("div",null,[ce,w(e("input",{"onUpdate:modelValue":l[2]||(l[2]=i=>m.value=i),type:"password",id:"password",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"},null,512),[[b,m.value]])]),e("div",null,[de,w(e("input",{"onUpdate:modelValue":l[3]||(l[3]=i=>x.value=i),type:"password",id:"confirm_password",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"},null,512),[[b,x.value]])]),e("div",null,[h.value?(d(),A(D(J),{key:0,sitekey:h.value,onVerify:B,onExpire:N,hl:"es",class:"mx-auto"},null,8,["sitekey"])):v("",!0)]),e("div",ue,[e("button",{type:"submit",disabled:n.value,class:V({"w-full text-white bg-secondary hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center flex items-center justify-center":!n.value,"w-full text-white bg-gray-400 cursor-not-allowed font-medium rounded-lg text-sm px-5 py-2.5 text-center flex items-center justify-center":n.value})},[n.value?(d(),p("svg",fe,ge)):v("",!0),u(" "+y(n.value?"Restableciendo contraseña...":"Iniciar sesión"),1)],10,me),e("p",_e,[xe,k(M,{to:{name:"sign_in"}},{default:C(()=>[we]),_:1})])]),r.value>0?(d(),p("div",be,[u(" Por favor espere "),e("span",ye,y(r.value),1),u(" antes de enviar un nuevo código. ")])):v("",!0),e("div",he,[k(R,{to:{name:"terms_of_use"},class:"cursor-pointer"},{default:C(()=>[u("Condiciones de uso")]),_:1}),k(R,{to:{name:"privacy_policy"},class:"cursor-pointer"},{default:C(()=>[u("Aviso de privacidad")]),_:1})])],32),ke])],64)}}};export{Pe as default};
