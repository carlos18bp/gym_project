import{e as i,f as r,g as e,w as C,M as S,I,k as M,t as o,j as B,l as E,A as $,a0 as V,ah as j,L as N,r as F,P as w,n as _,m as v,i as x,F as b,H as k,J as L,K as P,X as D,s as T}from"./index.js";import{u as z}from"./dynamicDocument.js";import{_ as A}from"./_plugin-vue_export-helper.js";function Be(a,c){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"})])}const H={class:"bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full overflow-auto max-h-[80vh]"},U={class:"flex justify-between items-center mb-4"},Z={class:"text-lg font-bold"},q=["innerHTML"],Ee={__name:"DocumentPreviewModal",props:{isVisible:Boolean,documentData:{type:Object,default:()=>({title:"",content:""})}},emits:["close"],setup(a,{emit:c}){const l=c,g=()=>{l("close")};return(h,s)=>C((i(),I(V,null,{default:M(()=>[e("div",H,[e("div",U,[e("h2",Z," Previsualización del Documento: "+o(a.documentData.title),1),e("button",{onClick:g},[B(E($),{class:"size-6 text-gray-500 hover:text-gray-700"})])]),e("div",{class:"prose max-w-none",innerHTML:a.documentData.content},null,8,q)])]),_:1},512)),[[S,a.isVisible]])}};function $e(a){return j.fire({title:a,icon:"question",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",buttonsStyling:!1}).then(c=>c.isConfirmed)}const m=a=>(L("data-v-d1cc7ea2"),a=a(),P(),a),J={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},K={class:"relative bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col"},O=m(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Estado de firmas del documento",-1)),R=m(()=>e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),X=[R],G={class:"p-6 overflow-y-auto flex-grow"},Q={key:0,class:"text-center py-10"},W=m(()=>e("div",{class:"spinner"},null,-1)),Y=m(()=>e("p",{class:"mt-4 text-gray-500"},"Cargando información de firmas...",-1)),ee=[W,Y],te={key:1},se={class:"mb-4"},oe={class:"text-lg font-medium text-gray-900"},ae={class:"text-sm text-gray-500"},ne={class:"inline-flex items-center"},ie={key:0,class:"text-sm text-gray-500 mt-1"},re={class:"text-sm text-gray-500 mt-1"},le={class:"mt-6"},ce={class:"min-w-full divide-y divide-gray-200"},de=m(()=>e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Usuario"),e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado"),e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Fecha de firma")])],-1)),ue={class:"bg-white divide-y divide-gray-200"},me={class:"px-4 py-4 whitespace-nowrap"},_e={class:"flex items-center"},xe={class:"text-sm font-medium text-gray-900 flex items-center"},ge={key:0,class:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full"},pe={class:"text-sm text-gray-500"},he={class:"px-4 py-4 whitespace-nowrap"},fe={class:"px-4 py-4 whitespace-nowrap text-sm text-gray-500"},ye={class:"px-4 py-4 whitespace-nowrap"},we={class:"flex items-center"},ve={class:"text-sm font-medium text-gray-900"},be={class:"text-sm text-gray-500"},ke={class:"px-4 py-4 whitespace-nowrap"},De={class:"px-4 py-4 whitespace-nowrap text-sm text-gray-500"},Ce={__name:"DocumentSignaturesModal",props:{isVisible:Boolean,documentId:Number},emits:["close","refresh"],setup(a,{emit:c}){const l=a,g=c;z();const h=N(),s=F(null),p=()=>{g("close")},f=n=>n?new Date(n).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—",y=async()=>{if(!l.documentId){console.error("No document ID provided");return}try{const n=h.currentUser.id,d=await D(`dynamic-documents/user/${n}/pending-documents-full/`);if(d.status!==200)throw new Error(`Error loading documents: ${d.status}`);const t=d.data.find(u=>u.id===l.documentId);if(t)s.value=t;else{const u=await D(`dynamic-documents/${l.documentId}/`);if(u.status!==200)throw new Error(`Error loading document: ${u.status}`);s.value=u.data}}catch(n){console.error("Error loading document data:",n),n.response&&console.error("Error response data:",n.response.data),s.value=null,await T("Error al cargar la información de firmas","error")}};return w(()=>l.isVisible,n=>{n&&y()}),w(()=>l.documentId,n=>{n&&l.isVisible&&y()}),(n,d)=>a.isVisible?(i(),r("div",J,[e("div",{class:"absolute inset-0 bg-black opacity-50",onClick:p}),e("div",K,[e("div",{class:"px-6 py-4 border-b border-gray-200"},[O,e("button",{onClick:p,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},X)]),e("div",G,[s.value?(i(),r("div",te,[e("div",se,[e("h3",oe,o(s.value.title),1),e("p",ae,[e("span",ne,[e("span",{class:_(["inline-block w-3 h-3 rounded-full mr-2",s.value.fully_signed?"bg-green-500":"bg-yellow-500"])},null,2),v(" "+o(s.value.fully_signed?"Documento completamente firmado":"Pendiente de firmas"),1)])]),s.value.creator?(i(),r("p",ie," Creado por: "+o(s.value.creator.name)+" ("+o(s.value.creator.email)+") ",1)):x("",!0),e("p",re," Firmas: "+o(s.value.completed_signatures||0)+"/"+o(s.value.total_signatures||0),1)]),e("div",le,[e("table",ce,[de,e("tbody",ue,[(i(!0),r(b,null,k(s.value.signers||[],t=>(i(),r("tr",{key:"sig_"+t.signature_id,class:_({"bg-blue-50":t.is_current_user})},[e("td",me,[e("div",_e,[e("div",null,[e("div",xe,[v(o(t.signer_name)+" ",1),t.is_current_user?(i(),r("span",ge,"Tú")):x("",!0)]),e("div",pe,o(t.signer_email),1)])])]),e("td",he,[e("span",{class:_(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",t.signed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},o(t.signed?"Firmado":"Pendiente"),3)]),e("td",fe,o(t.signed_at?f(t.signed_at):"—"),1)],2))),128)),!s.value.signers&&s.value.signatures?(i(!0),r(b,{key:0},k(s.value.signatures,t=>(i(),r("tr",{key:"old_"+t.id},[e("td",ye,[e("div",we,[e("div",null,[e("div",ve,o(t.signer_name||t.signer_email),1),e("div",be,o(t.signer_email),1)])])]),e("td",ke,[e("span",{class:_(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",t.signed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},o(t.signed?"Firmado":"Pendiente"),3)]),e("td",De,o(t.signed_at?f(t.signed_at):"—"),1)]))),128)):x("",!0)])])])])):(i(),r("div",Q,ee))]),e("div",{class:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end"},[e("button",{onClick:p,class:"px-4 py-2 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400"}," Cerrar ")])])])):x("",!0)}},Ve=A(Ce,[["__scopeId","data-v-d1cc7ea2"]]);export{Ve as D,Ee as _,Be as r,$e as s};
