import{e as r,f as u,g as e,u as Ce,r as j,aH as ze,o as Y,ap as he,c as B,j as x,l as f,G as oe,w as ne,v as Se,n as V,i as C,t as I,h as ie,p as X,s as P,ab as Oe,k as K,aU as ae,a8 as Ve,aV as He,Q as ye,m as Q,a1 as ce,F as R,P as se,N as fe,O as pe,D as be,E as Ge,aW as We,a0 as Je,C as Ke,a as Ze,aX as ke,aY as qe,T as J,M as O,ae as Xe}from"./index.js";import{u as ee,s as ge,p as Te,o as Ye}from"./index3.js";import{g as ue,r as Fe,a as xe}from"./DocumentPermissionsManager.js";import{_ as et}from"./SearchBarAndFilterBy.js";import{r as de,_ as me}from"./DocumentCard.js";import{r as te}from"./PlusIcon.js";import{_ as ve}from"./_plugin-vue_export-helper.js";import{r as je}from"./MagnifyingGlassIcon2.js";import{r as Pe,B as tt,c as st,b as Le,_ as Ae}from"./index2.js";import{_ as Ie,S as De}from"./SignaturesList.js";import{r as Ue}from"./loading_message.js";import{r as ot}from"./TrashIcon.js";import{useRecentViews as rt}from"./useRecentViews.js";import"./MagnifyingGlassIcon.js";import"./PhotoIcon.js";import"./InformationCircleIcon.js";function nt(t,o){return r(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function at(t,o){return r(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function Ne(t,o){return r(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 6h.008v.008H6V6Z"})])}const lt={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},it={class:"flex justify-end"},dt=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[X(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),ct={class:"mt-2"},ut={class:"flex gap-2 mt-2.5"},mt=["disabled"],gt=e("span",null,"Actualizar nombre",-1),ht=[gt],ft=["disabled"],pt={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(t,{emit:o}){const s=t,m=Ce(),g=ee(),a=o,n=j(""),_=j(""),l=()=>{a("close")};ze(()=>{var d,b;g.selectedDocument?(n.value=((d=g.selectedDocument)==null?void 0:d.title)||"",_.value=((b=g.selectedDocument)==null?void 0:b.title)||""):(n.value="",_.value="")});const c=d=>{d.key==="Escape"&&l()};Y(()=>{document.addEventListener("keydown",c)}),he(()=>{document.removeEventListener("keydown",c)});const h=B(()=>n.value.trim().length>0),y=B(()=>{var d;return!!((d=g.selectedDocument)!=null&&d.id)}),U=B(()=>y.value&&n.value.trim()!==_.value.trim()&&n.value.trim().length>0);async function S(){if(y.value&&U.value)try{const d={title:n.value.trim()};await g.updateDocument(g.selectedDocument.id,d),_.value=n.value.trim(),g.selectedDocument.title=n.value.trim();const b=g.selectedDocument.id;P("Document name successfully updated.","success"),a("close",{updatedDocId:b});const T=window.location.pathname;T==="/dynamic_document_dashboard"||T==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(d){console.error("Error updating document name:",d),P("Error updating document name.","error")}}function v(){const d=encodeURIComponent(n.value.trim());s.documentId&&!g.selectedDocument?m.push(`/dynamic_document_dashboard/document/use/creator/${s.documentId}/${d}`):g.selectedDocument?(g.selectedDocument.title=n.value.trim(),m.push(`/dynamic_document_dashboard/document/use/editor/${g.selectedDocument.id}/${d}`)):P("Error: No se pudo continuar. Documento no seleccionado.","error")}return(d,b)=>(r(),u("div",lt,[e("div",it,[e("button",{onClick:l},[x(f(oe),{class:"size-6"})])]),e("form",{onSubmit:ie(v,["prevent"])},[e("div",null,[dt,e("div",ct,[ne(e("input",{"onUpdate:modelValue":b[0]||(b[0]=L=>n.value=L),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[Se,n.value]])])]),e("div",ut,[y.value?(r(),u("button",{key:0,type:"button",onClick:S,disabled:!U.value,class:V(["p-2.5 text-sm font-medium rounded-md flex gap-2",U.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},ht,10,mt)):C("",!0),e("button",{type:"submit",class:V(["p-2.5 text-sm font-medium rounded-md flex gap-2",h.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!h.value},[e("span",null,I(y.value?"Editar Documento":"Continuar"),1)],10,ft)])],32)]))}},vt={class:"mt-3 pt-2 border-t border-gray-100"},yt={class:"flex items-center gap-2 text-xs text-gray-500"},bt=e("span",null,"Hacer clic para usar este documento",-1),Be={__name:"UseDocumentCard",props:{document:{type:Object,required:!0},showTags:{type:Boolean,default:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null}},emits:["click","remove-from-folder","document-created"],setup(t,{emit:o}){const s=t,m=o,g=j(!1),a=j(null),n=ue(9),_=B(()=>"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium !bg-purple-100 !text-purple-700 !border !border-purple-200"),l=B(()=>n.dark),c=B(()=>"group !border-purple-400 !bg-purple-50/50 !shadow-purple-100"),h=B(()=>s.menuOptions!==null?s.menuOptions:null),y=B(()=>s.disableInternalActions?!1:s.showMenuOptions===!1||s.showMenuOptions!==!0&&s.cardContext!=="folder"),U=(d,b)=>{s.disableInternalActions?m("click",d,b):S(d.id)};function S(d){d?(a.value=d,g.value=!0):console.error("Document ID is required:",d)}function v(d){if(g.value=!1,a.value=null,d&&d.updatedDocId){m("document-created",d);const b=window.location.pathname;b==="/dynamic_document_dashboard"||b==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(d.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}}return(d,b)=>(r(),u(R,null,[x(tt,{document:t.document,"card-type":t.cardType,"card-context":t.cardContext,"status-icon":f(He),"status-text":"Disponible","status-badge-classes":_.value,"menu-options":h.value,"highlighted-doc-id":null,"show-tags":t.showTags,"document-store":t.documentStore,"user-store":t.userStore,"additional-classes":c.value,"disable-internal-actions":t.disableInternalActions,"show-menu-options":t.showMenuOptions,onClick:U,onRemoveFromFolder:b[0]||(b[0]=L=>d.$emit("remove-from-folder",L))},Oe({"additional-actions":K(()=>[Ve(d.$slots,"additional-actions")]),_:2},[y.value?{name:"right-action",fn:K(()=>[x(f(Pe),{class:"w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors"})]),key:"0"}:void 0,t.disableInternalActions?void 0:{name:"footer",fn:K(()=>[e("div",vt,[e("div",yt,[e("div",{class:"w-2 h-2 rounded-full",style:ae({backgroundColor:l.value})},null,4),bt])])]),key:"1"}]),1032,["document","card-type","card-context","status-icon","status-badge-classes","menu-options","show-tags","document-store","user-store","additional-classes","disable-internal-actions","show-menu-options"]),ne(x(ce,null,{default:K(()=>[a.value!==null?(r(),Q(pt,{key:0,"document-id":a.value,onClose:v},null,8,["document-id"])):C("",!0)]),_:1},512),[[ye,g.value]])],64))}},_e=t=>(fe("data-v-a52f6718"),t=t(),pe(),t),xt={class:"flex items-start justify-between mb-4"},_t={class:"flex items-center gap-3"},wt={class:"relative"},$t={class:"flex-1 min-w-0"},kt={class:"font-medium text-gray-900 text-sm truncate group-hover:text-primary transition-colors"},Dt={class:"text-xs text-gray-500 mt-0.5"},Ct={class:"relative folder-menu-container"},St={key:0,class:"absolute right-0 top-full mt-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50"},Ft=_e(()=>e("div",{class:"border-t border-gray-100 my-1"},null,-1)),It={class:"space-y-2"},Et={key:0,class:"flex items-center gap-2"},Tt=_e(()=>e("div",{class:"w-2 h-2 bg-blue-500 rounded-full"},null,-1)),Lt={class:"text-xs text-gray-600"},At={key:1,class:"flex items-center gap-2"},Ut=_e(()=>e("div",{class:"w-2 h-2 bg-green-500 rounded-full"},null,-1)),Bt={class:"text-xs text-gray-600"},Mt={key:2,class:"flex items-center gap-2"},jt=_e(()=>e("div",{class:"w-2 h-2 bg-orange-500 rounded-full"},null,-1)),Nt={class:"text-xs text-gray-600"},zt={key:3,class:"text-center py-3"},Vt=_e(()=>e("p",{class:"text-xs text-gray-500"},"Carpeta vacÃ­a",-1)),qt={class:"mt-4 pt-3 border-t border-gray-100"},Pt={class:"flex items-center justify-between"},Qt={class:"text-xs text-gray-500"},Rt={__name:"FolderCard",props:{folder:{type:Object,required:!0}},emits:["click","edit","delete","add-documents"],setup(t,{emit:o}){const s=t,m=o,g=se(),a=j(!1),n=j(!1),_=B(()=>g.currentUser),l=B(()=>ue(s.folder.color_id)||{hex:"#6B7280",name:"Gray"}),c=B(()=>s.folder.documents?s.folder.documents.length:0),h=B(()=>{if(!s.folder.documents)return{myDocuments:[],useDocuments:[],signatureDocuments:[]};const i=s.folder.documents;return{myDocuments:i.filter($=>{var p;return $.assigned_to===((p=_.value)==null?void 0:p.id)&&($.state==="Progress"||$.state==="Completed")}),useDocuments:i.filter($=>$.state==="Published"&&!$.assigned_to),signatureDocuments:i.filter($=>$.state==="PendingSignatures"||$.state==="FullySigned")}}),y=i=>{i.target.closest(".folder-menu-container")||n.value||a.value||m("click",s.folder)},U=()=>{a.value=!a.value},S=(i=!1)=>{a.value=!1,i&&(n.value=!0,setTimeout(()=>{n.value=!1},50))},v=()=>{S(!1),m("edit",s.folder)},d=()=>{S(!1),m("delete",s.folder)},b=()=>{S(!1),m("add-documents",s.folder)},L=i=>{if(!i)return"";const $=new Date(i),k=Math.abs(new Date-$),D=Math.floor(k/(1e3*60*60*24));if(D===0)return"hoy";if(D===1)return"ayer";if(D<7)return`hace ${D} dÃ­as`;if(D<30){const A=Math.floor(D/7);return`hace ${A} ${A===1?"semana":"semanas"}`}else if(D<365){const A=Math.floor(D/30);return`hace ${A} ${A===1?"mes":"meses"}`}else return $.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},T=i=>{a.value&&!i.target.closest(".folder-menu-container")&&S(!0)};return Y(()=>{document.addEventListener("click",T)}),he(()=>{document.removeEventListener("click",T)}),(i,$)=>(r(),u("div",{class:"relative bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 p-5 cursor-pointer group",onClick:y},[e("div",xt,[e("div",_t,[e("div",wt,[x(f(de),{class:"w-10 h-10 text-gray-400",style:ae({color:l.value.hex})},null,8,["style"]),e("div",{class:"absolute -top-1 -right-1 w-4 h-4 rounded-full border-2 border-white shadow-sm",style:ae({backgroundColor:l.value.hex})},null,4)]),e("div",$t,[e("h3",kt,I(t.folder.name),1),e("p",Dt,I(c.value)+" "+I(c.value===1?"documento":"documentos"),1)])]),e("div",Ct,[e("button",{onClick:ie(U,["stop"]),class:V(["opacity-100 transition-opacity p-1.5 rounded-full hover:bg-gray-100",{"bg-gray-100":a.value}])},[x(f(st),{class:"w-4 h-4 text-gray-500"})],2),a.value?(r(),u("div",St,[e("button",{onClick:ie(v,["stop"]),class:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[x(f(Fe),{class:"w-4 h-4"}),X(" Editar carpeta ")]),e("button",{onClick:ie(b,["stop"]),class:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[x(f(te),{class:"w-4 h-4"}),X(" Agregar documentos ")]),Ft,e("button",{onClick:ie(d,["stop"]),class:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2"},[x(f(ot),{class:"w-4 h-4"}),X(" Eliminar carpeta ")])])):C("",!0)])]),e("div",It,[h.value.myDocuments.length>0?(r(),u("div",Et,[Tt,e("span",Lt,I(h.value.myDocuments.length)+" mis documentos ",1)])):C("",!0),h.value.useDocuments.length>0?(r(),u("div",At,[Ut,e("span",Bt,I(h.value.useDocuments.length)+" formatos disponibles ",1)])):C("",!0),h.value.signatureDocuments.length>0?(r(),u("div",Mt,[jt,e("span",Nt,I(h.value.signatureDocuments.length)+" documentos con firmas ",1)])):C("",!0),c.value===0?(r(),u("div",zt,[x(f(Ue),{class:"w-8 h-8 text-gray-300 mx-auto mb-1"}),Vt])):C("",!0)]),e("div",qt,[e("div",Pt,[e("span",Qt," Creada "+I(L(t.folder.created_at)),1),x(f(Pe),{class:"w-4 h-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})])]),a.value?(r(),u("div",{key:0,onClick:S,class:"fixed inset-0 z-5"})):C("",!0)]))}},Ot=ve(Rt,[["__scopeId","data-v-a52f6718"]]),Ht=()=>({folders:[],currentFolder:null,isLoading:!1,error:null,lastUpdatedFolderId:null}),Gt={sortedFolders:t=>[...t.folders].sort((o,s)=>new Date(s.created_at)-new Date(o.created_at)),getFolderById:t=>o=>t.folders.find(s=>s.id===o),getFoldersByColor:t=>o=>t.folders.filter(s=>s.color_id===o),getFolderWithColor:t=>o=>{const s=t.folders.find(m=>m.id===o);return s?{...s,color:ue(s.color_id)}:null},getFoldersContainingDocument:t=>o=>t.folders.filter(s=>s.document_ids&&s.document_ids.includes(o)),totalDocumentsInFolders:t=>t.folders.reduce((o,s)=>o+(s.document_ids?s.document_ids.length:0),0),hasFolders:t=>t.folders.length>0,availableColors:()=>xe()},Wt={async init(t=!1){if(!(this.folders.length>0&&!t)){this.isLoading=!0,this.error=null;try{await this.fetchFolders()}catch(o){console.error("Error initializing document folder store:",o),this.error="Error al inicializar las carpetas"}finally{this.isLoading=!1}}},async fetchFolders(){try{const t=await be("dynamic-documents/folders/");if(t.status===200)return this.folders=t.data,t.data;throw new Error(`Error fetching folders: ${t.status}`)}catch(t){throw console.error("Error fetching folders:",t),this.error="Error al obtener las carpetas",t}},async fetchFolder(t){this.isLoading=!0,this.error=null;try{const o=await be(`dynamic-documents/folders/${t}/`);if(o.status===200){const s=o.data,m=this.folders.findIndex(g=>g.id===s.id);return m!==-1?this.folders[m]=s:this.folders.push(s),this.currentFolder=s,s}else throw new Error(`Error fetching folder: ${o.status}`)}catch(o){throw console.error("Error fetching folder:",o),this.error="Error al obtener la carpeta",o}finally{this.isLoading=!1}},async createFolder(t){this.isLoading=!0,this.error=null;try{if(!t.name||t.name.trim()==="")throw new Error("El nombre de la carpeta es requerido");const o=t.color_id??0;if(o<0||o>=xe().length)throw new Error("Color de carpeta no vÃ¡lido");const s={name:t.name.trim(),color_id:o,...t.document_ids&&{document_ids:t.document_ids}},m=await Ge("dynamic-documents/folders/create/",s);if(m.status===200||m.status===201){const g=m.data;return this.folders.push(g),this.lastUpdatedFolderId=g.id,await P("Carpeta creada exitosamente","success"),g}else throw new Error(`Error creating folder: ${m.status}`)}catch(o){throw console.error("Error creating folder:",o),this.error=o.message||"Error al crear la carpeta",await P(this.error,"error"),o}finally{this.isLoading=!1}},async updateFolder(t,o){this.isLoading=!0,this.error=null;try{if(o.name&&o.name.trim()==="")throw new Error("El nombre de la carpeta no puede estar vacÃ­o");if(o.color_id!==void 0){const g=o.color_id;if(g<0||g>=xe().length)throw new Error("Color de carpeta no vÃ¡lido")}const s={};o.name&&(s.name=o.name.trim()),o.color_id!==void 0&&(s.color_id=o.color_id),o.document_ids!==void 0&&(s.document_ids=o.document_ids);const m=await We(`dynamic-documents/folders/${t}/update/`,s);if(m.status===200){const g=m.data,a=this.folders.findIndex(n=>n.id===t);return a!==-1&&(this.folders[a]=g),this.currentFolder&&this.currentFolder.id===t&&(this.currentFolder=g),this.lastUpdatedFolderId=t,await P("Carpeta actualizada exitosamente","success"),g}else throw new Error(`Error updating folder: ${m.status}`)}catch(s){throw console.error("Error updating folder:",s),this.error=s.message||"Error al actualizar la carpeta",await P(this.error,"error"),s}finally{this.isLoading=!1}},async deleteFolder(t){this.isLoading=!0,this.error=null;try{const o=await Je(`dynamic-documents/folders/${t}/delete/`);if(o.status===204||o.status===200)return this.folders=this.folders.filter(s=>s.id!==t),this.currentFolder&&this.currentFolder.id===t&&(this.currentFolder=null),await P("Carpeta eliminada exitosamente","success"),!0;throw new Error(`Error deleting folder: ${o.status}`)}catch(o){throw console.error("Error deleting folder:",o),this.error=o.message||"Error al eliminar la carpeta",await P(this.error,"error"),o}finally{this.isLoading=!1}},setCurrentFolder(t){this.currentFolder=t},clearCurrentFolder(){this.currentFolder=null},reset(){this.folders=[],this.currentFolder=null,this.isLoading=!1,this.error=null,this.lastUpdatedFolderId=null}},Jt={async addDocumentsToFolder(t,o){const s=this.getFolderById(t);if(!s)throw new Error("Carpeta no encontrada");const m=s.document_ids||[],g=[...new Set([...m,...o])];return await this.updateFolder(t,{document_ids:g})},async removeDocumentsFromFolder(t,o){const s=this.getFolderById(t);if(!s)throw new Error("Carpeta no encontrada");const g=(s.document_ids||[]).filter(a=>!o.includes(a));return await this.updateFolder(t,{document_ids:g})},async moveDocumentsBetweenFolders(t,o,s){try{o&&await this.removeDocumentsFromFolder(o,t),s&&await this.addDocumentsToFolder(s,t),await P("Documentos movidos exitosamente","success")}catch(m){throw console.error("Error moving documents between folders:",m),await P("Error al mover documentos","error"),m}},getFolderColor(t){const o=this.getFolderById(t);return o?ue(o.color_id):ue(0)},validateFolderData(t){const o=[];if((!t.name||t.name.trim()==="")&&o.push("El nombre de la carpeta es requerido"),t.name&&t.name.length>100&&o.push("El nombre de la carpeta no puede exceder 100 caracteres"),t.color_id!==void 0){const s=t.color_id;(s<0||s>=xe().length)&&o.push("Color de carpeta no vÃ¡lido")}return t.document_ids&&!Array.isArray(t.document_ids)&&o.push("Los IDs de documentos deben ser un array"),{isValid:o.length===0,errors:o}}},Me=Ke("documentFolder",{state:Ht,getters:Gt,actions:{...Wt,...Jt}}),Kt={key:0,class:"pb-6 border-b border-gray-200"},Zt={class:"hidden sm:flex gap-4 lg:gap-6"},Xt=e("div",{class:"grid min-w-0"},[e("span",{class:"font-medium text-base truncate"},"Minutas y Documentos"),e("span",{class:"text-gray-400 font-regular text-sm truncate"},"Mi unidad")],-1),Yt=e("div",{class:"grid min-w-0"},[e("span",{class:"font-medium text-base truncate"},"Firma ElectrÃ³nica"),e("span",{class:"text-gray-400 font-regular text-sm truncate"},"Documentos")],-1),es=e("div",{class:"grid"},[e("span",{class:"font-medium text-base"},"Nueva Minuta")],-1),ts={class:"sm:hidden space-y-3"},ss=e("div",{class:"grid"},[e("span",{class:"font-semibold text-lg"},"Minutas y Documentos"),e("span",{class:"text-gray-500 font-regular text-sm"},"Mi unidad")],-1),os={class:"grid grid-cols-2 gap-3"},rs=e("span",{class:"font-medium text-sm leading-tight"},"Firma ElectrÃ³nica",-1),ns=e("span",{class:"font-medium text-sm leading-tight"},"Nueva Minuta",-1),as={key:1,class:"pb-6 border-b border-gray-200"},ls={class:"hidden sm:flex gap-4 lg:gap-6"},is=e("div",{class:"grid"},[e("span",{class:"font-medium text-base truncate"},"Mis Documentos")],-1),ds=e("div",{class:"grid"},[e("span",{class:"font-medium text-base truncate"},"Firma ElectrÃ³nica")],-1),cs=e("div",{class:"grid"},[e("span",{class:"font-medium text-base"},"Nuevo Documento")],-1),us={class:"sm:hidden space-y-3"},ms=e("div",{class:"grid"},[e("span",{class:"font-semibold text-lg"},"Mis Documentos")],-1),gs={class:"grid grid-cols-2 gap-3"},hs=e("span",{class:"font-medium text-sm leading-tight"},"Firma ElectrÃ³nica",-1),fs=e("span",{class:"font-medium text-sm leading-tight"},"Nuevo Documento",-1),ps={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-auto"},vs={class:"flex justify-between items-center mb-4"},ys=e("h2",{class:"text-lg font-medium text-primary"},"Firma ElectrÃ³nica",-1),bs={__name:"DocumentsNavigation",props:{role:String},emits:["updateCurrentSection","openNewDocument"],setup(t,{emit:o}){se();const s=Ze();Y(async()=>{});const m=o,g=j("default"),a=j(!1),n=t,_=c=>{g.value=c,m("updateCurrentSection",c)},l=async c=>{try{s.userAuth&&(s.userAuth.has_signature=!0,s.saveToLocalStorageAuth()),P("Firma electrÃ³nica guardada correctamente","success"),a.value=!1}catch(h){console.error("Error updating signature information:",h),P("Hubo un problema al guardar la firma","error")}};return(c,h)=>(r(),u(R,null,[(n==null?void 0:n.role)==="lawyer"?(r(),u("div",Kt,[e("div",Zt,[e("button",{onClick:h[0]||(h[0]=y=>_("default")),class:V(["flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-yellow-300 text-start bg-white transition-all duration-200 hover:shadow-md flex-1 min-w-0",{"bg-yellow-300/30 shadow-md":g.value=="default"}])},[x(f(de),{class:"size-6 text-yellow-500 font-semibold flex-shrink-0"}),Xt],2),e("button",{onClick:h[1]||(h[1]=y=>a.value=!0),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-purple-300 bg-white text-start transition-all duration-200 hover:bg-purple-50 hover:shadow-md flex-1 min-w-0"},[x(f(ke),{class:"size-6 text-purple-500 font-semibold flex-shrink-0"}),Yt]),e("button",{onClick:h[2]||(h[2]=y=>c.$emit("openNewDocument")),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-gray-200 bg-white text-start transition-all duration-200 hover:bg-gray-50 hover:shadow-md hover:border-secondary"},[x(f(te),{class:"size-6 text-secondary font-semibold flex-shrink-0"}),es])]),e("div",ts,[e("button",{onClick:h[3]||(h[3]=y=>_("default")),class:V(["w-full flex gap-3 items-center py-4 px-4 rounded-xl border-2 border-yellow-300 text-start bg-white transition-all duration-200",{"bg-yellow-300/30 shadow-md":g.value=="default"}])},[x(f(de),{class:"size-7 text-yellow-500 font-semibold flex-shrink-0"}),ss],2),e("div",os,[e("button",{onClick:h[4]||(h[4]=y=>a.value=!0),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-purple-300 bg-white text-center transition-all duration-200 hover:bg-purple-50 min-h-[90px]"},[x(f(ke),{class:"size-8 text-purple-500 font-semibold mb-2"}),rs]),e("button",{onClick:h[5]||(h[5]=y=>c.$emit("openNewDocument")),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-gray-200 bg-white text-center transition-all duration-200 hover:bg-gray-50 hover:border-secondary min-h-[90px]"},[x(f(te),{class:"size-8 text-secondary font-semibold mb-2"}),ns])])])])):C("",!0),(n==null?void 0:n.role)==="client"?(r(),u("div",as,[e("div",ls,[e("button",{onClick:h[6]||(h[6]=y=>_("default")),class:V(["flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-yellow-300 bg-white text-start transition-all duration-200 hover:shadow-md flex-1 min-w-0",{"bg-yellow-300/30 shadow-md":g.value=="default"}])},[x(f(de),{class:"size-6 text-yellow-500 font-semibold flex-shrink-0"}),is],2),e("button",{onClick:h[7]||(h[7]=y=>a.value=!0),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-purple-300 bg-white text-start transition-all duration-200 hover:bg-purple-50 hover:shadow-md flex-1 min-w-0"},[x(f(ke),{class:"size-6 text-purple-500 font-semibold flex-shrink-0"}),ds]),e("button",{onClick:h[8]||(h[8]=y=>_("useDocument")),class:V(["flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-gray-200 bg-white text-start transition-all duration-200 hover:bg-gray-50 hover:shadow-md hover:border-secondary",{"bg-selected-background border-secondary":g.value=="useDocument"}])},[x(f(te),{class:"size-6 text-secondary font-semibold flex-shrink-0"}),cs],2)]),e("div",us,[e("button",{onClick:h[9]||(h[9]=y=>_("default")),class:V(["w-full flex gap-3 items-center py-4 px-4 rounded-xl border-2 border-yellow-300 text-start bg-white transition-all duration-200",{"bg-yellow-300/30 shadow-md":g.value=="default"}])},[x(f(de),{class:"size-7 text-yellow-500 font-semibold flex-shrink-0"}),ms],2),e("div",gs,[e("button",{onClick:h[10]||(h[10]=y=>a.value=!0),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-purple-300 bg-white text-center transition-all duration-200 hover:bg-purple-50 min-h-[90px]"},[x(f(ke),{class:"size-8 text-purple-500 font-semibold mb-2"}),hs]),e("button",{onClick:h[11]||(h[11]=y=>_("useDocument")),class:V(["flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-gray-200 bg-white text-center transition-all duration-200 hover:bg-gray-50 hover:border-secondary min-h-[90px]",{"bg-selected-background border-secondary":g.value=="useDocument"}])},[x(f(te),{class:"size-8 text-secondary font-semibold mb-2"}),fs],2)])])])):C("",!0),a.value?(r(),Q(ce,{key:2},{default:K(()=>[e("div",ps,[e("div",vs,[ys,e("button",{onClick:h[12]||(h[12]=y=>a.value=!1),class:"text-gray-400 hover:text-gray-500"},[x(f(oe),{class:"h-6 w-6"})])]),x(qe,{initialShowOptions:!0,"user-id":f(s).userAuth.id,onSignatureSaved:l,onCancel:h[13]||(h[13]=y=>a.value=!1)},null,8,["user-id"])])]),_:1})):C("",!0)],64))}},we=t=>(fe("data-v-d403a707"),t=t(),pe(),t),xs={class:"tag-filter-container"},_s={class:"relative"},ws={class:"flex items-center"},$s={key:0,class:"ml-2 inline-flex items-center justify-center h-5 w-5 bg-primary text-white text-xs rounded-full font-medium"},ks={key:0,class:"absolute left-0 mt-2 w-full sm:w-80 bg-white rounded-xl shadow-xl ring-1 ring-black ring-opacity-5 border border-gray-100 z-50 overflow-hidden"},Ds={class:"bg-gray-50 p-4 border-b border-gray-200"},Cs={class:"flex items-center justify-between mb-3"},Ss=we(()=>e("h3",{class:"text-sm font-semibold text-gray-900"},"Filtrar por etiquetas",-1)),Fs={key:0,class:"text-xs text-gray-500"},Is={class:"relative"},Es={key:0,class:"px-4 py-2 bg-blue-50 border-b border-blue-100"},Ts={class:"flex items-center justify-between"},Ls={class:"text-xs font-medium text-blue-700"},As={class:"max-h-52 overflow-y-auto"},Us={key:0,class:"px-4 py-8 text-center"},Bs=we(()=>e("p",{class:"text-gray-500 text-sm"},"No hay etiquetas disponibles",-1)),Ms={key:1,class:"px-4 py-8 text-center"},js={class:"text-gray-500 text-sm"},Ns={key:2,class:"px-4 py-8 text-center"},zs=we(()=>e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"}),e("span",{class:"ml-3 text-sm text-gray-600"},"Cargando etiquetas...")],-1)),Vs=[zs],qs={key:3,class:"py-2"},Ps=["onClick"],Qs={class:"flex items-center h-5"},Rs={class:"relative"},Os=["id","checked","onChange"],Hs={key:0,class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},Gs=we(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),Ws=[Gs],Js={class:"ml-3 flex items-center flex-1 min-w-0"},Ks={class:"text-sm font-medium text-gray-900 truncate"},Zs={key:0,class:"mt-4"},Xs={class:"flex items-start gap-2"},Ys=we(()=>e("span",{class:"text-xs font-medium text-gray-500 mt-1.5 flex-shrink-0"},"Activos:",-1)),eo={class:"flex flex-wrap gap-2"},to=["onClick"],so={class:"mr-1"},oo={class:"ml-1 p-0.5 rounded-full hover:bg-white/50 transition-colors duration-150"},ro={__name:"TagFilter",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(t,{emit:o}){const s=t,m=o,g=ee(),a=j(!1),n=j([]),_=j(!1),l=j(""),c=B(()=>g.sortedTags),h=B(()=>{if(!l.value.trim())return c.value;const L=l.value.toLowerCase().trim();return c.value.filter(T=>T.name.toLowerCase().includes(L))}),y=L=>{const T=ue(L.color_id);return{hex:T&&T.hex?T.hex:"#9CA3AF",dark:T&&T.dark?T.dark:"#374151"}},U=()=>{a.value=!a.value,a.value&&(l.value="")},S=L=>n.value.some(T=>T.id===L.id),v=L=>{const T=n.value.findIndex(i=>i.id===L.id);T>=0?n.value.splice(T,1):n.value.push(L),m("update:modelValue",n.value)},d=()=>{n.value=[],m("update:modelValue",[])},b=L=>{L.target.closest(".tag-filter-container")||(a.value=!1,l.value="")};return Y(async()=>{try{_.value=!0,await g.initTags()}catch(L){console.error("Error loading tags:",L)}finally{_.value=!1}document.addEventListener("click",b)}),J(()=>s.modelValue,L=>{n.value=L||[]},{immediate:!0}),he(()=>{document.removeEventListener("click",b)}),(L,T)=>(r(),u("div",xs,[e("div",_s,[e("button",{onClick:U,class:V(["group inline-flex items-center justify-between w-full sm:w-auto sm:min-w-[200px] px-4 py-3 border border-gray-200 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-primary transition-all duration-200",{"ring-2 ring-primary border-primary bg-blue-50":a.value,"border-primary bg-primary/5":n.value.length>0&&!a.value}])},[e("div",ws,[x(f(Ne),{class:V(["h-5 w-5 mr-2.5 text-gray-500 group-hover:text-gray-600",{"text-primary":n.value.length>0||a.value}])},null,8,["class"]),e("span",{class:V(["text-gray-700",{"text-primary font-semibold":n.value.length>0||a.value}])}," Filtrar por etiquetas ",2),n.value.length>0?(r(),u("span",$s,I(n.value.length),1)):C("",!0)]),x(f(at),{class:V(["ml-3 h-4 w-4 text-gray-400 transition-all duration-200 group-hover:text-gray-600",{"rotate-180 text-primary":a.value,"text-primary":n.value.length>0&&!a.value}])},null,8,["class"])],2),x(Xe,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:K(()=>[a.value?(r(),u("div",ks,[e("div",Ds,[e("div",Cs,[Ss,c.value.length>0?(r(),u("span",Fs,I(c.value.length)+" disponibles ",1)):C("",!0)]),e("div",Is,[x(f(je),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),ne(e("input",{"onUpdate:modelValue":T[0]||(T[0]=i=>l.value=i),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"},null,512),[[Se,l.value]])])]),n.value.length>0?(r(),u("div",Es,[e("div",Ts,[e("span",Ls,I(n.value.length)+" etiqueta"+I(n.value.length!==1?"s":"")+" seleccionada"+I(n.value.length!==1?"s":""),1),e("button",{onClick:d,class:"text-xs text-red-600 hover:text-red-700 font-medium px-2 py-1 rounded-md hover:bg-red-50 transition-all duration-200"}," Limpiar todo ")])])):C("",!0),e("div",As,[!_.value&&h.value.length===0&&l.value.trim()===""?(r(),u("div",Us,[x(f(Ne),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),Bs])):C("",!0),!_.value&&h.value.length===0&&l.value.trim()!==""?(r(),u("div",Ms,[x(f(je),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e("p",js,'Sin resultados para "'+I(l.value)+'"',1),e("button",{onClick:T[1]||(T[1]=i=>l.value=""),class:"text-xs text-primary hover:text-primary-dark mt-2 font-medium"}," Ver todas las etiquetas ")])):C("",!0),_.value?(r(),u("div",Ns,Vs)):C("",!0),!_.value&&h.value.length>0?(r(),u("div",qs,[(r(!0),u(R,null,O(h.value,i=>(r(),u("div",{key:i.id,class:"group flex items-center px-4 py-2.5 hover:bg-gray-50 cursor-pointer transition-colors duration-150",onClick:$=>v(i)},[e("div",Qs,[e("div",Rs,[e("input",{id:`tag-${i.id}`,type:"checkbox",checked:S(i),onChange:$=>v(i),class:"sr-only"},null,40,Os),e("div",{class:V(["w-4 h-4 border-2 rounded transition-all duration-200 flex items-center justify-center",S(i)?"bg-primary border-primary":"border-gray-300 group-hover:border-gray-400"])},[S(i)?(r(),u("svg",Hs,Ws)):C("",!0)],2)])]),e("div",Js,[e("div",{class:"w-3 h-3 rounded-full mr-2.5 border flex-shrink-0 shadow-sm",style:ae({backgroundColor:y(i).hex})},null,4),e("span",Ks,I(i.name),1)])],8,Ps))),128))])):C("",!0)])])):C("",!0)]),_:1})]),n.value.length>0?(r(),u("div",Zs,[e("div",Xs,[Ys,e("div",eo,[(r(!0),u(R,null,O(n.value,i=>(r(),u("div",{key:i.id,class:"group inline-flex items-center pl-2.5 pr-1.5 py-1.5 rounded-lg text-xs font-medium border shadow-sm cursor-pointer transition-all duration-200 hover:shadow-md",style:ae({backgroundColor:y(i).hex+"20",borderColor:y(i).hex+"40",color:y(i).dark}),onClick:$=>v(i)},[e("div",{class:"w-2 h-2 rounded-full mr-2 flex-shrink-0",style:ae({backgroundColor:y(i).hex})},null,4),e("span",so,I(i.name),1),e("div",oo,[x(f(oe),{class:"h-3 w-3 opacity-60 group-hover:opacity-100"})])],12,to))),128))])])])):C("",!0)]))}},Ee=ve(ro,[["__scopeId","data-v-d403a707"]]),no={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ao={class:"bg-white rounded-xl shadow-xl max-w-md w-full"},lo={class:"flex justify-between items-center p-6 border-b"},io={class:"text-lg font-semibold text-gray-900"},co={class:"mb-4"},uo=e("label",{for:"folderName",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la carpeta ",-1),mo={class:"mb-6"},go=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Color de la carpeta ",-1),ho={class:"grid grid-cols-8 gap-2"},fo=["onClick","title"],po={class:"flex gap-3"},vo=["disabled"],yo={__name:"CreateEditFolderModal",props:{isVisible:{type:Boolean,required:!0},editingFolder:{type:Object,default:null}},emits:["close","success"],setup(t,{emit:o}){const s=t,m=o,g=Me(),a=j(!1),n=j({name:"",color_id:0}),_=B(()=>xe()),l=()=>{n.value={name:"",color_id:0}};J(()=>s.editingFolder,y=>{y?n.value={name:y.name,color_id:y.color_id}:l()},{immediate:!0}),J(()=>s.isVisible,y=>{y||l()});const c=()=>{m("close")},h=async()=>{if(n.value.name.trim()){a.value=!0;try{s.editingFolder?(await g.updateFolder(s.editingFolder.id,n.value),P("Carpeta actualizada correctamente","success")):(await g.createFolder(n.value),P("Carpeta creada correctamente","success")),m("success")}catch(y){const U=s.editingFolder?"actualizar":"crear";P(`Error al ${U} la carpeta`,"error"),console.error(`Error ${U} folder:`,y)}finally{a.value=!1}}};return(y,U)=>t.isVisible?(r(),Q(ce,{key:0},{default:K(()=>[e("div",no,[e("div",ao,[e("div",lo,[e("h3",io,I(t.editingFolder?"Editar Carpeta":"Nueva Carpeta"),1),e("button",{onClick:c,class:"text-gray-400 hover:text-gray-500"},[x(f(oe),{class:"w-6 h-6"})])]),e("form",{onSubmit:ie(h,["prevent"]),class:"p-6"},[e("div",co,[uo,ne(e("input",{id:"folderName","onUpdate:modelValue":U[0]||(U[0]=S=>n.value.name=S),type:"text",required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ej: Contratos Laborales"},null,512),[[Se,n.value.name]])]),e("div",mo,[go,e("div",ho,[(r(!0),u(R,null,O(_.value,S=>(r(),u("button",{key:S.id,type:"button",onClick:v=>n.value.color_id=S.id,class:V(["w-8 h-8 rounded-full border-2 transition-all",n.value.color_id===S.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"]),style:ae({backgroundColor:S.hex}),title:S.name},null,14,fo))),128))])]),e("div",po,[e("button",{type:"button",onClick:c,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:!n.value.name.trim()||a.value,class:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},I(a.value?"Guardando...":t.editingFolder?"Actualizar":"Crear"),9,vo)])],32)])])]),_:1})):C("",!0)}},bo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},xo={class:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden"},_o={class:"border-b"},wo={class:"hidden sm:flex justify-between items-center p-6"},$o={class:"flex items-center gap-3"},ko={class:"text-lg font-semibold text-gray-900"},Do={class:"text-sm text-gray-600"},Co={class:"flex items-center gap-2"},So={class:"sm:hidden"},Fo={class:"flex justify-between items-center p-4 pb-2"},Io={class:"flex items-center gap-3 flex-1 min-w-0"},Eo={class:"min-w-0 flex-1"},To={class:"text-lg font-semibold text-gray-900 truncate"},Lo={class:"text-sm text-gray-600"},Ao={class:"px-4 pb-4"},Uo={class:"p-4 sm:p-6 overflow-y-auto max-h-[70vh]"},Bo={class:"space-y-6"},Mo={key:0},jo=e("h4",{class:"text-base font-semibold text-gray-900 mb-3"},"Mis Documentos",-1),No={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},zo={key:1},Vo=e("h4",{class:"text-base font-semibold text-gray-900 mb-3"},"Formatos Disponibles",-1),qo={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Po={key:2},Qo=e("h4",{class:"text-base font-semibold text-gray-900 mb-3"},"Documentos para Firmar",-1),Ro={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Oo={key:3,class:"text-center py-8 sm:py-12"},Ho={class:"text-gray-400 mb-4"},Go=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"Esta carpeta estÃ¡ vacÃ­a",-1),Wo=e("p",{class:"text-gray-600 mb-4 text-sm sm:text-base"},"Agrega documentos para organizar tu trabajo",-1),Jo={__name:"FolderDetailsModal",props:{folder:{type:Object,default:null}},emits:["close","add-documents","remove-document","view-document","use-document","refresh"],setup(t,{emit:o}){const s=t,m=o,g=se(),a=ee(),n=B(()=>g.currentUser),_=B(()=>{var v;return(v=s.folder)!=null&&v.color_id?ue(s.folder.color_id)||{hex:"#6B7280"}:{hex:"#6B7280"}}),l=B(()=>{if(!s.folder)return{myDocuments:[],useDocuments:[],signatureDocuments:[]};const v=s.folder.documents||[];return{myDocuments:v.filter(d=>{var b;return d.assigned_to===((b=n.value)==null?void 0:b.id)&&(d.state==="Progress"||d.state==="Completed")}),useDocuments:v.filter(d=>d.state==="Published"&&!d.assigned_to),signatureDocuments:v.filter(d=>d.state==="PendingSignatures"||d.state==="FullySigned")}});J(()=>s.folder,(v,d)=>{var b,L;if(v&&d&&v.id===d.id){const T=((b=d.documents)==null?void 0:b.length)||0,i=((L=v.documents)==null?void 0:L.length)||0;i!==T&&console.log(`ğ FolderDetailsModal: Folder "${v.name}" updated! Documents: ${T} â ${i}`)}},{deep:!0});const c=()=>{m("close")},h=()=>{m("add-documents",s.folder)},y=v=>{m("view-document",v)},U=v=>{const d=s.folder.documents.find(b=>b.id===v);d&&m("use-document",d)},S=v=>{m("remove-document",v.id)};return(v,d)=>t.folder?(r(),Q(ce,{key:0},{default:K(()=>[e("div",bo,[e("div",xo,[e("div",_o,[e("div",wo,[e("div",$o,[e("div",{class:"w-8 h-8 rounded-full flex-shrink-0",style:ae({backgroundColor:_.value.hex})},null,4),e("div",null,[e("h3",ko,I(t.folder.name),1),e("p",Do,I(t.folder.documents.length)+" documento"+I(t.folder.documents.length!==1?"s":""),1)])]),e("div",Co,[e("button",{onClick:h,class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"},[x(f(te),{class:"w-4 h-4"}),X(" Agregar documentos ")]),e("button",{onClick:c,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[x(f(oe),{class:"w-5 h-5"})])])]),e("div",So,[e("div",Fo,[e("div",Io,[e("div",{class:"w-7 h-7 rounded-full flex-shrink-0",style:ae({backgroundColor:_.value.hex})},null,4),e("div",Eo,[e("h3",To,I(t.folder.name),1),e("p",Lo,I(t.folder.documents.length)+" documento"+I(t.folder.documents.length!==1?"s":""),1)])]),e("button",{onClick:c,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors flex-shrink-0 ml-2"},[x(f(oe),{class:"w-5 h-5"})])]),e("div",Ao,[e("button",{onClick:h,class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors"},[x(f(te),{class:"w-4 h-4"}),X(" Agregar documentos ")])])])]),e("div",Uo,[e("div",Bo,[l.value.myDocuments.length>0?(r(),u("div",Mo,[jo,e("div",No,[(r(!0),u(R,null,O(l.value.myDocuments,b=>(r(),Q(f(me),{key:b.id,document:b,"card-type":"client","card-context":"folder","highlighted-doc-id":null,"show-tags":!0,"show-client-name":!1,"additional-classes":"relative","document-store":f(a),"user-store":f(g),onClick:y,onRefresh:d[0]||(d[0]=L=>v.$emit("refresh")),onRemoveFromFolder:S},null,8,["document","document-store","user-store"]))),128))])])):C("",!0),l.value.useDocuments.length>0?(r(),u("div",zo,[Vo,e("div",qo,[(r(!0),u(R,null,O(l.value.useDocuments,b=>(r(),Q(f(Be),{key:b.id,document:b,"card-context":"folder","show-menu-options":!0,"document-store":f(a),"user-store":f(g),onClick:U,onRemoveFromFolder:S},null,8,["document","document-store","user-store"]))),128))])])):C("",!0),l.value.signatureDocuments.length>0?(r(),u("div",Po,[Qo,e("div",Ro,[(r(!0),u(R,null,O(l.value.signatureDocuments,b=>(r(),Q(f(Ie),{key:b.id,document:b,"card-context":"folder","highlighted-doc-id":null,"document-store":f(a),"user-store":f(g),onRefresh:d[1]||(d[1]=L=>v.$emit("refresh")),onRemoveFromFolder:S},null,8,["document","document-store","user-store"]))),128))])])):C("",!0),t.folder.documents.length===0?(r(),u("div",Oo,[e("div",Ho,[x(f(Ue),{class:"w-10 h-10 sm:w-12 sm:h-12 mx-auto"})]),Go,Wo,e("button",{onClick:h,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm sm:text-base"},[x(f(te),{class:"w-4 h-4"}),X(" Agregar documentos ")])])):C("",!0)])])])])]),_:1})):C("",!0)}},Ko={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Zo={class:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden"},Xo={class:"border-b"},Yo={class:"hidden sm:flex justify-between items-center p-6"},er=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),tr={class:"text-sm text-gray-600"},sr={class:"sm:hidden p-4"},or={class:"flex justify-between items-start mb-2"},rr={class:"flex-1 min-w-0 mr-3"},nr=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),ar={class:"text-sm text-gray-600 truncate"},lr={class:"border-b"},ir={class:"hidden sm:flex space-x-8 px-6","aria-label":"Tabs"},dr=["onClick"],cr={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},ur={class:"sm:hidden relative px-4 py-3"},mr={class:"flex items-center"},gr={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},hr=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),fr=[hr],pr={class:"absolute top-full left-4 right-4 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},vr=["onClick"],yr={class:"border-b bg-gray-50 p-4 sm:p-6"},br={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},xr={class:"flex-1"},_r={key:0,class:"flex items-center gap-3"},wr={class:"text-sm text-gray-600"},$r={class:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-350px)]"},kr={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Dr={key:4,class:"absolute top-2 left-2 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center shadow-sm"},Cr={key:0,class:"text-center py-8 sm:py-12"},Sr={class:"text-lg font-medium text-gray-900 mb-2"},Fr={class:"text-gray-600 text-sm sm:text-base"},Ir={class:"border-t bg-gray-50"},Er={class:"hidden sm:flex justify-between items-center p-6"},Tr={class:"text-sm text-gray-600"},Lr={class:"flex gap-3"},Ar=["disabled"],Ur={class:"sm:hidden p-4 space-y-3"},Br={class:"text-center text-sm text-gray-600"},Mr={class:"flex gap-3"},jr=["disabled"],Nr={__name:"AddDocumentsModal",props:{isVisible:{type:Boolean,required:!0},folder:{type:Object,default:null}},emits:["close","add-documents"],setup(t,{emit:o}){const s=t,m=o,g=ee(),a=se(),n=j([]),_=j([]),l=j("my-documents"),c=j(!1),h=j(!1),y=[{name:"my-documents",label:"Mis Documentos"},{name:"use-documents",label:"Formatos Disponibles"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Documentos Firmados"}],U=B(()=>a.currentUser);J(()=>s.isVisible,k=>{k&&(n.value=[],_.value=[],l.value="my-documents")}),J(l,()=>{n.value=[]}),J(_,()=>{n.value=[]},{deep:!0});const S=B(()=>{const k=d(l.value);return k.length===0?!1:k.every(D=>n.value.includes(D.id))}),v=k=>{var F;if(!s.folder)return[];const D=s.folder.documents.map(q=>q.id);let A=[];switch(k){case"my-documents":A=g.progressAndCompletedDocumentsByClient((F=U.value)==null?void 0:F.id);break;case"use-documents":A=g.publishedDocumentsUnassigned;break;case"pending-signatures":A=g.documents.filter(q=>{var Z,N;return q.state==="PendingSignatures"&&(q.assigned_to===((Z=U.value)==null?void 0:Z.id)||((N=q.signatures)==null?void 0:N.some(w=>{var M;return w.signer_email===((M=U.value)==null?void 0:M.email)})))});break;case"signed-documents":A=g.documents.filter(q=>{var Z,N;return q.state==="FullySigned"&&(q.assigned_to===((Z=U.value)==null?void 0:Z.id)||((N=q.signatures)==null?void 0:N.some(w=>{var M;return w.signer_email===((M=U.value)==null?void 0:M.email)})))});break;default:A=[]}return A.filter(q=>!D.includes(q.id))},d=k=>{const D=v(k);if(!_.value||_.value.length===0)return D;const A=_.value.map(F=>F.id);return D.filter(F=>!F.tags||F.tags.length===0?!1:F.tags.some(q=>A.includes(q.id)))},b=k=>{const D=n.value.indexOf(k);D>-1?n.value.splice(D,1):n.value.push(k)},L=()=>{const D=d(l.value).map(A=>A.id);if(S.value)n.value=n.value.filter(A=>!D.includes(A));else{const A=D.filter(F=>!n.value.includes(F));n.value.push(...A)}},T=()=>{m("close")},i=async()=>{if(n.value.length!==0){c.value=!0;try{await m("add-documents",n.value)}finally{c.value=!1}}},$=k=>{l.value=k,h.value=!1},p=k=>{k.target.closest(".relative")||(h.value=!1)};return Y(()=>{document.addEventListener("click",p)}),he(()=>{document.removeEventListener("click",p)}),(k,D)=>t.isVisible&&t.folder?(r(),Q(ce,{key:0},{default:K(()=>{var A;return[e("div",Ko,[e("div",Zo,[e("div",Xo,[e("div",Yo,[e("div",null,[er,e("p",tr,'Selecciona documentos para agregar a "'+I(t.folder.name)+'"',1)]),e("button",{onClick:T,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors"},[x(f(oe),{class:"w-5 h-5"})])]),e("div",sr,[e("div",or,[e("div",rr,[nr,e("p",ar,'Para "'+I(t.folder.name)+'"',1)]),e("button",{onClick:T,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors flex-shrink-0"},[x(f(oe),{class:"w-5 h-5"})])])])]),e("div",lr,[e("nav",ir,[(r(),u(R,null,O(y,F=>e("button",{key:F.name,onClick:q=>l.value=F.name,class:V([l.value===F.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[X(I(F.label)+" ",1),e("span",cr,I(d(F.name).length),1)],10,dr)),64))]),e("div",ur,[e("button",{onClick:D[0]||(D[0]=F=>h.value=!h.value),class:"w-full flex items-center justify-between py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("div",mr,[e("span",null,I(((A=y.find(F=>F.name===l.value))==null?void 0:A.label)||"Seleccionar categorÃ­a"),1),e("span",gr,I(d(l.value).length),1)]),(r(),u("svg",{class:V(["ml-2 h-5 w-5 transition-transform duration-200",h.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},fr,2))]),ne(e("div",pr,[(r(),u(R,null,O(y,F=>e("button",{key:F.name,onClick:q=>$(F.name),class:V(["w-full text-left px-4 py-3 text-sm transition-colors duration-150 flex items-center justify-between",l.value===F.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},[e("span",null,I(F.label),1),e("span",{class:V(["py-0.5 px-2 rounded-full text-xs",l.value===F.name?"bg-white/20 text-white":"bg-gray-100 text-gray-600"])},I(d(F.name).length),3)],10,vr)),64))],512),[[ye,h.value]])])]),e("div",yr,[e("div",br,[e("div",xr,[x(Ee,{modelValue:_.value,"onUpdate:modelValue":D[1]||(D[1]=F=>_.value=F),class:"max-w-md"},null,8,["modelValue"])]),d(l.value).length>0?(r(),u("div",_r,[e("span",wr,I(d(l.value).length)+" documento(s) disponible(s) ",1),e("button",{onClick:L,class:V(["px-4 py-2 rounded-lg border font-medium text-sm transition-colors",S.value?"bg-red-50 border-red-200 text-red-700 hover:bg-red-100":"bg-primary text-white border-primary hover:bg-primary-dark"])},I(S.value?"Deseleccionar todos":"Seleccionar todos"),3)])):C("",!0)])]),e("div",$r,[e("div",kr,[(r(!0),u(R,null,O(d(l.value),F=>(r(),u("div",{key:F.id,class:"relative"},[l.value==="my-documents"?(r(),Q(f(me),{key:0,document:F,"highlighted-doc-id":null,"show-tags":!0,"show-client-name":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":n.value.includes(F.id)?"ring-2 ring-primary bg-primary-50":"",onClick:q=>b(F.id)},null,8,["document","additional-classes","onClick"])):C("",!0),l.value==="use-documents"?(r(),Q(f(Be),{key:1,document:F,"show-tags":!0,"menu-options":[],"show-menu-options":!1,"disable-internal-actions":!0,"additional-classes":n.value.includes(F.id)?"ring-2 ring-primary bg-primary-50":"",onClick:q=>b(F.id)},null,8,["document","additional-classes","onClick"])):C("",!0),l.value==="pending-signatures"?(r(),Q(f(Ie),{key:2,document:F,"highlighted-doc-id":null,"show-tags":!0,"menu-options":[],"disable-internal-actions":!0,"additional-classes":n.value.includes(F.id)?"ring-2 ring-primary bg-primary-50":"",onClick:q=>b(F.id)},null,8,["document","additional-classes","onClick"])):C("",!0),l.value==="signed-documents"?(r(),Q(f(Ie),{key:3,document:F,"highlighted-doc-id":null,"show-tags":!0,"menu-options":[],"disable-internal-actions":!0,"additional-classes":n.value.includes(F.id)?"ring-2 ring-primary bg-primary-50":"",onClick:q=>b(F.id)},null,8,["document","additional-classes","onClick"])):C("",!0),n.value.includes(F.id)?(r(),u("div",Dr,[x(f(nt),{class:"w-4 h-4"})])):C("",!0)]))),128))]),d(l.value).length===0?(r(),u("div",Cr,[x(f(Ue),{class:"w-12 h-12 sm:w-16 sm:h-16 text-gray-300 mx-auto mb-4"}),e("h4",Sr,I(_.value.length>0?"No hay documentos que coincidan con el filtro":"No hay documentos disponibles"),1),e("p",Fr,I(_.value.length>0?"Intenta ajustar los filtros de etiquetas o selecciona otra categorÃ­a":"No tienes documentos de esta categorÃ­a que no estÃ©n ya en la carpeta"),1)])):C("",!0)]),e("div",Ir,[e("div",Er,[e("div",Tr,I(n.value.length)+" documento(s) seleccionado(s) ",1),e("div",Lr,[e("button",{onClick:T,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{onClick:i,disabled:n.value.length===0||c.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},I(c.value?"Agregando...":`Agregar ${n.value.length} documento(s)`),9,Ar)])]),e("div",Ur,[e("div",Br,I(n.value.length)+" documento(s) seleccionado(s) ",1),e("div",Mr,[e("button",{onClick:T,class:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center font-medium"}," Cancelar "),e("button",{onClick:i,disabled:n.value.length===0||c.value,class:"flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-center font-medium"},I(c.value?"Agregando...":"Agregar"),9,jr)])])])])])]}),_:1})):C("",!0)}},$e=t=>(fe("data-v-71ba7453"),t=t(),pe(),t),zr={class:"folders-grid"},Vr={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},qr={key:1,class:"text-center py-12"},Pr=$e(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No tienes carpetas aÃºn",-1)),Qr=$e(()=>e("p",{class:"text-gray-600 mb-6"},"Crea tu primera carpeta para organizar tus documentos",-1)),Rr={key:2,class:"text-center py-12"},Or=$e(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No se encontraron carpetas",-1)),Hr=$e(()=>e("p",{class:"text-gray-600"},"No hay carpetas que coincidan con tu bÃºsqueda",-1)),Gr={key:3,class:"flex justify-center items-center py-12"},Wr=$e(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)),Jr=[Wr],Kr={__name:"FoldersGrid",props:{sortedFolders:{type:Array,required:!0},searchQuery:{type:String,default:""},isLoading:{type:Boolean,default:!1}},emits:["folder-click","edit-folder","delete-folder","add-documents","create-folder"],setup(t,{emit:o}){const s=t,m=o,g=B(()=>{if(!s.searchQuery.trim())return s.sortedFolders;const h=s.searchQuery.toLowerCase();return s.sortedFolders.filter(y=>y.name.toLowerCase().includes(h))}),a=h=>{m("folder-click",h)},n=h=>{m("edit-folder",h)},_=h=>{m("delete-folder",h)},l=h=>{m("add-documents",h)},c=()=>{m("create-folder")};return(h,y)=>(r(),u("div",zr,[!t.isLoading&&g.value.length>0?(r(),u("div",Vr,[(r(!0),u(R,null,O(g.value,U=>(r(),Q(f(Ot),{key:U.id,folder:U,onClick:a,onEdit:n,onDelete:_,onAddDocuments:l},null,8,["folder"]))),128))])):!t.isLoading&&t.sortedFolders.length===0?(r(),u("div",qr,[x(f(de),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Pr,Qr,e("button",{onClick:c,class:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"},[x(f(te),{class:"w-5 h-5"}),X(" Crear Primera Carpeta ")])])):!t.isLoading&&t.sortedFolders.length>0&&g.value.length===0?(r(),u("div",Rr,[x(f(de),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Or,Hr])):C("",!0),t.isLoading?(r(),u("div",Gr,Jr)):C("",!0)]))}},Zr=ve(Kr,[["__scopeId","data-v-71ba7453"]]),Qe=t=>(fe("data-v-1ea3aed8"),t=t(),pe(),t),Xr={class:"folder-management"},Yr={class:"mb-6"},en={class:"hidden sm:flex justify-between items-center"},tn=Qe(()=>e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),sn={class:"sm:hidden"},on=Qe(()=>e("div",{class:"text-center mb-4"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1 px-2"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),rn={__name:"FolderManagement",props:{searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","navigate-to-main"],setup(t,{emit:o}){const s=t,m=o,g=Me(),a=ee(),n=se(),_=j(!1),l=j(null),c=j(null),h=j(!1),y=j(null),U=B(()=>g.isLoading),S=B(()=>g.sortedFolders);B(()=>n.currentUser),Y(async()=>{await g.init(),await a.init()}),J(()=>s.searchQuery,()=>{}),J(()=>g.folders,w=>{var M,H;if(c.value&&w&&w.length>0){const E=w.find(z=>z.id===c.value.id);if(E){const z=((M=c.value.documents)==null?void 0:M.length)||0,le=((H=E.documents)==null?void 0:H.length)||0;JSON.stringify(c.value)!==JSON.stringify(E)&&(c.value={...E},console.log(`ğ FolderManagement: Synced selectedFolder "${E.name}" with store. Documents: ${z} â ${le}`))}}},{deep:!0});const v=()=>{l.value=null,_.value=!0},d=w=>{l.value=w,_.value=!0},b=()=>{_.value=!1,l.value=null},L=()=>{b()},T=w=>{c.value=w},i=()=>{c.value=null},$=async w=>{if(confirm(`Â¿EstÃ¡s seguro de que quieres eliminar la carpeta "${w.name}"?`))try{await g.deleteFolder(w.id),P(`Carpeta "${w.name}" eliminada correctamente`,"success")}catch(M){P("Error al eliminar la carpeta","error"),console.error("Error deleting folder:",M)}},p=w=>{y.value=w,h.value=!0},k=async(w=!1)=>{if(h.value=!1,y.value=null,w&&c.value)try{await D()}catch(M){console.warn("Error refreshing folder after adding documents:",M)}},D=async()=>{if(c.value)try{await g.fetchFolderById(c.value.id,!0);const w=g.getFolderById(c.value.id);w&&(c.value={...w},console.log("â Selected folder refreshed successfully"))}catch(w){throw console.error("â Error refreshing selected folder:",w),w}},A=async w=>{var M,H,E;if(!(!y.value||w.length===0))try{const z=y.value.documents.map(G=>G.id).filter(G=>G!=null&&!isNaN(parseInt(G))).map(G=>parseInt(G)),le=w.filter(G=>G!=null&&!isNaN(parseInt(G))).map(G=>parseInt(G)),W=[...new Set([...z,...le])];if(console.log("Current document IDs:",z),console.log("Selected document IDs:",le),console.log("Updated document IDs:",W),W.some(G=>!Number.isInteger(G)||G<=0))throw new Error("IDs de documentos invÃ¡lidos detectados");await g.updateFolder(y.value.id,{document_ids:W}),await k(!0),P(`${le.length} documento(s) agregado(s) a la carpeta`,"success"),m("navigate-to-main")}catch(z){console.error("Error adding documents to folder:",z),console.error("Error details:",((M=z.response)==null?void 0:M.data)||z.message),(H=z.response)!=null&&H.status?P(`Error al agregar documentos: ${((E=z.response.data)==null?void 0:E.detail)||z.message}`,"error"):P("Error al agregar documentos a la carpeta","error")}},F=async w=>{var M,H,E;if(c.value)try{const z=parseInt(w);if(!Number.isInteger(z)||z<=0)throw new Error("ID de documento invÃ¡lido");const le=c.value.documents.map(W=>W.id).filter(W=>W!=null&&!isNaN(parseInt(W))).map(W=>parseInt(W)).filter(W=>W!==z);console.log("Removing document ID:",z),console.log("Updated document IDs after removal:",le),await g.updateFolder(c.value.id,{document_ids:le}),P("Documento removido de la carpeta","success"),c.value=null,m("navigate-to-main");try{await g.fetchFolderById(c.value.id,!0);const W=g.getFolderById(c.value.id);W&&(c.value=W),console.log("Folder data refreshed successfully after removal")}catch(W){console.warn("Error refreshing folder data:",W);try{c.value={...c.value,documents:c.value.documents.filter(G=>G.id!==z)},console.log("Applied optimistic removal for document ID:",z)}catch(G){console.warn("Optimistic update failed:",G)}}}catch(z){console.error("Error removing document from folder:",z),console.error("Error details:",((M=z.response)==null?void 0:M.data)||z.message),(H=z.response)!=null&&H.status?P(`Error al remover documento: ${((E=z.response.data)==null?void 0:E.detail)||z.message}`,"error"):P("Error al remover el documento de la carpeta","error")}},q=w=>{console.log("View document:",w)},Z=w=>{console.log("Use document:",w)},N=(w,M)=>{console.log("Document action:",w,M)};return(w,M)=>(r(),u("div",Xr,[e("div",Yr,[e("div",en,[tn,e("button",{onClick:v,class:"inline-flex items-center gap-2 px-4 py-2.5 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md"},[x(f(te),{class:"w-5 h-5"}),X(" Nueva Carpeta ")])]),e("div",sn,[on,e("button",{onClick:v,class:"w-full flex items-center justify-center gap-3 px-4 py-4 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium text-base"},[x(f(te),{class:"w-6 h-6"}),X(" Nueva Carpeta ")])])]),x(f(Zr),{"sorted-folders":S.value,"search-query":t.searchQuery,"is-loading":U.value,onFolderClick:T,onEditFolder:d,onDeleteFolder:$,onAddDocuments:p,onCreateFolder:v},null,8,["sorted-folders","search-query","is-loading"]),x(f(yo),{"is-visible":_.value,"editing-folder":l.value,onClose:b,onSuccess:L},null,8,["is-visible","editing-folder"]),x(f(Jo),{folder:c.value,onClose:i,onAddDocuments:p,onRemoveDocument:F,onViewDocument:q,onUseDocument:Z,onDocumentAction:N},null,8,["folder"]),x(f(Nr),{"is-visible":h.value,folder:y.value,onClose:k,onAddDocuments:A},null,8,["is-visible","folder"])]))}},nn=ve(rn,[["__scopeId","data-v-1ea3aed8"]]),Re=t=>(fe("data-v-0f6fd44f"),t=t(),pe(),t),an={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},ln={key:1,class:"mt-6 flex flex-col items-center justify-center text-center text-gray-500 w-full p-8 rounded-xl"},dn=Re(()=>e("p",{class:"text-lg font-semibold mb-2"}," No hay documentos disponibles para mostrar. ",-1)),cn=Re(()=>e("p",{class:"text-sm"}," Contacta a tu abogado para gestionar tus documentos. ",-1)),un=[dn,cn],mn={__name:"DocumentListClient",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null}},setup(t){const o=ee(),s=se(),{registerView:m}=rt(),g=B(()=>s.getCurrentUser),a=j([]),n=j(!1);s.userSignature;const _=B(()=>{if(l.promptDocuments)return null;const v=o.lastUpdatedDocumentId,d=localStorage.getItem("lastUpdatedDocumentId");return v&&c.value.some(L=>String(L.id)===String(v))?v:d&&c.value.some(T=>String(T.id)===String(d))?d:null}),l=t;Y(async()=>{if(await s.init(),await o.init(),l.promptDocuments)return;await o.init(),await h();const v=localStorage.getItem("lastUpdatedDocumentId");v&&!o.lastUpdatedDocumentId&&(o.lastUpdatedDocumentId=v),o.lastUpdatedDocumentId&&c.value.some(d=>String(d.id)===String(o.lastUpdatedDocumentId))}),J(()=>o.lastUpdatedDocumentId,v=>{l.promptDocuments||v&&localStorage.setItem("lastUpdatedDocumentId",v)});const c=B(()=>{var T,i;if(l.promptDocuments){const $=(T=g.value)==null?void 0:T.id;let p=l.promptDocuments.filter(k=>{const D=k.assigned_to?String(k.assigned_to):null,A=String($);return D===A&&(k.state==="Progress"||k.state==="Completed")});if(l.searchQuery){const k=l.searchQuery.toLowerCase();p=p.filter(D=>{var A,F,q,Z,N,w,M,H;return D.title.toLowerCase().includes(k)||D.state.toLowerCase().includes(k)||D.assigned_to&&s&&(((F=(A=s.userById(D.assigned_to))==null?void 0:A.first_name)==null?void 0:F.toLowerCase().includes(k))||((Z=(q=s.userById(D.assigned_to))==null?void 0:q.last_name)==null?void 0:Z.toLowerCase().includes(k))||((w=(N=s.userById(D.assigned_to))==null?void 0:N.email)==null?void 0:w.toLowerCase().includes(k))||((H=(M=s.userById(D.assigned_to))==null?void 0:M.identification)==null?void 0:H.toLowerCase().includes(k)))})}if(l.selectedTags&&l.selectedTags.length>0){const k=l.selectedTags.map(D=>D.id);p=p.filter(D=>!D.tags||D.tags.length===0?!1:D.tags.some(A=>k.includes(A.id)))}return p}const v=o.progressAndCompletedDocumentsByClient((i=g.value)==null?void 0:i.id),d=l.selectedTags?l.selectedTags.map($=>$.id):[];return o.filteredDocumentsBySearchAndTags(l.searchQuery,s,d).filter($=>v.some(p=>String(p.id)===String($.id)))}),h=async()=>{n.value=!0;try{const v=s.currentUser.id;if(!v)return;const d=await be(`dynamic-documents/user/${v}/pending-documents-full/`);a.value=d.data}catch(v){console.error("Error fetching documents:",v),v.response&&console.error("Error details:",v.response.data),await P("Error al cargar documentos","error"),a.value=[]}finally{n.value=!1}},y=async v=>{await m("document",v.id),Ye(v)};J(c,v=>{if(!l.promptDocuments&&o.lastUpdatedDocumentId&&!v.some(b=>String(b.id)===String(o.lastUpdatedDocumentId))&&v.length>0){const L=[...v].sort((T,i)=>i.id-T.id)[0].id;o.lastUpdatedDocumentId=L,localStorage.setItem("lastUpdatedDocumentId",L)}});const U=v=>{v&&(o.lastUpdatedDocumentId=v,localStorage.setItem("lastUpdatedDocumentId",v),setTimeout(()=>{try{const d=document.querySelectorAll(`[data-document-id="${v}"]`);if(d.length>0){const b=d[0];b.style.border="3px solid #3b82f6",b.classList.remove("animate-pulse-highlight"),b.classList.remove("border-secondary"),b.classList.remove("shadow-md"),b.offsetWidth,b.classList.add("animate-pulse-highlight"),b.classList.add("border-secondary"),b.classList.add("shadow-md"),b.scrollIntoView({behavior:"smooth",block:"center"})}}catch(d){console.error("Error forcing highlight:",d)}},100))};window.forceDocumentHighlight=U;const S=async()=>{await o.init(!0)};return(v,d)=>(r(),u(R,null,[c.value.length>0?(r(),u("div",an,[(r(!0),u(R,null,O(c.value,b=>(r(),Q(f(me),{key:b.id,document:b,"card-type":"client","card-context":"list","highlighted-doc-id":_.value,"status-icon":b.state==="Completed"?f(Le):f(Fe),"status-text":b.state==="Completed"?"Completado":"En Progreso","status-badge-classes":b.state==="Completed"?"bg-green-100 text-green-700 border border-green-200":"bg-blue-100 text-blue-700 border border-blue-200","document-store":f(o),"user-store":f(s),"prompt-documents":l.promptDocuments,"edit-modal-component":"UseDocumentByClient",onClick:y,onRefresh:S},null,8,["document","highlighted-doc-id","status-icon","status-text","status-badge-classes","document-store","user-store","prompt-documents"]))),128))])):C("",!0),c.value.length===0?(r(),u("div",ln,un)):C("",!0),x(Ae,{isVisible:f(ge),documentData:f(Te),onClose:d[0]||(d[0]=b=>ge.value=!1)},null,8,["isVisible","documentData"])],64))}},gn=ve(mn,[["__scopeId","data-v-0f6fd44f"]]),hn={class:"mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},fn={__name:"UseDocument",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},setup(t){const o=ee(),s=se(),m=t,g=B(()=>{const n=o.publishedDocumentsUnassigned,_=m.selectedTags?m.selectedTags.map(c=>c.id):[];return o.filteredDocumentsBySearchAndTags(m.searchQuery,s,_).filter(c=>n.some(h=>h.id===c.id))});s.userSignature;function a(n){n&&n.updatedDocId&&(o.lastUpdatedDocumentId=n.updatedDocId,localStorage.setItem("lastUpdatedDocumentId",n.updatedDocId))}return(n,_)=>(r(),u("div",hn,[(r(!0),u(R,null,O(g.value,l=>(r(),Q(f(Be),{key:l.id,document:l,"show-menu-options":!1,onDocumentCreated:a},null,8,["document"]))),128))]))}},re=t=>(fe("data-v-71135d5a"),t=t(),pe(),t),pn={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},vn={key:0,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},yn=re(()=>e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1)),bn=re(()=>e("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)),xn=[yn,bn],_n={key:1,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},wn=re(()=>e("path",{d:"M20 6L9 17l-5-5"},null,-1)),$n=[wn],kn={key:2,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Dn=re(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),Cn=[Dn],Sn={key:3,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Fn=re(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),In=[Fn],En={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},Tn={key:0,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ln=re(()=>e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1)),An=re(()=>e("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)),Un=[Ln,An],Bn={key:1,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Mn=re(()=>e("path",{d:"M20 6L9 17l-5-5"},null,-1)),jn=[Mn],Nn={key:2,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},zn=re(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),Vn=[zn],qn={key:3,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Pn=re(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),Qn=[Pn],Rn={__name:"DocumentListLawyer",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null}},setup(t){const o=ee(),s=se();Ce();const m=j([]),g=j([]),a=t,n=i=>i.state==="Published"||i.state==="FullySigned"?Le:Fe,_=i=>{switch(i.state){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return"Desconocido"}},l=i=>{switch(i.state){case"Published":case"FullySigned":return"bg-green-100 text-green-700 border border-green-200";case"Draft":case"Progress":return"bg-blue-100 text-blue-700 border border-blue-200";case"PendingSignatures":return"bg-yellow-100 text-yellow-700 border border-yellow-200";case"Completed":return"bg-purple-100 text-purple-700 border border-purple-200";default:return"bg-gray-100 text-gray-700 border border-gray-200"}},c=i=>{var $,p;return i.fully_signed?"bg-green-100 text-green-700 border border-green-200":($=d(i))!=null&&$.signed&&!i.fully_signed?"bg-blue-100 text-blue-700 border border-blue-200":d(i)&&!((p=d(i))!=null&&p.signed)?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200"},h=B(()=>{if(a.promptDocuments)return[];const $=(o.getDocumentsByLawyerId(s.currentUser.id)||[]).filter(D=>D.state!=="FullySigned"),p=a.selectedTags?a.selectedTags.map(D=>D.id):[];return o.filteredDocumentsBySearchAndTags(a.searchQuery,s,p).filter(D=>$.some(A=>A.id===D.id))}),y=B(()=>{if(a.promptDocuments&&a.promptDocuments.length>0){let i=a.promptDocuments.filter($=>$.title&&$.title.toLowerCase().includes((a.searchQuery||"").toLowerCase()));if(a.selectedTags&&a.selectedTags.length>0){const $=a.selectedTags.map(p=>p.id);i=i.filter(p=>!p.tags||p.tags.length===0?!1:p.tags.some(k=>$.includes(k.id)))}return i}return[]}),U=B(()=>a.promptDocuments?y.value:h.value),S=B(()=>{if(a.promptDocuments)return null;const i=o.lastUpdatedDocumentId,$=localStorage.getItem("lastUpdatedDocumentId"),p=[...h.value];return i&&p.some(A=>String(A.id)===String(i))?i:$&&p.some(A=>String(A.id)===String($))?$:null}),v=async()=>{try{const i=s.currentUser.id,$=await be(`dynamic-documents/user/${i}/pending-documents-full/`),p=await be(`dynamic-documents/user/${i}/signed-documents/`);$.status===200&&(m.value=$.data),p.status===200&&(g.value=p.data)}catch(i){console.error("Error fetching lawyer documents:",i),i.response&&(console.error("Error response data:",i.response.data),console.error("Error status:",i.response.status))}},d=i=>{if(!i.signatures||!i.requires_signature)return null;const $=String(s.currentUser.id);return i.signatures.find(p=>String(p.signer_id)===$)},b=i=>{if(!i.requires_signature)return"";if(i.fully_signed)return"Documento formalizado";const $=d(i);if(i.signatures&&i.signatures.length>0){const p=i.signatures.length,k=i.signatures.filter(D=>D.signed).length;if($&&$.signed){if(k===1&&p>1)return`Has firmado. Faltan ${p-k} firmas mÃ¡s`;if(k<p)return`Has firmado. Faltan ${p-k} firmas mÃ¡s`}return`Firmas: ${k}/${p}`}return $?"Requiere tu firma":"Requiere firmas"};J(U,i=>{if(!a.promptDocuments&&o.lastUpdatedDocumentId&&!i.some(p=>String(p.id)===String(o.lastUpdatedDocumentId))&&i.length>0){const k=[...i].sort((D,A)=>A.id-D.id)[0].id;o.lastUpdatedDocumentId=k,localStorage.setItem("lastUpdatedDocumentId",k)}});const L=i=>{i&&setTimeout(()=>{try{const $=document.querySelectorAll(`[data-document-id="${i}"]`);if($.length>0){const p=$[0];p.classList.remove("animate-pulse-highlight-green","animate-pulse-highlight-blue"),p.offsetWidth,(p.querySelector("[data-document-id]")||p).classList.contains("border-green-400")?p.classList.add("animate-pulse-highlight-green"):p.classList.add("animate-pulse-highlight-blue"),p.scrollIntoView({behavior:"smooth",block:"center"})}}catch($){console.error("Error forcing highlight:",$)}},100)};window.forceDocumentHighlight=L,Y(async()=>{if(a.promptDocuments)return;await o.init();const i=localStorage.getItem("lastUpdatedDocumentId");i&&(o.lastUpdatedDocumentId=i,setTimeout(()=>{U.value.some(p=>String(p.id)===String(i))&&L(i)},500)),v()});const T=async()=>{await o.init()};return(i,$)=>(r(),u(R,null,[a.promptDocuments&&y.value.length>0?(r(),u("div",pn,[(r(!0),u(R,null,O(y.value,p=>(r(),Q(f(me),{key:p.id,document:p,"card-type":"lawyer","card-context":"prompt","highlighted-doc-id":S.value,"status-icon":n(p),"status-text":_(p),"status-badge-classes":l(p),"document-store":f(o),"user-store":f(s),"prompt-documents":!0,onRefresh:T},{"additional-badges":K(()=>{var k;return[p.requires_signature?(r(),u("div",{key:0,class:V(["inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",c(p)])},[p.fully_signed?(r(),u("svg",vn,xn)):(k=d(p))!=null&&k.signed?(r(),u("svg",_n,$n)):d(p)?(r(),u("svg",kn,Cn)):(r(),u("svg",Sn,In)),e("span",null,I(p.fully_signed?"Formalizado":b(p)),1)],2)):C("",!0)]}),_:2},1032,["document","highlighted-doc-id","status-icon","status-text","status-badge-classes","document-store","user-store"]))),128))])):a.promptDocuments?C("",!0):(r(),u("div",En,[(r(!0),u(R,null,O(U.value,p=>(r(),Q(f(me),{key:p.id,document:p,"card-type":"lawyer","card-context":"list","highlighted-doc-id":S.value,"status-icon":n(p),"status-text":_(p),"status-badge-classes":l(p),"document-store":f(o),"user-store":f(s),onRefresh:T},{"additional-badges":K(()=>{var k;return[p.requires_signature?(r(),u("div",{key:0,class:V(["inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",c(p)])},[p.fully_signed?(r(),u("svg",Tn,Un)):(k=d(p))!=null&&k.signed?(r(),u("svg",Bn,jn)):d(p)?(r(),u("svg",Nn,Vn)):(r(),u("svg",qn,Qn)),e("span",null,I(p.fully_signed?"Formalizado":b(p)),1)],2)):C("",!0)]}),_:2},1032,["document","highlighted-doc-id","status-icon","status-text","status-badge-classes","document-store","user-store"]))),128))])),x(Ae,{isVisible:f(ge),documentData:f(Te),onClose:$[0]||($[0]=p=>ge.value=!1)},null,8,["isVisible","documentData"])],64))}},On=ve(Rn,[["__scopeId","data-v-71135d5a"]]),Hn={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},Gn={__name:"DocumentFinishedByClientList",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(t,{emit:o}){const s=ee(),m=se();Y(()=>{s.init(),m.init()});const g=t,a=B(()=>{const n=s.completedDocumentsByClient,_=g.selectedTags?g.selectedTags.map(c=>c.id):[];return s.filteredDocumentsBySearchAndTags(g.searchQuery,m,_).filter(c=>n.some(h=>h.id===c.id))});return m.userSignature,(n,_)=>(r(),u("div",Hn,[(r(!0),u(R,null,O(a.value,l=>(r(),Q(f(me),{key:l.id,document:l,"card-type":"lawyer","card-context":"finished","highlighted-doc-id":null,"status-icon":f(Le),"status-text":"Completado","status-badge-classes":"bg-green-100 text-green-700 border border-green-200","document-store":f(s),"user-store":f(m),"edit-route":`/dynamic_document_dashboard/document/use/editor/${l.id}/${encodeURIComponent(l.title.trim())}`,onRefresh:_[0]||(_[0]=c=>n.$emit("refresh"))},null,8,["document","status-icon","document-store","user-store","edit-route"]))),128))]))}},Wn={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4"},Jn={__name:"DocumentInProgressByClientList",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(t,{emit:o}){const s=ee(),m=se();Y(()=>{s.init(),m.init()});const g=t,a=B(()=>{const n=s.progressDocumentsByClient,_=g.selectedTags?g.selectedTags.map(c=>c.id):[];return s.filteredDocumentsBySearchAndTags(g.searchQuery,m,_).filter(c=>n.some(h=>h.id===c.id))});return m.userSignature,(n,_)=>(r(),u("div",Wn,[(r(!0),u(R,null,O(a.value,l=>(r(),Q(f(me),{key:l.id,document:l,"card-type":"lawyer","card-context":"progress","highlighted-doc-id":null,"status-icon":f(Fe),"status-text":"En Progreso","status-badge-classes":"bg-blue-100 text-blue-700 border border-blue-200","document-store":f(s),"user-store":f(m),"edit-route":`/dynamic_document_dashboard/document/use/editor/${l.id}/${encodeURIComponent(l.title.trim())}`,onRefresh:_[0]||(_[0]=c=>n.$emit("refresh"))},null,8,["document","status-icon","document-store","user-store","edit-route"]))),128))]))}},Kn={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Zn={class:"flex justify-end"},Xn=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[X(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),Yn={class:"mt-2"},ea={class:"flex gap-2 mt-2.5"},ta=["disabled"],sa=e("span",null,"Actualizar nombre",-1),oa=[sa],ra=["disabled"],na={__name:"CreateDocumentByLawyer",emits:["close"],setup(t,{emit:o}){const s=Ce(),m=ee(),g=o,a=j(""),n=j("");ze(()=>{var S;(S=m.selectedDocument)!=null&&S.title?(a.value=m.selectedDocument.title,n.value=m.selectedDocument.title):(a.value="",n.value="")});const _=S=>{S.key==="Escape"&&g("close")};Y(()=>{document.addEventListener("keydown",_)}),he(()=>{document.removeEventListener("keydown",_)});const l=B(()=>a.value.trim().length>0),c=B(()=>{var S;return!!((S=m.selectedDocument)!=null&&S.id)}),h=B(()=>c.value&&a.value.trim()!==n.value.trim()&&a.value.trim().length>0);async function y(){if(c.value&&h.value)try{const S={title:a.value.trim()};await m.updateDocument(m.selectedDocument.id,S),n.value=a.value.trim(),m.selectedDocument.title=a.value.trim(),m.lastUpdatedDocumentId=m.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",m.selectedDocument.id);const v=m.selectedDocument.id;g("close",{updatedDocId:v});const d=window.location.pathname;d==="/dynamic_document_dashboard"||d==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(v)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(S){console.error("Error updating document name:",S)}}const U=async()=>{if(!l.value)return;const S=encodeURIComponent(a.value.trim());c.value?(m.selectedDocument.title=a.value,m.selectedDocument.id&&(m.lastUpdatedDocumentId=m.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",m.selectedDocument.id.toString())),s.push(`/dynamic_document_dashboard/lawyer/editor/edit/${m.selectedDocument.id}`)):(m.selectedDocument={title:a.value.trim()},s.push(`/dynamic_document_dashboard/lawyer/editor/create/${S}`))};return(S,v)=>(r(),u("div",Kn,[e("div",Zn,[e("button",{onClick:v[0]||(v[0]=d=>g("close"))},[x(f(oe),{class:"size-6"})])]),e("form",{onSubmit:ie(U,["prevent"])},[e("div",null,[Xn,e("div",Yn,[ne(e("input",{"onUpdate:modelValue":v[1]||(v[1]=d=>a.value=d),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[Se,a.value]])])]),e("div",ea,[c.value?(r(),u("button",{key:0,type:"button",onClick:y,disabled:!h.value,class:V(["p-2.5 text-sm font-medium rounded-md flex gap-2",h.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},oa,10,ta)):C("",!0),e("button",{type:"submit",class:V(["p-2.5 text-sm font-medium rounded-md flex gap-2",l.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!l.value},[e("span",null,I(c.value?"Editar Documento":"Continuar"),1)],10,ra)])],32)]))}},aa={class:"p-4 sm:p-6 lg:p-10 lg:px-8"},la={key:0,class:"mt-6"},ia={class:"mb-6 border-b border-gray-200"},da={class:"-mb-px hidden md:flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},ca=["onClick"],ua={class:"md:hidden relative"},ma=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),ga=[ma],ha={class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},fa=["onClick"],pa={class:"mb-6"},va={key:0},ya={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-3 sm:gap-4"},ba={key:2,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-3 sm:gap-4"},xa={key:3},_a={key:4},wa={key:5,class:"mt-6 text-center text-gray-400 font-regular"},$a=e("p",null,"No hay documentos disponibles para mostrar.",-1),ka=[$a],Da={key:1,class:"mt-6"},Ca={key:0,class:"mb-6 border-b border-gray-200"},Sa={class:"-mb-px hidden md:flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},Fa=["onClick"],Ia={class:"md:hidden relative"},Ea=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),Ta=[Ea],La={class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},Aa=["onClick"],Ua={key:1,class:"mb-6"},Ba={class:"p-4 sm:p-6"},Ma={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},ja={class:"flex justify-between items-center p-4 border-b"},Na=e("h2",{class:"text-lg font-medium text-primary"},"Firma ElectrÃ³nica",-1),za={class:"p-4 sm:p-6"},sl={__name:"Dashboard",setup(t){const o=se(),s=ee(),m=Me(),g=Ce(),a=j(""),n=j("default"),_=j(!1),l=j("folders"),c=j("legal-documents"),h=j(!1),y=j([]),U=B(()=>o.currentUser),S=B(()=>U.value?U.value.role:(console.log("Current user is null, redirecting to login..."),g.push("/login"),null)),v=B(()=>{let N=[];S.value==="lawyer"?N=s.draftAndPublishedDocumentsUnassigned:S.value==="client"&&(N=s.progressAndCompletedDocumentsByClient(U.value.id));const w=y.value.map(M=>M.id);return s.filteredDocumentsBySearchAndTags(a.value,o,w).filter(M=>N.some(H=>H.id===M.id))}),d=N=>{n.value=N,s.selectedDocument=null},b=()=>{_.value=!1,n.value="default",s.selectedDocument=null},L=async()=>{await s.init(!0)},T=async()=>{l.value="folders";try{await new Promise(N=>setTimeout(N,100)),await m.fetchFolders(!0),console.log("ğ Dashboard: Refreshed folders after navigate-to-main")}catch(N){console.warn("Error refreshing folders on navigate-to-main:",N)}};J(()=>s.lastUpdatedDocumentId,(N,w)=>{if(N&&N!==w&&n.value==="default"){const M=Date.now();(!J.lastExecutionTime||M-J.lastExecutionTime>100)&&(J.lastExecutionTime=M,n.value="default")}},{immediate:!1});const i=[{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Dcs. Firmados"}],$=[{name:"legal-documents",label:"Minutas"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"finished-documents",label:"Dcs. Clientes"},{name:"in-progress-documents",label:"Dcs. Clientes en Progreso"}],p=j(!1),k=j(!1),D=()=>{p.value=!1,k.value=!1},A=N=>{const w=document.querySelectorAll(".relative");let M=!1;w.forEach(H=>{H.contains(N.target)&&(M=!0)}),M||D()},F=N=>{c.value=N,p.value=!1},q=N=>{l.value=N,k.value=!1};Y(async()=>{await o.init(),await s.init(),await m.init(),s.selectedDocument=null,n.value="default";const N=localStorage.getItem("lastUpdatedDocumentId");N&&s.documents.some(M=>M.id.toString()===N)&&(s.lastUpdatedDocumentId=parseInt(N)),document.addEventListener("click",A)}),he(()=>{document.removeEventListener("click",A)});const Z=async N=>{await o.getUserInfo(),o.currentUser&&(o.currentUser.has_signature=!0),showNotification("Firma electrÃ³nica guardada correctamente","success"),setTimeout(()=>{h.value=!1},500)};return(N,w)=>{var M,H;return r(),u(R,null,[x(et,{"onUpdate:searchQuery":w[0]||(w[0]=E=>a.value=E)},{default:K(()=>[Ve(N.$slots,"default")]),_:3}),e("div",aa,[x(bs,{onOpenNewDocument:w[1]||(w[1]=E=>_.value=!0),onUpdateCurrentSection:d,role:S.value},null,8,["role"]),S.value==="lawyer"?(r(),u("div",la,[e("div",ia,[e("nav",da,[(r(),u(R,null,O($,E=>e("button",{key:E.name,onClick:z=>c.value=E.name,class:V([c.value===E.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},I(E.label),11,ca)),64))]),e("div",ua,[e("button",{onClick:w[2]||(w[2]=E=>p.value=!p.value),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,I(((M=$.find(E=>E.name===c.value))==null?void 0:M.label)||"Seleccionar secciÃ³n"),1),(r(),u("svg",{class:V(["ml-2 h-5 w-5 transition-transform duration-200",p.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ga,2))]),ne(e("div",ha,[(r(),u(R,null,O($,E=>e("button",{key:E.name,onClick:z=>F(E.name),class:V(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",c.value===E.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},I(E.label),11,fa)),64))],512),[[ye,p.value]])])]),e("div",pa,[x(Ee,{modelValue:y.value,"onUpdate:modelValue":w[3]||(w[3]=E=>y.value=E)},null,8,["modelValue"])]),c.value==="legal-documents"?(r(),u("div",va,[x(On,{searchQuery:a.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])])):C("",!0),c.value==="pending-signatures"?(r(),u("div",ya,[x(De,{state:"PendingSignatures",searchQuery:a.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])])):C("",!0),c.value==="signed-documents"?(r(),u("div",ba,[x(De,{state:"FullySigned",searchQuery:a.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])])):C("",!0),c.value==="finished-documents"?(r(),u("div",xa,[x(Gn,{searchQuery:a.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])])):C("",!0),c.value==="in-progress-documents"?(r(),u("div",_a,[x(Jn,{searchQuery:a.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])])):C("",!0),v.value.length===0?(r(),u("div",wa,ka)):C("",!0)])):C("",!0),S.value==="client"?(r(),u("div",Da,[n.value!=="useDocument"?(r(),u("div",Ca,[e("nav",Sa,[(r(),u(R,null,O(i,E=>e("button",{key:E.name,onClick:z=>l.value=E.name,class:V([l.value===E.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},I(E.label),11,Fa)),64))]),e("div",Ia,[e("button",{onClick:w[4]||(w[4]=E=>k.value=!k.value),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,I(((H=i.find(E=>E.name===l.value))==null?void 0:H.label)||"Seleccionar secciÃ³n"),1),(r(),u("svg",{class:V(["ml-2 h-5 w-5 transition-transform duration-200",k.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ta,2))]),ne(e("div",La,[(r(),u(R,null,O(i,E=>e("button",{key:E.name,onClick:z=>q(E.name),class:V(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",l.value===E.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},I(E.label),11,Aa)),64))],512),[[ye,k.value]])])])):C("",!0),l.value!=="folders"?(r(),u("div",Ua,[x(Ee,{modelValue:y.value,"onUpdate:modelValue":w[5]||(w[5]=E=>y.value=E)},null,8,["modelValue"])])):C("",!0),n.value==="useDocument"?(r(),Q(fn,{key:2,searchQuery:a.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])):(r(),u("div",{key:3,class:V(["grid gap-3 sm:gap-4",{"grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3":l.value!="my-documents"&&l.value!="folders"}])},[l.value==="pending-signatures"?(r(),Q(De,{key:0,state:"PendingSignatures",searchQuery:a.value,selectedTags:y.value,onRefresh:L},null,8,["searchQuery","selectedTags"])):C("",!0),l.value==="my-documents"?(r(),Q(gn,{key:1,searchQuery:a.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])):C("",!0),l.value==="folders"?(r(),Q(nn,{key:2,searchQuery:a.value,selectedTags:y.value,onRefresh:L,onNavigateToMain:T},null,8,["searchQuery","selectedTags"])):C("",!0),l.value==="signed-documents"?(r(),Q(De,{key:3,state:"FullySigned",searchQuery:a.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])):C("",!0)],2))])):C("",!0)]),ne(x(ce,null,{default:K(()=>[x(na,{onClose:b})]),_:1},512),[[ye,_.value]]),h.value?(r(),Q(ce,{key:0},{default:K(()=>[e("div",Ba,[e("div",Ma,[e("div",ja,[Na,e("button",{onClick:w[6]||(w[6]=E=>h.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[x(f(oe),{class:"h-6 w-6"})])]),e("div",za,[x(qe,{"user-id":U.value.id,"initial-show-options":!U.value.has_signature,onSignatureSaved:Z,onCancel:w[7]||(w[7]=E=>h.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):C("",!0),x(Ae,{isVisible:f(ge),documentData:f(Te),onClose:w[8]||(w[8]=E=>ge.value=!1)},null,8,["isVisible","documentData"])],64)}}};export{sl as default};
