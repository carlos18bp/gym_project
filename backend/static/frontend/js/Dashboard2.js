import{L as z,a as ie,o as B,r as k,e as o,f as l,g as e,j as t,l as i,n as I,aT as O,i as v,I as Q,k as x,A as H,aU as J,a0 as M,F as $,s as V,c as U,H as P,aV as ce,t as S,w as q,M as G,u as A,ab as K,ac as X,ad as Y,ae as Z,aa as ee,P as E,a6 as de}from"./index.js";import{u as L,s as N,p as te,o as se}from"./dynamicDocument.js";import{_ as ue}from"./SearchBarAndFilterBy.js";import{c as R,r as j,b as me,e as ge,f as pe,a as fe,D as ve,d as be,g as he}from"./DocumentListClient.js";import{r as ae,_ as oe}from"./DocumentSignaturesModal.js";import T from"./SignaturesList.js";import"./MagnifyingGlassIcon.js";import"./_plugin-vue_export-helper.js";import"./loading_message.js";import"./PhotoIcon.js";import"./useRecentViews.js";const ye={key:0,class:"pb-8 border-b border-gray-200 flex gap-6 flex-wrap"},_e=e("div",{class:"grid"},[e("span",{class:"font-medium text-base"},"Documentos"),e("span",{class:"text-gray-400 font-regular text-sm"},"Mi unidad")],-1),xe=e("div",{class:"grid"},[e("span",{class:"font-medium text-base"},"Firma Electrónica"),e("span",{class:"text-gray-400 font-regular text-sm"},"Documentos")],-1),we=e("div",{class:"grid"},[e("span",{class:"font-medium text-base"},"Nuevo Documento")],-1),De={key:1,class:"pb-8 border-b border-gray-200 flex gap-6 flex-wrap"},$e=e("div",{class:"grid"},[e("span",{class:"font-medium text-base"},"Mis Documentos")],-1),ke=e("div",{class:"grid"},[e("span",{class:"font-medium text-base"},"Firma Electrónica")],-1),Se=e("div",{class:"grid"},[e("span",{class:"font-medium text-base"},"Nuevo Documento")],-1),Ce={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-auto"},Fe={class:"flex justify-between items-center mb-4"},Qe=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),Pe={__name:"DocumentsNavigation",props:{role:String},emits:["updateCurrentSection","openNewDocument"],setup(F,{emit:m}){z();const r=ie();B(async()=>{});const D=m,d=k("default"),p=k(!1),b=F,h=c=>{d.value=c,D("updateCurrentSection",c)},y=async c=>{try{r.userAuth&&(r.userAuth.has_signature=!0,r.saveToLocalStorageAuth()),V("Firma electrónica guardada correctamente","success"),p.value=!1}catch(a){console.error("Error updating signature information:",a),V("Hubo un problema al guardar la firma","error")}};return(c,a)=>(o(),l($,null,[(b==null?void 0:b.role)==="lawyer"?(o(),l("div",ye,[e("button",{onClick:a[0]||(a[0]=u=>h("default")),class:I(["flex gap-2 items-center py-2 px-4 rounded-xl border-2 border-yellow-300 text-start bg-white",{"bg-yellow-300/30":d.value=="default"}])},[t(i(R),{class:"size-6 text-yellow-500 font-semibold"}),_e],2),e("button",{onClick:a[1]||(a[1]=u=>p.value=!0),class:"flex gap-2 items-center py-2 px-4 rounded-xl border-2 border-purple-300 bg-white text-start hover:bg-purple-200"},[t(i(O),{class:"size-6 text-purple-500 font-semibold"}),xe]),e("button",{onClick:a[2]||(a[2]=u=>c.$emit("openNewDocument")),class:"flex gap-2 items-center py-2 px-4 rounded-md bg-white text-start hover:bg-gray-100"},[t(i(j),{class:"size-6 text-secondary font-semibold"}),we])])):v("",!0),(b==null?void 0:b.role)==="client"?(o(),l("div",De,[e("button",{onClick:a[3]||(a[3]=u=>h("default")),class:I(["flex gap-2 items-center py-2 px-4 rounded-md border-2 border-yellow-300 bg-white text-start",{"bg-yellow-300/30":d.value=="default"}])},[t(i(R),{class:"size-6 text-yellow-500 font-semibold"}),$e],2),e("button",{onClick:a[4]||(a[4]=u=>p.value=!0),class:"flex gap-2 items-center py-2 px-4 rounded-md border-2 border-purple-300 bg-white text-start hover:bg-purple-200"},[t(i(O),{class:"size-6 text-purple-500 font-semibold"}),ke]),e("button",{onClick:a[5]||(a[5]=u=>h("useDocument")),class:I(["flex gap-2 items-center py-2 px-4 rounded-md bg-white text-start hover:bg-gray-100",{"bg-selected-background":d.value=="useDocument"}])},[t(i(j),{class:"size-6 text-secondary font-semibold"}),Se],2)])):v("",!0),p.value?(o(),Q(M,{key:2},{default:x(()=>[e("div",Ce,[e("div",Fe,[Qe,e("button",{onClick:a[6]||(a[6]=u=>p.value=!1),class:"text-gray-400 hover:text-gray-500"},[t(i(H),{class:"h-6 w-6"})])]),t(J,{initialShowOptions:!0,"user-id":i(r).userAuth.id,onSignatureSaved:y,onCancel:a[7]||(a[7]=u=>p.value=!1)},null,8,["user-id"])])]),_:1})):v("",!0)],64))}},Ue={class:"mt-8 flex flex-wrap gap-6"},Ie=["onClick"],ze={class:"grid gap-1"},Ee={class:"text-base font-medium"},Te={class:"text-sm font-regular text-gray-400"},Me={__name:"UseDocument",props:{searchQuery:String},setup(F){const m=L(),r=z(),D=k(!1),d=k(null),p=F,b=U(()=>{const c=m.publishedDocumentsUnassigned;return m.filteredDocuments(p.searchQuery,"").filter(a=>c.some(u=>u.id===a.id))});r.userSignature;function h(c){c&&(d.value=c,D.value=!0)}const y=c=>{if(D.value=!1,d.value=null,c&&c.updatedDocId){m.lastUpdatedDocumentId=c.updatedDocId,localStorage.setItem("lastUpdatedDocumentId",c.updatedDocId);const a=window.location.pathname;a==="/dynamic_document_dashboard"||a==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(c.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}};return(c,a)=>(o(),l("div",Ue,[(o(!0),l($,null,P(b.value,u=>(o(),l("button",{key:u.id,onClick:s=>h(u.id),class:"flex items-center gap-3 py-2 px-4 border rounded-xl border-stroke bg-white hover:bg-gray-100"},[t(i(ce),{class:"size-6 text-secondary"}),e("div",ze,[e("span",Ee,S(u.title),1),e("span",Te,S(u.description),1)]),t(i(me),{class:"size-6 text-gray-400"})],8,Ie))),128)),q(t(M,null,{default:x(()=>[d.value!==null?(o(),Q(ge,{key:0,"document-id":d.value,onClose:y},null,8,["document-id"])):v("",!0)]),_:1},512),[[G,D.value]])]))}},Ne={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4"},Be={class:"flex justify-between items-center w-full"},Le={class:"grid gap-1"},We={class:"text-base font-medium"},Ae={class:"text-sm font-regular text-gray-400"},Oe=e("span",{class:"sr-only"},"Open options",-1),Ve={class:"py-1"},Re=["onClick"],je={__name:"DocumentFinishedByClientList",props:{searchQuery:String},setup(F){const m=L(),r=z(),D=A();B(()=>{m.init(),r.init()});const d=F,p=U(()=>{const s=m.completedDocumentsByClient;return m.filteredDocuments(d.searchQuery,r).filter(n=>s.some(f=>f.id===n.id))}),b=[{label:"Editar",action:"edit"},{label:"Previsualización",action:"preview"},{label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"}],h=(s,n)=>{switch(s.action){case"edit":y(n);break;case"preview":se(n);break;case"downloadPDF":a(n);break;case"downloadWord":u(n);break;default:console.warn("Unknown action:",s.action)}},y=s=>{const n=encodeURIComponent(s.title.trim());D.push(`/dynamic_document_dashboard/document/use/editor/${s.id}/${n}`)},c=s=>{const n=r.userById(s);return n?`${n.first_name} ${n.last_name}`:"Desconocido"},a=s=>{m.downloadPDF(s.id,s.title)},u=s=>{m.downloadWord(s.id,s.title)};return r.userSignature,(s,n)=>(o(),l($,null,[e("div",Ne,[(o(!0),l($,null,P(p.value,f=>(o(),l("div",{key:f.id,class:"flex items-center gap-3 py-2 px-4 border rounded-xl border-green-400 bg-green-300/30 cursor-pointer mb-3"},[t(i(pe),{class:"size-8 text-green-500"}),e("div",Be,[e("div",Le,[e("span",We,S(f.title),1),e("span",Ae,S(c(f.assigned_to)),1)]),t(i(ee),{as:"div",class:"relative inline-block text-left"},{default:x(()=>[e("div",null,[t(i(K),{class:"flex items-center text-gray-400"},{default:x(()=>[Oe,t(i(ae),{class:"size-6","aria-hidden":"true"})]),_:1})]),t(X,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:x(()=>[t(i(Y),{class:"absolute right-0 z-10 mt-2 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black/5"},{default:x(()=>[e("div",Ve,[(o(),l($,null,P(b,C=>t(i(Z),{key:C.label},{default:x(()=>[e("button",{onClick:W=>h(C,f),class:"block w-full text-left px-4 py-2 text-sm font-regular cursor-pointer hover:bg-gray-100 transition"},S(C.label),9,Re)]),_:2},1024)),64))])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]))),128))]),t(oe,{isVisible:i(N),documentData:i(te),onClose:n[0]||(n[0]=f=>N.value=!1)},null,8,["isVisible","documentData"])],64))}},He={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4"},Je={class:"flex justify-between items-center w-full"},qe={class:"grid gap-1"},Ge={class:"text-base font-medium"},Ke={class:"text-sm font-regular text-gray-400"},Xe=e("span",{class:"sr-only"},"Open options",-1),Ye={class:"py-1"},Ze=["onClick"],et={__name:"DocumentInProgressByClientList",props:{searchQuery:String},setup(F){const m=L(),r=z(),D=A();B(()=>{m.init(),r.init()});const d=F,p=U(()=>{const s=m.progressDocumentsByClient;return m.filteredDocuments(d.searchQuery,r).filter(n=>s.some(f=>f.id===n.id))}),b=[{label:"Editar",action:"edit"},{label:"Previsualización",action:"preview"},{label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"}],h=(s,n)=>{switch(s.action){case"edit":y(n);break;case"preview":se(n);break;case"downloadPDF":a(n);break;case"downloadWord":u(n);break;default:console.warn("Unknown action:",s.action)}},y=s=>{const n=encodeURIComponent(s.title.trim());D.push(`/dynamic_document_dashboard/document/use/editor/${s.id}/${n}`)},c=s=>{const n=r.userById(s);return n?`${n.first_name} ${n.last_name}`:"Desconocido"},a=s=>{m.downloadPDF(s.id,s.title)},u=s=>{m.downloadWord(s.id,s.title)};return r.userSignature,(s,n)=>(o(),l($,null,[e("div",He,[(o(!0),l($,null,P(p.value,f=>(o(),l("div",{key:f.id,class:"flex items-center gap-3 py-2 px-4 border rounded-xl border-stroke bg-white cursor-pointer mb-3"},[t(i(fe),{class:"size-8 text-secondary"}),e("div",Je,[e("div",qe,[e("span",Ge,S(f.title),1),e("span",Ke,S(c(f.assigned_to)),1)]),t(i(ee),{as:"div",class:"relative inline-block text-left"},{default:x(()=>[e("div",null,[t(i(K),{class:"flex items-center text-gray-400"},{default:x(()=>[Xe,t(i(ae),{class:"size-6","aria-hidden":"true"})]),_:1})]),t(X,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:x(()=>[t(i(Y),{class:"absolute right-0 z-10 mt-2 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black/5"},{default:x(()=>[e("div",Ye,[(o(),l($,null,P(b,C=>t(i(Z),{key:C.label},{default:x(()=>[e("button",{onClick:W=>h(C,f),class:"block w-full text-left px-4 py-2 text-sm font-regular cursor-pointer hover:bg-gray-100 transition"},S(C.label),9,Ze)]),_:2},1024)),64))])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]))),128))]),t(oe,{isVisible:i(N),documentData:i(te),onClose:n[0]||(n[0]=f=>N.value=!1)},null,8,["isVisible","documentData"])],64))}},tt={class:"p-4 sm:p-6 lg:p-10 lg:px-8"},st={key:0,class:"mt-6"},at={class:"mb-6 border-b border-gray-200"},ot={class:"-mb-px flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},nt=["onClick"],rt={key:0},lt={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-3 sm:gap-4"},it={key:2,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-3 sm:gap-4"},ct={key:3},dt={key:4},ut={key:5,class:"mt-6 text-center text-gray-400 font-regular"},mt=e("p",null,"No hay documentos disponibles para mostrar.",-1),gt=[mt],pt={key:1,class:"mt-6"},ft={key:0,class:"mb-6 border-b border-gray-200"},vt={class:"-mb-px flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},bt=["onClick"],ht={key:2,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-3 sm:gap-4"},yt={class:"p-4 sm:p-6"},_t={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},xt={class:"flex justify-between items-center p-4 border-b"},wt=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),Dt={class:"p-4 sm:p-6"},Tt={__name:"Dashboard",setup(F){const m=z(),r=L(),D=A(),d=k(""),p=k("default"),b=k(!1),h=k("my-documents"),y=k("legal-documents"),c=k(!1),a=U(()=>m.currentUser),u=U(()=>a.value?a.value.role:(console.log("Current user is null, redirecting to login..."),D.push("/login"),null)),s=U(()=>{let _=[];return u.value==="lawyer"?_=r.draftAndPublishedDocumentsUnassigned:u.value==="client"&&(_=r.progressAndCompletedDocumentsByClient(a.value.id)),r.filteredDocuments(d.value,m).filter(w=>_.some(g=>g.id===w.id))});B(async()=>{await m.init(),await r.init(),r.selectedDocument=null,p.value="default";const _=localStorage.getItem("lastUpdatedDocumentId");_&&r.documents.some(g=>g.id.toString()===_)&&(r.lastUpdatedDocumentId=parseInt(_))});const n=_=>{p.value=_,r.selectedDocument=null},f=()=>{b.value=!1,p.value="default",r.selectedDocument=null},C=async()=>{await r.init(!0)};E(()=>r.lastUpdatedDocumentId,(_,w)=>{if(_&&_!==w&&p.value==="default"){const g=Date.now();(!E.lastExecutionTime||g-E.lastExecutionTime>100)&&(E.lastExecutionTime=g,p.value="default")}},{immediate:!1});const W=[{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Documentos Firmados"}],ne=[{name:"legal-documents",label:"Documentos Jurídicos"},{name:"pending-signatures",label:"Documentos para Firmar"},{name:"signed-documents",label:"Documentos Firmados"},{name:"finished-documents",label:"Documentos Finalizados"},{name:"in-progress-documents",label:"Documentos en Progreso"}],re=async _=>{await m.getUserInfo(),m.currentUser&&(m.currentUser.has_signature=!0),showNotification("Firma electrónica guardada correctamente","success"),setTimeout(()=>{c.value=!1},500)};return(_,w)=>(o(),l($,null,[t(ue,{"onUpdate:searchQuery":w[0]||(w[0]=g=>d.value=g)},{default:x(()=>[de(_.$slots,"default")]),_:3}),e("div",tt,[t(Pe,{onOpenNewDocument:w[1]||(w[1]=g=>b.value=!0),onUpdateCurrentSection:n,role:u.value},null,8,["role"]),u.value==="lawyer"?(o(),l("div",st,[e("div",at,[e("nav",ot,[(o(),l($,null,P(ne,g=>e("button",{key:g.name,onClick:le=>y.value=g.name,class:I([y.value===g.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},S(g.label),11,nt)),64))])]),y.value==="legal-documents"?(o(),l("div",rt,[t(ve,{searchQuery:d.value},null,8,["searchQuery"])])):v("",!0),y.value==="pending-signatures"?(o(),l("div",lt,[t(T,{state:"PendingSignatures",searchQuery:d.value},null,8,["searchQuery"])])):v("",!0),y.value==="signed-documents"?(o(),l("div",it,[t(T,{state:"FullySigned",searchQuery:d.value},null,8,["searchQuery"])])):v("",!0),y.value==="finished-documents"?(o(),l("div",ct,[t(je,{searchQuery:d.value},null,8,["searchQuery"])])):v("",!0),y.value==="in-progress-documents"?(o(),l("div",dt,[t(et,{searchQuery:d.value},null,8,["searchQuery"])])):v("",!0),s.value.length===0?(o(),l("div",ut,gt)):v("",!0)])):v("",!0),u.value==="client"?(o(),l("div",pt,[p.value!=="useDocument"?(o(),l("div",ft,[e("nav",vt,[(o(),l($,null,P(W,g=>e("button",{key:g.name,onClick:le=>h.value=g.name,class:I([h.value===g.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},S(g.label),11,bt)),64))])])):v("",!0),p.value==="useDocument"?(o(),Q(Me,{key:1,searchQuery:d.value},null,8,["searchQuery"])):(o(),l("div",ht,[h.value==="pending-signatures"?(o(),Q(T,{key:0,state:"PendingSignatures",searchQuery:d.value,onRefresh:C},null,8,["searchQuery"])):v("",!0),h.value==="my-documents"?(o(),Q(be,{key:1,searchQuery:d.value},null,8,["searchQuery"])):v("",!0),h.value==="signed-documents"?(o(),Q(T,{key:2,state:"FullySigned",searchQuery:d.value},null,8,["searchQuery"])):v("",!0)]))])):v("",!0)]),q(t(M,null,{default:x(()=>[t(he,{onClose:f})]),_:1},512),[[G,b.value]]),c.value?(o(),Q(M,{key:0},{default:x(()=>[e("div",yt,[e("div",_t,[e("div",xt,[wt,e("button",{onClick:w[2]||(w[2]=g=>c.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[t(i(H),{class:"h-6 w-6"})])]),e("div",Dt,[t(J,{"user-id":a.value.id,"initial-show-options":!a.value.has_signature,onSignatureSaved:re,onCancel:w[3]||(w[3]=g=>c.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):v("",!0)],64))}};export{Tt as default};
