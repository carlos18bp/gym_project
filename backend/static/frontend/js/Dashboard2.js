import{e as o,f as i,g as e,u as Ie,r as M,aH as Re,o as te,ap as pe,c as z,j as y,l as c,G as re,w as ae,v as Fe,n as R,i as I,t as F,h as ue,p as Z,s as O,ab as Je,k as X,aV as ie,a8 as qe,aW as Ke,Q as ye,m as G,a1 as de,F as H,P as ne,N as fe,O as ve,D as xe,E as Ye,aX as Xe,a0 as et,C as tt,T as Y,M as J,a as st,aY as De,aS as Ce,aZ as Qe,ae as ot}from"./index.js";import{u as se,o as Oe,s as ce,p as Ee}from"./index3.js";import{g as ge,a as _e}from"./DocumentPermissionsManager.js";import{_ as rt}from"./SearchBarAndFilterBy.js";import{_ as be}from"./_plugin-vue_export-helper.js";import{r as nt}from"./ArrowDownTrayIcon.js";import{r as Ge}from"./TrashIcon.js";import{r as Te}from"./DocumentIcon.js";import{a as at,r as lt}from"./PhotoIcon.js";import{r as Ne}from"./InformationCircleIcon.js";import{r as He,B as it,b as dt,a as Le,_ as Ue}from"./index2.js";import{r as ct}from"./ExclamationTriangleIcon.js";import{r as me,_ as he}from"./DocumentCard.js";import{r as oe}from"./PlusIcon.js";import{r as ze}from"./MagnifyingGlassIcon2.js";import{r as ut}from"./EyeIcon.js";import{_ as Ae,S as Se}from"./SignaturesList.js";import{r as Me}from"./PencilIcon.js";import{useRecentViews as mt}from"./useRecentViews.js";import"./MagnifyingGlassIcon.js";import"./loading_message.js";function gt(t,r){return o(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function ht(t,r){return o(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function pt(t,r){return o(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})])}function Ve(t,r){return o(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 6h.008v.008H6V6Z"})])}const ft={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},vt={class:"flex justify-end"},bt=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[Z(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),yt={class:"mt-2"},xt={class:"flex gap-2 mt-2.5"},_t=["disabled"],wt=e("span",null,"Actualizar nombre",-1),$t=[wt],kt=["disabled"],Dt={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(t,{emit:r}){const s=t,g=Ie(),p=se(),l=r,n=M(""),_=M(""),a=()=>{l("close")};Re(()=>{var f,b;p.selectedDocument?(n.value=((f=p.selectedDocument)==null?void 0:f.title)||"",_.value=((b=p.selectedDocument)==null?void 0:b.title)||""):(n.value="",_.value="")});const m=f=>{f.key==="Escape"&&a()};te(()=>{document.addEventListener("keydown",m)}),pe(()=>{document.removeEventListener("keydown",m)});const w=z(()=>n.value.trim().length>0),x=z(()=>{var f;return!!((f=p.selectedDocument)!=null&&f.id)}),$=z(()=>x.value&&n.value.trim()!==_.value.trim()&&n.value.trim().length>0);async function h(){if(x.value&&$.value)try{const f={title:n.value.trim()};await p.updateDocument(p.selectedDocument.id,f),_.value=n.value.trim(),p.selectedDocument.title=n.value.trim();const b=p.selectedDocument.id;O("Document name successfully updated.","success"),l("close",{updatedDocId:b});const T=window.location.pathname;T==="/dynamic_document_dashboard"||T==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(f){console.error("Error updating document name:",f),O("Error updating document name.","error")}}function u(){const f=encodeURIComponent(n.value.trim());s.documentId&&!p.selectedDocument?g.push(`/dynamic_document_dashboard/document/use/creator/${s.documentId}/${f}`):p.selectedDocument?(p.selectedDocument.title=n.value.trim(),g.push(`/dynamic_document_dashboard/document/use/editor/${p.selectedDocument.id}/${f}`)):O("Error: No se pudo continuar. Documento no seleccionado.","error")}return(f,b)=>(o(),i("div",ft,[e("div",vt,[e("button",{onClick:a},[y(c(re),{class:"size-6"})])]),e("form",{onSubmit:ue(u,["prevent"])},[e("div",null,[bt,e("div",yt,[ae(e("input",{"onUpdate:modelValue":b[0]||(b[0]=E=>n.value=E),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[Fe,n.value]])])]),e("div",xt,[x.value?(o(),i("button",{key:0,type:"button",onClick:h,disabled:!$.value,class:R(["p-2.5 text-sm font-medium rounded-md flex gap-2",$.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},$t,10,_t)):I("",!0),e("button",{type:"submit",class:R(["p-2.5 text-sm font-medium rounded-md flex gap-2",w.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!w.value},[e("span",null,F(x.value?"Editar Documento":"Continuar"),1)],10,kt)])],32)]))}},Ct={class:"mt-3 pt-2 border-t border-gray-100"},St={class:"flex items-center gap-2 text-xs text-gray-500"},It=e("span",null,"Hacer clic para usar este documento",-1),je={__name:"UseDocumentCard",props:{document:{type:Object,required:!0},showTags:{type:Boolean,default:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null}},emits:["click","remove-from-folder","document-created"],setup(t,{emit:r}){const s=t,g=r,p=M(!1),l=M(null),n=ge(9),_=z(()=>"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium !bg-purple-100 !text-purple-700 !border !border-purple-200"),a=z(()=>n.dark),m=z(()=>"group !border-purple-400 !bg-purple-50/50 !shadow-purple-100"),w=z(()=>s.menuOptions!==null?s.menuOptions:[{label:"Usar",action:"use",icon:pt,iconClasses:"w-4 h-4 text-purple-600"},{label:"Previsualización",action:"preview",icon:ut,iconClasses:"w-4 h-4 text-gray-600"}]),x=z(()=>!1),$=(b,E)=>{s.disableInternalActions?g("click",b,E):u(b.id)},h=(b,E)=>{switch(b){case"use":u(E.id);break;case"preview":Oe(E);break;default:console.warn("Unknown menu action:",b)}};function u(b){b?(l.value=b,p.value=!0):console.error("Document ID is required:",b)}function f(b){if(p.value=!1,l.value=null,b&&b.updatedDocId){g("document-created",b);const E=window.location.pathname;E==="/dynamic_document_dashboard"||E==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(b.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}}return(b,E)=>(o(),i(H,null,[y(it,{document:t.document,"card-type":t.cardType,"card-context":t.cardContext,"status-icon":c(Ke),"status-text":"Disponible","status-badge-classes":_.value,"menu-options":w.value,"highlighted-doc-id":null,"show-tags":t.showTags,"document-store":t.documentStore,"user-store":t.userStore,"additional-classes":m.value,"disable-internal-actions":t.disableInternalActions,"show-menu-options":t.showMenuOptions,onClick:$,onMenuAction:h,onRemoveFromFolder:E[0]||(E[0]=T=>b.$emit("remove-from-folder",T))},Je({"additional-actions":X(()=>[qe(b.$slots,"additional-actions")]),_:2},[x.value?{name:"right-action",fn:X(()=>[y(c(He),{class:"w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors"})]),key:"0"}:void 0,t.disableInternalActions?void 0:{name:"footer",fn:X(()=>[e("div",Ct,[e("div",St,[e("div",{class:"w-2 h-2 rounded-full",style:ie({backgroundColor:a.value})},null,4),It])])]),key:"1"}]),1032,["document","card-type","card-context","status-icon","status-badge-classes","menu-options","show-tags","document-store","user-store","additional-classes","disable-internal-actions","show-menu-options"]),ae(y(de,null,{default:X(()=>[l.value!==null?(o(),G(Dt,{key:0,"document-id":l.value,onClose:f},null,8,["document-id"])):I("",!0)]),_:1},512),[[ye,p.value]])],64))}},we=t=>(fe("data-v-a52f6718"),t=t(),ve(),t),Ft={class:"flex items-start justify-between mb-4"},Et={class:"flex items-center gap-3"},Tt={class:"relative"},Lt={class:"flex-1 min-w-0"},Ut={class:"font-medium text-gray-900 text-sm truncate group-hover:text-primary transition-colors"},Mt={class:"text-xs text-gray-500 mt-0.5"},At={class:"relative folder-menu-container"},Bt={key:0,class:"absolute right-0 top-full mt-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50"},jt=we(()=>e("div",{class:"border-t border-gray-100 my-1"},null,-1)),Pt={class:"space-y-2"},Nt={key:0,class:"flex items-center gap-2"},zt=we(()=>e("div",{class:"w-2 h-2 bg-blue-500 rounded-full"},null,-1)),Vt={class:"text-xs text-gray-600"},Rt={key:1,class:"flex items-center gap-2"},qt=we(()=>e("div",{class:"w-2 h-2 bg-green-500 rounded-full"},null,-1)),Qt={class:"text-xs text-gray-600"},Ot={key:2,class:"flex items-center gap-2"},Gt=we(()=>e("div",{class:"w-2 h-2 bg-orange-500 rounded-full"},null,-1)),Ht={class:"text-xs text-gray-600"},Zt={key:3,class:"text-center py-3"},Wt=we(()=>e("p",{class:"text-xs text-gray-500"},"Carpeta vacía",-1)),Jt={class:"mt-4 pt-3 border-t border-gray-100"},Kt={class:"flex items-center justify-between"},Yt={class:"text-xs text-gray-500"},Xt={__name:"FolderCard",props:{folder:{type:Object,required:!0}},emits:["click","edit","delete","add-documents"],setup(t,{emit:r}){const s=t,g=r,p=ne(),l=M(!1),n=M(!1),_=z(()=>p.currentUser),a=z(()=>ge(s.folder.color_id)||{hex:"#6B7280",name:"Gray"}),m=z(()=>s.folder.documents?s.folder.documents.length:0),w=z(()=>{if(!s.folder.documents)return{myDocuments:[],useDocuments:[],signatureDocuments:[]};const d=s.folder.documents;return{myDocuments:d.filter(k=>{var v;return k.assigned_to===((v=_.value)==null?void 0:v.id)&&(k.state==="Progress"||k.state==="Completed")}),useDocuments:d.filter(k=>k.state==="Published"&&!k.assigned_to),signatureDocuments:d.filter(k=>k.state==="PendingSignatures"||k.state==="FullySigned")}}),x=d=>{d.target.closest(".folder-menu-container")||n.value||l.value||g("click",s.folder)},$=()=>{l.value=!l.value},h=(d=!1)=>{l.value=!1,d&&(n.value=!0,setTimeout(()=>{n.value=!1},50))},u=()=>{h(!1),g("edit",s.folder)},f=()=>{h(!1),g("delete",s.folder)},b=()=>{h(!1),g("add-documents",s.folder)},E=d=>{if(!d)return"";const k=new Date(d),C=Math.abs(new Date-k),D=Math.floor(C/(1e3*60*60*24));if(D===0)return"hoy";if(D===1)return"ayer";if(D<7)return`hace ${D} días`;if(D<30){const A=Math.floor(D/7);return`hace ${A} ${A===1?"semana":"semanas"}`}else if(D<365){const A=Math.floor(D/30);return`hace ${A} ${A===1?"mes":"meses"}`}else return k.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},T=d=>{l.value&&!d.target.closest(".folder-menu-container")&&h(!0)};return te(()=>{document.addEventListener("click",T)}),pe(()=>{document.removeEventListener("click",T)}),(d,k)=>(o(),i("div",{class:"relative bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 p-5 cursor-pointer group",onClick:x},[e("div",Ft,[e("div",Et,[e("div",Tt,[y(c(me),{class:"w-10 h-10 text-gray-400",style:ie({color:a.value.hex})},null,8,["style"]),e("div",{class:"absolute -top-1 -right-1 w-4 h-4 rounded-full border-2 border-white shadow-sm",style:ie({backgroundColor:a.value.hex})},null,4)]),e("div",Lt,[e("h3",Ut,F(t.folder.name),1),e("p",Mt,F(m.value)+" "+F(m.value===1?"documento":"documentos"),1)])]),e("div",At,[e("button",{onClick:ue($,["stop"]),class:R(["opacity-100 transition-opacity p-1.5 rounded-full hover:bg-gray-100",{"bg-gray-100":l.value}])},[y(c(dt),{class:"w-4 h-4 text-gray-500"})],2),l.value?(o(),i("div",Bt,[e("button",{onClick:ue(u,["stop"]),class:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[y(c(Me),{class:"w-4 h-4"}),Z(" Editar carpeta ")]),e("button",{onClick:ue(b,["stop"]),class:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[y(c(oe),{class:"w-4 h-4"}),Z(" Agregar documentos ")]),jt,e("button",{onClick:ue(f,["stop"]),class:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2"},[y(c(Ge),{class:"w-4 h-4"}),Z(" Eliminar carpeta ")])])):I("",!0)])]),e("div",Pt,[w.value.myDocuments.length>0?(o(),i("div",Nt,[zt,e("span",Vt,F(w.value.myDocuments.length)+" mis documentos ",1)])):I("",!0),w.value.useDocuments.length>0?(o(),i("div",Rt,[qt,e("span",Qt,F(w.value.useDocuments.length)+" formatos disponibles ",1)])):I("",!0),w.value.signatureDocuments.length>0?(o(),i("div",Ot,[Gt,e("span",Ht,F(w.value.signatureDocuments.length)+" documentos con firmas ",1)])):I("",!0),m.value===0?(o(),i("div",Zt,[y(c(Te),{class:"w-8 h-8 text-gray-300 mx-auto mb-1"}),Wt])):I("",!0)]),e("div",Jt,[e("div",Kt,[e("span",Yt," Creada "+F(E(t.folder.created_at)),1),y(c(He),{class:"w-4 h-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})])]),l.value?(o(),i("div",{key:0,onClick:h,class:"fixed inset-0 z-5"})):I("",!0)]))}},es=be(Xt,[["__scopeId","data-v-a52f6718"]]),ts=()=>({folders:[],currentFolder:null,isLoading:!1,error:null,lastUpdatedFolderId:null}),ss={sortedFolders:t=>[...t.folders].sort((r,s)=>new Date(s.created_at)-new Date(r.created_at)),getFolderById:t=>r=>t.folders.find(s=>s.id===r),getFoldersByColor:t=>r=>t.folders.filter(s=>s.color_id===r),getFolderWithColor:t=>r=>{const s=t.folders.find(g=>g.id===r);return s?{...s,color:ge(s.color_id)}:null},getFoldersContainingDocument:t=>r=>t.folders.filter(s=>s.document_ids&&s.document_ids.includes(r)),totalDocumentsInFolders:t=>t.folders.reduce((r,s)=>r+(s.document_ids?s.document_ids.length:0),0),hasFolders:t=>t.folders.length>0,availableColors:()=>_e()},os={async init(t=!1){if(!(this.folders.length>0&&!t)){this.isLoading=!0,this.error=null;try{await this.fetchFolders()}catch(r){console.error("Error initializing document folder store:",r),this.error="Error al inicializar las carpetas"}finally{this.isLoading=!1}}},async fetchFolders(){try{const t=await xe("dynamic-documents/folders/");if(t.status===200)return this.folders=t.data,t.data;throw new Error(`Error fetching folders: ${t.status}`)}catch(t){throw console.error("Error fetching folders:",t),this.error="Error al obtener las carpetas",t}},async fetchFolder(t){this.isLoading=!0,this.error=null;try{const r=await xe(`dynamic-documents/folders/${t}/`);if(r.status===200){const s=r.data,g=this.folders.findIndex(p=>p.id===s.id);return g!==-1?this.folders[g]=s:this.folders.push(s),this.currentFolder=s,s}else throw new Error(`Error fetching folder: ${r.status}`)}catch(r){throw console.error("Error fetching folder:",r),this.error="Error al obtener la carpeta",r}finally{this.isLoading=!1}},async createFolder(t){this.isLoading=!0,this.error=null;try{if(!t.name||t.name.trim()==="")throw new Error("El nombre de la carpeta es requerido");const r=t.color_id??0;if(r<0||r>=_e().length)throw new Error("Color de carpeta no válido");const s={name:t.name.trim(),color_id:r,...t.document_ids&&{document_ids:t.document_ids}},g=await Ye("dynamic-documents/folders/create/",s);if(g.status===200||g.status===201){const p=g.data;return this.folders.push(p),this.lastUpdatedFolderId=p.id,await O("Carpeta creada exitosamente","success"),p}else throw new Error(`Error creating folder: ${g.status}`)}catch(r){throw console.error("Error creating folder:",r),this.error=r.message||"Error al crear la carpeta",await O(this.error,"error"),r}finally{this.isLoading=!1}},async updateFolder(t,r){this.isLoading=!0,this.error=null;try{if(r.name&&r.name.trim()==="")throw new Error("El nombre de la carpeta no puede estar vacío");if(r.color_id!==void 0){const p=r.color_id;if(p<0||p>=_e().length)throw new Error("Color de carpeta no válido")}const s={};r.name&&(s.name=r.name.trim()),r.color_id!==void 0&&(s.color_id=r.color_id),r.document_ids!==void 0&&(s.document_ids=r.document_ids);const g=await Xe(`dynamic-documents/folders/${t}/update/`,s);if(g.status===200){const p=g.data,l=this.folders.findIndex(n=>n.id===t);return l!==-1&&(this.folders[l]=p),this.currentFolder&&this.currentFolder.id===t&&(this.currentFolder=p),this.lastUpdatedFolderId=t,await O("Carpeta actualizada exitosamente","success"),p}else throw new Error(`Error updating folder: ${g.status}`)}catch(s){throw console.error("Error updating folder:",s),this.error=s.message||"Error al actualizar la carpeta",await O(this.error,"error"),s}finally{this.isLoading=!1}},async deleteFolder(t){this.isLoading=!0,this.error=null;try{const r=await et(`dynamic-documents/folders/${t}/delete/`);if(r.status===204||r.status===200)return this.folders=this.folders.filter(s=>s.id!==t),this.currentFolder&&this.currentFolder.id===t&&(this.currentFolder=null),await O("Carpeta eliminada exitosamente","success"),!0;throw new Error(`Error deleting folder: ${r.status}`)}catch(r){throw console.error("Error deleting folder:",r),this.error=r.message||"Error al eliminar la carpeta",await O(this.error,"error"),r}finally{this.isLoading=!1}},setCurrentFolder(t){this.currentFolder=t},clearCurrentFolder(){this.currentFolder=null},reset(){this.folders=[],this.currentFolder=null,this.isLoading=!1,this.error=null,this.lastUpdatedFolderId=null}},rs={async addDocumentsToFolder(t,r){const s=this.getFolderById(t);if(!s)throw new Error("Carpeta no encontrada");const g=s.document_ids||[],p=[...new Set([...g,...r])];return await this.updateFolder(t,{document_ids:p})},async removeDocumentsFromFolder(t,r){const s=this.getFolderById(t);if(!s)throw new Error("Carpeta no encontrada");const p=(s.document_ids||[]).filter(l=>!r.includes(l));return await this.updateFolder(t,{document_ids:p})},async moveDocumentsBetweenFolders(t,r,s){try{r&&await this.removeDocumentsFromFolder(r,t),s&&await this.addDocumentsToFolder(s,t),await O("Documentos movidos exitosamente","success")}catch(g){throw console.error("Error moving documents between folders:",g),await O("Error al mover documentos","error"),g}},getFolderColor(t){const r=this.getFolderById(t);return r?ge(r.color_id):ge(0)},validateFolderData(t){const r=[];if((!t.name||t.name.trim()==="")&&r.push("El nombre de la carpeta es requerido"),t.name&&t.name.length>100&&r.push("El nombre de la carpeta no puede exceder 100 caracteres"),t.color_id!==void 0){const s=t.color_id;(s<0||s>=_e().length)&&r.push("Color de carpeta no válido")}return t.document_ids&&!Array.isArray(t.document_ids)&&r.push("Los IDs de documentos deben ser un array"),{isValid:r.length===0,errors:r}}},Pe=tt("documentFolder",{state:ts,getters:ss,actions:{...os,...rs}}),ee=t=>(fe("data-v-71749b7f"),t=t(),ve(),t),ns={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},as={class:"px-6 py-4 border-b border-gray-200"},ls=ee(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gestión de Membrete Global",-1)),is=ee(()=>e("p",{class:"text-sm text-gray-500 mt-1"}," Este membrete se aplicará por defecto a todos tus documentos ",-1)),ds={class:"p-6 overflow-y-auto flex-grow"},cs={key:0,class:"text-center py-10"},us=ee(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),ms={class:"mt-4 text-gray-500"},gs={key:1,class:"space-y-6"},hs={key:0,class:"space-y-4"},ps=ee(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete Global Actual",-1)),fs={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},vs=["src"],bs={class:"mt-4 flex justify-center space-x-3"},ys=["disabled"],xs={key:1,class:"text-center py-8"},_s=ee(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete Global",-1)),ws=ee(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," No tienes una imagen de membrete global configurada. ",-1)),$s=ee(()=>e("p",{class:"mt-1 text-xs text-gray-400"}," El membrete global se aplicará a todos los documentos que no tengan un membrete específico. ",-1)),ks={class:"space-y-4"},Ds={class:"text-lg font-medium text-gray-900"},Cs={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},Ss={key:0},Is={class:"mt-4"},Fs=ee(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, máximo 10MB ",-1)),Es=ee(()=>e("p",{class:"text-xs text-gray-400 mt-1"}," Dimensiones ideales: 612 × 612 píxeles (8.5:11 Carta) ",-1)),Ts={key:1,class:"space-y-4"},Ls={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Us={class:"text-gray-400"},Ms={key:0,class:"mt-4"},As=["src"],Bs={class:"flex justify-center space-x-3"},js=["disabled"],Ps={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Ns={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},zs={class:"flex items-center space-x-2"},Vs=ee(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete Global",-1)),Rs=ee(()=>e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-yellow-800 mb-2"},"🔄 Prioridad de Membrete"),e("div",{class:"text-sm text-yellow-700 space-y-1"},[e("div",null,[e("strong",null,"1º Prioridad:"),Z(" Membrete específico del documento")]),e("div",null,[e("strong",null,"2º Prioridad:"),Z(" Membrete global del usuario (este)")]),e("div",null,[e("strong",null,"3º Prioridad:"),Z(" Sin membrete")])])],-1)),qs=ee(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"📐 Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"612 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"612 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporción:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"±10%")])])])],-1)),Qs=ee(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🎨 Distribución Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"⚠️ ZONA CRÍTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mantén semi-transparente. El texto del documento se superpone aquí.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, teléfonos, emails, información de contacto.")])])])])])],-1)),Os=ee(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🔧 Consideraciones Técnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Posicionamiento:"),Z(" La imagen se centra automáticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Transparencia:"),Z(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Márgenes:"),Z(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Resolución:"),Z(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"⚠️"),e("span",null,[e("strong",null,"Zona crítica:"),Z(" Evita elementos gráficos densos en el centro (300-400px de altura)")])])])])],-1)),Gs=ee(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"💡 Tips de Diseño Rápido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"• Si solo tienes header, ubícalo en los primeros 120-150px"),e("div",null,"• El resto de la imagen debe ser transparente o blanco"),e("div",null,"• Para footer, usa los últimos 80-120px"),e("div",null,"• El texto se superpone en toda la imagen, mantén el centro claro")])],-1)),Hs={key:3,class:"space-y-2"},Zs={class:"flex"},Ws={class:"text-sm text-yellow-700"},Js={__name:"GlobalLetterheadModal",props:{isVisible:{type:Boolean,default:!1}},emits:["close","uploaded","deleted"],setup(t,{emit:r}){const s=t,g=r,p=se(),l=M(!1),n=M(""),_=M(!1),a=M(!1),m=M(null),w=M(null),x=M(null),$=M([]),h=M(null),u=M(!1),f=()=>{T(),g("close")},b=j=>{const N=j.target.files[0];if(!N)return;if(!N.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(N.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}m.value=N,$.value=[];const U=new FileReader;U.onload=S=>{w.value=S.target.result;const P=new Image;P.onload=()=>{E(P.width,P.height)},P.src=S.target.result},U.readAsDataURL(N)},E=(j,N)=>{const q=j/N,V=612/612,B=Math.abs(q-V)/V;if(j===612&&N===612){$.value.push("✅ Dimensiones perfectas: 612 × 612 píxeles");return}B<=.1?($.value.push(`ℹ️ Buenas proporciones detectadas: ${j} × ${N} píxeles (${q.toFixed(3)})`),(j!==612||N!==612)&&$.value.push("💡 Para mejores resultados, usa exactamente 612 × 612 píxeles")):($.value.push(`⚠️ Proporciones no ideales: ${j} × ${N} píxeles (${q.toFixed(3)})`),$.value.push(`🎯 Proporciones recomendadas: ${V.toFixed(3)} (8.5:11)`),$.value.push("📐 Considera redimensionar tu imagen a 612 × 612 píxeles")),(j<300||N<300)&&$.value.push("⚠️ Imagen muy pequeña - puede verse pixelada en documentos"),(j>1200||N>1600)&&$.value.push("ℹ️ Imagen muy grande - se redimensionará automáticamente")},T=()=>{m.value=null,w.value=null,$.value=[],u.value=!1,h.value&&(h.value.value="")},d=async()=>{var j;if(m.value){_.value=!0,$.value=[];try{const N=await p.uploadGlobalLetterheadImage(m.value);(j=N.data)!=null&&j.warnings&&N.data.warnings.length>0&&($.value=N.data.warnings),await k(),T(),g("uploaded",N.data)}catch(N){console.error("Error uploading global letterhead:",N),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{_.value=!1}}},k=async()=>{try{const j=await p.getGlobalLetterheadImage();j.data&&(x.value=URL.createObjectURL(j.data))}catch{x.value=null}},v=()=>{confirm("¿Estás seguro de que deseas eliminar la imagen de membrete global?")&&C()},C=async()=>{a.value=!0;try{await p.deleteGlobalLetterheadImage(),x.value&&URL.revokeObjectURL(x.value),x.value=null,g("deleted")}catch(j){console.error("Error deleting global letterhead:",j),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{a.value=!1}},D=()=>{if(x.value){const j=document.createElement("a");j.href=x.value,j.download="membrete-global.png",document.body.appendChild(j),j.click(),document.body.removeChild(j)}},A=()=>{x.value=null},L=j=>{if(j===0)return"0 Bytes";const N=1024,U=["Bytes","KB","MB","GB"],S=Math.floor(Math.log(j)/Math.log(N));return parseFloat((j/Math.pow(N,S)).toFixed(2))+" "+U[S]};Y(()=>s.isVisible,j=>{j&&k()});const Q=()=>{x.value&&URL.revokeObjectURL(x.value),w.value&&URL.revokeObjectURL(w.value)};return te(()=>{s.isVisible&&k()}),pe(Q),(j,N)=>ae((o(),G(de,null,{default:X(()=>[e("div",ns,[e("div",as,[ls,is,e("button",{onClick:f,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[y(c(re),{class:"h-6 w-6"})])]),e("div",ds,[l.value?(o(),i("div",cs,[us,e("p",ms,F(n.value),1)])):(o(),i("div",gs,[x.value?(o(),i("div",hs,[ps,e("div",fs,[e("img",{src:x.value,alt:"Membrete global actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:A},null,40,vs),e("div",bs,[e("button",{onClick:D,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[y(c(nt),{class:"h-4 w-4 mr-2"}),Z(" Descargar ")]),e("button",{onClick:v,disabled:a.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[y(c(Ge),{class:"h-4 w-4 mr-2"}),Z(" "+F(a.value?"Eliminando...":"Eliminar"),1)],8,ys)])])])):(o(),i("div",xs,[y(c(Te),{class:"mx-auto h-12 w-12 text-gray-400"}),_s,ws,$s])),e("div",ks,[e("h3",Ds,F(x.value?"Reemplazar Membrete Global":"Subir Membrete Global"),1),e("div",Cs,[e("input",{ref_key:"fileInput",ref:h,type:"file",accept:".png",onChange:b,class:"hidden"},null,544),m.value?(o(),i("div",Ts,[e("div",Ls,[y(c(Le),{class:"h-5 w-5 text-green-500"}),e("span",null,F(m.value.name),1),e("span",Us,"("+F(L(m.value.size))+")",1)]),w.value?(o(),i("div",Ms,[e("img",{src:w.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,As)])):I("",!0),e("div",Bs,[e("button",{onClick:T,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:d,disabled:_.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[_.value?(o(),i("div",Ps)):(o(),G(c(lt),{key:0,class:"h-4 w-4 mr-2"})),Z(" "+F(_.value?"Subiendo...":"Subir Imagen"),1)],8,js)])])):(o(),i("div",Ss,[y(c(at),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Is,[e("button",{onClick:N[0]||(N[0]=U=>j.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG "),e("button",{onClick:N[1]||(N[1]=U=>u.value=!u.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[y(c(Ne),{class:"h-4 w-4 mr-2"}),Z(" "+F(u.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),Fs,Es]))])]),u.value?(o(),i("div",Ns,[e("div",zs,[y(c(Ne),{class:"h-6 w-6 text-blue-600"}),Vs]),Rs,qs,Qs,Os,Gs])):I("",!0),$.value.length>0?(o(),i("div",Hs,[(o(!0),i(H,null,J($.value,(U,S)=>(o(),i("div",{key:S,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",Zs,[y(c(ct),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",Ws,F(U),1)])]))),128))])):I("",!0)]))])])]),_:1},512)),[[ye,t.isVisible]])}},Ks=be(Js,[["__scopeId","data-v-71749b7f"]]),Ys={key:0,class:"pb-6 border-b border-gray-200"},Xs={class:"hidden sm:flex gap-4 lg:gap-6"},eo=e("div",{class:"grid min-w-0"},[e("span",{class:"font-medium text-base truncate"},"Minutas y Documentos"),e("span",{class:"text-gray-400 font-regular text-sm truncate"},"Mi unidad")],-1),to=e("div",{class:"grid min-w-0"},[e("span",{class:"font-medium text-base truncate"},"Firma Electrónica"),e("span",{class:"text-gray-400 font-regular text-sm truncate"},"Documentos")],-1),so=e("div",{class:"grid min-w-0"},[e("span",{class:"font-medium text-base truncate"},"Membrete Global"),e("span",{class:"text-gray-400 font-regular text-sm truncate"},"Para todos los documentos")],-1),oo=e("div",{class:"grid"},[e("span",{class:"font-medium text-base"},"Nueva Minuta")],-1),ro={class:"sm:hidden space-y-3"},no=e("div",{class:"grid"},[e("span",{class:"font-semibold text-lg"},"Minutas y Documentos"),e("span",{class:"text-gray-500 font-regular text-sm"},"Mi unidad")],-1),ao={class:"grid grid-cols-3 gap-3"},lo=e("span",{class:"font-medium text-sm leading-tight"},"Firma Electrónica",-1),io=e("span",{class:"font-medium text-sm leading-tight"},"Membrete Global",-1),co=e("span",{class:"font-medium text-sm leading-tight"},"Nueva Minuta",-1),uo={key:1,class:"pb-6 border-b border-gray-200"},mo={class:"hidden sm:flex gap-4 lg:gap-6"},go=e("div",{class:"grid"},[e("span",{class:"font-medium text-base truncate"},"Mis Documentos")],-1),ho=e("div",{class:"grid"},[e("span",{class:"font-medium text-base truncate"},"Firma Electrónica")],-1),po=e("div",{class:"grid min-w-0"},[e("span",{class:"font-medium text-base truncate"},"Membrete Global"),e("span",{class:"text-gray-400 font-regular text-sm truncate"},"Para todos los documentos")],-1),fo=e("div",{class:"grid"},[e("span",{class:"font-medium text-base"},"Nuevo Documento")],-1),vo={class:"sm:hidden space-y-3"},bo=e("div",{class:"grid"},[e("span",{class:"font-semibold text-lg"},"Mis Documentos")],-1),yo={class:"grid grid-cols-3 gap-3"},xo=e("span",{class:"font-medium text-sm leading-tight"},"Firma Electrónica",-1),_o=e("span",{class:"font-medium text-sm leading-tight"},"Membrete Global",-1),wo=e("span",{class:"font-medium text-sm leading-tight"},"Nuevo Documento",-1),$o={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-auto"},ko={class:"flex justify-between items-center mb-4"},Do=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),Co={__name:"DocumentsNavigation",props:{role:String},emits:["updateCurrentSection","openNewDocument","globalLetterheadUploaded","globalLetterheadDeleted"],setup(t,{emit:r}){ne();const s=st();te(async()=>{});const g=r,p=M("default"),l=M(!1),n=M(!1),_=t,a=$=>{p.value=$,g("updateCurrentSection",$)},m=async $=>{try{s.userAuth&&(s.userAuth.has_signature=!0,s.saveToLocalStorageAuth()),O("Firma electrónica guardada correctamente","success"),l.value=!1}catch(h){console.error("Error updating signature information:",h),O("Hubo un problema al guardar la firma","error")}},w=$=>{O("Membrete global subido correctamente","success"),g("globalLetterheadUploaded",$)},x=()=>{O("Membrete global eliminado correctamente","success"),g("globalLetterheadDeleted")};return($,h)=>(o(),i(H,null,[(_==null?void 0:_.role)==="lawyer"?(o(),i("div",Ys,[e("div",Xs,[e("button",{onClick:h[0]||(h[0]=u=>a("default")),class:R(["flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-yellow-300 text-start bg-white transition-all duration-200 hover:shadow-md flex-1 min-w-0",{"bg-yellow-300/30 shadow-md":p.value=="default"}])},[y(c(me),{class:"size-6 text-yellow-500 font-semibold flex-shrink-0"}),eo],2),e("button",{onClick:h[1]||(h[1]=u=>l.value=!0),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-purple-300 bg-white text-start transition-all duration-200 hover:bg-purple-50 hover:shadow-md flex-1 min-w-0"},[y(c(De),{class:"size-6 text-purple-500 font-semibold flex-shrink-0"}),to]),e("button",{onClick:h[2]||(h[2]=u=>n.value=!0),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-green-300 bg-white text-start transition-all duration-200 hover:bg-green-50 hover:shadow-md flex-1 min-w-0"},[y(c(Ce),{class:"size-6 text-green-500 font-semibold flex-shrink-0"}),so]),e("button",{onClick:h[3]||(h[3]=u=>$.$emit("openNewDocument")),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-gray-200 bg-white text-start transition-all duration-200 hover:bg-gray-50 hover:shadow-md hover:border-secondary"},[y(c(oe),{class:"size-6 text-secondary font-semibold flex-shrink-0"}),oo])]),e("div",ro,[e("button",{onClick:h[4]||(h[4]=u=>a("default")),class:R(["w-full flex gap-3 items-center py-4 px-4 rounded-xl border-2 border-yellow-300 text-start bg-white transition-all duration-200",{"bg-yellow-300/30 shadow-md":p.value=="default"}])},[y(c(me),{class:"size-7 text-yellow-500 font-semibold flex-shrink-0"}),no],2),e("div",ao,[e("button",{onClick:h[5]||(h[5]=u=>l.value=!0),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-purple-300 bg-white text-center transition-all duration-200 hover:bg-purple-50 min-h-[90px]"},[y(c(De),{class:"size-8 text-purple-500 font-semibold mb-2"}),lo]),e("button",{onClick:h[6]||(h[6]=u=>n.value=!0),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-green-300 bg-white text-center transition-all duration-200 hover:bg-green-50 min-h-[90px]"},[y(c(Ce),{class:"size-8 text-green-500 font-semibold mb-2"}),io]),e("button",{onClick:h[7]||(h[7]=u=>$.$emit("openNewDocument")),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-gray-200 bg-white text-center transition-all duration-200 hover:bg-gray-50 hover:border-secondary min-h-[90px]"},[y(c(oe),{class:"size-8 text-secondary font-semibold mb-2"}),co])])])])):I("",!0),(_==null?void 0:_.role)==="client"?(o(),i("div",uo,[e("div",mo,[e("button",{onClick:h[8]||(h[8]=u=>a("default")),class:R(["flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-yellow-300 bg-white text-start transition-all duration-200 hover:shadow-md flex-1 min-w-0",{"bg-yellow-300/30 shadow-md":p.value=="default"}])},[y(c(me),{class:"size-6 text-yellow-500 font-semibold flex-shrink-0"}),go],2),e("button",{onClick:h[9]||(h[9]=u=>l.value=!0),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-purple-300 bg-white text-start transition-all duration-200 hover:bg-purple-50 hover:shadow-md flex-1 min-w-0"},[y(c(De),{class:"size-6 text-purple-500 font-semibold flex-shrink-0"}),ho]),e("button",{onClick:h[10]||(h[10]=u=>n.value=!0),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-green-300 bg-white text-start transition-all duration-200 hover:bg-green-50 hover:shadow-md flex-1 min-w-0"},[y(c(Ce),{class:"size-6 text-green-500 font-semibold flex-shrink-0"}),po]),e("button",{onClick:h[11]||(h[11]=u=>a("useDocument")),class:R(["flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-gray-200 bg-white text-start transition-all duration-200 hover:bg-gray-50 hover:shadow-md hover:border-secondary",{"bg-selected-background border-secondary":p.value=="useDocument"}])},[y(c(oe),{class:"size-6 text-secondary font-semibold flex-shrink-0"}),fo],2)]),e("div",vo,[e("button",{onClick:h[12]||(h[12]=u=>a("default")),class:R(["w-full flex gap-3 items-center py-4 px-4 rounded-xl border-2 border-yellow-300 text-start bg-white transition-all duration-200",{"bg-yellow-300/30 shadow-md":p.value=="default"}])},[y(c(me),{class:"size-7 text-yellow-500 font-semibold flex-shrink-0"}),bo],2),e("div",yo,[e("button",{onClick:h[13]||(h[13]=u=>l.value=!0),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-purple-300 bg-white text-center transition-all duration-200 hover:bg-purple-50 min-h-[90px]"},[y(c(De),{class:"size-8 text-purple-500 font-semibold mb-2"}),xo]),e("button",{onClick:h[14]||(h[14]=u=>n.value=!0),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-green-300 bg-white text-center transition-all duration-200 hover:bg-green-50 min-h-[90px]"},[y(c(Ce),{class:"size-8 text-green-500 font-semibold mb-2"}),_o]),e("button",{onClick:h[15]||(h[15]=u=>a("useDocument")),class:R(["flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-gray-200 bg-white text-center transition-all duration-200 hover:bg-gray-50 hover:border-secondary min-h-[90px]",{"bg-selected-background border-secondary":p.value=="useDocument"}])},[y(c(oe),{class:"size-8 text-secondary font-semibold mb-2"}),wo],2)])])])):I("",!0),l.value?(o(),G(de,{key:2},{default:X(()=>[e("div",$o,[e("div",ko,[Do,e("button",{onClick:h[16]||(h[16]=u=>l.value=!1),class:"text-gray-400 hover:text-gray-500"},[y(c(re),{class:"h-6 w-6"})])]),y(Qe,{initialShowOptions:!0,"user-id":c(s).userAuth.id,onSignatureSaved:m,onCancel:h[17]||(h[17]=u=>l.value=!1)},null,8,["user-id"])])]),_:1})):I("",!0),y(Ks,{"is-visible":n.value,onClose:h[18]||(h[18]=u=>n.value=!1),onUploaded:w,onDeleted:x},null,8,["is-visible"])],64))}},$e=t=>(fe("data-v-d403a707"),t=t(),ve(),t),So={class:"tag-filter-container"},Io={class:"relative"},Fo={class:"flex items-center"},Eo={key:0,class:"ml-2 inline-flex items-center justify-center h-5 w-5 bg-primary text-white text-xs rounded-full font-medium"},To={key:0,class:"absolute left-0 mt-2 w-full sm:w-80 bg-white rounded-xl shadow-xl ring-1 ring-black ring-opacity-5 border border-gray-100 z-50 overflow-hidden"},Lo={class:"bg-gray-50 p-4 border-b border-gray-200"},Uo={class:"flex items-center justify-between mb-3"},Mo=$e(()=>e("h3",{class:"text-sm font-semibold text-gray-900"},"Filtrar por etiquetas",-1)),Ao={key:0,class:"text-xs text-gray-500"},Bo={class:"relative"},jo={key:0,class:"px-4 py-2 bg-blue-50 border-b border-blue-100"},Po={class:"flex items-center justify-between"},No={class:"text-xs font-medium text-blue-700"},zo={class:"max-h-52 overflow-y-auto"},Vo={key:0,class:"px-4 py-8 text-center"},Ro=$e(()=>e("p",{class:"text-gray-500 text-sm"},"No hay etiquetas disponibles",-1)),qo={key:1,class:"px-4 py-8 text-center"},Qo={class:"text-gray-500 text-sm"},Oo={key:2,class:"px-4 py-8 text-center"},Go=$e(()=>e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"}),e("span",{class:"ml-3 text-sm text-gray-600"},"Cargando etiquetas...")],-1)),Ho=[Go],Zo={key:3,class:"py-2"},Wo=["onClick"],Jo={class:"flex items-center h-5"},Ko={class:"relative"},Yo=["id","checked","onChange"],Xo={key:0,class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},er=$e(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),tr=[er],sr={class:"ml-3 flex items-center flex-1 min-w-0"},or={class:"text-sm font-medium text-gray-900 truncate"},rr={key:0,class:"mt-4"},nr={class:"flex items-start gap-2"},ar=$e(()=>e("span",{class:"text-xs font-medium text-gray-500 mt-1.5 flex-shrink-0"},"Activos:",-1)),lr={class:"flex flex-wrap gap-2"},ir=["onClick"],dr={class:"mr-1"},cr={class:"ml-1 p-0.5 rounded-full hover:bg-white/50 transition-colors duration-150"},ur={__name:"TagFilter",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(t,{emit:r}){const s=t,g=r,p=se(),l=M(!1),n=M([]),_=M(!1),a=M(""),m=z(()=>p.sortedTags),w=z(()=>{if(!a.value.trim())return m.value;const E=a.value.toLowerCase().trim();return m.value.filter(T=>T.name.toLowerCase().includes(E))}),x=E=>{const T=ge(E.color_id);return{hex:T&&T.hex?T.hex:"#9CA3AF",dark:T&&T.dark?T.dark:"#374151"}},$=()=>{l.value=!l.value,l.value&&(a.value="")},h=E=>n.value.some(T=>T.id===E.id),u=E=>{const T=n.value.findIndex(d=>d.id===E.id);T>=0?n.value.splice(T,1):n.value.push(E),g("update:modelValue",n.value)},f=()=>{n.value=[],g("update:modelValue",[])},b=E=>{E.target.closest(".tag-filter-container")||(l.value=!1,a.value="")};return te(async()=>{try{_.value=!0,await p.initTags()}catch(E){console.error("Error loading tags:",E)}finally{_.value=!1}document.addEventListener("click",b)}),Y(()=>s.modelValue,E=>{n.value=E||[]},{immediate:!0}),pe(()=>{document.removeEventListener("click",b)}),(E,T)=>(o(),i("div",So,[e("div",Io,[e("button",{onClick:$,class:R(["group inline-flex items-center justify-between w-full sm:w-auto sm:min-w-[200px] px-4 py-3 border border-gray-200 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-primary transition-all duration-200",{"ring-2 ring-primary border-primary bg-blue-50":l.value,"border-primary bg-primary/5":n.value.length>0&&!l.value}])},[e("div",Fo,[y(c(Ve),{class:R(["h-5 w-5 mr-2.5 text-gray-500 group-hover:text-gray-600",{"text-primary":n.value.length>0||l.value}])},null,8,["class"]),e("span",{class:R(["text-gray-700",{"text-primary font-semibold":n.value.length>0||l.value}])}," Filtrar por etiquetas ",2),n.value.length>0?(o(),i("span",Eo,F(n.value.length),1)):I("",!0)]),y(c(ht),{class:R(["ml-3 h-4 w-4 text-gray-400 transition-all duration-200 group-hover:text-gray-600",{"rotate-180 text-primary":l.value,"text-primary":n.value.length>0&&!l.value}])},null,8,["class"])],2),y(ot,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:X(()=>[l.value?(o(),i("div",To,[e("div",Lo,[e("div",Uo,[Mo,m.value.length>0?(o(),i("span",Ao,F(m.value.length)+" disponibles ",1)):I("",!0)]),e("div",Bo,[y(c(ze),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),ae(e("input",{"onUpdate:modelValue":T[0]||(T[0]=d=>a.value=d),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"},null,512),[[Fe,a.value]])])]),n.value.length>0?(o(),i("div",jo,[e("div",Po,[e("span",No,F(n.value.length)+" etiqueta"+F(n.value.length!==1?"s":"")+" seleccionada"+F(n.value.length!==1?"s":""),1),e("button",{onClick:f,class:"text-xs text-red-600 hover:text-red-700 font-medium px-2 py-1 rounded-md hover:bg-red-50 transition-all duration-200"}," Limpiar todo ")])])):I("",!0),e("div",zo,[!_.value&&w.value.length===0&&a.value.trim()===""?(o(),i("div",Vo,[y(c(Ve),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),Ro])):I("",!0),!_.value&&w.value.length===0&&a.value.trim()!==""?(o(),i("div",qo,[y(c(ze),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e("p",Qo,'Sin resultados para "'+F(a.value)+'"',1),e("button",{onClick:T[1]||(T[1]=d=>a.value=""),class:"text-xs text-primary hover:text-primary-dark mt-2 font-medium"}," Ver todas las etiquetas ")])):I("",!0),_.value?(o(),i("div",Oo,Ho)):I("",!0),!_.value&&w.value.length>0?(o(),i("div",Zo,[(o(!0),i(H,null,J(w.value,d=>(o(),i("div",{key:d.id,class:"group flex items-center px-4 py-2.5 hover:bg-gray-50 cursor-pointer transition-colors duration-150",onClick:k=>u(d)},[e("div",Jo,[e("div",Ko,[e("input",{id:`tag-${d.id}`,type:"checkbox",checked:h(d),onChange:k=>u(d),class:"sr-only"},null,40,Yo),e("div",{class:R(["w-4 h-4 border-2 rounded transition-all duration-200 flex items-center justify-center",h(d)?"bg-primary border-primary":"border-gray-300 group-hover:border-gray-400"])},[h(d)?(o(),i("svg",Xo,tr)):I("",!0)],2)])]),e("div",sr,[e("div",{class:"w-3 h-3 rounded-full mr-2.5 border flex-shrink-0 shadow-sm",style:ie({backgroundColor:x(d).hex})},null,4),e("span",or,F(d.name),1)])],8,Wo))),128))])):I("",!0)])])):I("",!0)]),_:1})]),n.value.length>0?(o(),i("div",rr,[e("div",nr,[ar,e("div",lr,[(o(!0),i(H,null,J(n.value,d=>(o(),i("div",{key:d.id,class:"group inline-flex items-center pl-2.5 pr-1.5 py-1.5 rounded-lg text-xs font-medium border shadow-sm cursor-pointer transition-all duration-200 hover:shadow-md",style:ie({backgroundColor:x(d).hex+"20",borderColor:x(d).hex+"40",color:x(d).dark}),onClick:k=>u(d)},[e("div",{class:"w-2 h-2 rounded-full mr-2 flex-shrink-0",style:ie({backgroundColor:x(d).hex})},null,4),e("span",dr,F(d.name),1),e("div",cr,[y(c(re),{class:"h-3 w-3 opacity-60 group-hover:opacity-100"})])],12,ir))),128))])])])):I("",!0)]))}},Be=be(ur,[["__scopeId","data-v-d403a707"]]),mr={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},gr={class:"bg-white rounded-xl shadow-xl max-w-md w-full"},hr={class:"flex justify-between items-center p-6 border-b"},pr={class:"text-lg font-semibold text-gray-900"},fr={class:"mb-4"},vr=e("label",{for:"folderName",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la carpeta ",-1),br={class:"mb-6"},yr=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Color de la carpeta ",-1),xr={class:"grid grid-cols-8 gap-2"},_r=["onClick","title"],wr={class:"flex gap-3"},$r=["disabled"],kr={__name:"CreateEditFolderModal",props:{isVisible:{type:Boolean,required:!0},editingFolder:{type:Object,default:null}},emits:["close","success"],setup(t,{emit:r}){const s=t,g=r,p=Pe(),l=M(!1),n=M({name:"",color_id:0}),_=z(()=>_e()),a=()=>{n.value={name:"",color_id:0}};Y(()=>s.editingFolder,x=>{x?n.value={name:x.name,color_id:x.color_id}:a()},{immediate:!0}),Y(()=>s.isVisible,x=>{x||a()});const m=()=>{g("close")},w=async()=>{if(n.value.name.trim()){l.value=!0;try{s.editingFolder?(await p.updateFolder(s.editingFolder.id,n.value),O("Carpeta actualizada correctamente","success")):(await p.createFolder(n.value),O("Carpeta creada correctamente","success")),g("success")}catch(x){const $=s.editingFolder?"actualizar":"crear";O(`Error al ${$} la carpeta`,"error"),console.error(`Error ${$} folder:`,x)}finally{l.value=!1}}};return(x,$)=>t.isVisible?(o(),G(de,{key:0},{default:X(()=>[e("div",mr,[e("div",gr,[e("div",hr,[e("h3",pr,F(t.editingFolder?"Editar Carpeta":"Nueva Carpeta"),1),e("button",{onClick:m,class:"text-gray-400 hover:text-gray-500"},[y(c(re),{class:"w-6 h-6"})])]),e("form",{onSubmit:ue(w,["prevent"]),class:"p-6"},[e("div",fr,[vr,ae(e("input",{id:"folderName","onUpdate:modelValue":$[0]||($[0]=h=>n.value.name=h),type:"text",required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ej: Contratos Laborales"},null,512),[[Fe,n.value.name]])]),e("div",br,[yr,e("div",xr,[(o(!0),i(H,null,J(_.value,h=>(o(),i("button",{key:h.id,type:"button",onClick:u=>n.value.color_id=h.id,class:R(["w-8 h-8 rounded-full border-2 transition-all",n.value.color_id===h.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"]),style:ie({backgroundColor:h.hex}),title:h.name},null,14,_r))),128))])]),e("div",wr,[e("button",{type:"button",onClick:m,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:!n.value.name.trim()||l.value,class:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},F(l.value?"Guardando...":t.editingFolder?"Actualizar":"Crear"),9,$r)])],32)])])]),_:1})):I("",!0)}},Dr={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Cr={class:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden"},Sr={class:"border-b"},Ir={class:"hidden sm:flex justify-between items-center p-6"},Fr={class:"flex items-center gap-3"},Er={class:"text-lg font-semibold text-gray-900"},Tr={class:"text-sm text-gray-600"},Lr={class:"flex items-center gap-2"},Ur={class:"sm:hidden"},Mr={class:"flex justify-between items-center p-4 pb-2"},Ar={class:"flex items-center gap-3 flex-1 min-w-0"},Br={class:"min-w-0 flex-1"},jr={class:"text-lg font-semibold text-gray-900 truncate"},Pr={class:"text-sm text-gray-600"},Nr={class:"px-4 pb-4"},zr={class:"p-4 sm:p-6 overflow-y-auto max-h-[70vh]"},Vr={class:"space-y-6"},Rr={key:0},qr=e("h4",{class:"text-base font-semibold text-gray-900 mb-3"},"Mis Documentos",-1),Qr={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Or={key:1},Gr=e("h4",{class:"text-base font-semibold text-gray-900 mb-3"},"Formatos Disponibles",-1),Hr={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Zr={key:2},Wr=e("h4",{class:"text-base font-semibold text-gray-900 mb-3"},"Documentos para Firmar",-1),Jr={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Kr={key:3,class:"text-center py-8 sm:py-12"},Yr={class:"text-gray-400 mb-4"},Xr=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"Esta carpeta está vacía",-1),en=e("p",{class:"text-gray-600 mb-4 text-sm sm:text-base"},"Agrega documentos para organizar tu trabajo",-1),tn={__name:"FolderDetailsModal",props:{folder:{type:Object,default:null}},emits:["close","add-documents","remove-document","view-document","use-document","refresh"],setup(t,{emit:r}){const s=t,g=r,p=ne(),l=se(),n=z(()=>p.currentUser),_=z(()=>{var u;return(u=s.folder)!=null&&u.color_id?ge(s.folder.color_id)||{hex:"#6B7280"}:{hex:"#6B7280"}}),a=z(()=>{if(!s.folder)return{myDocuments:[],useDocuments:[],signatureDocuments:[]};const u=s.folder.documents||[];return{myDocuments:u.filter(f=>{var b;return f.assigned_to===((b=n.value)==null?void 0:b.id)&&(f.state==="Progress"||f.state==="Completed")}),useDocuments:u.filter(f=>f.state==="Published"&&!f.assigned_to),signatureDocuments:u.filter(f=>f.state==="PendingSignatures"||f.state==="FullySigned")}});Y(()=>s.folder,(u,f)=>{var b,E;if(u&&f&&u.id===f.id){const T=((b=f.documents)==null?void 0:b.length)||0,d=((E=u.documents)==null?void 0:E.length)||0;d!==T&&console.log(`📁 FolderDetailsModal: Folder "${u.name}" updated! Documents: ${T} → ${d}`)}},{deep:!0});const m=()=>{g("close")},w=()=>{g("add-documents",s.folder)},x=u=>{g("view-document",u)},$=u=>{const f=s.folder.documents.find(b=>b.id===u);f&&g("use-document",f)},h=u=>{g("remove-document",u.id)};return(u,f)=>t.folder?(o(),G(de,{key:0},{default:X(()=>[e("div",Dr,[e("div",Cr,[e("div",Sr,[e("div",Ir,[e("div",Fr,[e("div",{class:"w-8 h-8 rounded-full flex-shrink-0",style:ie({backgroundColor:_.value.hex})},null,4),e("div",null,[e("h3",Er,F(t.folder.name),1),e("p",Tr,F(t.folder.documents.length)+" documento"+F(t.folder.documents.length!==1?"s":""),1)])]),e("div",Lr,[e("button",{onClick:w,class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"},[y(c(oe),{class:"w-4 h-4"}),Z(" Agregar documentos ")]),e("button",{onClick:m,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[y(c(re),{class:"w-5 h-5"})])])]),e("div",Ur,[e("div",Mr,[e("div",Ar,[e("div",{class:"w-7 h-7 rounded-full flex-shrink-0",style:ie({backgroundColor:_.value.hex})},null,4),e("div",Br,[e("h3",jr,F(t.folder.name),1),e("p",Pr,F(t.folder.documents.length)+" documento"+F(t.folder.documents.length!==1?"s":""),1)])]),e("button",{onClick:m,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors flex-shrink-0 ml-2"},[y(c(re),{class:"w-5 h-5"})])]),e("div",Nr,[e("button",{onClick:w,class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors"},[y(c(oe),{class:"w-4 h-4"}),Z(" Agregar documentos ")])])])]),e("div",zr,[e("div",Vr,[a.value.myDocuments.length>0?(o(),i("div",Rr,[qr,e("div",Qr,[(o(!0),i(H,null,J(a.value.myDocuments,b=>(o(),G(c(he),{key:b.id,document:b,"card-type":"client","card-context":"folder","highlighted-doc-id":null,"show-tags":!0,"show-client-name":!1,"additional-classes":"relative","document-store":c(l),"user-store":c(p),onClick:x,onRefresh:f[0]||(f[0]=E=>u.$emit("refresh")),onRemoveFromFolder:h},null,8,["document","document-store","user-store"]))),128))])])):I("",!0),a.value.useDocuments.length>0?(o(),i("div",Or,[Gr,e("div",Hr,[(o(!0),i(H,null,J(a.value.useDocuments,b=>(o(),G(c(je),{key:b.id,document:b,"card-context":"folder","show-menu-options":!0,"document-store":c(l),"user-store":c(p),onClick:$,onRemoveFromFolder:h},null,8,["document","document-store","user-store"]))),128))])])):I("",!0),a.value.signatureDocuments.length>0?(o(),i("div",Zr,[Wr,e("div",Jr,[(o(!0),i(H,null,J(a.value.signatureDocuments,b=>(o(),G(c(Ae),{key:b.id,document:b,"card-context":"folder","highlighted-doc-id":null,"document-store":c(l),"user-store":c(p),onRefresh:f[1]||(f[1]=E=>u.$emit("refresh")),onRemoveFromFolder:h},null,8,["document","document-store","user-store"]))),128))])])):I("",!0),t.folder.documents.length===0?(o(),i("div",Kr,[e("div",Yr,[y(c(Te),{class:"w-10 h-10 sm:w-12 sm:h-12 mx-auto"})]),Xr,en,e("button",{onClick:w,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm sm:text-base"},[y(c(oe),{class:"w-4 h-4"}),Z(" Agregar documentos ")])])):I("",!0)])])])])]),_:1})):I("",!0)}},sn={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},on={class:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden"},rn={class:"border-b"},nn={class:"hidden sm:flex justify-between items-center p-6"},an=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),ln={class:"text-sm text-gray-600"},dn={class:"sm:hidden p-4"},cn={class:"flex justify-between items-start mb-2"},un={class:"flex-1 min-w-0 mr-3"},mn=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),gn={class:"text-sm text-gray-600 truncate"},hn={class:"border-b"},pn={class:"hidden sm:flex space-x-8 px-6","aria-label":"Tabs"},fn=["onClick"],vn={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},bn={class:"sm:hidden relative px-4 py-3"},yn={class:"flex items-center"},xn={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},_n=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),wn=[_n],$n={class:"absolute top-full left-4 right-4 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},kn=["onClick"],Dn={class:"border-b bg-gray-50 p-4 sm:p-6"},Cn={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},Sn={class:"flex-1"},In={key:0,class:"flex items-center gap-3"},Fn={class:"text-sm text-gray-600"},En={class:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-350px)]"},Tn={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Ln={key:4,class:"absolute top-2 left-2 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center shadow-sm"},Un={key:0,class:"text-center py-8 sm:py-12"},Mn={class:"text-lg font-medium text-gray-900 mb-2"},An={class:"text-gray-600 text-sm sm:text-base"},Bn={class:"border-t bg-gray-50"},jn={class:"hidden sm:flex justify-between items-center p-6"},Pn={class:"text-sm text-gray-600"},Nn={class:"flex gap-3"},zn=["disabled"],Vn={class:"sm:hidden p-4 space-y-3"},Rn={class:"text-center text-sm text-gray-600"},qn={class:"flex gap-3"},Qn=["disabled"],On={__name:"AddDocumentsModal",props:{isVisible:{type:Boolean,required:!0},folder:{type:Object,default:null}},emits:["close","add-documents"],setup(t,{emit:r}){const s=t,g=r,p=se(),l=ne(),n=M([]),_=M([]),a=M("my-documents"),m=M(!1),w=M(!1),x=[{name:"my-documents",label:"Mis Documentos"},{name:"use-documents",label:"Formatos Disponibles"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Documentos Firmados"}],$=z(()=>l.currentUser);Y(()=>s.isVisible,C=>{C&&(n.value=[],_.value=[],a.value="my-documents")}),Y(a,()=>{n.value=[]}),Y(_,()=>{n.value=[]},{deep:!0});const h=z(()=>{const C=f(a.value);return C.length===0?!1:C.every(D=>n.value.includes(D.id))}),u=C=>{var L;if(!s.folder)return[];const D=s.folder.documents.map(Q=>Q.id);let A=[];switch(C){case"my-documents":A=p.progressAndCompletedDocumentsByClient((L=$.value)==null?void 0:L.id);break;case"use-documents":A=p.publishedDocumentsUnassigned;break;case"pending-signatures":A=p.documents.filter(Q=>{var j,N;return Q.state==="PendingSignatures"&&(Q.assigned_to===((j=$.value)==null?void 0:j.id)||((N=Q.signatures)==null?void 0:N.some(U=>{var S;return U.signer_email===((S=$.value)==null?void 0:S.email)})))});break;case"signed-documents":A=p.documents.filter(Q=>{var j,N;return Q.state==="FullySigned"&&(Q.assigned_to===((j=$.value)==null?void 0:j.id)||((N=Q.signatures)==null?void 0:N.some(U=>{var S;return U.signer_email===((S=$.value)==null?void 0:S.email)})))});break;default:A=[]}return A.filter(Q=>!D.includes(Q.id))},f=C=>{const D=u(C);if(!_.value||_.value.length===0)return D;const A=_.value.map(L=>L.id);return D.filter(L=>!L.tags||L.tags.length===0?!1:L.tags.some(Q=>A.includes(Q.id)))},b=C=>{const D=n.value.indexOf(C);D>-1?n.value.splice(D,1):n.value.push(C)},E=()=>{const D=f(a.value).map(A=>A.id);if(h.value)n.value=n.value.filter(A=>!D.includes(A));else{const A=D.filter(L=>!n.value.includes(L));n.value.push(...A)}},T=()=>{g("close")},d=async()=>{if(n.value.length!==0){m.value=!0;try{await g("add-documents",n.value)}finally{m.value=!1}}},k=C=>{a.value=C,w.value=!1},v=C=>{C.target.closest(".relative")||(w.value=!1)};return te(()=>{document.addEventListener("click",v)}),pe(()=>{document.removeEventListener("click",v)}),(C,D)=>t.isVisible&&t.folder?(o(),G(de,{key:0},{default:X(()=>{var A;return[e("div",sn,[e("div",on,[e("div",rn,[e("div",nn,[e("div",null,[an,e("p",ln,'Selecciona documentos para agregar a "'+F(t.folder.name)+'"',1)]),e("button",{onClick:T,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors"},[y(c(re),{class:"w-5 h-5"})])]),e("div",dn,[e("div",cn,[e("div",un,[mn,e("p",gn,'Para "'+F(t.folder.name)+'"',1)]),e("button",{onClick:T,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors flex-shrink-0"},[y(c(re),{class:"w-5 h-5"})])])])]),e("div",hn,[e("nav",pn,[(o(),i(H,null,J(x,L=>e("button",{key:L.name,onClick:Q=>a.value=L.name,class:R([a.value===L.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[Z(F(L.label)+" ",1),e("span",vn,F(f(L.name).length),1)],10,fn)),64))]),e("div",bn,[e("button",{onClick:D[0]||(D[0]=L=>w.value=!w.value),class:"w-full flex items-center justify-between py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("div",yn,[e("span",null,F(((A=x.find(L=>L.name===a.value))==null?void 0:A.label)||"Seleccionar categoría"),1),e("span",xn,F(f(a.value).length),1)]),(o(),i("svg",{class:R(["ml-2 h-5 w-5 transition-transform duration-200",w.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},wn,2))]),ae(e("div",$n,[(o(),i(H,null,J(x,L=>e("button",{key:L.name,onClick:Q=>k(L.name),class:R(["w-full text-left px-4 py-3 text-sm transition-colors duration-150 flex items-center justify-between",a.value===L.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},[e("span",null,F(L.label),1),e("span",{class:R(["py-0.5 px-2 rounded-full text-xs",a.value===L.name?"bg-white/20 text-white":"bg-gray-100 text-gray-600"])},F(f(L.name).length),3)],10,kn)),64))],512),[[ye,w.value]])])]),e("div",Dn,[e("div",Cn,[e("div",Sn,[y(Be,{modelValue:_.value,"onUpdate:modelValue":D[1]||(D[1]=L=>_.value=L),class:"max-w-md"},null,8,["modelValue"])]),f(a.value).length>0?(o(),i("div",In,[e("span",Fn,F(f(a.value).length)+" documento(s) disponible(s) ",1),e("button",{onClick:E,class:R(["px-4 py-2 rounded-lg border font-medium text-sm transition-colors",h.value?"bg-red-50 border-red-200 text-red-700 hover:bg-red-100":"bg-primary text-white border-primary hover:bg-primary-dark"])},F(h.value?"Deseleccionar todos":"Seleccionar todos"),3)])):I("",!0)])]),e("div",En,[e("div",Tn,[(o(!0),i(H,null,J(f(a.value),L=>(o(),i("div",{key:L.id,class:"relative"},[a.value==="my-documents"?(o(),G(c(he),{key:0,document:L,"highlighted-doc-id":null,"show-tags":!0,"show-client-name":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":n.value.includes(L.id)?"ring-2 ring-primary bg-primary-50":"",onClick:Q=>b(L.id)},null,8,["document","additional-classes","onClick"])):I("",!0),a.value==="use-documents"?(o(),G(c(je),{key:1,document:L,"show-tags":!0,"menu-options":[],"show-menu-options":!1,"disable-internal-actions":!0,"additional-classes":n.value.includes(L.id)?"ring-2 ring-primary bg-primary-50":"",onClick:Q=>b(L.id)},null,8,["document","additional-classes","onClick"])):I("",!0),a.value==="pending-signatures"?(o(),G(c(Ae),{key:2,document:L,"highlighted-doc-id":null,"show-tags":!0,"menu-options":[],"disable-internal-actions":!0,"additional-classes":n.value.includes(L.id)?"ring-2 ring-primary bg-primary-50":"",onClick:Q=>b(L.id)},null,8,["document","additional-classes","onClick"])):I("",!0),a.value==="signed-documents"?(o(),G(c(Ae),{key:3,document:L,"highlighted-doc-id":null,"show-tags":!0,"menu-options":[],"disable-internal-actions":!0,"additional-classes":n.value.includes(L.id)?"ring-2 ring-primary bg-primary-50":"",onClick:Q=>b(L.id)},null,8,["document","additional-classes","onClick"])):I("",!0),n.value.includes(L.id)?(o(),i("div",Ln,[y(c(gt),{class:"w-4 h-4"})])):I("",!0)]))),128))]),f(a.value).length===0?(o(),i("div",Un,[y(c(Te),{class:"w-12 h-12 sm:w-16 sm:h-16 text-gray-300 mx-auto mb-4"}),e("h4",Mn,F(_.value.length>0?"No hay documentos que coincidan con el filtro":"No hay documentos disponibles"),1),e("p",An,F(_.value.length>0?"Intenta ajustar los filtros de etiquetas o selecciona otra categoría":"No tienes documentos de esta categoría que no estén ya en la carpeta"),1)])):I("",!0)]),e("div",Bn,[e("div",jn,[e("div",Pn,F(n.value.length)+" documento(s) seleccionado(s) ",1),e("div",Nn,[e("button",{onClick:T,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{onClick:d,disabled:n.value.length===0||m.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},F(m.value?"Agregando...":`Agregar ${n.value.length} documento(s)`),9,zn)])]),e("div",Vn,[e("div",Rn,F(n.value.length)+" documento(s) seleccionado(s) ",1),e("div",qn,[e("button",{onClick:T,class:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center font-medium"}," Cancelar "),e("button",{onClick:d,disabled:n.value.length===0||m.value,class:"flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-center font-medium"},F(m.value?"Agregando...":"Agregar"),9,Qn)])])])])])]}),_:1})):I("",!0)}},ke=t=>(fe("data-v-71ba7453"),t=t(),ve(),t),Gn={class:"folders-grid"},Hn={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},Zn={key:1,class:"text-center py-12"},Wn=ke(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No tienes carpetas aún",-1)),Jn=ke(()=>e("p",{class:"text-gray-600 mb-6"},"Crea tu primera carpeta para organizar tus documentos",-1)),Kn={key:2,class:"text-center py-12"},Yn=ke(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No se encontraron carpetas",-1)),Xn=ke(()=>e("p",{class:"text-gray-600"},"No hay carpetas que coincidan con tu búsqueda",-1)),ea={key:3,class:"flex justify-center items-center py-12"},ta=ke(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)),sa=[ta],oa={__name:"FoldersGrid",props:{sortedFolders:{type:Array,required:!0},searchQuery:{type:String,default:""},isLoading:{type:Boolean,default:!1}},emits:["folder-click","edit-folder","delete-folder","add-documents","create-folder"],setup(t,{emit:r}){const s=t,g=r,p=z(()=>{if(!s.searchQuery.trim())return s.sortedFolders;const w=s.searchQuery.toLowerCase();return s.sortedFolders.filter(x=>x.name.toLowerCase().includes(w))}),l=w=>{g("folder-click",w)},n=w=>{g("edit-folder",w)},_=w=>{g("delete-folder",w)},a=w=>{g("add-documents",w)},m=()=>{g("create-folder")};return(w,x)=>(o(),i("div",Gn,[!t.isLoading&&p.value.length>0?(o(),i("div",Hn,[(o(!0),i(H,null,J(p.value,$=>(o(),G(c(es),{key:$.id,folder:$,onClick:l,onEdit:n,onDelete:_,onAddDocuments:a},null,8,["folder"]))),128))])):!t.isLoading&&t.sortedFolders.length===0?(o(),i("div",Zn,[y(c(me),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Wn,Jn,e("button",{onClick:m,class:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"},[y(c(oe),{class:"w-5 h-5"}),Z(" Crear Primera Carpeta ")])])):!t.isLoading&&t.sortedFolders.length>0&&p.value.length===0?(o(),i("div",Kn,[y(c(me),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Yn,Xn])):I("",!0),t.isLoading?(o(),i("div",ea,sa)):I("",!0)]))}},ra=be(oa,[["__scopeId","data-v-71ba7453"]]),Ze=t=>(fe("data-v-1ea3aed8"),t=t(),ve(),t),na={class:"folder-management"},aa={class:"mb-6"},la={class:"hidden sm:flex justify-between items-center"},ia=Ze(()=>e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),da={class:"sm:hidden"},ca=Ze(()=>e("div",{class:"text-center mb-4"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1 px-2"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),ua={__name:"FolderManagement",props:{searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","navigate-to-main"],setup(t,{emit:r}){const s=t,g=r,p=Pe(),l=se(),n=ne(),_=M(!1),a=M(null),m=M(null),w=M(!1),x=M(null),$=z(()=>p.isLoading),h=z(()=>p.sortedFolders);z(()=>n.currentUser),te(async()=>{await p.init(),await l.init()}),Y(()=>s.searchQuery,()=>{}),Y(()=>p.folders,U=>{var S,P;if(m.value&&U&&U.length>0){const q=U.find(V=>V.id===m.value.id);if(q){const V=((S=m.value.documents)==null?void 0:S.length)||0,B=((P=q.documents)==null?void 0:P.length)||0;JSON.stringify(m.value)!==JSON.stringify(q)&&(m.value={...q},console.log(`🔄 FolderManagement: Synced selectedFolder "${q.name}" with store. Documents: ${V} → ${B}`))}}},{deep:!0});const u=()=>{a.value=null,_.value=!0},f=U=>{a.value=U,_.value=!0},b=()=>{_.value=!1,a.value=null},E=()=>{b()},T=U=>{m.value=U},d=()=>{m.value=null},k=async U=>{if(confirm(`¿Estás seguro de que quieres eliminar la carpeta "${U.name}"?`))try{await p.deleteFolder(U.id),O(`Carpeta "${U.name}" eliminada correctamente`,"success")}catch(S){O("Error al eliminar la carpeta","error"),console.error("Error deleting folder:",S)}},v=U=>{x.value=U,w.value=!0},C=async(U=!1)=>{if(w.value=!1,x.value=null,U&&m.value)try{await D()}catch(S){console.warn("Error refreshing folder after adding documents:",S)}},D=async()=>{if(m.value)try{await p.fetchFolderById(m.value.id,!0);const U=p.getFolderById(m.value.id);U&&(m.value={...U},console.log("✅ Selected folder refreshed successfully"))}catch(U){throw console.error("❌ Error refreshing selected folder:",U),U}},A=async U=>{var S,P,q;if(!(!x.value||U.length===0))try{const V=x.value.documents.map(K=>K.id).filter(K=>K!=null&&!isNaN(parseInt(K))).map(K=>parseInt(K)),B=U.filter(K=>K!=null&&!isNaN(parseInt(K))).map(K=>parseInt(K)),W=[...new Set([...V,...B])];if(console.log("Current document IDs:",V),console.log("Selected document IDs:",B),console.log("Updated document IDs:",W),W.some(K=>!Number.isInteger(K)||K<=0))throw new Error("IDs de documentos inválidos detectados");await p.updateFolder(x.value.id,{document_ids:W}),await C(!0),O(`${B.length} documento(s) agregado(s) a la carpeta`,"success"),g("navigate-to-main")}catch(V){console.error("Error adding documents to folder:",V),console.error("Error details:",((S=V.response)==null?void 0:S.data)||V.message),(P=V.response)!=null&&P.status?O(`Error al agregar documentos: ${((q=V.response.data)==null?void 0:q.detail)||V.message}`,"error"):O("Error al agregar documentos a la carpeta","error")}},L=async U=>{var S,P,q;if(m.value)try{const V=parseInt(U);if(!Number.isInteger(V)||V<=0)throw new Error("ID de documento inválido");const B=m.value.documents.map(W=>W.id).filter(W=>W!=null&&!isNaN(parseInt(W))).map(W=>parseInt(W)).filter(W=>W!==V);console.log("Removing document ID:",V),console.log("Updated document IDs after removal:",B),await p.updateFolder(m.value.id,{document_ids:B}),O("Documento removido de la carpeta","success"),m.value=null,g("navigate-to-main");try{await p.fetchFolderById(m.value.id,!0);const W=p.getFolderById(m.value.id);W&&(m.value=W),console.log("Folder data refreshed successfully after removal")}catch(W){console.warn("Error refreshing folder data:",W);try{m.value={...m.value,documents:m.value.documents.filter(K=>K.id!==V)},console.log("Applied optimistic removal for document ID:",V)}catch(K){console.warn("Optimistic update failed:",K)}}}catch(V){console.error("Error removing document from folder:",V),console.error("Error details:",((S=V.response)==null?void 0:S.data)||V.message),(P=V.response)!=null&&P.status?O(`Error al remover documento: ${((q=V.response.data)==null?void 0:q.detail)||V.message}`,"error"):O("Error al remover el documento de la carpeta","error")}},Q=U=>{console.log("View document:",U)},j=U=>{console.log("Use document:",U)},N=(U,S)=>{console.log("Document action:",U,S)};return(U,S)=>(o(),i("div",na,[e("div",aa,[e("div",la,[ia,e("button",{onClick:u,class:"inline-flex items-center gap-2 px-4 py-2.5 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md"},[y(c(oe),{class:"w-5 h-5"}),Z(" Nueva Carpeta ")])]),e("div",da,[ca,e("button",{onClick:u,class:"w-full flex items-center justify-center gap-3 px-4 py-4 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium text-base"},[y(c(oe),{class:"w-6 h-6"}),Z(" Nueva Carpeta ")])])]),y(c(ra),{"sorted-folders":h.value,"search-query":t.searchQuery,"is-loading":$.value,onFolderClick:T,onEditFolder:f,onDeleteFolder:k,onAddDocuments:v,onCreateFolder:u},null,8,["sorted-folders","search-query","is-loading"]),y(c(kr),{"is-visible":_.value,"editing-folder":a.value,onClose:b,onSuccess:E},null,8,["is-visible","editing-folder"]),y(c(tn),{folder:m.value,onClose:d,onAddDocuments:v,onRemoveDocument:L,onViewDocument:Q,onUseDocument:j,onDocumentAction:N},null,8,["folder"]),y(c(On),{"is-visible":w.value,folder:x.value,onClose:C,onAddDocuments:A},null,8,["is-visible","folder"])]))}},ma=be(ua,[["__scopeId","data-v-1ea3aed8"]]),We=t=>(fe("data-v-0f6fd44f"),t=t(),ve(),t),ga={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},ha={key:1,class:"mt-6 flex flex-col items-center justify-center text-center text-gray-500 w-full p-8 rounded-xl"},pa=We(()=>e("p",{class:"text-lg font-semibold mb-2"}," No hay documentos disponibles para mostrar. ",-1)),fa=We(()=>e("p",{class:"text-sm"}," Contacta a tu abogado para gestionar tus documentos. ",-1)),va=[pa,fa],ba={__name:"DocumentListClient",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null}},setup(t){const r=se(),s=ne(),{registerView:g}=mt(),p=z(()=>s.getCurrentUser),l=M([]),n=M(!1);s.userSignature;const _=z(()=>{if(a.promptDocuments)return null;const u=r.lastUpdatedDocumentId,f=localStorage.getItem("lastUpdatedDocumentId");return u&&m.value.some(E=>String(E.id)===String(u))?u:f&&m.value.some(T=>String(T.id)===String(f))?f:null}),a=t;te(async()=>{if(await s.init(),await r.init(),a.promptDocuments)return;await r.init(),await w();const u=localStorage.getItem("lastUpdatedDocumentId");u&&!r.lastUpdatedDocumentId&&(r.lastUpdatedDocumentId=u),r.lastUpdatedDocumentId&&m.value.some(f=>String(f.id)===String(r.lastUpdatedDocumentId))}),Y(()=>r.lastUpdatedDocumentId,u=>{a.promptDocuments||u&&localStorage.setItem("lastUpdatedDocumentId",u)});const m=z(()=>{var T,d;if(a.promptDocuments){const k=(T=p.value)==null?void 0:T.id;let v=a.promptDocuments.filter(C=>{const D=C.assigned_to?String(C.assigned_to):null,A=String(k);return D===A&&(C.state==="Progress"||C.state==="Completed")});if(a.searchQuery){const C=a.searchQuery.toLowerCase();v=v.filter(D=>{var A,L,Q,j,N,U,S,P;return D.title.toLowerCase().includes(C)||D.state.toLowerCase().includes(C)||D.assigned_to&&s&&(((L=(A=s.userById(D.assigned_to))==null?void 0:A.first_name)==null?void 0:L.toLowerCase().includes(C))||((j=(Q=s.userById(D.assigned_to))==null?void 0:Q.last_name)==null?void 0:j.toLowerCase().includes(C))||((U=(N=s.userById(D.assigned_to))==null?void 0:N.email)==null?void 0:U.toLowerCase().includes(C))||((P=(S=s.userById(D.assigned_to))==null?void 0:S.identification)==null?void 0:P.toLowerCase().includes(C)))})}if(a.selectedTags&&a.selectedTags.length>0){const C=a.selectedTags.map(D=>D.id);v=v.filter(D=>!D.tags||D.tags.length===0?!1:D.tags.some(A=>C.includes(A.id)))}return v}const u=r.progressAndCompletedDocumentsByClient((d=p.value)==null?void 0:d.id),f=a.selectedTags?a.selectedTags.map(k=>k.id):[];return r.filteredDocumentsBySearchAndTags(a.searchQuery,s,f).filter(k=>u.some(v=>String(v.id)===String(k.id)))}),w=async()=>{n.value=!0;try{const u=s.currentUser.id;if(!u)return;const f=await xe(`dynamic-documents/user/${u}/pending-documents-full/`);l.value=f.data}catch(u){console.error("Error fetching documents:",u),u.response&&console.error("Error details:",u.response.data),await O("Error al cargar documentos","error"),l.value=[]}finally{n.value=!1}},x=async u=>{await g("document",u.id),Oe(u)};Y(m,u=>{if(!a.promptDocuments&&r.lastUpdatedDocumentId&&!u.some(b=>String(b.id)===String(r.lastUpdatedDocumentId))&&u.length>0){const E=[...u].sort((T,d)=>d.id-T.id)[0].id;r.lastUpdatedDocumentId=E,localStorage.setItem("lastUpdatedDocumentId",E)}});const $=u=>{u&&(r.lastUpdatedDocumentId=u,localStorage.setItem("lastUpdatedDocumentId",u),setTimeout(()=>{try{const f=document.querySelectorAll(`[data-document-id="${u}"]`);if(f.length>0){const b=f[0];b.style.border="3px solid #3b82f6",b.classList.remove("animate-pulse-highlight"),b.classList.remove("border-secondary"),b.classList.remove("shadow-md"),b.offsetWidth,b.classList.add("animate-pulse-highlight"),b.classList.add("border-secondary"),b.classList.add("shadow-md"),b.scrollIntoView({behavior:"smooth",block:"center"})}}catch(f){console.error("Error forcing highlight:",f)}},100))};window.forceDocumentHighlight=$;const h=async()=>{await r.init(!0)};return(u,f)=>(o(),i(H,null,[m.value.length>0?(o(),i("div",ga,[(o(!0),i(H,null,J(m.value,b=>(o(),G(c(he),{key:b.id,document:b,"card-type":"client","card-context":"list","highlighted-doc-id":_.value,"status-icon":b.state==="Completed"?c(Le):c(Me),"status-text":b.state==="Completed"?"Completado":"En Progreso","status-badge-classes":b.state==="Completed"?"bg-green-100 text-green-700 border border-green-200":"bg-blue-100 text-blue-700 border border-blue-200","document-store":c(r),"user-store":c(s),"prompt-documents":a.promptDocuments,"edit-modal-component":"UseDocumentByClient",onClick:x,onRefresh:h},null,8,["document","highlighted-doc-id","status-icon","status-text","status-badge-classes","document-store","user-store","prompt-documents"]))),128))])):I("",!0),m.value.length===0?(o(),i("div",ha,va)):I("",!0),y(Ue,{isVisible:c(ce),documentData:c(Ee),onClose:f[0]||(f[0]=b=>ce.value=!1)},null,8,["isVisible","documentData"])],64))}},ya=be(ba,[["__scopeId","data-v-0f6fd44f"]]),xa={class:"mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},_a={__name:"UseDocument",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},setup(t){const r=se(),s=ne(),g=t,p=z(()=>{const n=r.publishedDocumentsUnassigned,_=g.selectedTags?g.selectedTags.map(m=>m.id):[];return r.filteredDocumentsBySearchAndTags(g.searchQuery,s,_).filter(m=>n.some(w=>w.id===m.id))});s.userSignature;function l(n){n&&n.updatedDocId&&(r.lastUpdatedDocumentId=n.updatedDocId,localStorage.setItem("lastUpdatedDocumentId",n.updatedDocId))}return(n,_)=>(o(),i(H,null,[e("div",xa,[(o(!0),i(H,null,J(p.value,a=>(o(),G(c(je),{key:a.id,document:a,"show-menu-options":!0,onDocumentCreated:l},null,8,["document"]))),128))]),y(Ue,{isVisible:c(ce),documentData:c(Ee),onClose:_[0]||(_[0]=a=>ce.value=!1)},null,8,["isVisible","documentData"])],64))}},le=t=>(fe("data-v-71135d5a"),t=t(),ve(),t),wa={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},$a={key:0,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},ka=le(()=>e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1)),Da=le(()=>e("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)),Ca=[ka,Da],Sa={key:1,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ia=le(()=>e("path",{d:"M20 6L9 17l-5-5"},null,-1)),Fa=[Ia],Ea={key:2,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ta=le(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),La=[Ta],Ua={key:3,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ma=le(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),Aa=[Ma],Ba={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},ja={key:0,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Pa=le(()=>e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1)),Na=le(()=>e("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)),za=[Pa,Na],Va={key:1,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ra=le(()=>e("path",{d:"M20 6L9 17l-5-5"},null,-1)),qa=[Ra],Qa={key:2,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Oa=le(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),Ga=[Oa],Ha={key:3,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Za=le(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),Wa=[Za],Ja={__name:"DocumentListLawyer",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null}},setup(t){const r=se(),s=ne();Ie();const g=M([]),p=M([]),l=t,n=d=>d.state==="Published"||d.state==="FullySigned"?Le:Me,_=d=>{switch(d.state){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return"Desconocido"}},a=d=>{switch(d.state){case"Published":case"FullySigned":return"bg-green-100 text-green-700 border border-green-200";case"Draft":case"Progress":return"bg-blue-100 text-blue-700 border border-blue-200";case"PendingSignatures":return"bg-yellow-100 text-yellow-700 border border-yellow-200";case"Completed":return"bg-purple-100 text-purple-700 border border-purple-200";default:return"bg-gray-100 text-gray-700 border border-gray-200"}},m=d=>{var k,v;return d.fully_signed?"bg-green-100 text-green-700 border border-green-200":(k=f(d))!=null&&k.signed&&!d.fully_signed?"bg-blue-100 text-blue-700 border border-blue-200":f(d)&&!((v=f(d))!=null&&v.signed)?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200"},w=z(()=>{if(l.promptDocuments)return[];const k=(r.getDocumentsByLawyerId(s.currentUser.id)||[]).filter(D=>D.state!=="FullySigned"),v=l.selectedTags?l.selectedTags.map(D=>D.id):[];return r.filteredDocumentsBySearchAndTags(l.searchQuery,s,v).filter(D=>k.some(A=>A.id===D.id))}),x=z(()=>{if(l.promptDocuments&&l.promptDocuments.length>0){let d=l.promptDocuments.filter(k=>k.title&&k.title.toLowerCase().includes((l.searchQuery||"").toLowerCase()));if(l.selectedTags&&l.selectedTags.length>0){const k=l.selectedTags.map(v=>v.id);d=d.filter(v=>!v.tags||v.tags.length===0?!1:v.tags.some(C=>k.includes(C.id)))}return d}return[]}),$=z(()=>l.promptDocuments?x.value:w.value),h=z(()=>{if(l.promptDocuments)return null;const d=r.lastUpdatedDocumentId,k=localStorage.getItem("lastUpdatedDocumentId"),v=[...w.value];return d&&v.some(A=>String(A.id)===String(d))?d:k&&v.some(A=>String(A.id)===String(k))?k:null}),u=async()=>{try{const d=s.currentUser.id,k=await xe(`dynamic-documents/user/${d}/pending-documents-full/`),v=await xe(`dynamic-documents/user/${d}/signed-documents/`);k.status===200&&(g.value=k.data),v.status===200&&(p.value=v.data)}catch(d){console.error("Error fetching lawyer documents:",d),d.response&&(console.error("Error response data:",d.response.data),console.error("Error status:",d.response.status))}},f=d=>{if(!d.signatures||!d.requires_signature)return null;const k=String(s.currentUser.id);return d.signatures.find(v=>String(v.signer_id)===k)},b=d=>{if(!d.requires_signature)return"";if(d.fully_signed)return"Documento formalizado";const k=f(d);if(d.signatures&&d.signatures.length>0){const v=d.signatures.length,C=d.signatures.filter(D=>D.signed).length;if(k&&k.signed){if(C===1&&v>1)return`Has firmado. Faltan ${v-C} firmas más`;if(C<v)return`Has firmado. Faltan ${v-C} firmas más`}return`Firmas: ${C}/${v}`}return k?"Requiere tu firma":"Requiere firmas"};Y($,d=>{if(!l.promptDocuments&&r.lastUpdatedDocumentId&&!d.some(v=>String(v.id)===String(r.lastUpdatedDocumentId))&&d.length>0){const C=[...d].sort((D,A)=>A.id-D.id)[0].id;r.lastUpdatedDocumentId=C,localStorage.setItem("lastUpdatedDocumentId",C)}});const E=d=>{d&&setTimeout(()=>{try{const k=document.querySelectorAll(`[data-document-id="${d}"]`);if(k.length>0){const v=k[0];v.classList.remove("animate-pulse-highlight-green","animate-pulse-highlight-blue"),v.offsetWidth,(v.querySelector("[data-document-id]")||v).classList.contains("border-green-400")?v.classList.add("animate-pulse-highlight-green"):v.classList.add("animate-pulse-highlight-blue"),v.scrollIntoView({behavior:"smooth",block:"center"})}}catch(k){console.error("Error forcing highlight:",k)}},100)};window.forceDocumentHighlight=E,te(async()=>{if(l.promptDocuments)return;await r.init();const d=localStorage.getItem("lastUpdatedDocumentId");d&&(r.lastUpdatedDocumentId=d,setTimeout(()=>{$.value.some(v=>String(v.id)===String(d))&&E(d)},500)),u()});const T=async()=>{await r.init()};return(d,k)=>(o(),i(H,null,[l.promptDocuments&&x.value.length>0?(o(),i("div",wa,[(o(!0),i(H,null,J(x.value,v=>(o(),G(c(he),{key:v.id,document:v,"card-type":"lawyer","card-context":"prompt","highlighted-doc-id":h.value,"status-icon":n(v),"status-text":_(v),"status-badge-classes":a(v),"document-store":c(r),"user-store":c(s),"prompt-documents":!0,onRefresh:T},{"additional-badges":X(()=>{var C;return[v.requires_signature?(o(),i("div",{key:0,class:R(["inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",m(v)])},[v.fully_signed?(o(),i("svg",$a,Ca)):(C=f(v))!=null&&C.signed?(o(),i("svg",Sa,Fa)):f(v)?(o(),i("svg",Ea,La)):(o(),i("svg",Ua,Aa)),e("span",null,F(v.fully_signed?"Formalizado":b(v)),1)],2)):I("",!0)]}),_:2},1032,["document","highlighted-doc-id","status-icon","status-text","status-badge-classes","document-store","user-store"]))),128))])):l.promptDocuments?I("",!0):(o(),i("div",Ba,[(o(!0),i(H,null,J($.value,v=>(o(),G(c(he),{key:v.id,document:v,"card-type":"lawyer","card-context":"list","highlighted-doc-id":h.value,"status-icon":n(v),"status-text":_(v),"status-badge-classes":a(v),"document-store":c(r),"user-store":c(s),onRefresh:T},{"additional-badges":X(()=>{var C;return[v.requires_signature?(o(),i("div",{key:0,class:R(["inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",m(v)])},[v.fully_signed?(o(),i("svg",ja,za)):(C=f(v))!=null&&C.signed?(o(),i("svg",Va,qa)):f(v)?(o(),i("svg",Qa,Ga)):(o(),i("svg",Ha,Wa)),e("span",null,F(v.fully_signed?"Formalizado":b(v)),1)],2)):I("",!0)]}),_:2},1032,["document","highlighted-doc-id","status-icon","status-text","status-badge-classes","document-store","user-store"]))),128))])),y(Ue,{isVisible:c(ce),documentData:c(Ee),onClose:k[0]||(k[0]=v=>ce.value=!1)},null,8,["isVisible","documentData"])],64))}},Ka=be(Ja,[["__scopeId","data-v-71135d5a"]]),Ya={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},Xa={__name:"DocumentFinishedByClientList",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(t,{emit:r}){const s=se(),g=ne();te(()=>{s.init(),g.init()});const p=t,l=z(()=>{const n=s.completedDocumentsByClient,_=p.selectedTags?p.selectedTags.map(m=>m.id):[];return s.filteredDocumentsBySearchAndTags(p.searchQuery,g,_).filter(m=>n.some(w=>w.id===m.id))});return g.userSignature,(n,_)=>(o(),i("div",Ya,[(o(!0),i(H,null,J(l.value,a=>(o(),G(c(he),{key:a.id,document:a,"card-type":"lawyer","card-context":"finished","highlighted-doc-id":null,"status-icon":c(Le),"status-text":"Completado","status-badge-classes":"bg-green-100 text-green-700 border border-green-200","document-store":c(s),"user-store":c(g),"edit-route":`/dynamic_document_dashboard/document/use/editor/${a.id}/${encodeURIComponent(a.title.trim())}`,onRefresh:_[0]||(_[0]=m=>n.$emit("refresh"))},null,8,["document","status-icon","document-store","user-store","edit-route"]))),128))]))}},el={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4"},tl={__name:"DocumentInProgressByClientList",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(t,{emit:r}){const s=se(),g=ne();te(()=>{s.init(),g.init()});const p=t,l=z(()=>{const n=s.progressDocumentsByClient,_=p.selectedTags?p.selectedTags.map(m=>m.id):[];return s.filteredDocumentsBySearchAndTags(p.searchQuery,g,_).filter(m=>n.some(w=>w.id===m.id))});return g.userSignature,(n,_)=>(o(),i("div",el,[(o(!0),i(H,null,J(l.value,a=>(o(),G(c(he),{key:a.id,document:a,"card-type":"lawyer","card-context":"progress","highlighted-doc-id":null,"status-icon":c(Me),"status-text":"En Progreso","status-badge-classes":"bg-blue-100 text-blue-700 border border-blue-200","document-store":c(s),"user-store":c(g),"edit-route":`/dynamic_document_dashboard/document/use/editor/${a.id}/${encodeURIComponent(a.title.trim())}`,onRefresh:_[0]||(_[0]=m=>n.$emit("refresh"))},null,8,["document","status-icon","document-store","user-store","edit-route"]))),128))]))}},sl={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},ol={class:"flex justify-end"},rl=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[Z(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),nl={class:"mt-2"},al={class:"flex gap-2 mt-2.5"},ll=["disabled"],il=e("span",null,"Actualizar nombre",-1),dl=[il],cl=["disabled"],ul={__name:"CreateDocumentByLawyer",emits:["close"],setup(t,{emit:r}){const s=Ie(),g=se(),p=r,l=M(""),n=M("");Re(()=>{var h;(h=g.selectedDocument)!=null&&h.title?(l.value=g.selectedDocument.title,n.value=g.selectedDocument.title):(l.value="",n.value="")});const _=h=>{h.key==="Escape"&&p("close")};te(()=>{document.addEventListener("keydown",_)}),pe(()=>{document.removeEventListener("keydown",_)});const a=z(()=>l.value.trim().length>0),m=z(()=>{var h;return!!((h=g.selectedDocument)!=null&&h.id)}),w=z(()=>m.value&&l.value.trim()!==n.value.trim()&&l.value.trim().length>0);async function x(){if(m.value&&w.value)try{const h={title:l.value.trim()};await g.updateDocument(g.selectedDocument.id,h),n.value=l.value.trim(),g.selectedDocument.title=l.value.trim(),g.lastUpdatedDocumentId=g.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",g.selectedDocument.id);const u=g.selectedDocument.id;p("close",{updatedDocId:u});const f=window.location.pathname;f==="/dynamic_document_dashboard"||f==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(u)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(h){console.error("Error updating document name:",h)}}const $=async()=>{if(!a.value)return;const h=encodeURIComponent(l.value.trim());m.value?(g.selectedDocument.title=l.value,g.selectedDocument.id&&(g.lastUpdatedDocumentId=g.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",g.selectedDocument.id.toString())),s.push(`/dynamic_document_dashboard/lawyer/editor/edit/${g.selectedDocument.id}`)):(g.selectedDocument={title:l.value.trim()},s.push(`/dynamic_document_dashboard/lawyer/editor/create/${h}`))};return(h,u)=>(o(),i("div",sl,[e("div",ol,[e("button",{onClick:u[0]||(u[0]=f=>p("close"))},[y(c(re),{class:"size-6"})])]),e("form",{onSubmit:ue($,["prevent"])},[e("div",null,[rl,e("div",nl,[ae(e("input",{"onUpdate:modelValue":u[1]||(u[1]=f=>l.value=f),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[Fe,l.value]])])]),e("div",al,[m.value?(o(),i("button",{key:0,type:"button",onClick:x,disabled:!w.value,class:R(["p-2.5 text-sm font-medium rounded-md flex gap-2",w.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},dl,10,ll)):I("",!0),e("button",{type:"submit",class:R(["p-2.5 text-sm font-medium rounded-md flex gap-2",a.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!a.value},[e("span",null,F(m.value?"Editar Documento":"Continuar"),1)],10,cl)])],32)]))}},ml={class:"p-4 sm:p-6 lg:p-10 lg:px-8"},gl={key:0,class:"mt-6"},hl={class:"mb-6 border-b border-gray-200"},pl={class:"-mb-px hidden md:flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},fl=["onClick"],vl={class:"md:hidden relative"},bl=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),yl=[bl],xl={class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},_l=["onClick"],wl={class:"mb-6"},$l={key:0},kl={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-3 sm:gap-4"},Dl={key:2,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-3 sm:gap-4"},Cl={key:3},Sl={key:4},Il={key:5,class:"mt-6 text-center text-gray-400 font-regular"},Fl=e("p",null,"No hay documentos disponibles para mostrar.",-1),El=[Fl],Tl={key:1,class:"mt-6"},Ll={key:0,class:"mb-6 border-b border-gray-200"},Ul={class:"-mb-px hidden md:flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},Ml=["onClick"],Al={class:"md:hidden relative"},Bl=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),jl=[Bl],Pl={class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},Nl=["onClick"],zl={key:1,class:"mb-6"},Vl={class:"p-4 sm:p-6"},Rl={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},ql={class:"flex justify-between items-center p-4 border-b"},Ql=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),Ol={class:"p-4 sm:p-6"},gi={__name:"Dashboard",setup(t){const r=ne(),s=se(),g=Pe(),p=Ie(),l=M(""),n=M("default"),_=M(!1),a=M("folders"),m=M("legal-documents"),w=M(!1),x=M([]),$=z(()=>r.currentUser),h=z(()=>$.value?$.value.role:(console.log("Current user is null, redirecting to login..."),p.push("/login"),null)),u=z(()=>{let S=[];h.value==="lawyer"?S=s.draftAndPublishedDocumentsUnassigned:h.value==="client"&&(S=s.progressAndCompletedDocumentsByClient($.value.id));const P=x.value.map(q=>q.id);return s.filteredDocumentsBySearchAndTags(l.value,r,P).filter(q=>S.some(V=>V.id===q.id))}),f=S=>{n.value=S,s.selectedDocument=null},b=()=>{_.value=!1,n.value="default",s.selectedDocument=null},E=async()=>{await s.init(!0)},T=S=>{console.log("Global letterhead uploaded:",S)},d=()=>{console.log("Global letterhead deleted")},k=async()=>{a.value="folders";try{await new Promise(S=>setTimeout(S,100)),await g.fetchFolders(!0),console.log("📂 Dashboard: Refreshed folders after navigate-to-main")}catch(S){console.warn("Error refreshing folders on navigate-to-main:",S)}};Y(()=>s.lastUpdatedDocumentId,(S,P)=>{if(S&&S!==P&&n.value==="default"){const q=Date.now();(!Y.lastExecutionTime||q-Y.lastExecutionTime>100)&&(Y.lastExecutionTime=q,n.value="default")}},{immediate:!1});const v=[{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Dcs. Firmados"}],C=[{name:"legal-documents",label:"Minutas"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"finished-documents",label:"Dcs. Clientes"},{name:"in-progress-documents",label:"Dcs. Clientes en Progreso"}],D=M(!1),A=M(!1),L=()=>{D.value=!1,A.value=!1},Q=S=>{const P=document.querySelectorAll(".relative");let q=!1;P.forEach(V=>{V.contains(S.target)&&(q=!0)}),q||L()},j=S=>{m.value=S,D.value=!1},N=S=>{a.value=S,A.value=!1};te(async()=>{await r.init(),await s.init(),await g.init(),s.selectedDocument=null,n.value="default";const S=localStorage.getItem("lastUpdatedDocumentId");S&&s.documents.some(q=>q.id.toString()===S)&&(s.lastUpdatedDocumentId=parseInt(S)),document.addEventListener("click",Q)}),pe(()=>{document.removeEventListener("click",Q)});const U=async S=>{await r.getUserInfo(),r.currentUser&&(r.currentUser.has_signature=!0),showNotification("Firma electrónica guardada correctamente","success"),setTimeout(()=>{w.value=!1},500)};return(S,P)=>{var q,V;return o(),i(H,null,[y(rt,{"onUpdate:searchQuery":P[0]||(P[0]=B=>l.value=B)},{default:X(()=>[qe(S.$slots,"default")]),_:3}),e("div",ml,[y(Co,{onOpenNewDocument:P[1]||(P[1]=B=>_.value=!0),onUpdateCurrentSection:f,onGlobalLetterheadUploaded:T,onGlobalLetterheadDeleted:d,role:h.value},null,8,["role"]),h.value==="lawyer"?(o(),i("div",gl,[e("div",hl,[e("nav",pl,[(o(),i(H,null,J(C,B=>e("button",{key:B.name,onClick:W=>m.value=B.name,class:R([m.value===B.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},F(B.label),11,fl)),64))]),e("div",vl,[e("button",{onClick:P[2]||(P[2]=B=>D.value=!D.value),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,F(((q=C.find(B=>B.name===m.value))==null?void 0:q.label)||"Seleccionar sección"),1),(o(),i("svg",{class:R(["ml-2 h-5 w-5 transition-transform duration-200",D.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},yl,2))]),ae(e("div",xl,[(o(),i(H,null,J(C,B=>e("button",{key:B.name,onClick:W=>j(B.name),class:R(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",m.value===B.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},F(B.label),11,_l)),64))],512),[[ye,D.value]])])]),e("div",wl,[y(Be,{modelValue:x.value,"onUpdate:modelValue":P[3]||(P[3]=B=>x.value=B)},null,8,["modelValue"])]),m.value==="legal-documents"?(o(),i("div",$l,[y(Ka,{searchQuery:l.value,selectedTags:x.value},null,8,["searchQuery","selectedTags"])])):I("",!0),m.value==="pending-signatures"?(o(),i("div",kl,[y(Se,{state:"PendingSignatures",searchQuery:l.value,selectedTags:x.value},null,8,["searchQuery","selectedTags"])])):I("",!0),m.value==="signed-documents"?(o(),i("div",Dl,[y(Se,{state:"FullySigned",searchQuery:l.value,selectedTags:x.value},null,8,["searchQuery","selectedTags"])])):I("",!0),m.value==="finished-documents"?(o(),i("div",Cl,[y(Xa,{searchQuery:l.value,selectedTags:x.value},null,8,["searchQuery","selectedTags"])])):I("",!0),m.value==="in-progress-documents"?(o(),i("div",Sl,[y(tl,{searchQuery:l.value,selectedTags:x.value},null,8,["searchQuery","selectedTags"])])):I("",!0),u.value.length===0?(o(),i("div",Il,El)):I("",!0)])):I("",!0),h.value==="client"?(o(),i("div",Tl,[n.value!=="useDocument"?(o(),i("div",Ll,[e("nav",Ul,[(o(),i(H,null,J(v,B=>e("button",{key:B.name,onClick:W=>a.value=B.name,class:R([a.value===B.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},F(B.label),11,Ml)),64))]),e("div",Al,[e("button",{onClick:P[4]||(P[4]=B=>A.value=!A.value),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,F(((V=v.find(B=>B.name===a.value))==null?void 0:V.label)||"Seleccionar sección"),1),(o(),i("svg",{class:R(["ml-2 h-5 w-5 transition-transform duration-200",A.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},jl,2))]),ae(e("div",Pl,[(o(),i(H,null,J(v,B=>e("button",{key:B.name,onClick:W=>N(B.name),class:R(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",a.value===B.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},F(B.label),11,Nl)),64))],512),[[ye,A.value]])])])):I("",!0),a.value!=="folders"?(o(),i("div",zl,[y(Be,{modelValue:x.value,"onUpdate:modelValue":P[5]||(P[5]=B=>x.value=B)},null,8,["modelValue"])])):I("",!0),n.value==="useDocument"?(o(),G(_a,{key:2,searchQuery:l.value,selectedTags:x.value},null,8,["searchQuery","selectedTags"])):(o(),i("div",{key:3,class:R(["grid gap-3 sm:gap-4",{"grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3":a.value!="my-documents"&&a.value!="folders"}])},[a.value==="pending-signatures"?(o(),G(Se,{key:0,state:"PendingSignatures",searchQuery:l.value,selectedTags:x.value,onRefresh:E},null,8,["searchQuery","selectedTags"])):I("",!0),a.value==="my-documents"?(o(),G(ya,{key:1,searchQuery:l.value,selectedTags:x.value},null,8,["searchQuery","selectedTags"])):I("",!0),a.value==="folders"?(o(),G(ma,{key:2,searchQuery:l.value,selectedTags:x.value,onRefresh:E,onNavigateToMain:k},null,8,["searchQuery","selectedTags"])):I("",!0),a.value==="signed-documents"?(o(),G(Se,{key:3,state:"FullySigned",searchQuery:l.value,selectedTags:x.value},null,8,["searchQuery","selectedTags"])):I("",!0)],2))])):I("",!0)]),ae(y(de,null,{default:X(()=>[y(ul,{onClose:b})]),_:1},512),[[ye,_.value]]),w.value?(o(),G(de,{key:0},{default:X(()=>[e("div",Vl,[e("div",Rl,[e("div",ql,[Ql,e("button",{onClick:P[6]||(P[6]=B=>w.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[y(c(re),{class:"h-6 w-6"})])]),e("div",Ol,[y(Qe,{"user-id":$.value.id,"initial-show-options":!$.value.has_signature,onSignatureSaved:U,onCancel:P[7]||(P[7]=B=>w.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):I("",!0),y(Ue,{isVisible:c(ce),documentData:c(Ee),onClose:P[8]||(P[8]=B=>ce.value=!1)},null,8,["isVisible","documentData"])],64)}}};export{gi as default};
