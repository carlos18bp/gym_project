import{e as a,f as r,g as e,C as Ve,aX as Qe,E as re,D as X,$ as Te,a0 as Se,r as R,c as D,T as te,W as qe,k as G,i as N,h as u,j as c,aY as fe,aZ as se,a_ as he,a$ as ve,p as y,G as ce,t as l,m as be,w as F,v as ae,l as q,J,aW as ke,b0 as pe,s as j,O as Ce,P as Re,b1 as Ye,F as Z,N as Q,n as T,aU as ye,a7 as Ge,b2 as et,S as ue,ag as mt,x as xe,a5 as tt,z as Ue,o as we,I as Le,u as Be,aV as De,ab as gt,a9 as ft}from"./index.js";import{_ as Me}from"./_plugin-vue_export-helper.js";import{r as $e,a as st}from"./LinkIcon.js";import{r as Ie}from"./PhotoIcon.js";import{r as me}from"./InformationCircleIcon.js";import{r as le}from"./CalendarIcon.js";import{r as je}from"./EyeIcon.js";import{r as ot,a as at,b as ht}from"./TagIcon.js";import{r as vt,a as pt}from"./EllipsisVerticalIcon.js";import{r as it}from"./PencilIcon.js";import{r as _t}from"./TrashIcon.js";import{r as Fe}from"./DocumentIcon.js";import{r as bt}from"./ExclamationTriangleIcon.js";import{r as _e}from"./PlusIcon.js";import{r as Xe}from"./ArrowLeftIcon.js";import{r as yt}from"./ArrowDownTrayIcon.js";function xt(t,o){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75"})])}function Oe(t,o){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})])}function He(t,o){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"})])}function Ee(t,o){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"})])}function We(t,o){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"})])}function Ne(t,o){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"})])}function wt(t,o){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"})])}function nt(t,o){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}function $t(t,o){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"})])}function rt(t,o){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"})])}function zt(t,o){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})])}const ge=Ve("organizations",{state:()=>({organizations:[],currentOrganization:null,myMemberships:[],invitations:[],myInvitations:[],organizationMembers:[],isLoading:!1,isLoadingInvitations:!1,isLoadingMembers:!1,pagination:{count:0,next:null,previous:null,currentPage:1,pageSize:10},organizationStats:{total_organizations:0,total_members:0,total_pending_invitations:0,recent_requests_count:0,active_organizations_count:0,organizations_by_status:{},recent_invitations_count:0},dataLoaded:!1,lastFetchTime:null}),getters:{organizationById:t=>o=>t.organizations.find(s=>s.id===o),activeOrganizations:t=>t.organizations.filter(o=>o.is_active),pendingInvitations:t=>t.myInvitations.filter(o=>o.status==="PENDING"),canRespondToInvitation:t=>o=>{const s=t.myInvitations.find(n=>n.id===o);return s&&s.can_be_responded&&!s.is_expired}},actions:{async createOrganization(t){try{if(this.isLoading=!0,t.profile_image||t.cover_image){const o=new FormData;Object.keys(t).forEach(n=>{n!=="profile_image"&&n!=="cover_image"&&t[n]!==null&&o.append(n,t[n])}),t.profile_image&&o.append("profile_image",t.profile_image),t.cover_image&&o.append("cover_image",t.cover_image);const s=await Qe("organizations/create/",o);if(s.status===201){const n=s.data.organization;return this.organizations.unshift(n),this.currentOrganization=n,s.data}}else{const o=await re("organizations/create/",t);if(o.status===201){const s=o.data.organization;return this.organizations.unshift(s),this.currentOrganization=s,o.data}}throw new Error("Error creating organization")}catch(o){throw console.error("Error creating organization:",o),o}finally{this.isLoading=!1}},async getMyOrganizations(t={}){try{this.isLoading=!0;const o=new URLSearchParams;Object.keys(t).forEach(d=>{t[d]!==null&&t[d]!==void 0&&t[d]!==""&&o.append(d,t[d])});const s=`organizations/my-organizations/${o.toString()?"?"+o.toString():""}`;console.log("Making request to URL:",s);const n=await X(s);if(n.status===200)return this.organizations=n.data.results,this.pagination={count:n.data.count,next:n.data.next,previous:n.data.previous,currentPage:t.page||1,pageSize:t.page_size||10},this.dataLoaded=!0,this.lastFetchTime=new Date().toISOString(),n.data;throw new Error("Error fetching organizations")}catch(o){throw console.error("Error fetching organizations:",o),o}finally{this.isLoading=!1}},async getOrganizationDetail(t){try{this.isLoading=!0;const o=await X(`organizations/${t}/`);if(o.status===200){this.currentOrganization=o.data;const s=this.organizations.findIndex(n=>n.id===t);return s>=0&&(this.organizations[s]=o.data),o.data}throw new Error("Organization not found")}catch(o){throw console.error("Error fetching organization detail:",o),o}finally{this.isLoading=!1}},async updateOrganization(t,o){try{if(this.isLoading=!0,o.profile_image||o.cover_image){const s=new FormData;Object.keys(o).forEach(d=>{d!=="profile_image"&&d!=="cover_image"&&o[d]!==null&&s.append(d,o[d])}),o.profile_image&&s.append("profile_image",o.profile_image),o.cover_image&&s.append("cover_image",o.cover_image);const n=await Qe(`organizations/${t}/update/`,s);if(n.status===200){const d=n.data.organization;return this._updateOrganizationInState(t,d),n.data}}else{const s=await Te(`organizations/${t}/update/`,o);if(s.status===200){const n=s.data.organization;return this._updateOrganizationInState(t,n),s.data}}throw new Error("Error updating organization")}catch(s){throw console.error("Error updating organization:",s),s}finally{this.isLoading=!1}},async deleteOrganization(t){try{this.isLoading=!0;const o=await Se(`organizations/${t}/delete/`);if(o.status===200)return this.organizations=this.organizations.filter(s=>s.id!==t),this.currentOrganization&&this.currentOrganization.id===t&&(this.currentOrganization=null),o.data;throw new Error("Error deleting organization")}catch(o){throw console.error("Error deleting organization:",o),o}finally{this.isLoading=!1}},async sendInvitation(t,o){try{this.isLoadingInvitations=!0;const s=await re(`organizations/${t}/invitations/send/`,o);if(s.status===201){const n=s.data.invitation;return this.invitations.unshift(n),s.data}throw new Error("Error sending invitation")}catch(s){throw console.error("Error sending invitation:",s),s}finally{this.isLoadingInvitations=!1}},async getOrganizationInvitations(t,o={}){try{this.isLoadingInvitations=!0;const s=new URLSearchParams;Object.keys(o).forEach(i=>{o[i]!==null&&o[i]!==void 0&&o[i]!==""&&s.append(i,o[i])});const n=`organizations/${t}/invitations/${s.toString()?"?"+s.toString():""}`,d=await X(n);if(d.status===200)return this.invitations=d.data,d.data;throw new Error("Error fetching invitations")}catch(s){throw console.error("Error fetching invitations:",s),s}finally{this.isLoadingInvitations=!1}},async cancelInvitation(t,o){try{this.isLoadingInvitations=!0;const s=await Se(`organizations/${t}/invitations/${o}/cancel/`);if(s.status===200)return this.invitations=this.invitations.filter(n=>n.id!==o),s.data;throw new Error("Error canceling invitation")}catch(s){throw console.error("Error canceling invitation:",s),s}finally{this.isLoadingInvitations=!1}},async getMyInvitations(t={}){try{this.isLoadingInvitations=!0;const o=new URLSearchParams;Object.keys(t).forEach(d=>{t[d]!==null&&t[d]!==void 0&&t[d]!==""&&o.append(d,t[d])});const s=`invitations/my-invitations/${o.toString()?"?"+o.toString():""}`,n=await X(s);if(n.status===200)return this.myInvitations=n.data.results,this.pagination={count:n.data.count,next:n.data.next,previous:n.data.previous,currentPage:t.page||1,pageSize:t.page_size||10},n.data;throw new Error("Error fetching my invitations")}catch(o){throw console.error("Error fetching my invitations:",o),o}finally{this.isLoadingInvitations=!1}},async respondToInvitation(t,o){try{this.isLoadingInvitations=!0;const s=await re(`invitations/${t}/respond/`,{action:o});if(s.status===200){const n=this.myInvitations.findIndex(d=>d.id===t);return n>=0&&(this.myInvitations[n]=s.data.invitation),o==="accept"&&await this.getMyMemberships(),s.data}throw new Error("Error responding to invitation")}catch(s){throw console.error("Error responding to invitation:",s),s}finally{this.isLoadingInvitations=!1}},async getMyMemberships(){try{this.isLoading=!0;const t=await X("organizations/my-memberships/");if(t.status===200)return this.myMemberships=t.data.organizations,t.data;throw new Error("Error fetching memberships")}catch(t){throw console.error("Error fetching memberships:",t),t}finally{this.isLoading=!1}},async leaveOrganization(t){try{this.isLoading=!0;const o=await re(`organizations/${t}/leave/`,{});if(o.status===200)return this.myMemberships=this.myMemberships.filter(s=>s.id!==t),o.data;throw new Error("Error leaving organization")}catch(o){throw console.error("Error leaving organization:",o),o}finally{this.isLoading=!1}},async getOrganizationMembers(t,o={}){try{this.isLoadingMembers=!0;const s=new URLSearchParams;Object.keys(o).forEach(i=>{o[i]!==null&&o[i]!==void 0&&o[i]!==""&&s.append(i,o[i])});const n=`organizations/${t}/members/${s.toString()?"?"+s.toString():""}`,d=await X(n);if(d.status===200)return this.organizationMembers=d.data.members||[],d.data.members||[];throw new Error("Error fetching members")}catch(s){throw console.error("Error fetching members:",s),s}finally{this.isLoadingMembers=!1}},async removeMember(t,o){try{this.isLoadingMembers=!0;const s=await Se(`organizations/${t}/members/${o}/remove/`);if(s.status===200)return this.organizationMembers=this.organizationMembers.filter(n=>n.id!==o),s.data;throw new Error("Error removing member")}catch(s){throw console.error("Error removing member:",s),s}finally{this.isLoadingMembers=!1}},async getOrganizationStats(){try{this.isLoading=!0;const t=await X("organizations/stats/");if(t.status===200)return this.organizationStats=t.data,t.data;throw new Error("Error fetching statistics")}catch(t){throw console.error("Error fetching statistics:",t),t}finally{this.isLoading=!1}},async getOrganizationPublicInfo(t){try{this.isLoading=!0;const o=await X(`organizations/${t}/public/`);if(o.status===200)return o.data;throw new Error("Error fetching public organization info")}catch(o){throw console.error("Error fetching public organization info:",o),o}finally{this.isLoading=!1}},clearAll(){this.organizations=[],this.currentOrganization=null,this.myMemberships=[],this.invitations=[],this.myInvitations=[],this.organizationMembers=[],this.organizationStats={total_organizations:0,total_members:0,total_pending_invitations:0,recent_requests_count:0,active_organizations_count:0,organizations_by_status:{},recent_invitations_count:0},this.dataLoaded=!1,this.lastFetchTime=null},_updateOrganizationInState(t,o){const s=this.organizations.findIndex(d=>d.id===t);s>=0&&(this.organizations[s]=o),this.currentOrganization&&this.currentOrganization.id===t&&(this.currentOrganization=o);const n=this.myMemberships.findIndex(d=>d.id===t);n>=0&&(this.myMemberships[n]=o)}}}),Ae=Ve("corporateRequests",{state:()=>({myRequests:[],receivedRequests:[],currentRequest:null,availableOrganizations:[],requestTypes:[],requestResponses:[],isLoading:!1,isLoadingRequests:!1,isLoadingResponses:!1,isLoadingTypes:!1,pagination:{count:0,next:null,previous:null,currentPage:1,pageSize:10},dashboardStats:{total_requests:0,status_counts:{},priority_counts:{},recent_requests_count:0,assigned_to_me_count:0,overdue_count:0},filters:{status:null,priority:null,search:"",assigned_to_me:!1},dataLoaded:!1,lastFetchTime:null}),getters:{requestById:t=>o=>[...t.myRequests,...t.receivedRequests].find(n=>n.id===o),requestsByStatus:t=>o=>[...t.myRequests,...t.receivedRequests].filter(n=>n.status===o),highPriorityRequests:t=>[...t.myRequests,...t.receivedRequests].filter(s=>s.priority==="HIGH"||s.priority==="URGENT"),pendingRequestsCount:t=>[...t.myRequests,...t.receivedRequests].filter(s=>s.status==="PENDING").length,requestTypeById:t=>o=>t.requestTypes.find(s=>s.id===o)},actions:{async getMyOrganizationsForRequests(){try{this.isLoading=!0;const t=await X("corporate-requests/clients/my-organizations/");if(t.status===200)return this.availableOrganizations=t.data.organizations,t.data;throw new Error("Error fetching organizations for requests")}catch(t){throw console.error("Error fetching organizations for requests:",t),t}finally{this.isLoading=!1}},async getRequestTypes(){var t;try{this.isLoadingTypes=!0;const o=await X("corporate-requests/clients/request-types/");if(o.status===200){const s=o.data.request_types||o.data;return this.requestTypes=s,s}throw new Error("Error fetching request types")}catch(o){throw console.error("Error fetching request types:",o),console.error("Error details:",(t=o.response)==null?void 0:t.data),o}finally{this.isLoadingTypes=!1}},async createCorporateRequest(t){try{this.isLoading=!0;const o=await re("corporate-requests/clients/create/",t);if(o.status===201){const s=o.data.corporate_request;return this.myRequests.unshift(s),this.currentRequest=s,o.data}throw new Error("Error creating corporate request")}catch(o){throw console.error("Error creating corporate request:",o),o}finally{this.isLoading=!1}},async getMyRequests(t={}){try{this.isLoadingRequests=!0;const o=new URLSearchParams;Object.keys(t).forEach(d=>{t[d]!==null&&t[d]!==void 0&&t[d]!==""&&o.append(d,t[d])});const s=`corporate-requests/clients/my-requests/${o.toString()?"?"+o.toString():""}`,n=await X(s);if(n.status===200)return this.myRequests=n.data.results,this.pagination={count:n.data.count,next:n.data.next,previous:n.data.previous,currentPage:t.page||1,pageSize:t.page_size||10},this.dataLoaded=!0,this.lastFetchTime=new Date().toISOString(),n.data;throw new Error("Error fetching my requests")}catch(o){throw console.error("Error fetching my requests:",o),o}finally{this.isLoadingRequests=!1}},async getMyRequestDetail(t){try{this.isLoading=!0;const o=await X(`corporate-requests/clients/${t}/`);if(o.status===200){this.currentRequest=o.data.corporate_request,this.requestResponses=o.data.corporate_request.responses||[];const s=this.myRequests.findIndex(n=>n.id===t);return s>=0&&(this.myRequests[s]=o.data.corporate_request),o.data}throw new Error("Request not found")}catch(o){throw console.error("Error fetching request detail:",o),o}finally{this.isLoading=!1}},async addResponseToMyRequest(t,o){try{this.isLoadingResponses=!0;const s=typeof o=="string"?{response_text:o}:o,n=await re(`corporate-requests/clients/${t}/responses/`,s);if(n.status===201){const d=n.data.response;return this.requestResponses.push(d),this.currentRequest&&this.currentRequest.id===t&&(this.currentRequest.response_count=(this.currentRequest.response_count||0)+1,this.currentRequest.responses||(this.currentRequest.responses=[]),this.currentRequest.responses.push(d)),n.data}throw new Error("Error adding response")}catch(s){throw console.error("Error adding response:",s),s}finally{this.isLoadingResponses=!1}},async getReceivedRequests(t={}){try{this.isLoadingRequests=!0;const o=new URLSearchParams;Object.keys(t).forEach(d=>{t[d]!==null&&t[d]!==void 0&&t[d]!==""&&o.append(d,t[d])});const s=`corporate-requests/corporate/received/${o.toString()?"?"+o.toString():""}`,n=await X(s);if(n.status===200)return this.receivedRequests=n.data.results,this.pagination={count:n.data.count,next:n.data.next,previous:n.data.previous,currentPage:t.page||1,pageSize:t.page_size||10},this.dataLoaded=!0,this.lastFetchTime=new Date().toISOString(),n.data;throw new Error("Error fetching received requests")}catch(o){throw console.error("Error fetching received requests:",o),o}finally{this.isLoadingRequests=!1}},async getReceivedRequestDetail(t){try{this.isLoading=!0;const o=await X(`corporate-requests/corporate/${t}/`);if(o.status===200){this.currentRequest=o.data.corporate_request,this.requestResponses=o.data.corporate_request.responses||[];const s=this.receivedRequests.findIndex(n=>n.id===t);return s>=0&&(this.receivedRequests[s]=o.data.corporate_request),o.data}throw new Error("Request not found")}catch(o){throw console.error("Error fetching received request detail:",o),o}finally{this.isLoading=!1}},async updateReceivedRequest(t,o){try{this.isLoading=!0;const s=await Te(`corporate-requests/corporate/${t}/update/`,o);if(s.status===200){const n=s.data.corporate_request;return this._updateRequestInState(t,n),s.data}throw new Error("Error updating request")}catch(s){throw console.error("Error updating request:",s),s}finally{this.isLoading=!1}},async addResponseToReceivedRequest(t,o){try{this.isLoadingResponses=!0;const s=typeof o=="string"?{response_text:o,is_internal_note:!1}:o,n=await re(`corporate-requests/corporate/${t}/responses/`,s);if(n.status===201){const d=n.data.response;return this.requestResponses.push(d),this.currentRequest&&this.currentRequest.id===t&&(this.currentRequest.response_count=(this.currentRequest.response_count||0)+1,this.currentRequest.responses||(this.currentRequest.responses=[]),this.currentRequest.responses.push(d)),n.data}throw new Error("Error adding response")}catch(s){throw console.error("Error adding response:",s),s}finally{this.isLoadingResponses=!1}},async getDashboardStats(){try{this.isLoading=!0;const t=await X("corporate-requests/corporate/dashboard-stats/");if(t.status===200)return this.dashboardStats=t.data,t.data;throw new Error("Error fetching dashboard stats")}catch(t){throw console.error("Error fetching dashboard stats:",t),t}finally{this.isLoading=!1}},async getRequestConversation(t){try{this.isLoadingResponses=!0;const o=await X(`corporate-requests/${t}/conversation/`);if(o.status===200)return this.requestResponses=o.data.responses,o.data;throw new Error("Error fetching conversation")}catch(o){throw console.error("Error fetching conversation:",o),o}finally{this.isLoadingResponses=!1}},async updateFilters(t,o){this.filters={...this.filters,...t};const s={status:this.filters.status,priority:this.filters.priority,search:this.filters.search,page:1};o==="corporate_client"&&this.filters.assigned_to_me&&(s.assigned_to_me=this.filters.assigned_to_me),o==="client"||o==="basic"?await this.getMyRequests(s):o==="corporate_client"&&await this.getReceivedRequests(s)},clearFilters(){this.filters={status:null,priority:null,search:"",assigned_to_me:!1}},async refreshRequests(t){const o={page:this.pagination.currentPage,page_size:this.pagination.pageSize};t==="client"||t==="basic"?await this.getMyRequests(o):t==="corporate_client"&&await this.getReceivedRequests(o)},clearAll(){this.myRequests=[],this.receivedRequests=[],this.currentRequest=null,this.availableOrganizations=[],this.requestTypes=[],this.requestResponses=[],this.dashboardStats={total_requests:0,status_counts:{},priority_counts:{},recent_requests_count:0,assigned_to_me_count:0,overdue_count:0},this.clearFilters(),this.dataLoaded=!1,this.lastFetchTime=null},_updateRequestInState(t,o){const s=this.myRequests.findIndex(d=>d.id===t);s>=0&&(this.myRequests[s]=o);const n=this.receivedRequests.findIndex(d=>d.id===t);n>=0&&(this.receivedRequests[n]=o),this.currentRequest&&this.currentRequest.id===t&&(this.currentRequest=o)},getStatusDisplay(t){return{PENDING:"Pendiente",IN_REVIEW:"En Revisión",RESPONDED:"Respondida",RESOLVED:"Resuelta",CLOSED:"Cerrada"}[t]||t},getPriorityDisplay(t){return{LOW:"Baja",MEDIUM:"Media",HIGH:"Alta",URGENT:"Urgente"}[t]||t},getPriorityColorClass(t){return{LOW:"text-gray-600 bg-gray-100",MEDIUM:"text-blue-600 bg-blue-100",HIGH:"text-orange-600 bg-orange-100",URGENT:"text-red-600 bg-red-100"}[t]||"text-gray-600 bg-gray-100"},getStatusColorClass(t){return{PENDING:"text-yellow-600 bg-yellow-100",IN_REVIEW:"text-blue-600 bg-blue-100",RESPONDED:"text-purple-600 bg-purple-100",RESOLVED:"text-green-600 bg-green-100",CLOSED:"text-gray-600 bg-gray-100"}[t]||"text-gray-600 bg-gray-100"}}}),ee=t=>(Ce("data-v-6908ea93"),t=t(),Re(),t),Et=ee(()=>e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)),kt={class:"fixed inset-0 z-10 overflow-y-auto"},qt={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},Ct={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},Rt=ee(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," Crea tu organización para empezar a recibir solicitudes corporativas ",-1)),Mt={key:0,class:"flex justify-center items-center py-8"},Pt=ee(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),St=ee(()=>e("span",{class:"ml-2 text-gray-600"},"Creando organización...",-1)),Dt=[Pt,St],It={key:1,class:"text-center py-6"},Lt=ee(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," ¡Organización Creada! ",-1)),jt={class:"text-sm text-gray-600 mb-6"},Ot={class:"space-y-4"},Nt=ee(()=>e("h4",{class:"text-md font-medium text-gray-900"},"Información Básica",-1)),At=ee(()=>e("label",{for:"title",class:"block text-sm font-medium leading-6 text-gray-900"}," Nombre de la Organización * ",-1)),Ut={class:"mt-2"},Vt={key:0,class:"mt-1 text-sm text-red-600"},Tt=ee(()=>e("label",{for:"description",class:"block text-sm font-medium leading-6 text-gray-900"}," Descripción * ",-1)),Gt={class:"mt-2"},Bt=ee(()=>e("p",{class:"mt-1 text-xs text-gray-500"}," Esta descripción será visible para los clientes que reciban invitaciones ",-1)),Ft={key:0,class:"mt-1 text-sm text-red-600"},Ht={class:"space-y-4 border-t border-gray-200 pt-6"},Wt=ee(()=>e("h4",{class:"text-md font-medium text-gray-900"},"Imágenes (Opcional)",-1)),Zt=ee(()=>e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Imagen de Perfil ",-1)),Jt={class:"mt-2 flex items-center space-x-4"},Qt={class:"flex-shrink-0"},Yt=["src"],Xt={class:"flex-1"},Kt=ee(()=>e("p",{class:"mt-1 text-xs text-gray-500"},"PNG, JPG hasta 5MB",-1)),es={key:0,class:"mt-1 text-sm text-red-600"},ts=ee(()=>e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Imagen de Portada ",-1)),ss={class:"mt-2"},os={class:"mb-4"},as=["src"],is=ee(()=>e("p",{class:"mt-1 text-xs text-gray-500"},"PNG, JPG hasta 5MB. Recomendado: 800x400px",-1)),ns={key:0,class:"mt-1 text-sm text-red-600"},rs={key:0,class:"space-y-4 border-t border-gray-200 pt-6"},ls=ee(()=>e("h4",{class:"text-md font-medium text-gray-900"},"Vista Previa",-1)),cs={class:"bg-gray-50 border border-gray-200 rounded-lg overflow-hidden"},ds={class:"relative h-24 bg-gradient-to-r from-blue-500 to-purple-600"},us=["src"],ms=ee(()=>e("div",{class:"absolute inset-0 bg-black bg-opacity-30"},null,-1)),gs={class:"absolute bottom-2 left-4"},fs=["src"],hs={class:"p-4"},vs={class:"text-sm font-medium text-gray-900 mb-1"},ps={class:"text-xs text-gray-600 line-clamp-2"},_s={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},bs={class:"flex"},ys=ee(()=>e("div",{class:"ml-3"},[e("h5",{class:"text-sm font-medium text-blue-800"},"Información importante"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Serás el líder y administrador de esta organización"),e("p",null,"• Podrás invitar clientes a unirse como miembros"),e("p",null,"• Los miembros podrán enviarte solicitudes corporativas"),e("p",null,"• Puedes editar la información en cualquier momento")])],-1)),xs={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},ws=["disabled"],$s={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},zs={__name:"CreateOrganizationModal",props:{visible:{type:Boolean,default:!1}},emits:["close","created"],setup(t,{emit:o}){const s=t,n=o,d=ge(),i=R(!1),g=R(!1),h=R({}),m=R(null),x=R({title:"",description:"",profile_image:null,cover_image:null}),v=R(null),p=R(null),b=D(()=>"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMDAgMTAwTDE4MCA4MEwyMjAgODBMMjAwIDEwMFoiIGZpbGw9IiM5Q0E0QUYiLz4KPC9zdmc+"),f=()=>{x.value={title:"",description:"",profile_image:null,cover_image:null},h.value={},v.value=null,p.value=null,g.value=!1,m.value=null},E=_=>{const $=_.target.files[0];if($){if($.size>5*1024*1024){j("La imagen debe ser menor a 5MB","warning");return}if(!$.type.startsWith("image/")){j("Solo se permiten archivos de imagen","warning");return}x.value.profile_image=$;const P=new FileReader;P.onload=O=>{v.value=O.target.result},P.readAsDataURL($)}},w=_=>{const $=_.target.files[0];if($){if($.size>5*1024*1024){j("La imagen debe ser menor a 5MB","warning");return}if(!$.type.startsWith("image/")){j("Solo se permiten archivos de imagen","warning");return}x.value.cover_image=$;const P=new FileReader;P.onload=O=>{p.value=O.target.result},P.readAsDataURL($)}},C=async()=>{var _,$,P,O;try{i.value=!0,h.value={};const S={title:x.value.title.trim(),description:x.value.description.trim()};x.value.profile_image&&(S.profile_image=x.value.profile_image),x.value.cover_image&&(S.cover_image=x.value.cover_image);const L=await d.createOrganization(S);m.value=L.organization,g.value=!0,j("Organización creada exitosamente","success"),n("created",L.organization)}catch(S){console.error("Error creating organization:",S),($=(_=S.response)==null?void 0:_.data)!=null&&$.details?h.value=S.response.data.details:(O=(P=S.response)==null?void 0:P.data)!=null&&O.error?j(S.response.data.error,"error"):j("Error al crear la organización","error")}finally{i.value=!1}},M=()=>{f()},z=()=>{i.value||n("close")};return te(()=>s.visible,_=>{_&&qe(()=>{f()})}),(_,$)=>(a(),G(c(pe),{as:"template",show:t.visible},{default:N(()=>[u(c(fe),{class:"relative z-50",onClose:z},{default:N(()=>[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:N(()=>[Et]),_:1}),e("div",kt,[e("div",qt,[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:N(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6"},{default:N(()=>{var P;return[e("div",Ct,[e("div",null,[u(c(ve),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:N(()=>[y(" Crear Nueva Organización ")]),_:1}),Rt]),e("button",{onClick:z,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(c(ce),{class:"h-6 w-6"})])]),i.value?(a(),r("div",Mt,Dt)):g.value?(a(),r("div",It,[u(c($e),{class:"h-16 w-16 text-green-500 mx-auto mb-4"}),Lt,e("p",jt,[y(" Tu organización "),e("strong",null,l((P=m.value)==null?void 0:P.title),1),y(" ha sido creada exitosamente. ")]),e("div",{class:"space-y-3"},[e("button",{onClick:M,class:"w-full inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Crear Otra Organización "),e("button",{onClick:z,class:"w-full inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cerrar ")])])):(a(),r("form",{key:2,onSubmit:be(C,["prevent"]),class:"space-y-6"},[e("div",Ot,[Nt,e("div",null,[At,e("div",Ut,[F(e("input",{id:"title","onUpdate:modelValue":$[0]||($[0]=O=>x.value.title=O),type:"text",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ej: Consultora Jurídica Andina"},null,512),[[ae,x.value.title]])]),h.value.title?(a(),r("p",Vt,l(h.value.title[0]),1)):q("",!0)]),e("div",null,[Tt,e("div",Gt,[F(e("textarea",{id:"description","onUpdate:modelValue":$[1]||($[1]=O=>x.value.description=O),rows:"4",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Describe el propósito y servicios de tu organización..."},null,512),[[ae,x.value.description]])]),Bt,h.value.description?(a(),r("p",Ft,l(h.value.description[0]),1)):q("",!0)])]),e("div",Ht,[Wt,e("div",null,[Zt,e("div",Jt,[e("div",Qt,[e("img",{src:v.value||c(J),alt:"Profile preview",class:"h-16 w-16 rounded-full object-cover border-2 border-gray-200 bg-gray-50"},null,8,Yt)]),e("div",Xt,[e("input",{ref:"profileImageInput",type:"file",accept:"image/*",class:"hidden",onChange:E},null,544),e("button",{type:"button",onClick:$[2]||($[2]=O=>_.$refs.profileImageInput.click()),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(Ie),{class:"h-4 w-4 mr-2"}),y(" Seleccionar Imagen ")]),Kt])]),h.value.profile_image?(a(),r("p",es,l(h.value.profile_image[0]),1)):q("",!0)]),e("div",null,[ts,e("div",ss,[e("div",os,[e("img",{src:p.value||b.value,alt:"Cover preview",class:"w-full h-32 rounded-lg object-cover border-2 border-gray-200 bg-gray-50"},null,8,as)]),e("div",null,[e("input",{ref:"coverImageInput",type:"file",accept:"image/*",class:"hidden",onChange:w},null,544),e("button",{type:"button",onClick:$[3]||($[3]=O=>_.$refs.coverImageInput.click()),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(Ie),{class:"h-4 w-4 mr-2"}),y(" Seleccionar Portada ")]),is])]),h.value.cover_image?(a(),r("p",ns,l(h.value.cover_image[0]),1)):q("",!0)])]),x.value.title||x.value.description?(a(),r("div",rs,[ls,e("div",cs,[e("div",ds,[p.value?(a(),r("img",{key:0,src:p.value,alt:"Portada preview",class:"w-full h-full object-cover"},null,8,us)):q("",!0),ms,e("div",gs,[e("img",{src:v.value||c(J),alt:"Logo preview",class:"h-12 w-12 rounded-full border-2 border-white object-cover bg-white"},null,8,fs)])]),e("div",hs,[e("h3",vs,l(x.value.title||"Nombre de la Organización"),1),e("p",ps,l(x.value.description||"Descripción de la organización..."),1)])])])):q("",!0),e("div",_s,[e("div",bs,[u(c(me),{class:"h-5 w-5 text-blue-400 mt-0.5"}),ys])]),e("div",xs,[e("button",{type:"button",onClick:z,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value||!x.value.title.trim()||!x.value.description.trim(),class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),r("div",$s)):(a(),G(c(ke),{key:1,class:"h-4 w-4 mr-2"})),y(" "+l(i.value?"Creando...":"Crear Organización"),1)],8,ws)])],32))]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},Es=Me(zs,[["__scopeId","data-v-6908ea93"]]),ks=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),qs={class:"fixed inset-0 z-10 overflow-y-auto"},Cs={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},Rs={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},Ms=e("p",{class:"mt-1 text-sm text-gray-500"}," Actualiza la información y configuración de tu organización ",-1),Ps={key:0,class:"flex justify-center items-center py-8"},Ss=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),Ds=e("span",{class:"ml-2 text-gray-600"},"Actualizando organización...",-1),Is=[Ss,Ds],Ls={class:"space-y-4"},js=e("h4",{class:"text-md font-medium text-gray-900"},"Información Básica",-1),Os=e("label",{for:"title",class:"block text-sm font-medium leading-6 text-gray-900"}," Nombre de la Organización * ",-1),Ns={class:"mt-2"},As={key:0,class:"mt-1 text-sm text-red-600"},Us=e("label",{for:"description",class:"block text-sm font-medium leading-6 text-gray-900"}," Descripción * ",-1),Vs={class:"mt-2"},Ts={key:0,class:"mt-1 text-sm text-red-600"},Gs=e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Estado de la Organización ",-1),Bs={class:"mt-2"},Fs={class:"flex items-center space-x-6"},Hs={class:"flex items-center"},Ws=e("label",{for:"active",class:"ml-2 block text-sm text-gray-900"}," Activa ",-1),Zs={class:"flex items-center"},Js=e("label",{for:"inactive",class:"ml-2 block text-sm text-gray-900"}," Inactiva ",-1),Qs={class:"space-y-4 border-t border-gray-200 pt-6"},Ys=e("h4",{class:"text-md font-medium text-gray-900"},"Imágenes",-1),Xs=e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Imagen de Perfil ",-1),Ks={class:"mt-2 flex items-center space-x-4"},eo={class:"flex-shrink-0"},to=["src"],so=e("p",{class:"mt-1 text-xs text-gray-500"},"PNG, JPG hasta 5MB",-1),oo={key:0,class:"mt-1 text-sm text-red-600"},ao=e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Imagen de Portada ",-1),io={class:"mt-2"},no={class:"mb-4"},ro=["src"],lo=e("p",{class:"mt-1 text-xs text-gray-500"},"PNG, JPG hasta 5MB",-1),co={key:0,class:"mt-1 text-sm text-red-600"},uo={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},mo=["disabled"],go={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},fo={__name:"EditOrganizationModal",props:{visible:{type:Boolean,default:!1},organization:{type:Object,default:null}},emits:["close","updated"],setup(t,{emit:o}){const s=t,n=o,d=ge(),i=R(!1),g=R({}),h=R({title:"",description:"",is_active:!0,profile_image:null,cover_image:null}),m=R(null),x=R(null),v=D(()=>{var M;return m.value?m.value:(M=s.organization)!=null&&M.profile_image_url?s.organization.profile_image_url:J}),p=D(()=>{var M;return x.value?x.value:(M=s.organization)!=null&&M.cover_image_url?s.organization.cover_image_url:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMDAgMTAwTDE4MCA4MEwyMjAgODBMMjAwIDEwMFoiIGZpbGw9IiM5Q0E0QUYiLz4KPC9zdmc+"}),b=()=>{s.organization?h.value={title:s.organization.title||"",description:s.organization.description||"",is_active:s.organization.is_active!==void 0?s.organization.is_active:!0,profile_image:null,cover_image:null}:h.value={title:"",description:"",is_active:!0,profile_image:null,cover_image:null},g.value={},m.value=null,x.value=null},f=M=>{const z=M.target.files[0];if(z){if(z.size>5*1024*1024){j("La imagen debe ser menor a 5MB","warning");return}if(!z.type.startsWith("image/")){j("Solo se permiten archivos de imagen","warning");return}h.value.profile_image=z;const _=new FileReader;_.onload=$=>{m.value=$.target.result},_.readAsDataURL(z)}},E=M=>{const z=M.target.files[0];if(z){if(z.size>5*1024*1024){j("La imagen debe ser menor a 5MB","warning");return}if(!z.type.startsWith("image/")){j("Solo se permiten archivos de imagen","warning");return}h.value.cover_image=z;const _=new FileReader;_.onload=$=>{x.value=$.target.result},_.readAsDataURL(z)}},w=async()=>{var M,z,_,$;if(s.organization)try{i.value=!0,g.value={};const P={title:h.value.title,description:h.value.description,is_active:h.value.is_active};h.value.profile_image&&(P.profile_image=h.value.profile_image),h.value.cover_image&&(P.cover_image=h.value.cover_image);const O=await d.updateOrganization(s.organization.id,P);j("Organización actualizada exitosamente","success"),n("updated",O.organization)}catch(P){console.error("Error updating organization:",P),(z=(M=P.response)==null?void 0:M.data)!=null&&z.details?g.value=P.response.data.details:($=(_=P.response)==null?void 0:_.data)!=null&&$.error?j(P.response.data.error,"error"):j("Error al actualizar la organización","error")}finally{i.value=!1}},C=()=>{i.value||n("close")};return te(()=>s.visible,M=>{M&&qe(()=>{b()})}),te(()=>s.organization,M=>{M&&s.visible&&b()}),(M,z)=>(a(),G(c(pe),{as:"template",show:t.visible},{default:N(()=>[u(c(fe),{class:"relative z-50",onClose:C},{default:N(()=>[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:N(()=>[ks]),_:1}),e("div",qs,[e("div",Cs,[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:N(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6"},{default:N(()=>[e("div",Rs,[e("div",null,[u(c(ve),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:N(()=>[y(" Editar Organización ")]),_:1}),Ms]),e("button",{onClick:C,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(c(ce),{class:"h-6 w-6"})])]),i.value?(a(),r("div",Ps,Is)):(a(),r("form",{key:1,onSubmit:be(w,["prevent"]),class:"space-y-6"},[e("div",Ls,[js,e("div",null,[Os,e("div",Ns,[F(e("input",{id:"title","onUpdate:modelValue":z[0]||(z[0]=_=>h.value.title=_),type:"text",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ingresa el nombre de la organización"},null,512),[[ae,h.value.title]])]),g.value.title?(a(),r("p",As,l(g.value.title[0]),1)):q("",!0)]),e("div",null,[Us,e("div",Vs,[F(e("textarea",{id:"description","onUpdate:modelValue":z[1]||(z[1]=_=>h.value.description=_),rows:"4",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Describe tu organización..."},null,512),[[ae,h.value.description]])]),g.value.description?(a(),r("p",Ts,l(g.value.description[0]),1)):q("",!0)]),e("div",null,[Gs,e("div",Bs,[e("div",Fs,[e("div",Hs,[F(e("input",{id:"active","onUpdate:modelValue":z[2]||(z[2]=_=>h.value.is_active=_),value:!0,type:"radio",class:"h-4 w-4 text-blue-600 focus:ring-blue-600 border-gray-300"},null,512),[[Ye,h.value.is_active]]),Ws]),e("div",Zs,[F(e("input",{id:"inactive","onUpdate:modelValue":z[3]||(z[3]=_=>h.value.is_active=_),value:!1,type:"radio",class:"h-4 w-4 text-blue-600 focus:ring-blue-600 border-gray-300"},null,512),[[Ye,h.value.is_active]]),Js])])])])]),e("div",Qs,[Ys,e("div",null,[Xs,e("div",Ks,[e("div",eo,[e("img",{src:v.value,alt:"Profile preview",class:"h-16 w-16 rounded-full object-cover border-2 border-gray-200"},null,8,to)]),e("div",null,[e("input",{ref:"profileImageInput",type:"file",accept:"image/*",class:"hidden",onChange:f},null,544),e("button",{type:"button",onClick:z[4]||(z[4]=_=>M.$refs.profileImageInput.click()),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(Ie),{class:"h-4 w-4 mr-2"}),y(" Cambiar Imagen ")]),so])]),g.value.profile_image?(a(),r("p",oo,l(g.value.profile_image[0]),1)):q("",!0)]),e("div",null,[ao,e("div",io,[e("div",no,[e("img",{src:p.value,alt:"Cover preview",class:"w-full h-32 rounded-lg object-cover border-2 border-gray-200"},null,8,ro)]),e("div",null,[e("input",{ref:"coverImageInput",type:"file",accept:"image/*",class:"hidden",onChange:E},null,544),e("button",{type:"button",onClick:z[5]||(z[5]=_=>M.$refs.coverImageInput.click()),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(Ie),{class:"h-4 w-4 mr-2"}),y(" Cambiar Portada ")]),lo])]),g.value.cover_image?(a(),r("p",co,l(g.value.cover_image[0]),1)):q("",!0)])]),e("div",uo,[e("button",{type:"button",onClick:C,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value,class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),r("div",go)):q("",!0),y(" "+l(i.value?"Guardando...":"Guardar Cambios"),1)],8,mo)])],32))]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},ho=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),vo={class:"fixed inset-0 z-10 overflow-y-auto"},po={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},_o={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},bo={class:"mt-1 text-sm text-gray-500"},yo={key:0,class:"flex justify-center items-center py-8"},xo=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),wo=e("span",{class:"ml-2 text-gray-600"},"Enviando invitación...",-1),$o=[xo,wo],zo={key:0,class:"bg-gray-50 rounded-lg p-4"},Eo={class:"flex items-center space-x-3"},ko=["src","alt"],qo={class:"text-sm font-medium text-gray-900"},Co={class:"text-xs text-gray-500"},Ro=e("label",{for:"email",class:"block text-sm font-medium leading-6 text-gray-900"}," Email del Cliente * ",-1),Mo={class:"mt-2"},Po=e("p",{class:"mt-1 text-xs text-gray-500"}," El email debe corresponder a un usuario registrado como cliente en la plataforma ",-1),So={key:0,class:"mt-1 text-sm text-red-600"},Do=e("label",{for:"message",class:"block text-sm font-medium leading-6 text-gray-900"}," Mensaje Personalizado ",-1),Io={class:"mt-2"},Lo=e("p",{class:"mt-1 text-xs text-gray-500"}," Este mensaje se incluirá en la invitación que reciba el cliente ",-1),jo={key:0,class:"mt-1 text-sm text-red-600"},Oo={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},No=e("h5",{class:"text-sm font-medium text-blue-900 mb-2"},"Vista previa del mensaje:",-1),Ao={class:"text-sm text-blue-800 bg-white rounded p-3 border border-blue-100"},Uo={class:"mb-2"},Vo={class:"mb-2 italic"},To=e("p",{class:"text-xs text-blue-600"},"Puedes aceptar o rechazar esta invitación desde tu panel de control.",-1),Go={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},Bo={class:"flex"},Fo=e("div",{class:"ml-3"},[e("h5",{class:"text-sm font-medium text-yellow-800"},"Información importante"),e("div",{class:"mt-1 text-sm text-yellow-700 space-y-1"},[e("p",null,"• La invitación se enviará al usuario dentro de la plataforma"),e("p",null,"• El usuario debe estar registrado como cliente"),e("p",null,"• Las invitaciones expiran automáticamente en 30 días"),e("p",null,"• Puedes cancelar invitaciones pendientes en cualquier momento")])],-1),Ho={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},Wo=["disabled"],Zo={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Jo={key:2,class:"text-center py-6"},Qo=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," ¡Invitación Enviada! ",-1),Yo={class:"text-sm text-gray-600 mb-6"},Xo={__name:"InviteMemberModal",props:{visible:{type:Boolean,default:!1},organization:{type:Object,default:null}},emits:["close","invited"],setup(t,{emit:o}){const s=t,n=o,d=ge(),i=R(!1),g=R(!1),h=R({}),m=R({invited_user_email:"",message:""}),x=()=>{m.value={invited_user_email:"",message:""},h.value={},g.value=!1},v=async()=>{var E,w,C,M,z,_;if(s.organization)try{i.value=!0,h.value={};const $={invited_user_email:m.value.invited_user_email.trim(),message:m.value.message.trim()},P=await d.sendInvitation(s.organization.id,$);j("Invitación enviada exitosamente","success"),g.value=!0,n("invited",P.invitation)}catch($){console.error("Error sending invitation:",$),(w=(E=$.response)==null?void 0:E.data)!=null&&w.details?h.value=$.response.data.details:(M=(C=$.response)==null?void 0:C.data)!=null&&M.error?j($.response.data.error,"error"):((z=$.response)==null?void 0:z.status)===400?(_=$.response.data)!=null&&_.invited_user_email?h.value.invited_user_email=$.response.data.invited_user_email:j("Error en los datos de la invitación","error"):j("Error al enviar la invitación","error")}finally{i.value=!1}},p=()=>{x()},b=()=>{i.value||n("close")};te(()=>s.visible,E=>{E&&qe(()=>{x()})});const f=D(()=>s.organization?`Te invitamos a unirte a nuestra organización "${s.organization.title}" para colaborar en proyectos y solicitudes corporativas. ¡Esperamos contar contigo!`:"");return te(()=>s.organization,E=>{E&&s.visible&&!m.value.message.trim()&&(m.value.message=f.value)}),(E,w)=>(a(),G(c(pe),{as:"template",show:t.visible},{default:N(()=>[u(c(fe),{class:"relative z-50",onClose:b},{default:N(()=>[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:N(()=>[ho]),_:1}),e("div",vo,[e("div",po,[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:N(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"},{default:N(()=>{var C,M;return[e("div",_o,[e("div",null,[u(c(ve),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:N(()=>[y(" Invitar Nuevo Miembro ")]),_:1}),e("p",bo," Invita a un cliente a unirse a "+l((C=t.organization)==null?void 0:C.title),1)]),e("button",{onClick:b,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(c(ce),{class:"h-6 w-6"})])]),i.value?(a(),r("div",yo,$o)):(a(),r("form",{key:1,onSubmit:be(v,["prevent"]),class:"space-y-6"},[t.organization?(a(),r("div",zo,[e("div",Eo,[e("img",{src:t.organization.profile_image_url||c(J),alt:`Logo de ${t.organization.title}`,class:"h-12 w-12 rounded-full object-cover border-2 border-white"},null,8,ko),e("div",null,[e("h4",qo,l(t.organization.title),1),e("p",Co,l(t.organization.member_count)+" miembros actuales",1)])])])):q("",!0),e("div",null,[Ro,e("div",Mo,[F(e("input",{id:"email","onUpdate:modelValue":w[0]||(w[0]=z=>m.value.invited_user_email=z),type:"email",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"cliente@ejemplo.com"},null,512),[[ae,m.value.invited_user_email]])]),Po,h.value.invited_user_email?(a(),r("p",So,l(h.value.invited_user_email[0]),1)):q("",!0)]),e("div",null,[Do,e("div",Io,[F(e("textarea",{id:"message","onUpdate:modelValue":w[1]||(w[1]=z=>m.value.message=z),rows:"4",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Opcional: Añade un mensaje personalizado para la invitación..."},null,512),[[ae,m.value.message]])]),Lo,h.value.message?(a(),r("p",jo,l(h.value.message[0]),1)):q("",!0)]),m.value.message.trim()?(a(),r("div",Oo,[No,e("div",Ao,[e("p",Uo,[e("strong",null,l((M=t.organization)==null?void 0:M.title),1),y(" te ha invitado a unirte a su organización.")]),e("p",Vo,'"'+l(m.value.message)+'"',1),To])])):q("",!0),e("div",Go,[e("div",Bo,[u(c(me),{class:"h-5 w-5 text-yellow-400 mt-0.5"}),Fo])]),e("div",Ho,[e("button",{type:"button",onClick:b,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value||!m.value.invited_user_email.trim(),class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),r("div",Zo)):(a(),G(c(rt),{key:1,class:"h-4 w-4 mr-2"})),y(" "+l(i.value?"Enviando...":"Enviar Invitación"),1)],8,Wo)])],32)),g.value?(a(),r("div",Jo,[u(c($e),{class:"h-16 w-16 text-green-500 mx-auto mb-4"}),Qo,e("p",Yo,[y(" La invitación ha sido enviada exitosamente a "),e("strong",null,l(m.value.invited_user_email),1)]),e("div",{class:"space-y-3"},[e("button",{onClick:p,class:"w-full inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Invitar a Otra Persona "),e("button",{onClick:b,class:"w-full inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cerrar ")])])):q("",!0)]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},Ko=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),ea={class:"fixed inset-0 z-10 overflow-y-auto"},ta={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},sa={class:"mb-4"},oa={class:"flex items-center justify-between"},aa={class:"flex items-center space-x-3"},ia={class:"flex-shrink-0"},na=["src","alt"],ra={class:"text-sm text-gray-500"},la=e("span",{class:"sr-only"},"Cerrar",-1),ca={key:0,class:"flex justify-center items-center py-12"},da=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),ua=e("span",{class:"ml-2 text-gray-600"},"Cargando miembros...",-1),ma=[da,ua],ga={key:1,class:"mt-4"},fa={class:"max-h-96 overflow-y-auto"},ha={role:"list",class:"divide-y divide-gray-200"},va={class:"flex items-center space-x-4"},pa={class:"flex-shrink-0"},_a=["src","alt"],ba={class:"flex-1 min-w-0"},ya={class:"text-sm font-medium text-gray-900 truncate"},xa={class:"text-sm text-gray-500 truncate"},wa={class:"flex items-center space-x-2"},$a={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},za={class:"flex-shrink-0 text-sm text-gray-500"},Ea={class:"flex items-center"},ka={key:2,class:"text-center py-12"},qa=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay miembros",-1),Ca=e("p",{class:"mt-1 text-sm text-gray-500"}," Esta organización aún no tiene miembros activos. ",-1),Ra={class:"mt-5 sm:mt-6"},Ma={__name:"MembersListModal",props:{visible:{type:Boolean,required:!0},organization:{type:Object,default:null}},emits:["close"],setup(t,{emit:o}){const s=t,n=o,d=ge(),i=R(!1),g=R([]),h=async()=>{var x;if((x=s.organization)!=null&&x.id)try{i.value=!0;const v=await d.getOrganizationMembers(s.organization.id);g.value=v||[]}catch(v){console.error("Error loading members:",v),j("Error al cargar los miembros","error"),g.value=[]}finally{i.value=!1}},m=x=>new Date(x).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"});return te(()=>s.visible,x=>{x&&s.organization&&h()}),(x,v)=>(a(),G(c(pe),{as:"template",show:t.visible},{default:N(()=>[u(c(fe),{as:"div",class:"relative z-50",onClose:v[2]||(v[2]=p=>n("close"))},{default:N(()=>[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:N(()=>[Ko]),_:1}),e("div",ea,[e("div",ta,[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:N(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6"},{default:N(()=>{var p;return[e("div",sa,[e("div",oa,[e("div",aa,[e("div",ia,[t.organization?(a(),r("img",{key:0,src:t.organization.profile_image_url||c(J),alt:`Logo de ${(p=t.organization)==null?void 0:p.title}`,class:"h-12 w-12 rounded-full object-cover border-2 border-gray-200"},null,8,na)):q("",!0)]),e("div",null,[u(c(ve),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:N(()=>{var b;return[y(" Miembros de "+l((b=t.organization)==null?void 0:b.title),1)]}),_:1}),e("p",ra,l(g.value.length)+" "+l(g.value.length===1?"miembro activo":"miembros activos"),1)])]),e("button",{type:"button",class:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:v[0]||(v[0]=b=>n("close"))},[la,u(c(ce),{class:"h-6 w-6"})])])]),i.value?(a(),r("div",ca,ma)):g.value.length>0?(a(),r("div",ga,[e("div",fa,[e("ul",ha,[(a(!0),r(Z,null,Q(g.value,b=>{var f,E,w,C;return a(),r("li",{key:b.id,class:"py-4 hover:bg-gray-50 px-4 rounded-lg transition-colors"},[e("div",va,[e("div",pa,[e("img",{src:((f=b.user_info)==null?void 0:f.profile_image_url)||c(J),alt:`Avatar de ${(E=b.user_info)==null?void 0:E.full_name}`,class:"h-10 w-10 rounded-full object-cover border border-gray-200"},null,8,_a)]),e("div",ba,[e("p",ya,l((w=b.user_info)==null?void 0:w.full_name),1),e("p",xa,l((C=b.user_info)==null?void 0:C.email),1)]),e("div",wa,[e("span",{class:T([b.role==="ADMIN"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800","inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(b.role_display),3),b.is_active?(a(),r("span",$a,[u(c($e),{class:"h-3 w-3 mr-1"}),y(" Activo ")])):q("",!0)]),e("div",za,[e("div",Ea,[u(c(le),{class:"h-4 w-4 mr-1"}),y(" "+l(m(b.joined_at)),1)])])])])}),128))])])])):(a(),r("div",ka,[u(c(ye),{class:"h-12 w-12 mx-auto text-gray-300"}),qa,Ca])),e("div",Ra,[e("button",{type:"button",class:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600",onClick:v[1]||(v[1]=b=>n("close"))}," Cerrar ")])]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},Pa=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),Sa={class:"fixed inset-0 z-10 overflow-y-auto"},Da={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},Ia={class:"mb-4"},La={class:"flex items-center justify-between"},ja={class:"text-sm text-gray-500 mt-1"},Oa=e("span",{class:"sr-only"},"Cerrar",-1),Na={key:0,class:"flex justify-center items-center py-12"},Aa=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),Ua=e("span",{class:"ml-2 text-gray-600"},"Cargando miembros...",-1),Va=[Aa,Ua],Ta={key:1,class:"mt-4"},Ga={class:"max-h-[32rem] overflow-y-auto space-y-6"},Ba={class:"bg-gray-50 px-4 py-3 border-b border-gray-200"},Fa={class:"flex items-center space-x-3"},Ha=["src","alt"],Wa={class:"text-sm font-semibold text-gray-900"},Za={class:"text-xs text-gray-500"},Ja={class:"bg-white"},Qa={role:"list",class:"divide-y divide-gray-200"},Ya={class:"flex items-center space-x-3"},Xa={class:"flex-shrink-0"},Ka=["src","alt"],ei={class:"flex-1 min-w-0"},ti={class:"text-sm font-medium text-gray-900 truncate"},si={class:"text-xs text-gray-500 truncate"},oi={class:"flex items-center space-x-2"},ai={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},ii={class:"flex-shrink-0 text-xs text-gray-500 hidden sm:block"},ni={class:"flex items-center"},ri={key:2,class:"text-center py-12"},li=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay miembros",-1),ci=e("p",{class:"mt-1 text-sm text-gray-500"}," Tus organizaciones aún no tienen miembros activos. ",-1),di={class:"mt-5 sm:mt-6"},ui={__name:"AllMembersModal",props:{visible:{type:Boolean,required:!0},organizations:{type:Array,default:()=>[]}},emits:["close"],setup(t,{emit:o}){const s=t,n=o,d=ge(),i=R(!1),g=R([]),h=D(()=>g.value.reduce((v,p)=>v+p.members.length,0)),m=async()=>{if(!(!s.organizations||s.organizations.length===0))try{i.value=!0;const v=s.organizations.map(async p=>{try{const b=await d.getOrganizationMembers(p.id);return{organization:p,members:b||[]}}catch(b){return console.error(`Error loading members for organization ${p.id}:`,b),{organization:p,members:[]}}});g.value=await Promise.all(v)}catch(v){console.error("Error loading all members:",v),j("Error al cargar los miembros","error"),g.value=[]}finally{i.value=!1}},x=v=>new Date(v).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"});return te(()=>s.visible,v=>{v&&s.organizations&&s.organizations.length>0&&m()}),(v,p)=>(a(),G(c(pe),{as:"template",show:t.visible},{default:N(()=>[u(c(fe),{as:"div",class:"relative z-50",onClose:p[2]||(p[2]=b=>n("close"))},{default:N(()=>[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:N(()=>[Pa]),_:1}),e("div",Sa,[e("div",Da,[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:N(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl sm:p-6"},{default:N(()=>[e("div",Ia,[e("div",La,[e("div",null,[u(c(ve),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:N(()=>[y(" Todos los Miembros ")]),_:1}),e("p",ja,l(h.value)+" "+l(h.value===1?"miembro":"miembros")+" en "+l(t.organizations.length)+" "+l(t.organizations.length===1?"organización":"organizaciones"),1)]),e("button",{type:"button",class:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:p[0]||(p[0]=b=>n("close"))},[Oa,u(c(ce),{class:"h-6 w-6"})])])]),i.value?(a(),r("div",Na,Va)):g.value.length>0?(a(),r("div",Ta,[e("div",Ga,[(a(!0),r(Z,null,Q(g.value,b=>(a(),r("div",{key:b.organization.id,class:"border border-gray-200 rounded-lg overflow-hidden"},[e("div",Ba,[e("div",Fa,[e("img",{src:b.organization.profile_image_url||c(J),alt:`Logo de ${b.organization.title}`,class:"h-10 w-10 rounded-full object-cover border-2 border-gray-200"},null,8,Ha),e("div",null,[e("h4",Wa,l(b.organization.title),1),e("p",Za,l(b.members.length)+" "+l(b.members.length===1?"miembro":"miembros"),1)])])]),e("div",Ja,[e("ul",Qa,[(a(!0),r(Z,null,Q(b.members,f=>{var E,w,C,M;return a(),r("li",{key:f.id,class:"py-3 px-4 hover:bg-gray-50 transition-colors"},[e("div",Ya,[e("div",Xa,[e("img",{src:((E=f.user_info)==null?void 0:E.profile_image_url)||c(J),alt:`Avatar de ${(w=f.user_info)==null?void 0:w.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,Ka)]),e("div",ei,[e("p",ti,l((C=f.user_info)==null?void 0:C.full_name),1),e("p",si,l((M=f.user_info)==null?void 0:M.email),1)]),e("div",oi,[e("span",{class:T([f.role==="ADMIN"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800","inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"])},l(f.role_display),3),f.is_active?(a(),r("span",ai,[u(c($e),{class:"h-3 w-3 mr-1"}),y(" Activo ")])):q("",!0)]),e("div",ii,[e("div",ni,[u(c(le),{class:"h-3 w-3 mr-1"}),y(" "+l(x(f.joined_at)),1)])])])])}),128))])])]))),128))])])):(a(),r("div",ri,[u(c(ye),{class:"h-12 w-12 mx-auto text-gray-300"}),li,ci])),e("div",di,[e("button",{type:"button",class:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600",onClick:p[1]||(p[1]=b=>n("close"))}," Cerrar ")])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},lt=t=>(Ce("data-v-f2bdb849"),t=t(),Re(),t),mi={class:"bg-white shadow rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow"},gi={class:"flex items-start justify-between mb-4"},fi={class:"flex-1"},hi={class:"flex items-center space-x-2 mb-2"},vi={class:"text-sm font-medium text-gray-900"},pi={class:"text-lg font-semibold text-gray-900 mb-1"},_i={class:"text-sm text-gray-600 line-clamp-2 mb-3"},bi={class:"flex space-x-2"},yi={class:"relative"},xi={key:0,class:"absolute right-0 mt-1 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none z-10"},wi={class:"py-1"},$i=["onClick","disabled"],zi={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Ei={class:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg"},ki=["src","alt"],qi={class:"text-sm font-medium text-gray-900"},Ci={class:"text-xs text-gray-500"},Ri={class:"flex items-center space-x-3 p-3 bg-blue-50 rounded-lg"},Mi=["src","alt"],Pi={class:"text-sm font-medium text-blue-900"},Si=lt(()=>e("p",{class:"text-xs text-blue-600"}," Vía organización ",-1)),Di={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-gray-500 mb-4"},Ii={class:"flex items-center"},Li={class:"flex items-center"},ji={class:"flex items-center"},Oi={class:"flex items-center"},Ni={key:0,class:"text-xs text-gray-500 mb-3"},Ai=lt(()=>e("span",{class:"font-medium"},"Última actualización:",-1)),Ui={class:"w-full bg-gray-200 rounded-full h-1.5 mb-2"},Vi={class:"text-xs text-gray-500"},Ti={__name:"CorporateRequestCard",props:{request:{type:Object,required:!0}},emits:["view-detail","status-updated"],setup(t,{emit:o}){const s=t,n=o,d=R(!1),i=R(!1),g=D(()=>{var _;return((_=s.request.client_info)==null?void 0:_.profile_image_url)||J}),h=D(()=>{var _;return((_=s.request.organization_info)==null?void 0:_.profile_image_url)||J}),m=D(()=>[{value:"PENDING",label:"Pendiente"},{value:"IN_REVIEW",label:"En Revisión"},{value:"RESPONDED",label:"Respondida"},{value:"RESOLVED",label:"Resuelta"},{value:"CLOSED",label:"Cerrada"}]),x=()=>{n("view-detail",s.request.id)},v=async _=>{if(_===s.request.status){d.value=!1;return}try{i.value=!0,d.value=!1,n("status-updated",{requestId:s.request.id,newStatus:_,request:s.request})}catch($){console.error("Error updating status:",$)}finally{i.value=!1}},p=_=>({PENDING:"Pendiente",IN_REVIEW:"En Revisión",RESPONDED:"Respondida",RESOLVED:"Resuelta",CLOSED:"Cerrada"})[_]||_,b=_=>({PENDING:"bg-yellow-100 text-yellow-800",IN_REVIEW:"bg-blue-100 text-blue-800",RESPONDED:"bg-purple-100 text-purple-800",RESOLVED:"bg-green-100 text-green-800",CLOSED:"bg-gray-100 text-gray-800"})[_]||"bg-gray-100 text-gray-800",f=_=>({LOW:"Baja",MEDIUM:"Media",HIGH:"Alta",URGENT:"Urgente"})[_]||_,E=_=>({LOW:"bg-gray-100 text-gray-600",MEDIUM:"bg-blue-100 text-blue-600",HIGH:"bg-orange-100 text-orange-600",URGENT:"bg-red-100 text-red-600"})[_]||"bg-gray-100 text-gray-600",w=_=>({PENDING:20,IN_REVIEW:40,RESPONDED:60,RESOLVED:80,CLOSED:100})[_]||0,C=_=>({PENDING:"bg-yellow-500",IN_REVIEW:"bg-blue-500",RESPONDED:"bg-purple-500",RESOLVED:"bg-green-500",CLOSED:"bg-gray-500"})[_]||"bg-gray-500",M=_=>({PENDING:"La solicitud está esperando revisión inicial",IN_REVIEW:"La solicitud está siendo analizada por el equipo",RESPONDED:"Se ha proporcionado una respuesta al cliente",RESOLVED:"La solicitud ha sido completada satisfactoriamente",CLOSED:"La solicitud ha sido cerrada y archivada"})[_]||"Estado desconocido",z=_=>{const $=new Date(_),O=Math.abs(new Date-$),S=Math.ceil(O/(1e3*60*60*24));return S===0?"Hoy":S===1?"Ayer":S<7?`Hace ${S} días`:S<30?`Hace ${Math.ceil(S/7)} semanas`:$.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})};return(_,$)=>{var P,O,S,L,oe;return a(),r("div",mi,[e("div",gi,[e("div",fi,[e("div",hi,[e("span",vi,l(t.request.request_number),1),e("span",{class:T([b(t.request.status),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(p(t.request.status)),3),e("span",{class:T([E(t.request.priority),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(f(t.request.priority)),3)]),e("h3",pi,l(t.request.title),1),e("p",_i,l(t.request.description),1)]),e("div",bi,[e("button",{onClick:x,class:"inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(je),{class:"h-3 w-3 mr-1"}),y(" Ver Detalle ")]),e("div",yi,[e("button",{onClick:$[0]||($[0]=k=>d.value=!d.value),class:"inline-flex items-center px-3 py-1 border border-blue-300 text-xs font-medium rounded text-blue-700 bg-blue-50 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(Oe),{class:"h-3 w-3 mr-1"}),y(" Cambiar Estado ")]),d.value?(a(),r("div",xi,[e("div",wi,[(a(!0),r(Z,null,Q(m.value,k=>(a(),r("button",{key:k.value,onClick:V=>v(k.value),disabled:i.value,class:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 disabled:opacity-50"},[e("span",{class:T([b(k.value),"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium mr-2"])},l(k.label),3)],8,$i))),128))])])):q("",!0)])])]),e("div",zi,[e("div",Ei,[e("img",{src:g.value,alt:`Avatar de ${(P=t.request.client_info)==null?void 0:P.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,ki),e("div",null,[e("p",qi,l((O=t.request.client_info)==null?void 0:O.full_name),1),e("p",Ci," Cliente • "+l((S=t.request.client_info)==null?void 0:S.email),1)])]),e("div",Ri,[e("img",{src:h.value,alt:`Logo de ${(L=t.request.organization_info)==null?void 0:L.title}`,class:"h-8 w-8 rounded-full object-cover border border-blue-200"},null,8,Mi),e("div",null,[e("p",Pi,l(((oe=t.request.organization_info)==null?void 0:oe.title)||"Organización"),1),Si])])]),e("div",Di,[e("div",Ii,[u(c(ot),{class:"h-3 w-3 mr-1"}),y(" "+l(t.request.request_type_name),1)]),e("div",Li,[u(c(le),{class:"h-3 w-3 mr-1"}),y(" "+l(z(t.request.created_at)),1)]),e("div",ji,[u(c(We),{class:"h-3 w-3 mr-1"}),y(" "+l(t.request.response_count)+" respuestas ",1)]),e("div",Oi,[u(c(Ge),{class:"h-3 w-3 mr-1"}),y(" "+l(t.request.days_since_created)+" días ",1)])]),t.request.status_updated_at&&t.request.status_updated_at!==t.request.created_at?(a(),r("div",Ni,[Ai,y(" "+l(z(t.request.status_updated_at)),1)])):q("",!0),e("div",Ui,[e("div",{class:T([C(t.request.status),"h-1.5 rounded-full transition-all duration-300"]),style:et({width:w(t.request.status)+"%"})},null,6)]),e("p",Vi,l(M(t.request.status)),1),d.value?(a(),r("div",{key:1,onClick:$[1]||($[1]=k=>d.value=!1),class:"fixed inset-0 z-0"})):q("",!0)])}}},Gi=Me(Ti,[["__scopeId","data-v-f2bdb849"]]),Bi={class:"mb-6"},Fi={class:"flex items-center justify-between"},Hi=e("div",null,[e("h2",{class:"text-lg font-medium text-gray-900"},"Solicitudes Recibidas"),e("p",{class:"mt-1 text-sm text-gray-600"}," Gestiona todas las solicitudes enviadas por tus clientes ")],-1),Wi=["disabled"],Zi={class:"mb-6 bg-gray-50 rounded-lg p-4"},Ji={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Qi=e("label",{for:"status-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Estado ",-1),Yi=xe('<option value="">Todos los estados</option><option value="PENDING">Pendiente</option><option value="IN_REVIEW">En Revisión</option><option value="RESPONDED">Respondida</option><option value="RESOLVED">Resuelta</option><option value="CLOSED">Cerrada</option>',6),Xi=[Yi],Ki=e("label",{for:"priority-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Prioridad ",-1),en=xe('<option value="">Todas las prioridades</option><option value="LOW">Baja</option><option value="MEDIUM">Media</option><option value="HIGH">Alta</option><option value="URGENT">Urgente</option>',5),tn=[en],sn=e("label",{for:"organization-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Organización ",-1),on=e("option",{value:""},"Todas las organizaciones",-1),an=["value"],nn=e("label",{for:"search",class:"block text-sm font-medium text-gray-700 mb-1"}," Buscar ",-1),rn={class:"mt-4 flex flex-wrap gap-4 text-sm text-gray-600"},ln={key:0,class:"flex justify-center items-center py-8"},cn=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),dn=e("span",{class:"ml-2 text-gray-600"},"Cargando solicitudes...",-1),un=[cn,dn],mn={key:1,class:"space-y-4"},gn={key:0,class:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 mt-6"},fn={class:"flex flex-1 justify-between sm:hidden"},hn=["disabled"],vn=["disabled"],pn={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},_n={class:"text-sm text-gray-700"},bn={class:"font-medium"},yn={class:"font-medium"},xn={class:"font-medium"},wn={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},$n=["disabled"],zn=["onClick"],En=["disabled"],kn={key:2,class:"text-center py-12"},qn={class:"text-lg font-medium text-gray-900 mb-2"},Cn={class:"text-gray-600 mb-6"},Rn={key:0},Mn={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto"},Pn={class:"flex"},Sn=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Por qué no hay solicitudes?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Asegúrate de tener organizaciones creadas"),e("p",null,"• Los miembros deben enviar solicitudes a través de tus organizaciones"),e("p",null,"• Las solicitudes aparecerán automáticamente aquí")])],-1),Dn={__name:"ReceivedRequestsSection",props:{requests:{type:Array,default:()=>[]},organizations:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["view-detail","status-updated","refresh"],setup(t,{emit:o}){const s=t,n=o,d=R(""),i=R(""),g=R(""),h=R(""),m=R(1),x=R(10),v=D(()=>{let k=[...s.requests];if(d.value&&(k=k.filter(V=>V.status===d.value)),i.value&&(k=k.filter(V=>V.priority===i.value)),g.value&&(k=k.filter(V=>{var U;return((U=V.organization_info)==null?void 0:U.id)===parseInt(g.value)})),h.value.trim()){const V=h.value.toLowerCase().trim();k=k.filter(U=>{var I,A;return U.title.toLowerCase().includes(V)||U.request_number.toLowerCase().includes(V)||((I=U.client_name)==null?void 0:I.toLowerCase().includes(V))||((A=U.description)==null?void 0:A.toLowerCase().includes(V))})}return k.sort((V,U)=>new Date(U.created_at)-new Date(V.created_at))}),p=D(()=>Math.ceil(v.value.length/x.value)),b=D(()=>(m.value-1)*x.value+1),f=D(()=>Math.min(m.value*x.value,v.value.length)),E=D(()=>{const k=(m.value-1)*x.value,V=k+x.value;return v.value.slice(k,V)}),w=D(()=>{const k=[];let U=Math.max(1,m.value-Math.floor(2.5)),I=Math.min(p.value,U+5-1);I-U+1<5&&(U=Math.max(1,I-5+1));for(let A=U;A<=I;A++)k.push(A);return k}),C=D(()=>v.value.filter(k=>k.status==="PENDING").length),M=D(()=>v.value.filter(k=>k.status==="IN_REVIEW").length),z=D(()=>v.value.filter(k=>k.priority==="URGENT").length),_=D(()=>s.requests.length===0?"No has recibido solicitudes":"No se encontraron solicitudes"),$=D(()=>s.requests.length===0?"Cuando tus clientes envíen solicitudes a través de tus organizaciones, aparecerán aquí para que las gestiones.":"No hay solicitudes que coincidan con los filtros seleccionados. Intenta ajustar los criterios de búsqueda."),P=k=>{n("view-detail",k)},O=k=>{n("status-updated",k)},S=()=>{n("refresh")},L=()=>{m.value=1},oe=()=>{d.value="",i.value="",g.value="",h.value="",m.value=1};return te(v,()=>{m.value>p.value&&p.value>0&&(m.value=1)}),(k,V)=>(a(),r("div",null,[e("div",Bi,[e("div",Fi,[Hi,e("button",{onClick:S,disabled:t.isLoading,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},[u(c(Oe),{class:T([t.isLoading?"animate-spin":"","h-4 w-4 mr-2"])},null,8,["class"]),y(" Actualizar ")],8,Wi)])]),e("div",Zi,[e("div",Ji,[e("div",null,[Qi,F(e("select",{id:"status-filter","onUpdate:modelValue":V[0]||(V[0]=U=>d.value=U),onChange:L,class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},Xi,544),[[ue,d.value]])]),e("div",null,[Ki,F(e("select",{id:"priority-filter","onUpdate:modelValue":V[1]||(V[1]=U=>i.value=U),onChange:L,class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},tn,544),[[ue,i.value]])]),e("div",null,[sn,F(e("select",{id:"organization-filter","onUpdate:modelValue":V[2]||(V[2]=U=>g.value=U),onChange:L,class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},[on,(a(!0),r(Z,null,Q(t.organizations,U=>(a(),r("option",{key:U.id,value:U.id},l(U.title),9,an))),128))],544),[[ue,g.value]])]),e("div",null,[nn,F(e("input",{id:"search","onUpdate:modelValue":V[3]||(V[3]=U=>h.value=U),onInput:L,type:"text",placeholder:"Buscar por título, cliente...",class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},null,544),[[ae,h.value]])])]),e("div",rn,[e("span",null,[y("Total: "),e("strong",null,l(v.value.length),1)]),e("span",null,[y("Pendientes: "),e("strong",null,l(C.value),1)]),e("span",null,[y("En Revisión: "),e("strong",null,l(M.value),1)]),e("span",null,[y("Urgentes: "),e("strong",null,l(z.value),1)])])]),t.isLoading?(a(),r("div",ln,un)):v.value.length>0?(a(),r("div",mn,[(a(!0),r(Z,null,Q(E.value,U=>(a(),G(Gi,{key:U.id,request:U,onViewDetail:P,onStatusUpdated:O},null,8,["request"]))),128)),p.value>1?(a(),r("div",gn,[e("div",fn,[e("button",{onClick:V[4]||(V[4]=U=>m.value>1&&m.value--),disabled:m.value<=1,class:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50"}," Anterior ",8,hn),e("button",{onClick:V[5]||(V[5]=U=>m.value<p.value&&m.value++),disabled:m.value>=p.value,class:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50"}," Siguiente ",8,vn)]),e("div",pn,[e("div",null,[e("p",_n,[y(" Mostrando "),e("span",bn,l(b.value),1),y(" a "),e("span",yn,l(f.value),1),y(" de "),e("span",xn,l(v.value.length),1),y(" resultados ")])]),e("div",null,[e("nav",wn,[e("button",{onClick:V[6]||(V[6]=U=>m.value>1&&m.value--),disabled:m.value<=1,class:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50"},[u(c(mt),{class:"h-5 w-5"})],8,$n),(a(!0),r(Z,null,Q(w.value,U=>(a(),r("button",{key:U,onClick:I=>m.value=U,class:T([U===m.value?"relative z-10 inline-flex items-center bg-blue-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600":"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"])},l(U),11,zn))),128)),e("button",{onClick:V[7]||(V[7]=U=>m.value<p.value&&m.value++),disabled:m.value>=p.value,class:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50"},[u(c(vt),{class:"h-5 w-5"})],8,En)])])])])):q("",!0)])):(a(),r("div",kn,[u(c(Ne),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e("h3",qn,l(_.value),1),e("p",Cn,l($.value),1),t.requests.length>0?(a(),r("div",Rn,[e("button",{onClick:oe,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(ce),{class:"h-4 w-4 mr-2"}),y(" Limpiar Filtros ")])])):(a(),r("div",Mn,[e("div",Pn,[u(c(me),{class:"h-5 w-5 text-blue-400 mt-0.5"}),Sn])]))]))]))}},Ze=Ve("organizationPosts",{state:()=>({managementPosts:[],publicPosts:[],currentPost:null,isLoading:!1,isLoadingPosts:!1,isCreatingPost:!1,isUpdatingPost:!1,isDeletingPost:!1,pagination:{count:0,next:null,previous:null,currentPage:1,pageSize:10},filters:{is_active:null,is_pinned:null,search:"",page:1,page_size:10}}),getters:{sortedManagementPosts:t=>[...t.managementPosts].sort((o,s)=>o.is_pinned&&!s.is_pinned?-1:!o.is_pinned&&s.is_pinned?1:new Date(s.created_at)-new Date(o.created_at)),sortedPublicPosts:t=>[...t.publicPosts].sort((o,s)=>o.is_pinned&&!s.is_pinned?-1:!o.is_pinned&&s.is_pinned?1:new Date(s.created_at)-new Date(o.created_at)),activePostsCount:t=>t.managementPosts.filter(o=>o.is_active).length,pinnedPostsCount:t=>t.managementPosts.filter(o=>o.is_pinned).length},actions:{async createPost(t,o){try{this.isCreatingPost=!0;const s=await re(`organizations/${t}/posts/create/`,o);if(s.status===201){const n=s.data.post;return this.managementPosts.unshift(n),this.currentPost=n,s.data}throw new Error("Error creating post")}catch(s){throw console.error("Error creating post:",s),s}finally{this.isCreatingPost=!1}},async getManagementPosts(t,o={}){try{this.isLoadingPosts=!0;const s=new URLSearchParams;Object.keys(o).forEach(i=>{o[i]!==null&&o[i]!==void 0&&o[i]!==""&&s.append(i,o[i])});const n=`organizations/${t}/posts/${s.toString()?"?"+s.toString():""}`,d=await X(n);if(d.status===200)return this.managementPosts=d.data.results||d.data,d.data.count!==void 0&&(this.pagination={count:d.data.count,next:d.data.next,previous:d.data.previous,currentPage:o.page||1,pageSize:o.page_size||10}),d.data;throw new Error("Error fetching management posts")}catch(s){throw console.error("Error fetching management posts:",s),s}finally{this.isLoadingPosts=!1}},async getPublicPosts(t,o={}){try{this.isLoadingPosts=!0;const s=new URLSearchParams;Object.keys(o).forEach(i=>{o[i]!==null&&o[i]!==void 0&&o[i]!==""&&s.append(i,o[i])});const n=`organizations/${t}/posts/public/${s.toString()?"?"+s.toString():""}`,d=await X(n);if(d.status===200)return this.publicPosts=d.data.results||d.data,d.data.count!==void 0&&(this.pagination={count:d.data.count,next:d.data.next,previous:d.data.previous,currentPage:o.page||1,pageSize:o.page_size||10}),d.data;throw new Error("Error fetching public posts")}catch(s){throw console.error("Error fetching public posts:",s),s}finally{this.isLoadingPosts=!1}},async getPostDetail(t,o){try{this.isLoading=!0;const s=await X(`organizations/${t}/posts/${o}/`);if(s.status===200){this.currentPost=s.data.post||s.data;const n=this.managementPosts.findIndex(d=>d.id===o);return n>=0&&(this.managementPosts[n]=this.currentPost),s.data}throw new Error("Error fetching post detail")}catch(s){throw console.error("Error fetching post detail:",s),s}finally{this.isLoading=!1}},async updatePost(t,o,s){try{this.isUpdatingPost=!0;const n=await Te(`organizations/${t}/posts/${o}/update/`,s);if(n.status===200){const d=n.data.post||n.data,i=this.managementPosts.findIndex(g=>g.id===o);return i>=0&&(this.managementPosts[i]=d),this.currentPost&&this.currentPost.id===o&&(this.currentPost=d),n.data}throw new Error("Error updating post")}catch(n){throw console.error("Error updating post:",n),n}finally{this.isUpdatingPost=!1}},async deletePost(t,o){try{this.isDeletingPost=!0;const s=await Se(`organizations/${t}/posts/${o}/delete/`);if(s.status===200||s.status===204)return this.managementPosts=this.managementPosts.filter(n=>n.id!==o),this.currentPost&&this.currentPost.id===o&&(this.currentPost=null),s.data||{message:"Post eliminado exitosamente"};throw new Error("Error deleting post")}catch(s){throw console.error("Error deleting post:",s),s}finally{this.isDeletingPost=!1}},async togglePinPost(t,o){try{this.isLoading=!0;const s=await re(`organizations/${t}/posts/${o}/toggle-pin/`,{});if(s.status===200){const n=s.data.post,d=this.managementPosts.findIndex(i=>i.id===o);return d>=0&&(this.managementPosts[d]=n),this.currentPost&&this.currentPost.id===o&&(this.currentPost=n),s.data}throw new Error("Error toggling post pin status")}catch(s){throw console.error("Error toggling post pin status:",s),s}finally{this.isLoading=!1}},async togglePostStatus(t,o){try{this.isLoading=!0;const s=await re(`organizations/${t}/posts/${o}/toggle-status/`,{});if(s.status===200){const n=s.data.post,d=this.managementPosts.findIndex(i=>i.id===o);return d>=0&&(this.managementPosts[d]=n),this.currentPost&&this.currentPost.id===o&&(this.currentPost=n),s.data}throw new Error("Error toggling post status")}catch(s){throw console.error("Error toggling post status:",s),s}finally{this.isLoading=!1}},setFilters(t){this.filters={...this.filters,...t}},clearFilters(){this.filters={is_active:null,is_pinned:null,search:"",page:1,page_size:10}},clearPosts(){this.managementPosts=[],this.publicPosts=[],this.currentPost=null,this.pagination={count:0,next:null,previous:null,currentPage:1,pageSize:10}},clearAll(){this.clearPosts(),this.clearFilters(),this.isLoading=!1,this.isLoadingPosts=!1,this.isCreatingPost=!1,this.isUpdatingPost=!1,this.isDeletingPost=!1}}}),In={class:"bg-white shadow rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow"},Ln={class:"flex items-start justify-between mb-4"},jn={class:"flex-1 min-w-0"},On={class:"flex items-center space-x-2 mb-2"},Nn={class:"text-lg font-semibold text-gray-900 truncate"},An={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800"},Un={class:"text-sm text-gray-500 mb-3"},Vn={class:"relative"},Tn={key:0,class:"absolute right-0 mt-1 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none z-10"},Gn={class:"py-1"},Bn=e("div",{class:"border-t border-gray-100"},null,-1),Fn={class:"mb-4"},Hn={class:"text-gray-700 whitespace-pre-wrap"},Wn={key:0,class:"mb-4"},Zn=["href"],Jn={class:"flex items-center justify-between text-xs text-gray-500 pt-4 border-t border-gray-100"},Qn={class:"flex items-center space-x-4"},Yn={class:"flex items-center"},Xn={key:0,class:"flex items-center text-yellow-600"},Kn={class:"flex items-center space-x-2"},er={__name:"CorporatePostCard",props:{post:{type:Object,required:!0},organizationId:{type:Number,required:!0}},emits:["edit","delete","toggle-pin","toggle-status"],setup(t,{emit:o}){const s=t,n=o,d=R(!1),i=()=>{d.value=!1,n("edit",s.post)},g=()=>{d.value=!1,n("delete",s.post)},h=()=>{d.value=!1,n("toggle-pin",s.post)},m=()=>{d.value=!1,n("toggle-status",s.post)},x=p=>new Date(p).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),v=p=>{const b=new Date(p),E=Math.abs(new Date-b),w=Math.ceil(E/(1e3*60*60*24));return w===0?"hoy":w===1?"ayer":w<7?`hace ${w} días`:w<30?`hace ${Math.ceil(w/7)} semanas`:`el ${x(p)}`};return(p,b)=>(a(),r("div",In,[e("div",Ln,[e("div",jn,[e("div",On,[e("h3",Nn,l(t.post.title),1),t.post.is_pinned?(a(),r("span",An,[u(c(Ee),{class:"h-3 w-3 mr-1"}),y(" Fijado ")])):q("",!0),e("span",{class:T([t.post.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800","inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"])},l(t.post.is_active?"Activo":"Inactivo"),3)]),e("p",Un," Creado "+l(v(t.post.created_at)),1)]),e("div",Vn,[e("button",{onClick:b[0]||(b[0]=f=>d.value=!d.value),class:"inline-flex items-center p-2 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 rounded-full"},[u(c(pt),{class:"h-5 w-5"})]),d.value?(a(),r("div",Tn,[e("div",Gn,[e("button",{onClick:i,class:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},[u(c(it),{class:"h-4 w-4 mr-3"}),y(" Editar ")]),e("button",{onClick:h,class:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},[u(c(Ee),{class:"h-4 w-4 mr-3"}),y(" "+l(t.post.is_pinned?"Desfijar":"Fijar"),1)]),e("button",{onClick:m,class:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},[(a(),G(tt(t.post.is_active?c(wt):c(je)),{class:"h-4 w-4 mr-3"})),y(" "+l(t.post.is_active?"Desactivar":"Activar"),1)]),Bn,e("button",{onClick:g,class:"flex items-center w-full px-4 py-2 text-sm text-red-700 hover:bg-red-50"},[u(c(_t),{class:"h-4 w-4 mr-3"}),y(" Eliminar ")])])])):q("",!0)])]),e("div",Fn,[e("p",Hn,l(t.post.content),1)]),t.post.has_link&&t.post.link_url?(a(),r("div",Wn,[e("a",{href:t.post.link_url,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-3 py-2 border border-blue-300 text-sm font-medium rounded-md text-blue-700 bg-blue-50 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(st),{class:"h-4 w-4 mr-2"}),y(" "+l(t.post.link_name||"Ver enlace")+" ",1),u(c(He),{class:"h-3 w-3 ml-1"})],8,Zn)])):q("",!0),e("div",Jn,[e("div",Qn,[e("span",Yn,[u(c(le),{class:"h-3 w-3 mr-1"}),y(" "+l(x(t.post.created_at)),1)]),t.post.is_pinned?(a(),r("span",Xn,[u(c(Ee),{class:"h-3 w-3 mr-1"}),y(" Fijado ")])):q("",!0)]),e("div",Kn,[e("span",{class:T(t.post.is_active?"text-green-600":"text-red-600")},l(t.post.is_active?"Visible para miembros":"Oculto para miembros"),3)])]),d.value?(a(),r("div",{key:1,onClick:b[1]||(b[1]=f=>d.value=!1),class:"fixed inset-0 z-0"})):q("",!0)]))}},tr=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),sr={class:"fixed inset-0 z-10 overflow-y-auto"},or={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},ar={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},ir={class:"mt-1 text-sm text-gray-500"},nr={key:0,class:"flex justify-center items-center py-8"},rr=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),lr={class:"ml-2 text-gray-600"},cr=e("label",{for:"title",class:"block text-sm font-medium leading-6 text-gray-900"}," Título * ",-1),dr={class:"mt-2"},ur={key:0,class:"mt-1 text-sm text-red-600"},mr=e("label",{for:"content",class:"block text-sm font-medium leading-6 text-gray-900"}," Contenido * ",-1),gr={class:"mt-2"},fr=e("p",{class:"mt-1 text-xs text-gray-500"}," Proporciona información clara y útil para los miembros de la organización ",-1),hr={key:0,class:"mt-1 text-sm text-red-600"},vr={class:"border-t border-gray-200 pt-6"},pr={class:"flex items-center justify-between mb-4"},_r=e("h4",{class:"text-md font-medium text-gray-900"},"Enlace Opcional",-1),br={key:0,class:"space-y-4"},yr=e("label",{for:"link_name",class:"block text-sm font-medium leading-6 text-gray-900"}," Texto del Enlace ",-1),xr={class:"mt-2"},wr={key:0,class:"mt-1 text-sm text-red-600"},$r=e("label",{for:"link_url",class:"block text-sm font-medium leading-6 text-gray-900"}," URL del Enlace ",-1),zr={class:"mt-2"},Er=e("p",{class:"mt-1 text-xs text-gray-500"}," Debe incluir http:// o https:// ",-1),kr={key:0,class:"mt-1 text-sm text-red-600"},qr=e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-3"},[e("p",{class:"text-sm text-yellow-800"},[e("strong",null,"Nota:"),y(" Si agregas un enlace, tanto el texto como la URL son obligatorios. ")])],-1),Cr={class:"border-t border-gray-200 pt-6"},Rr=e("h4",{class:"text-md font-medium text-gray-900 mb-4"},"Opciones",-1),Mr={class:"space-y-3"},Pr={class:"flex items-center"},Sr=e("label",{for:"is_pinned",class:"ml-2 text-sm text-gray-700"}," Fijar post (aparecerá en la parte superior) ",-1),Dr={key:0,class:"flex items-center"},Ir=e("label",{for:"is_active",class:"ml-2 text-sm text-gray-700"}," Post activo (visible para los miembros) ",-1),Lr={key:0,class:"border-t border-gray-200 pt-6"},jr=e("h4",{class:"text-md font-medium text-gray-900 mb-4"},"Vista Previa",-1),Or={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},Nr={class:"flex items-center space-x-2 mb-2"},Ar={class:"text-lg font-semibold text-gray-900"},Ur={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800"},Vr={class:"text-gray-700 whitespace-pre-wrap mb-3"},Tr={key:0,class:"inline-flex items-center px-3 py-2 border border-blue-300 text-sm font-medium rounded-md text-blue-700 bg-blue-50"},Gr={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},Br=["disabled"],Fr={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Hr={__name:"PostFormModal",props:{visible:{type:Boolean,default:!1},post:{type:Object,default:null},organizationId:{type:Number,required:!0}},emits:["close","saved"],setup(t,{emit:o}){const s=t,n=o,d=Ze(),i=R(!1),g=R({}),h=R(!1),m=R({title:"",content:"",link_name:"",link_url:"",is_pinned:!1,is_active:!0}),x=D(()=>!!s.post),v=D(()=>{const E=m.value.title.trim(),w=m.value.content.trim(),C=!m.value.link_name&&!m.value.link_url||m.value.link_name.trim()&&m.value.link_url.trim();return E&&w&&C}),p=()=>{s.post?(m.value={title:s.post.title||"",content:s.post.content||"",link_name:s.post.link_name||"",link_url:s.post.link_url||"",is_pinned:s.post.is_pinned||!1,is_active:s.post.is_active!==void 0?s.post.is_active:!0},h.value=!!(s.post.link_name||s.post.link_url)):(m.value={title:"",content:"",link_name:"",link_url:"",is_pinned:!1,is_active:!0},h.value=!1),g.value={}},b=async()=>{var E,w,C,M;try{i.value=!0,g.value={};const z=m.value.link_name.trim(),_=m.value.link_url.trim();if(z&&!_||!z&&_){j("Si agregas un enlace, tanto el texto como la URL son obligatorios","warning");return}const $={title:m.value.title.trim(),content:m.value.content.trim(),is_pinned:m.value.is_pinned};z&&_&&($.link_name=m.value.link_name.trim(),$.link_url=m.value.link_url.trim()),x.value&&($.is_active=m.value.is_active);let P;x.value?(P=await d.updatePost(s.organizationId,s.post.id,$),j("Post actualizado exitosamente","success")):(P=await d.createPost(s.organizationId,$),j("Post creado exitosamente","success")),n("saved",P)}catch(z){console.error("Error saving post:",z),(w=(E=z.response)==null?void 0:E.data)!=null&&w.details?g.value=z.response.data.details:(M=(C=z.response)==null?void 0:C.data)!=null&&M.error?j(z.response.data.error,"error"):j(`Error al ${x.value?"actualizar":"crear"} el post`,"error")}finally{i.value=!1}},f=()=>{i.value||n("close")};return te(()=>s.visible,E=>{E&&qe(()=>{p()})}),te(()=>s.post,()=>{s.visible&&p()}),(E,w)=>(a(),G(c(pe),{as:"template",show:t.visible},{default:N(()=>[u(c(fe),{class:"relative z-50",onClose:f},{default:N(()=>[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:N(()=>[tr]),_:1}),e("div",sr,[e("div",or,[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:N(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6"},{default:N(()=>[e("div",ar,[e("div",null,[u(c(ve),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:N(()=>[y(l(x.value?"Editar Post":"Crear Nuevo Post"),1)]),_:1}),e("p",ir,l(x.value?"Modifica la información del post":"Comparte información importante con los miembros"),1)]),e("button",{onClick:f,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(c(ce),{class:"h-6 w-6"})])]),i.value?(a(),r("div",nr,[rr,e("span",lr,l(x.value?"Actualizando...":"Creando..."),1)])):(a(),r("form",{key:1,onSubmit:be(b,["prevent"]),class:"space-y-6"},[e("div",null,[cr,e("div",dr,[F(e("input",{id:"title","onUpdate:modelValue":w[0]||(w[0]=C=>m.value.title=C),type:"text",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ej: Anuncio importante sobre nuevas políticas"},null,512),[[ae,m.value.title]])]),g.value.title?(a(),r("p",ur,l(g.value.title[0]),1)):q("",!0)]),e("div",null,[mr,e("div",gr,[F(e("textarea",{id:"content","onUpdate:modelValue":w[1]||(w[1]=C=>m.value.content=C),rows:"5",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Escribe el contenido del post..."},null,512),[[ae,m.value.content]])]),fr,g.value.content?(a(),r("p",hr,l(g.value.content[0]),1)):q("",!0)]),e("div",vr,[e("div",pr,[_r,e("button",{type:"button",onClick:w[2]||(w[2]=C=>h.value=!h.value),class:"text-sm text-blue-600 hover:text-blue-800 font-medium"},l(h.value?"Ocultar enlace":"Agregar enlace"),1)]),h.value?(a(),r("div",br,[e("div",null,[yr,e("div",xr,[F(e("input",{id:"link_name","onUpdate:modelValue":w[3]||(w[3]=C=>m.value.link_name=C),type:"text",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ej: Ver documento completo"},null,512),[[ae,m.value.link_name]])]),g.value.link_name?(a(),r("p",wr,l(g.value.link_name[0]),1)):q("",!0)]),e("div",null,[$r,e("div",zr,[F(e("input",{id:"link_url","onUpdate:modelValue":w[4]||(w[4]=C=>m.value.link_url=C),type:"url",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"https://ejemplo.com/documento"},null,512),[[ae,m.value.link_url]])]),Er,g.value.link_url?(a(),r("p",kr,l(g.value.link_url[0]),1)):q("",!0)]),qr])):q("",!0)]),e("div",Cr,[Rr,e("div",Mr,[e("div",Pr,[F(e("input",{id:"is_pinned","onUpdate:modelValue":w[5]||(w[5]=C=>m.value.is_pinned=C),type:"checkbox",class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[Ue,m.value.is_pinned]]),Sr]),x.value?(a(),r("div",Dr,[F(e("input",{id:"is_active","onUpdate:modelValue":w[6]||(w[6]=C=>m.value.is_active=C),type:"checkbox",class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[Ue,m.value.is_active]]),Ir])):q("",!0)])]),m.value.title||m.value.content?(a(),r("div",Lr,[jr,e("div",Or,[e("div",Nr,[e("h5",Ar,l(m.value.title||"Título del post"),1),m.value.is_pinned?(a(),r("span",Ur," Fijado ")):q("",!0)]),e("p",Vr,l(m.value.content||"Contenido del post..."),1),m.value.link_name&&m.value.link_url?(a(),r("div",Tr,[y(l(m.value.link_name)+" ",1),u(c(He),{class:"h-3 w-3 ml-1"})])):q("",!0)])])):q("",!0),e("div",Gr,[e("button",{type:"button",onClick:f,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value||!v.value,class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),r("div",Fr)):(a(),G(c(Fe),{key:1,class:"h-4 w-4 mr-2"})),y(" "+l(i.value?x.value?"Actualizando...":"Creando...":x.value?"Actualizar Post":"Crear Post"),1)],8,Br)])],32))]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},Wr=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),Zr={class:"fixed inset-0 z-10 overflow-y-auto"},Jr={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},Qr={class:"sm:flex sm:items-start"},Yr={class:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left"},Xr={class:"mt-2"},Kr={class:"text-sm text-gray-500"},el={class:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},tl=["disabled"],sl={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},ol=["disabled"],ct={__name:"ConfirmationModal",props:{visible:{type:Boolean,default:!1},title:{type:String,required:!0},message:{type:String,required:!0},confirmText:{type:String,default:"Confirmar"},cancelText:{type:String,default:"Cancelar"},confirmColor:{type:String,default:"yellow",validator:t=>["red","yellow"].includes(t)},isLoading:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:o}){const s=t,n=o,d=()=>{s.isLoading||n("confirm")},i=()=>{s.isLoading||n("cancel")};return(g,h)=>(a(),G(c(pe),{as:"template",show:t.visible},{default:N(()=>[u(c(fe),{class:"relative z-50",onClose:i},{default:N(()=>[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:N(()=>[Wr]),_:1}),e("div",Zr,[e("div",Jr,[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:N(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"},{default:N(()=>[e("div",Qr,[e("div",{class:T(["mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full sm:mx-0 sm:h-10 sm:w-10",t.confirmColor==="red"?"bg-red-100":"bg-yellow-100"])},[u(c(bt),{class:T(["h-6 w-6",t.confirmColor==="red"?"text-red-600":"text-yellow-600"])},null,8,["class"])],2),e("div",Yr,[u(c(ve),{as:"h3",class:"text-base font-semibold leading-6 text-gray-900"},{default:N(()=>[y(l(t.title),1)]),_:1}),e("div",Xr,[e("p",Kr,l(t.message),1)])])]),e("div",el,[e("button",{type:"button",onClick:d,disabled:t.isLoading,class:T(["inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",t.confirmColor==="red"?"bg-red-600 hover:bg-red-500 focus-visible:outline-red-600":"bg-yellow-600 hover:bg-yellow-500 focus-visible:outline-yellow-600"])},[t.isLoading?(a(),r("div",sl)):q("",!0),y(" "+l(t.isLoading?"Procesando...":t.confirmText),1)],10,tl),e("button",{type:"button",onClick:i,disabled:t.isLoading,class:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed"},l(t.cancelText),9,ol)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},al={class:"mb-6"},il={class:"flex items-center justify-between"},nl=e("div",null,[e("h2",{class:"text-lg font-medium text-gray-900"},"Posts de la Organización"),e("p",{class:"mt-1 text-sm text-gray-600"}," Comparte anuncios e información importante con los miembros ")],-1),rl={class:"flex space-x-3"},ll=["disabled"],cl={key:0,class:"flex justify-center items-center py-8"},dl=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),ul=e("span",{class:"ml-2 text-gray-600"},"Cargando posts...",-1),ml=[dl,ul],gl={key:1,class:"space-y-4"},fl={key:2,class:"text-center py-12"},hl={class:"text-lg font-medium text-gray-900 mb-2"},vl={class:"text-gray-600 mb-6"},pl={key:0},_l={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto mt-6"},bl={class:"flex"},yl=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Cómo usar los posts?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Comparte anuncios importantes con tu equipo"),e("p",null,"• Incluye enlaces a documentos o recursos"),e("p",null,"• Fija posts importantes para mantenerlos arriba"),e("p",null,"• Activa/desactiva posts según sea necesario")])],-1),xl={__name:"OrganizationPostsSection",props:{organizationId:{type:Number,required:!0}},setup(t){const o=t,s=Ze(),n=R(!1),d=R(!1),i=R(null),g=D(()=>s.isLoadingPosts),h=D(()=>s.managementPosts),m=D(()=>s.sortedManagementPosts),x=D(()=>"No hay posts creados"),v=D(()=>"Crea tu primer post para compartir información importante con los miembros de tu organización."),p=async()=>{try{await s.getManagementPosts(o.organizationId)}catch(P){console.error("Error loading posts:",P),j("Error al cargar los posts","error")}},b=()=>{p()},f=()=>{i.value=null,n.value=!0},E=()=>{n.value=!1,i.value=null},w=P=>{i.value=P,n.value=!0},C=P=>{i.value=P,d.value=!0},M=async()=>{try{await s.deletePost(o.organizationId,i.value.id),j(`Post "${i.value.title}" eliminado exitosamente`,"success"),d.value=!1,i.value=null}catch(P){console.error("Error deleting post:",P),j("Error al eliminar el post","error")}},z=async P=>{try{await s.togglePinPost(o.organizationId,P.id);const O=P.is_pinned?"desfijado":"fijado";j(`Post ${O} exitosamente`,"success")}catch(O){console.error("Error toggling pin:",O),j("Error al cambiar el estado de fijado","error")}},_=async P=>{try{await s.togglePostStatus(o.organizationId,P.id);const O=P.is_active?"desactivado":"activado";j(`Post ${O} exitosamente`,"success")}catch(O){console.error("Error toggling status:",O),j("Error al cambiar el estado del post","error")}},$=()=>{E(),p()};return we(()=>{p()}),te(()=>o.organizationId,()=>{o.organizationId&&p()}),(P,O)=>{var S;return a(),r("div",null,[e("div",al,[e("div",il,[nl,e("div",rl,[e("button",{onClick:b,disabled:g.value,class:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},[u(c(Oe),{class:T([g.value?"animate-spin":"","h-4 w-4 mr-2"])},null,8,["class"]),y(" Actualizar ")],8,ll),e("button",{onClick:f,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(_e),{class:"h-4 w-4 mr-2"}),y(" Nuevo Post ")])])])]),g.value?(a(),r("div",cl,ml)):m.value.length>0?(a(),r("div",gl,[(a(!0),r(Z,null,Q(m.value,L=>(a(),G(er,{key:L.id,post:L,"organization-id":t.organizationId,onEdit:w,onDelete:C,onTogglePin:z,onToggleStatus:_},null,8,["post","organization-id"]))),128))])):(a(),r("div",fl,[u(c(Fe),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e("h3",hl,l(x.value),1),e("p",vl,l(v.value),1),h.value.length===0?(a(),r("div",pl,[e("button",{onClick:f,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(_e),{class:"h-4 w-4 mr-2"}),y(" Crear Primer Post ")]),e("div",_l,[e("div",bl,[u(c(me),{class:"h-5 w-5 text-blue-400 mt-0.5"}),yl])])])):q("",!0)])),u(Hr,{visible:n.value,post:i.value,"organization-id":t.organizationId,onClose:E,onSaved:$},null,8,["visible","post","organization-id"]),u(ct,{visible:d.value,title:`¿Eliminar post '${(S=i.value)==null?void 0:S.title}'?`,message:"Esta acción no se puede deshacer. El post será eliminado permanentemente.","confirm-text":"Sí, eliminar","confirm-color":"red","is-loading":c(s).isDeletingPost,onConfirm:M,onCancel:O[0]||(O[0]=L=>d.value=!1)},null,8,["visible","title","is-loading"])])}}},wl={class:"px-4 py-6 sm:px-6 lg:px-8"},$l={key:0,class:"flex justify-center items-center py-12"},zl=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),El=e("span",{class:"ml-2 text-gray-600"},"Cargando datos...",-1),kl=[zl,El],ql={key:1,class:"text-center py-12"},Cl={class:"mx-auto max-w-md"},Rl=e("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"})],-1),Ml=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Acceso Restringido",-1),Pl=e("p",{class:"mt-1 text-sm text-gray-500"}," Este dashboard es solo para clientes corporativos. ",-1),Sl={class:"mt-2 text-xs text-gray-400"},Dl={key:2},Il=e("div",{class:"mb-8"},[e("div",{class:"sm:flex sm:items-center sm:justify-between"},[e("div",null,[e("h1",{class:"text-2xl font-bold leading-6 text-gray-900"}," Panel Corporativo "),e("p",{class:"mt-2 text-sm text-gray-700"}," Gestiona tus organizaciones y solicitudes corporativas ")])])],-1),Ll={class:"mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4"},jl={class:"bg-white overflow-hidden shadow rounded-lg"},Ol={class:"p-5"},Nl={class:"flex items-center"},Al={class:"flex-shrink-0"},Ul={class:"ml-5 w-0 flex-1"},Vl=e("dt",{class:"text-sm font-medium text-gray-500 truncate"}," Organizaciones ",-1),Tl={class:"text-lg font-medium text-gray-900"},Gl={class:"p-5"},Bl={class:"flex items-center"},Fl={class:"flex-shrink-0"},Hl={class:"ml-5 w-0 flex-1"},Wl=e("dt",{class:"text-sm font-medium text-gray-500 truncate group-hover:text-blue-600 transition-colors"}," Miembros Totales ",-1),Zl={class:"text-lg font-medium text-gray-900 group-hover:text-blue-600 transition-colors"},Jl={class:"bg-white overflow-hidden shadow rounded-lg"},Ql={class:"p-5"},Yl={class:"flex items-center"},Xl={class:"flex-shrink-0"},Kl={class:"ml-5 w-0 flex-1"},ec=e("dt",{class:"text-sm font-medium text-gray-500 truncate"}," Invitaciones Pendientes ",-1),tc={class:"text-lg font-medium text-gray-900"},sc={class:"bg-white overflow-hidden shadow rounded-lg"},oc={class:"p-5"},ac={class:"flex items-center"},ic={class:"flex-shrink-0"},nc={class:"ml-5 w-0 flex-1"},rc=e("dt",{class:"text-sm font-medium text-gray-500 truncate"}," Total Solicitudes ",-1),lc={class:"text-lg font-medium text-gray-900"},cc={class:"space-y-6"},dc={class:"relative h-48 bg-gradient-to-r from-blue-500 to-purple-600"},uc=["src","alt"],mc=e("div",{class:"absolute inset-0 bg-black bg-opacity-30"},null,-1),gc={class:"absolute bottom-4 left-6"},fc={class:"relative"},hc=["src","alt"],vc={class:"absolute top-4 right-4"},pc=["onClick"],_c={class:"px-6 py-4"},bc={class:"flex items-start justify-between"},yc={class:"flex-1"},xc={class:"text-xl font-semibold text-gray-900 mb-2"},wc={class:"text-gray-600 mb-4"},$c={class:"flex items-center space-x-6 text-sm text-gray-500 mb-4"},zc=["onClick","title"],Ec={class:"group-hover:underline"},kc={class:"flex items-center"},qc={class:"flex items-center"},Cc={class:"flex space-x-2 ml-4"},Rc=["onClick"],Mc={key:0,class:"text-center py-12"},Pc=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," No tienes organizaciones creadas ",-1),Sc=e("p",{class:"text-gray-600 mb-6"}," Crea tu primera organización para empezar a recibir solicitudes de clientes. ",-1),Dc={class:"mt-8"},Ic={__name:"CorporateClientDashboard",setup(t){const o=ge(),s=Ae(),n=Le(),d=Be(),i=R(!1),g=R(!1),h=R(!1),m=R(!1),x=R(!1),v=R(null),p=R(null),b=D(()=>o.isLoading||s.isLoadingRequests),f=D(()=>o.organizations),E=D(()=>o.organizationStats),w=D(()=>s.receivedRequests),C=D(()=>{var B;return((B=n.currentUser)==null?void 0:B.role)==="corporate_client"}),M=async()=>{var B,ie,ne;try{const W=(B=n.currentUser)==null?void 0:B.role;if(!W){console.error("User role not available");return}if(W!=="corporate_client"){console.error("User is not a corporate client, cannot load corporate dashboard data");return}console.log("Loading corporate client dashboard data..."),await Promise.all([o.getMyOrganizations(),o.getOrganizationStats(),s.getReceivedRequests({page_size:50})]),console.log("Dashboard data loaded successfully")}catch(W){console.error("Error loading dashboard data:",W),((ie=W.response)==null?void 0:ie.status)===403?console.error("Access denied. User may not have corporate client permissions."):((ne=W.response)==null?void 0:ne.status)===401&&console.error("Authentication error. User may need to log in again.")}},z=B=>{v.value=B,g.value=!0},_=()=>{g.value=!1,v.value=null},$=B=>{v.value=B,h.value=!0},P=()=>{h.value=!1,v.value=null},O=B=>{p.value=B,m.value=!0},S=()=>{x.value=!0},L=()=>{x.value=!1},oe=()=>{m.value=!1,p.value=null},k=()=>{i.value=!0},V=()=>{i.value=!1},U=B=>{V(),Promise.all([o.getMyOrganizations(),o.getOrganizationStats()])},I=B=>{_(),o.getMyOrganizations()},A=B=>{P(),o.getOrganizationStats()},H=B=>{d.push({name:"organizations_dashboard",query:{tab:"request-detail",id:B}})},K=()=>{s.getReceivedRequests({page_size:50})},de=async B=>{try{await s.updateReceivedRequest(B.requestId,{status:B.newStatus}),K()}catch(ie){console.error("Error updating request status:",ie)}},Pe=B=>new Date(B).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"});return we(async()=>{var ne;console.log("CorporateClientDashboard mounted"),n.currentUser||(console.log("Waiting for user data to be available..."),await n.init());const B=(ne=n.currentUser)==null?void 0:ne.role,ie=JSON.parse(localStorage.getItem("userAuth")||"{}");console.log("Current user role (from store):",B),console.log("Current user role (from localStorage):",ie.role),console.log("Current user data:",n.currentUser),console.log("LocalStorage userAuth:",ie),B==="corporate_client"?M():(console.error("User does not have corporate_client role."),console.error("Store role:",B),console.error("LocalStorage role:",ie.role),console.error("Available roles should be: client, basic, corporate_client, lawyer"))}),(B,ie)=>{var ne;return a(),r("div",wl,[b.value?(a(),r("div",$l,kl)):C.value?(a(),r("div",Dl,[Il,e("div",Ll,[e("div",jl,[e("div",Ol,[e("div",Nl,[e("div",Al,[u(c(ke),{class:"h-6 w-6 text-gray-400"})]),e("div",Ul,[e("dl",null,[Vl,e("dd",Tl,l(E.value.total_organizations),1)])])])])]),e("button",{onClick:S,class:"bg-white overflow-hidden shadow rounded-lg hover:shadow-lg transition-shadow cursor-pointer text-left w-full group",title:"Ver todos los miembros de tus organizaciones"},[e("div",Gl,[e("div",Bl,[e("div",Fl,[u(c(ye),{class:"h-6 w-6 text-gray-400 group-hover:text-blue-600 transition-colors"})]),e("div",Hl,[e("dl",null,[Wl,e("dd",Zl,l(E.value.total_members),1)])])])])]),e("div",Jl,[e("div",Ql,[e("div",Yl,[e("div",Xl,[u(c(De),{class:"h-6 w-6 text-gray-400"})]),e("div",Kl,[e("dl",null,[ec,e("dd",tc,l(E.value.total_pending_invitations),1)])])])])]),e("div",sc,[e("div",oc,[e("div",ac,[e("div",ic,[u(c(Ne),{class:"h-6 w-6 text-gray-400"})]),e("div",nc,[e("dl",null,[rc,e("dd",lc,l(w.value.length),1)])])])])])])])):(a(),r("div",ql,[e("div",Cl,[Rl,Ml,Pl,e("p",Sl," Tu rol actual: "+l(((ne=c(n).currentUser)==null?void 0:ne.role)||"Sin definir"),1)])])),e("div",cc,[(a(!0),r(Z,null,Q(f.value,W=>(a(),r("div",{key:W.id,class:"bg-white shadow rounded-lg overflow-hidden"},[e("div",dc,[W.cover_image_url?(a(),r("img",{key:0,src:W.cover_image_url,alt:`Portada de ${W.title}`,class:"w-full h-full object-cover"},null,8,uc)):q("",!0),mc,e("div",gc,[e("div",fc,[e("img",{src:W.profile_image_url||c(J),alt:`Logo de ${W.title}`,class:"h-20 w-20 rounded-full border-4 border-white object-cover bg-white"},null,8,hc)])]),e("div",vc,[e("button",{onClick:ze=>z(W),class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-black bg-opacity-50 hover:bg-opacity-70 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(c(it),{class:"h-4 w-4 mr-1"}),y(" Editar ")],8,pc)])]),e("div",_c,[e("div",bc,[e("div",yc,[e("h3",xc,l(W.title),1),e("p",wc,l(W.description),1),e("div",$c,[e("button",{onClick:ze=>O(W),class:"flex items-center hover:text-blue-600 transition-colors cursor-pointer group",title:`Ver lista de miembros de ${W.title}`},[u(c(ye),{class:"h-4 w-4 mr-1 group-hover:text-blue-600"}),e("span",Ec,l(W.member_count)+" miembros ",1)],8,zc),e("div",kc,[u(c(De),{class:"h-4 w-4 mr-1"}),y(" "+l(W.pending_invitations_count)+" invitaciones pendientes ",1)]),e("div",qc,[u(c(le),{class:"h-4 w-4 mr-1"}),y(" Creada "+l(Pe(W.created_at)),1)])])]),e("div",Cc,[e("button",{onClick:ze=>$(W),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(c(rt),{class:"h-4 w-4 mr-2"}),y(" Invitar Miembro ")],8,Rc)])])])]))),128)),f.value.length===0?(a(),r("div",Mc,[u(c(ke),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),Pc,Sc,e("button",{onClick:k,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(_e),{class:"h-4 w-4 mr-2"}),y(" Crear Organización ")])])):q("",!0)]),(a(!0),r(Z,null,Q(f.value,W=>(a(),r("div",{key:`posts-${W.id}`,class:"mt-8"},[u(xl,{"organization-id":W.id},null,8,["organization-id"])]))),128)),e("div",Dc,[u(Dn,{requests:w.value,organizations:f.value,"is-loading":c(s).isLoadingRequests,onViewDetail:H,onStatusUpdated:de,onRefresh:K},null,8,["requests","organizations","is-loading"])]),u(Es,{visible:i.value,onClose:V,onCreated:U},null,8,["visible"]),u(fo,{visible:g.value,organization:v.value,onClose:_,onUpdated:I},null,8,["visible","organization"]),u(Xo,{visible:h.value,organization:v.value,onClose:P,onInvited:A},null,8,["visible","organization"]),u(Ma,{visible:m.value,organization:p.value,onClose:oe},null,8,["visible","organization"]),u(ui,{visible:x.value,organizations:f.value,onClose:L},null,8,["visible","organizations"])])}}},dt=t=>(Ce("data-v-8fb6d1d9"),t=t(),Re(),t),Lc={class:"bg-white shadow rounded-lg border border-gray-200 overflow-hidden hover:shadow-md transition-shadow"},jc={class:"relative h-32 bg-gradient-to-r from-blue-500 to-purple-600"},Oc=["src","alt"],Nc=dt(()=>e("div",{class:"absolute inset-0 bg-black bg-opacity-30"},null,-1)),Ac={class:"absolute bottom-3 left-4"},Uc=["src","alt"],Vc={class:"absolute top-3 right-3"},Tc={class:"p-6"},Gc={class:"mb-4"},Bc={class:"text-lg font-semibold text-gray-900 mb-1"},Fc={class:"text-sm text-gray-600 mb-3 line-clamp-2"},Hc={class:"flex items-center space-x-4 text-xs text-gray-500"},Wc={class:"flex items-center"},Zc={class:"flex items-center"},Jc={class:"mb-4 p-3 bg-gray-50 rounded-lg"},Qc={class:"flex items-start space-x-3"},Yc=["src","alt"],Xc={class:"flex-1 min-w-0"},Kc={class:"text-sm font-medium text-gray-900"},ed={class:"text-xs text-gray-500 mb-2"},td={class:"text-sm text-gray-700 italic"},sd={key:0,class:"mb-4"},od={key:0},ad={key:1},id={key:1,class:"flex space-x-3"},nd=["disabled"],rd={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},ld=["disabled"],cd={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600 mr-2"},dd={key:2,class:"text-center py-2"},ud={class:"text-sm text-gray-600"},md={key:3,class:"text-center py-2"},gd=dt(()=>e("p",{class:"text-sm text-gray-500"}," Esta invitación ha expirado ",-1)),fd=[gd],hd={__name:"InvitationCard",props:{invitation:{type:Object,required:!0}},emits:["responded"],setup(t,{emit:o}){const s=t,n=o,d=ge(),i=R(!1),g=R(null),h=D(()=>s.invitation.can_be_responded&&!s.invitation.is_expired&&s.invitation.status==="PENDING"),m=D(()=>{if(!s.invitation.expires_at)return!1;const z=(new Date(s.invitation.expires_at)-new Date)/(1e3*60*60*24);return z<=7&&z>0}),x=D(()=>s.invitation.organization_info.profile_image_url||J),v=async w=>{var C,M;try{i.value=!0,g.value=w;const z=await d.respondToInvitation(s.invitation.id,w);j(`Invitación ${w==="accept"?"aceptada":"rechazada"} exitosamente`,"success"),n("responded",z.invitation)}catch(z){console.error("Error responding to invitation:",z),(M=(C=z.response)==null?void 0:C.data)!=null&&M.error?j(z.response.data.error,"error"):j("Error al responder la invitación","error")}finally{i.value=!1,g.value=null}},p=w=>({PENDING:"Pendiente",ACCEPTED:"Aceptada",REJECTED:"Rechazada",EXPIRED:"Expirada",CANCELLED:"Cancelada"})[w]||w,b=w=>({PENDING:"bg-yellow-100 text-yellow-800",ACCEPTED:"bg-green-100 text-green-800",REJECTED:"bg-red-100 text-red-800",EXPIRED:"bg-gray-100 text-gray-800",CANCELLED:"bg-gray-100 text-gray-800"})[w]||"bg-gray-100 text-gray-800",f=w=>new Date(w).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),E=w=>{const C=new Date(w),z=Math.abs(new Date-C),_=Math.ceil(z/(1e3*60*60*24));return _===0?"hoy":_===1?"hace 1 día":_<7?`hace ${_} días`:_<30?`hace ${Math.ceil(_/7)} semanas`:f(w)};return(w,C)=>(a(),r("div",Lc,[e("div",jc,[t.invitation.organization_info.cover_image_url?(a(),r("img",{key:0,src:t.invitation.organization_info.cover_image_url,alt:`Portada de ${t.invitation.organization_info.title}`,class:"w-full h-full object-cover"},null,8,Oc)):q("",!0),Nc,e("div",Ac,[e("img",{src:t.invitation.organization_info.profile_image_url||"/src/assets/images/user_avatar.jpg",alt:`Logo de ${t.invitation.organization_info.title}`,class:"h-12 w-12 rounded-full border-2 border-white object-cover bg-white"},null,8,Uc)]),e("div",Vc,[e("span",{class:T([b(t.invitation.status),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(p(t.invitation.status)),3)])]),e("div",Tc,[e("div",Gc,[e("h3",Bc,l(t.invitation.organization_info.title),1),e("p",Fc,l(t.invitation.organization_info.description),1),e("div",Hc,[e("div",Wc,[u(c(ye),{class:"h-3 w-3 mr-1"}),y(" "+l(t.invitation.organization_info.member_count)+" miembros ",1)]),e("div",Zc,[u(c(le),{class:"h-3 w-3 mr-1"}),y(" "+l(f(t.invitation.created_at)),1)])])]),e("div",Jc,[e("div",Qc,[e("img",{src:x.value,alt:`Avatar de ${t.invitation.invited_by_info.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,Yc),e("div",Xc,[e("p",Kc,l(t.invitation.invited_by_info.full_name),1),e("p",ed,l(t.invitation.invited_by_info.email),1),e("p",td,' "'+l(t.invitation.message||"Te invita a unirte a esta organización.")+'" ',1)])])]),t.invitation.expires_at?(a(),r("div",sd,[e("div",{class:T(["flex items-center text-xs",m.value?"text-orange-600":"text-gray-500"])},[u(c(Ge),{class:"h-3 w-3 mr-1"}),t.invitation.is_expired?(a(),r("span",od," Expiró "+l(E(t.invitation.expires_at)),1)):(a(),r("span",ad," Expira "+l(E(t.invitation.expires_at)),1))],2)])):q("",!0),h.value?(a(),r("div",id,[e("button",{onClick:C[0]||(C[0]=M=>v("accept")),disabled:i.value,class:"flex-1 inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[i.value&&g.value==="accept"?(a(),r("div",rd)):(a(),G(c(at),{key:1,class:"h-4 w-4 mr-2"})),y(" "+l(i.value&&g.value==="accept"?"Aceptando...":"Aceptar"),1)],8,nd),e("button",{onClick:C[1]||(C[1]=M=>v("reject")),disabled:i.value,class:"flex-1 inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[i.value&&g.value==="reject"?(a(),r("div",cd)):(a(),G(c(ce),{key:1,class:"h-4 w-4 mr-2"})),y(" "+l(i.value&&g.value==="reject"?"Rechazando...":"Rechazar"),1)],8,ld)])):t.invitation.responded_at?(a(),r("div",dd,[e("p",ud," Respondiste "+l(E(t.invitation.responded_at)),1)])):(a(),r("div",md,fd))])]))}},vd=Me(hd,[["__scopeId","data-v-8fb6d1d9"]]),pd=e("div",{class:"mb-6"},[e("h2",{class:"text-lg font-medium text-gray-900"},"Invitaciones Recibidas"),e("p",{class:"mt-1 text-sm text-gray-600"}," Revisa y responde a las invitaciones de organizaciones ")],-1),_d={key:0,class:"flex justify-center items-center py-8"},bd=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),yd=e("span",{class:"ml-2 text-gray-600"},"Cargando invitaciones...",-1),xd=[bd,yd],wd={key:1,class:"space-y-4"},$d={key:2,class:"text-center py-12"},zd=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," No tienes invitaciones ",-1),Ed=e("p",{class:"text-gray-600 mb-6"}," Cuando recibas invitaciones de organizaciones, aparecerán aquí para que puedas responderlas. ",-1),kd={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto"},qd={class:"flex"},Cd=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Cómo recibir invitaciones?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Los clientes corporativos pueden invitarte a sus organizaciones"),e("p",null,"• Solo necesitan tu email registrado en la plataforma"),e("p",null,"• Las invitaciones aparecerán automáticamente aquí")])],-1),Rd={__name:"InvitationsSection",props:{invitations:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["invitation-responded"],setup(t,{emit:o}){const s=o,n=d=>{s("invitation-responded",d)};return(d,i)=>(a(),r("div",null,[pd,t.isLoading?(a(),r("div",_d,xd)):t.invitations.length>0?(a(),r("div",wd,[(a(!0),r(Z,null,Q(t.invitations,g=>(a(),G(vd,{key:g.id,invitation:g,onResponded:n},null,8,["invitation"]))),128))])):(a(),r("div",$d,[u(c(De),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),zd,Ed,e("div",kd,[e("div",qd,[u(c(me),{class:"h-5 w-5 text-blue-400 mt-0.5"}),Cd])])]))]))}},ut=t=>(Ce("data-v-4dae34ac"),t=t(),Re(),t),Md={class:"bg-white shadow rounded-lg border border-gray-200 overflow-hidden hover:shadow-md transition-shadow"},Pd={class:"relative h-32 bg-gradient-to-r from-blue-500 to-purple-600"},Sd=["src","alt"],Dd=ut(()=>e("div",{class:"absolute inset-0 bg-black bg-opacity-30"},null,-1)),Id={class:"absolute bottom-3 left-4"},Ld=["src","alt"],jd={class:"absolute top-3 right-3"},Od={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},Nd={class:"p-4"},Ad={class:"mb-4"},Ud={class:"text-lg font-semibold text-gray-900 mb-1"},Vd={class:"text-sm text-gray-600 mb-3 line-clamp-2"},Td={class:"flex items-center space-x-4 text-xs text-gray-500 mb-3"},Gd={class:"flex items-center"},Bd={class:"flex items-center"},Fd={class:"mb-4 p-3 bg-gray-50 rounded-lg"},Hd=ut(()=>e("p",{class:"text-xs text-gray-500 mb-1"},"Líder de la organización",-1)),Wd={class:"flex items-center space-x-2"},Zd=["src","alt"],Jd={class:"text-sm font-medium text-gray-900"},Qd={class:"text-xs text-gray-500"},Yd={class:"space-y-2"},Xd={class:"flex space-x-2"},Kd={__name:"OrganizationCard",props:{organization:{type:Object,required:!0}},emits:["left","create-request","view-details"],setup(t,{emit:o}){const s=t,n=o,d=ge(),i=R(!1),g=R(!1),h=()=>{n("create-request",s.organization.id)},m=()=>{n("view-details",s.organization.id)},x=async()=>{var p,b;try{g.value=!0,await d.leaveOrganization(s.organization.id),j(`Has abandonado ${s.organization.title}`,"success"),i.value=!1,n("left",s.organization.id)}catch(f){console.error("Error leaving organization:",f),(b=(p=f.response)==null?void 0:p.data)!=null&&b.error?j(f.response.data.error,"error"):j("Error al abandonar la organización","error")}finally{g.value=!1}},v=p=>new Date(p).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"});return(p,b)=>(a(),r("div",Md,[e("div",Pd,[t.organization.cover_image_url?(a(),r("img",{key:0,src:t.organization.cover_image_url,alt:`Portada de ${t.organization.title}`,class:"w-full h-full object-cover"},null,8,Sd)):q("",!0),Dd,e("div",Id,[e("img",{src:t.organization.profile_image_url||c(J),alt:`Logo de ${t.organization.title}`,class:"h-12 w-12 rounded-full border-2 border-white object-cover bg-white"},null,8,Ld)]),e("div",jd,[e("span",Od,[u(c(at),{class:"h-3 w-3 mr-1"}),y(" Miembro ")])])]),e("div",Nd,[e("div",Ad,[e("h3",Ud,l(t.organization.title),1),e("p",Vd,l(t.organization.description),1),e("div",Td,[e("div",Gd,[u(c(ye),{class:"h-3 w-3 mr-1"}),y(" "+l(t.organization.member_count)+" miembros ",1)]),e("div",Bd,[u(c(le),{class:"h-3 w-3 mr-1"}),y(" Miembro desde "+l(v(t.organization.joined_at)),1)])])]),e("div",Fd,[Hd,e("div",Wd,[e("img",{src:t.organization.corporate_client_info.profile_image_url||c(J),alt:`Avatar de ${t.organization.corporate_client_info.full_name}`,class:"h-6 w-6 rounded-full object-cover border border-gray-200"},null,8,Zd),e("div",null,[e("p",Jd,l(t.organization.corporate_client_info.full_name),1),e("p",Qd,l(t.organization.corporate_client_info.email),1)])])]),e("div",Yd,[e("button",{onClick:h,class:"w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(c(_e),{class:"h-4 w-4 mr-2"}),y(" Nueva Solicitud ")]),e("div",Xd,[e("button",{onClick:m,class:"flex-1 inline-flex justify-center items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(c(je),{class:"h-4 w-4 mr-1"}),y(" Ver Detalles ")]),e("button",{onClick:b[0]||(b[0]=f=>i.value=!0),class:"flex-1 inline-flex justify-center items-center px-3 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors"},[u(c(xt),{class:"h-4 w-4 mr-1"}),y(" Salir ")])])])]),u(ct,{visible:i.value,title:`¿Salir de ${t.organization.title}?`,message:"¿Estás seguro de que quieres abandonar esta organización? Ya no podrás enviar solicitudes a través de ella.","confirm-text":"Sí, salir","confirm-color":"red","is-loading":g.value,onConfirm:x,onCancel:b[1]||(b[1]=f=>i.value=!1)},null,8,["visible","title","is-loading"])]))}},eu=Me(Kd,[["__scopeId","data-v-4dae34ac"]]),tu=e("div",{class:"mb-6"},[e("h2",{class:"text-lg font-medium text-gray-900"},"Mis Organizaciones"),e("p",{class:"mt-1 text-sm text-gray-600"}," Organizaciones donde eres miembro activo ")],-1),su={key:0,class:"flex justify-center items-center py-8"},ou=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),au=e("span",{class:"ml-2 text-gray-600"},"Cargando organizaciones...",-1),iu=[ou,au],nu={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},ru={key:2,class:"text-center py-12"},lu=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," No perteneces a ninguna organización ",-1),cu=e("p",{class:"text-gray-600 mb-6"}," Para unirte a organizaciones, necesitas recibir y aceptar invitaciones de clientes corporativos. ",-1),du={class:"max-w-2xl mx-auto space-y-4"},uu={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},mu={class:"flex"},gu=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Cómo unirme a una organización?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"1. Espera a recibir una invitación de un cliente corporativo"),e("p",null,'2. Revisa la invitación en la pestaña "Invitaciones"'),e("p",null,"3. Acepta la invitación para convertirte en miembro"),e("p",null,"4. Una vez miembro, podrás enviar solicitudes a esa organización")])],-1),fu={class:"bg-green-50 border border-green-200 rounded-lg p-4"},hu={class:"flex"},vu=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-green-800"},"Beneficios de ser miembro"),e("div",{class:"mt-1 text-sm text-green-700 space-y-1"},[e("p",null,"• Enviar solicitudes corporativas especializadas"),e("p",null,"• Acceso a servicios específicos de la organización"),e("p",null,"• Comunicación directa con el equipo corporativo"),e("p",null,"• Seguimiento detallado de tus solicitudes")])],-1),pu={__name:"OrganizationsSection",props:{organizations:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["organization-left","create-request","view-details"],setup(t,{emit:o}){const s=o,n=g=>{s("organization-left",g)},d=g=>{s("create-request",g)},i=g=>{s("view-details",g)};return(g,h)=>(a(),r("div",null,[tu,t.isLoading?(a(),r("div",su,iu)):t.organizations.length>0?(a(),r("div",nu,[(a(!0),r(Z,null,Q(t.organizations,m=>(a(),G(eu,{key:m.id,organization:m,onLeft:n,onCreateRequest:d,onViewDetails:i},null,8,["organization"]))),128))])):(a(),r("div",ru,[u(c(ke),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),lu,cu,e("div",du,[e("div",uu,[e("div",mu,[u(c(me),{class:"h-5 w-5 text-blue-400 mt-0.5"}),gu])]),e("div",fu,[e("div",hu,[u(c($e),{class:"h-5 w-5 text-green-400 mt-0.5"}),vu])])])]))]))}},_u=t=>(Ce("data-v-a9bfd787"),t=t(),Re(),t),bu={class:"flex items-start justify-between mb-4"},yu={class:"flex items-center space-x-2 mb-1"},xu={class:"text-sm font-medium text-gray-900"},wu={class:"text-lg font-semibold text-gray-900 mb-2"},$u={class:"text-sm text-gray-600 mb-4 line-clamp-2"},zu={class:"flex items-center space-x-3 mb-4 p-3 bg-gray-50 rounded-lg"},Eu=["src","alt"],ku={class:"text-sm font-medium text-gray-900"},qu={class:"text-xs text-gray-500"},Cu={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-gray-500 mb-4"},Ru={class:"flex items-center"},Mu={class:"flex items-center"},Pu={class:"flex items-center"},Su={class:"flex items-center"},Du={key:0,class:"text-xs text-gray-500 mb-2"},Iu=_u(()=>e("span",{class:"font-medium"},"Última actualización:",-1)),Lu={class:"w-full bg-gray-200 rounded-full h-1"},ju={__name:"RequestCard",props:{request:{type:Object,required:!0}},emits:["view-detail"],setup(t,{emit:o}){const s=t,n=o,d=D(()=>{var f;return((f=s.request.organization_info)==null?void 0:f.profile_image_url)||J}),i=()=>{n("view-detail",s.request.id)},g=f=>({PENDING:"Pendiente",IN_REVIEW:"En Revisión",RESPONDED:"Respondida",RESOLVED:"Resuelta",CLOSED:"Cerrada"})[f]||f,h=f=>({PENDING:"bg-yellow-100 text-yellow-800",IN_REVIEW:"bg-blue-100 text-blue-800",RESPONDED:"bg-purple-100 text-purple-800",RESOLVED:"bg-green-100 text-green-800",CLOSED:"bg-gray-100 text-gray-800"})[f]||"bg-gray-100 text-gray-800",m=f=>({LOW:"Baja",MEDIUM:"Media",HIGH:"Alta",URGENT:"Urgente"})[f]||f,x=f=>({LOW:"bg-gray-100 text-gray-600",MEDIUM:"bg-blue-100 text-blue-600",HIGH:"bg-orange-100 text-orange-600",URGENT:"bg-red-100 text-red-600"})[f]||"bg-gray-100 text-gray-600",v=f=>({PENDING:20,IN_REVIEW:40,RESPONDED:60,RESOLVED:80,CLOSED:100})[f]||0,p=f=>({PENDING:"bg-yellow-500",IN_REVIEW:"bg-blue-500",RESPONDED:"bg-purple-500",RESOLVED:"bg-green-500",CLOSED:"bg-gray-500"})[f]||"bg-gray-500",b=f=>{const E=new Date(f),C=Math.abs(new Date-E),M=Math.ceil(C/(1e3*60*60*24));return M===0?"Hoy":M===1?"Ayer":M<7?`Hace ${M} días`:M<30?`Hace ${Math.ceil(M/7)} semanas`:E.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})};return(f,E)=>{var w,C;return a(),r("div",{class:"bg-white shadow rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow cursor-pointer",onClick:i},[e("div",bu,[e("div",null,[e("div",yu,[e("span",xu,l(t.request.request_number),1),e("span",{class:T([h(t.request.status),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(g(t.request.status)),3),e("span",{class:T([x(t.request.priority),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(m(t.request.priority)),3)]),e("h3",wu,l(t.request.title),1)]),e("button",{onClick:be(i,["stop"]),class:"inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(je),{class:"h-3 w-3 mr-1"}),y(" Ver Detalle ")])]),e("p",$u,l(t.request.description),1),e("div",zu,[e("img",{src:d.value,alt:`Logo de ${(w=t.request.organization_info)==null?void 0:w.title}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,Eu),e("div",null,[e("p",ku,l(((C=t.request.organization_info)==null?void 0:C.title)||"Organización"),1),e("p",qu," Líder: "+l(t.request.corporate_client_name),1)])]),e("div",Cu,[e("div",Ru,[u(c(ot),{class:"h-3 w-3 mr-1"}),y(" "+l(t.request.request_type_name),1)]),e("div",Mu,[u(c(le),{class:"h-3 w-3 mr-1"}),y(" "+l(b(t.request.created_at)),1)]),e("div",Pu,[u(c(We),{class:"h-3 w-3 mr-1"}),y(" "+l(t.request.response_count)+" respuestas ",1)]),e("div",Su,[u(c(Ge),{class:"h-3 w-3 mr-1"}),y(" "+l(t.request.days_since_created)+" días ",1)])]),t.request.status_updated_at&&t.request.status_updated_at!==t.request.created_at?(a(),r("div",Du,[Iu,y(" "+l(b(t.request.status_updated_at)),1)])):q("",!0),e("div",Lu,[e("div",{class:T([p(t.request.status),"h-1 rounded-full transition-all duration-300"]),style:et({width:v(t.request.status)+"%"})},null,6)])])}}},Ou=Me(ju,[["__scopeId","data-v-a9bfd787"]]),Nu={class:"mb-6"},Au={class:"flex items-center justify-between"},Uu=e("div",null,[e("h2",{class:"text-lg font-medium text-gray-900"},"Mis Solicitudes Corporativas"),e("p",{class:"mt-1 text-sm text-gray-600"}," Seguimiento de todas tus solicitudes enviadas ")],-1),Vu={class:"mb-6 bg-gray-50 rounded-lg p-4"},Tu={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Gu=e("label",{for:"status-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Estado ",-1),Bu=xe('<option value="">Todos los estados</option><option value="PENDING">Pendiente</option><option value="IN_REVIEW">En Revisión</option><option value="RESPONDED">Respondida</option><option value="RESOLVED">Resuelta</option><option value="CLOSED">Cerrada</option>',6),Fu=[Bu],Hu=e("label",{for:"priority-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Prioridad ",-1),Wu=xe('<option value="">Todas las prioridades</option><option value="LOW">Baja</option><option value="MEDIUM">Media</option><option value="HIGH">Alta</option><option value="URGENT">Urgente</option>',5),Zu=[Wu],Ju=e("label",{for:"search",class:"block text-sm font-medium text-gray-700 mb-1"}," Buscar ",-1),Qu={key:0,class:"flex justify-center items-center py-8"},Yu=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),Xu=e("span",{class:"ml-2 text-gray-600"},"Cargando solicitudes...",-1),Ku=[Yu,Xu],e0={key:1,class:"space-y-4"},t0={key:2,class:"text-center py-12"},s0={class:"text-lg font-medium text-gray-900 mb-2"},o0={class:"text-gray-600 mb-6"},a0={key:0,class:"space-y-4"},i0={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto"},n0={class:"flex"},r0=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Cómo crear una solicitud?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"1. Asegúrate de ser miembro de al menos una organización"),e("p",null,'2. Haz clic en "Nueva Solicitud"'),e("p",null,"3. Selecciona la organización y tipo de solicitud"),e("p",null,"4. Proporciona todos los detalles necesarios")])],-1),l0={key:1},c0={__name:"MyRequestsSection",props:{requests:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["request-detail","create-request"],setup(t,{emit:o}){const s=t,n=o,d=R(""),i=R(""),g=R(""),h=D(()=>{let b=[...s.requests];if(d.value&&(b=b.filter(f=>f.status===d.value)),i.value&&(b=b.filter(f=>f.priority===i.value)),g.value.trim()){const f=g.value.toLowerCase().trim();b=b.filter(E=>{var w;return E.title.toLowerCase().includes(f)||E.request_number.toLowerCase().includes(f)||((w=E.description)==null?void 0:w.toLowerCase().includes(f))})}return b.sort((f,E)=>new Date(E.created_at)-new Date(f.created_at))}),m=D(()=>s.requests.length===0?"No has enviado solicitudes":"No se encontraron solicitudes"),x=D(()=>s.requests.length===0?"Cuando envíes solicitudes corporativas a tus organizaciones, aparecerán aquí para que puedas dar seguimiento.":"No hay solicitudes que coincidan con los filtros seleccionados. Intenta ajustar los criterios de búsqueda."),v=b=>{n("request-detail",b)},p=()=>{d.value="",i.value="",g.value=""};return te([d,i,g],()=>{}),(b,f)=>(a(),r("div",null,[e("div",Nu,[e("div",Au,[Uu,e("button",{onClick:f[0]||(f[0]=E=>n("create-request")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(_e),{class:"h-4 w-4 mr-2"}),y(" Nueva Solicitud ")])])]),e("div",Vu,[e("div",Tu,[e("div",null,[Gu,F(e("select",{id:"status-filter","onUpdate:modelValue":f[1]||(f[1]=E=>d.value=E),class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},Fu,512),[[ue,d.value]])]),e("div",null,[Hu,F(e("select",{id:"priority-filter","onUpdate:modelValue":f[2]||(f[2]=E=>i.value=E),class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},Zu,512),[[ue,i.value]])]),e("div",null,[Ju,F(e("input",{id:"search","onUpdate:modelValue":f[3]||(f[3]=E=>g.value=E),type:"text",placeholder:"Buscar por título o número...",class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[ae,g.value]])])])]),t.isLoading?(a(),r("div",Qu,Ku)):h.value.length>0?(a(),r("div",e0,[(a(!0),r(Z,null,Q(h.value,E=>(a(),G(Ou,{key:E.id,request:E,onViewDetail:v},null,8,["request"]))),128))])):(a(),r("div",t0,[u(c(Ne),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e("h3",s0,l(m.value),1),e("p",o0,l(x.value),1),t.requests.length===0?(a(),r("div",a0,[e("button",{onClick:f[4]||(f[4]=E=>n("create-request")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(_e),{class:"h-4 w-4 mr-2"}),y(" Crear Primera Solicitud ")]),e("div",i0,[e("div",n0,[u(c(me),{class:"h-5 w-5 text-blue-400 mt-0.5"}),r0])])])):(a(),r("div",l0,[e("button",{onClick:p,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(ce),{class:"h-4 w-4 mr-2"}),y(" Limpiar Filtros ")])]))]))]))}},d0=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),u0={class:"fixed inset-0 z-10 overflow-y-auto"},m0={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},g0={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},f0=e("p",{class:"mt-1 text-sm text-gray-500"}," Envía una solicitud a través de una de tus organizaciones ",-1),h0={key:0,class:"flex justify-center items-center py-8"},v0=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),p0=e("span",{class:"ml-2 text-gray-600"},"Enviando solicitud...",-1),_0=[v0,p0],b0={key:1,class:"text-center py-6"},y0=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," ¡Solicitud Enviada! ",-1),x0={class:"text-sm text-gray-600 mb-2"},w0={class:"text-sm text-gray-500 mb-6"},$0=e("label",{for:"organization",class:"block text-sm font-medium leading-6 text-gray-900"}," Organización * ",-1),z0={class:"mt-2"},E0=e("option",{value:""},"Selecciona una organización",-1),k0=["value"],q0={key:0,class:"mt-1 text-sm text-red-600"},C0={key:0,class:"bg-gray-50 rounded-lg p-4"},R0={class:"flex items-center space-x-3"},M0=["src","alt"],P0={class:"text-sm font-medium text-gray-900"},S0={class:"text-xs text-gray-500"},D0=e("label",{for:"request_type",class:"block text-sm font-medium leading-6 text-gray-900"}," Tipo de Solicitud * ",-1),I0={class:"mt-2"},L0=e("option",{value:""},"Selecciona un tipo",-1),j0=["value"],O0={key:0,class:"mt-1 text-sm text-red-600"},N0=e("label",{for:"title",class:"block text-sm font-medium leading-6 text-gray-900"}," Título de la Solicitud * ",-1),A0={class:"mt-2"},U0={key:0,class:"mt-1 text-sm text-red-600"},V0=e("label",{for:"description",class:"block text-sm font-medium leading-6 text-gray-900"}," Descripción Detallada * ",-1),T0={class:"mt-2"},G0=e("p",{class:"mt-1 text-xs text-gray-500"}," Proporciona todos los detalles relevantes para que puedan ayudarte mejor ",-1),B0={key:0,class:"mt-1 text-sm text-red-600"},F0=e("label",{for:"priority",class:"block text-sm font-medium leading-6 text-gray-900"}," Prioridad ",-1),H0={class:"mt-2"},W0=e("option",{value:"LOW"},"Baja",-1),Z0=e("option",{value:"MEDIUM"},"Media",-1),J0=e("option",{value:"HIGH"},"Alta",-1),Q0=e("option",{value:"URGENT"},"Urgente",-1),Y0=[W0,Z0,J0,Q0],X0={key:0,class:"mt-1 text-sm text-red-600"},K0={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},em={class:"flex"},tm=e("div",{class:"ml-3"},[e("h5",{class:"text-sm font-medium text-blue-800"},"Información importante"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Tu solicitud será enviada al equipo de la organización seleccionada"),e("p",null,"• Recibirás un número de seguimiento para tu solicitud"),e("p",null,"• Podrás ver el progreso y responder a comentarios"),e("p",null,"• El equipo corporativo te contactará para más detalles si es necesario")])],-1),sm={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},om=["disabled"],am={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},im={__name:"CreateRequestModal",props:{visible:{type:Boolean,default:!1},organizations:{type:Array,default:()=>[]}},emits:["close","created"],setup(t,{emit:o}){const s=t,n=o,d=Ae(),i=R(!1),g=R(!1),h=R({}),m=R(null),x=R([]),v=R({organization:"",request_type:"",title:"",description:"",priority:"MEDIUM"}),p=D(()=>s.organizations.find(z=>z.id===v.value.organization)),b=D(()=>v.value.organization&&v.value.request_type&&v.value.title.trim()&&v.value.description.trim()),f=()=>{v.value={organization:"",request_type:"",title:"",description:"",priority:"MEDIUM"},h.value={},g.value=!1,m.value=null},E=async()=>{var z,_;try{const $=await d.getRequestTypes();Array.isArray($)?x.value=$:(console.error("Request types is not an array:",$),j("Formato de tipos de solicitud inválido","error"))}catch($){console.error("Error loading request types:",$),((z=$.response)==null?void 0:z.status)===403?j("No tienes permisos para cargar tipos de solicitudes","error"):((_=$.response)==null?void 0:_.status)===401?j("Sesión expirada. Por favor, vuelve a iniciar sesión","error"):j("Error al cargar tipos de solicitudes","error")}},w=async()=>{var z,_,$,P;try{i.value=!0,h.value={};const O={organization:v.value.organization,request_type:v.value.request_type,title:v.value.title.trim(),description:v.value.description.trim(),priority:v.value.priority},S=await d.createCorporateRequest(O);m.value=S.corporate_request,g.value=!0,j("Solicitud enviada exitosamente","success"),n("created",S.corporate_request)}catch(O){console.error("Error creating request:",O),(_=(z=O.response)==null?void 0:z.data)!=null&&_.details?h.value=O.response.data.details:(P=($=O.response)==null?void 0:$.data)!=null&&P.error?j(O.response.data.error,"error"):j("Error al enviar la solicitud","error")}finally{i.value=!1}},C=()=>{f()},M=()=>{i.value||n("close")};return te(()=>s.visible,z=>{z&&qe(()=>{f(),x.value.length===0&&E()})}),we(()=>{E()}),(z,_)=>(a(),G(c(pe),{as:"template",show:t.visible},{default:N(()=>[u(c(fe),{class:"relative z-50",onClose:M},{default:N(()=>[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:N(()=>[d0]),_:1}),e("div",u0,[e("div",m0,[u(c(se),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:N(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6"},{default:N(()=>{var $,P,O,S;return[e("div",g0,[e("div",null,[u(c(ve),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:N(()=>[y(" Nueva Solicitud Corporativa ")]),_:1}),f0]),e("button",{onClick:M,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(c(ce),{class:"h-6 w-6"})])]),i.value?(a(),r("div",h0,_0)):g.value?(a(),r("div",b0,[u(c($e),{class:"h-16 w-16 text-green-500 mx-auto mb-4"}),y0,e("p",x0,[y(" Tu solicitud "),e("strong",null,l(($=m.value)==null?void 0:$.request_number),1),y(" ha sido enviada exitosamente. ")]),e("p",w0,[y(" El equipo de "),e("strong",null,l((O=(P=m.value)==null?void 0:P.organization_info)==null?void 0:O.title),1),y(" la revisará pronto. ")]),e("div",{class:"space-y-3"},[e("button",{onClick:C,class:"w-full inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Crear Otra Solicitud "),e("button",{onClick:M,class:"w-full inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cerrar ")])])):(a(),r("form",{key:2,onSubmit:be(w,["prevent"]),class:"space-y-6"},[e("div",null,[$0,e("div",z0,[F(e("select",{id:"organization","onUpdate:modelValue":_[0]||(_[0]=L=>v.value.organization=L),required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"},[E0,(a(!0),r(Z,null,Q(t.organizations,L=>(a(),r("option",{key:L.id,value:L.id},l(L.title),9,k0))),128))],512),[[ue,v.value.organization]])]),h.value.organization?(a(),r("p",q0,l(h.value.organization[0]),1)):q("",!0)]),p.value?(a(),r("div",C0,[e("div",R0,[e("img",{src:p.value.profile_image_url||c(J),alt:`Logo de ${p.value.title}`,class:"h-10 w-10 rounded-full object-cover border border-gray-200"},null,8,M0),e("div",null,[e("h4",P0,l(p.value.title),1),e("p",S0," Líder: "+l((S=p.value.corporate_client_info)==null?void 0:S.full_name),1)])])])):q("",!0),e("div",null,[D0,e("div",I0,[F(e("select",{id:"request_type","onUpdate:modelValue":_[1]||(_[1]=L=>v.value.request_type=L),required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"},[L0,(a(!0),r(Z,null,Q(x.value,L=>(a(),r("option",{key:L.id,value:L.id},l(L.name),9,j0))),128))],512),[[ue,v.value.request_type]])]),h.value.request_type?(a(),r("p",O0,l(h.value.request_type[0]),1)):q("",!0)]),e("div",null,[N0,e("div",A0,[F(e("input",{id:"title","onUpdate:modelValue":_[2]||(_[2]=L=>v.value.title=L),type:"text",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ej: Revisión de contrato de servicios"},null,512),[[ae,v.value.title]])]),h.value.title?(a(),r("p",U0,l(h.value.title[0]),1)):q("",!0)]),e("div",null,[V0,e("div",T0,[F(e("textarea",{id:"description","onUpdate:modelValue":_[3]||(_[3]=L=>v.value.description=L),rows:"4",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Describe detalladamente lo que necesitas..."},null,512),[[ae,v.value.description]])]),G0,h.value.description?(a(),r("p",B0,l(h.value.description[0]),1)):q("",!0)]),e("div",null,[F0,e("div",H0,[F(e("select",{id:"priority","onUpdate:modelValue":_[4]||(_[4]=L=>v.value.priority=L),class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"},Y0,512),[[ue,v.value.priority]])]),h.value.priority?(a(),r("p",X0,l(h.value.priority[0]),1)):q("",!0)]),e("div",K0,[e("div",em,[u(c(me),{class:"h-5 w-5 text-blue-400 mt-0.5"}),tm])]),e("div",sm,[e("button",{type:"button",onClick:M,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value||!b.value,class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),r("div",am)):(a(),G(c(nt),{key:1,class:"h-4 w-4 mr-2"})),y(" "+l(i.value?"Enviando...":"Enviar Solicitud"),1)],8,om)])],32))]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},nm={class:"bg-white shadow rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow"},rm={class:"mb-4"},lm={class:"flex items-center space-x-2 mb-2"},cm={class:"text-lg font-semibold text-gray-900"},dm={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800"},um={class:"flex items-center text-sm text-gray-500 space-x-4"},mm={class:"flex items-center"},gm={class:"flex items-center"},fm={class:"mb-4"},hm={class:"text-gray-700 whitespace-pre-wrap leading-relaxed"},vm={key:0,class:"mb-4"},pm=["href"],_m={class:"flex items-center justify-between text-xs text-gray-500 pt-4 border-t border-gray-100"},bm={class:"flex items-center space-x-4"},ym={class:"flex items-center"},xm={key:0,class:"flex items-center text-yellow-600"},wm={key:0,class:"flex items-center text-green-600"},$m=e("span",{class:"h-2 w-2 bg-green-400 rounded-full mr-1 animate-pulse"},null,-1),Ke={__name:"ClientPostCard",props:{post:{type:Object,required:!0}},setup(t){const o=t,s=D(()=>{const i=new Date(o.post.created_at),h=Math.abs(new Date-i);return Math.ceil(h/(1e3*60*60*24))<=3}),n=i=>new Date(i).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),d=i=>{const g=new Date(i),m=Math.abs(new Date-g),x=Math.ceil(m/(1e3*60*60*24)),v=Math.ceil(m/(1e3*60*60)),p=Math.ceil(m/(1e3*60));if(p<60)return p<=1?"hace un momento":`hace ${p} minutos`;if(v<24)return v===1?"hace 1 hora":`hace ${v} horas`;if(x===0)return"hoy";if(x===1)return"ayer";if(x<7)return`hace ${x} días`;if(x<30){const f=Math.ceil(x/7);return`hace ${f} ${f===1?"semana":"semanas"}`}const b=Math.ceil(x/30);return b<12?`hace ${b} ${b===1?"mes":"meses"}`:n(i)};return(i,g)=>(a(),r("div",nm,[e("div",rm,[e("div",lm,[e("h3",cm,l(t.post.title),1),t.post.is_pinned?(a(),r("span",dm,[u(c(Ee),{class:"h-3 w-3 mr-1"}),y(" Fijado ")])):q("",!0)]),e("div",um,[e("div",mm,[u(c(zt),{class:"h-4 w-4 mr-1"}),e("span",null,l(t.post.author_name),1)]),e("div",gm,[u(c(le),{class:"h-4 w-4 mr-1"}),e("span",null,l(d(t.post.created_at)),1)])])]),e("div",fm,[e("p",hm,l(t.post.content),1)]),t.post.has_link&&t.post.link_url?(a(),r("div",vm,[e("a",{href:t.post.link_url,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-4 py-2 border border-blue-300 text-sm font-medium rounded-md text-blue-700 bg-blue-50 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(c(st),{class:"h-4 w-4 mr-2"}),y(" "+l(t.post.link_name||"Ver enlace")+" ",1),u(c(He),{class:"h-3 w-3 ml-2"})],8,pm)])):q("",!0),e("div",_m,[e("div",bm,[e("span",ym,[u(c(le),{class:"h-3 w-3 mr-1"}),y(" "+l(n(t.post.created_at)),1)]),t.post.is_pinned?(a(),r("span",xm,[u(c(Ee),{class:"h-3 w-3 mr-1"}),y(" Anuncio Destacado ")])):q("",!0)]),s.value?(a(),r("div",wm,[$m,y(" Reciente ")])):q("",!0)])]))}},zm={class:"mb-6"},Em={class:"flex items-center justify-between"},km=e("div",null,[e("h2",{class:"text-lg font-medium text-gray-900"},"Anuncios de la Organización"),e("p",{class:"mt-1 text-sm text-gray-600"}," Información importante de la organización ")],-1),qm=["disabled"],Cm={key:0,class:"flex justify-center items-center py-8"},Rm=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),Mm=e("span",{class:"ml-2 text-gray-600"},"Cargando anuncios...",-1),Pm=[Rm,Mm],Sm={key:1,class:"space-y-4"},Dm={key:2,class:"text-center py-12"},Im={class:"text-lg font-medium text-gray-900 mb-2"},Lm={class:"text-gray-600 mb-6"},jm={class:"flex"},Om={class:"ml-3 text-left"},Nm=e("p",null,"• Acepta una invitación pendiente de una organización",-1),Am=e("p",null,"• Solicita unirte a una organización existente",-1),Um=e("p",null,"• Contacta al líder de la organización para recibir una invitación",-1),Vm=e("p",null,"• Los líderes de la organización pueden publicar anuncios importantes",-1),Tm=e("p",null,"• Revisa esta sección regularmente para mantenerte informado",-1),Gm=e("p",null,"• Los anuncios fijados aparecen en la parte superior",-1),Bm={__name:"OrganizationPostsSection",props:{organizationId:{type:Number,required:!0}},setup(t){const o=t,s=Ze(),n=R(null),d=R(!1),i=D(()=>s.isLoadingPosts);D(()=>s.publicPosts);const g=D(()=>s.sortedPublicPosts),h=D(()=>g.value.filter(f=>f.is_pinned)),m=D(()=>g.value.filter(f=>!f.is_pinned)),x=D(()=>d.value?"No tienes acceso a estos anuncios":"No hay anuncios disponibles"),v=D(()=>d.value?"Para ver los anuncios de una organización, primero debes ser miembro activo de ella. Acepta una invitación o solicita unirte a una organización.":"La organización aún no ha publicado ningún anuncio. Los anuncios importantes aparecerán aquí."),p=async()=>{var f;try{n.value=null,d.value=!1,await s.getPublicPosts(o.organizationId)}catch(E){console.error("Error loading posts:",E),n.value=E,((f=E.response)==null?void 0:f.status)===403?d.value=!0:j("Error al cargar los anuncios","error")}},b=()=>{p()};return we(()=>{p()}),te(()=>o.organizationId,()=>{o.organizationId&&p()}),(f,E)=>(a(),r("div",null,[e("div",zm,[e("div",Em,[km,e("button",{onClick:b,disabled:i.value,class:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},[u(c(Oe),{class:T([i.value?"animate-spin":"","h-4 w-4 mr-2"])},null,8,["class"]),y(" Actualizar ")],8,qm)])]),i.value?(a(),r("div",Cm,Pm)):g.value.length>0?(a(),r("div",Sm,[(a(!0),r(Z,null,Q(h.value,w=>(a(),G(Ke,{key:`pinned-${w.id}`,post:w},null,8,["post"]))),128)),(a(!0),r(Z,null,Q(m.value,w=>(a(),G(Ke,{key:`regular-${w.id}`,post:w},null,8,["post"]))),128))])):(a(),r("div",Dm,[d.value?(a(),G(c(ht),{key:0,class:"h-16 w-16 mx-auto mb-4 text-amber-400"})):(a(),G(c($t),{key:1,class:"h-16 w-16 mx-auto mb-4 text-gray-300"})),e("h3",Im,l(x.value),1),e("p",Lm,l(v.value),1),e("div",{class:T([d.value?"bg-amber-50 border-amber-200":"bg-blue-50 border-blue-200","border rounded-lg p-4 max-w-md mx-auto"])},[e("div",jm,[u(c(me),{class:T([d.value?"text-amber-400":"text-blue-400","h-5 w-5 mt-0.5"])},null,8,["class"]),e("div",Om,[e("h5",{class:T([d.value?"text-amber-800":"text-blue-800","text-sm font-medium"])},l(d.value?"¿Cómo acceder?":"Sobre los anuncios"),3),e("div",{class:T([d.value?"text-amber-700":"text-blue-700","mt-1 text-sm space-y-1"])},[d.value?(a(),r(Z,{key:0},[Nm,Am,Um],64)):(a(),r(Z,{key:1},[Vm,Tm,Gm],64))],2)])])],2)]))]))}},Fm={class:"px-4 py-6 sm:px-6 lg:px-8"},Hm={key:0,class:"flex justify-center items-center py-12"},Wm=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),Zm=e("span",{class:"ml-2 text-gray-600"},"Cargando datos...",-1),Jm=[Wm,Zm],Qm={key:1,class:"text-center py-12"},Ym={class:"mx-auto max-w-md"},Xm=e("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"})],-1),Km=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Acceso Restringido",-1),eg=e("p",{class:"mt-1 text-sm text-gray-500"}," Esta vista es solo para clientes normales. ",-1),tg={class:"mt-2 text-xs text-gray-400"},sg={key:2},og={class:"mb-8"},ag={class:"sm:flex sm:items-center sm:justify-between"},ig=e("div",null,[e("h1",{class:"text-2xl font-bold leading-6 text-gray-900"}," Mis Organizaciones "),e("p",{class:"mt-2 text-sm text-gray-700"}," Gestiona tus membresías, invitaciones y solicitudes corporativas ")],-1),ng={class:"mt-4 sm:mt-0 flex space-x-3"},rg=["disabled","title"],lg={key:0,class:"mb-8",ref:"postsSection"},cg=e("div",{class:"mb-6"},[e("h2",{class:"text-lg font-medium text-gray-900"},"Anuncios de Organizaciones"),e("p",{class:"mt-1 text-sm text-gray-600"}," Información importante de las organizaciones donde eres miembro ")],-1),dg={class:"space-y-8"},ug={class:"bg-white shadow rounded-lg overflow-hidden"},mg={class:"px-6 py-4 border-b border-gray-200"},gg={class:"flex items-center space-x-4"},fg=["src","alt"],hg={class:"text-lg font-semibold text-gray-900"},vg={class:"text-sm text-gray-600"},pg={class:"px-6 py-4"},_g={class:"border-b border-gray-200 mb-6"},bg={class:"-mb-px flex space-x-8"},yg=["onClick","disabled","title"],xg={class:"space-y-6"},wg={key:0},$g={key:1},zg={key:2},Eg={__name:"ClientDashboard",setup(t){const o=ge(),s=Ae(),n=Le(),d=Be(),i=R("organizations"),g=R(!1),h=R({}),m=D(()=>o.isLoading||s.isLoadingRequests),x=D(()=>{var S,L;return((S=n.currentUser)==null?void 0:S.role)==="client"||((L=n.currentUser)==null?void 0:L.role)==="basic"}),v=D(()=>o.myInvitations),p=D(()=>o.myMemberships),b=D(()=>s.myRequests),f=D(()=>[{id:"organizations",name:"Mis Organizaciones",icon:ke,count:p.value.length,disabled:!1},{id:"requests",name:"Mis Solicitudes",icon:Ne,count:b.value.length,disabled:p.value.length===0},{id:"invitations",name:"Invitaciones",icon:De,count:v.value.filter(S=>S.status==="PENDING").length,disabled:!1}]),E=async()=>{var S,L,oe;try{const k=(S=n.currentUser)==null?void 0:S.role;if(!k){console.error("User role not available");return}if(k!=="client"&&k!=="basic"){console.error("User is not a client or basic user, cannot load dashboard data");return}console.log("Loading dashboard data for role:",k),(await Promise.allSettled([o.getMyInvitations(),o.getMyMemberships(),s.getMyRequests({page_size:50})])).forEach((U,I)=>{var A,H;U.status==="rejected"&&(console.error(`Error loading ${["invitations","memberships","requests"][I]}:`,U.reason),I===2&&((H=(A=U.reason)==null?void 0:A.response)==null?void 0:H.status)===403&&console.log("User may not have organization memberships yet, skipping request load"))}),console.log("Dashboard data loaded successfully")}catch(k){console.error("Error loading dashboard data:",k),((L=k.response)==null?void 0:L.status)===403?console.error("Access denied. User may not have proper permissions."):((oe=k.response)==null?void 0:oe.status)===401&&console.error("Authentication error. User may need to log in again.")}},w=()=>{g.value=!0},C=()=>{g.value=!1},M=S=>{Promise.all([o.getMyInvitations(),o.getMyMemberships()])},z=S=>{o.getMyMemberships()},_=S=>{C(),s.getMyRequests(),i.value="requests"},$=S=>{d.push({name:"organizations_dashboard",query:{tab:"request-detail",id:S}})},P=(S,L)=>{S&&(h.value[L]=S)},O=S=>{const L=h.value[S];if(L){const k=L.getBoundingClientRect().top+window.pageYOffset-150;window.scrollTo({top:k,behavior:"smooth"}),L.classList.add("ring-2","ring-blue-500","ring-offset-2"),setTimeout(()=>{L.classList.remove("ring-2","ring-blue-500","ring-offset-2")},2e3)}};return te(p,S=>{S.length===0&&i.value==="requests"&&(i.value="organizations")}),we(async()=>{var L;console.log("ClientDashboard mounted"),n.currentUser||(console.log("Waiting for user data to be available..."),await n.init());const S=(L=n.currentUser)==null?void 0:L.role;console.log("Current user role:",S),S==="client"||S==="basic"?E():console.error("User does not have client or basic role. Current role:",S)}),(S,L)=>{var oe;return a(),r("div",Fm,[m.value?(a(),r("div",Hm,Jm)):x.value?(a(),r("div",sg,[e("div",og,[e("div",ag,[ig,e("div",ng,[e("button",{onClick:w,disabled:p.value.length===0,class:T([p.value.length===0?"bg-gray-300 cursor-not-allowed text-gray-500":"bg-blue-600 hover:bg-blue-700 text-white","inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"]),title:p.value.length===0?"Debes ser miembro de una organización para crear solicitudes":""},[u(c(_e),{class:"h-4 w-4 mr-2"}),y(" Nueva Solicitud ")],10,rg)])])]),p.value.length>0?(a(),r("div",lg,[cg,e("div",dg,[(a(!0),r(Z,null,Q(p.value,k=>(a(),r("div",{key:`posts-${k.id}`,ref_for:!0,ref:V=>P(V,k.id)},[e("div",ug,[e("div",mg,[e("div",gg,[e("img",{src:k.profile_image_url||c(J),alt:`Logo de ${k.title}`,class:"h-12 w-12 rounded-full object-cover bg-gray-100"},null,8,fg),e("div",null,[e("h3",hg,l(k.title),1),e("p",vg,l(k.description),1)])])]),e("div",pg,[u(Bm,{"organization-id":k.id},null,8,["organization-id"])])])]))),128))])],512)):q("",!0),e("div",_g,[e("nav",bg,[(a(!0),r(Z,null,Q(f.value,k=>(a(),r("button",{key:k.id,onClick:V=>!k.disabled&&(i.value=k.id),disabled:k.disabled,class:T([k.disabled?"border-transparent text-gray-300 cursor-not-allowed":i.value===k.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-colors"]),title:k.disabled?"Debes ser miembro de al menos una organización para acceder a esta sección":""},[(a(),G(tt(k.icon),{class:"h-5 w-5 mr-2 inline"})),y(" "+l(k.name)+" ",1),k.count!==void 0?(a(),r("span",{key:0,class:T([k.disabled?"bg-gray-100 text-gray-400":i.value===k.id?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-900","ml-2 py-0.5 px-2.5 rounded-full text-xs font-medium"])},l(k.count),3)):q("",!0)],10,yg))),128))])]),e("div",xg,[i.value==="organizations"?(a(),r("div",wg,[u(pu,{organizations:p.value,"is-loading":c(o).isLoading,onOrganizationLeft:z,onCreateRequest:w,onViewDetails:O},null,8,["organizations","is-loading"])])):q("",!0),i.value==="requests"?(a(),r("div",$g,[u(c0,{requests:b.value,"is-loading":c(s).isLoadingRequests,onRequestDetail:$,onCreateRequest:w},null,8,["requests","is-loading"])])):q("",!0),i.value==="invitations"?(a(),r("div",zg,[u(Rd,{invitations:v.value,"is-loading":c(o).isLoadingInvitations,onInvitationResponded:M},null,8,["invitations","is-loading"])])):q("",!0)])])):(a(),r("div",Qm,[e("div",Ym,[Xm,Km,eg,e("p",tg," Tu rol actual: "+l(((oe=c(n).currentUser)==null?void 0:oe.role)||"Sin definir"),1)])])),u(im,{visible:g.value,organizations:p.value,onClose:C,onCreated:_},null,8,["visible","organizations"])])}}},kg={__name:"ClientOrganizationsView",setup(t){return(o,s)=>(a(),G(Eg))}},qg={class:"px-4 py-6 sm:px-6 lg:px-8"},Cg={key:0,class:"flex justify-center items-center py-12"},Rg=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),Mg=e("span",{class:"ml-2 text-gray-600"},"Cargando solicitud...",-1),Pg=[Rg,Mg],Sg={key:1,class:"text-center py-12"},Dg={class:"mx-auto max-w-md"},Ig=e("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),Lg=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Error al cargar la solicitud",-1),jg={class:"mt-1 text-sm text-gray-500"},Og={class:"mt-6"},Ng={key:2},Ag={class:"mb-6"},Ug={class:"flex items-center justify-between"},Vg={class:"flex items-center space-x-4"},Tg={class:"text-2xl font-bold text-gray-900"},Gg={class:"text-sm text-gray-600"},Bg={class:"flex items-center space-x-2"},Fg={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},Hg={class:"lg:col-span-2 space-y-6"},Wg={class:"bg-white shadow rounded-lg p-6"},Zg=e("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Detalles de la Solicitud",-1),Jg={class:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2"},Qg=e("dt",{class:"text-sm font-medium text-gray-500"},"Tipo de Solicitud",-1),Yg={class:"mt-1 text-sm text-gray-900"},Xg=e("dt",{class:"text-sm font-medium text-gray-500"},"Fecha de Creación",-1),Kg={class:"mt-1 text-sm text-gray-900"},ef={key:0},tf=e("dt",{class:"text-sm font-medium text-gray-500"},"Última Actualización",-1),sf={class:"mt-1 text-sm text-gray-900"},of=e("dt",{class:"text-sm font-medium text-gray-500"},"Días Transcurridos",-1),af={class:"mt-1 text-sm text-gray-900"},nf={key:1},rf=e("dt",{class:"text-sm font-medium text-gray-500"},"Fecha Estimada de Completado",-1),lf={class:"mt-1 text-sm text-gray-900"},cf={key:2},df=e("dt",{class:"text-sm font-medium text-gray-500"},"Fecha de Completado",-1),uf={class:"mt-1 text-sm text-gray-900"},mf={class:"mt-6"},gf=e("dt",{class:"text-sm font-medium text-gray-500 mb-2"},"Descripción",-1),ff={class:"text-sm text-gray-900 whitespace-pre-wrap"},hf={key:0,class:"bg-white shadow rounded-lg p-6"},vf=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Archivos Adjuntos",-1),pf={class:"space-y-3"},_f={class:"flex items-center space-x-3"},bf={class:"text-sm font-medium text-gray-900"},yf={class:"text-xs text-gray-500"},xf=["href"],wf={class:"bg-white shadow rounded-lg p-6"},$f={class:"text-lg font-medium text-gray-900 mb-4"},zf={key:0,class:"space-y-4"},Ef={class:"flex items-start justify-between mb-2"},kf={class:"flex items-center space-x-2"},qf={class:"text-sm font-medium text-gray-900"},Cf={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800"},Rf={class:"text-xs text-gray-500"},Mf={class:"text-sm text-gray-700 whitespace-pre-wrap"},Pf={key:1,class:"text-center py-6"},Sf=e("p",{class:"text-sm text-gray-500"},"No hay respuestas aún",-1),Df=e("label",{for:"response",class:"block text-sm font-medium text-gray-700 mb-2"}," Agregar Respuesta ",-1),If=["disabled"],Lf={key:0,class:"mt-3"},jf={class:"flex items-center"},Of=e("span",{class:"ml-2 text-sm text-gray-700"},"Nota interna (solo visible para el equipo corporativo)",-1),Nf={class:"mt-3 flex justify-end"},Af=["disabled"],Uf={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Vf={class:"space-y-6"},Tf={class:"bg-white shadow rounded-lg p-6"},Gf=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Participantes",-1),Bf={class:"space-y-4"},Ff={class:"flex items-center space-x-3"},Hf=["src","alt"],Wf={class:"text-sm font-medium text-gray-900"},Zf={class:"text-xs text-gray-500"},Jf={class:"flex items-center space-x-3"},Qf=["src","alt"],Yf={class:"text-sm font-medium text-gray-900"},Xf={class:"text-xs text-gray-500"},Kf={key:0,class:"flex items-center space-x-3"},eh=["src","alt"],th={class:"text-sm font-medium text-gray-900"},sh={class:"text-xs text-gray-500"},oh={key:0,class:"bg-white shadow rounded-lg p-6"},ah=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Organización",-1),ih={class:"flex items-center space-x-3"},nh=["src","alt"],rh={class:"text-sm font-medium text-gray-900"},lh=e("p",{class:"text-xs text-gray-500"},"Vía organización",-1),ch={key:1,class:"bg-white shadow rounded-lg p-6"},dh=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Acciones",-1),uh={class:"space-y-3"},mh=e("label",{for:"status",class:"block text-sm font-medium text-gray-700 mb-2"}," Cambiar Estado ",-1),gh=["disabled"],fh=xe('<option value="PENDING">Pendiente</option><option value="IN_REVIEW">En Revisión</option><option value="RESPONDED">Respondida</option><option value="RESOLVED">Resuelta</option><option value="CLOSED">Cerrada</option>',5),hh=[fh],vh={__name:"RequestDetailView",setup(t){const o=Ae(),s=Le(),n=gt(),d=Be(),i=R(null),g=R(!1),h=R(null),m=R(""),x=R(!1),v=R(!1),p=R(""),b=R(!1),f=D(()=>{var I;return(I=s.currentUser)==null?void 0:I.role}),E=D(()=>{var I,A;return((A=(I=i.value)==null?void 0:I.client_info)==null?void 0:A.profile_image_url)||J}),w=D(()=>{var I,A;return((A=(I=i.value)==null?void 0:I.corporate_client_info)==null?void 0:A.profile_image_url)||J}),C=D(()=>{var I,A;return((A=(I=i.value)==null?void 0:I.assigned_to_info)==null?void 0:A.profile_image_url)||J}),M=async()=>{var I,A;try{g.value=!0,h.value=null;const H=n.query.id;if(!H)throw new Error("ID de solicitud no proporcionado");let K;if(f.value==="client"||f.value==="basic")K=await o.getMyRequestDetail(H);else if(f.value==="corporate_client")K=await o.getReceivedRequestDetail(H);else throw new Error("Rol de usuario no válido");i.value=K.corporate_request,p.value=i.value.status}catch(H){console.error("Error loading request detail:",H),h.value=((A=(I=H.response)==null?void 0:I.data)==null?void 0:A.error)||H.message||"Error al cargar la solicitud"}finally{g.value=!1}},z=async()=>{var I,A;try{v.value=!0;const H={response_text:m.value.trim()};f.value==="corporate_client"&&(H.is_internal_note=x.value);let K;f.value==="client"||f.value==="basic"?K=await o.addResponseToMyRequest(i.value.id,H):f.value==="corporate_client"&&(K=await o.addResponseToReceivedRequest(i.value.id,H)),o.currentRequest&&o.currentRequest.id===i.value.id&&(i.value.responses=o.currentRequest.responses,i.value.response_count=o.currentRequest.response_count),m.value="",x.value=!1,j("Respuesta enviada exitosamente","success")}catch(H){console.error("Error submitting response:",H),j(((A=(I=H.response)==null?void 0:I.data)==null?void 0:A.error)||"Error al enviar la respuesta","error")}finally{v.value=!1}},_=async()=>{var I,A;if(p.value!==i.value.status)try{b.value=!0,await o.updateReceivedRequest(i.value.id,{status:p.value}),i.value.status=p.value,i.value.status_updated_at=new Date().toISOString(),j("Estado actualizado exitosamente","success")}catch(H){console.error("Error updating status:",H),j(((A=(I=H.response)==null?void 0:I.data)==null?void 0:A.error)||"Error al actualizar el estado","error"),p.value=i.value.status}finally{b.value=!1}},$=()=>{d.push({name:"organizations_dashboard"})},P=I=>new Date(I).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),O=I=>{const A=new Date(I),K=Math.abs(new Date-A),de=Math.ceil(K/(1e3*60*60*24));return de===0?"Hoy":de===1?"Ayer":de<7?`Hace ${de} días`:P(I)},S=I=>{if(I===0)return"0 Bytes";const A=1024,H=["Bytes","KB","MB","GB"],K=Math.floor(Math.log(I)/Math.log(A));return parseFloat((I/Math.pow(A,K)).toFixed(2))+" "+H[K]},L=I=>({PENDING:"Pendiente",IN_REVIEW:"En Revisión",RESPONDED:"Respondida",RESOLVED:"Resuelta",CLOSED:"Cerrada"})[I]||I,oe=I=>({PENDING:"bg-yellow-100 text-yellow-800",IN_REVIEW:"bg-blue-100 text-blue-800",RESPONDED:"bg-purple-100 text-purple-800",RESOLVED:"bg-green-100 text-green-800",CLOSED:"bg-gray-100 text-gray-800"})[I]||"bg-gray-100 text-gray-800",k=I=>({LOW:"Baja",MEDIUM:"Media",HIGH:"Alta",URGENT:"Urgente"})[I]||I,V=I=>({LOW:"bg-gray-100 text-gray-600",MEDIUM:"bg-blue-100 text-blue-600",HIGH:"bg-orange-100 text-orange-600",URGENT:"bg-red-100 text-red-600"})[I]||"bg-gray-100 text-gray-600",U=I=>({client:"Cliente",corporate_client:"Cliente Corporativo"})[I]||I;return te(()=>n.query.id,()=>{n.query.id&&M()}),we(()=>{n.query.id&&M()}),(I,A)=>{var H,K,de,Pe,B,ie,ne,W,ze,Je;return a(),r("div",qg,[g.value?(a(),r("div",Cg,Pg)):h.value?(a(),r("div",Sg,[e("div",Dg,[Ig,Lg,e("p",jg,l(h.value),1),e("div",Og,[e("button",{onClick:$,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(Xe),{class:"h-4 w-4 mr-2"}),y(" Volver ")])])])])):i.value?(a(),r("div",Ng,[e("div",Ag,[e("div",Ug,[e("div",Vg,[e("button",{onClick:$,class:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(Xe),{class:"h-4 w-4 mr-2"}),y(" Volver ")]),e("div",null,[e("h1",Tg,l(i.value.title),1),e("p",Gg,"Solicitud "+l(i.value.request_number),1)])]),e("div",Bg,[e("span",{class:T([oe(i.value.status),"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"])},l(L(i.value.status)),3),e("span",{class:T([V(i.value.priority),"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"])},l(k(i.value.priority)),3)])])]),e("div",Fg,[e("div",Hg,[e("div",Wg,[Zg,e("dl",Jg,[e("div",null,[Qg,e("dd",Yg,l(i.value.request_type_name),1)]),e("div",null,[Xg,e("dd",Kg,l(P(i.value.created_at)),1)]),i.value.status_updated_at&&i.value.status_updated_at!==i.value.created_at?(a(),r("div",ef,[tf,e("dd",sf,l(P(i.value.status_updated_at)),1)])):q("",!0),e("div",null,[of,e("dd",af,l(i.value.days_since_created)+" días",1)]),i.value.estimated_completion_date?(a(),r("div",nf,[rf,e("dd",lf,l(P(i.value.estimated_completion_date)),1)])):q("",!0),i.value.actual_completion_date?(a(),r("div",cf,[df,e("dd",uf,l(P(i.value.actual_completion_date)),1)])):q("",!0)]),e("div",mf,[gf,e("dd",ff,l(i.value.description),1)])]),i.value.files&&i.value.files.length>0?(a(),r("div",hf,[vf,e("div",pf,[(a(!0),r(Z,null,Q(i.value.files,Y=>(a(),r("div",{key:Y.id,class:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50"},[e("div",_f,[u(c(Fe),{class:"h-8 w-8 text-gray-400"}),e("div",null,[e("p",bf,l(Y.file_name),1),e("p",yf,l(S(Y.file_size)),1)])]),e("a",{href:Y.file_url,target:"_blank",class:"inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50"},[u(c(yt),{class:"h-3 w-3 mr-1"}),y(" Descargar ")],8,xf)]))),128))])])):q("",!0),e("div",wf,[e("h3",$f," Conversación ("+l(((H=i.value.responses)==null?void 0:H.length)||0)+" respuestas) ",1),i.value.responses&&i.value.responses.length>0?(a(),r("div",zf,[(a(!0),r(Z,null,Q(i.value.responses,Y=>(a(),r("div",{key:Y.id,class:T(["p-4 rounded-lg",Y.user_type===f.value?"bg-blue-50 border-l-4 border-blue-400":"bg-gray-50 border-l-4 border-gray-300"])},[e("div",Ef,[e("div",kf,[e("span",qf,l(Y.user_name),1),e("span",{class:T(["inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",Y.user_type==="corporate_client"?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"])},l(U(Y.user_type)),3),Y.is_internal_note?(a(),r("span",Cf," Nota Interna ")):q("",!0)]),e("span",Rf,l(O(Y.created_at)),1)]),e("p",Mf,l(Y.response_text),1)],2))),128))])):(a(),r("div",Pf,[u(c(We),{class:"h-12 w-12 mx-auto mb-3 text-gray-300"}),Sf])),e("form",{onSubmit:be(z,["prevent"]),class:"mt-6 border-t pt-6"},[e("div",null,[Df,F(e("textarea",{id:"response","onUpdate:modelValue":A[0]||(A[0]=Y=>m.value=Y),rows:"3",required:"",disabled:v.value,class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Escribe tu respuesta..."},null,8,If),[[ae,m.value]])]),f.value==="corporate_client"?(a(),r("div",Lf,[e("label",jf,[F(e("input",{"onUpdate:modelValue":A[1]||(A[1]=Y=>x.value=Y),type:"checkbox",class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[Ue,x.value]]),Of])])):q("",!0),e("div",Nf,[e("button",{type:"submit",disabled:v.value||!m.value.trim(),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},[v.value?(a(),r("div",Uf)):(a(),G(c(nt),{key:1,class:"h-4 w-4 mr-2"})),y(" "+l(v.value?"Enviando...":"Enviar Respuesta"),1)],8,Af)])],32)])]),e("div",Vf,[e("div",Tf,[Gf,e("div",Bf,[e("div",Ff,[e("img",{src:E.value,alt:`Avatar de ${(K=i.value.client_info)==null?void 0:K.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,Hf),e("div",null,[e("p",Wf,l((de=i.value.client_info)==null?void 0:de.full_name),1),e("p",Zf,"Cliente • "+l((Pe=i.value.client_info)==null?void 0:Pe.email),1)])]),e("div",Jf,[e("img",{src:w.value,alt:`Avatar de ${(B=i.value.corporate_client_info)==null?void 0:B.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,Qf),e("div",null,[e("p",Yf,l((ie=i.value.corporate_client_info)==null?void 0:ie.full_name),1),e("p",Xf,"Cliente Corporativo • "+l((ne=i.value.corporate_client_info)==null?void 0:ne.email),1)])]),i.value.assigned_to_info?(a(),r("div",Kf,[e("img",{src:C.value,alt:`Avatar de ${(W=i.value.assigned_to_info)==null?void 0:W.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,eh),e("div",null,[e("p",th,l((ze=i.value.assigned_to_info)==null?void 0:ze.full_name),1),e("p",sh,"Asignado • "+l((Je=i.value.assigned_to_info)==null?void 0:Je.email),1)])])):q("",!0)])]),i.value.organization_info?(a(),r("div",oh,[ah,e("div",ih,[e("img",{src:i.value.organization_info.profile_image_url||c(J),alt:`Logo de ${i.value.organization_info.title}`,class:"h-10 w-10 rounded-full object-cover border border-gray-200"},null,8,nh),e("div",null,[e("p",rh,l(i.value.organization_info.title),1),lh])])])):q("",!0),f.value==="corporate_client"?(a(),r("div",ch,[dh,e("div",uh,[e("div",null,[mh,F(e("select",{id:"status","onUpdate:modelValue":A[2]||(A[2]=Y=>p.value=Y),onChange:_,disabled:b.value,class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},hh,40,gh),[[ue,p.value]])])])])):q("",!0)])])])):q("",!0)])}}},ph={key:1},_h={class:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8"},bh=e("h1",{class:"text-lg font-semibold leading-6 text-gray-900"},"Organizaciones",-1),yh={key:2,class:"px-4 py-6 sm:px-6 lg:px-8"},xh=xe('<div class="text-center py-12"><div class="mx-auto max-w-md"><svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"></path></svg><h3 class="mt-2 text-sm font-medium text-gray-900">Acceso Restringido</h3><p class="mt-1 text-sm text-gray-500"> No tienes permisos para acceder a este módulo. </p></div></div>',1),wh=[xh],Ah={__name:"Dashboard",setup(t){const o=Le(),s=D(()=>{var n;return((n=o.currentUser)==null?void 0:n.role)||null});return(n,d)=>(a(),r("div",null,[n.$route.query.tab==="request-detail"?(a(),G(vh,{key:0})):(a(),r("div",ph,[e("div",_h,[ft(n.$slots,"default"),bh]),s.value==="corporate_client"?(a(),G(Ic,{key:0})):s.value==="client"||s.value==="basic"?(a(),G(kg,{key:1})):(a(),r("div",yh,wh))]))]))}};export{Ah as default};
