import{e as r,f as c,g as e,u as Ce,r as U,aH as ze,o as Z,ap as he,c as A,j as w,l as p,G as se,w as re,v as Se,n as z,i as C,t as T,h as le,p as K,s as P,ab as Oe,k as G,aU as ne,a8 as Pe,aV as He,Q as be,m as Q,a1 as ce,F as V,P as ee,N as fe,O as pe,C as Ge,D as xe,E as We,aW as Je,a0 as Ke,a as Ze,aX as ke,aY as Qe,T as W,M as q,ae as Xe}from"./index.js";import{u as X,s as ge,p as Ee,o as Ye}from"./dynamicDocument.js";import{g as de,r as Fe,a as ye}from"./color_palette.js";import{_ as et}from"./SearchBarAndFilterBy.js";import{r as Ve,a as ie,_ as ue}from"./DocumentCard.js";import{r as Y}from"./PlusIcon.js";import{_ as ve}from"./_plugin-vue_export-helper.js";import{r as Me}from"./MagnifyingGlassIcon2.js";import{B as tt,a as st,r as Te,_ as Le}from"./index2.js";import{_ as Ie,S as De}from"./SignaturesList.js";import{r as Ae}from"./loading_message.js";import{r as ot}from"./TrashIcon.js";import{useRecentViews as rt}from"./useRecentViews.js";import"./MagnifyingGlassIcon.js";import"./PhotoIcon.js";function nt(t,o){return r(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function at(t,o){return r(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function je(t,o){return r(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 6h.008v.008H6V6Z"})])}const lt={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},it={class:"flex justify-end"},dt=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[K(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),ct={class:"mt-2"},ut={class:"flex gap-2 mt-2.5"},mt=["disabled"],gt=e("span",null,"Actualizar nombre",-1),ht=[gt],ft=["disabled"],pt={__name:"UseDocumentByClient",props:{documentId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(t,{emit:o}){const s=t,g=Ce(),h=X(),i=o,a=U(""),b=U(""),u=()=>{i("close")};ze(()=>{var m,_;h.selectedDocument?(a.value=((m=h.selectedDocument)==null?void 0:m.title)||"",b.value=((_=h.selectedDocument)==null?void 0:_.title)||""):(a.value="",b.value="")});const d=m=>{m.key==="Escape"&&u()};Z(()=>{document.addEventListener("keydown",d)}),he(()=>{document.removeEventListener("keydown",d)});const f=A(()=>a.value.trim().length>0),y=A(()=>{var m;return!!((m=h.selectedDocument)!=null&&m.id)}),L=A(()=>y.value&&a.value.trim()!==b.value.trim()&&a.value.trim().length>0);async function D(){if(y.value&&L.value)try{const m={title:a.value.trim()};await h.updateDocument(h.selectedDocument.id,m),b.value=a.value.trim(),h.selectedDocument.title=a.value.trim();const _=h.selectedDocument.id;P("Document name successfully updated.","success"),i("close",{updatedDocId:_});const S=window.location.pathname;S==="/dynamic_document_dashboard"||S==="/dynamic_document_dashboard/"||setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(m){console.error("Error updating document name:",m),P("Error updating document name.","error")}}function v(){const m=encodeURIComponent(a.value.trim());s.documentId&&!h.selectedDocument?g.push(`/dynamic_document_dashboard/document/use/creator/${s.documentId}/${m}`):h.selectedDocument?(h.selectedDocument.title=a.value.trim(),g.push(`/dynamic_document_dashboard/document/use/editor/${h.selectedDocument.id}/${m}`)):P("Error: No se pudo continuar. Documento no seleccionado.","error")}return(m,_)=>(r(),c("div",lt,[e("div",it,[e("button",{onClick:u},[w(p(se),{class:"size-6"})])]),e("form",{onSubmit:le(v,["prevent"])},[e("div",null,[dt,e("div",ct,[re(e("input",{"onUpdate:modelValue":_[0]||(_[0]=I=>a.value=I),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[Se,a.value]])])]),e("div",ut,[y.value?(r(),c("button",{key:0,type:"button",onClick:D,disabled:!L.value,class:z(["p-2.5 text-sm font-medium rounded-md flex gap-2",L.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},ht,10,mt)):C("",!0),e("button",{type:"submit",class:z(["p-2.5 text-sm font-medium rounded-md flex gap-2",f.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!f.value},[e("span",null,T(y.value?"Editar Documento":"Continuar"),1)],10,ft)])],32)]))}},vt={class:"mt-3 pt-2 border-t border-gray-100"},yt={class:"flex items-center gap-2 text-xs text-gray-500"},bt=e("span",null,"Hacer clic para usar este documento",-1),Ue={__name:"UseDocumentCard",props:{document:{type:Object,required:!0},showTags:{type:Boolean,default:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null}},emits:["click","remove-from-folder","document-created"],setup(t,{emit:o}){const s=t,g=o,h=U(!1),i=U(null),a=de(9),b=A(()=>"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium !bg-purple-100 !text-purple-700 !border !border-purple-200"),u=A(()=>a.dark),d=A(()=>"group !border-purple-400 !bg-purple-50/50 !shadow-purple-100"),f=A(()=>s.menuOptions!==null?s.menuOptions:null),y=A(()=>s.disableInternalActions?!1:s.showMenuOptions===!1||s.showMenuOptions!==!0&&s.cardContext!=="folder"),L=(m,_)=>{s.disableInternalActions?g("click",m,_):D(m.id)};function D(m){m?(i.value=m,h.value=!0):console.error("Document ID is required:",m)}function v(m){if(h.value=!1,i.value=null,m&&m.updatedDocId){g("document-created",m);const _=window.location.pathname;_==="/dynamic_document_dashboard"||_==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(m.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}}return(m,_)=>(r(),c(V,null,[w(tt,{document:t.document,"card-type":t.cardType,"card-context":t.cardContext,"status-icon":p(He),"status-text":"Disponible","status-badge-classes":b.value,"menu-options":f.value,"highlighted-doc-id":null,"show-tags":t.showTags,"document-store":t.documentStore,"user-store":t.userStore,"additional-classes":d.value,"disable-internal-actions":t.disableInternalActions,"show-menu-options":t.showMenuOptions,onClick:L,onRemoveFromFolder:_[0]||(_[0]=I=>m.$emit("remove-from-folder",I))},Oe({"additional-actions":G(()=>[Pe(m.$slots,"additional-actions")]),_:2},[y.value?{name:"right-action",fn:G(()=>[w(p(Ve),{class:"w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors"})]),key:"0"}:void 0,t.disableInternalActions?void 0:{name:"footer",fn:G(()=>[e("div",vt,[e("div",yt,[e("div",{class:"w-2 h-2 rounded-full",style:ne({backgroundColor:u.value})},null,4),bt])])]),key:"1"}]),1032,["document","card-type","card-context","status-icon","status-badge-classes","menu-options","show-tags","document-store","user-store","additional-classes","disable-internal-actions","show-menu-options"]),re(w(ce,null,{default:G(()=>[i.value!==null?(r(),Q(pt,{key:0,"document-id":i.value,onClose:v},null,8,["document-id"])):C("",!0)]),_:1},512),[[be,h.value]])],64))}},_e=t=>(fe("data-v-e9f2ca4d"),t=t(),pe(),t),xt={class:"flex items-start justify-between mb-4"},_t={class:"flex items-center gap-3"},wt={class:"relative"},$t={class:"flex-1 min-w-0"},kt={class:"font-medium text-gray-900 text-sm truncate group-hover:text-primary transition-colors"},Dt={class:"text-xs text-gray-500 mt-0.5"},Ct={class:"relative folder-menu-container"},St={key:0,class:"absolute right-0 top-full mt-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50"},Ft=_e(()=>e("div",{class:"border-t border-gray-100 my-1"},null,-1)),It={class:"space-y-2"},Et={key:0,class:"flex items-center gap-2"},Tt=_e(()=>e("div",{class:"w-2 h-2 bg-blue-500 rounded-full"},null,-1)),Lt={class:"text-xs text-gray-600"},At={key:1,class:"flex items-center gap-2"},Ut=_e(()=>e("div",{class:"w-2 h-2 bg-green-500 rounded-full"},null,-1)),Bt={class:"text-xs text-gray-600"},Mt={key:2,class:"flex items-center gap-2"},jt=_e(()=>e("div",{class:"w-2 h-2 bg-orange-500 rounded-full"},null,-1)),Nt={class:"text-xs text-gray-600"},zt={key:3,class:"text-center py-3"},Pt=_e(()=>e("p",{class:"text-xs text-gray-500"},"Carpeta vac√≠a",-1)),Qt={class:"mt-4 pt-3 border-t border-gray-100"},Vt={class:"flex items-center justify-between"},qt={class:"text-xs text-gray-500"},Rt={__name:"FolderCard",props:{folder:{type:Object,required:!0}},emits:["click","edit","delete","add-documents"],setup(t,{emit:o}){const s=t,g=o,h=ee(),i=U(!1),a=U(!1),b=A(()=>h.currentUser),u=A(()=>de(s.folder.color_id)||{hex:"#6B7280",name:"Gray"}),d=A(()=>s.folder.documents?s.folder.documents.length:0),f=A(()=>{if(!s.folder.documents)return{myDocuments:[],useDocuments:[],signatureDocuments:[]};const l=s.folder.documents;return{myDocuments:l.filter(x=>{var n;return x.assigned_to===((n=b.value)==null?void 0:n.id)&&(x.state==="Progress"||x.state==="Completed")}),useDocuments:l.filter(x=>x.state==="Published"&&!x.assigned_to),signatureDocuments:l.filter(x=>x.state==="PendingSignatures"||x.state==="FullySigned")}}),y=l=>{l.target.closest(".folder-menu-container")||a.value||i.value||g("click",s.folder)},L=()=>{i.value=!i.value},D=(l=!1)=>{i.value=!1,l&&(a.value=!0,setTimeout(()=>{a.value=!1},50))},v=()=>{D(!1),g("edit",s.folder)},m=()=>{D(!1),g("delete",s.folder)},_=()=>{D(!1),g("add-documents",s.folder)},I=l=>{if(!l)return"";const x=new Date(l),$=Math.abs(new Date-x),E=Math.floor($/(1e3*60*60*24));if(E===0)return"hoy";if(E===1)return"ayer";if(E<7)return`hace ${E} d√≠as`;if(E<30){const M=Math.floor(E/7);return`hace ${M} ${M===1?"semana":"semanas"}`}else if(E<365){const M=Math.floor(E/30);return`hace ${M} ${M===1?"mes":"meses"}`}else return x.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},S=l=>{i.value&&!l.target.closest(".folder-menu-container")&&D(!0)};return Z(()=>{document.addEventListener("click",S)}),he(()=>{document.removeEventListener("click",S)}),(l,x)=>(r(),c("div",{class:"relative bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 p-5 cursor-pointer group",onClick:y},[e("div",xt,[e("div",_t,[e("div",wt,[w(p(ie),{class:"w-10 h-10 text-gray-400",style:ne({color:u.value.hex})},null,8,["style"]),e("div",{class:"absolute -top-1 -right-1 w-4 h-4 rounded-full border-2 border-white shadow-sm",style:ne({backgroundColor:u.value.hex})},null,4)]),e("div",$t,[e("h3",kt,T(t.folder.name),1),e("p",Dt,T(d.value)+" "+T(d.value===1?"documento":"documentos"),1)])]),e("div",Ct,[e("button",{onClick:le(L,["stop"]),class:z(["opacity-100 transition-opacity p-1.5 rounded-full hover:bg-gray-100",{"bg-gray-100":i.value}])},[w(p(st),{class:"w-4 h-4 text-gray-500"})],2),i.value?(r(),c("div",St,[e("button",{onClick:le(v,["stop"]),class:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[w(p(Fe),{class:"w-4 h-4"}),K(" Editar carpeta ")]),e("button",{onClick:le(_,["stop"]),class:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[w(p(Y),{class:"w-4 h-4"}),K(" Agregar documentos ")]),Ft,e("button",{onClick:le(m,["stop"]),class:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2"},[w(p(ot),{class:"w-4 h-4"}),K(" Eliminar carpeta ")])])):C("",!0)])]),e("div",It,[f.value.myDocuments.length>0?(r(),c("div",Et,[Tt,e("span",Lt,T(f.value.myDocuments.length)+" mis documentos ",1)])):C("",!0),f.value.useDocuments.length>0?(r(),c("div",At,[Ut,e("span",Bt,T(f.value.useDocuments.length)+" formatos disponibles ",1)])):C("",!0),f.value.signatureDocuments.length>0?(r(),c("div",Mt,[jt,e("span",Nt,T(f.value.signatureDocuments.length)+" documentos con firmas ",1)])):C("",!0),d.value===0?(r(),c("div",zt,[w(p(Ae),{class:"w-8 h-8 text-gray-300 mx-auto mb-1"}),Pt])):C("",!0)]),e("div",Qt,[e("div",Vt,[e("span",qt," Creada "+T(I(t.folder.created_at)),1),w(p(Ve),{class:"w-4 h-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})])]),i.value?(r(),c("div",{key:0,onClick:D,class:"fixed inset-0 z-5"})):C("",!0)]))}},Ot=ve(Rt,[["__scopeId","data-v-e9f2ca4d"]]),Be=Ge("documentFolder",{state:()=>({folders:[],currentFolder:null,isLoading:!1,error:null,lastUpdatedFolderId:null}),getters:{sortedFolders:t=>[...t.folders].sort((o,s)=>new Date(s.created_at)-new Date(o.created_at)),getFolderById:t=>o=>t.folders.find(s=>s.id===o),getFoldersByColor:t=>o=>t.folders.filter(s=>s.color_id===o),getFolderWithColor:t=>o=>{const s=t.folders.find(g=>g.id===o);return s?{...s,color:de(s.color_id)}:null},getFoldersContainingDocument:t=>o=>t.folders.filter(s=>s.document_ids&&s.document_ids.includes(o)),totalDocumentsInFolders:t=>t.folders.reduce((o,s)=>o+(s.document_ids?s.document_ids.length:0),0),hasFolders:t=>t.folders.length>0,availableColors:()=>ye()},actions:{async init(t=!1){if(!(this.folders.length>0&&!t)){this.isLoading=!0,this.error=null;try{await this.fetchFolders()}catch(o){console.error("Error initializing document folder store:",o),this.error="Error al inicializar las carpetas"}finally{this.isLoading=!1}}},async fetchFolders(){try{const t=await xe("dynamic-documents/folders/");if(t.status===200)return this.folders=t.data,t.data;throw new Error(`Error fetching folders: ${t.status}`)}catch(t){throw console.error("Error fetching folders:",t),this.error="Error al obtener las carpetas",t}},async fetchFolder(t){this.isLoading=!0,this.error=null;try{const o=await xe(`dynamic-documents/folders/${t}/`);if(o.status===200){const s=o.data,g=this.folders.findIndex(h=>h.id===s.id);return g!==-1?this.folders[g]=s:this.folders.push(s),this.currentFolder=s,s}else throw new Error(`Error fetching folder: ${o.status}`)}catch(o){throw console.error("Error fetching folder:",o),this.error="Error al obtener la carpeta",o}finally{this.isLoading=!1}},async createFolder(t){this.isLoading=!0,this.error=null;try{if(!t.name||t.name.trim()==="")throw new Error("El nombre de la carpeta es requerido");const o=t.color_id??0;if(o<0||o>=ye().length)throw new Error("Color de carpeta no v√°lido");const s={name:t.name.trim(),color_id:o,...t.document_ids&&{document_ids:t.document_ids}},g=await We("dynamic-documents/folders/create/",s);if(g.status===200||g.status===201){const h=g.data;return this.folders.push(h),this.lastUpdatedFolderId=h.id,await P("Carpeta creada exitosamente","success"),h}else throw new Error(`Error creating folder: ${g.status}`)}catch(o){throw console.error("Error creating folder:",o),this.error=o.message||"Error al crear la carpeta",await P(this.error,"error"),o}finally{this.isLoading=!1}},async updateFolder(t,o){this.isLoading=!0,this.error=null;try{if(o.name&&o.name.trim()==="")throw new Error("El nombre de la carpeta no puede estar vac√≠o");if(o.color_id!==void 0){const h=o.color_id;if(h<0||h>=ye().length)throw new Error("Color de carpeta no v√°lido")}const s={};o.name&&(s.name=o.name.trim()),o.color_id!==void 0&&(s.color_id=o.color_id),o.document_ids!==void 0&&(s.document_ids=o.document_ids);const g=await Je(`dynamic-documents/folders/${t}/update/`,s);if(g.status===200){const h=g.data,i=this.folders.findIndex(a=>a.id===t);return i!==-1&&(this.folders[i]=h),this.currentFolder&&this.currentFolder.id===t&&(this.currentFolder=h),this.lastUpdatedFolderId=t,await P("Carpeta actualizada exitosamente","success"),h}else throw new Error(`Error updating folder: ${g.status}`)}catch(s){throw console.error("Error updating folder:",s),this.error=s.message||"Error al actualizar la carpeta",await P(this.error,"error"),s}finally{this.isLoading=!1}},async deleteFolder(t){this.isLoading=!0,this.error=null;try{const o=await Ke(`dynamic-documents/folders/${t}/delete/`);if(o.status===204||o.status===200)return this.folders=this.folders.filter(s=>s.id!==t),this.currentFolder&&this.currentFolder.id===t&&(this.currentFolder=null),await P("Carpeta eliminada exitosamente","success"),!0;throw new Error(`Error deleting folder: ${o.status}`)}catch(o){throw console.error("Error deleting folder:",o),this.error=o.message||"Error al eliminar la carpeta",await P(this.error,"error"),o}finally{this.isLoading=!1}},async addDocumentsToFolder(t,o){const s=this.getFolderById(t);if(!s)throw new Error("Carpeta no encontrada");const g=s.document_ids||[],h=[...new Set([...g,...o])];return await this.updateFolder(t,{document_ids:h})},async removeDocumentsFromFolder(t,o){const s=this.getFolderById(t);if(!s)throw new Error("Carpeta no encontrada");const h=(s.document_ids||[]).filter(i=>!o.includes(i));return await this.updateFolder(t,{document_ids:h})},async moveDocumentsBetweenFolders(t,o,s){try{o&&await this.removeDocumentsFromFolder(o,t),s&&await this.addDocumentsToFolder(s,t),await P("Documentos movidos exitosamente","success")}catch(g){throw console.error("Error moving documents between folders:",g),await P("Error al mover documentos","error"),g}},setCurrentFolder(t){this.currentFolder=t},clearCurrentFolder(){this.currentFolder=null},reset(){this.folders=[],this.currentFolder=null,this.isLoading=!1,this.error=null,this.lastUpdatedFolderId=null},getFolderColor(t){const o=this.getFolderById(t);return o?de(o.color_id):de(0)},validateFolderData(t){const o=[];if((!t.name||t.name.trim()==="")&&o.push("El nombre de la carpeta es requerido"),t.name&&t.name.length>100&&o.push("El nombre de la carpeta no puede exceder 100 caracteres"),t.color_id!==void 0){const s=t.color_id;(s<0||s>=ye().length)&&o.push("Color de carpeta no v√°lido")}return t.document_ids&&!Array.isArray(t.document_ids)&&o.push("Los IDs de documentos deben ser un array"),{isValid:o.length===0,errors:o}}}}),Ht={key:0,class:"pb-6 border-b border-gray-200"},Gt={class:"hidden sm:flex gap-4 lg:gap-6"},Wt=e("div",{class:"grid min-w-0"},[e("span",{class:"font-medium text-base truncate"},"Minutas y Documentos"),e("span",{class:"text-gray-400 font-regular text-sm truncate"},"Mi unidad")],-1),Jt=e("div",{class:"grid min-w-0"},[e("span",{class:"font-medium text-base truncate"},"Firma Electr√≥nica"),e("span",{class:"text-gray-400 font-regular text-sm truncate"},"Documentos")],-1),Kt=e("div",{class:"grid"},[e("span",{class:"font-medium text-base"},"Nueva Minuta")],-1),Zt={class:"sm:hidden space-y-3"},Xt=e("div",{class:"grid"},[e("span",{class:"font-semibold text-lg"},"Minutas y Documentos"),e("span",{class:"text-gray-500 font-regular text-sm"},"Mi unidad")],-1),Yt={class:"grid grid-cols-2 gap-3"},es=e("span",{class:"font-medium text-sm leading-tight"},"Firma Electr√≥nica",-1),ts=e("span",{class:"font-medium text-sm leading-tight"},"Nueva Minuta",-1),ss={key:1,class:"pb-6 border-b border-gray-200"},os={class:"hidden sm:flex gap-4 lg:gap-6"},rs=e("div",{class:"grid"},[e("span",{class:"font-medium text-base truncate"},"Mis Documentos")],-1),ns=e("div",{class:"grid"},[e("span",{class:"font-medium text-base truncate"},"Firma Electr√≥nica")],-1),as=e("div",{class:"grid"},[e("span",{class:"font-medium text-base"},"Nuevo Documento")],-1),ls={class:"sm:hidden space-y-3"},is=e("div",{class:"grid"},[e("span",{class:"font-semibold text-lg"},"Mis Documentos")],-1),ds={class:"grid grid-cols-2 gap-3"},cs=e("span",{class:"font-medium text-sm leading-tight"},"Firma Electr√≥nica",-1),us=e("span",{class:"font-medium text-sm leading-tight"},"Nuevo Documento",-1),ms={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-auto"},gs={class:"flex justify-between items-center mb-4"},hs=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electr√≥nica",-1),fs={__name:"DocumentsNavigation",props:{role:String},emits:["updateCurrentSection","openNewDocument"],setup(t,{emit:o}){ee();const s=Ze();Z(async()=>{});const g=o,h=U("default"),i=U(!1),a=t,b=d=>{h.value=d,g("updateCurrentSection",d)},u=async d=>{try{s.userAuth&&(s.userAuth.has_signature=!0,s.saveToLocalStorageAuth()),P("Firma electr√≥nica guardada correctamente","success"),i.value=!1}catch(f){console.error("Error updating signature information:",f),P("Hubo un problema al guardar la firma","error")}};return(d,f)=>(r(),c(V,null,[(a==null?void 0:a.role)==="lawyer"?(r(),c("div",Ht,[e("div",Gt,[e("button",{onClick:f[0]||(f[0]=y=>b("default")),class:z(["flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-yellow-300 text-start bg-white transition-all duration-200 hover:shadow-md flex-1 min-w-0",{"bg-yellow-300/30 shadow-md":h.value=="default"}])},[w(p(ie),{class:"size-6 text-yellow-500 font-semibold flex-shrink-0"}),Wt],2),e("button",{onClick:f[1]||(f[1]=y=>i.value=!0),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-purple-300 bg-white text-start transition-all duration-200 hover:bg-purple-50 hover:shadow-md flex-1 min-w-0"},[w(p(ke),{class:"size-6 text-purple-500 font-semibold flex-shrink-0"}),Jt]),e("button",{onClick:f[2]||(f[2]=y=>d.$emit("openNewDocument")),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-gray-200 bg-white text-start transition-all duration-200 hover:bg-gray-50 hover:shadow-md hover:border-secondary"},[w(p(Y),{class:"size-6 text-secondary font-semibold flex-shrink-0"}),Kt])]),e("div",Zt,[e("button",{onClick:f[3]||(f[3]=y=>b("default")),class:z(["w-full flex gap-3 items-center py-4 px-4 rounded-xl border-2 border-yellow-300 text-start bg-white transition-all duration-200",{"bg-yellow-300/30 shadow-md":h.value=="default"}])},[w(p(ie),{class:"size-7 text-yellow-500 font-semibold flex-shrink-0"}),Xt],2),e("div",Yt,[e("button",{onClick:f[4]||(f[4]=y=>i.value=!0),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-purple-300 bg-white text-center transition-all duration-200 hover:bg-purple-50 min-h-[90px]"},[w(p(ke),{class:"size-8 text-purple-500 font-semibold mb-2"}),es]),e("button",{onClick:f[5]||(f[5]=y=>d.$emit("openNewDocument")),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-gray-200 bg-white text-center transition-all duration-200 hover:bg-gray-50 hover:border-secondary min-h-[90px]"},[w(p(Y),{class:"size-8 text-secondary font-semibold mb-2"}),ts])])])])):C("",!0),(a==null?void 0:a.role)==="client"?(r(),c("div",ss,[e("div",os,[e("button",{onClick:f[6]||(f[6]=y=>b("default")),class:z(["flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-yellow-300 bg-white text-start transition-all duration-200 hover:shadow-md flex-1 min-w-0",{"bg-yellow-300/30 shadow-md":h.value=="default"}])},[w(p(ie),{class:"size-6 text-yellow-500 font-semibold flex-shrink-0"}),rs],2),e("button",{onClick:f[7]||(f[7]=y=>i.value=!0),class:"flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-purple-300 bg-white text-start transition-all duration-200 hover:bg-purple-50 hover:shadow-md flex-1 min-w-0"},[w(p(ke),{class:"size-6 text-purple-500 font-semibold flex-shrink-0"}),ns]),e("button",{onClick:f[8]||(f[8]=y=>b("useDocument")),class:z(["flex gap-3 items-center py-3 px-4 rounded-xl border-2 border-gray-200 bg-white text-start transition-all duration-200 hover:bg-gray-50 hover:shadow-md hover:border-secondary",{"bg-selected-background border-secondary":h.value=="useDocument"}])},[w(p(Y),{class:"size-6 text-secondary font-semibold flex-shrink-0"}),as],2)]),e("div",ls,[e("button",{onClick:f[9]||(f[9]=y=>b("default")),class:z(["w-full flex gap-3 items-center py-4 px-4 rounded-xl border-2 border-yellow-300 text-start bg-white transition-all duration-200",{"bg-yellow-300/30 shadow-md":h.value=="default"}])},[w(p(ie),{class:"size-7 text-yellow-500 font-semibold flex-shrink-0"}),is],2),e("div",ds,[e("button",{onClick:f[10]||(f[10]=y=>i.value=!0),class:"flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-purple-300 bg-white text-center transition-all duration-200 hover:bg-purple-50 min-h-[90px]"},[w(p(ke),{class:"size-8 text-purple-500 font-semibold mb-2"}),cs]),e("button",{onClick:f[11]||(f[11]=y=>b("useDocument")),class:z(["flex flex-col items-center justify-center py-4 px-3 rounded-xl border-2 border-gray-200 bg-white text-center transition-all duration-200 hover:bg-gray-50 hover:border-secondary min-h-[90px]",{"bg-selected-background border-secondary":h.value=="useDocument"}])},[w(p(Y),{class:"size-8 text-secondary font-semibold mb-2"}),us],2)])])])):C("",!0),i.value?(r(),Q(ce,{key:2},{default:G(()=>[e("div",ms,[e("div",gs,[hs,e("button",{onClick:f[12]||(f[12]=y=>i.value=!1),class:"text-gray-400 hover:text-gray-500"},[w(p(se),{class:"h-6 w-6"})])]),w(Qe,{initialShowOptions:!0,"user-id":p(s).userAuth.id,onSignatureSaved:u,onCancel:f[13]||(f[13]=y=>i.value=!1)},null,8,["user-id"])])]),_:1})):C("",!0)],64))}},we=t=>(fe("data-v-e0a3ef0e"),t=t(),pe(),t),ps={class:"tag-filter-container"},vs={class:"relative"},ys={class:"flex items-center"},bs={key:0,class:"ml-2 inline-flex items-center justify-center h-5 w-5 bg-primary text-white text-xs rounded-full font-medium"},xs={key:0,class:"absolute left-0 mt-2 w-full sm:w-80 bg-white rounded-xl shadow-xl ring-1 ring-black ring-opacity-5 border border-gray-100 z-50 overflow-hidden"},_s={class:"bg-gray-50 p-4 border-b border-gray-200"},ws={class:"flex items-center justify-between mb-3"},$s=we(()=>e("h3",{class:"text-sm font-semibold text-gray-900"},"Filtrar por etiquetas",-1)),ks={key:0,class:"text-xs text-gray-500"},Ds={class:"relative"},Cs={key:0,class:"px-4 py-2 bg-blue-50 border-b border-blue-100"},Ss={class:"flex items-center justify-between"},Fs={class:"text-xs font-medium text-blue-700"},Is={class:"max-h-52 overflow-y-auto"},Es={key:0,class:"px-4 py-8 text-center"},Ts=we(()=>e("p",{class:"text-gray-500 text-sm"},"No hay etiquetas disponibles",-1)),Ls={key:1,class:"px-4 py-8 text-center"},As={class:"text-gray-500 text-sm"},Us={key:2,class:"px-4 py-8 text-center"},Bs=we(()=>e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"}),e("span",{class:"ml-3 text-sm text-gray-600"},"Cargando etiquetas...")],-1)),Ms=[Bs],js={key:3,class:"py-2"},Ns=["onClick"],zs={class:"flex items-center h-5"},Ps={class:"relative"},Qs=["id","checked","onChange"],Vs={key:0,class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},qs=we(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),Rs=[qs],Os={class:"ml-3 flex items-center flex-1 min-w-0"},Hs={class:"text-sm font-medium text-gray-900 truncate"},Gs={key:0,class:"mt-4"},Ws={class:"flex items-start gap-2"},Js=we(()=>e("span",{class:"text-xs font-medium text-gray-500 mt-1.5 flex-shrink-0"},"Activos:",-1)),Ks={class:"flex flex-wrap gap-2"},Zs=["onClick"],Xs={class:"mr-1"},Ys={class:"ml-1 p-0.5 rounded-full hover:bg-white/50 transition-colors duration-150"},eo={__name:"TagFilter",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(t,{emit:o}){const s=t,g=o,h=X(),i=U(!1),a=U([]),b=U(!1),u=U(""),d=A(()=>h.sortedTags),f=A(()=>{if(!u.value.trim())return d.value;const I=u.value.toLowerCase().trim();return d.value.filter(S=>S.name.toLowerCase().includes(I))}),y=I=>{const S=de(I.color_id);return{hex:S&&S.hex?S.hex:"#9CA3AF",dark:S&&S.dark?S.dark:"#374151"}},L=()=>{i.value=!i.value,i.value&&(u.value="")},D=I=>a.value.some(S=>S.id===I.id),v=I=>{const S=a.value.findIndex(l=>l.id===I.id);S>=0?a.value.splice(S,1):a.value.push(I),g("update:modelValue",a.value)},m=()=>{a.value=[],g("update:modelValue",[])},_=I=>{I.target.closest(".tag-filter-container")||(i.value=!1,u.value="")};return Z(async()=>{try{b.value=!0,await h.initTags()}catch(I){console.error("Error loading tags:",I)}finally{b.value=!1}document.addEventListener("click",_)}),W(()=>s.modelValue,I=>{a.value=I||[]},{immediate:!0}),he(()=>{document.removeEventListener("click",_)}),(I,S)=>(r(),c("div",ps,[e("div",vs,[e("button",{onClick:L,class:z(["group inline-flex items-center justify-between w-full sm:w-auto sm:min-w-[200px] px-4 py-3 border border-gray-200 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-primary transition-all duration-200",{"ring-2 ring-primary border-primary bg-blue-50":i.value,"border-primary bg-primary/5":a.value.length>0&&!i.value}])},[e("div",ys,[w(p(je),{class:z(["h-5 w-5 mr-2.5 text-gray-500 group-hover:text-gray-600",{"text-primary":a.value.length>0||i.value}])},null,8,["class"]),e("span",{class:z(["text-gray-700",{"text-primary font-semibold":a.value.length>0||i.value}])}," Filtrar por etiquetas ",2),a.value.length>0?(r(),c("span",bs,T(a.value.length),1)):C("",!0)]),w(p(at),{class:z(["ml-3 h-4 w-4 text-gray-400 transition-all duration-200 group-hover:text-gray-600",{"rotate-180 text-primary":i.value,"text-primary":a.value.length>0&&!i.value}])},null,8,["class"])],2),w(Xe,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:G(()=>[i.value?(r(),c("div",xs,[e("div",_s,[e("div",ws,[$s,d.value.length>0?(r(),c("span",ks,T(d.value.length)+" disponibles ",1)):C("",!0)]),e("div",Ds,[w(p(Me),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),re(e("input",{"onUpdate:modelValue":S[0]||(S[0]=l=>u.value=l),type:"text",placeholder:"Buscar etiquetas...",class:"w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"},null,512),[[Se,u.value]])])]),a.value.length>0?(r(),c("div",Cs,[e("div",Ss,[e("span",Fs,T(a.value.length)+" etiqueta"+T(a.value.length!==1?"s":"")+" seleccionada"+T(a.value.length!==1?"s":""),1),e("button",{onClick:m,class:"text-xs text-red-600 hover:text-red-700 font-medium px-2 py-1 rounded-md hover:bg-red-50 transition-all duration-200"}," Limpiar todo ")])])):C("",!0),e("div",Is,[!b.value&&f.value.length===0&&u.value.trim()===""?(r(),c("div",Es,[w(p(je),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),Ts])):C("",!0),!b.value&&f.value.length===0&&u.value.trim()!==""?(r(),c("div",Ls,[w(p(Me),{class:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e("p",As,'Sin resultados para "'+T(u.value)+'"',1),e("button",{onClick:S[1]||(S[1]=l=>u.value=""),class:"text-xs text-primary hover:text-primary-dark mt-2 font-medium"}," Ver todas las etiquetas ")])):C("",!0),b.value?(r(),c("div",Us,Ms)):C("",!0),!b.value&&f.value.length>0?(r(),c("div",js,[(r(!0),c(V,null,q(f.value,l=>(r(),c("div",{key:l.id,class:"group flex items-center px-4 py-2.5 hover:bg-gray-50 cursor-pointer transition-colors duration-150",onClick:x=>v(l)},[e("div",zs,[e("div",Ps,[e("input",{id:`tag-${l.id}`,type:"checkbox",checked:D(l),onChange:x=>v(l),class:"sr-only"},null,40,Qs),e("div",{class:z(["w-4 h-4 border-2 rounded transition-all duration-200 flex items-center justify-center",D(l)?"bg-primary border-primary":"border-gray-300 group-hover:border-gray-400"])},[D(l)?(r(),c("svg",Vs,Rs)):C("",!0)],2)])]),e("div",Os,[e("div",{class:"w-3 h-3 rounded-full mr-2.5 border flex-shrink-0 shadow-sm",style:ne({backgroundColor:y(l).hex})},null,4),e("span",Hs,T(l.name),1)])],8,Ns))),128))])):C("",!0)])])):C("",!0)]),_:1})]),a.value.length>0?(r(),c("div",Gs,[e("div",Ws,[Js,e("div",Ks,[(r(!0),c(V,null,q(a.value,l=>(r(),c("div",{key:l.id,class:"group inline-flex items-center pl-2.5 pr-1.5 py-1.5 rounded-lg text-xs font-medium border shadow-sm cursor-pointer transition-all duration-200 hover:shadow-md",style:ne({backgroundColor:y(l).hex+"20",borderColor:y(l).hex+"40",color:y(l).dark}),onClick:x=>v(l)},[e("div",{class:"w-2 h-2 rounded-full mr-2 flex-shrink-0",style:ne({backgroundColor:y(l).hex})},null,4),e("span",Xs,T(l.name),1),e("div",Ys,[w(p(se),{class:"h-3 w-3 opacity-60 group-hover:opacity-100"})])],12,Zs))),128))])])])):C("",!0)]))}},Ne=ve(eo,[["__scopeId","data-v-e0a3ef0e"]]),to={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},so={class:"bg-white rounded-xl shadow-xl max-w-md w-full"},oo={class:"flex justify-between items-center p-6 border-b"},ro={class:"text-lg font-semibold text-gray-900"},no={class:"mb-4"},ao=e("label",{for:"folderName",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la carpeta ",-1),lo={class:"mb-6"},io=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Color de la carpeta ",-1),co={class:"grid grid-cols-8 gap-2"},uo=["onClick","title"],mo={class:"flex gap-3"},go=["disabled"],ho={__name:"CreateEditFolderModal",props:{isVisible:{type:Boolean,required:!0},editingFolder:{type:Object,default:null}},emits:["close","success"],setup(t,{emit:o}){const s=t,g=o,h=Be(),i=U(!1),a=U({name:"",color_id:0}),b=A(()=>ye()),u=()=>{a.value={name:"",color_id:0}};W(()=>s.editingFolder,y=>{y?a.value={name:y.name,color_id:y.color_id}:u()},{immediate:!0}),W(()=>s.isVisible,y=>{y||u()});const d=()=>{g("close")},f=async()=>{if(a.value.name.trim()){i.value=!0;try{s.editingFolder?(await h.updateFolder(s.editingFolder.id,a.value),P("Carpeta actualizada correctamente","success")):(await h.createFolder(a.value),P("Carpeta creada correctamente","success")),g("success")}catch(y){const L=s.editingFolder?"actualizar":"crear";P(`Error al ${L} la carpeta`,"error"),console.error(`Error ${L} folder:`,y)}finally{i.value=!1}}};return(y,L)=>t.isVisible?(r(),Q(ce,{key:0},{default:G(()=>[e("div",to,[e("div",so,[e("div",oo,[e("h3",ro,T(t.editingFolder?"Editar Carpeta":"Nueva Carpeta"),1),e("button",{onClick:d,class:"text-gray-400 hover:text-gray-500"},[w(p(se),{class:"w-6 h-6"})])]),e("form",{onSubmit:le(f,["prevent"]),class:"p-6"},[e("div",no,[ao,re(e("input",{id:"folderName","onUpdate:modelValue":L[0]||(L[0]=D=>a.value.name=D),type:"text",required:"",maxlength:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ej: Contratos Laborales"},null,512),[[Se,a.value.name]])]),e("div",lo,[io,e("div",co,[(r(!0),c(V,null,q(b.value,D=>(r(),c("button",{key:D.id,type:"button",onClick:v=>a.value.color_id=D.id,class:z(["w-8 h-8 rounded-full border-2 transition-all",a.value.color_id===D.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"]),style:ne({backgroundColor:D.hex}),title:D.name},null,14,uo))),128))])]),e("div",mo,[e("button",{type:"button",onClick:d,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:!a.value.name.trim()||i.value,class:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},T(i.value?"Guardando...":t.editingFolder?"Actualizar":"Crear"),9,go)])],32)])])]),_:1})):C("",!0)}},fo={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},po={class:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden"},vo={class:"border-b"},yo={class:"hidden sm:flex justify-between items-center p-6"},bo={class:"flex items-center gap-3"},xo={class:"text-lg font-semibold text-gray-900"},_o={class:"text-sm text-gray-600"},wo={class:"flex items-center gap-2"},$o={class:"sm:hidden"},ko={class:"flex justify-between items-center p-4 pb-2"},Do={class:"flex items-center gap-3 flex-1 min-w-0"},Co={class:"min-w-0 flex-1"},So={class:"text-lg font-semibold text-gray-900 truncate"},Fo={class:"text-sm text-gray-600"},Io={class:"px-4 pb-4"},Eo={class:"p-4 sm:p-6 overflow-y-auto max-h-[70vh]"},To={class:"space-y-6"},Lo={key:0},Ao=e("h4",{class:"text-base font-semibold text-gray-900 mb-3"},"Mis Documentos",-1),Uo={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Bo={key:1},Mo=e("h4",{class:"text-base font-semibold text-gray-900 mb-3"},"Formatos Disponibles",-1),jo={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},No={key:2},zo=e("h4",{class:"text-base font-semibold text-gray-900 mb-3"},"Documentos para Firmar",-1),Po={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Qo={key:3,class:"text-center py-8 sm:py-12"},Vo={class:"text-gray-400 mb-4"},qo=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"Esta carpeta est√° vac√≠a",-1),Ro=e("p",{class:"text-gray-600 mb-4 text-sm sm:text-base"},"Agrega documentos para organizar tu trabajo",-1),Oo={__name:"FolderDetailsModal",props:{folder:{type:Object,default:null}},emits:["close","add-documents","remove-document","view-document","use-document","refresh"],setup(t,{emit:o}){const s=t,g=o,h=ee(),i=X(),a=A(()=>h.currentUser),b=A(()=>{var v;return(v=s.folder)!=null&&v.color_id?de(s.folder.color_id)||{hex:"#6B7280"}:{hex:"#6B7280"}}),u=A(()=>{if(!s.folder)return{myDocuments:[],useDocuments:[],signatureDocuments:[]};const v=s.folder.documents||[];return{myDocuments:v.filter(m=>{var _;return m.assigned_to===((_=a.value)==null?void 0:_.id)&&(m.state==="Progress"||m.state==="Completed")}),useDocuments:v.filter(m=>m.state==="Published"&&!m.assigned_to),signatureDocuments:v.filter(m=>m.state==="PendingSignatures"||m.state==="FullySigned")}});W(()=>s.folder,(v,m)=>{var _,I;if(v&&m&&v.id===m.id){const S=((_=m.documents)==null?void 0:_.length)||0,l=((I=v.documents)==null?void 0:I.length)||0;l!==S&&console.log(`üìÅ FolderDetailsModal: Folder "${v.name}" updated! Documents: ${S} ‚Üí ${l}`)}},{deep:!0});const d=()=>{g("close")},f=()=>{g("add-documents",s.folder)},y=v=>{g("view-document",v)},L=v=>{const m=s.folder.documents.find(_=>_.id===v);m&&g("use-document",m)},D=v=>{g("remove-document",v.id)};return(v,m)=>t.folder?(r(),Q(ce,{key:0},{default:G(()=>[e("div",fo,[e("div",po,[e("div",vo,[e("div",yo,[e("div",bo,[e("div",{class:"w-8 h-8 rounded-full flex-shrink-0",style:ne({backgroundColor:b.value.hex})},null,4),e("div",null,[e("h3",xo,T(t.folder.name),1),e("p",_o,T(t.folder.documents.length)+" documento"+T(t.folder.documents.length!==1?"s":""),1)])]),e("div",wo,[e("button",{onClick:f,class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"},[w(p(Y),{class:"w-4 h-4"}),K(" Agregar documentos ")]),e("button",{onClick:d,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[w(p(se),{class:"w-5 h-5"})])])]),e("div",$o,[e("div",ko,[e("div",Do,[e("div",{class:"w-7 h-7 rounded-full flex-shrink-0",style:ne({backgroundColor:b.value.hex})},null,4),e("div",Co,[e("h3",So,T(t.folder.name),1),e("p",Fo,T(t.folder.documents.length)+" documento"+T(t.folder.documents.length!==1?"s":""),1)])]),e("button",{onClick:d,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors flex-shrink-0 ml-2"},[w(p(se),{class:"w-5 h-5"})])]),e("div",Io,[e("button",{onClick:f,class:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors"},[w(p(Y),{class:"w-4 h-4"}),K(" Agregar documentos ")])])])]),e("div",Eo,[e("div",To,[u.value.myDocuments.length>0?(r(),c("div",Lo,[Ao,e("div",Uo,[(r(!0),c(V,null,q(u.value.myDocuments,_=>(r(),Q(p(ue),{key:_.id,document:_,"card-type":"client","card-context":"folder","highlighted-doc-id":null,"show-tags":!0,"show-client-name":!1,"additional-classes":"relative","document-store":p(i),"user-store":p(h),onClick:y,onRefresh:m[0]||(m[0]=I=>v.$emit("refresh")),onRemoveFromFolder:D},null,8,["document","document-store","user-store"]))),128))])])):C("",!0),u.value.useDocuments.length>0?(r(),c("div",Bo,[Mo,e("div",jo,[(r(!0),c(V,null,q(u.value.useDocuments,_=>(r(),Q(p(Ue),{key:_.id,document:_,"card-context":"folder","show-menu-options":!0,"document-store":p(i),"user-store":p(h),onClick:L,onRemoveFromFolder:D},null,8,["document","document-store","user-store"]))),128))])])):C("",!0),u.value.signatureDocuments.length>0?(r(),c("div",No,[zo,e("div",Po,[(r(!0),c(V,null,q(u.value.signatureDocuments,_=>(r(),Q(p(Ie),{key:_.id,document:_,"card-context":"folder","highlighted-doc-id":null,"document-store":p(i),"user-store":p(h),onRefresh:m[1]||(m[1]=I=>v.$emit("refresh")),onRemoveFromFolder:D},null,8,["document","document-store","user-store"]))),128))])])):C("",!0),t.folder.documents.length===0?(r(),c("div",Qo,[e("div",Vo,[w(p(Ae),{class:"w-10 h-10 sm:w-12 sm:h-12 mx-auto"})]),qo,Ro,e("button",{onClick:f,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm sm:text-base"},[w(p(Y),{class:"w-4 h-4"}),K(" Agregar documentos ")])])):C("",!0)])])])])]),_:1})):C("",!0)}},Ho={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Go={class:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden"},Wo={class:"border-b"},Jo={class:"hidden sm:flex justify-between items-center p-6"},Ko=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),Zo={class:"text-sm text-gray-600"},Xo={class:"sm:hidden p-4"},Yo={class:"flex justify-between items-start mb-2"},er={class:"flex-1 min-w-0 mr-3"},tr=e("h3",{class:"text-lg font-semibold text-gray-900"},"Agregar Documentos",-1),sr={class:"text-sm text-gray-600 truncate"},or={class:"border-b"},rr={class:"hidden sm:flex space-x-8 px-6","aria-label":"Tabs"},nr=["onClick"],ar={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},lr={class:"sm:hidden relative px-4 py-3"},ir={class:"flex items-center"},dr={class:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"},cr=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),ur=[cr],mr={class:"absolute top-full left-4 right-4 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},gr=["onClick"],hr={class:"p-4 sm:p-6 overflow-y-auto max-h-[calc(90vh-250px)]"},fr={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},pr={key:4,class:"absolute top-2 left-2 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center shadow-sm"},vr={key:0,class:"text-center py-8 sm:py-12"},yr=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"No hay documentos disponibles",-1),br=e("p",{class:"text-gray-600 text-sm sm:text-base"},"No tienes documentos de esta categor√≠a que no est√©n ya en la carpeta",-1),xr={class:"border-t bg-gray-50"},_r={class:"hidden sm:flex justify-between items-center p-6"},wr={class:"text-sm text-gray-600"},$r={class:"flex gap-3"},kr=["disabled"],Dr={class:"sm:hidden p-4 space-y-3"},Cr={class:"text-center text-sm text-gray-600"},Sr={class:"flex gap-3"},Fr=["disabled"],Ir={__name:"AddDocumentsModal",props:{isVisible:{type:Boolean,required:!0},folder:{type:Object,default:null}},emits:["close","add-documents"],setup(t,{emit:o}){const s=t,g=o,h=X(),i=ee(),a=U([]),b=U("my-documents"),u=U(!1),d=U(!1),f=[{name:"my-documents",label:"Mis Documentos"},{name:"use-documents",label:"Formatos Disponibles"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Documentos Firmados"}],y=A(()=>i.currentUser);W(()=>s.isVisible,S=>{S&&(a.value=[],b.value="my-documents")});const L=S=>{var n;if(!s.folder)return[];const l=s.folder.documents.map($=>$.id);let x=[];switch(S){case"my-documents":x=h.progressAndCompletedDocumentsByClient((n=y.value)==null?void 0:n.id);break;case"use-documents":x=h.publishedDocumentsUnassigned;break;case"pending-signatures":x=h.documents.filter($=>{var E,M;return $.state==="PendingSignatures"&&($.assigned_to===((E=y.value)==null?void 0:E.id)||((M=$.signatures)==null?void 0:M.some(te=>{var J;return te.signer_email===((J=y.value)==null?void 0:J.email)})))});break;case"signed-documents":x=h.documents.filter($=>{var E,M;return $.state==="FullySigned"&&($.assigned_to===((E=y.value)==null?void 0:E.id)||((M=$.signatures)==null?void 0:M.some(te=>{var J;return te.signer_email===((J=y.value)==null?void 0:J.email)})))});break;default:x=[]}return x.filter($=>!l.includes($.id))},D=S=>{const l=a.value.indexOf(S);l>-1?a.value.splice(l,1):a.value.push(S)},v=()=>{g("close")},m=async()=>{if(a.value.length!==0){u.value=!0;try{await g("add-documents",a.value)}finally{u.value=!1}}},_=S=>{b.value=S,d.value=!1},I=S=>{S.target.closest(".relative")||(d.value=!1)};return Z(()=>{document.addEventListener("click",I)}),he(()=>{document.removeEventListener("click",I)}),(S,l)=>t.isVisible&&t.folder?(r(),Q(ce,{key:0},{default:G(()=>{var x;return[e("div",Ho,[e("div",Go,[e("div",Wo,[e("div",Jo,[e("div",null,[Ko,e("p",Zo,'Selecciona documentos para agregar a "'+T(t.folder.name)+'"',1)]),e("button",{onClick:v,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors"},[w(p(se),{class:"w-5 h-5"})])]),e("div",Xo,[e("div",Yo,[e("div",er,[tr,e("p",sr,'Para "'+T(t.folder.name)+'"',1)]),e("button",{onClick:v,class:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 p-2 rounded-lg transition-colors flex-shrink-0"},[w(p(se),{class:"w-5 h-5"})])])])]),e("div",or,[e("nav",rr,[(r(),c(V,null,q(f,n=>e("button",{key:n.name,onClick:$=>b.value=n.name,class:z([b.value===n.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[K(T(n.label)+" ",1),e("span",ar,T(L(n.name).length),1)],10,nr)),64))]),e("div",lr,[e("button",{onClick:l[0]||(l[0]=n=>d.value=!d.value),class:"w-full flex items-center justify-between py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("div",ir,[e("span",null,T(((x=f.find(n=>n.name===b.value))==null?void 0:x.label)||"Seleccionar categor√≠a"),1),e("span",dr,T(L(b.value).length),1)]),(r(),c("svg",{class:z(["ml-2 h-5 w-5 transition-transform duration-200",d.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ur,2))]),re(e("div",mr,[(r(),c(V,null,q(f,n=>e("button",{key:n.name,onClick:$=>_(n.name),class:z(["w-full text-left px-4 py-3 text-sm transition-colors duration-150 flex items-center justify-between",b.value===n.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},[e("span",null,T(n.label),1),e("span",{class:z(["py-0.5 px-2 rounded-full text-xs",b.value===n.name?"bg-white/20 text-white":"bg-gray-100 text-gray-600"])},T(L(n.name).length),3)],10,gr)),64))],512),[[be,d.value]])])]),e("div",hr,[e("div",fr,[(r(!0),c(V,null,q(L(b.value),n=>(r(),c("div",{key:n.id,class:"relative"},[b.value==="my-documents"?(r(),Q(p(ue),{key:0,document:n,"highlighted-doc-id":null,"show-tags":!0,"show-client-name":!1,"menu-options":[],"disable-internal-actions":!0,"additional-classes":a.value.includes(n.id)?"ring-2 ring-primary bg-primary-50":"",onClick:$=>D(n.id)},null,8,["document","additional-classes","onClick"])):C("",!0),b.value==="use-documents"?(r(),Q(p(Ue),{key:1,document:n,"show-tags":!0,"menu-options":[],"show-menu-options":!1,"disable-internal-actions":!0,"additional-classes":a.value.includes(n.id)?"ring-2 ring-primary bg-primary-50":"",onClick:$=>D(n.id)},null,8,["document","additional-classes","onClick"])):C("",!0),b.value==="pending-signatures"?(r(),Q(p(Ie),{key:2,document:n,"highlighted-doc-id":null,"show-tags":!0,"menu-options":[],"disable-internal-actions":!0,"additional-classes":a.value.includes(n.id)?"ring-2 ring-primary bg-primary-50":"",onClick:$=>D(n.id)},null,8,["document","additional-classes","onClick"])):C("",!0),b.value==="signed-documents"?(r(),Q(p(Ie),{key:3,document:n,"highlighted-doc-id":null,"show-tags":!0,"menu-options":[],"disable-internal-actions":!0,"additional-classes":a.value.includes(n.id)?"ring-2 ring-primary bg-primary-50":"",onClick:$=>D(n.id)},null,8,["document","additional-classes","onClick"])):C("",!0),a.value.includes(n.id)?(r(),c("div",pr,[w(p(nt),{class:"w-4 h-4"})])):C("",!0)]))),128))]),L(b.value).length===0?(r(),c("div",vr,[w(p(Ae),{class:"w-12 h-12 sm:w-16 sm:h-16 text-gray-300 mx-auto mb-4"}),yr,br])):C("",!0)]),e("div",xr,[e("div",_r,[e("div",wr,T(a.value.length)+" documento(s) seleccionado(s) ",1),e("div",$r,[e("button",{onClick:v,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{onClick:m,disabled:a.value.length===0||u.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},T(u.value?"Agregando...":`Agregar ${a.value.length} documento(s)`),9,kr)])]),e("div",Dr,[e("div",Cr,T(a.value.length)+" documento(s) seleccionado(s) ",1),e("div",Sr,[e("button",{onClick:v,class:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center font-medium"}," Cancelar "),e("button",{onClick:m,disabled:a.value.length===0||u.value,class:"flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-center font-medium"},T(u.value?"Agregando...":"Agregar"),9,Fr)])])])])])]}),_:1})):C("",!0)}},$e=t=>(fe("data-v-71ba7453"),t=t(),pe(),t),Er={class:"folders-grid"},Tr={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},Lr={key:1,class:"text-center py-12"},Ar=$e(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No tienes carpetas a√∫n",-1)),Ur=$e(()=>e("p",{class:"text-gray-600 mb-6"},"Crea tu primera carpeta para organizar tus documentos",-1)),Br={key:2,class:"text-center py-12"},Mr=$e(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No se encontraron carpetas",-1)),jr=$e(()=>e("p",{class:"text-gray-600"},"No hay carpetas que coincidan con tu b√∫squeda",-1)),Nr={key:3,class:"flex justify-center items-center py-12"},zr=$e(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)),Pr=[zr],Qr={__name:"FoldersGrid",props:{sortedFolders:{type:Array,required:!0},searchQuery:{type:String,default:""},isLoading:{type:Boolean,default:!1}},emits:["folder-click","edit-folder","delete-folder","add-documents","create-folder"],setup(t,{emit:o}){const s=t,g=o,h=A(()=>{if(!s.searchQuery.trim())return s.sortedFolders;const f=s.searchQuery.toLowerCase();return s.sortedFolders.filter(y=>y.name.toLowerCase().includes(f))}),i=f=>{g("folder-click",f)},a=f=>{g("edit-folder",f)},b=f=>{g("delete-folder",f)},u=f=>{g("add-documents",f)},d=()=>{g("create-folder")};return(f,y)=>(r(),c("div",Er,[!t.isLoading&&h.value.length>0?(r(),c("div",Tr,[(r(!0),c(V,null,q(h.value,L=>(r(),Q(p(Ot),{key:L.id,folder:L,onClick:i,onEdit:a,onDelete:b,onAddDocuments:u},null,8,["folder"]))),128))])):!t.isLoading&&t.sortedFolders.length===0?(r(),c("div",Lr,[w(p(ie),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Ar,Ur,e("button",{onClick:d,class:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"},[w(p(Y),{class:"w-5 h-5"}),K(" Crear Primera Carpeta ")])])):!t.isLoading&&t.sortedFolders.length>0&&h.value.length===0?(r(),c("div",Br,[w(p(ie),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Mr,jr])):C("",!0),t.isLoading?(r(),c("div",Nr,Pr)):C("",!0)]))}},Vr=ve(Qr,[["__scopeId","data-v-71ba7453"]]),qe=t=>(fe("data-v-9f06d68d"),t=t(),pe(),t),qr={class:"folder-management"},Rr={class:"mb-6"},Or={class:"hidden sm:flex justify-between items-center"},Hr=qe(()=>e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Gr={class:"sm:hidden"},Wr=qe(()=>e("div",{class:"text-center mb-4"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Mis Carpetas"),e("p",{class:"text-sm text-gray-600 mt-1 px-2"},"Organiza tus documentos, firmas y formatos en carpetas personalizadas")],-1)),Jr={__name:"FolderManagement",props:{searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh","navigate-to-main"],setup(t,{emit:o}){const s=t,g=o,h=Be(),i=X(),a=ee(),b=U(!1),u=U(null),d=U(null),f=U(!1),y=U(null),L=A(()=>h.isLoading),D=A(()=>h.sortedFolders);A(()=>a.currentUser),Z(async()=>{await h.init(),await i.init()}),W(()=>s.searchQuery,()=>{}),W(()=>h.folders,k=>{var B,R;if(d.value&&k&&k.length>0){const F=k.find(j=>j.id===d.value.id);if(F){const j=((B=d.value.documents)==null?void 0:B.length)||0,ae=((R=F.documents)==null?void 0:R.length)||0;JSON.stringify(d.value)!==JSON.stringify(F)&&(d.value={...F},console.log(`üîÑ FolderManagement: Synced selectedFolder "${F.name}" with store. Documents: ${j} ‚Üí ${ae}`))}}},{deep:!0});const v=()=>{u.value=null,b.value=!0},m=k=>{u.value=k,b.value=!0},_=()=>{b.value=!1,u.value=null},I=()=>{_()},S=k=>{d.value=k},l=()=>{d.value=null},x=async k=>{if(confirm(`¬øEst√°s seguro de que quieres eliminar la carpeta "${k.name}"?`))try{await h.deleteFolder(k.id),P(`Carpeta "${k.name}" eliminada correctamente`,"success")}catch(B){P("Error al eliminar la carpeta","error"),console.error("Error deleting folder:",B)}},n=k=>{y.value=k,f.value=!0},$=async(k=!1)=>{if(f.value=!1,y.value=null,k&&d.value)try{await E()}catch(B){console.warn("Error refreshing folder after adding documents:",B)}},E=async()=>{if(d.value)try{await h.fetchFolderById(d.value.id,!0);const k=h.getFolderById(d.value.id);k&&(d.value={...k},console.log("‚úÖ Selected folder refreshed successfully"))}catch(k){throw console.error("‚ùå Error refreshing selected folder:",k),k}},M=async k=>{var B,R,F;if(!(!y.value||k.length===0))try{const j=y.value.documents.map(O=>O.id).filter(O=>O!=null&&!isNaN(parseInt(O))).map(O=>parseInt(O)),ae=k.filter(O=>O!=null&&!isNaN(parseInt(O))).map(O=>parseInt(O)),H=[...new Set([...j,...ae])];if(console.log("Current document IDs:",j),console.log("Selected document IDs:",ae),console.log("Updated document IDs:",H),H.some(O=>!Number.isInteger(O)||O<=0))throw new Error("IDs de documentos inv√°lidos detectados");await h.updateFolder(y.value.id,{document_ids:H}),await $(!0),P(`${ae.length} documento(s) agregado(s) a la carpeta`,"success"),g("navigate-to-main")}catch(j){console.error("Error adding documents to folder:",j),console.error("Error details:",((B=j.response)==null?void 0:B.data)||j.message),(R=j.response)!=null&&R.status?P(`Error al agregar documentos: ${((F=j.response.data)==null?void 0:F.detail)||j.message}`,"error"):P("Error al agregar documentos a la carpeta","error")}},te=async k=>{var B,R,F;if(d.value)try{const j=parseInt(k);if(!Number.isInteger(j)||j<=0)throw new Error("ID de documento inv√°lido");const ae=d.value.documents.map(H=>H.id).filter(H=>H!=null&&!isNaN(parseInt(H))).map(H=>parseInt(H)).filter(H=>H!==j);console.log("Removing document ID:",j),console.log("Updated document IDs after removal:",ae),await h.updateFolder(d.value.id,{document_ids:ae}),P("Documento removido de la carpeta","success"),d.value=null,g("navigate-to-main");try{await h.fetchFolderById(d.value.id,!0);const H=h.getFolderById(d.value.id);H&&(d.value=H),console.log("Folder data refreshed successfully after removal")}catch(H){console.warn("Error refreshing folder data:",H);try{d.value={...d.value,documents:d.value.documents.filter(O=>O.id!==j)},console.log("Applied optimistic removal for document ID:",j)}catch(O){console.warn("Optimistic update failed:",O)}}}catch(j){console.error("Error removing document from folder:",j),console.error("Error details:",((B=j.response)==null?void 0:B.data)||j.message),(R=j.response)!=null&&R.status?P(`Error al remover documento: ${((F=j.response.data)==null?void 0:F.detail)||j.message}`,"error"):P("Error al remover el documento de la carpeta","error")}},J=k=>{console.log("View document:",k)},me=k=>{console.log("Use document:",k)},N=(k,B)=>{console.log("Document action:",k,B)};return(k,B)=>(r(),c("div",qr,[e("div",Rr,[e("div",Or,[Hr,e("button",{onClick:v,class:"inline-flex items-center gap-2 px-4 py-2.5 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md"},[w(p(Y),{class:"w-5 h-5"}),K(" Nueva Carpeta ")])]),e("div",Gr,[Wr,e("button",{onClick:v,class:"w-full flex items-center justify-center gap-3 px-4 py-4 bg-primary text-white rounded-xl hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium text-base"},[w(p(Y),{class:"w-6 h-6"}),K(" Nueva Carpeta ")])])]),w(p(Vr),{"sorted-folders":D.value,"search-query":t.searchQuery,"is-loading":L.value,onFolderClick:S,onEditFolder:m,onDeleteFolder:x,onAddDocuments:n,onCreateFolder:v},null,8,["sorted-folders","search-query","is-loading"]),w(p(ho),{"is-visible":b.value,"editing-folder":u.value,onClose:_,onSuccess:I},null,8,["is-visible","editing-folder"]),w(p(Oo),{folder:d.value,onClose:l,onAddDocuments:n,onRemoveDocument:te,onViewDocument:J,onUseDocument:me,onDocumentAction:N},null,8,["folder"]),w(p(Ir),{"is-visible":f.value,folder:y.value,onClose:$,onAddDocuments:M},null,8,["is-visible","folder"])]))}},Kr=ve(Jr,[["__scopeId","data-v-9f06d68d"]]),Re=t=>(fe("data-v-62970273"),t=t(),pe(),t),Zr={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},Xr={key:1,class:"mt-6 flex flex-col items-center justify-center text-center text-gray-500 w-full p-8 rounded-xl"},Yr=Re(()=>e("p",{class:"text-lg font-semibold mb-2"}," No hay documentos disponibles para mostrar. ",-1)),en=Re(()=>e("p",{class:"text-sm"}," Contacta a tu abogado para gestionar tus documentos. ",-1)),tn=[Yr,en],sn={__name:"DocumentListClient",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null}},setup(t){const o=X(),s=ee(),{registerView:g}=rt(),h=A(()=>s.getCurrentUser),i=U([]),a=U(!1);s.userSignature;const b=A(()=>{if(u.promptDocuments)return null;const v=o.lastUpdatedDocumentId,m=localStorage.getItem("lastUpdatedDocumentId");return v&&d.value.some(I=>String(I.id)===String(v))?v:m&&d.value.some(S=>String(S.id)===String(m))?m:null}),u=t;Z(async()=>{if(await s.init(),await o.init(),u.promptDocuments)return;await o.init(),await f();const v=localStorage.getItem("lastUpdatedDocumentId");v&&!o.lastUpdatedDocumentId&&(o.lastUpdatedDocumentId=v),o.lastUpdatedDocumentId&&d.value.some(m=>String(m.id)===String(o.lastUpdatedDocumentId))}),W(()=>o.lastUpdatedDocumentId,v=>{u.promptDocuments||v&&localStorage.setItem("lastUpdatedDocumentId",v)});const d=A(()=>{var S,l;if(u.promptDocuments){const x=(S=h.value)==null?void 0:S.id;let n=u.promptDocuments.filter($=>{const E=$.assigned_to?String($.assigned_to):null,M=String(x);return E===M&&($.state==="Progress"||$.state==="Completed")});if(u.searchQuery){const $=u.searchQuery.toLowerCase();n=n.filter(E=>{var M,te,J,me,N,k,B,R;return E.title.toLowerCase().includes($)||E.state.toLowerCase().includes($)||E.assigned_to&&s&&(((te=(M=s.userById(E.assigned_to))==null?void 0:M.first_name)==null?void 0:te.toLowerCase().includes($))||((me=(J=s.userById(E.assigned_to))==null?void 0:J.last_name)==null?void 0:me.toLowerCase().includes($))||((k=(N=s.userById(E.assigned_to))==null?void 0:N.email)==null?void 0:k.toLowerCase().includes($))||((R=(B=s.userById(E.assigned_to))==null?void 0:B.identification)==null?void 0:R.toLowerCase().includes($)))})}if(u.selectedTags&&u.selectedTags.length>0){const $=u.selectedTags.map(E=>E.id);n=n.filter(E=>!E.tags||E.tags.length===0?!1:E.tags.some(M=>$.includes(M.id)))}return n}const v=o.progressAndCompletedDocumentsByClient((l=h.value)==null?void 0:l.id),m=u.selectedTags?u.selectedTags.map(x=>x.id):[];return o.filteredDocumentsBySearchAndTags(u.searchQuery,s,m).filter(x=>v.some(n=>String(n.id)===String(x.id)))}),f=async()=>{a.value=!0;try{const v=s.currentUser.id;if(!v)return;const m=await xe(`dynamic-documents/user/${v}/pending-documents-full/`);i.value=m.data}catch(v){console.error("Error fetching documents:",v),v.response&&console.error("Error details:",v.response.data),await P("Error al cargar documentos","error"),i.value=[]}finally{a.value=!1}},y=async v=>{await g("document",v.id),Ye(v)};W(d,v=>{if(!u.promptDocuments&&o.lastUpdatedDocumentId&&!v.some(_=>String(_.id)===String(o.lastUpdatedDocumentId))&&v.length>0){const I=[...v].sort((S,l)=>l.id-S.id)[0].id;o.lastUpdatedDocumentId=I,localStorage.setItem("lastUpdatedDocumentId",I)}});const L=v=>{v&&(o.lastUpdatedDocumentId=v,localStorage.setItem("lastUpdatedDocumentId",v),setTimeout(()=>{try{const m=document.querySelectorAll(`[data-document-id="${v}"]`);if(m.length>0){const _=m[0];_.style.border="3px solid #3b82f6",_.classList.remove("animate-pulse-highlight"),_.classList.remove("border-secondary"),_.classList.remove("shadow-md"),_.offsetWidth,_.classList.add("animate-pulse-highlight"),_.classList.add("border-secondary"),_.classList.add("shadow-md"),_.scrollIntoView({behavior:"smooth",block:"center"})}}catch(m){console.error("Error forcing highlight:",m)}},100))};window.forceDocumentHighlight=L;const D=async()=>{await o.init(!0)};return(v,m)=>(r(),c(V,null,[d.value.length>0?(r(),c("div",Zr,[(r(!0),c(V,null,q(d.value,_=>(r(),Q(p(ue),{key:_.id,document:_,"card-type":"client","card-context":"list","highlighted-doc-id":b.value,"status-icon":_.state==="Completed"?p(Te):p(Fe),"status-text":_.state==="Completed"?"Completado":"En Progreso","status-badge-classes":_.state==="Completed"?"bg-green-100 text-green-700 border border-green-200":"bg-blue-100 text-blue-700 border border-blue-200","document-store":p(o),"user-store":p(s),"prompt-documents":u.promptDocuments,"edit-modal-component":"UseDocumentByClient",onClick:y,onRefresh:D},null,8,["document","highlighted-doc-id","status-icon","status-text","status-badge-classes","document-store","user-store","prompt-documents"]))),128))])):C("",!0),d.value.length===0?(r(),c("div",Xr,tn)):C("",!0),w(Le,{isVisible:p(ge),documentData:p(Ee),onClose:m[0]||(m[0]=_=>ge.value=!1)},null,8,["isVisible","documentData"])],64))}},on=ve(sn,[["__scopeId","data-v-62970273"]]),rn={class:"mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},nn={__name:"UseDocument",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},setup(t){const o=X(),s=ee(),g=t,h=A(()=>{const a=o.publishedDocumentsUnassigned,b=g.selectedTags?g.selectedTags.map(d=>d.id):[];return o.filteredDocumentsBySearchAndTags(g.searchQuery,s,b).filter(d=>a.some(f=>f.id===d.id))});s.userSignature;function i(a){a&&a.updatedDocId&&(o.lastUpdatedDocumentId=a.updatedDocId,localStorage.setItem("lastUpdatedDocumentId",a.updatedDocId))}return(a,b)=>(r(),c("div",rn,[(r(!0),c(V,null,q(h.value,u=>(r(),Q(p(Ue),{key:u.id,document:u,"show-menu-options":!1,onDocumentCreated:i},null,8,["document"]))),128))]))}},oe=t=>(fe("data-v-c9dd9bd6"),t=t(),pe(),t),an={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},ln={key:0,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},dn=oe(()=>e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1)),cn=oe(()=>e("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)),un=[dn,cn],mn={key:1,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},gn=oe(()=>e("path",{d:"M20 6L9 17l-5-5"},null,-1)),hn=[gn],fn={key:2,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},pn=oe(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),vn=[pn],yn={key:3,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},bn=oe(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),xn=[bn],_n={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},wn={key:0,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},$n=oe(()=>e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1)),kn=oe(()=>e("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)),Dn=[$n,kn],Cn={key:1,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Sn=oe(()=>e("path",{d:"M20 6L9 17l-5-5"},null,-1)),Fn=[Sn],In={key:2,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},En=oe(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),Tn=[En],Ln={key:3,class:"h-3 w-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},An=oe(()=>e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},null,-1)),Un=[An],Bn={__name:"DocumentListLawyer",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]},promptDocuments:{type:Array,default:null}},setup(t){const o=X(),s=ee();Ce();const g=U([]),h=U([]),i=t,a=l=>l.state==="Published"||l.state==="FullySigned"?Te:Fe,b=l=>{switch(l.state){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return"Desconocido"}},u=l=>{switch(l.state){case"Published":case"FullySigned":return"bg-green-100 text-green-700 border border-green-200";case"Draft":case"Progress":return"bg-blue-100 text-blue-700 border border-blue-200";case"PendingSignatures":return"bg-yellow-100 text-yellow-700 border border-yellow-200";case"Completed":return"bg-purple-100 text-purple-700 border border-purple-200";default:return"bg-gray-100 text-gray-700 border border-gray-200"}},d=l=>{var x,n;return l.fully_signed?"bg-green-100 text-green-700 border border-green-200":(x=m(l))!=null&&x.signed&&!l.fully_signed?"bg-blue-100 text-blue-700 border border-blue-200":m(l)&&!((n=m(l))!=null&&n.signed)?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200"},f=A(()=>{if(i.promptDocuments)return[];const x=(o.getDocumentsByLawyerId(s.currentUser.id)||[]).filter(E=>E.state!=="FullySigned"),n=i.selectedTags?i.selectedTags.map(E=>E.id):[];return o.filteredDocumentsBySearchAndTags(i.searchQuery,s,n).filter(E=>x.some(M=>M.id===E.id))}),y=A(()=>{if(i.promptDocuments&&i.promptDocuments.length>0){let l=i.promptDocuments.filter(x=>x.title&&x.title.toLowerCase().includes((i.searchQuery||"").toLowerCase()));if(i.selectedTags&&i.selectedTags.length>0){const x=i.selectedTags.map(n=>n.id);l=l.filter(n=>!n.tags||n.tags.length===0?!1:n.tags.some($=>x.includes($.id)))}return l}return[]}),L=A(()=>i.promptDocuments?y.value:f.value),D=A(()=>{if(i.promptDocuments)return null;const l=o.lastUpdatedDocumentId,x=localStorage.getItem("lastUpdatedDocumentId"),n=[...f.value];return l&&n.some(M=>String(M.id)===String(l))?l:x&&n.some(M=>String(M.id)===String(x))?x:null}),v=async()=>{try{const l=s.currentUser.id,x=await xe(`dynamic-documents/user/${l}/pending-documents-full/`),n=await xe(`dynamic-documents/user/${l}/signed-documents/`);x.status===200&&(g.value=x.data),n.status===200&&(h.value=n.data)}catch(l){console.error("Error fetching lawyer documents:",l),l.response&&(console.error("Error response data:",l.response.data),console.error("Error status:",l.response.status))}},m=l=>{if(!l.signatures||!l.requires_signature)return null;const x=String(s.currentUser.id);return l.signatures.find(n=>String(n.signer_id)===x)},_=l=>{if(!l.requires_signature)return"";if(l.fully_signed)return"Documento formalizado";const x=m(l);if(l.signatures&&l.signatures.length>0){const n=l.signatures.length,$=l.signatures.filter(E=>E.signed).length;if(x&&x.signed){if($===1&&n>1)return`Has firmado. Faltan ${n-$} firmas m√°s`;if($<n)return`Has firmado. Faltan ${n-$} firmas m√°s`}return`Firmas: ${$}/${n}`}return x?"Requiere tu firma":"Requiere firmas"};W(L,l=>{if(!i.promptDocuments&&o.lastUpdatedDocumentId&&!l.some(n=>String(n.id)===String(o.lastUpdatedDocumentId))&&l.length>0){const $=[...l].sort((E,M)=>M.id-E.id)[0].id;o.lastUpdatedDocumentId=$,localStorage.setItem("lastUpdatedDocumentId",$)}});const I=l=>{l&&setTimeout(()=>{try{const x=document.querySelectorAll(`[data-document-id="${l}"]`);if(x.length>0){const n=x[0];n.classList.remove("animate-pulse-highlight-green","animate-pulse-highlight-blue"),n.offsetWidth,(n.querySelector("[data-document-id]")||n).classList.contains("border-green-400")?n.classList.add("animate-pulse-highlight-green"):n.classList.add("animate-pulse-highlight-blue"),n.scrollIntoView({behavior:"smooth",block:"center"})}}catch(x){console.error("Error forcing highlight:",x)}},100)};window.forceDocumentHighlight=I,Z(async()=>{if(i.promptDocuments)return;await o.init();const l=localStorage.getItem("lastUpdatedDocumentId");l&&(o.lastUpdatedDocumentId=l,setTimeout(()=>{L.value.some(n=>String(n.id)===String(l))&&I(l)},500)),v()});const S=async()=>{await o.init()};return(l,x)=>(r(),c(V,null,[i.promptDocuments&&y.value.length>0?(r(),c("div",an,[(r(!0),c(V,null,q(y.value,n=>(r(),Q(p(ue),{key:n.id,document:n,"card-type":"lawyer","card-context":"prompt","highlighted-doc-id":D.value,"status-icon":a(n),"status-text":b(n),"status-badge-classes":u(n),"document-store":p(o),"user-store":p(s),"prompt-documents":!0,onRefresh:S},{"additional-badges":G(()=>{var $;return[n.requires_signature?(r(),c("div",{key:0,class:z(["inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",d(n)])},[n.fully_signed?(r(),c("svg",ln,un)):($=m(n))!=null&&$.signed?(r(),c("svg",mn,hn)):m(n)?(r(),c("svg",fn,vn)):(r(),c("svg",yn,xn)),e("span",null,T(n.fully_signed?"Formalizado":_(n)),1)],2)):C("",!0)]}),_:2},1032,["document","highlighted-doc-id","status-icon","status-text","status-badge-classes","document-store","user-store"]))),128))])):i.promptDocuments?C("",!0):(r(),c("div",_n,[(r(!0),c(V,null,q(L.value,n=>(r(),Q(p(ue),{key:n.id,document:n,"card-type":"lawyer","card-context":"list","highlighted-doc-id":D.value,"status-icon":a(n),"status-text":b(n),"status-badge-classes":u(n),"document-store":p(o),"user-store":p(s),onRefresh:S},{"additional-badges":G(()=>{var $;return[n.requires_signature?(r(),c("div",{key:0,class:z(["inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",d(n)])},[n.fully_signed?(r(),c("svg",wn,Dn)):($=m(n))!=null&&$.signed?(r(),c("svg",Cn,Fn)):m(n)?(r(),c("svg",In,Tn)):(r(),c("svg",Ln,Un)),e("span",null,T(n.fully_signed?"Formalizado":_(n)),1)],2)):C("",!0)]}),_:2},1032,["document","highlighted-doc-id","status-icon","status-text","status-badge-classes","document-store","user-store"]))),128))])),w(Le,{isVisible:p(ge),documentData:p(Ee),onClose:x[0]||(x[0]=n=>ge.value=!1)},null,8,["isVisible","documentData"])],64))}},Mn=ve(Bn,[["__scopeId","data-v-c9dd9bd6"]]),jn={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},Nn={__name:"DocumentFinishedByClientList",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(t,{emit:o}){const s=X(),g=ee();Z(()=>{s.init(),g.init()});const h=t,i=A(()=>{const a=s.completedDocumentsByClient,b=h.selectedTags?h.selectedTags.map(d=>d.id):[];return s.filteredDocumentsBySearchAndTags(h.searchQuery,g,b).filter(d=>a.some(f=>f.id===d.id))});return g.userSignature,(a,b)=>(r(),c("div",jn,[(r(!0),c(V,null,q(i.value,u=>(r(),Q(p(ue),{key:u.id,document:u,"card-type":"lawyer","card-context":"finished","highlighted-doc-id":null,"status-icon":p(Te),"status-text":"Completado","status-badge-classes":"bg-green-100 text-green-700 border border-green-200","document-store":p(s),"user-store":p(g),"edit-route":`/dynamic_document_dashboard/document/use/editor/${u.id}/${encodeURIComponent(u.title.trim())}`,onRefresh:b[0]||(b[0]=d=>a.$emit("refresh"))},null,8,["document","status-icon","document-store","user-store","edit-route"]))),128))]))}},zn={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4"},Pn={__name:"DocumentInProgressByClientList",props:{searchQuery:String,selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(t,{emit:o}){const s=X(),g=ee();Z(()=>{s.init(),g.init()});const h=t,i=A(()=>{const a=s.progressDocumentsByClient,b=h.selectedTags?h.selectedTags.map(d=>d.id):[];return s.filteredDocumentsBySearchAndTags(h.searchQuery,g,b).filter(d=>a.some(f=>f.id===d.id))});return g.userSignature,(a,b)=>(r(),c("div",zn,[(r(!0),c(V,null,q(i.value,u=>(r(),Q(p(ue),{key:u.id,document:u,"card-type":"lawyer","card-context":"progress","highlighted-doc-id":null,"status-icon":p(Fe),"status-text":"En Progreso","status-badge-classes":"bg-blue-100 text-blue-700 border border-blue-200","document-store":p(s),"user-store":p(g),"edit-route":`/dynamic_document_dashboard/document/use/editor/${u.id}/${encodeURIComponent(u.title.trim())}`,onRefresh:b[0]||(b[0]=d=>a.$emit("refresh"))},null,8,["document","status-icon","document-store","user-store","edit-route"]))),128))]))}},Qn={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Vn={class:"flex justify-end"},qn=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[K(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),Rn={class:"mt-2"},On={class:"flex gap-2 mt-2.5"},Hn=["disabled"],Gn=e("span",null,"Actualizar nombre",-1),Wn=[Gn],Jn=["disabled"],Kn={__name:"CreateDocumentByLawyer",emits:["close"],setup(t,{emit:o}){const s=Ce(),g=X(),h=o,i=U(""),a=U("");ze(()=>{var D;(D=g.selectedDocument)!=null&&D.title?(i.value=g.selectedDocument.title,a.value=g.selectedDocument.title):(i.value="",a.value="")});const b=D=>{D.key==="Escape"&&h("close")};Z(()=>{document.addEventListener("keydown",b)}),he(()=>{document.removeEventListener("keydown",b)});const u=A(()=>i.value.trim().length>0),d=A(()=>{var D;return!!((D=g.selectedDocument)!=null&&D.id)}),f=A(()=>d.value&&i.value.trim()!==a.value.trim()&&i.value.trim().length>0);async function y(){if(d.value&&f.value)try{const D={title:i.value.trim()};await g.updateDocument(g.selectedDocument.id,D),a.value=i.value.trim(),g.selectedDocument.title=i.value.trim(),g.lastUpdatedDocumentId=g.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",g.selectedDocument.id);const v=g.selectedDocument.id;h("close",{updatedDocId:v});const m=window.location.pathname;m==="/dynamic_document_dashboard"||m==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(v)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},1e3)}catch(D){console.error("Error updating document name:",D)}}const L=async()=>{if(!u.value)return;const D=encodeURIComponent(i.value.trim());d.value?(g.selectedDocument.title=i.value,g.selectedDocument.id&&(g.lastUpdatedDocumentId=g.selectedDocument.id,localStorage.setItem("lastUpdatedDocumentId",g.selectedDocument.id.toString())),s.push(`/dynamic_document_dashboard/lawyer/editor/edit/${g.selectedDocument.id}`)):(g.selectedDocument={title:i.value.trim()},s.push(`/dynamic_document_dashboard/lawyer/editor/create/${D}`))};return(D,v)=>(r(),c("div",Qn,[e("div",Vn,[e("button",{onClick:v[0]||(v[0]=m=>h("close"))},[w(p(se),{class:"size-6"})])]),e("form",{onSubmit:le(L,["prevent"])},[e("div",null,[qn,e("div",Rn,[re(e("input",{"onUpdate:modelValue":v[1]||(v[1]=m=>i.value=m),type:"text",name:"document-name",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[Se,i.value]])])]),e("div",On,[d.value?(r(),c("button",{key:0,type:"button",onClick:y,disabled:!f.value,class:z(["p-2.5 text-sm font-medium rounded-md flex gap-2",f.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Wn,10,Hn)):C("",!0),e("button",{type:"submit",class:z(["p-2.5 text-sm font-medium rounded-md flex gap-2",u.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!u.value},[e("span",null,T(d.value?"Editar Documento":"Continuar"),1)],10,Jn)])],32)]))}},Zn={class:"p-4 sm:p-6 lg:p-10 lg:px-8"},Xn={key:0,class:"mt-6"},Yn={class:"mb-6 border-b border-gray-200"},ea={class:"-mb-px hidden md:flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},ta=["onClick"],sa={class:"md:hidden relative"},oa=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),ra=[oa],na={class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},aa=["onClick"],la={class:"mb-6"},ia={key:0},da={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-3 sm:gap-4"},ca={key:2,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-3 sm:gap-4"},ua={key:3},ma={key:4},ga={key:5,class:"mt-6 text-center text-gray-400 font-regular"},ha=e("p",null,"No hay documentos disponibles para mostrar.",-1),fa=[ha],pa={key:1,class:"mt-6"},va={key:0,class:"mb-6 border-b border-gray-200"},ya={class:"-mb-px hidden md:flex flex-wrap gap-x-4 gap-y-2 md:gap-x-8","aria-label":"Tabs"},ba=["onClick"],xa={class:"md:hidden relative"},_a=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1),wa=[_a],$a={class:"absolute top-full left-0 right-0 z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden"},ka=["onClick"],Da={key:1,class:"mb-6"},Ca={class:"p-4 sm:p-6"},Sa={class:"bg-white rounded-xl shadow-xl max-w-3xl w-full mx-auto"},Fa={class:"flex justify-between items-center p-4 border-b"},Ia=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electr√≥nica",-1),Ea={class:"p-4 sm:p-6"},Ha={__name:"Dashboard",setup(t){const o=ee(),s=X(),g=Be(),h=Ce(),i=U(""),a=U("default"),b=U(!1),u=U("folders"),d=U("legal-documents"),f=U(!1),y=U([]),L=A(()=>o.currentUser),D=A(()=>L.value?L.value.role:(console.log("Current user is null, redirecting to login..."),h.push("/login"),null)),v=A(()=>{let N=[];D.value==="lawyer"?N=s.draftAndPublishedDocumentsUnassigned:D.value==="client"&&(N=s.progressAndCompletedDocumentsByClient(L.value.id));const k=y.value.map(B=>B.id);return s.filteredDocumentsBySearchAndTags(i.value,o,k).filter(B=>N.some(R=>R.id===B.id))}),m=N=>{a.value=N,s.selectedDocument=null},_=()=>{b.value=!1,a.value="default",s.selectedDocument=null},I=async()=>{await s.init(!0)},S=async()=>{u.value="folders";try{await new Promise(N=>setTimeout(N,100)),await g.fetchFolders(!0),console.log("üìÇ Dashboard: Refreshed folders after navigate-to-main")}catch(N){console.warn("Error refreshing folders on navigate-to-main:",N)}};W(()=>s.lastUpdatedDocumentId,(N,k)=>{if(N&&N!==k&&a.value==="default"){const B=Date.now();(!W.lastExecutionTime||B-W.lastExecutionTime>100)&&(W.lastExecutionTime=B,a.value="default")}},{immediate:!1});const l=[{name:"folders",label:"Carpetas"},{name:"my-documents",label:"Mis Documentos"},{name:"pending-signatures",label:"Firmas Pendientes"},{name:"signed-documents",label:"Dcs. Firmados"}],x=[{name:"legal-documents",label:"Minutas"},{name:"pending-signatures",label:"Dcs. Por Firmar"},{name:"signed-documents",label:"Dcs. Firmados"},{name:"finished-documents",label:"Dcs. Clientes"},{name:"in-progress-documents",label:"Dcs. Clientes en Progreso"}],n=U(!1),$=U(!1),E=()=>{n.value=!1,$.value=!1},M=N=>{const k=document.querySelectorAll(".relative");let B=!1;k.forEach(R=>{R.contains(N.target)&&(B=!0)}),B||E()},te=N=>{d.value=N,n.value=!1},J=N=>{u.value=N,$.value=!1};Z(async()=>{await o.init(),await s.init(),await g.init(),s.selectedDocument=null,a.value="default";const N=localStorage.getItem("lastUpdatedDocumentId");N&&s.documents.some(B=>B.id.toString()===N)&&(s.lastUpdatedDocumentId=parseInt(N)),document.addEventListener("click",M)}),he(()=>{document.removeEventListener("click",M)});const me=async N=>{await o.getUserInfo(),o.currentUser&&(o.currentUser.has_signature=!0),showNotification("Firma electr√≥nica guardada correctamente","success"),setTimeout(()=>{f.value=!1},500)};return(N,k)=>{var B,R;return r(),c(V,null,[w(et,{"onUpdate:searchQuery":k[0]||(k[0]=F=>i.value=F)},{default:G(()=>[Pe(N.$slots,"default")]),_:3}),e("div",Zn,[w(fs,{onOpenNewDocument:k[1]||(k[1]=F=>b.value=!0),onUpdateCurrentSection:m,role:D.value},null,8,["role"]),D.value==="lawyer"?(r(),c("div",Xn,[e("div",Yn,[e("nav",ea,[(r(),c(V,null,q(x,F=>e("button",{key:F.name,onClick:j=>d.value=F.name,class:z([d.value===F.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},T(F.label),11,ta)),64))]),e("div",sa,[e("button",{onClick:k[2]||(k[2]=F=>n.value=!n.value),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,T(((B=x.find(F=>F.name===d.value))==null?void 0:B.label)||"Seleccionar secci√≥n"),1),(r(),c("svg",{class:z(["ml-2 h-5 w-5 transition-transform duration-200",n.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ra,2))]),re(e("div",na,[(r(),c(V,null,q(x,F=>e("button",{key:F.name,onClick:j=>te(F.name),class:z(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",d.value===F.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},T(F.label),11,aa)),64))],512),[[be,n.value]])])]),e("div",la,[w(Ne,{modelValue:y.value,"onUpdate:modelValue":k[3]||(k[3]=F=>y.value=F)},null,8,["modelValue"])]),d.value==="legal-documents"?(r(),c("div",ia,[w(Mn,{searchQuery:i.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])])):C("",!0),d.value==="pending-signatures"?(r(),c("div",da,[w(De,{state:"PendingSignatures",searchQuery:i.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])])):C("",!0),d.value==="signed-documents"?(r(),c("div",ca,[w(De,{state:"FullySigned",searchQuery:i.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])])):C("",!0),d.value==="finished-documents"?(r(),c("div",ua,[w(Nn,{searchQuery:i.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])])):C("",!0),d.value==="in-progress-documents"?(r(),c("div",ma,[w(Pn,{searchQuery:i.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])])):C("",!0),v.value.length===0?(r(),c("div",ga,fa)):C("",!0)])):C("",!0),D.value==="client"?(r(),c("div",pa,[a.value!=="useDocument"?(r(),c("div",va,[e("nav",ya,[(r(),c(V,null,q(l,F=>e("button",{key:F.name,onClick:j=>u.value=F.name,class:z([u.value===F.name?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},T(F.label),11,ba)),64))]),e("div",xa,[e("button",{onClick:k[4]||(k[4]=F=>$.value=!$.value),class:"w-full flex items-center justify-between py-4 px-3 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"},[e("span",null,T(((R=l.find(F=>F.name===u.value))==null?void 0:R.label)||"Seleccionar secci√≥n"),1),(r(),c("svg",{class:z(["ml-2 h-5 w-5 transition-transform duration-200",$.value?"transform rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},wa,2))]),re(e("div",$a,[(r(),c(V,null,q(l,F=>e("button",{key:F.name,onClick:j=>J(F.name),class:z(["w-full text-left px-4 py-3 text-sm transition-colors duration-150",u.value===F.name?"bg-primary text-white":"text-gray-700 hover:bg-gray-50"])},T(F.label),11,ka)),64))],512),[[be,$.value]])])])):C("",!0),u.value!=="folders"?(r(),c("div",Da,[w(Ne,{modelValue:y.value,"onUpdate:modelValue":k[5]||(k[5]=F=>y.value=F)},null,8,["modelValue"])])):C("",!0),a.value==="useDocument"?(r(),Q(nn,{key:2,searchQuery:i.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])):(r(),c("div",{key:3,class:z(["grid gap-3 sm:gap-4",{"grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3":u.value!="my-documents"&&u.value!="folders"}])},[u.value==="pending-signatures"?(r(),Q(De,{key:0,state:"PendingSignatures",searchQuery:i.value,selectedTags:y.value,onRefresh:I},null,8,["searchQuery","selectedTags"])):C("",!0),u.value==="my-documents"?(r(),Q(on,{key:1,searchQuery:i.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])):C("",!0),u.value==="folders"?(r(),Q(Kr,{key:2,searchQuery:i.value,selectedTags:y.value,onRefresh:I,onNavigateToMain:S},null,8,["searchQuery","selectedTags"])):C("",!0),u.value==="signed-documents"?(r(),Q(De,{key:3,state:"FullySigned",searchQuery:i.value,selectedTags:y.value},null,8,["searchQuery","selectedTags"])):C("",!0)],2))])):C("",!0)]),re(w(ce,null,{default:G(()=>[w(Kn,{onClose:_})]),_:1},512),[[be,b.value]]),f.value?(r(),Q(ce,{key:0},{default:G(()=>[e("div",Ca,[e("div",Sa,[e("div",Fa,[Ia,e("button",{onClick:k[6]||(k[6]=F=>f.value=!1),class:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100"},[w(p(se),{class:"h-6 w-6"})])]),e("div",Ea,[w(Qe,{"user-id":L.value.id,"initial-show-options":!L.value.has_signature,onSignatureSaved:me,onCancel:k[7]||(k[7]=F=>f.value=!1)},null,8,["user-id","initial-show-options"])])])])]),_:1})):C("",!0),w(Le,{isVisible:p(ge),documentData:p(Ee),onClose:k[8]||(k[8]=F=>ge.value=!1)},null,8,["isVisible","documentData"])],64)}}};export{Ha as default};
