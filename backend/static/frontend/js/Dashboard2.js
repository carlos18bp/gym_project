import{e as a,f as r,g as e,C as De,aV as Je,E as te,D as W,$ as Le,a0 as $e,r as S,c as I,T as K,W as be,m as B,k as U,j as u,l as d,aW as ue,aX as ee,aY as ge,aZ as me,p as _,G as ie,t as l,h as le,w as G,v as X,i as k,a_ as _e,a$ as fe,s as j,N as ye,O as xe,b0 as Qe,n as F,F as Z,M as J,a6 as je,b1 as Ke,S as se,b2 as ut,x as he,a4 as et,z as Ie,o as ve,P as qe,u as Oe,b3 as Ee,b4 as ze,aa as gt}from"./index.js";import{_ as we}from"./_plugin-vue_export-helper.js";import{a as Ce,r as mt,b as ft,c as tt}from"./LinkIcon.js";import{r as ke}from"./PhotoIcon.js";import{r as oe}from"./InformationCircleIcon.js";import{r as Re}from"./EyeIcon.js";import{r as st,a as ot}from"./TagIcon.js";import{r as at}from"./PencilIcon.js";import{r as ht}from"./TrashIcon.js";import{r as Ne}from"./DocumentIcon.js";import{r as vt}from"./ExclamationTriangleIcon.js";import{r as re}from"./PlusIcon.js";import{r as pt}from"./ArrowDownTrayIcon.js";function _t(t,s){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75"})])}function Ye(t,s){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"})])}function Pe(t,s){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})])}function Ae(t,s){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"})])}function pe(t,s){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"})])}function ae(t,s){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"})])}function Ue(t,s){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"})])}function Me(t,s){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"})])}function bt(t,s){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"})])}function it(t,s){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}function yt(t,s){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"})])}function nt(t,s){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"})])}function xt(t,s){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})])}const ce=De("organizations",{state:()=>({organizations:[],currentOrganization:null,myMemberships:[],invitations:[],myInvitations:[],organizationMembers:[],isLoading:!1,isLoadingInvitations:!1,isLoadingMembers:!1,pagination:{count:0,next:null,previous:null,currentPage:1,pageSize:10},organizationStats:{total_organizations:0,total_members:0,total_pending_invitations:0,recent_requests_count:0,active_organizations_count:0,organizations_by_status:{},recent_invitations_count:0},dataLoaded:!1,lastFetchTime:null}),getters:{organizationById:t=>s=>t.organizations.find(o=>o.id===s),activeOrganizations:t=>t.organizations.filter(s=>s.is_active),pendingInvitations:t=>t.myInvitations.filter(s=>s.status==="PENDING"),canRespondToInvitation:t=>s=>{const o=t.myInvitations.find(n=>n.id===s);return o&&o.can_be_responded&&!o.is_expired}},actions:{async createOrganization(t){try{if(this.isLoading=!0,t.profile_image||t.cover_image){const s=new FormData;Object.keys(t).forEach(n=>{n!=="profile_image"&&n!=="cover_image"&&t[n]!==null&&s.append(n,t[n])}),t.profile_image&&s.append("profile_image",t.profile_image),t.cover_image&&s.append("cover_image",t.cover_image);const o=await Je("organizations/create/",s);if(o.status===201){const n=o.data.organization;return this.organizations.unshift(n),this.currentOrganization=n,o.data}}else{const s=await te("organizations/create/",t);if(s.status===201){const o=s.data.organization;return this.organizations.unshift(o),this.currentOrganization=o,s.data}}throw new Error("Error creating organization")}catch(s){throw console.error("Error creating organization:",s),s}finally{this.isLoading=!1}},async getMyOrganizations(t={}){try{this.isLoading=!0;const s=new URLSearchParams;Object.keys(t).forEach(c=>{t[c]!==null&&t[c]!==void 0&&t[c]!==""&&s.append(c,t[c])});const o=`organizations/my-organizations/${s.toString()?"?"+s.toString():""}`;console.log("Making request to URL:",o);const n=await W(o);if(n.status===200)return this.organizations=n.data.results,this.pagination={count:n.data.count,next:n.data.next,previous:n.data.previous,currentPage:t.page||1,pageSize:t.page_size||10},this.dataLoaded=!0,this.lastFetchTime=new Date().toISOString(),n.data;throw new Error("Error fetching organizations")}catch(s){throw console.error("Error fetching organizations:",s),s}finally{this.isLoading=!1}},async getOrganizationDetail(t){try{this.isLoading=!0;const s=await W(`organizations/${t}/`);if(s.status===200){this.currentOrganization=s.data;const o=this.organizations.findIndex(n=>n.id===t);return o>=0&&(this.organizations[o]=s.data),s.data}throw new Error("Organization not found")}catch(s){throw console.error("Error fetching organization detail:",s),s}finally{this.isLoading=!1}},async updateOrganization(t,s){try{if(this.isLoading=!0,s.profile_image||s.cover_image){const o=new FormData;Object.keys(s).forEach(c=>{c!=="profile_image"&&c!=="cover_image"&&s[c]!==null&&o.append(c,s[c])}),s.profile_image&&o.append("profile_image",s.profile_image),s.cover_image&&o.append("cover_image",s.cover_image);const n=await Je(`organizations/${t}/update/`,o);if(n.status===200){const c=n.data.organization;return this._updateOrganizationInState(t,c),n.data}}else{const o=await Le(`organizations/${t}/update/`,s);if(o.status===200){const n=o.data.organization;return this._updateOrganizationInState(t,n),o.data}}throw new Error("Error updating organization")}catch(o){throw console.error("Error updating organization:",o),o}finally{this.isLoading=!1}},async deleteOrganization(t){try{this.isLoading=!0;const s=await $e(`organizations/${t}/delete/`);if(s.status===200)return this.organizations=this.organizations.filter(o=>o.id!==t),this.currentOrganization&&this.currentOrganization.id===t&&(this.currentOrganization=null),s.data;throw new Error("Error deleting organization")}catch(s){throw console.error("Error deleting organization:",s),s}finally{this.isLoading=!1}},async sendInvitation(t,s){try{this.isLoadingInvitations=!0;const o=await te(`organizations/${t}/invitations/send/`,s);if(o.status===201){const n=o.data.invitation;return this.invitations.unshift(n),o.data}throw new Error("Error sending invitation")}catch(o){throw console.error("Error sending invitation:",o),o}finally{this.isLoadingInvitations=!1}},async getOrganizationInvitations(t,s={}){try{this.isLoadingInvitations=!0;const o=new URLSearchParams;Object.keys(s).forEach(i=>{s[i]!==null&&s[i]!==void 0&&s[i]!==""&&o.append(i,s[i])});const n=`organizations/${t}/invitations/${o.toString()?"?"+o.toString():""}`,c=await W(n);if(c.status===200)return this.invitations=c.data,c.data;throw new Error("Error fetching invitations")}catch(o){throw console.error("Error fetching invitations:",o),o}finally{this.isLoadingInvitations=!1}},async cancelInvitation(t,s){try{this.isLoadingInvitations=!0;const o=await $e(`organizations/${t}/invitations/${s}/cancel/`);if(o.status===200)return this.invitations=this.invitations.filter(n=>n.id!==s),o.data;throw new Error("Error canceling invitation")}catch(o){throw console.error("Error canceling invitation:",o),o}finally{this.isLoadingInvitations=!1}},async getMyInvitations(t={}){try{this.isLoadingInvitations=!0;const s=new URLSearchParams;Object.keys(t).forEach(c=>{t[c]!==null&&t[c]!==void 0&&t[c]!==""&&s.append(c,t[c])});const o=`invitations/my-invitations/${s.toString()?"?"+s.toString():""}`,n=await W(o);if(n.status===200)return this.myInvitations=n.data.results,this.pagination={count:n.data.count,next:n.data.next,previous:n.data.previous,currentPage:t.page||1,pageSize:t.page_size||10},n.data;throw new Error("Error fetching my invitations")}catch(s){throw console.error("Error fetching my invitations:",s),s}finally{this.isLoadingInvitations=!1}},async respondToInvitation(t,s){try{this.isLoadingInvitations=!0;const o=await te(`invitations/${t}/respond/`,{action:s});if(o.status===200){const n=this.myInvitations.findIndex(c=>c.id===t);return n>=0&&(this.myInvitations[n]=o.data.invitation),s==="accept"&&await this.getMyMemberships(),o.data}throw new Error("Error responding to invitation")}catch(o){throw console.error("Error responding to invitation:",o),o}finally{this.isLoadingInvitations=!1}},async getMyMemberships(){try{this.isLoading=!0;const t=await W("organizations/my-memberships/");if(t.status===200)return this.myMemberships=t.data.organizations,t.data;throw new Error("Error fetching memberships")}catch(t){throw console.error("Error fetching memberships:",t),t}finally{this.isLoading=!1}},async leaveOrganization(t){try{this.isLoading=!0;const s=await te(`organizations/${t}/leave/`,{});if(s.status===200)return this.myMemberships=this.myMemberships.filter(o=>o.id!==t),s.data;throw new Error("Error leaving organization")}catch(s){throw console.error("Error leaving organization:",s),s}finally{this.isLoading=!1}},async getOrganizationMembers(t,s={}){try{this.isLoadingMembers=!0;const o=new URLSearchParams;Object.keys(s).forEach(i=>{s[i]!==null&&s[i]!==void 0&&s[i]!==""&&o.append(i,s[i])});const n=`organizations/${t}/members/${o.toString()?"?"+o.toString():""}`,c=await W(n);if(c.status===200)return this.organizationMembers=c.data,c.data;throw new Error("Error fetching members")}catch(o){throw console.error("Error fetching members:",o),o}finally{this.isLoadingMembers=!1}},async removeMember(t,s){try{this.isLoadingMembers=!0;const o=await $e(`organizations/${t}/members/${s}/remove/`);if(o.status===200)return this.organizationMembers=this.organizationMembers.filter(n=>n.id!==s),o.data;throw new Error("Error removing member")}catch(o){throw console.error("Error removing member:",o),o}finally{this.isLoadingMembers=!1}},async getOrganizationStats(){try{this.isLoading=!0;const t=await W("organizations/stats/");if(t.status===200)return this.organizationStats=t.data,t.data;throw new Error("Error fetching statistics")}catch(t){throw console.error("Error fetching statistics:",t),t}finally{this.isLoading=!1}},async getOrganizationPublicInfo(t){try{this.isLoading=!0;const s=await W(`organizations/${t}/public/`);if(s.status===200)return s.data;throw new Error("Error fetching public organization info")}catch(s){throw console.error("Error fetching public organization info:",s),s}finally{this.isLoading=!1}},clearAll(){this.organizations=[],this.currentOrganization=null,this.myMemberships=[],this.invitations=[],this.myInvitations=[],this.organizationMembers=[],this.organizationStats={total_organizations:0,total_members:0,total_pending_invitations:0,recent_requests_count:0,active_organizations_count:0,organizations_by_status:{},recent_invitations_count:0},this.dataLoaded=!1,this.lastFetchTime=null},_updateOrganizationInState(t,s){const o=this.organizations.findIndex(c=>c.id===t);o>=0&&(this.organizations[o]=s),this.currentOrganization&&this.currentOrganization.id===t&&(this.currentOrganization=s);const n=this.myMemberships.findIndex(c=>c.id===t);n>=0&&(this.myMemberships[n]=s)}}}),Se=De("corporateRequests",{state:()=>({myRequests:[],receivedRequests:[],currentRequest:null,availableOrganizations:[],requestTypes:[],requestResponses:[],isLoading:!1,isLoadingRequests:!1,isLoadingResponses:!1,isLoadingTypes:!1,pagination:{count:0,next:null,previous:null,currentPage:1,pageSize:10},dashboardStats:{total_requests:0,status_counts:{},priority_counts:{},recent_requests_count:0,assigned_to_me_count:0,overdue_count:0},filters:{status:null,priority:null,search:"",assigned_to_me:!1},dataLoaded:!1,lastFetchTime:null}),getters:{requestById:t=>s=>[...t.myRequests,...t.receivedRequests].find(n=>n.id===s),requestsByStatus:t=>s=>[...t.myRequests,...t.receivedRequests].filter(n=>n.status===s),highPriorityRequests:t=>[...t.myRequests,...t.receivedRequests].filter(o=>o.priority==="HIGH"||o.priority==="URGENT"),pendingRequestsCount:t=>[...t.myRequests,...t.receivedRequests].filter(o=>o.status==="PENDING").length,requestTypeById:t=>s=>t.requestTypes.find(o=>o.id===s)},actions:{async getMyOrganizationsForRequests(){try{this.isLoading=!0;const t=await W("corporate-requests/clients/my-organizations/");if(t.status===200)return this.availableOrganizations=t.data.organizations,t.data;throw new Error("Error fetching organizations for requests")}catch(t){throw console.error("Error fetching organizations for requests:",t),t}finally{this.isLoading=!1}},async getRequestTypes(){var t;try{this.isLoadingTypes=!0;const s=await W("corporate-requests/clients/request-types/");if(s.status===200){const o=s.data.request_types||s.data;return this.requestTypes=o,o}throw new Error("Error fetching request types")}catch(s){throw console.error("Error fetching request types:",s),console.error("Error details:",(t=s.response)==null?void 0:t.data),s}finally{this.isLoadingTypes=!1}},async createCorporateRequest(t){try{this.isLoading=!0;const s=await te("corporate-requests/clients/create/",t);if(s.status===201){const o=s.data.corporate_request;return this.myRequests.unshift(o),this.currentRequest=o,s.data}throw new Error("Error creating corporate request")}catch(s){throw console.error("Error creating corporate request:",s),s}finally{this.isLoading=!1}},async getMyRequests(t={}){try{this.isLoadingRequests=!0;const s=new URLSearchParams;Object.keys(t).forEach(c=>{t[c]!==null&&t[c]!==void 0&&t[c]!==""&&s.append(c,t[c])});const o=`corporate-requests/clients/my-requests/${s.toString()?"?"+s.toString():""}`,n=await W(o);if(n.status===200)return this.myRequests=n.data.results,this.pagination={count:n.data.count,next:n.data.next,previous:n.data.previous,currentPage:t.page||1,pageSize:t.page_size||10},this.dataLoaded=!0,this.lastFetchTime=new Date().toISOString(),n.data;throw new Error("Error fetching my requests")}catch(s){throw console.error("Error fetching my requests:",s),s}finally{this.isLoadingRequests=!1}},async getMyRequestDetail(t){try{this.isLoading=!0;const s=await W(`corporate-requests/clients/${t}/`);if(s.status===200){this.currentRequest=s.data.corporate_request,this.requestResponses=s.data.corporate_request.responses||[];const o=this.myRequests.findIndex(n=>n.id===t);return o>=0&&(this.myRequests[o]=s.data.corporate_request),s.data}throw new Error("Request not found")}catch(s){throw console.error("Error fetching request detail:",s),s}finally{this.isLoading=!1}},async addResponseToMyRequest(t,s){try{this.isLoadingResponses=!0;const o=typeof s=="string"?{response_text:s}:s,n=await te(`corporate-requests/clients/${t}/responses/`,o);if(n.status===201){const c=n.data.response;return this.requestResponses.push(c),this.currentRequest&&this.currentRequest.id===t&&(this.currentRequest.response_count=(this.currentRequest.response_count||0)+1,this.currentRequest.responses||(this.currentRequest.responses=[]),this.currentRequest.responses.push(c)),n.data}throw new Error("Error adding response")}catch(o){throw console.error("Error adding response:",o),o}finally{this.isLoadingResponses=!1}},async getReceivedRequests(t={}){try{this.isLoadingRequests=!0;const s=new URLSearchParams;Object.keys(t).forEach(c=>{t[c]!==null&&t[c]!==void 0&&t[c]!==""&&s.append(c,t[c])});const o=`corporate-requests/corporate/received/${s.toString()?"?"+s.toString():""}`,n=await W(o);if(n.status===200)return this.receivedRequests=n.data.results,this.pagination={count:n.data.count,next:n.data.next,previous:n.data.previous,currentPage:t.page||1,pageSize:t.page_size||10},this.dataLoaded=!0,this.lastFetchTime=new Date().toISOString(),n.data;throw new Error("Error fetching received requests")}catch(s){throw console.error("Error fetching received requests:",s),s}finally{this.isLoadingRequests=!1}},async getReceivedRequestDetail(t){try{this.isLoading=!0;const s=await W(`corporate-requests/corporate/${t}/`);if(s.status===200){this.currentRequest=s.data.corporate_request,this.requestResponses=s.data.corporate_request.responses||[];const o=this.receivedRequests.findIndex(n=>n.id===t);return o>=0&&(this.receivedRequests[o]=s.data.corporate_request),s.data}throw new Error("Request not found")}catch(s){throw console.error("Error fetching received request detail:",s),s}finally{this.isLoading=!1}},async updateReceivedRequest(t,s){try{this.isLoading=!0;const o=await Le(`corporate-requests/corporate/${t}/update/`,s);if(o.status===200){const n=o.data.corporate_request;return this._updateRequestInState(t,n),o.data}throw new Error("Error updating request")}catch(o){throw console.error("Error updating request:",o),o}finally{this.isLoading=!1}},async addResponseToReceivedRequest(t,s){try{this.isLoadingResponses=!0;const o=typeof s=="string"?{response_text:s,is_internal_note:!1}:s,n=await te(`corporate-requests/corporate/${t}/responses/`,o);if(n.status===201){const c=n.data.response;return this.requestResponses.push(c),this.currentRequest&&this.currentRequest.id===t&&(this.currentRequest.response_count=(this.currentRequest.response_count||0)+1,this.currentRequest.responses||(this.currentRequest.responses=[]),this.currentRequest.responses.push(c)),n.data}throw new Error("Error adding response")}catch(o){throw console.error("Error adding response:",o),o}finally{this.isLoadingResponses=!1}},async getDashboardStats(){try{this.isLoading=!0;const t=await W("corporate-requests/corporate/dashboard-stats/");if(t.status===200)return this.dashboardStats=t.data,t.data;throw new Error("Error fetching dashboard stats")}catch(t){throw console.error("Error fetching dashboard stats:",t),t}finally{this.isLoading=!1}},async getRequestConversation(t){try{this.isLoadingResponses=!0;const s=await W(`corporate-requests/${t}/conversation/`);if(s.status===200)return this.requestResponses=s.data.responses,s.data;throw new Error("Error fetching conversation")}catch(s){throw console.error("Error fetching conversation:",s),s}finally{this.isLoadingResponses=!1}},async updateFilters(t,s){this.filters={...this.filters,...t};const o={status:this.filters.status,priority:this.filters.priority,search:this.filters.search,page:1};s==="corporate_client"&&this.filters.assigned_to_me&&(o.assigned_to_me=this.filters.assigned_to_me),s==="client"?await this.getMyRequests(o):s==="corporate_client"&&await this.getReceivedRequests(o)},clearFilters(){this.filters={status:null,priority:null,search:"",assigned_to_me:!1}},async refreshRequests(t){const s={page:this.pagination.currentPage,page_size:this.pagination.pageSize};t==="client"?await this.getMyRequests(s):t==="corporate_client"&&await this.getReceivedRequests(s)},clearAll(){this.myRequests=[],this.receivedRequests=[],this.currentRequest=null,this.availableOrganizations=[],this.requestTypes=[],this.requestResponses=[],this.dashboardStats={total_requests:0,status_counts:{},priority_counts:{},recent_requests_count:0,assigned_to_me_count:0,overdue_count:0},this.clearFilters(),this.dataLoaded=!1,this.lastFetchTime=null},_updateRequestInState(t,s){const o=this.myRequests.findIndex(c=>c.id===t);o>=0&&(this.myRequests[o]=s);const n=this.receivedRequests.findIndex(c=>c.id===t);n>=0&&(this.receivedRequests[n]=s),this.currentRequest&&this.currentRequest.id===t&&(this.currentRequest=s)},getStatusDisplay(t){return{PENDING:"Pendiente",IN_REVIEW:"En Revisión",RESPONDED:"Respondida",RESOLVED:"Resuelta",CLOSED:"Cerrada"}[t]||t},getPriorityDisplay(t){return{LOW:"Baja",MEDIUM:"Media",HIGH:"Alta",URGENT:"Urgente"}[t]||t},getPriorityColorClass(t){return{LOW:"text-gray-600 bg-gray-100",MEDIUM:"text-blue-600 bg-blue-100",HIGH:"text-orange-600 bg-orange-100",URGENT:"text-red-600 bg-red-100"}[t]||"text-gray-600 bg-gray-100"},getStatusColorClass(t){return{PENDING:"text-yellow-600 bg-yellow-100",IN_REVIEW:"text-blue-600 bg-blue-100",RESPONDED:"text-purple-600 bg-purple-100",RESOLVED:"text-green-600 bg-green-100",CLOSED:"text-gray-600 bg-gray-100"}[t]||"text-gray-600 bg-gray-100"}}}),Q=t=>(ye("data-v-f95d1db7"),t=t(),xe(),t),wt=Q(()=>e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)),$t={class:"fixed inset-0 z-10 overflow-y-auto"},Et={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},zt={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},kt=Q(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," Crea tu organización para empezar a recibir solicitudes corporativas ",-1)),qt={key:0,class:"flex justify-center items-center py-8"},Ct=Q(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),Rt=Q(()=>e("span",{class:"ml-2 text-gray-600"},"Creando organización...",-1)),Pt=[Ct,Rt],Mt={key:1,class:"text-center py-6"},St=Q(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," ¡Organización Creada! ",-1)),It={class:"text-sm text-gray-600 mb-6"},Dt={class:"space-y-4"},Lt=Q(()=>e("h4",{class:"text-md font-medium text-gray-900"},"Información Básica",-1)),jt=Q(()=>e("label",{for:"title",class:"block text-sm font-medium leading-6 text-gray-900"}," Nombre de la Organización * ",-1)),Ot={class:"mt-2"},Nt={key:0,class:"mt-1 text-sm text-red-600"},At=Q(()=>e("label",{for:"description",class:"block text-sm font-medium leading-6 text-gray-900"}," Descripción * ",-1)),Ut={class:"mt-2"},Vt=Q(()=>e("p",{class:"mt-1 text-xs text-gray-500"}," Esta descripción será visible para los clientes que reciban invitaciones ",-1)),Tt={key:0,class:"mt-1 text-sm text-red-600"},Gt={class:"space-y-4 border-t border-gray-200 pt-6"},Bt=Q(()=>e("h4",{class:"text-md font-medium text-gray-900"},"Imágenes (Opcional)",-1)),Ft=Q(()=>e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Imagen de Perfil ",-1)),Ht={class:"mt-2 flex items-center space-x-4"},Wt={class:"flex-shrink-0"},Zt=["src"],Jt={class:"flex-1"},Qt=Q(()=>e("p",{class:"mt-1 text-xs text-gray-500"},"PNG, JPG hasta 5MB",-1)),Yt={key:0,class:"mt-1 text-sm text-red-600"},Xt=Q(()=>e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Imagen de Portada ",-1)),Kt={class:"mt-2"},es={class:"mb-4"},ts=["src"],ss=Q(()=>e("p",{class:"mt-1 text-xs text-gray-500"},"PNG, JPG hasta 5MB. Recomendado: 800x400px",-1)),os={key:0,class:"mt-1 text-sm text-red-600"},as={key:0,class:"space-y-4 border-t border-gray-200 pt-6"},is=Q(()=>e("h4",{class:"text-md font-medium text-gray-900"},"Vista Previa",-1)),ns={class:"bg-gray-50 border border-gray-200 rounded-lg overflow-hidden"},rs={class:"relative h-24 bg-gradient-to-r from-blue-500 to-purple-600"},ls=["src"],cs=Q(()=>e("div",{class:"absolute inset-0 bg-black bg-opacity-30"},null,-1)),ds={class:"absolute bottom-2 left-4"},us=["src"],gs={class:"p-4"},ms={class:"text-sm font-medium text-gray-900 mb-1"},fs={class:"text-xs text-gray-600 line-clamp-2"},hs={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},vs={class:"flex"},ps=Q(()=>e("div",{class:"ml-3"},[e("h5",{class:"text-sm font-medium text-blue-800"},"Información importante"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Serás el líder y administrador de esta organización"),e("p",null,"• Podrás invitar clientes a unirse como miembros"),e("p",null,"• Los miembros podrán enviarte solicitudes corporativas"),e("p",null,"• Puedes editar la información en cualquier momento")])],-1)),_s={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},bs=["disabled"],ys={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},xs={__name:"CreateOrganizationModal",props:{visible:{type:Boolean,default:!1}},emits:["close","created"],setup(t,{emit:s}){const o=t,n=s,c=ce(),i=S(!1),v=S(!1),f=S({}),g=S(null),y=S({title:"",description:"",profile_image:null,cover_image:null}),x=S(null),w=S(null),q=I(()=>"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMDAgMTAwTDE4MCA4MEwyMjAgODBMMjAwIDEwMFoiIGZpbGw9IiM5Q0E0QUYiLz4KPC9zdmc+"),p=()=>{y.value={title:"",description:"",profile_image:null,cover_image:null},f.value={},x.value=null,w.value=null,v.value=!1,g.value=null},E=h=>{const m=h.target.files[0];if(m){if(m.size>5*1024*1024){j("La imagen debe ser menor a 5MB","warning");return}if(!m.type.startsWith("image/")){j("Solo se permiten archivos de imagen","warning");return}y.value.profile_image=m;const z=new FileReader;z.onload=D=>{x.value=D.target.result},z.readAsDataURL(m)}},$=h=>{const m=h.target.files[0];if(m){if(m.size>5*1024*1024){j("La imagen debe ser menor a 5MB","warning");return}if(!m.type.startsWith("image/")){j("Solo se permiten archivos de imagen","warning");return}y.value.cover_image=m;const z=new FileReader;z.onload=D=>{w.value=D.target.result},z.readAsDataURL(m)}},R=async()=>{var h,m,z,D;try{i.value=!0,f.value={};const M={title:y.value.title.trim(),description:y.value.description.trim()};y.value.profile_image&&(M.profile_image=y.value.profile_image),y.value.cover_image&&(M.cover_image=y.value.cover_image);const V=await c.createOrganization(M);g.value=V.organization,v.value=!0,j("Organización creada exitosamente","success"),n("created",V.organization)}catch(M){console.error("Error creating organization:",M),(m=(h=M.response)==null?void 0:h.data)!=null&&m.details?f.value=M.response.data.details:(D=(z=M.response)==null?void 0:z.data)!=null&&D.error?j(M.response.data.error,"error"):j("Error al crear la organización","error")}finally{i.value=!1}},P=()=>{p()},b=()=>{i.value||n("close")};return K(()=>o.visible,h=>{h&&be(()=>{p()})}),(h,m)=>(a(),B(d(fe),{as:"template",show:t.visible},{default:U(()=>[u(d(ue),{class:"relative z-50",onClose:b},{default:U(()=>[u(d(ee),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:U(()=>[wt]),_:1}),e("div",$t,[e("div",Et,[u(d(ee),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:U(()=>[u(d(ge),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6"},{default:U(()=>{var z;return[e("div",zt,[e("div",null,[u(d(me),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:U(()=>[_(" Crear Nueva Organización ")]),_:1}),kt]),e("button",{onClick:b,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(d(ie),{class:"h-6 w-6"})])]),i.value?(a(),r("div",qt,Pt)):v.value?(a(),r("div",Mt,[u(d(Ce),{class:"h-16 w-16 text-green-500 mx-auto mb-4"}),St,e("p",It,[_(" Tu organización "),e("strong",null,l((z=g.value)==null?void 0:z.title),1),_(" ha sido creada exitosamente. ")]),e("div",{class:"space-y-3"},[e("button",{onClick:P,class:"w-full inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Crear Otra Organización "),e("button",{onClick:b,class:"w-full inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cerrar ")])])):(a(),r("form",{key:2,onSubmit:le(R,["prevent"]),class:"space-y-6"},[e("div",Dt,[Lt,e("div",null,[jt,e("div",Ot,[G(e("input",{id:"title","onUpdate:modelValue":m[0]||(m[0]=D=>y.value.title=D),type:"text",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ej: Consultora Jurídica Andina"},null,512),[[X,y.value.title]])]),f.value.title?(a(),r("p",Nt,l(f.value.title[0]),1)):k("",!0)]),e("div",null,[At,e("div",Ut,[G(e("textarea",{id:"description","onUpdate:modelValue":m[1]||(m[1]=D=>y.value.description=D),rows:"4",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Describe el propósito y servicios de tu organización..."},null,512),[[X,y.value.description]])]),Vt,f.value.description?(a(),r("p",Tt,l(f.value.description[0]),1)):k("",!0)])]),e("div",Gt,[Bt,e("div",null,[Ft,e("div",Ht,[e("div",Wt,[e("img",{src:x.value||"/src/assets/images/user_avatar.jpg",alt:"Profile preview",class:"h-16 w-16 rounded-full object-cover border-2 border-gray-200 bg-gray-50"},null,8,Zt)]),e("div",Jt,[e("input",{ref:"profileImageInput",type:"file",accept:"image/*",class:"hidden",onChange:E},null,544),e("button",{type:"button",onClick:m[2]||(m[2]=D=>h.$refs.profileImageInput.click()),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(ke),{class:"h-4 w-4 mr-2"}),_(" Seleccionar Imagen ")]),Qt])]),f.value.profile_image?(a(),r("p",Yt,l(f.value.profile_image[0]),1)):k("",!0)]),e("div",null,[Xt,e("div",Kt,[e("div",es,[e("img",{src:w.value||q.value,alt:"Cover preview",class:"w-full h-32 rounded-lg object-cover border-2 border-gray-200 bg-gray-50"},null,8,ts)]),e("div",null,[e("input",{ref:"coverImageInput",type:"file",accept:"image/*",class:"hidden",onChange:$},null,544),e("button",{type:"button",onClick:m[3]||(m[3]=D=>h.$refs.coverImageInput.click()),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(ke),{class:"h-4 w-4 mr-2"}),_(" Seleccionar Portada ")]),ss])]),f.value.cover_image?(a(),r("p",os,l(f.value.cover_image[0]),1)):k("",!0)])]),y.value.title||y.value.description?(a(),r("div",as,[is,e("div",ns,[e("div",rs,[w.value?(a(),r("img",{key:0,src:w.value,alt:"Portada preview",class:"w-full h-full object-cover"},null,8,ls)):k("",!0),cs,e("div",ds,[e("img",{src:x.value||"/src/assets/images/user_avatar.jpg",alt:"Logo preview",class:"h-12 w-12 rounded-full border-2 border-white object-cover bg-white"},null,8,us)])]),e("div",gs,[e("h3",ms,l(y.value.title||"Nombre de la Organización"),1),e("p",fs,l(y.value.description||"Descripción de la organización..."),1)])])])):k("",!0),e("div",hs,[e("div",vs,[u(d(oe),{class:"h-5 w-5 text-blue-400 mt-0.5"}),ps])]),e("div",_s,[e("button",{type:"button",onClick:b,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value||!y.value.title.trim()||!y.value.description.trim(),class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),r("div",ys)):(a(),B(d(_e),{key:1,class:"h-4 w-4 mr-2"})),_(" "+l(i.value?"Creando...":"Crear Organización"),1)],8,bs)])],32))]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},ws=we(xs,[["__scopeId","data-v-f95d1db7"]]),$s=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),Es={class:"fixed inset-0 z-10 overflow-y-auto"},zs={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},ks={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},qs=e("p",{class:"mt-1 text-sm text-gray-500"}," Actualiza la información y configuración de tu organización ",-1),Cs={key:0,class:"flex justify-center items-center py-8"},Rs=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),Ps=e("span",{class:"ml-2 text-gray-600"},"Actualizando organización...",-1),Ms=[Rs,Ps],Ss={class:"space-y-4"},Is=e("h4",{class:"text-md font-medium text-gray-900"},"Información Básica",-1),Ds=e("label",{for:"title",class:"block text-sm font-medium leading-6 text-gray-900"}," Nombre de la Organización * ",-1),Ls={class:"mt-2"},js={key:0,class:"mt-1 text-sm text-red-600"},Os=e("label",{for:"description",class:"block text-sm font-medium leading-6 text-gray-900"}," Descripción * ",-1),Ns={class:"mt-2"},As={key:0,class:"mt-1 text-sm text-red-600"},Us=e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Estado de la Organización ",-1),Vs={class:"mt-2"},Ts={class:"flex items-center space-x-6"},Gs={class:"flex items-center"},Bs=e("label",{for:"active",class:"ml-2 block text-sm text-gray-900"}," Activa ",-1),Fs={class:"flex items-center"},Hs=e("label",{for:"inactive",class:"ml-2 block text-sm text-gray-900"}," Inactiva ",-1),Ws={class:"space-y-4 border-t border-gray-200 pt-6"},Zs=e("h4",{class:"text-md font-medium text-gray-900"},"Imágenes",-1),Js=e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Imagen de Perfil ",-1),Qs={class:"mt-2 flex items-center space-x-4"},Ys={class:"flex-shrink-0"},Xs=["src"],Ks=e("p",{class:"mt-1 text-xs text-gray-500"},"PNG, JPG hasta 5MB",-1),eo={key:0,class:"mt-1 text-sm text-red-600"},to=e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Imagen de Portada ",-1),so={class:"mt-2"},oo={class:"mb-4"},ao=["src"],io=e("p",{class:"mt-1 text-xs text-gray-500"},"PNG, JPG hasta 5MB",-1),no={key:0,class:"mt-1 text-sm text-red-600"},ro={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},lo=["disabled"],co={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},uo={__name:"EditOrganizationModal",props:{visible:{type:Boolean,default:!1},organization:{type:Object,default:null}},emits:["close","updated"],setup(t,{emit:s}){const o=t,n=s,c=ce(),i=S(!1),v=S({}),f=S({title:"",description:"",is_active:!0,profile_image:null,cover_image:null}),g=S(null),y=S(null),x=I(()=>{var P;return g.value?g.value:(P=o.organization)!=null&&P.profile_image_url?o.organization.profile_image_url:"/src/assets/images/user_avatar.jpg"}),w=I(()=>{var P;return y.value?y.value:(P=o.organization)!=null&&P.cover_image_url?o.organization.cover_image_url:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMDAgMTAwTDE4MCA4MEwyMjAgODBMMjAwIDEwMFoiIGZpbGw9IiM5Q0E0QUYiLz4KPC9zdmc+"}),q=()=>{o.organization?f.value={title:o.organization.title||"",description:o.organization.description||"",is_active:o.organization.is_active!==void 0?o.organization.is_active:!0,profile_image:null,cover_image:null}:f.value={title:"",description:"",is_active:!0,profile_image:null,cover_image:null},v.value={},g.value=null,y.value=null},p=P=>{const b=P.target.files[0];if(b){if(b.size>5*1024*1024){j("La imagen debe ser menor a 5MB","warning");return}if(!b.type.startsWith("image/")){j("Solo se permiten archivos de imagen","warning");return}f.value.profile_image=b;const h=new FileReader;h.onload=m=>{g.value=m.target.result},h.readAsDataURL(b)}},E=P=>{const b=P.target.files[0];if(b){if(b.size>5*1024*1024){j("La imagen debe ser menor a 5MB","warning");return}if(!b.type.startsWith("image/")){j("Solo se permiten archivos de imagen","warning");return}f.value.cover_image=b;const h=new FileReader;h.onload=m=>{y.value=m.target.result},h.readAsDataURL(b)}},$=async()=>{var P,b,h,m;if(o.organization)try{i.value=!0,v.value={};const z={title:f.value.title,description:f.value.description,is_active:f.value.is_active};f.value.profile_image&&(z.profile_image=f.value.profile_image),f.value.cover_image&&(z.cover_image=f.value.cover_image);const D=await c.updateOrganization(o.organization.id,z);j("Organización actualizada exitosamente","success"),n("updated",D.organization)}catch(z){console.error("Error updating organization:",z),(b=(P=z.response)==null?void 0:P.data)!=null&&b.details?v.value=z.response.data.details:(m=(h=z.response)==null?void 0:h.data)!=null&&m.error?j(z.response.data.error,"error"):j("Error al actualizar la organización","error")}finally{i.value=!1}},R=()=>{i.value||n("close")};return K(()=>o.visible,P=>{P&&be(()=>{q()})}),K(()=>o.organization,P=>{P&&o.visible&&q()}),(P,b)=>(a(),B(d(fe),{as:"template",show:t.visible},{default:U(()=>[u(d(ue),{class:"relative z-50",onClose:R},{default:U(()=>[u(d(ee),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:U(()=>[$s]),_:1}),e("div",Es,[e("div",zs,[u(d(ee),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:U(()=>[u(d(ge),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6"},{default:U(()=>[e("div",ks,[e("div",null,[u(d(me),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:U(()=>[_(" Editar Organización ")]),_:1}),qs]),e("button",{onClick:R,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(d(ie),{class:"h-6 w-6"})])]),i.value?(a(),r("div",Cs,Ms)):(a(),r("form",{key:1,onSubmit:le($,["prevent"]),class:"space-y-6"},[e("div",Ss,[Is,e("div",null,[Ds,e("div",Ls,[G(e("input",{id:"title","onUpdate:modelValue":b[0]||(b[0]=h=>f.value.title=h),type:"text",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ingresa el nombre de la organización"},null,512),[[X,f.value.title]])]),v.value.title?(a(),r("p",js,l(v.value.title[0]),1)):k("",!0)]),e("div",null,[Os,e("div",Ns,[G(e("textarea",{id:"description","onUpdate:modelValue":b[1]||(b[1]=h=>f.value.description=h),rows:"4",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Describe tu organización..."},null,512),[[X,f.value.description]])]),v.value.description?(a(),r("p",As,l(v.value.description[0]),1)):k("",!0)]),e("div",null,[Us,e("div",Vs,[e("div",Ts,[e("div",Gs,[G(e("input",{id:"active","onUpdate:modelValue":b[2]||(b[2]=h=>f.value.is_active=h),value:!0,type:"radio",class:"h-4 w-4 text-blue-600 focus:ring-blue-600 border-gray-300"},null,512),[[Qe,f.value.is_active]]),Bs]),e("div",Fs,[G(e("input",{id:"inactive","onUpdate:modelValue":b[3]||(b[3]=h=>f.value.is_active=h),value:!1,type:"radio",class:"h-4 w-4 text-blue-600 focus:ring-blue-600 border-gray-300"},null,512),[[Qe,f.value.is_active]]),Hs])])])])]),e("div",Ws,[Zs,e("div",null,[Js,e("div",Qs,[e("div",Ys,[e("img",{src:x.value,alt:"Profile preview",class:"h-16 w-16 rounded-full object-cover border-2 border-gray-200"},null,8,Xs)]),e("div",null,[e("input",{ref:"profileImageInput",type:"file",accept:"image/*",class:"hidden",onChange:p},null,544),e("button",{type:"button",onClick:b[4]||(b[4]=h=>P.$refs.profileImageInput.click()),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(ke),{class:"h-4 w-4 mr-2"}),_(" Cambiar Imagen ")]),Ks])]),v.value.profile_image?(a(),r("p",eo,l(v.value.profile_image[0]),1)):k("",!0)]),e("div",null,[to,e("div",so,[e("div",oo,[e("img",{src:w.value,alt:"Cover preview",class:"w-full h-32 rounded-lg object-cover border-2 border-gray-200"},null,8,ao)]),e("div",null,[e("input",{ref:"coverImageInput",type:"file",accept:"image/*",class:"hidden",onChange:E},null,544),e("button",{type:"button",onClick:b[5]||(b[5]=h=>P.$refs.coverImageInput.click()),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(ke),{class:"h-4 w-4 mr-2"}),_(" Cambiar Portada ")]),io])]),v.value.cover_image?(a(),r("p",no,l(v.value.cover_image[0]),1)):k("",!0)])]),e("div",ro,[e("button",{type:"button",onClick:R,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value,class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),r("div",co)):k("",!0),_(" "+l(i.value?"Guardando...":"Guardar Cambios"),1)],8,lo)])],32))]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},go=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),mo={class:"fixed inset-0 z-10 overflow-y-auto"},fo={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},ho={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},vo={class:"mt-1 text-sm text-gray-500"},po={key:0,class:"flex justify-center items-center py-8"},_o=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),bo=e("span",{class:"ml-2 text-gray-600"},"Enviando invitación...",-1),yo=[_o,bo],xo={key:0,class:"bg-gray-50 rounded-lg p-4"},wo={class:"flex items-center space-x-3"},$o=["src","alt"],Eo={class:"text-sm font-medium text-gray-900"},zo={class:"text-xs text-gray-500"},ko=e("label",{for:"email",class:"block text-sm font-medium leading-6 text-gray-900"}," Email del Cliente * ",-1),qo={class:"mt-2"},Co=e("p",{class:"mt-1 text-xs text-gray-500"}," El email debe corresponder a un usuario registrado como cliente en la plataforma ",-1),Ro={key:0,class:"mt-1 text-sm text-red-600"},Po=e("label",{for:"message",class:"block text-sm font-medium leading-6 text-gray-900"}," Mensaje Personalizado ",-1),Mo={class:"mt-2"},So=e("p",{class:"mt-1 text-xs text-gray-500"}," Este mensaje se incluirá en la invitación que reciba el cliente ",-1),Io={key:0,class:"mt-1 text-sm text-red-600"},Do={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Lo=e("h5",{class:"text-sm font-medium text-blue-900 mb-2"},"Vista previa del mensaje:",-1),jo={class:"text-sm text-blue-800 bg-white rounded p-3 border border-blue-100"},Oo={class:"mb-2"},No={class:"mb-2 italic"},Ao=e("p",{class:"text-xs text-blue-600"},"Puedes aceptar o rechazar esta invitación desde tu panel de control.",-1),Uo={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},Vo={class:"flex"},To=e("div",{class:"ml-3"},[e("h5",{class:"text-sm font-medium text-yellow-800"},"Información importante"),e("div",{class:"mt-1 text-sm text-yellow-700 space-y-1"},[e("p",null,"• La invitación se enviará al usuario dentro de la plataforma"),e("p",null,"• El usuario debe estar registrado como cliente"),e("p",null,"• Las invitaciones expiran automáticamente en 30 días"),e("p",null,"• Puedes cancelar invitaciones pendientes en cualquier momento")])],-1),Go={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},Bo=["disabled"],Fo={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Ho={key:2,class:"text-center py-6"},Wo=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," ¡Invitación Enviada! ",-1),Zo={class:"text-sm text-gray-600 mb-6"},Jo={__name:"InviteMemberModal",props:{visible:{type:Boolean,default:!1},organization:{type:Object,default:null}},emits:["close","invited"],setup(t,{emit:s}){const o=t,n=s,c=ce(),i=S(!1),v=S(!1),f=S({}),g=S({invited_user_email:"",message:""}),y=()=>{g.value={invited_user_email:"",message:""},f.value={},v.value=!1},x=async()=>{var E,$,R,P,b,h;if(o.organization)try{i.value=!0,f.value={};const m={invited_user_email:g.value.invited_user_email.trim(),message:g.value.message.trim()},z=await c.sendInvitation(o.organization.id,m);j("Invitación enviada exitosamente","success"),v.value=!0,n("invited",z.invitation)}catch(m){console.error("Error sending invitation:",m),($=(E=m.response)==null?void 0:E.data)!=null&&$.details?f.value=m.response.data.details:(P=(R=m.response)==null?void 0:R.data)!=null&&P.error?j(m.response.data.error,"error"):((b=m.response)==null?void 0:b.status)===400?(h=m.response.data)!=null&&h.invited_user_email?f.value.invited_user_email=m.response.data.invited_user_email:j("Error en los datos de la invitación","error"):j("Error al enviar la invitación","error")}finally{i.value=!1}},w=()=>{y()},q=()=>{i.value||n("close")};K(()=>o.visible,E=>{E&&be(()=>{y()})});const p=I(()=>o.organization?`Te invitamos a unirte a nuestra organización "${o.organization.title}" para colaborar en proyectos y solicitudes corporativas. ¡Esperamos contar contigo!`:"");return K(()=>o.organization,E=>{E&&o.visible&&!g.value.message.trim()&&(g.value.message=p.value)}),(E,$)=>(a(),B(d(fe),{as:"template",show:t.visible},{default:U(()=>[u(d(ue),{class:"relative z-50",onClose:q},{default:U(()=>[u(d(ee),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:U(()=>[go]),_:1}),e("div",mo,[e("div",fo,[u(d(ee),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:U(()=>[u(d(ge),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"},{default:U(()=>{var R,P;return[e("div",ho,[e("div",null,[u(d(me),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:U(()=>[_(" Invitar Nuevo Miembro ")]),_:1}),e("p",vo," Invita a un cliente a unirse a "+l((R=t.organization)==null?void 0:R.title),1)]),e("button",{onClick:q,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(d(ie),{class:"h-6 w-6"})])]),i.value?(a(),r("div",po,yo)):(a(),r("form",{key:1,onSubmit:le(x,["prevent"]),class:"space-y-6"},[t.organization?(a(),r("div",xo,[e("div",wo,[e("img",{src:t.organization.profile_image_url||"/src/assets/images/user_avatar.jpg",alt:`Logo de ${t.organization.title}`,class:"h-12 w-12 rounded-full object-cover border-2 border-white"},null,8,$o),e("div",null,[e("h4",Eo,l(t.organization.title),1),e("p",zo,l(t.organization.member_count)+" miembros actuales",1)])])])):k("",!0),e("div",null,[ko,e("div",qo,[G(e("input",{id:"email","onUpdate:modelValue":$[0]||($[0]=b=>g.value.invited_user_email=b),type:"email",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"cliente@ejemplo.com"},null,512),[[X,g.value.invited_user_email]])]),Co,f.value.invited_user_email?(a(),r("p",Ro,l(f.value.invited_user_email[0]),1)):k("",!0)]),e("div",null,[Po,e("div",Mo,[G(e("textarea",{id:"message","onUpdate:modelValue":$[1]||($[1]=b=>g.value.message=b),rows:"4",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Opcional: Añade un mensaje personalizado para la invitación..."},null,512),[[X,g.value.message]])]),So,f.value.message?(a(),r("p",Io,l(f.value.message[0]),1)):k("",!0)]),g.value.message.trim()?(a(),r("div",Do,[Lo,e("div",jo,[e("p",Oo,[e("strong",null,l((P=t.organization)==null?void 0:P.title),1),_(" te ha invitado a unirte a su organización.")]),e("p",No,'"'+l(g.value.message)+'"',1),Ao])])):k("",!0),e("div",Uo,[e("div",Vo,[u(d(oe),{class:"h-5 w-5 text-yellow-400 mt-0.5"}),To])]),e("div",Go,[e("button",{type:"button",onClick:q,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value||!g.value.invited_user_email.trim(),class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),r("div",Fo)):(a(),B(d(nt),{key:1,class:"h-4 w-4 mr-2"})),_(" "+l(i.value?"Enviando...":"Enviar Invitación"),1)],8,Bo)])],32)),v.value?(a(),r("div",Ho,[u(d(Ce),{class:"h-16 w-16 text-green-500 mx-auto mb-4"}),Wo,e("p",Zo,[_(" La invitación ha sido enviada exitosamente a "),e("strong",null,l(g.value.invited_user_email),1)]),e("div",{class:"space-y-3"},[e("button",{onClick:w,class:"w-full inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Invitar a Otra Persona "),e("button",{onClick:q,class:"w-full inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cerrar ")])])):k("",!0)]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},rt=t=>(ye("data-v-3c547838"),t=t(),xe(),t),Qo={class:"bg-white shadow rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow"},Yo={class:"flex items-start justify-between mb-4"},Xo={class:"flex-1"},Ko={class:"flex items-center space-x-2 mb-2"},ea={class:"text-sm font-medium text-gray-900"},ta={class:"text-lg font-semibold text-gray-900 mb-1"},sa={class:"text-sm text-gray-600 line-clamp-2 mb-3"},oa={class:"flex space-x-2"},aa={class:"relative"},ia={key:0,class:"absolute right-0 mt-1 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none z-10"},na={class:"py-1"},ra=["onClick","disabled"],la={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},ca={class:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg"},da=["src","alt"],ua={class:"text-sm font-medium text-gray-900"},ga={class:"text-xs text-gray-500"},ma={class:"flex items-center space-x-3 p-3 bg-blue-50 rounded-lg"},fa=["src","alt"],ha={class:"text-sm font-medium text-blue-900"},va=rt(()=>e("p",{class:"text-xs text-blue-600"}," Vía organización ",-1)),pa={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-gray-500 mb-4"},_a={class:"flex items-center"},ba={class:"flex items-center"},ya={class:"flex items-center"},xa={class:"flex items-center"},wa={key:0,class:"text-xs text-gray-500 mb-3"},$a=rt(()=>e("span",{class:"font-medium"},"Última actualización:",-1)),Ea={class:"w-full bg-gray-200 rounded-full h-1.5 mb-2"},za={class:"text-xs text-gray-500"},ka={__name:"CorporateRequestCard",props:{request:{type:Object,required:!0}},emits:["view-detail","status-updated"],setup(t,{emit:s}){const o=t,n=s,c=S(!1),i=S(!1),v=I(()=>"/src/assets/images/user_avatar.jpg"),f=I(()=>{var h;return((h=o.request.organization_info)==null?void 0:h.profile_image)||"/src/assets/images/user_avatar.jpg"}),g=I(()=>[{value:"PENDING",label:"Pendiente"},{value:"IN_REVIEW",label:"En Revisión"},{value:"RESPONDED",label:"Respondida"},{value:"RESOLVED",label:"Resuelta"},{value:"CLOSED",label:"Cerrada"}]),y=()=>{n("view-detail",o.request.id)},x=async h=>{if(h===o.request.status){c.value=!1;return}try{i.value=!0,c.value=!1,n("status-updated",{requestId:o.request.id,newStatus:h,request:o.request})}catch(m){console.error("Error updating status:",m)}finally{i.value=!1}},w=h=>({PENDING:"Pendiente",IN_REVIEW:"En Revisión",RESPONDED:"Respondida",RESOLVED:"Resuelta",CLOSED:"Cerrada"})[h]||h,q=h=>({PENDING:"bg-yellow-100 text-yellow-800",IN_REVIEW:"bg-blue-100 text-blue-800",RESPONDED:"bg-purple-100 text-purple-800",RESOLVED:"bg-green-100 text-green-800",CLOSED:"bg-gray-100 text-gray-800"})[h]||"bg-gray-100 text-gray-800",p=h=>({LOW:"Baja",MEDIUM:"Media",HIGH:"Alta",URGENT:"Urgente"})[h]||h,E=h=>({LOW:"bg-gray-100 text-gray-600",MEDIUM:"bg-blue-100 text-blue-600",HIGH:"bg-orange-100 text-orange-600",URGENT:"bg-red-100 text-red-600"})[h]||"bg-gray-100 text-gray-600",$=h=>({PENDING:20,IN_REVIEW:40,RESPONDED:60,RESOLVED:80,CLOSED:100})[h]||0,R=h=>({PENDING:"bg-yellow-500",IN_REVIEW:"bg-blue-500",RESPONDED:"bg-purple-500",RESOLVED:"bg-green-500",CLOSED:"bg-gray-500"})[h]||"bg-gray-500",P=h=>({PENDING:"La solicitud está esperando revisión inicial",IN_REVIEW:"La solicitud está siendo analizada por el equipo",RESPONDED:"Se ha proporcionado una respuesta al cliente",RESOLVED:"La solicitud ha sido completada satisfactoriamente",CLOSED:"La solicitud ha sido cerrada y archivada"})[h]||"Estado desconocido",b=h=>{const m=new Date(h),D=Math.abs(new Date-m),M=Math.ceil(D/(1e3*60*60*24));return M===0?"Hoy":M===1?"Ayer":M<7?`Hace ${M} días`:M<30?`Hace ${Math.ceil(M/7)} semanas`:m.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})};return(h,m)=>{var z,D;return a(),r("div",Qo,[e("div",Yo,[e("div",Xo,[e("div",Ko,[e("span",ea,l(t.request.request_number),1),e("span",{class:F([q(t.request.status),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(w(t.request.status)),3),e("span",{class:F([E(t.request.priority),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(p(t.request.priority)),3)]),e("h3",ta,l(t.request.title),1),e("p",sa,l(t.request.description),1)]),e("div",oa,[e("button",{onClick:y,class:"inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(Re),{class:"h-3 w-3 mr-1"}),_(" Ver Detalle ")]),e("div",aa,[e("button",{onClick:m[0]||(m[0]=M=>c.value=!c.value),class:"inline-flex items-center px-3 py-1 border border-blue-300 text-xs font-medium rounded text-blue-700 bg-blue-50 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(Pe),{class:"h-3 w-3 mr-1"}),_(" Cambiar Estado ")]),c.value?(a(),r("div",ia,[e("div",na,[(a(!0),r(Z,null,J(g.value,M=>(a(),r("button",{key:M.value,onClick:V=>x(M.value),disabled:i.value,class:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 disabled:opacity-50"},[e("span",{class:F([q(M.value),"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium mr-2"])},l(M.label),3)],8,ra))),128))])])):k("",!0)])])]),e("div",la,[e("div",ca,[e("img",{src:v.value,alt:`Avatar de ${t.request.client_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,da),e("div",null,[e("p",ua,l(t.request.client_name),1),e("p",ga," Cliente • "+l(t.request.client_email),1)])]),e("div",ma,[e("img",{src:f.value,alt:`Logo de ${(z=t.request.organization_info)==null?void 0:z.title}`,class:"h-8 w-8 rounded-full object-cover border border-blue-200"},null,8,fa),e("div",null,[e("p",ha,l(((D=t.request.organization_info)==null?void 0:D.title)||"Organización"),1),va])])]),e("div",pa,[e("div",_a,[u(d(st),{class:"h-3 w-3 mr-1"}),_(" "+l(t.request.request_type_name),1)]),e("div",ba,[u(d(ae),{class:"h-3 w-3 mr-1"}),_(" "+l(b(t.request.created_at)),1)]),e("div",ya,[u(d(Ue),{class:"h-3 w-3 mr-1"}),_(" "+l(t.request.response_count)+" respuestas ",1)]),e("div",xa,[u(d(je),{class:"h-3 w-3 mr-1"}),_(" "+l(t.request.days_since_created)+" días ",1)])]),t.request.status_updated_at&&t.request.status_updated_at!==t.request.created_at?(a(),r("div",wa,[$a,_(" "+l(b(t.request.status_updated_at)),1)])):k("",!0),e("div",Ea,[e("div",{class:F([R(t.request.status),"h-1.5 rounded-full transition-all duration-300"]),style:Ke({width:$(t.request.status)+"%"})},null,6)]),e("p",za,l(P(t.request.status)),1),c.value?(a(),r("div",{key:1,onClick:m[1]||(m[1]=M=>c.value=!1),class:"fixed inset-0 z-0"})):k("",!0)])}}},qa=we(ka,[["__scopeId","data-v-3c547838"]]),Ca={class:"mb-6"},Ra={class:"flex items-center justify-between"},Pa=e("div",null,[e("h2",{class:"text-lg font-medium text-gray-900"},"Solicitudes Recibidas"),e("p",{class:"mt-1 text-sm text-gray-600"}," Gestiona todas las solicitudes enviadas por tus clientes ")],-1),Ma=["disabled"],Sa={class:"mb-6 bg-gray-50 rounded-lg p-4"},Ia={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Da=e("label",{for:"status-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Estado ",-1),La=he('<option value="">Todos los estados</option><option value="PENDING">Pendiente</option><option value="IN_REVIEW">En Revisión</option><option value="RESPONDED">Respondida</option><option value="RESOLVED">Resuelta</option><option value="CLOSED">Cerrada</option>',6),ja=[La],Oa=e("label",{for:"priority-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Prioridad ",-1),Na=he('<option value="">Todas las prioridades</option><option value="LOW">Baja</option><option value="MEDIUM">Media</option><option value="HIGH">Alta</option><option value="URGENT">Urgente</option>',5),Aa=[Na],Ua=e("label",{for:"organization-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Organización ",-1),Va=e("option",{value:""},"Todas las organizaciones",-1),Ta=["value"],Ga=e("label",{for:"search",class:"block text-sm font-medium text-gray-700 mb-1"}," Buscar ",-1),Ba={class:"mt-4 flex flex-wrap gap-4 text-sm text-gray-600"},Fa={key:0,class:"flex justify-center items-center py-8"},Ha=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),Wa=e("span",{class:"ml-2 text-gray-600"},"Cargando solicitudes...",-1),Za=[Ha,Wa],Ja={key:1,class:"space-y-4"},Qa={key:0,class:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 mt-6"},Ya={class:"flex flex-1 justify-between sm:hidden"},Xa=["disabled"],Ka=["disabled"],ei={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},ti={class:"text-sm text-gray-700"},si={class:"font-medium"},oi={class:"font-medium"},ai={class:"font-medium"},ii={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},ni=["disabled"],ri=["onClick"],li=["disabled"],ci={key:2,class:"text-center py-12"},di={class:"text-lg font-medium text-gray-900 mb-2"},ui={class:"text-gray-600 mb-6"},gi={key:0},mi={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto"},fi={class:"flex"},hi=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Por qué no hay solicitudes?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Asegúrate de tener organizaciones creadas"),e("p",null,"• Los miembros deben enviar solicitudes a través de tus organizaciones"),e("p",null,"• Las solicitudes aparecerán automáticamente aquí")])],-1),vi={__name:"ReceivedRequestsSection",props:{requests:{type:Array,default:()=>[]},organizations:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["view-detail","status-updated","refresh"],setup(t,{emit:s}){const o=t,n=s,c=S(""),i=S(""),v=S(""),f=S(""),g=S(1),y=S(10),x=I(()=>{let T=[...o.requests];if(c.value&&(T=T.filter(A=>A.status===c.value)),i.value&&(T=T.filter(A=>A.priority===i.value)),v.value&&(T=T.filter(A=>{var C;return((C=A.organization_info)==null?void 0:C.id)===parseInt(v.value)})),f.value.trim()){const A=f.value.toLowerCase().trim();T=T.filter(C=>{var L,N;return C.title.toLowerCase().includes(A)||C.request_number.toLowerCase().includes(A)||((L=C.client_name)==null?void 0:L.toLowerCase().includes(A))||((N=C.description)==null?void 0:N.toLowerCase().includes(A))})}return T.sort((A,C)=>new Date(C.created_at)-new Date(A.created_at))}),w=I(()=>Math.ceil(x.value.length/y.value)),q=I(()=>(g.value-1)*y.value+1),p=I(()=>Math.min(g.value*y.value,x.value.length)),E=I(()=>{const T=(g.value-1)*y.value,A=T+y.value;return x.value.slice(T,A)}),$=I(()=>{const T=[];let C=Math.max(1,g.value-Math.floor(2.5)),L=Math.min(w.value,C+5-1);L-C+1<5&&(C=Math.max(1,L-5+1));for(let N=C;N<=L;N++)T.push(N);return T}),R=I(()=>x.value.filter(T=>T.status==="PENDING").length),P=I(()=>x.value.filter(T=>T.status==="IN_REVIEW").length),b=I(()=>x.value.filter(T=>T.priority==="URGENT").length),h=I(()=>o.requests.length===0?"No has recibido solicitudes":"No se encontraron solicitudes"),m=I(()=>o.requests.length===0?"Cuando tus clientes envíen solicitudes a través de tus organizaciones, aparecerán aquí para que las gestiones.":"No hay solicitudes que coincidan con los filtros seleccionados. Intenta ajustar los criterios de búsqueda."),z=T=>{n("view-detail",T)},D=T=>{n("status-updated",T)},M=()=>{n("refresh")},V=()=>{g.value=1},de=()=>{c.value="",i.value="",v.value="",f.value="",g.value=1};return K(x,()=>{g.value>w.value&&w.value>0&&(g.value=1)}),(T,A)=>(a(),r("div",null,[e("div",Ca,[e("div",Ra,[Pa,e("button",{onClick:M,disabled:t.isLoading,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},[u(d(Pe),{class:F([t.isLoading?"animate-spin":"","h-4 w-4 mr-2"])},null,8,["class"]),_(" Actualizar ")],8,Ma)])]),e("div",Sa,[e("div",Ia,[e("div",null,[Da,G(e("select",{id:"status-filter","onUpdate:modelValue":A[0]||(A[0]=C=>c.value=C),onChange:V,class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},ja,544),[[se,c.value]])]),e("div",null,[Oa,G(e("select",{id:"priority-filter","onUpdate:modelValue":A[1]||(A[1]=C=>i.value=C),onChange:V,class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},Aa,544),[[se,i.value]])]),e("div",null,[Ua,G(e("select",{id:"organization-filter","onUpdate:modelValue":A[2]||(A[2]=C=>v.value=C),onChange:V,class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},[Va,(a(!0),r(Z,null,J(t.organizations,C=>(a(),r("option",{key:C.id,value:C.id},l(C.title),9,Ta))),128))],544),[[se,v.value]])]),e("div",null,[Ga,G(e("input",{id:"search","onUpdate:modelValue":A[3]||(A[3]=C=>f.value=C),onInput:V,type:"text",placeholder:"Buscar por título, cliente...",class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},null,544),[[X,f.value]])])]),e("div",Ba,[e("span",null,[_("Total: "),e("strong",null,l(x.value.length),1)]),e("span",null,[_("Pendientes: "),e("strong",null,l(R.value),1)]),e("span",null,[_("En Revisión: "),e("strong",null,l(P.value),1)]),e("span",null,[_("Urgentes: "),e("strong",null,l(b.value),1)])])]),t.isLoading?(a(),r("div",Fa,Za)):x.value.length>0?(a(),r("div",Ja,[(a(!0),r(Z,null,J(E.value,C=>(a(),B(qa,{key:C.id,request:C,onViewDetail:z,onStatusUpdated:D},null,8,["request"]))),128)),w.value>1?(a(),r("div",Qa,[e("div",Ya,[e("button",{onClick:A[4]||(A[4]=C=>g.value>1&&g.value--),disabled:g.value<=1,class:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50"}," Anterior ",8,Xa),e("button",{onClick:A[5]||(A[5]=C=>g.value<w.value&&g.value++),disabled:g.value>=w.value,class:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50"}," Siguiente ",8,Ka)]),e("div",ei,[e("div",null,[e("p",ti,[_(" Mostrando "),e("span",si,l(q.value),1),_(" a "),e("span",oi,l(p.value),1),_(" de "),e("span",ai,l(x.value.length),1),_(" resultados ")])]),e("div",null,[e("nav",ii,[e("button",{onClick:A[6]||(A[6]=C=>g.value>1&&g.value--),disabled:g.value<=1,class:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50"},[u(d(ut),{class:"h-5 w-5"})],8,ni),(a(!0),r(Z,null,J($.value,C=>(a(),r("button",{key:C,onClick:L=>g.value=C,class:F([C===g.value?"relative z-10 inline-flex items-center bg-blue-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600":"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"])},l(C),11,ri))),128)),e("button",{onClick:A[7]||(A[7]=C=>g.value<w.value&&g.value++),disabled:g.value>=w.value,class:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50"},[u(d(mt),{class:"h-5 w-5"})],8,li)])])])])):k("",!0)])):(a(),r("div",ci,[u(d(Me),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e("h3",di,l(h.value),1),e("p",ui,l(m.value),1),t.requests.length>0?(a(),r("div",gi,[e("button",{onClick:de,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(ie),{class:"h-4 w-4 mr-2"}),_(" Limpiar Filtros ")])])):(a(),r("div",mi,[e("div",fi,[u(d(oe),{class:"h-5 w-5 text-blue-400 mt-0.5"}),hi])]))]))]))}},Ve=De("organizationPosts",{state:()=>({managementPosts:[],publicPosts:[],currentPost:null,isLoading:!1,isLoadingPosts:!1,isCreatingPost:!1,isUpdatingPost:!1,isDeletingPost:!1,pagination:{count:0,next:null,previous:null,currentPage:1,pageSize:10},filters:{is_active:null,is_pinned:null,search:"",page:1,page_size:10}}),getters:{sortedManagementPosts:t=>[...t.managementPosts].sort((s,o)=>s.is_pinned&&!o.is_pinned?-1:!s.is_pinned&&o.is_pinned?1:new Date(o.created_at)-new Date(s.created_at)),sortedPublicPosts:t=>[...t.publicPosts].sort((s,o)=>s.is_pinned&&!o.is_pinned?-1:!s.is_pinned&&o.is_pinned?1:new Date(o.created_at)-new Date(s.created_at)),activePostsCount:t=>t.managementPosts.filter(s=>s.is_active).length,pinnedPostsCount:t=>t.managementPosts.filter(s=>s.is_pinned).length},actions:{async createPost(t,s){try{this.isCreatingPost=!0;const o=await te(`organizations/${t}/posts/create/`,s);if(o.status===201){const n=o.data.post;return this.managementPosts.unshift(n),this.currentPost=n,o.data}throw new Error("Error creating post")}catch(o){throw console.error("Error creating post:",o),o}finally{this.isCreatingPost=!1}},async getManagementPosts(t,s={}){try{this.isLoadingPosts=!0;const o=new URLSearchParams;Object.keys(s).forEach(i=>{s[i]!==null&&s[i]!==void 0&&s[i]!==""&&o.append(i,s[i])});const n=`organizations/${t}/posts/${o.toString()?"?"+o.toString():""}`,c=await W(n);if(c.status===200)return this.managementPosts=c.data.results||c.data,c.data.count!==void 0&&(this.pagination={count:c.data.count,next:c.data.next,previous:c.data.previous,currentPage:s.page||1,pageSize:s.page_size||10}),c.data;throw new Error("Error fetching management posts")}catch(o){throw console.error("Error fetching management posts:",o),o}finally{this.isLoadingPosts=!1}},async getPublicPosts(t,s={}){try{this.isLoadingPosts=!0;const o=new URLSearchParams;Object.keys(s).forEach(i=>{s[i]!==null&&s[i]!==void 0&&s[i]!==""&&o.append(i,s[i])});const n=`organizations/${t}/posts/public/${o.toString()?"?"+o.toString():""}`,c=await W(n);if(c.status===200)return this.publicPosts=c.data.results||c.data,c.data.count!==void 0&&(this.pagination={count:c.data.count,next:c.data.next,previous:c.data.previous,currentPage:s.page||1,pageSize:s.page_size||10}),c.data;throw new Error("Error fetching public posts")}catch(o){throw console.error("Error fetching public posts:",o),o}finally{this.isLoadingPosts=!1}},async getPostDetail(t,s){try{this.isLoading=!0;const o=await W(`organizations/${t}/posts/${s}/`);if(o.status===200){this.currentPost=o.data.post||o.data;const n=this.managementPosts.findIndex(c=>c.id===s);return n>=0&&(this.managementPosts[n]=this.currentPost),o.data}throw new Error("Error fetching post detail")}catch(o){throw console.error("Error fetching post detail:",o),o}finally{this.isLoading=!1}},async updatePost(t,s,o){try{this.isUpdatingPost=!0;const n=await Le(`organizations/${t}/posts/${s}/update/`,o);if(n.status===200){const c=n.data.post||n.data,i=this.managementPosts.findIndex(v=>v.id===s);return i>=0&&(this.managementPosts[i]=c),this.currentPost&&this.currentPost.id===s&&(this.currentPost=c),n.data}throw new Error("Error updating post")}catch(n){throw console.error("Error updating post:",n),n}finally{this.isUpdatingPost=!1}},async deletePost(t,s){try{this.isDeletingPost=!0;const o=await $e(`organizations/${t}/posts/${s}/delete/`);if(o.status===200||o.status===204)return this.managementPosts=this.managementPosts.filter(n=>n.id!==s),this.currentPost&&this.currentPost.id===s&&(this.currentPost=null),o.data||{message:"Post eliminado exitosamente"};throw new Error("Error deleting post")}catch(o){throw console.error("Error deleting post:",o),o}finally{this.isDeletingPost=!1}},async togglePinPost(t,s){try{this.isLoading=!0;const o=await te(`organizations/${t}/posts/${s}/toggle-pin/`,{});if(o.status===200){const n=o.data.post,c=this.managementPosts.findIndex(i=>i.id===s);return c>=0&&(this.managementPosts[c]=n),this.currentPost&&this.currentPost.id===s&&(this.currentPost=n),o.data}throw new Error("Error toggling post pin status")}catch(o){throw console.error("Error toggling post pin status:",o),o}finally{this.isLoading=!1}},async togglePostStatus(t,s){try{this.isLoading=!0;const o=await te(`organizations/${t}/posts/${s}/toggle-status/`,{});if(o.status===200){const n=o.data.post,c=this.managementPosts.findIndex(i=>i.id===s);return c>=0&&(this.managementPosts[c]=n),this.currentPost&&this.currentPost.id===s&&(this.currentPost=n),o.data}throw new Error("Error toggling post status")}catch(o){throw console.error("Error toggling post status:",o),o}finally{this.isLoading=!1}},setFilters(t){this.filters={...this.filters,...t}},clearFilters(){this.filters={is_active:null,is_pinned:null,search:"",page:1,page_size:10}},clearPosts(){this.managementPosts=[],this.publicPosts=[],this.currentPost=null,this.pagination={count:0,next:null,previous:null,currentPage:1,pageSize:10}},clearAll(){this.clearPosts(),this.clearFilters(),this.isLoading=!1,this.isLoadingPosts=!1,this.isCreatingPost=!1,this.isUpdatingPost=!1,this.isDeletingPost=!1}}}),pi={class:"bg-white shadow rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow"},_i={class:"flex items-start justify-between mb-4"},bi={class:"flex-1 min-w-0"},yi={class:"flex items-center space-x-2 mb-2"},xi={class:"text-lg font-semibold text-gray-900 truncate"},wi={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800"},$i={class:"text-sm text-gray-500 mb-3"},Ei={class:"relative"},zi={key:0,class:"absolute right-0 mt-1 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none z-10"},ki={class:"py-1"},qi=e("div",{class:"border-t border-gray-100"},null,-1),Ci={class:"mb-4"},Ri={class:"text-gray-700 whitespace-pre-wrap"},Pi={key:0,class:"mb-4"},Mi=["href"],Si={class:"flex items-center justify-between text-xs text-gray-500 pt-4 border-t border-gray-100"},Ii={class:"flex items-center space-x-4"},Di={class:"flex items-center"},Li={key:0,class:"flex items-center text-yellow-600"},ji={class:"flex items-center space-x-2"},Oi={__name:"CorporatePostCard",props:{post:{type:Object,required:!0},organizationId:{type:Number,required:!0}},emits:["edit","delete","toggle-pin","toggle-status"],setup(t,{emit:s}){const o=t,n=s,c=S(!1),i=()=>{c.value=!1,n("edit",o.post)},v=()=>{c.value=!1,n("delete",o.post)},f=()=>{c.value=!1,n("toggle-pin",o.post)},g=()=>{c.value=!1,n("toggle-status",o.post)},y=w=>new Date(w).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),x=w=>{const q=new Date(w),E=Math.abs(new Date-q),$=Math.ceil(E/(1e3*60*60*24));return $===0?"hoy":$===1?"ayer":$<7?`hace ${$} días`:$<30?`hace ${Math.ceil($/7)} semanas`:`el ${y(w)}`};return(w,q)=>(a(),r("div",pi,[e("div",_i,[e("div",bi,[e("div",yi,[e("h3",xi,l(t.post.title),1),t.post.is_pinned?(a(),r("span",wi,[u(d(pe),{class:"h-3 w-3 mr-1"}),_(" Fijado ")])):k("",!0),e("span",{class:F([t.post.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800","inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"])},l(t.post.is_active?"Activo":"Inactivo"),3)]),e("p",$i," Creado "+l(x(t.post.created_at)),1)]),e("div",Ei,[e("button",{onClick:q[0]||(q[0]=p=>c.value=!c.value),class:"inline-flex items-center p-2 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 rounded-full"},[u(d(ft),{class:"h-5 w-5"})]),c.value?(a(),r("div",zi,[e("div",ki,[e("button",{onClick:i,class:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},[u(d(at),{class:"h-4 w-4 mr-3"}),_(" Editar ")]),e("button",{onClick:f,class:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},[u(d(pe),{class:"h-4 w-4 mr-3"}),_(" "+l(t.post.is_pinned?"Desfijar":"Fijar"),1)]),e("button",{onClick:g,class:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},[(a(),B(et(t.post.is_active?d(bt):d(Re)),{class:"h-4 w-4 mr-3"})),_(" "+l(t.post.is_active?"Desactivar":"Activar"),1)]),qi,e("button",{onClick:v,class:"flex items-center w-full px-4 py-2 text-sm text-red-700 hover:bg-red-50"},[u(d(ht),{class:"h-4 w-4 mr-3"}),_(" Eliminar ")])])])):k("",!0)])]),e("div",Ci,[e("p",Ri,l(t.post.content),1)]),t.post.has_link&&t.post.link_url?(a(),r("div",Pi,[e("a",{href:t.post.link_url,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-3 py-2 border border-blue-300 text-sm font-medium rounded-md text-blue-700 bg-blue-50 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(tt),{class:"h-4 w-4 mr-2"}),_(" "+l(t.post.link_name||"Ver enlace")+" ",1),u(d(Ae),{class:"h-3 w-3 ml-1"})],8,Mi)])):k("",!0),e("div",Si,[e("div",Ii,[e("span",Di,[u(d(ae),{class:"h-3 w-3 mr-1"}),_(" "+l(y(t.post.created_at)),1)]),t.post.is_pinned?(a(),r("span",Li,[u(d(pe),{class:"h-3 w-3 mr-1"}),_(" Fijado ")])):k("",!0)]),e("div",ji,[e("span",{class:F(t.post.is_active?"text-green-600":"text-red-600")},l(t.post.is_active?"Visible para miembros":"Oculto para miembros"),3)])]),c.value?(a(),r("div",{key:1,onClick:q[1]||(q[1]=p=>c.value=!1),class:"fixed inset-0 z-0"})):k("",!0)]))}},Ni=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),Ai={class:"fixed inset-0 z-10 overflow-y-auto"},Ui={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},Vi={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},Ti={class:"mt-1 text-sm text-gray-500"},Gi={key:0,class:"flex justify-center items-center py-8"},Bi=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),Fi={class:"ml-2 text-gray-600"},Hi=e("label",{for:"title",class:"block text-sm font-medium leading-6 text-gray-900"}," Título * ",-1),Wi={class:"mt-2"},Zi={key:0,class:"mt-1 text-sm text-red-600"},Ji=e("label",{for:"content",class:"block text-sm font-medium leading-6 text-gray-900"}," Contenido * ",-1),Qi={class:"mt-2"},Yi=e("p",{class:"mt-1 text-xs text-gray-500"}," Proporciona información clara y útil para los miembros de la organización ",-1),Xi={key:0,class:"mt-1 text-sm text-red-600"},Ki={class:"border-t border-gray-200 pt-6"},en={class:"flex items-center justify-between mb-4"},tn=e("h4",{class:"text-md font-medium text-gray-900"},"Enlace Opcional",-1),sn={key:0,class:"space-y-4"},on=e("label",{for:"link_name",class:"block text-sm font-medium leading-6 text-gray-900"}," Texto del Enlace ",-1),an={class:"mt-2"},nn={key:0,class:"mt-1 text-sm text-red-600"},rn=e("label",{for:"link_url",class:"block text-sm font-medium leading-6 text-gray-900"}," URL del Enlace ",-1),ln={class:"mt-2"},cn=e("p",{class:"mt-1 text-xs text-gray-500"}," Debe incluir http:// o https:// ",-1),dn={key:0,class:"mt-1 text-sm text-red-600"},un=e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-3"},[e("p",{class:"text-sm text-yellow-800"},[e("strong",null,"Nota:"),_(" Si agregas un enlace, tanto el texto como la URL son obligatorios. ")])],-1),gn={class:"border-t border-gray-200 pt-6"},mn=e("h4",{class:"text-md font-medium text-gray-900 mb-4"},"Opciones",-1),fn={class:"space-y-3"},hn={class:"flex items-center"},vn=e("label",{for:"is_pinned",class:"ml-2 text-sm text-gray-700"}," Fijar post (aparecerá en la parte superior) ",-1),pn={key:0,class:"flex items-center"},_n=e("label",{for:"is_active",class:"ml-2 text-sm text-gray-700"}," Post activo (visible para los miembros) ",-1),bn={key:0,class:"border-t border-gray-200 pt-6"},yn=e("h4",{class:"text-md font-medium text-gray-900 mb-4"},"Vista Previa",-1),xn={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},wn={class:"flex items-center space-x-2 mb-2"},$n={class:"text-lg font-semibold text-gray-900"},En={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800"},zn={class:"text-gray-700 whitespace-pre-wrap mb-3"},kn={key:0,class:"inline-flex items-center px-3 py-2 border border-blue-300 text-sm font-medium rounded-md text-blue-700 bg-blue-50"},qn={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},Cn=["disabled"],Rn={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Pn={__name:"PostFormModal",props:{visible:{type:Boolean,default:!1},post:{type:Object,default:null},organizationId:{type:Number,required:!0}},emits:["close","saved"],setup(t,{emit:s}){const o=t,n=s,c=Ve(),i=S(!1),v=S({}),f=S(!1),g=S({title:"",content:"",link_name:"",link_url:"",is_pinned:!1,is_active:!0}),y=I(()=>!!o.post),x=I(()=>{const E=g.value.title.trim(),$=g.value.content.trim(),R=!g.value.link_name&&!g.value.link_url||g.value.link_name.trim()&&g.value.link_url.trim();return E&&$&&R}),w=()=>{o.post?(g.value={title:o.post.title||"",content:o.post.content||"",link_name:o.post.link_name||"",link_url:o.post.link_url||"",is_pinned:o.post.is_pinned||!1,is_active:o.post.is_active!==void 0?o.post.is_active:!0},f.value=!!(o.post.link_name||o.post.link_url)):(g.value={title:"",content:"",link_name:"",link_url:"",is_pinned:!1,is_active:!0},f.value=!1),v.value={}},q=async()=>{var E,$,R,P;try{i.value=!0,v.value={};const b=g.value.link_name.trim(),h=g.value.link_url.trim();if(b&&!h||!b&&h){j("Si agregas un enlace, tanto el texto como la URL son obligatorios","warning");return}const m={title:g.value.title.trim(),content:g.value.content.trim(),is_pinned:g.value.is_pinned};b&&h&&(m.link_name=g.value.link_name.trim(),m.link_url=g.value.link_url.trim()),y.value&&(m.is_active=g.value.is_active);let z;y.value?(z=await c.updatePost(o.organizationId,o.post.id,m),j("Post actualizado exitosamente","success")):(z=await c.createPost(o.organizationId,m),j("Post creado exitosamente","success")),n("saved",z)}catch(b){console.error("Error saving post:",b),($=(E=b.response)==null?void 0:E.data)!=null&&$.details?v.value=b.response.data.details:(P=(R=b.response)==null?void 0:R.data)!=null&&P.error?j(b.response.data.error,"error"):j(`Error al ${y.value?"actualizar":"crear"} el post`,"error")}finally{i.value=!1}},p=()=>{i.value||n("close")};return K(()=>o.visible,E=>{E&&be(()=>{w()})}),K(()=>o.post,()=>{o.visible&&w()}),(E,$)=>(a(),B(d(fe),{as:"template",show:t.visible},{default:U(()=>[u(d(ue),{class:"relative z-50",onClose:p},{default:U(()=>[u(d(ee),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:U(()=>[Ni]),_:1}),e("div",Ai,[e("div",Ui,[u(d(ee),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:U(()=>[u(d(ge),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6"},{default:U(()=>[e("div",Vi,[e("div",null,[u(d(me),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:U(()=>[_(l(y.value?"Editar Post":"Crear Nuevo Post"),1)]),_:1}),e("p",Ti,l(y.value?"Modifica la información del post":"Comparte información importante con los miembros"),1)]),e("button",{onClick:p,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(d(ie),{class:"h-6 w-6"})])]),i.value?(a(),r("div",Gi,[Bi,e("span",Fi,l(y.value?"Actualizando...":"Creando..."),1)])):(a(),r("form",{key:1,onSubmit:le(q,["prevent"]),class:"space-y-6"},[e("div",null,[Hi,e("div",Wi,[G(e("input",{id:"title","onUpdate:modelValue":$[0]||($[0]=R=>g.value.title=R),type:"text",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ej: Anuncio importante sobre nuevas políticas"},null,512),[[X,g.value.title]])]),v.value.title?(a(),r("p",Zi,l(v.value.title[0]),1)):k("",!0)]),e("div",null,[Ji,e("div",Qi,[G(e("textarea",{id:"content","onUpdate:modelValue":$[1]||($[1]=R=>g.value.content=R),rows:"5",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Escribe el contenido del post..."},null,512),[[X,g.value.content]])]),Yi,v.value.content?(a(),r("p",Xi,l(v.value.content[0]),1)):k("",!0)]),e("div",Ki,[e("div",en,[tn,e("button",{type:"button",onClick:$[2]||($[2]=R=>f.value=!f.value),class:"text-sm text-blue-600 hover:text-blue-800 font-medium"},l(f.value?"Ocultar enlace":"Agregar enlace"),1)]),f.value?(a(),r("div",sn,[e("div",null,[on,e("div",an,[G(e("input",{id:"link_name","onUpdate:modelValue":$[3]||($[3]=R=>g.value.link_name=R),type:"text",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ej: Ver documento completo"},null,512),[[X,g.value.link_name]])]),v.value.link_name?(a(),r("p",nn,l(v.value.link_name[0]),1)):k("",!0)]),e("div",null,[rn,e("div",ln,[G(e("input",{id:"link_url","onUpdate:modelValue":$[4]||($[4]=R=>g.value.link_url=R),type:"url",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"https://ejemplo.com/documento"},null,512),[[X,g.value.link_url]])]),cn,v.value.link_url?(a(),r("p",dn,l(v.value.link_url[0]),1)):k("",!0)]),un])):k("",!0)]),e("div",gn,[mn,e("div",fn,[e("div",hn,[G(e("input",{id:"is_pinned","onUpdate:modelValue":$[5]||($[5]=R=>g.value.is_pinned=R),type:"checkbox",class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[Ie,g.value.is_pinned]]),vn]),y.value?(a(),r("div",pn,[G(e("input",{id:"is_active","onUpdate:modelValue":$[6]||($[6]=R=>g.value.is_active=R),type:"checkbox",class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[Ie,g.value.is_active]]),_n])):k("",!0)])]),g.value.title||g.value.content?(a(),r("div",bn,[yn,e("div",xn,[e("div",wn,[e("h5",$n,l(g.value.title||"Título del post"),1),g.value.is_pinned?(a(),r("span",En," Fijado ")):k("",!0)]),e("p",zn,l(g.value.content||"Contenido del post..."),1),g.value.link_name&&g.value.link_url?(a(),r("div",kn,[_(l(g.value.link_name)+" ",1),u(d(Ae),{class:"h-3 w-3 ml-1"})])):k("",!0)])])):k("",!0),e("div",qn,[e("button",{type:"button",onClick:p,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value||!x.value,class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),r("div",Rn)):(a(),B(d(Ne),{key:1,class:"h-4 w-4 mr-2"})),_(" "+l(i.value?y.value?"Actualizando...":"Creando...":y.value?"Actualizar Post":"Crear Post"),1)],8,Cn)])],32))]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},Mn=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),Sn={class:"fixed inset-0 z-10 overflow-y-auto"},In={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},Dn={class:"sm:flex sm:items-start"},Ln={class:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left"},jn={class:"mt-2"},On={class:"text-sm text-gray-500"},Nn={class:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},An=["disabled"],Un={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Vn=["disabled"],lt={__name:"ConfirmationModal",props:{visible:{type:Boolean,default:!1},title:{type:String,required:!0},message:{type:String,required:!0},confirmText:{type:String,default:"Confirmar"},cancelText:{type:String,default:"Cancelar"},confirmColor:{type:String,default:"yellow",validator:t=>["red","yellow"].includes(t)},isLoading:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:s}){const o=t,n=s,c=()=>{o.isLoading||n("confirm")},i=()=>{o.isLoading||n("cancel")};return(v,f)=>(a(),B(d(fe),{as:"template",show:t.visible},{default:U(()=>[u(d(ue),{class:"relative z-50",onClose:i},{default:U(()=>[u(d(ee),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:U(()=>[Mn]),_:1}),e("div",Sn,[e("div",In,[u(d(ee),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:U(()=>[u(d(ge),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"},{default:U(()=>[e("div",Dn,[e("div",{class:F(["mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full sm:mx-0 sm:h-10 sm:w-10",t.confirmColor==="red"?"bg-red-100":"bg-yellow-100"])},[u(d(vt),{class:F(["h-6 w-6",t.confirmColor==="red"?"text-red-600":"text-yellow-600"])},null,8,["class"])],2),e("div",Ln,[u(d(me),{as:"h3",class:"text-base font-semibold leading-6 text-gray-900"},{default:U(()=>[_(l(t.title),1)]),_:1}),e("div",jn,[e("p",On,l(t.message),1)])])]),e("div",Nn,[e("button",{type:"button",onClick:c,disabled:t.isLoading,class:F(["inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",t.confirmColor==="red"?"bg-red-600 hover:bg-red-500 focus-visible:outline-red-600":"bg-yellow-600 hover:bg-yellow-500 focus-visible:outline-yellow-600"])},[t.isLoading?(a(),r("div",Un)):k("",!0),_(" "+l(t.isLoading?"Procesando...":t.confirmText),1)],10,An),e("button",{type:"button",onClick:i,disabled:t.isLoading,class:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed"},l(t.cancelText),9,Vn)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},Tn={class:"mb-6"},Gn={class:"flex items-center justify-between"},Bn=e("div",null,[e("h2",{class:"text-lg font-medium text-gray-900"},"Posts de la Organización"),e("p",{class:"mt-1 text-sm text-gray-600"}," Comparte anuncios e información importante con los miembros ")],-1),Fn={class:"flex space-x-3"},Hn=["disabled"],Wn={key:0,class:"flex justify-center items-center py-8"},Zn=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),Jn=e("span",{class:"ml-2 text-gray-600"},"Cargando posts...",-1),Qn=[Zn,Jn],Yn={key:1,class:"space-y-4"},Xn={key:2,class:"text-center py-12"},Kn={class:"text-lg font-medium text-gray-900 mb-2"},er={class:"text-gray-600 mb-6"},tr={key:0},sr={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto mt-6"},or={class:"flex"},ar=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Cómo usar los posts?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Comparte anuncios importantes con tu equipo"),e("p",null,"• Incluye enlaces a documentos o recursos"),e("p",null,"• Fija posts importantes para mantenerlos arriba"),e("p",null,"• Activa/desactiva posts según sea necesario")])],-1),ir={__name:"OrganizationPostsSection",props:{organizationId:{type:Number,required:!0}},setup(t){const s=t,o=Ve(),n=S(!1),c=S(!1),i=S(null),v=I(()=>o.isLoadingPosts),f=I(()=>o.managementPosts),g=I(()=>o.sortedManagementPosts),y=I(()=>"No hay posts creados"),x=I(()=>"Crea tu primer post para compartir información importante con los miembros de tu organización."),w=async()=>{try{await o.getManagementPosts(s.organizationId)}catch(z){console.error("Error loading posts:",z),j("Error al cargar los posts","error")}},q=()=>{w()},p=()=>{i.value=null,n.value=!0},E=()=>{n.value=!1,i.value=null},$=z=>{i.value=z,n.value=!0},R=z=>{i.value=z,c.value=!0},P=async()=>{try{await o.deletePost(s.organizationId,i.value.id),j(`Post "${i.value.title}" eliminado exitosamente`,"success"),c.value=!1,i.value=null}catch(z){console.error("Error deleting post:",z),j("Error al eliminar el post","error")}},b=async z=>{try{await o.togglePinPost(s.organizationId,z.id);const D=z.is_pinned?"desfijado":"fijado";j(`Post ${D} exitosamente`,"success")}catch(D){console.error("Error toggling pin:",D),j("Error al cambiar el estado de fijado","error")}},h=async z=>{try{await o.togglePostStatus(s.organizationId,z.id);const D=z.is_active?"desactivado":"activado";j(`Post ${D} exitosamente`,"success")}catch(D){console.error("Error toggling status:",D),j("Error al cambiar el estado del post","error")}},m=()=>{E(),w()};return ve(()=>{w()}),K(()=>s.organizationId,()=>{s.organizationId&&w()}),(z,D)=>{var M;return a(),r("div",null,[e("div",Tn,[e("div",Gn,[Bn,e("div",Fn,[e("button",{onClick:q,disabled:v.value,class:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},[u(d(Pe),{class:F([v.value?"animate-spin":"","h-4 w-4 mr-2"])},null,8,["class"]),_(" Actualizar ")],8,Hn),e("button",{onClick:p,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(re),{class:"h-4 w-4 mr-2"}),_(" Nuevo Post ")])])])]),v.value?(a(),r("div",Wn,Qn)):g.value.length>0?(a(),r("div",Yn,[(a(!0),r(Z,null,J(g.value,V=>(a(),B(Oi,{key:V.id,post:V,"organization-id":t.organizationId,onEdit:$,onDelete:R,onTogglePin:b,onToggleStatus:h},null,8,["post","organization-id"]))),128))])):(a(),r("div",Xn,[u(d(Ne),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e("h3",Kn,l(y.value),1),e("p",er,l(x.value),1),f.value.length===0?(a(),r("div",tr,[e("button",{onClick:p,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(re),{class:"h-4 w-4 mr-2"}),_(" Crear Primer Post ")]),e("div",sr,[e("div",or,[u(d(oe),{class:"h-5 w-5 text-blue-400 mt-0.5"}),ar])])])):k("",!0)])),u(Pn,{visible:n.value,post:i.value,"organization-id":t.organizationId,onClose:E,onSaved:m},null,8,["visible","post","organization-id"]),u(lt,{visible:c.value,title:`¿Eliminar post '${(M=i.value)==null?void 0:M.title}'?`,message:"Esta acción no se puede deshacer. El post será eliminado permanentemente.","confirm-text":"Sí, eliminar","confirm-color":"red","is-loading":d(o).isDeletingPost,onConfirm:P,onCancel:D[0]||(D[0]=V=>c.value=!1)},null,8,["visible","title","is-loading"])])}}},nr={class:"px-4 py-6 sm:px-6 lg:px-8"},rr={key:0,class:"flex justify-center items-center py-12"},lr=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),cr=e("span",{class:"ml-2 text-gray-600"},"Cargando datos...",-1),dr=[lr,cr],ur={key:1,class:"text-center py-12"},gr={class:"mx-auto max-w-md"},mr=e("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"})],-1),fr=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Acceso Restringido",-1),hr=e("p",{class:"mt-1 text-sm text-gray-500"}," Este dashboard es solo para clientes corporativos. ",-1),vr={class:"mt-2 text-xs text-gray-400"},pr={key:2},_r=e("div",{class:"mb-8"},[e("div",{class:"sm:flex sm:items-center sm:justify-between"},[e("div",null,[e("h1",{class:"text-2xl font-bold leading-6 text-gray-900"}," Panel Corporativo "),e("p",{class:"mt-2 text-sm text-gray-700"}," Gestiona tus organizaciones y solicitudes corporativas ")])])],-1),br={class:"mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4"},yr={class:"bg-white overflow-hidden shadow rounded-lg"},xr={class:"p-5"},wr={class:"flex items-center"},$r={class:"flex-shrink-0"},Er={class:"ml-5 w-0 flex-1"},zr=e("dt",{class:"text-sm font-medium text-gray-500 truncate"}," Organizaciones ",-1),kr={class:"text-lg font-medium text-gray-900"},qr={class:"bg-white overflow-hidden shadow rounded-lg"},Cr={class:"p-5"},Rr={class:"flex items-center"},Pr={class:"flex-shrink-0"},Mr={class:"ml-5 w-0 flex-1"},Sr=e("dt",{class:"text-sm font-medium text-gray-500 truncate"}," Miembros Totales ",-1),Ir={class:"text-lg font-medium text-gray-900"},Dr={class:"bg-white overflow-hidden shadow rounded-lg"},Lr={class:"p-5"},jr={class:"flex items-center"},Or={class:"flex-shrink-0"},Nr={class:"ml-5 w-0 flex-1"},Ar=e("dt",{class:"text-sm font-medium text-gray-500 truncate"}," Invitaciones Pendientes ",-1),Ur={class:"text-lg font-medium text-gray-900"},Vr={class:"bg-white overflow-hidden shadow rounded-lg"},Tr={class:"p-5"},Gr={class:"flex items-center"},Br={class:"flex-shrink-0"},Fr={class:"ml-5 w-0 flex-1"},Hr=e("dt",{class:"text-sm font-medium text-gray-500 truncate"}," Total Solicitudes ",-1),Wr={class:"text-lg font-medium text-gray-900"},Zr={class:"space-y-6"},Jr={class:"relative h-48 bg-gradient-to-r from-blue-500 to-purple-600"},Qr=["src","alt"],Yr=e("div",{class:"absolute inset-0 bg-black bg-opacity-30"},null,-1),Xr={class:"absolute bottom-4 left-6"},Kr={class:"relative"},el=["src","alt"],tl={class:"absolute top-4 right-4"},sl=["onClick"],ol={class:"px-6 py-4"},al={class:"flex items-start justify-between"},il={class:"flex-1"},nl={class:"text-xl font-semibold text-gray-900 mb-2"},rl={class:"text-gray-600 mb-4"},ll={class:"flex items-center space-x-6 text-sm text-gray-500 mb-4"},cl={class:"flex items-center"},dl={class:"flex items-center"},ul={class:"flex items-center"},gl={class:"flex space-x-2 ml-4"},ml=["onClick"],fl={key:0,class:"text-center py-12"},hl=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," No tienes organizaciones creadas ",-1),vl=e("p",{class:"text-gray-600 mb-6"}," Crea tu primera organización para empezar a recibir solicitudes de clientes. ",-1),pl={class:"mt-8"},_l={__name:"CorporateClientDashboard",setup(t){const s=ce(),o=Se(),n=qe(),c=Oe(),i=S(!1),v=S(!1),f=S(!1),g=S(null),y=I(()=>s.isLoading||o.isLoadingRequests),x=I(()=>s.organizations),w=I(()=>s.organizationStats),q=I(()=>o.receivedRequests),p=I(()=>{var C;return((C=n.currentUser)==null?void 0:C.role)==="corporate_client"}),E=async()=>{var C,L,N;try{const O=(C=n.currentUser)==null?void 0:C.role;if(!O){console.error("User role not available");return}if(O!=="corporate_client"){console.error("User is not a corporate client, cannot load corporate dashboard data");return}console.log("Loading corporate client dashboard data..."),await Promise.all([s.getMyOrganizations(),s.getOrganizationStats(),o.getReceivedRequests({page_size:50})]),console.log("Dashboard data loaded successfully")}catch(O){console.error("Error loading dashboard data:",O),((L=O.response)==null?void 0:L.status)===403?console.error("Access denied. User may not have corporate client permissions."):((N=O.response)==null?void 0:N.status)===401&&console.error("Authentication error. User may need to log in again.")}},$=C=>{g.value=C,v.value=!0},R=()=>{v.value=!1,g.value=null},P=C=>{g.value=C,f.value=!0},b=()=>{f.value=!1,g.value=null},h=()=>{i.value=!0},m=()=>{i.value=!1},z=C=>{m(),Promise.all([s.getMyOrganizations(),s.getOrganizationStats()])},D=C=>{R(),s.getMyOrganizations()},M=C=>{b(),s.getOrganizationStats()},V=C=>{c.push({name:"organizations_dashboard",query:{tab:"request-detail",id:C}})},de=()=>{o.getReceivedRequests({page_size:50})},T=async C=>{try{await o.updateReceivedRequest(C.requestId,{status:C.newStatus}),de()}catch(L){console.error("Error updating request status:",L)}},A=C=>new Date(C).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"});return ve(async()=>{var N;console.log("CorporateClientDashboard mounted"),n.currentUser||(console.log("Waiting for user data to be available..."),await n.init());const C=(N=n.currentUser)==null?void 0:N.role,L=JSON.parse(localStorage.getItem("userAuth")||"{}");console.log("Current user role (from store):",C),console.log("Current user role (from localStorage):",L.role),console.log("Current user data:",n.currentUser),console.log("LocalStorage userAuth:",L),C==="corporate_client"?E():(console.error("User does not have corporate_client role."),console.error("Store role:",C),console.error("LocalStorage role:",L.role),console.error("Available roles should be: client, corporate_client, lawyer"))}),(C,L)=>{var N;return a(),r("div",nr,[y.value?(a(),r("div",rr,dr)):p.value?(a(),r("div",pr,[_r,e("div",br,[e("div",yr,[e("div",xr,[e("div",wr,[e("div",$r,[u(d(_e),{class:"h-6 w-6 text-gray-400"})]),e("div",Er,[e("dl",null,[zr,e("dd",kr,l(w.value.total_organizations),1)])])])])]),e("div",qr,[e("div",Cr,[e("div",Rr,[e("div",Pr,[u(d(Ee),{class:"h-6 w-6 text-gray-400"})]),e("div",Mr,[e("dl",null,[Sr,e("dd",Ir,l(w.value.total_members),1)])])])])]),e("div",Dr,[e("div",Lr,[e("div",jr,[e("div",Or,[u(d(ze),{class:"h-6 w-6 text-gray-400"})]),e("div",Nr,[e("dl",null,[Ar,e("dd",Ur,l(w.value.total_pending_invitations),1)])])])])]),e("div",Vr,[e("div",Tr,[e("div",Gr,[e("div",Br,[u(d(Me),{class:"h-6 w-6 text-gray-400"})]),e("div",Fr,[e("dl",null,[Hr,e("dd",Wr,l(q.value.length),1)])])])])])])])):(a(),r("div",ur,[e("div",gr,[mr,fr,hr,e("p",vr," Tu rol actual: "+l(((N=d(n).currentUser)==null?void 0:N.role)||"Sin definir"),1)])])),e("div",Zr,[(a(!0),r(Z,null,J(x.value,O=>(a(),r("div",{key:O.id,class:"bg-white shadow rounded-lg overflow-hidden"},[e("div",Jr,[O.cover_image_url?(a(),r("img",{key:0,src:O.cover_image_url,alt:`Portada de ${O.title}`,class:"w-full h-full object-cover"},null,8,Qr)):k("",!0),Yr,e("div",Xr,[e("div",Kr,[e("img",{src:O.profile_image_url||"/src/assets/images/user_avatar.jpg",alt:`Logo de ${O.title}`,class:"h-20 w-20 rounded-full border-4 border-white object-cover bg-white"},null,8,el)])]),e("div",tl,[e("button",{onClick:Y=>$(O),class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-black bg-opacity-50 hover:bg-opacity-70 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(d(at),{class:"h-4 w-4 mr-1"}),_(" Editar ")],8,sl)])]),e("div",ol,[e("div",al,[e("div",il,[e("h3",nl,l(O.title),1),e("p",rl,l(O.description),1),e("div",ll,[e("div",cl,[u(d(Ee),{class:"h-4 w-4 mr-1"}),_(" "+l(O.member_count)+" miembros ",1)]),e("div",dl,[u(d(ze),{class:"h-4 w-4 mr-1"}),_(" "+l(O.pending_invitations_count)+" invitaciones pendientes ",1)]),e("div",ul,[u(d(ae),{class:"h-4 w-4 mr-1"}),_(" Creada "+l(A(O.created_at)),1)])])]),e("div",gl,[e("button",{onClick:Y=>P(O),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(d(nt),{class:"h-4 w-4 mr-2"}),_(" Invitar Miembro ")],8,ml)])])])]))),128)),x.value.length===0?(a(),r("div",fl,[u(d(_e),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),hl,vl,e("button",{onClick:h,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(re),{class:"h-4 w-4 mr-2"}),_(" Crear Organización ")])])):k("",!0)]),(a(!0),r(Z,null,J(x.value,O=>(a(),r("div",{key:`posts-${O.id}`,class:"mt-8"},[u(ir,{"organization-id":O.id},null,8,["organization-id"])]))),128)),e("div",pl,[u(vi,{requests:q.value,organizations:x.value,"is-loading":d(o).isLoadingRequests,onViewDetail:V,onStatusUpdated:T,onRefresh:de},null,8,["requests","organizations","is-loading"])]),u(ws,{visible:i.value,onClose:m,onCreated:z},null,8,["visible"]),u(uo,{visible:v.value,organization:g.value,onClose:R,onUpdated:D},null,8,["visible","organization"]),u(Jo,{visible:f.value,organization:g.value,onClose:b,onInvited:M},null,8,["visible","organization"])])}}},ct=t=>(ye("data-v-82caa1b7"),t=t(),xe(),t),bl={class:"bg-white shadow rounded-lg border border-gray-200 overflow-hidden hover:shadow-md transition-shadow"},yl={class:"relative h-32 bg-gradient-to-r from-blue-500 to-purple-600"},xl=["src","alt"],wl=ct(()=>e("div",{class:"absolute inset-0 bg-black bg-opacity-30"},null,-1)),$l={class:"absolute bottom-3 left-4"},El=["src","alt"],zl={class:"absolute top-3 right-3"},kl={class:"p-6"},ql={class:"mb-4"},Cl={class:"text-lg font-semibold text-gray-900 mb-1"},Rl={class:"text-sm text-gray-600 mb-3 line-clamp-2"},Pl={class:"flex items-center space-x-4 text-xs text-gray-500"},Ml={class:"flex items-center"},Sl={class:"flex items-center"},Il={class:"mb-4 p-3 bg-gray-50 rounded-lg"},Dl={class:"flex items-start space-x-3"},Ll=["src","alt"],jl={class:"flex-1 min-w-0"},Ol={class:"text-sm font-medium text-gray-900"},Nl={class:"text-xs text-gray-500 mb-2"},Al={class:"text-sm text-gray-700 italic"},Ul={key:0,class:"mb-4"},Vl={key:0},Tl={key:1},Gl={key:1,class:"flex space-x-3"},Bl=["disabled"],Fl={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Hl=["disabled"],Wl={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600 mr-2"},Zl={key:2,class:"text-center py-2"},Jl={class:"text-sm text-gray-600"},Ql={key:3,class:"text-center py-2"},Yl=ct(()=>e("p",{class:"text-sm text-gray-500"}," Esta invitación ha expirado ",-1)),Xl=[Yl],Kl={__name:"InvitationCard",props:{invitation:{type:Object,required:!0}},emits:["responded"],setup(t,{emit:s}){const o=t,n=s,c=ce(),i=S(!1),v=S(null),f=I(()=>o.invitation.can_be_responded&&!o.invitation.is_expired&&o.invitation.status==="PENDING"),g=I(()=>{if(!o.invitation.expires_at)return!1;const b=(new Date(o.invitation.expires_at)-new Date)/(1e3*60*60*24);return b<=7&&b>0}),y=I(()=>o.invitation.organization_info.profile_image_url||"/src/assets/images/user_avatar.jpg"),x=async $=>{var R,P;try{i.value=!0,v.value=$;const b=await c.respondToInvitation(o.invitation.id,$);j(`Invitación ${$==="accept"?"aceptada":"rechazada"} exitosamente`,"success"),n("responded",b.invitation)}catch(b){console.error("Error responding to invitation:",b),(P=(R=b.response)==null?void 0:R.data)!=null&&P.error?j(b.response.data.error,"error"):j("Error al responder la invitación","error")}finally{i.value=!1,v.value=null}},w=$=>({PENDING:"Pendiente",ACCEPTED:"Aceptada",REJECTED:"Rechazada",EXPIRED:"Expirada",CANCELLED:"Cancelada"})[$]||$,q=$=>({PENDING:"bg-yellow-100 text-yellow-800",ACCEPTED:"bg-green-100 text-green-800",REJECTED:"bg-red-100 text-red-800",EXPIRED:"bg-gray-100 text-gray-800",CANCELLED:"bg-gray-100 text-gray-800"})[$]||"bg-gray-100 text-gray-800",p=$=>new Date($).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),E=$=>{const R=new Date($),b=Math.abs(new Date-R),h=Math.ceil(b/(1e3*60*60*24));return h===0?"hoy":h===1?"hace 1 día":h<7?`hace ${h} días`:h<30?`hace ${Math.ceil(h/7)} semanas`:p($)};return($,R)=>(a(),r("div",bl,[e("div",yl,[t.invitation.organization_info.cover_image_url?(a(),r("img",{key:0,src:t.invitation.organization_info.cover_image_url,alt:`Portada de ${t.invitation.organization_info.title}`,class:"w-full h-full object-cover"},null,8,xl)):k("",!0),wl,e("div",$l,[e("img",{src:t.invitation.organization_info.profile_image_url||"/src/assets/images/user_avatar.jpg",alt:`Logo de ${t.invitation.organization_info.title}`,class:"h-12 w-12 rounded-full border-2 border-white object-cover bg-white"},null,8,El)]),e("div",zl,[e("span",{class:F([q(t.invitation.status),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(w(t.invitation.status)),3)])]),e("div",kl,[e("div",ql,[e("h3",Cl,l(t.invitation.organization_info.title),1),e("p",Rl,l(t.invitation.organization_info.description),1),e("div",Pl,[e("div",Ml,[u(d(Ee),{class:"h-3 w-3 mr-1"}),_(" "+l(t.invitation.organization_info.member_count)+" miembros ",1)]),e("div",Sl,[u(d(ae),{class:"h-3 w-3 mr-1"}),_(" "+l(p(t.invitation.created_at)),1)])])]),e("div",Il,[e("div",Dl,[e("img",{src:y.value,alt:`Avatar de ${t.invitation.invited_by_info.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,Ll),e("div",jl,[e("p",Ol,l(t.invitation.invited_by_info.full_name),1),e("p",Nl,l(t.invitation.invited_by_info.email),1),e("p",Al,' "'+l(t.invitation.message||"Te invita a unirte a esta organización.")+'" ',1)])])]),t.invitation.expires_at?(a(),r("div",Ul,[e("div",{class:F(["flex items-center text-xs",g.value?"text-orange-600":"text-gray-500"])},[u(d(je),{class:"h-3 w-3 mr-1"}),t.invitation.is_expired?(a(),r("span",Vl," Expiró "+l(E(t.invitation.expires_at)),1)):(a(),r("span",Tl," Expira "+l(E(t.invitation.expires_at)),1))],2)])):k("",!0),f.value?(a(),r("div",Gl,[e("button",{onClick:R[0]||(R[0]=P=>x("accept")),disabled:i.value,class:"flex-1 inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[i.value&&v.value==="accept"?(a(),r("div",Fl)):(a(),B(d(ot),{key:1,class:"h-4 w-4 mr-2"})),_(" "+l(i.value&&v.value==="accept"?"Aceptando...":"Aceptar"),1)],8,Bl),e("button",{onClick:R[1]||(R[1]=P=>x("reject")),disabled:i.value,class:"flex-1 inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[i.value&&v.value==="reject"?(a(),r("div",Wl)):(a(),B(d(ie),{key:1,class:"h-4 w-4 mr-2"})),_(" "+l(i.value&&v.value==="reject"?"Rechazando...":"Rechazar"),1)],8,Hl)])):t.invitation.responded_at?(a(),r("div",Zl,[e("p",Jl," Respondiste "+l(E(t.invitation.responded_at)),1)])):(a(),r("div",Ql,Xl))])]))}},ec=we(Kl,[["__scopeId","data-v-82caa1b7"]]),tc=e("div",{class:"mb-6"},[e("h2",{class:"text-lg font-medium text-gray-900"},"Invitaciones Recibidas"),e("p",{class:"mt-1 text-sm text-gray-600"}," Revisa y responde a las invitaciones de organizaciones ")],-1),sc={key:0,class:"flex justify-center items-center py-8"},oc=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),ac=e("span",{class:"ml-2 text-gray-600"},"Cargando invitaciones...",-1),ic=[oc,ac],nc={key:1,class:"space-y-4"},rc={key:2,class:"text-center py-12"},lc=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," No tienes invitaciones ",-1),cc=e("p",{class:"text-gray-600 mb-6"}," Cuando recibas invitaciones de organizaciones, aparecerán aquí para que puedas responderlas. ",-1),dc={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto"},uc={class:"flex"},gc=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Cómo recibir invitaciones?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Los clientes corporativos pueden invitarte a sus organizaciones"),e("p",null,"• Solo necesitan tu email registrado en la plataforma"),e("p",null,"• Las invitaciones aparecerán automáticamente aquí")])],-1),mc={__name:"InvitationsSection",props:{invitations:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["invitation-responded"],setup(t,{emit:s}){const o=s,n=c=>{o("invitation-responded",c)};return(c,i)=>(a(),r("div",null,[tc,t.isLoading?(a(),r("div",sc,ic)):t.invitations.length>0?(a(),r("div",nc,[(a(!0),r(Z,null,J(t.invitations,v=>(a(),B(ec,{key:v.id,invitation:v,onResponded:n},null,8,["invitation"]))),128))])):(a(),r("div",rc,[u(d(ze),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),lc,cc,e("div",dc,[e("div",uc,[u(d(oe),{class:"h-5 w-5 text-blue-400 mt-0.5"}),gc])])]))]))}},dt=t=>(ye("data-v-c30f16d3"),t=t(),xe(),t),fc={class:"bg-white shadow rounded-lg border border-gray-200 overflow-hidden hover:shadow-md transition-shadow"},hc={class:"relative h-32 bg-gradient-to-r from-blue-500 to-purple-600"},vc=["src","alt"],pc=dt(()=>e("div",{class:"absolute inset-0 bg-black bg-opacity-30"},null,-1)),_c={class:"absolute bottom-3 left-4"},bc=["src","alt"],yc={class:"absolute top-3 right-3"},xc={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},wc={class:"p-4"},$c={class:"mb-4"},Ec={class:"text-lg font-semibold text-gray-900 mb-1"},zc={class:"text-sm text-gray-600 mb-3 line-clamp-2"},kc={class:"flex items-center space-x-4 text-xs text-gray-500 mb-3"},qc={class:"flex items-center"},Cc={class:"flex items-center"},Rc={class:"mb-4 p-3 bg-gray-50 rounded-lg"},Pc=dt(()=>e("p",{class:"text-xs text-gray-500 mb-1"},"Líder de la organización",-1)),Mc={class:"flex items-center space-x-2"},Sc=["src","alt"],Ic={class:"text-sm font-medium text-gray-900"},Dc={class:"text-xs text-gray-500"},Lc={class:"space-y-2"},jc={class:"flex space-x-2"},Oc={__name:"OrganizationCard",props:{organization:{type:Object,required:!0}},emits:["left","create-request"],setup(t,{emit:s}){const o=t,n=s,c=ce(),i=S(!1),v=S(!1),f=()=>{n("create-request",o.organization.id)},g=()=>{console.log("View organization details:",o.organization.id)},y=async()=>{var w,q;try{v.value=!0,await c.leaveOrganization(o.organization.id),j(`Has abandonado ${o.organization.title}`,"success"),i.value=!1,n("left",o.organization.id)}catch(p){console.error("Error leaving organization:",p),(q=(w=p.response)==null?void 0:w.data)!=null&&q.error?j(p.response.data.error,"error"):j("Error al abandonar la organización","error")}finally{v.value=!1}},x=w=>new Date(w).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"});return(w,q)=>(a(),r("div",fc,[e("div",hc,[t.organization.cover_image_url?(a(),r("img",{key:0,src:t.organization.cover_image_url,alt:`Portada de ${t.organization.title}`,class:"w-full h-full object-cover"},null,8,vc)):k("",!0),pc,e("div",_c,[e("img",{src:t.organization.profile_image_url||"/src/assets/images/user_avatar.jpg",alt:`Logo de ${t.organization.title}`,class:"h-12 w-12 rounded-full border-2 border-white object-cover bg-white"},null,8,bc)]),e("div",yc,[e("span",xc,[u(d(ot),{class:"h-3 w-3 mr-1"}),_(" Miembro ")])])]),e("div",wc,[e("div",$c,[e("h3",Ec,l(t.organization.title),1),e("p",zc,l(t.organization.description),1),e("div",kc,[e("div",qc,[u(d(Ee),{class:"h-3 w-3 mr-1"}),_(" "+l(t.organization.member_count)+" miembros ",1)]),e("div",Cc,[u(d(ae),{class:"h-3 w-3 mr-1"}),_(" Miembro desde "+l(x(t.organization.joined_at)),1)])])]),e("div",Rc,[Pc,e("div",Mc,[e("img",{src:t.organization.profile_image_url||"/src/assets/images/user_avatar.jpg",alt:`Avatar de ${t.organization.corporate_client_info.full_name}`,class:"h-6 w-6 rounded-full object-cover border border-gray-200"},null,8,Sc),e("div",null,[e("p",Ic,l(t.organization.corporate_client_info.full_name),1),e("p",Dc,l(t.organization.corporate_client_info.email),1)])])]),e("div",Lc,[e("button",{onClick:f,class:"w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(d(re),{class:"h-4 w-4 mr-2"}),_(" Nueva Solicitud ")]),e("div",jc,[e("button",{onClick:g,class:"flex-1 inline-flex justify-center items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(d(Re),{class:"h-4 w-4 mr-1"}),_(" Ver Detalles ")]),e("button",{onClick:q[0]||(q[0]=p=>i.value=!0),class:"flex-1 inline-flex justify-center items-center px-3 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors"},[u(d(_t),{class:"h-4 w-4 mr-1"}),_(" Salir ")])])])]),u(lt,{visible:i.value,title:`¿Salir de ${t.organization.title}?`,message:"¿Estás seguro de que quieres abandonar esta organización? Ya no podrás enviar solicitudes a través de ella.","confirm-text":"Sí, salir","confirm-color":"red","is-loading":v.value,onConfirm:y,onCancel:q[1]||(q[1]=p=>i.value=!1)},null,8,["visible","title","is-loading"])]))}},Nc=we(Oc,[["__scopeId","data-v-c30f16d3"]]),Ac=e("div",{class:"mb-6"},[e("h2",{class:"text-lg font-medium text-gray-900"},"Mis Organizaciones"),e("p",{class:"mt-1 text-sm text-gray-600"}," Organizaciones donde eres miembro activo ")],-1),Uc={key:0,class:"flex justify-center items-center py-8"},Vc=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),Tc=e("span",{class:"ml-2 text-gray-600"},"Cargando organizaciones...",-1),Gc=[Vc,Tc],Bc={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Fc={key:2,class:"text-center py-12"},Hc=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," No perteneces a ninguna organización ",-1),Wc=e("p",{class:"text-gray-600 mb-6"}," Para unirte a organizaciones, necesitas recibir y aceptar invitaciones de clientes corporativos. ",-1),Zc={class:"max-w-2xl mx-auto space-y-4"},Jc={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Qc={class:"flex"},Yc=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Cómo unirme a una organización?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"1. Espera a recibir una invitación de un cliente corporativo"),e("p",null,'2. Revisa la invitación en la pestaña "Invitaciones"'),e("p",null,"3. Acepta la invitación para convertirte en miembro"),e("p",null,"4. Una vez miembro, podrás enviar solicitudes a esa organización")])],-1),Xc={class:"bg-green-50 border border-green-200 rounded-lg p-4"},Kc={class:"flex"},ed=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-green-800"},"Beneficios de ser miembro"),e("div",{class:"mt-1 text-sm text-green-700 space-y-1"},[e("p",null,"• Enviar solicitudes corporativas especializadas"),e("p",null,"• Acceso a servicios específicos de la organización"),e("p",null,"• Comunicación directa con el equipo corporativo"),e("p",null,"• Seguimiento detallado de tus solicitudes")])],-1),td={__name:"OrganizationsSection",props:{organizations:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["organization-left","create-request"],setup(t,{emit:s}){const o=s,n=i=>{o("organization-left",i)},c=i=>{o("create-request",i)};return(i,v)=>(a(),r("div",null,[Ac,t.isLoading?(a(),r("div",Uc,Gc)):t.organizations.length>0?(a(),r("div",Bc,[(a(!0),r(Z,null,J(t.organizations,f=>(a(),B(Nc,{key:f.id,organization:f,onLeft:n,onCreateRequest:c},null,8,["organization"]))),128))])):(a(),r("div",Fc,[u(d(_e),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),Hc,Wc,e("div",Zc,[e("div",Jc,[e("div",Qc,[u(d(oe),{class:"h-5 w-5 text-blue-400 mt-0.5"}),Yc])]),e("div",Xc,[e("div",Kc,[u(d(Ce),{class:"h-5 w-5 text-green-400 mt-0.5"}),ed])])])]))]))}},sd=t=>(ye("data-v-49e60ca4"),t=t(),xe(),t),od={class:"flex items-start justify-between mb-4"},ad={class:"flex items-center space-x-2 mb-1"},id={class:"text-sm font-medium text-gray-900"},nd={class:"text-lg font-semibold text-gray-900 mb-2"},rd={class:"text-sm text-gray-600 mb-4 line-clamp-2"},ld={class:"flex items-center space-x-3 mb-4 p-3 bg-gray-50 rounded-lg"},cd=["src","alt"],dd={class:"text-sm font-medium text-gray-900"},ud={class:"text-xs text-gray-500"},gd={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-gray-500 mb-4"},md={class:"flex items-center"},fd={class:"flex items-center"},hd={class:"flex items-center"},vd={class:"flex items-center"},pd={key:0,class:"text-xs text-gray-500 mb-2"},_d=sd(()=>e("span",{class:"font-medium"},"Última actualización:",-1)),bd={class:"w-full bg-gray-200 rounded-full h-1"},yd={__name:"RequestCard",props:{request:{type:Object,required:!0}},emits:["view-detail"],setup(t,{emit:s}){const o=t,n=s,c=I(()=>{var p;return((p=o.request.organization_info)==null?void 0:p.profile_image)||"/src/assets/images/user_avatar.jpg"}),i=()=>{n("view-detail",o.request.id)},v=p=>({PENDING:"Pendiente",IN_REVIEW:"En Revisión",RESPONDED:"Respondida",RESOLVED:"Resuelta",CLOSED:"Cerrada"})[p]||p,f=p=>({PENDING:"bg-yellow-100 text-yellow-800",IN_REVIEW:"bg-blue-100 text-blue-800",RESPONDED:"bg-purple-100 text-purple-800",RESOLVED:"bg-green-100 text-green-800",CLOSED:"bg-gray-100 text-gray-800"})[p]||"bg-gray-100 text-gray-800",g=p=>({LOW:"Baja",MEDIUM:"Media",HIGH:"Alta",URGENT:"Urgente"})[p]||p,y=p=>({LOW:"bg-gray-100 text-gray-600",MEDIUM:"bg-blue-100 text-blue-600",HIGH:"bg-orange-100 text-orange-600",URGENT:"bg-red-100 text-red-600"})[p]||"bg-gray-100 text-gray-600",x=p=>({PENDING:20,IN_REVIEW:40,RESPONDED:60,RESOLVED:80,CLOSED:100})[p]||0,w=p=>({PENDING:"bg-yellow-500",IN_REVIEW:"bg-blue-500",RESPONDED:"bg-purple-500",RESOLVED:"bg-green-500",CLOSED:"bg-gray-500"})[p]||"bg-gray-500",q=p=>{const E=new Date(p),R=Math.abs(new Date-E),P=Math.ceil(R/(1e3*60*60*24));return P===0?"Hoy":P===1?"Ayer":P<7?`Hace ${P} días`:P<30?`Hace ${Math.ceil(P/7)} semanas`:E.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})};return(p,E)=>{var $,R;return a(),r("div",{class:"bg-white shadow rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow cursor-pointer",onClick:i},[e("div",od,[e("div",null,[e("div",ad,[e("span",id,l(t.request.request_number),1),e("span",{class:F([f(t.request.status),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(v(t.request.status)),3),e("span",{class:F([y(t.request.priority),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(g(t.request.priority)),3)]),e("h3",nd,l(t.request.title),1)]),e("button",{onClick:le(i,["stop"]),class:"inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(Re),{class:"h-3 w-3 mr-1"}),_(" Ver Detalle ")])]),e("p",rd,l(t.request.description),1),e("div",ld,[e("img",{src:c.value,alt:`Logo de ${($=t.request.organization_info)==null?void 0:$.title}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,cd),e("div",null,[e("p",dd,l(((R=t.request.organization_info)==null?void 0:R.title)||"Organización"),1),e("p",ud," Líder: "+l(t.request.corporate_client_name),1)])]),e("div",gd,[e("div",md,[u(d(st),{class:"h-3 w-3 mr-1"}),_(" "+l(t.request.request_type_name),1)]),e("div",fd,[u(d(ae),{class:"h-3 w-3 mr-1"}),_(" "+l(q(t.request.created_at)),1)]),e("div",hd,[u(d(Ue),{class:"h-3 w-3 mr-1"}),_(" "+l(t.request.response_count)+" respuestas ",1)]),e("div",vd,[u(d(je),{class:"h-3 w-3 mr-1"}),_(" "+l(t.request.days_since_created)+" días ",1)])]),t.request.status_updated_at&&t.request.status_updated_at!==t.request.created_at?(a(),r("div",pd,[_d,_(" "+l(q(t.request.status_updated_at)),1)])):k("",!0),e("div",bd,[e("div",{class:F([w(t.request.status),"h-1 rounded-full transition-all duration-300"]),style:Ke({width:x(t.request.status)+"%"})},null,6)])])}}},xd=we(yd,[["__scopeId","data-v-49e60ca4"]]),wd={class:"mb-6"},$d={class:"flex items-center justify-between"},Ed=e("div",null,[e("h2",{class:"text-lg font-medium text-gray-900"},"Mis Solicitudes Corporativas"),e("p",{class:"mt-1 text-sm text-gray-600"}," Seguimiento de todas tus solicitudes enviadas ")],-1),zd={class:"mb-6 bg-gray-50 rounded-lg p-4"},kd={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},qd=e("label",{for:"status-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Estado ",-1),Cd=he('<option value="">Todos los estados</option><option value="PENDING">Pendiente</option><option value="IN_REVIEW">En Revisión</option><option value="RESPONDED">Respondida</option><option value="RESOLVED">Resuelta</option><option value="CLOSED">Cerrada</option>',6),Rd=[Cd],Pd=e("label",{for:"priority-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Prioridad ",-1),Md=he('<option value="">Todas las prioridades</option><option value="LOW">Baja</option><option value="MEDIUM">Media</option><option value="HIGH">Alta</option><option value="URGENT">Urgente</option>',5),Sd=[Md],Id=e("label",{for:"search",class:"block text-sm font-medium text-gray-700 mb-1"}," Buscar ",-1),Dd={key:0,class:"flex justify-center items-center py-8"},Ld=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),jd=e("span",{class:"ml-2 text-gray-600"},"Cargando solicitudes...",-1),Od=[Ld,jd],Nd={key:1,class:"space-y-4"},Ad={key:2,class:"text-center py-12"},Ud={class:"text-lg font-medium text-gray-900 mb-2"},Vd={class:"text-gray-600 mb-6"},Td={key:0,class:"space-y-4"},Gd={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto"},Bd={class:"flex"},Fd=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Cómo crear una solicitud?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"1. Asegúrate de ser miembro de al menos una organización"),e("p",null,'2. Haz clic en "Nueva Solicitud"'),e("p",null,"3. Selecciona la organización y tipo de solicitud"),e("p",null,"4. Proporciona todos los detalles necesarios")])],-1),Hd={key:1},Wd={__name:"MyRequestsSection",props:{requests:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["request-detail","create-request"],setup(t,{emit:s}){const o=t,n=s,c=S(""),i=S(""),v=S(""),f=I(()=>{let q=[...o.requests];if(c.value&&(q=q.filter(p=>p.status===c.value)),i.value&&(q=q.filter(p=>p.priority===i.value)),v.value.trim()){const p=v.value.toLowerCase().trim();q=q.filter(E=>{var $;return E.title.toLowerCase().includes(p)||E.request_number.toLowerCase().includes(p)||(($=E.description)==null?void 0:$.toLowerCase().includes(p))})}return q.sort((p,E)=>new Date(E.created_at)-new Date(p.created_at))}),g=I(()=>o.requests.length===0?"No has enviado solicitudes":"No se encontraron solicitudes"),y=I(()=>o.requests.length===0?"Cuando envíes solicitudes corporativas a tus organizaciones, aparecerán aquí para que puedas dar seguimiento.":"No hay solicitudes que coincidan con los filtros seleccionados. Intenta ajustar los criterios de búsqueda."),x=q=>{n("request-detail",q)},w=()=>{c.value="",i.value="",v.value=""};return K([c,i,v],()=>{}),(q,p)=>(a(),r("div",null,[e("div",wd,[e("div",$d,[Ed,e("button",{onClick:p[0]||(p[0]=E=>n("create-request")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(re),{class:"h-4 w-4 mr-2"}),_(" Nueva Solicitud ")])])]),e("div",zd,[e("div",kd,[e("div",null,[qd,G(e("select",{id:"status-filter","onUpdate:modelValue":p[1]||(p[1]=E=>c.value=E),class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},Rd,512),[[se,c.value]])]),e("div",null,[Pd,G(e("select",{id:"priority-filter","onUpdate:modelValue":p[2]||(p[2]=E=>i.value=E),class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},Sd,512),[[se,i.value]])]),e("div",null,[Id,G(e("input",{id:"search","onUpdate:modelValue":p[3]||(p[3]=E=>v.value=E),type:"text",placeholder:"Buscar por título o número...",class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[X,v.value]])])])]),t.isLoading?(a(),r("div",Dd,Od)):f.value.length>0?(a(),r("div",Nd,[(a(!0),r(Z,null,J(f.value,E=>(a(),B(xd,{key:E.id,request:E,onViewDetail:x},null,8,["request"]))),128))])):(a(),r("div",Ad,[u(d(Me),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e("h3",Ud,l(g.value),1),e("p",Vd,l(y.value),1),t.requests.length===0?(a(),r("div",Td,[e("button",{onClick:p[4]||(p[4]=E=>n("create-request")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(re),{class:"h-4 w-4 mr-2"}),_(" Crear Primera Solicitud ")]),e("div",Gd,[e("div",Bd,[u(d(oe),{class:"h-5 w-5 text-blue-400 mt-0.5"}),Fd])])])):(a(),r("div",Hd,[e("button",{onClick:w,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(ie),{class:"h-4 w-4 mr-2"}),_(" Limpiar Filtros ")])]))]))]))}},Zd=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),Jd={class:"fixed inset-0 z-10 overflow-y-auto"},Qd={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},Yd={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},Xd=e("p",{class:"mt-1 text-sm text-gray-500"}," Envía una solicitud a través de una de tus organizaciones ",-1),Kd={key:0,class:"flex justify-center items-center py-8"},eu=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),tu=e("span",{class:"ml-2 text-gray-600"},"Enviando solicitud...",-1),su=[eu,tu],ou={key:1,class:"text-center py-6"},au=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," ¡Solicitud Enviada! ",-1),iu={class:"text-sm text-gray-600 mb-2"},nu={class:"text-sm text-gray-500 mb-6"},ru=e("label",{for:"organization",class:"block text-sm font-medium leading-6 text-gray-900"}," Organización * ",-1),lu={class:"mt-2"},cu=e("option",{value:""},"Selecciona una organización",-1),du=["value"],uu={key:0,class:"mt-1 text-sm text-red-600"},gu={key:0,class:"bg-gray-50 rounded-lg p-4"},mu={class:"flex items-center space-x-3"},fu=["src","alt"],hu={class:"text-sm font-medium text-gray-900"},vu={class:"text-xs text-gray-500"},pu=e("label",{for:"request_type",class:"block text-sm font-medium leading-6 text-gray-900"}," Tipo de Solicitud * ",-1),_u={class:"mt-2"},bu=e("option",{value:""},"Selecciona un tipo",-1),yu=["value"],xu={key:0,class:"mt-1 text-sm text-red-600"},wu=e("label",{for:"title",class:"block text-sm font-medium leading-6 text-gray-900"}," Título de la Solicitud * ",-1),$u={class:"mt-2"},Eu={key:0,class:"mt-1 text-sm text-red-600"},zu=e("label",{for:"description",class:"block text-sm font-medium leading-6 text-gray-900"}," Descripción Detallada * ",-1),ku={class:"mt-2"},qu=e("p",{class:"mt-1 text-xs text-gray-500"}," Proporciona todos los detalles relevantes para que puedan ayudarte mejor ",-1),Cu={key:0,class:"mt-1 text-sm text-red-600"},Ru=e("label",{for:"priority",class:"block text-sm font-medium leading-6 text-gray-900"}," Prioridad ",-1),Pu={class:"mt-2"},Mu=e("option",{value:"LOW"},"Baja",-1),Su=e("option",{value:"MEDIUM"},"Media",-1),Iu=e("option",{value:"HIGH"},"Alta",-1),Du=e("option",{value:"URGENT"},"Urgente",-1),Lu=[Mu,Su,Iu,Du],ju={key:0,class:"mt-1 text-sm text-red-600"},Ou={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Nu={class:"flex"},Au=e("div",{class:"ml-3"},[e("h5",{class:"text-sm font-medium text-blue-800"},"Información importante"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Tu solicitud será enviada al equipo de la organización seleccionada"),e("p",null,"• Recibirás un número de seguimiento para tu solicitud"),e("p",null,"• Podrás ver el progreso y responder a comentarios"),e("p",null,"• El equipo corporativo te contactará para más detalles si es necesario")])],-1),Uu={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},Vu=["disabled"],Tu={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Gu={__name:"CreateRequestModal",props:{visible:{type:Boolean,default:!1},organizations:{type:Array,default:()=>[]}},emits:["close","created"],setup(t,{emit:s}){const o=t,n=s,c=Se(),i=S(!1),v=S(!1),f=S({}),g=S(null),y=S([]),x=S({organization:"",request_type:"",title:"",description:"",priority:"MEDIUM"}),w=I(()=>o.organizations.find(b=>b.id===x.value.organization)),q=I(()=>x.value.organization&&x.value.request_type&&x.value.title.trim()&&x.value.description.trim()),p=()=>{x.value={organization:"",request_type:"",title:"",description:"",priority:"MEDIUM"},f.value={},v.value=!1,g.value=null},E=async()=>{var b,h;try{const m=await c.getRequestTypes();Array.isArray(m)?y.value=m:(console.error("Request types is not an array:",m),j("Formato de tipos de solicitud inválido","error"))}catch(m){console.error("Error loading request types:",m),((b=m.response)==null?void 0:b.status)===403?j("No tienes permisos para cargar tipos de solicitudes","error"):((h=m.response)==null?void 0:h.status)===401?j("Sesión expirada. Por favor, vuelve a iniciar sesión","error"):j("Error al cargar tipos de solicitudes","error")}},$=async()=>{var b,h,m,z;try{i.value=!0,f.value={};const D={organization:x.value.organization,request_type:x.value.request_type,title:x.value.title.trim(),description:x.value.description.trim(),priority:x.value.priority},M=await c.createCorporateRequest(D);g.value=M.corporate_request,v.value=!0,j("Solicitud enviada exitosamente","success"),n("created",M.corporate_request)}catch(D){console.error("Error creating request:",D),(h=(b=D.response)==null?void 0:b.data)!=null&&h.details?f.value=D.response.data.details:(z=(m=D.response)==null?void 0:m.data)!=null&&z.error?j(D.response.data.error,"error"):j("Error al enviar la solicitud","error")}finally{i.value=!1}},R=()=>{p()},P=()=>{i.value||n("close")};return K(()=>o.visible,b=>{b&&be(()=>{p(),y.value.length===0&&E()})}),ve(()=>{E()}),(b,h)=>(a(),B(d(fe),{as:"template",show:t.visible},{default:U(()=>[u(d(ue),{class:"relative z-50",onClose:P},{default:U(()=>[u(d(ee),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:U(()=>[Zd]),_:1}),e("div",Jd,[e("div",Qd,[u(d(ee),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:U(()=>[u(d(ge),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6"},{default:U(()=>{var m,z,D,M;return[e("div",Yd,[e("div",null,[u(d(me),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:U(()=>[_(" Nueva Solicitud Corporativa ")]),_:1}),Xd]),e("button",{onClick:P,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(d(ie),{class:"h-6 w-6"})])]),i.value?(a(),r("div",Kd,su)):v.value?(a(),r("div",ou,[u(d(Ce),{class:"h-16 w-16 text-green-500 mx-auto mb-4"}),au,e("p",iu,[_(" Tu solicitud "),e("strong",null,l((m=g.value)==null?void 0:m.request_number),1),_(" ha sido enviada exitosamente. ")]),e("p",nu,[_(" El equipo de "),e("strong",null,l((D=(z=g.value)==null?void 0:z.organization_info)==null?void 0:D.title),1),_(" la revisará pronto. ")]),e("div",{class:"space-y-3"},[e("button",{onClick:R,class:"w-full inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Crear Otra Solicitud "),e("button",{onClick:P,class:"w-full inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cerrar ")])])):(a(),r("form",{key:2,onSubmit:le($,["prevent"]),class:"space-y-6"},[e("div",null,[ru,e("div",lu,[G(e("select",{id:"organization","onUpdate:modelValue":h[0]||(h[0]=V=>x.value.organization=V),required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"},[cu,(a(!0),r(Z,null,J(t.organizations,V=>(a(),r("option",{key:V.id,value:V.id},l(V.title),9,du))),128))],512),[[se,x.value.organization]])]),f.value.organization?(a(),r("p",uu,l(f.value.organization[0]),1)):k("",!0)]),w.value?(a(),r("div",gu,[e("div",mu,[e("img",{src:w.value.profile_image_url||"/src/assets/images/user_avatar.jpg",alt:`Logo de ${w.value.title}`,class:"h-10 w-10 rounded-full object-cover border border-gray-200"},null,8,fu),e("div",null,[e("h4",hu,l(w.value.title),1),e("p",vu," Líder: "+l((M=w.value.corporate_client_info)==null?void 0:M.full_name),1)])])])):k("",!0),e("div",null,[pu,e("div",_u,[G(e("select",{id:"request_type","onUpdate:modelValue":h[1]||(h[1]=V=>x.value.request_type=V),required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"},[bu,(a(!0),r(Z,null,J(y.value,V=>(a(),r("option",{key:V.id,value:V.id},l(V.name),9,yu))),128))],512),[[se,x.value.request_type]])]),f.value.request_type?(a(),r("p",xu,l(f.value.request_type[0]),1)):k("",!0)]),e("div",null,[wu,e("div",$u,[G(e("input",{id:"title","onUpdate:modelValue":h[2]||(h[2]=V=>x.value.title=V),type:"text",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ej: Revisión de contrato de servicios"},null,512),[[X,x.value.title]])]),f.value.title?(a(),r("p",Eu,l(f.value.title[0]),1)):k("",!0)]),e("div",null,[zu,e("div",ku,[G(e("textarea",{id:"description","onUpdate:modelValue":h[3]||(h[3]=V=>x.value.description=V),rows:"4",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Describe detalladamente lo que necesitas..."},null,512),[[X,x.value.description]])]),qu,f.value.description?(a(),r("p",Cu,l(f.value.description[0]),1)):k("",!0)]),e("div",null,[Ru,e("div",Pu,[G(e("select",{id:"priority","onUpdate:modelValue":h[4]||(h[4]=V=>x.value.priority=V),class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"},Lu,512),[[se,x.value.priority]])]),f.value.priority?(a(),r("p",ju,l(f.value.priority[0]),1)):k("",!0)]),e("div",Ou,[e("div",Nu,[u(d(oe),{class:"h-5 w-5 text-blue-400 mt-0.5"}),Au])]),e("div",Uu,[e("button",{type:"button",onClick:P,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value||!q.value,class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),r("div",Tu)):(a(),B(d(it),{key:1,class:"h-4 w-4 mr-2"})),_(" "+l(i.value?"Enviando...":"Enviar Solicitud"),1)],8,Vu)])],32))]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},Bu={class:"bg-white shadow rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow"},Fu={class:"mb-4"},Hu={class:"flex items-center space-x-2 mb-2"},Wu={class:"text-lg font-semibold text-gray-900"},Zu={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800"},Ju={class:"flex items-center text-sm text-gray-500 space-x-4"},Qu={class:"flex items-center"},Yu={class:"flex items-center"},Xu={class:"mb-4"},Ku={class:"text-gray-700 whitespace-pre-wrap leading-relaxed"},e0={key:0,class:"mb-4"},t0=["href"],s0={class:"flex items-center justify-between text-xs text-gray-500 pt-4 border-t border-gray-100"},o0={class:"flex items-center space-x-4"},a0={class:"flex items-center"},i0={key:0,class:"flex items-center text-yellow-600"},n0={key:0,class:"flex items-center text-green-600"},r0=e("span",{class:"h-2 w-2 bg-green-400 rounded-full mr-1 animate-pulse"},null,-1),Xe={__name:"ClientPostCard",props:{post:{type:Object,required:!0}},setup(t){const s=t,o=I(()=>{const i=new Date(s.post.created_at),f=Math.abs(new Date-i);return Math.ceil(f/(1e3*60*60*24))<=3}),n=i=>new Date(i).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),c=i=>{const v=new Date(i),g=Math.abs(new Date-v),y=Math.ceil(g/(1e3*60*60*24)),x=Math.ceil(g/(1e3*60*60)),w=Math.ceil(g/(1e3*60));if(w<60)return w<=1?"hace un momento":`hace ${w} minutos`;if(x<24)return x===1?"hace 1 hora":`hace ${x} horas`;if(y===0)return"hoy";if(y===1)return"ayer";if(y<7)return`hace ${y} días`;if(y<30){const p=Math.ceil(y/7);return`hace ${p} ${p===1?"semana":"semanas"}`}const q=Math.ceil(y/30);return q<12?`hace ${q} ${q===1?"mes":"meses"}`:n(i)};return(i,v)=>(a(),r("div",Bu,[e("div",Fu,[e("div",Hu,[e("h3",Wu,l(t.post.title),1),t.post.is_pinned?(a(),r("span",Zu,[u(d(pe),{class:"h-3 w-3 mr-1"}),_(" Fijado ")])):k("",!0)]),e("div",Ju,[e("div",Qu,[u(d(xt),{class:"h-4 w-4 mr-1"}),e("span",null,l(t.post.author_name),1)]),e("div",Yu,[u(d(ae),{class:"h-4 w-4 mr-1"}),e("span",null,l(c(t.post.created_at)),1)])])]),e("div",Xu,[e("p",Ku,l(t.post.content),1)]),t.post.has_link&&t.post.link_url?(a(),r("div",e0,[e("a",{href:t.post.link_url,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-4 py-2 border border-blue-300 text-sm font-medium rounded-md text-blue-700 bg-blue-50 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(d(tt),{class:"h-4 w-4 mr-2"}),_(" "+l(t.post.link_name||"Ver enlace")+" ",1),u(d(Ae),{class:"h-3 w-3 ml-2"})],8,t0)])):k("",!0),e("div",s0,[e("div",o0,[e("span",a0,[u(d(ae),{class:"h-3 w-3 mr-1"}),_(" "+l(n(t.post.created_at)),1)]),t.post.is_pinned?(a(),r("span",i0,[u(d(pe),{class:"h-3 w-3 mr-1"}),_(" Anuncio Destacado ")])):k("",!0)]),o.value?(a(),r("div",n0,[r0,_(" Reciente ")])):k("",!0)])]))}},l0={class:"mb-6"},c0={class:"flex items-center justify-between"},d0=e("div",null,[e("h2",{class:"text-lg font-medium text-gray-900"},"Anuncios de la Organización"),e("p",{class:"mt-1 text-sm text-gray-600"}," Información importante de la organización ")],-1),u0=["disabled"],g0={key:0,class:"flex justify-center items-center py-8"},m0=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),f0=e("span",{class:"ml-2 text-gray-600"},"Cargando anuncios...",-1),h0=[m0,f0],v0={key:1,class:"space-y-4"},p0={key:2,class:"text-center py-12"},_0={class:"text-lg font-medium text-gray-900 mb-2"},b0={class:"text-gray-600 mb-6"},y0={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto"},x0={class:"flex"},w0=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"Sobre los anuncios"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Los líderes de la organización pueden publicar anuncios importantes"),e("p",null,"• Revisa esta sección regularmente para mantenerte informado"),e("p",null,"• Los anuncios fijados aparecen en la parte superior")])],-1),$0={__name:"OrganizationPostsSection",props:{organizationId:{type:Number,required:!0}},setup(t){const s=t,o=Ve(),n=I(()=>o.isLoadingPosts);I(()=>o.publicPosts);const c=I(()=>o.sortedPublicPosts),i=I(()=>c.value.filter(w=>w.is_pinned)),v=I(()=>c.value.filter(w=>!w.is_pinned)),f=I(()=>"No hay anuncios disponibles"),g=I(()=>"La organización aún no ha publicado ningún anuncio. Los anuncios importantes aparecerán aquí."),y=async()=>{try{await o.getPublicPosts(s.organizationId)}catch(w){console.error("Error loading posts:",w),j("Error al cargar los anuncios","error")}},x=()=>{y()};return ve(()=>{y()}),K(()=>s.organizationId,()=>{s.organizationId&&y()}),(w,q)=>(a(),r("div",null,[e("div",l0,[e("div",c0,[d0,e("button",{onClick:x,disabled:n.value,class:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},[u(d(Pe),{class:F([n.value?"animate-spin":"","h-4 w-4 mr-2"])},null,8,["class"]),_(" Actualizar ")],8,u0)])]),n.value?(a(),r("div",g0,h0)):c.value.length>0?(a(),r("div",v0,[(a(!0),r(Z,null,J(i.value,p=>(a(),B(Xe,{key:`pinned-${p.id}`,post:p},null,8,["post"]))),128)),(a(!0),r(Z,null,J(v.value,p=>(a(),B(Xe,{key:`regular-${p.id}`,post:p},null,8,["post"]))),128))])):(a(),r("div",p0,[u(d(yt),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e("h3",_0,l(f.value),1),e("p",b0,l(g.value),1),e("div",y0,[e("div",x0,[u(d(oe),{class:"h-5 w-5 text-blue-400 mt-0.5"}),w0])])]))]))}},E0={class:"px-4 py-6 sm:px-6 lg:px-8"},z0={key:0,class:"flex justify-center items-center py-12"},k0=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),q0=e("span",{class:"ml-2 text-gray-600"},"Cargando datos...",-1),C0=[k0,q0],R0={key:1,class:"text-center py-12"},P0={class:"mx-auto max-w-md"},M0=e("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"})],-1),S0=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Acceso Restringido",-1),I0=e("p",{class:"mt-1 text-sm text-gray-500"}," Esta vista es solo para clientes normales. ",-1),D0={class:"mt-2 text-xs text-gray-400"},L0={key:2},j0={class:"mb-8"},O0={class:"sm:flex sm:items-center sm:justify-between"},N0=e("div",null,[e("h1",{class:"text-2xl font-bold leading-6 text-gray-900"}," Mis Organizaciones "),e("p",{class:"mt-2 text-sm text-gray-700"}," Gestiona tus membresías, invitaciones y solicitudes corporativas ")],-1),A0={class:"mt-4 sm:mt-0 flex space-x-3"},U0={key:0,class:"mb-8"},V0=e("div",{class:"mb-6"},[e("h2",{class:"text-lg font-medium text-gray-900"},"Anuncios de Organizaciones"),e("p",{class:"mt-1 text-sm text-gray-600"}," Información importante de las organizaciones donde eres miembro ")],-1),T0={class:"space-y-8"},G0={class:"bg-white shadow rounded-lg overflow-hidden"},B0={class:"px-6 py-4 border-b border-gray-200"},F0={class:"flex items-center space-x-4"},H0=["src","alt"],W0={class:"text-lg font-semibold text-gray-900"},Z0={class:"text-sm text-gray-600"},J0={class:"px-6 py-4"},Q0={class:"border-b border-gray-200 mb-6"},Y0={class:"-mb-px flex space-x-8"},X0=["onClick"],K0={class:"space-y-6"},eg={key:0},tg={key:1},sg={key:2},og={__name:"ClientDashboard",setup(t){const s=ce(),o=Se(),n=qe(),c=Oe(),i=S("organizations"),v=S(!1),f=I(()=>s.isLoading||o.isLoadingRequests),g=I(()=>{var m;return((m=n.currentUser)==null?void 0:m.role)==="client"}),y=I(()=>s.myInvitations),x=I(()=>s.myMemberships),w=I(()=>o.myRequests),q=I(()=>[{id:"organizations",name:"Mis Organizaciones",icon:_e,count:x.value.length},{id:"requests",name:"Mis Solicitudes",icon:Me,count:w.value.length},{id:"invitations",name:"Invitaciones",icon:ze,count:y.value.filter(m=>m.status==="PENDING").length}]),p=async()=>{var m,z,D;try{const M=(m=n.currentUser)==null?void 0:m.role;if(!M){console.error("User role not available");return}if(M!=="client"){console.error("User is not a client, cannot load client dashboard data");return}console.log("Loading client dashboard data..."),await Promise.all([s.getMyInvitations(),s.getMyMemberships(),o.getMyRequests({page_size:50})]),console.log("Client dashboard data loaded successfully")}catch(M){console.error("Error loading client dashboard data:",M),((z=M.response)==null?void 0:z.status)===403?console.error("Access denied. User may not have client permissions."):((D=M.response)==null?void 0:D.status)===401&&console.error("Authentication error. User may need to log in again.")}},E=()=>{v.value=!0},$=()=>{v.value=!1},R=m=>{Promise.all([s.getMyInvitations(),s.getMyMemberships()])},P=m=>{s.getMyMemberships()},b=m=>{$(),o.getMyRequests(),i.value="requests"},h=m=>{c.push({name:"organizations_dashboard",query:{tab:"request-detail",id:m}})};return ve(async()=>{var z;console.log("ClientDashboard mounted"),n.currentUser||(console.log("Waiting for user data to be available..."),await n.init());const m=(z=n.currentUser)==null?void 0:z.role;console.log("Current user role:",m),m==="client"?p():console.error("User does not have client role. Current role:",m)}),(m,z)=>{var D;return a(),r("div",E0,[f.value?(a(),r("div",z0,C0)):g.value?(a(),r("div",L0,[e("div",j0,[e("div",O0,[N0,e("div",A0,[x.value.length>0?(a(),r("button",{key:0,onClick:E,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(re),{class:"h-4 w-4 mr-2"}),_(" Nueva Solicitud ")])):k("",!0)])])]),x.value.length>0?(a(),r("div",U0,[V0,e("div",T0,[(a(!0),r(Z,null,J(x.value,M=>(a(),r("div",{key:`posts-${M.id}`},[e("div",G0,[e("div",B0,[e("div",F0,[e("img",{src:M.profile_image||"/src/assets/images/user_avatar.jpg",alt:`Logo de ${M.title}`,class:"h-12 w-12 rounded-full object-cover bg-gray-100"},null,8,H0),e("div",null,[e("h3",W0,l(M.title),1),e("p",Z0,l(M.description),1)])])]),e("div",J0,[u($0,{"organization-id":M.id},null,8,["organization-id"])])])]))),128))])])):k("",!0),e("div",Q0,[e("nav",Y0,[(a(!0),r(Z,null,J(q.value,M=>(a(),r("button",{key:M.id,onClick:V=>i.value=M.id,class:F([i.value===M.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"])},[(a(),B(et(M.icon),{class:"h-5 w-5 mr-2 inline"})),_(" "+l(M.name)+" ",1),M.count!==void 0?(a(),r("span",{key:0,class:F([i.value===M.id?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-900","ml-2 py-0.5 px-2.5 rounded-full text-xs font-medium"])},l(M.count),3)):k("",!0)],10,X0))),128))])]),e("div",K0,[i.value==="organizations"?(a(),r("div",eg,[u(td,{organizations:x.value,"is-loading":d(s).isLoading,onOrganizationLeft:P,onCreateRequest:E},null,8,["organizations","is-loading"])])):k("",!0),i.value==="requests"?(a(),r("div",tg,[u(Wd,{requests:w.value,"is-loading":d(o).isLoadingRequests,onRequestDetail:h,onCreateRequest:E},null,8,["requests","is-loading"])])):k("",!0),i.value==="invitations"?(a(),r("div",sg,[u(mc,{invitations:y.value,"is-loading":d(s).isLoadingInvitations,onInvitationResponded:R},null,8,["invitations","is-loading"])])):k("",!0)])])):(a(),r("div",R0,[e("div",P0,[M0,S0,I0,e("p",D0," Tu rol actual: "+l(((D=d(n).currentUser)==null?void 0:D.role)||"Sin definir"),1)])])),u(Gu,{visible:v.value,organizations:x.value,onClose:$,onCreated:b},null,8,["visible","organizations"])])}}},ag={__name:"ClientOrganizationsView",setup(t){return(s,o)=>(a(),B(og))}},ig={class:"px-4 py-6 sm:px-6 lg:px-8"},ng={key:0,class:"flex justify-center items-center py-12"},rg=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),lg=e("span",{class:"ml-2 text-gray-600"},"Cargando solicitud...",-1),cg=[rg,lg],dg={key:1,class:"text-center py-12"},ug={class:"mx-auto max-w-md"},gg=e("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),mg=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Error al cargar la solicitud",-1),fg={class:"mt-1 text-sm text-gray-500"},hg={class:"mt-6"},vg={key:2},pg={class:"mb-6"},_g={class:"flex items-center justify-between"},bg={class:"flex items-center space-x-4"},yg={class:"text-2xl font-bold text-gray-900"},xg={class:"text-sm text-gray-600"},wg={class:"flex items-center space-x-2"},$g={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},Eg={class:"lg:col-span-2 space-y-6"},zg={class:"bg-white shadow rounded-lg p-6"},kg=e("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Detalles de la Solicitud",-1),qg={class:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2"},Cg=e("dt",{class:"text-sm font-medium text-gray-500"},"Tipo de Solicitud",-1),Rg={class:"mt-1 text-sm text-gray-900"},Pg=e("dt",{class:"text-sm font-medium text-gray-500"},"Fecha de Creación",-1),Mg={class:"mt-1 text-sm text-gray-900"},Sg={key:0},Ig=e("dt",{class:"text-sm font-medium text-gray-500"},"Última Actualización",-1),Dg={class:"mt-1 text-sm text-gray-900"},Lg=e("dt",{class:"text-sm font-medium text-gray-500"},"Días Transcurridos",-1),jg={class:"mt-1 text-sm text-gray-900"},Og={key:1},Ng=e("dt",{class:"text-sm font-medium text-gray-500"},"Fecha Estimada de Completado",-1),Ag={class:"mt-1 text-sm text-gray-900"},Ug={key:2},Vg=e("dt",{class:"text-sm font-medium text-gray-500"},"Fecha de Completado",-1),Tg={class:"mt-1 text-sm text-gray-900"},Gg={class:"mt-6"},Bg=e("dt",{class:"text-sm font-medium text-gray-500 mb-2"},"Descripción",-1),Fg={class:"text-sm text-gray-900 whitespace-pre-wrap"},Hg={key:0,class:"bg-white shadow rounded-lg p-6"},Wg=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Archivos Adjuntos",-1),Zg={class:"space-y-3"},Jg={class:"flex items-center space-x-3"},Qg={class:"text-sm font-medium text-gray-900"},Yg={class:"text-xs text-gray-500"},Xg=["href"],Kg={class:"bg-white shadow rounded-lg p-6"},em={class:"text-lg font-medium text-gray-900 mb-4"},tm={key:0,class:"space-y-4"},sm={class:"flex items-start justify-between mb-2"},om={class:"flex items-center space-x-2"},am={class:"text-sm font-medium text-gray-900"},im={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800"},nm={class:"text-xs text-gray-500"},rm={class:"text-sm text-gray-700 whitespace-pre-wrap"},lm={key:1,class:"text-center py-6"},cm=e("p",{class:"text-sm text-gray-500"},"No hay respuestas aún",-1),dm=e("label",{for:"response",class:"block text-sm font-medium text-gray-700 mb-2"}," Agregar Respuesta ",-1),um=["disabled"],gm={key:0,class:"mt-3"},mm={class:"flex items-center"},fm=e("span",{class:"ml-2 text-sm text-gray-700"},"Nota interna (solo visible para el equipo corporativo)",-1),hm={class:"mt-3 flex justify-end"},vm=["disabled"],pm={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},_m={class:"space-y-6"},bm={class:"bg-white shadow rounded-lg p-6"},ym=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Participantes",-1),xm={class:"space-y-4"},wm={class:"flex items-center space-x-3"},$m=["src","alt"],Em={class:"text-sm font-medium text-gray-900"},zm={class:"text-xs text-gray-500"},km={class:"flex items-center space-x-3"},qm=["src","alt"],Cm={class:"text-sm font-medium text-gray-900"},Rm={class:"text-xs text-gray-500"},Pm={key:0,class:"flex items-center space-x-3"},Mm=["src","alt"],Sm={class:"text-sm font-medium text-gray-900"},Im={class:"text-xs text-gray-500"},Dm={key:0,class:"bg-white shadow rounded-lg p-6"},Lm=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Organización",-1),jm={class:"flex items-center space-x-3"},Om=["src","alt"],Nm={class:"text-sm font-medium text-gray-900"},Am=e("p",{class:"text-xs text-gray-500"},"Vía organización",-1),Um={key:1,class:"bg-white shadow rounded-lg p-6"},Vm=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Acciones",-1),Tm={class:"space-y-3"},Gm=e("label",{for:"status",class:"block text-sm font-medium text-gray-700 mb-2"}," Cambiar Estado ",-1),Bm=["disabled"],Fm=he('<option value="PENDING">Pendiente</option><option value="IN_REVIEW">En Revisión</option><option value="RESPONDED">Respondida</option><option value="RESOLVED">Resuelta</option><option value="CLOSED">Cerrada</option>',5),Hm=[Fm],Wm={__name:"RequestDetailView",setup(t){const s=Se(),o=qe(),n=gt(),c=Oe(),i=S(null),v=S(!1),f=S(null),g=S(""),y=S(!1),x=S(!1),w=S(""),q=S(!1),p=I(()=>{var L;return(L=o.currentUser)==null?void 0:L.role}),E=I(()=>"/src/assets/images/user_avatar.jpg"),$=I(()=>"/src/assets/images/user_avatar.jpg"),R=I(()=>"/src/assets/images/user_avatar.jpg"),P=async()=>{var L,N;try{v.value=!0,f.value=null;const O=n.query.id;if(!O)throw new Error("ID de solicitud no proporcionado");let Y;if(p.value==="client")Y=await s.getMyRequestDetail(O);else if(p.value==="corporate_client")Y=await s.getReceivedRequestDetail(O);else throw new Error("Rol de usuario no válido");i.value=Y.corporate_request,w.value=i.value.status}catch(O){console.error("Error loading request detail:",O),f.value=((N=(L=O.response)==null?void 0:L.data)==null?void 0:N.error)||O.message||"Error al cargar la solicitud"}finally{v.value=!1}},b=async()=>{var L,N;try{x.value=!0;const O={response_text:g.value.trim()};p.value==="corporate_client"&&(O.is_internal_note=y.value);let Y;p.value==="client"?Y=await s.addResponseToMyRequest(i.value.id,O):p.value==="corporate_client"&&(Y=await s.addResponseToReceivedRequest(i.value.id,O)),s.currentRequest&&s.currentRequest.id===i.value.id&&(i.value.responses=s.currentRequest.responses,i.value.response_count=s.currentRequest.response_count),g.value="",y.value=!1,j("Respuesta enviada exitosamente","success")}catch(O){console.error("Error submitting response:",O),j(((N=(L=O.response)==null?void 0:L.data)==null?void 0:N.error)||"Error al enviar la respuesta","error")}finally{x.value=!1}},h=async()=>{var L,N;if(w.value!==i.value.status)try{q.value=!0,await s.updateReceivedRequest(i.value.id,{status:w.value}),i.value.status=w.value,i.value.status_updated_at=new Date().toISOString(),j("Estado actualizado exitosamente","success")}catch(O){console.error("Error updating status:",O),j(((N=(L=O.response)==null?void 0:L.data)==null?void 0:N.error)||"Error al actualizar el estado","error"),w.value=i.value.status}finally{q.value=!1}},m=()=>{c.push({name:"organizations_dashboard"})},z=L=>new Date(L).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),D=L=>{const N=new Date(L),Y=Math.abs(new Date-N),ne=Math.ceil(Y/(1e3*60*60*24));return ne===0?"Hoy":ne===1?"Ayer":ne<7?`Hace ${ne} días`:z(L)},M=L=>{if(L===0)return"0 Bytes";const N=1024,O=["Bytes","KB","MB","GB"],Y=Math.floor(Math.log(L)/Math.log(N));return parseFloat((L/Math.pow(N,Y)).toFixed(2))+" "+O[Y]},V=L=>({PENDING:"Pendiente",IN_REVIEW:"En Revisión",RESPONDED:"Respondida",RESOLVED:"Resuelta",CLOSED:"Cerrada"})[L]||L,de=L=>({PENDING:"bg-yellow-100 text-yellow-800",IN_REVIEW:"bg-blue-100 text-blue-800",RESPONDED:"bg-purple-100 text-purple-800",RESOLVED:"bg-green-100 text-green-800",CLOSED:"bg-gray-100 text-gray-800"})[L]||"bg-gray-100 text-gray-800",T=L=>({LOW:"Baja",MEDIUM:"Media",HIGH:"Alta",URGENT:"Urgente"})[L]||L,A=L=>({LOW:"bg-gray-100 text-gray-600",MEDIUM:"bg-blue-100 text-blue-600",HIGH:"bg-orange-100 text-orange-600",URGENT:"bg-red-100 text-red-600"})[L]||"bg-gray-100 text-gray-600",C=L=>({client:"Cliente",corporate_client:"Cliente Corporativo"})[L]||L;return K(()=>n.query.id,()=>{n.query.id&&P()}),ve(()=>{n.query.id&&P()}),(L,N)=>{var O,Y,ne,Te,Ge,Be,Fe,He,We,Ze;return a(),r("div",ig,[v.value?(a(),r("div",ng,cg)):f.value?(a(),r("div",dg,[e("div",ug,[gg,mg,e("p",fg,l(f.value),1),e("div",hg,[e("button",{onClick:m,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(Ye),{class:"h-4 w-4 mr-2"}),_(" Volver ")])])])])):i.value?(a(),r("div",vg,[e("div",pg,[e("div",_g,[e("div",bg,[e("button",{onClick:m,class:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(d(Ye),{class:"h-4 w-4 mr-2"}),_(" Volver ")]),e("div",null,[e("h1",yg,l(i.value.title),1),e("p",xg,"Solicitud "+l(i.value.request_number),1)])]),e("div",wg,[e("span",{class:F([de(i.value.status),"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"])},l(V(i.value.status)),3),e("span",{class:F([A(i.value.priority),"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"])},l(T(i.value.priority)),3)])])]),e("div",$g,[e("div",Eg,[e("div",zg,[kg,e("dl",qg,[e("div",null,[Cg,e("dd",Rg,l(i.value.request_type_name),1)]),e("div",null,[Pg,e("dd",Mg,l(z(i.value.created_at)),1)]),i.value.status_updated_at&&i.value.status_updated_at!==i.value.created_at?(a(),r("div",Sg,[Ig,e("dd",Dg,l(z(i.value.status_updated_at)),1)])):k("",!0),e("div",null,[Lg,e("dd",jg,l(i.value.days_since_created)+" días",1)]),i.value.estimated_completion_date?(a(),r("div",Og,[Ng,e("dd",Ag,l(z(i.value.estimated_completion_date)),1)])):k("",!0),i.value.actual_completion_date?(a(),r("div",Ug,[Vg,e("dd",Tg,l(z(i.value.actual_completion_date)),1)])):k("",!0)]),e("div",Gg,[Bg,e("dd",Fg,l(i.value.description),1)])]),i.value.files&&i.value.files.length>0?(a(),r("div",Hg,[Wg,e("div",Zg,[(a(!0),r(Z,null,J(i.value.files,H=>(a(),r("div",{key:H.id,class:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50"},[e("div",Jg,[u(d(Ne),{class:"h-8 w-8 text-gray-400"}),e("div",null,[e("p",Qg,l(H.file_name),1),e("p",Yg,l(M(H.file_size)),1)])]),e("a",{href:H.file_url,target:"_blank",class:"inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50"},[u(d(pt),{class:"h-3 w-3 mr-1"}),_(" Descargar ")],8,Xg)]))),128))])])):k("",!0),e("div",Kg,[e("h3",em," Conversación ("+l(((O=i.value.responses)==null?void 0:O.length)||0)+" respuestas) ",1),i.value.responses&&i.value.responses.length>0?(a(),r("div",tm,[(a(!0),r(Z,null,J(i.value.responses,H=>(a(),r("div",{key:H.id,class:F(["p-4 rounded-lg",H.user_type===p.value?"bg-blue-50 border-l-4 border-blue-400":"bg-gray-50 border-l-4 border-gray-300"])},[e("div",sm,[e("div",om,[e("span",am,l(H.user_name),1),e("span",{class:F(["inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",H.user_type==="corporate_client"?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"])},l(C(H.user_type)),3),H.is_internal_note?(a(),r("span",im," Nota Interna ")):k("",!0)]),e("span",nm,l(D(H.created_at)),1)]),e("p",rm,l(H.response_text),1)],2))),128))])):(a(),r("div",lm,[u(d(Ue),{class:"h-12 w-12 mx-auto mb-3 text-gray-300"}),cm])),e("form",{onSubmit:le(b,["prevent"]),class:"mt-6 border-t pt-6"},[e("div",null,[dm,G(e("textarea",{id:"response","onUpdate:modelValue":N[0]||(N[0]=H=>g.value=H),rows:"3",required:"",disabled:x.value,class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Escribe tu respuesta..."},null,8,um),[[X,g.value]])]),p.value==="corporate_client"?(a(),r("div",gm,[e("label",mm,[G(e("input",{"onUpdate:modelValue":N[1]||(N[1]=H=>y.value=H),type:"checkbox",class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[Ie,y.value]]),fm])])):k("",!0),e("div",hm,[e("button",{type:"submit",disabled:x.value||!g.value.trim(),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},[x.value?(a(),r("div",pm)):(a(),B(d(it),{key:1,class:"h-4 w-4 mr-2"})),_(" "+l(x.value?"Enviando...":"Enviar Respuesta"),1)],8,vm)])],32)])]),e("div",_m,[e("div",bm,[ym,e("div",xm,[e("div",wm,[e("img",{src:E.value,alt:`Avatar de ${(Y=i.value.client_info)==null?void 0:Y.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,$m),e("div",null,[e("p",Em,l((ne=i.value.client_info)==null?void 0:ne.full_name),1),e("p",zm,"Cliente • "+l((Te=i.value.client_info)==null?void 0:Te.email),1)])]),e("div",km,[e("img",{src:$.value,alt:`Avatar de ${(Ge=i.value.corporate_client_info)==null?void 0:Ge.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,qm),e("div",null,[e("p",Cm,l((Be=i.value.corporate_client_info)==null?void 0:Be.full_name),1),e("p",Rm,"Cliente Corporativo • "+l((Fe=i.value.corporate_client_info)==null?void 0:Fe.email),1)])]),i.value.assigned_to_info?(a(),r("div",Pm,[e("img",{src:R.value,alt:`Avatar de ${(He=i.value.assigned_to_info)==null?void 0:He.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,Mm),e("div",null,[e("p",Sm,l((We=i.value.assigned_to_info)==null?void 0:We.full_name),1),e("p",Im,"Asignado • "+l((Ze=i.value.assigned_to_info)==null?void 0:Ze.email),1)])])):k("",!0)])]),i.value.organization_info?(a(),r("div",Dm,[Lm,e("div",jm,[e("img",{src:i.value.organization_info.profile_image||"/src/assets/images/user_avatar.jpg",alt:`Logo de ${i.value.organization_info.title}`,class:"h-10 w-10 rounded-full object-cover border border-gray-200"},null,8,Om),e("div",null,[e("p",Nm,l(i.value.organization_info.title),1),Am])])])):k("",!0),p.value==="corporate_client"?(a(),r("div",Um,[Vm,e("div",Tm,[e("div",null,[Gm,G(e("select",{id:"status","onUpdate:modelValue":N[2]||(N[2]=H=>w.value=H),onChange:h,disabled:q.value,class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},Hm,40,Bm),[[se,w.value]])])])])):k("",!0)])])])):k("",!0)])}}},Zm={key:3,class:"px-4 py-6 sm:px-6 lg:px-8"},Jm=he('<div class="text-center py-12"><div class="mx-auto max-w-md"><svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"></path></svg><h3 class="mt-2 text-sm font-medium text-gray-900">Acceso Restringido</h3><p class="mt-1 text-sm text-gray-500"> No tienes permisos para acceder a este módulo. </p></div></div>',1),Qm=[Jm],uf={__name:"Dashboard",setup(t){const s=qe(),o=I(()=>{var n;return((n=s.currentUser)==null?void 0:n.role)||null});return(n,c)=>(a(),r("div",null,[n.$route.query.tab==="request-detail"?(a(),B(Wm,{key:0})):o.value==="corporate_client"?(a(),B(_l,{key:1})):o.value==="client"?(a(),B(ag,{key:2})):(a(),r("div",Zm,Qm))]))}};export{uf as default};
