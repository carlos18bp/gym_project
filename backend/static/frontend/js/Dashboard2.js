import{r as k,e as r,f as m,g as t,j as o,l as i,n as C,i as h,F as x,c as S,H as P,aS as X,t as D,w as N,M as W,k as b,I as U,L as M,u as T,o as E,aa as L,ab as O,ac as V,ad as j,a9 as H,P as I,a5 as Y}from"./index.js";import{u as Q,s as F,p as R,o as A}from"./dynamicDocument.js";import{_ as Z}from"./SearchBarAndFilterBy.js";import{c as z,r as B,b as ee,f as te,g as se,h as q,_ as G,a as oe,D as ae,d as ne,i as le}from"./DocumentListClient.js";import{_ as J}from"./ModalTransition.js";import"./MagnifyingGlassIcon.js";import"./_plugin-vue_export-helper.js";import"./loading_message.js";import"./useRecentViews.js";const re={key:0,class:"pb-8 border-b border-gray-200 flex gap-6 flex-wrap"},ie=t("div",{class:"grid"},[t("span",{class:"font-medium text-base"},"Documentos"),t("span",{class:"text-gray-400 font-regular text-sm"},"Mi unidad")],-1),ce=t("div",{class:"grid"},[t("span",{class:"font-medium text-base"},"Documentos Finalizados"),t("span",{class:"text-gray-400 font-regular text-sm"},"Clientes")],-1),de=t("div",{class:"grid"},[t("span",{class:"font-medium text-base"},"Documentos en Progreso"),t("span",{class:"text-gray-400 font-regular text-sm"},"Clientes")],-1),ue=t("div",{class:"grid"},[t("span",{class:"font-medium text-base"},"Nuevo Documento")],-1),me={key:1,class:"pb-8 border-b border-gray-200 flex gap-6 flex-wrap"},ge=t("div",{class:"grid"},[t("span",{class:"font-medium text-base"},"Mis Documentos")],-1),pe=t("div",{class:"grid"},[t("span",{class:"font-medium text-base"},"Nuevo Documento")],-1),fe={__name:"DocumentsNavigation",props:{role:String},emits:["updateCurrentSection","openNewDocument"],setup(w,{emit:u}){const n=u,c=k("default"),l=w,_=f=>{c.value=f,n("updateCurrentSection",f)};return(f,g)=>(r(),m(x,null,[(l==null?void 0:l.role)==="lawyer"?(r(),m("div",re,[t("button",{onClick:g[0]||(g[0]=d=>_("default")),class:C(["flex gap-2 items-center py-2 px-4 rounded-xl border-2 border-yellow-300 text-start bg-white",{"bg-yellow-300/30":c.value=="default"}])},[o(i(z),{class:"size-6 text-yellow-500 font-semibold"}),ie],2),t("button",{onClick:g[1]||(g[1]=d=>_("documentFinished")),class:C(["flex gap-2 items-center py-2 px-4 rounded-xl border-2 border-yellow-300 bg-white text-start",{"bg-yellow-300/30":c.value=="documentFinished"}])},[o(i(z),{class:"size-6 text-yellow-500 font-semibold"}),ce],2),t("button",{onClick:g[2]||(g[2]=d=>_("documentInProgress")),class:C(["flex gap-2 items-center py-2 px-4 rounded-xl border-2 border-yellow-300 bg-white text-start",{"bg-yellow-300/30":c.value=="documentInProgress"}])},[o(i(z),{class:"size-6 text-yellow-500 font-semibold"}),de],2),t("button",{onClick:g[3]||(g[3]=d=>f.$emit("openNewDocument")),class:"flex gap-2 items-center py-2 px-4 rounded-md bg-white text-start hover:bg-gray-100"},[o(i(B),{class:"size-6 text-secondary font-semibold"}),ue])])):h("",!0),(l==null?void 0:l.role)==="client"?(r(),m("div",me,[t("button",{onClick:g[4]||(g[4]=d=>_("default")),class:C(["flex gap-2 items-center py-2 px-4 rounded-md border-2 border-yellow-300 bg-white text-start",{"bg-yellow-300/30":c.value=="default"}])},[o(i(z),{class:"size-6 text-yellow-500 font-semibold"}),ge],2),t("button",{onClick:g[5]||(g[5]=d=>_("useDocument")),class:C(["flex gap-2 items-center py-2 px-4 rounded-md bg-white text-start hover:bg-gray-100",{"bg-selected-background":c.value=="useDocument"}])},[o(i(B),{class:"size-6 text-secondary font-semibold"}),pe],2)])):h("",!0)],64))}},_e={class:"mt-8 flex flex-wrap gap-6"},ve=["onClick"],be={class:"grid gap-1"},ye={class:"text-base font-medium"},he={class:"text-sm font-regular text-gray-400"},xe={__name:"UseDocument",props:{searchQuery:String},setup(w){const u=Q(),n=k(!1),c=k(null),l=w,_=S(()=>{const d=u.publishedDocumentsUnassigned;return u.filteredDocuments(l.searchQuery,"").filter(y=>d.some(a=>a.id===y.id))});function f(d){d&&(c.value=d,n.value=!0)}const g=d=>{if(n.value=!1,c.value=null,d&&d.updatedDocId){u.lastUpdatedDocumentId=d.updatedDocId,localStorage.setItem("lastUpdatedDocumentId",d.updatedDocId);const y=window.location.pathname;y==="/dynamic_document_dashboard"||y==="/dynamic_document_dashboard/"?setTimeout(()=>{window.forceDocumentHighlight&&window.forceDocumentHighlight(d.updatedDocId)},100):setTimeout(()=>{window.location.href="/dynamic_document_dashboard"},500)}};return(d,y)=>(r(),m("div",_e,[(r(!0),m(x,null,P(_.value,a=>(r(),m("button",{key:a.id,onClick:v=>f(a.id),class:"flex items-center gap-3 py-2 px-4 border rounded-xl border-stroke bg-white hover:bg-gray-100"},[o(i(X),{class:"size-6 text-secondary"}),t("div",be,[t("span",ye,D(a.title),1),t("span",he,D(a.description),1)]),o(i(ee),{class:"size-6 text-gray-400"})],8,ve))),128)),N(o(J,null,{default:b(()=>[c.value!==null?(r(),U(te,{key:0,"document-id":c.value,onClose:g},null,8,["document-id"])):h("",!0)]),_:1},512),[[W,n.value]])]))}},we={class:"flex justify-between items-center w-full"},De={class:"grid gap-1"},$e={class:"text-base font-medium"},ke={class:"text-sm font-regular text-gray-400"},Ce=t("span",{class:"sr-only"},"Open options",-1),Se={class:"py-1"},Pe=["onClick"],Ie={__name:"DocumentFinishedByClientList",props:{searchQuery:String},setup(w){const u=Q(),n=M(),c=T();E(()=>{u.init(),n.init()});const l=w,_=S(()=>{const e=u.completedDocumentsByClient;return u.filteredDocuments(l.searchQuery,n).filter(s=>e.some(p=>p.id===s.id))}),f=[{label:"Editar",action:"edit"},{label:"Previsualización",action:"preview"},{label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"}],g=(e,s)=>{switch(e.action){case"edit":d(s);break;case"preview":A(s);break;case"downloadPDF":a(s);break;case"downloadWord":v(s);break;default:console.warn("Unknown action:",e.action)}},d=e=>{const s=encodeURIComponent(e.title.trim());c.push(`/dynamic_document_dashboard/document/use/editor/${e.id}/${s}`)},y=e=>{const s=n.userById(e);return s?`${s.first_name} ${s.last_name}`:"Desconocido"},a=e=>{u.downloadPDF(e.id,e.title)},v=e=>{u.downloadWord(e.id,e.title)};return(e,s)=>(r(),m(x,null,[(r(!0),m(x,null,P(_.value,p=>(r(),m("div",{key:p.id,class:"flex items-center gap-3 py-2 px-4 border rounded-lg border-green-400 bg-green-300/30"},[o(i(se),{class:"size-8 text-green-500"}),t("div",we,[t("div",De,[t("span",$e,D(p.title),1),t("span",ke,D(y(p.assigned_to)),1)]),o(i(H),{as:"div",class:"relative inline-block text-left"},{default:b(()=>[t("div",null,[o(i(L),{class:"flex items-center text-gray-400"},{default:b(()=>[Ce,o(i(q),{class:"size-6","aria-hidden":"true"})]),_:1})]),o(O,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:b(()=>[o(i(V),{class:"absolute left-0 z-10 mt-2 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black/5"},{default:b(()=>[t("div",Se,[(r(),m(x,null,P(f,$=>o(i(j),{key:$.label},{default:b(()=>[t("button",{onClick:K=>g($,p),class:"block w-full text-left px-4 py-2 text-sm font-regular cursor-pointer hover:bg-gray-100 transition"},D($.label),9,Pe)]),_:2},1024)),64))])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]))),128)),o(G,{isVisible:i(F),documentData:i(R),onClose:s[0]||(s[0]=p=>F.value=!1)},null,8,["isVisible","documentData"])],64))}},ze={class:"flex justify-between items-center w-full"},Fe={class:"grid gap-1"},Qe={class:"text-base font-medium"},Ue={class:"text-sm font-regular text-gray-400"},Me=t("span",{class:"sr-only"},"Open options",-1),Ee={class:"py-1"},Be=["onClick"],Ne={__name:"DocumentInProgressByClientList",props:{searchQuery:String},setup(w){const u=Q(),n=M(),c=T();E(()=>{u.init(),n.init()});const l=w,_=S(()=>{const e=u.progressDocumentsByClient;return u.filteredDocuments(l.searchQuery,n).filter(s=>e.some(p=>p.id===s.id))}),f=[{label:"Editar",action:"edit"},{label:"Previsualización",action:"preview"},{label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"}],g=(e,s)=>{switch(e.action){case"edit":d(s);break;case"preview":A(s);break;case"downloadPDF":a(s);break;case"downloadWord":v(s);break;default:console.warn("Unknown action:",e.action)}},d=e=>{const s=encodeURIComponent(e.title.trim());c.push(`/dynamic_document_dashboard/document/use/editor/${e.id}/${s}`)},y=e=>{const s=n.userById(e);return s?`${s.first_name} ${s.last_name}`:"Desconocido"},a=e=>{u.downloadPDF(e.id,e.title)},v=e=>{u.downloadWord(e.id,e.title)};return(e,s)=>(r(),m(x,null,[(r(!0),m(x,null,P(_.value,p=>(r(),m("div",{key:p.id,class:"flex items-center gap-3 py-2 px-4 border rounded-lg border-stroke bg-white"},[o(i(oe),{class:"size-8 text-secondary"}),t("div",ze,[t("div",Fe,[t("span",Qe,D(p.title),1),t("span",Ue,D(y(p.assigned_to)),1)]),o(i(H),{as:"div",class:"relative inline-block text-left"},{default:b(()=>[t("div",null,[o(i(L),{class:"flex items-center text-gray-400"},{default:b(()=>[Me,o(i(q),{class:"size-6","aria-hidden":"true"})]),_:1})]),o(O,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:b(()=>[o(i(V),{class:"absolute left-0 z-10 mt-2 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black/5"},{default:b(()=>[t("div",Ee,[(r(),m(x,null,P(f,$=>o(i(j),{key:$.label},{default:b(()=>[t("button",{onClick:K=>g($,p),class:"block w-full text-left px-4 py-2 text-sm font-regular cursor-pointer hover:bg-gray-100 transition"},D($.label),9,Be)]),_:2},1024)),64))])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]))),128)),o(G,{isVisible:i(F),documentData:i(R),onClose:s[0]||(s[0]=p=>F.value=!1)},null,8,["isVisible","documentData"])],64))}},We={class:"p-4 sm:p-6 lg:p-10 lg:px-8"},Te={key:0,class:"mt-6"},Le={key:0,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4"},Oe={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4"},Ve={key:2,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4"},je={key:3,class:"mt-6 text-center text-gray-400 font-regular"},He=t("p",null,"No hay documentos disponibles para mostrar.",-1),Re=[He],Ae={key:1,class:"mt-6"},qe={class:"mt-6 sm:mt-8 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4"},ot={__name:"Dashboard",setup(w){const u=M(),n=Q(),c=k(""),l=k("default"),_=k(!1),f=S(()=>u.getCurrentUser),g=S(()=>{var v,e;let a=[];return((v=f.value)==null?void 0:v.role)==="lawyer"?a=n.draftAndPublishedDocumentsUnassigned:((e=f.value)==null?void 0:e.role)==="client"&&(a=n.progressAndCompletedDocumentsByClient(f.value.id)),n.filteredDocuments(c.value,u).filter(s=>a.some(p=>p.id===s.id))});E(async()=>{await u.init(),await n.init(),n.selectedDocument=null,l.value="default";const a=localStorage.getItem("lastUpdatedDocumentId");a&&n.documents.some(e=>e.id.toString()===a)&&(n.lastUpdatedDocumentId=parseInt(a))});const d=a=>{l.value=a,n.selectedDocument=null},y=()=>{_.value=!1,l.value="default",n.selectedDocument=null};return I(()=>n.lastUpdatedDocumentId,(a,v)=>{if(a&&a!==v&&l.value==="default"){const e=Date.now();(!I.lastExecutionTime||e-I.lastExecutionTime>100)&&(I.lastExecutionTime=e,l.value="default")}},{immediate:!1}),(a,v)=>{var e,s;return r(),m(x,null,[o(Z,{"onUpdate:searchQuery":v[0]||(v[0]=p=>c.value=p)},{default:b(()=>[Y(a.$slots,"default")]),_:3}),t("div",We,[o(fe,{onOpenNewDocument:v[1]||(v[1]=p=>_.value=!0),onUpdateCurrentSection:d,role:f.value.role},null,8,["role"]),((e=f.value)==null?void 0:e.role)==="lawyer"?(r(),m("div",Te,[l.value==="documentFinished"?(r(),m("div",Le,[o(Ie,{searchQuery:c.value},null,8,["searchQuery"])])):h("",!0),l.value==="documentInProgress"?(r(),m("div",Oe,[o(Ne,{searchQuery:c.value},null,8,["searchQuery"])])):h("",!0),l.value==="default"?(r(),m("div",Ve,[o(ae,{searchQuery:c.value},null,8,["searchQuery"])])):h("",!0),l.value==="default"&&g.value.length===0?(r(),m("div",je,Re)):h("",!0)])):h("",!0),((s=f.value)==null?void 0:s.role)==="client"?(r(),m("div",Ae,[l.value==="useDocument"?(r(),U(xe,{key:0,searchQuery:c.value},null,8,["searchQuery"])):h("",!0),t("div",qe,[l.value==="default"?(r(),U(ne,{key:0,searchQuery:c.value},null,8,["searchQuery"])):h("",!0)])])):h("",!0)]),N(o(J,null,{default:b(()=>[o(le,{onClose:y})]),_:1},512),[[W,_.value]])],64)}}};export{ot as default};
