import{C as J,D as E,E as V,G as A,H as O,u as Y,I as Q,r as d,c as L,o as X,S as u,e as p,f as m,g as e,t as i,j as N,n as U,F as Z,J as ee,w as S,v as P,p as T,l as te,x as B,q as se}from"./index-BWL8Y4C8.js";const oe=J("subscription",{state:()=>({currentSubscription:null,subscriptionHistory:[],isLoading:!1,wompiPublicKey:null}),getters:{hasActiveSubscription:t=>{var s;return((s=t.currentSubscription)==null?void 0:s.status)==="active"},isFreePlan:t=>{var s;return((s=t.currentSubscription)==null?void 0:s.plan_type)==="basico"},isPaidPlan:t=>{var s;return["cliente","corporativo"].includes((s=t.currentSubscription)==null?void 0:s.plan_type)},nextBillingDate:t=>{var s;return(s=t.currentSubscription)==null?void 0:s.next_billing_date}},actions:{async fetchCurrentSubscription(){var t;this.isLoading=!0;try{const s=await E("subscriptions/current/");return this.currentSubscription=s.data,s.data}catch(s){if(((t=s.response)==null?void 0:t.status)===404)this.currentSubscription=null;else throw console.error("Error fetching subscription:",s),s}finally{this.isLoading=!1}},async fetchSubscriptionHistory(){this.isLoading=!0;try{const t=await E("subscriptions/history/");return this.subscriptionHistory=t.data,t.data}catch(t){throw console.error("Error fetching subscription history:",t),t}finally{this.isLoading=!1}},async generateWompiSignature(t){try{return(await V("subscriptions/generate-signature/",t)).data.signature}catch(s){throw console.error("Error generating Wompi signature:",s),s}},async fetchWompiPublicKey(){try{const t=await E("subscriptions/wompi-config/");return this.wompiPublicKey=t.data.public_key,t.data.public_key}catch(t){throw console.error("Error fetching Wompi config:",t),t}},async createSubscription(t){this.isLoading=!0;try{const s=await V("subscriptions/create/",t);return this.currentSubscription=s.data,s.data}catch(s){throw console.error("Error creating subscription:",s),s}finally{this.isLoading=!1}},async cancelSubscription(){this.isLoading=!0;try{const t=await A("subscriptions/cancel/",{});return this.currentSubscription=t.data,t.data}catch(t){throw console.error("Error cancelling subscription:",t),t}finally{this.isLoading=!1}},async reactivateSubscription(){this.isLoading=!0;try{const t=await A("subscriptions/reactivate/",{});return this.currentSubscription=t.data,t.data}catch(t){throw console.error("Error reactivating subscription:",t),t}finally{this.isLoading=!1}},async updatePaymentMethod(t){this.isLoading=!0;try{const s=await A("subscriptions/update-payment-method/",{payment_source_id:t});return this.currentSubscription=s.data,s.data}catch(s){throw console.error("Error updating payment method:",s),s}finally{this.isLoading=!1}},async fetchPaymentHistory(){try{return(await E("subscriptions/payments/")).data}catch(t){throw console.error("Error fetching payment history:",t),t}},resetState(){this.currentSubscription=null,this.subscriptionHistory=[],this.isLoading=!1,this.wompiPublicKey=null}}}),re={class:"min-h-screen bg-gray-50"},ae=e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),ne=e("span",{class:"text-sm font-medium"},"Volver a planes",-1),ie=[ae,ne],ce=e("h1",{class:"text-xl font-bold text-primary"},"Finalizar Suscripción",-1),le=e("div",{class:"w-24"},null,-1),de={class:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12"},ue={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},pe={class:"lg:col-span-2 space-y-6"},me={class:"bg-white rounded-xl border border-gray-200 p-6"},ge=e("h2",{class:"text-lg font-semibold text-primary mb-4"},"Información de contacto",-1),he={class:"bg-terciary border border-stroke rounded-lg p-4"},ve={class:"flex items-center gap-3"},be={class:"h-12 w-12 rounded-full bg-secondary flex items-center justify-center text-white font-semibold"},fe={class:"font-medium text-gray-900"},ye={class:"text-sm text-gray-600"},xe={class:"bg-white rounded-xl border border-gray-200 p-6"},_e=e("h2",{class:"text-lg font-semibold text-primary mb-4"},"Plan seleccionado",-1),we={class:"border border-gray-200 rounded-lg p-6"},Ce={class:"flex items-start justify-between mb-4"},ke={class:"text-sm text-gray-600 mt-1"},Se={class:"text-right"},Pe={class:"text-2xl font-bold text-primary"},Fe={class:"text-sm text-gray-500"},je={class:"border-t border-gray-200 pt-4 mt-4"},Ee=e("p",{class:"text-sm font-medium text-gray-700 mb-3"},"Características principales:",-1),Be={class:"space-y-2"},Me=e("svg",{class:"h-4 w-4 text-secondary flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),ze={key:0,class:"bg-white rounded-xl border border-gray-200 p-6"},Ie=e("h2",{class:"text-lg font-semibold text-primary mb-4"},"Método de pago",-1),Ae={key:0,class:"border-2 border-dashed border-gray-300 rounded-lg p-8"},Le=B('<div class="text-center mb-6"><svg class="h-16 w-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg><h3 class="text-lg font-semibold text-gray-900 mb-2">Configura tu método de pago</h3><p class="text-sm text-gray-600">Ingresa los datos de tu tarjeta para continuar.</p></div>',1),Ne={class:"space-y-4"},Ue=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre del titular",-1),Ve=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Número de tarjeta",-1),Te={class:"grid grid-cols-3 gap-3"},He=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Mes",-1),De=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Año",-1),$e=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"CVC",-1),We=["disabled"],Ke={key:0,class:"flex items-center justify-center gap-2"},qe=e("svg",{class:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),Ge={key:1},Re={key:1,class:"border border-green-500 bg-green-50 rounded-lg p-6"},Je=B('<svg class="h-6 w-6 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class="flex-1"><p class="font-semibold text-green-900">Método de pago configurado</p><p class="text-sm text-green-700 mt-1">Tu método de pago ha sido guardado de forma segura</p></div>',2),Oe=B('<div class="mt-4 bg-terciary border border-stroke rounded-lg p-4"><div class="flex items-start gap-3"><svg class="h-5 w-5 text-secondary flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg><div><p class="text-sm font-medium text-gray-900">Pago seguro</p><p class="text-xs text-gray-600 mt-1">Tus datos están protegidos y encriptados por Wompi. No almacenamos información de tu tarjeta.</p></div></div></div>',1),Ye={class:"lg:col-span-1"},Qe={class:"bg-white rounded-xl border border-gray-200 p-6 sticky top-8"},Xe=e("h2",{class:"text-lg font-semibold text-primary mb-4"},"Resumen del pedido",-1),Ze={class:"space-y-3 mb-6"},et={class:"flex justify-between text-sm"},tt={class:"text-gray-600"},st={class:"font-medium text-gray-900"},ot={class:"flex justify-between text-sm"},rt={class:"text-gray-600"},at={class:"font-medium text-gray-900"},nt={class:"border-t border-gray-200 pt-3 mt-3"},it={class:"flex justify-between"},ct=e("span",{class:"text-sm text-gray-600"},"Subtotal",-1),lt={class:"text-sm font-medium text-gray-900"},dt={class:"border-t border-gray-200 pt-3"},ut={class:"flex justify-between"},pt=e("span",{class:"font-semibold text-gray-900"},"Total a pagar hoy",-1),mt={class:"text-xl font-bold text-primary"},gt=["disabled"],ht={key:0,class:"flex items-center justify-center gap-2"},vt=e("svg",{class:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),bt={key:1},ft=B('<div class="text-center"><div class="flex items-center justify-center gap-2 text-xs text-gray-500 mb-2"><svg class="h-4 w-4 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg><span>Pago seguro y protegido</span></div><p class="text-xs text-gray-500">30 días de garantía de reembolso</p></div>',1),xt={__name:"Checkout",setup(t){const s=O(),M=Y(),g=Q(),z=oe(),I=d(s.params.plan),h=d(!1),x=d(null),_=d(""),w=d(""),C=d(""),k=d(""),F=d(""),b=d(null),j=d(null),f=d(!1),n=L(()=>{const a={basico:{name:"Plan Básico",description:"Personas con necesidades legales básicas",price:"Gratuito",billing:"/mes",duration:"48 meses",color:"text-primary",amountInCents:0,keyFeatures:["Consulta Procesos Judiciales","+100 Documentos Jurídicos","Firma Electrónica (solo recibe)"]},cliente:{name:"Plan Cliente",description:"Clientes individuales o emprendedores",price:"$22,900 COP",billing:"/mes",duration:"48 meses",color:"text-secondary",amountInCents:229e4,keyFeatures:["+500 Documentos Premium","Membrete Personalizado","Firma Electrónica completa","Envío ilimitado de documentos","3 docs personalizados incluidos","2h consultoría mensual"]},corporativo:{name:"Plan Corporativo",description:"Empresas, pymes y organizaciones",price:"$550,000 COP",billing:"/mes",duration:"48 meses",color:"text-primary",amountInCents:55e6,keyFeatures:["+1000 Docs Premium y Corporativos","Usuarios Vinculados","Módulo de Organizaciones","5 docs de alta complejidad","10 revisiones mensuales","10h consultoría mensual"]}};return a[I.value]||a.basico}),H=L(()=>n.value.color),D=L(()=>{var o,l;const a=((o=g.currentUser)==null?void 0:o.first_name)||"",r=((l=g.currentUser)==null?void 0:l.last_name)||"";return`${a.charAt(0)}${r.charAt(0)}`.toUpperCase()}),$=()=>{M.push({name:"subscriptions"})},W=()=>new Promise((a,r)=>{if(document.getElementById("wompi-widget-script")){a();return}const o=document.createElement("script");o.id="wompi-widget-script",o.src="https://checkout.wompi.co/widget.js",o.async=!0,o.onload=a,o.onerror=r,document.head.appendChild(o)}),K=()=>new Promise((a,r)=>{if(document.getElementById("wompi-js-script")){a();return}const o=document.createElement("script");o.id="wompi-js-script",o.src="https://wompijs.wompi.com/libs/js/v1.js",o.async=!0,x.value&&(o.dataset.publicKey=x.value),o.onload=a,o.onerror=r,document.head.appendChild(o)}),q=async()=>{var a,r,o,l,v;if(!f.value){if(!_.value||!w.value||!C.value||!k.value){await u.fire({title:"Información incompleta",text:"Por favor, completa todos los campos de la tarjeta.",icon:"warning",confirmButtonColor:"#3348FF"});return}if(!x.value){await u.fire({title:"Error",text:"No se pudo cargar la configuración de pagos. Por favor, recarga la página.",icon:"error",confirmButtonColor:"#3348FF"});return}f.value=!0;try{const c={number:_.value.replace(/\s+/g,""),cvc:k.value,exp_month:w.value,exp_year:C.value,card_holder:F.value||`${((a=g.currentUser)==null?void 0:a.first_name)||""} ${((r=g.currentUser)==null?void 0:r.last_name)||""}`.trim()},y=await se.post("https://sandbox.wompi.co/v1/tokens/cards",c,{headers:{Authorization:`Bearer ${x.value}`,"Content-Type":"application/json"}});if(y.data&&y.data.status==="CREATED"&&((o=y.data.data)!=null&&o.id))b.value=y.data.data.id,await u.fire({title:"¡Método de pago agregado!",text:"Tu método de pago ha sido configurado exitosamente.",icon:"success",confirmButtonColor:"#3348FF",timer:2e3});else throw new Error("Respuesta inesperada al tokenizar la tarjeta")}catch(c){await u.fire({title:"Error",text:((v=(l=c.response)==null?void 0:l.data)==null?void 0:v.error)||"No se pudo guardar tu método de pago. Por favor, intenta nuevamente.",icon:"error",confirmButtonColor:"#3348FF"})}finally{f.value=!1}}},G=()=>{b.value=null,_.value="",w.value="",C.value="",k.value="",F.value=""},R=async()=>{var a,r,o,l;if(!h.value){if(n.value.amountInCents===0){h.value=!0;try{await z.createSubscription({plan_type:I.value}),await u.fire({title:"¡Suscripción Activada!",text:"Tu plan gratuito ha sido activado exitosamente.",icon:"success",confirmButtonColor:"#3348FF"}),M.push({name:"dashboard"})}catch(v){await u.fire({title:"Error",text:((r=(a=v.response)==null?void 0:a.data)==null?void 0:r.error)||"No se pudo activar tu suscripción. Por favor, intenta nuevamente.",icon:"error",confirmButtonColor:"#3348FF"})}finally{h.value=!1}return}if(!b.value){await u.fire({title:"Método de pago requerido",text:"Por favor, completa la información de pago antes de continuar.",icon:"warning",confirmButtonColor:"#3348FF"});return}if(!j.value){await u.fire({title:"Error",text:"No se pudo inicializar la sesión de pago. Por favor, recarga la página e intenta nuevamente.",icon:"error",confirmButtonColor:"#3348FF"});return}h.value=!0;try{await z.createSubscription({plan_type:I.value,session_id:j.value,token:b.value}),await u.fire({title:"¡Suscripción Creada!",text:"Tu suscripción ha sido activada exitosamente. Se realizará el primer cobro ahora.",icon:"success",confirmButtonColor:"#3348FF"}),M.push({name:"dashboard"})}catch(v){await u.fire({title:"Error",text:((l=(o=v.response)==null?void 0:o.data)==null?void 0:l.error)||"No se pudo crear tu suscripción. Por favor, intenta nuevamente.",icon:"error",confirmButtonColor:"#3348FF"})}finally{h.value=!1}}};return X(async()=>{if(g.currentUser||await g.init(),n.value.amountInCents>0)try{x.value=await z.fetchWompiPublicKey(),await W(),await K(),window.$wompi&&!j.value&&window.$wompi.initialize((a,r)=>{r===null&&(j.value=a.sessionId)})}catch{await u.fire({title:"Error",text:"No se pudo cargar la configuración de pagos. Por favor, recarga la página.",icon:"error",confirmButtonColor:"#3348FF"})}}),(a,r)=>{var o,l,v;return p(),m("div",re,[e("div",{class:"bg-white border-b border-gray-200"},[e("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},[e("div",{class:"flex items-center justify-between"},[e("button",{onClick:$,class:"flex items-center gap-2 text-gray-600 hover:text-primary transition-colors"},ie),ce,le])])]),e("div",de,[e("div",ue,[e("div",pe,[e("div",me,[ge,e("div",he,[e("div",ve,[e("div",be,i(D.value),1),e("div",null,[e("p",fe,i((o=N(g).currentUser)==null?void 0:o.first_name)+" "+i((l=N(g).currentUser)==null?void 0:l.last_name),1),e("p",ye,i((v=N(g).currentUser)==null?void 0:v.email),1)])])])]),e("div",xe,[_e,e("div",we,[e("div",Ce,[e("div",null,[e("h3",{class:U(["text-xl font-bold",H.value])},i(n.value.name),3),e("p",ke,i(n.value.description),1)]),e("div",Se,[e("p",Pe,i(n.value.price),1),e("p",Fe,i(n.value.billing),1)])]),e("div",je,[Ee,e("div",Be,[(p(!0),m(Z,null,ee(n.value.keyFeatures,(c,y)=>(p(),m("div",{key:y,class:"flex items-start gap-2 text-sm text-gray-700"},[Me,e("span",null,i(c),1)]))),128))])])])]),n.value.amountInCents>0?(p(),m("div",ze,[Ie,b.value?(p(),m("div",Re,[e("div",{class:"flex items-start gap-3"},[Je,e("button",{onClick:G,class:"text-sm text-secondary hover:text-blue-700 font-medium"}," Cambiar ")])])):(p(),m("div",Ae,[Le,e("div",Ne,[e("div",null,[Ue,S(e("input",{"onUpdate:modelValue":r[0]||(r[0]=c=>F.value=c),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent",placeholder:"Como aparece en la tarjeta"},null,512),[[P,F.value]])]),e("div",null,[Ve,S(e("input",{"onUpdate:modelValue":r[1]||(r[1]=c=>_.value=c),type:"text",inputmode:"numeric",autocomplete:"cc-number",class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent",placeholder:"0000 0000 0000 0000"},null,512),[[P,_.value]])]),e("div",Te,[e("div",null,[He,S(e("input",{"onUpdate:modelValue":r[2]||(r[2]=c=>w.value=c),type:"text",inputmode:"numeric",maxlength:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent",placeholder:"MM"},null,512),[[P,w.value]])]),e("div",null,[De,S(e("input",{"onUpdate:modelValue":r[3]||(r[3]=c=>C.value=c),type:"text",inputmode:"numeric",maxlength:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent",placeholder:"AA"},null,512),[[P,C.value]])]),e("div",null,[$e,S(e("input",{"onUpdate:modelValue":r[4]||(r[4]=c=>k.value=c),type:"password",inputmode:"numeric",maxlength:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent",placeholder:"CVC"},null,512),[[P,k.value]])])]),e("button",{onClick:q,disabled:f.value,class:U(["w-full px-6 py-3 rounded-lg text-base font-semibold text-white transition-all duration-200",f.value?"bg-gray-400 cursor-not-allowed":"bg-secondary hover:bg-blue-700"])},[f.value?(p(),m("span",Ke,[qe,T(" Guardando método de pago... ")])):(p(),m("span",Ge," Guardar método de pago "))],10,We)])])),Oe])):te("",!0)]),e("div",Ye,[e("div",Qe,[Xe,e("div",Ze,[e("div",et,[e("span",tt,i(n.value.name),1),e("span",st,i(n.value.price),1)]),e("div",ot,[e("span",rt,"Plan de "+i(n.value.duration),1),e("span",at,i(n.value.billing),1)]),e("div",nt,[e("div",it,[ct,e("span",lt,i(n.value.price),1)])]),e("div",dt,[e("div",ut,[pt,e("span",mt,i(n.value.price),1)])])]),e("button",{onClick:R,disabled:h.value||n.value.amountInCents>0&&!b.value,class:U({"w-full px-6 py-3 bg-secondary rounded-lg text-base font-semibold text-white hover:bg-blue-700 transition-all duration-200 mb-4":!h.value&&(n.value.amountInCents===0||b.value),"w-full px-6 py-3 bg-gray-400 rounded-lg text-base font-semibold text-white cursor-not-allowed mb-4":h.value||n.value.amountInCents>0&&!b.value})},[h.value?(p(),m("span",ht,[vt,T(" Procesando... ")])):(p(),m("span",bt,i(n.value.amountInCents===0?"Activar Plan Gratuito":"Confirmar Suscripción"),1))],10,gt),ft])])])])])}}};export{xt as default};
