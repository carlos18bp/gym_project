import{e as n,f as r,g as s,P as $,r as x,c as P,s as z,o as N,l as t,n as S,p as A,t as m,w as q,v as T,aS as I,i as h,F as R,M as O}from"./index.js";import{u as G}from"./index3.js";function Oe(g,f){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})])}const L=[{id:0,name:"Gris Suave",light:"#F5F5F5",dark:"#9E9E9E",hex:"#E0E0E0"},{id:1,name:"Rosa Pastel",light:"#FCE4EC",dark:"#AD1457",hex:"#F8BBD9"},{id:2,name:"Lavanda",light:"#F3E5F5",dark:"#7B1FA2",hex:"#E1BEE7"},{id:3,name:"Azul Suave",light:"#E3F2FD",dark:"#1565C0",hex:"#BBDEFB"},{id:4,name:"Verde Menta",light:"#E8F5E8",dark:"#2E7D32",hex:"#C8E6C9"},{id:5,name:"Amarillo Pastel",light:"#FFF8E1",dark:"#F57F17",hex:"#FFF176"},{id:6,name:"Durazno",light:"#FFF3E0",dark:"#E65100",hex:"#FFCC80"},{id:7,name:"Coral",light:"#FFEBEE",dark:"#C62828",hex:"#FFCDD2"},{id:8,name:"Turquesa",light:"#E0F2F1",dark:"#00695C",hex:"#B2DFDB"},{id:9,name:"Violeta",light:"#EDE7F6",dark:"#4527A0",hex:"#D1C4E9"},{id:10,name:"Salmón",light:"#FFF4E6",dark:"#BF360C",hex:"#FFAB91"},{id:11,name:"Aqua",light:"#E1F5FE",dark:"#0277BD",hex:"#81D4FA"},{id:12,name:"Lima",light:"#F1F8E9",dark:"#558B2F",hex:"#DCEDC8"},{id:13,name:"Lila",light:"#F9FBE7",dark:"#9E9D24",hex:"#E6EE9C"},{id:14,name:"Crema",light:"#FFFDE7",dark:"#F9A825",hex:"#FFF59D"},{id:15,name:"Celeste",light:"#E8EAF6",dark:"#303F9F",hex:"#C5CAE9"}];function Ge(g){return L.find(f=>f.id===g)||L[0]}function Qe(){return L}function Q(){const g=G(),f=$(),u=x([]),c=x([]),a=x([]),d=x(!1),y=x(!1),b=x(""),l=P(()=>{var e;return((e=f.getCurrentUser)==null?void 0:e.role)==="lawyer"}),p=P(()=>{if(!Array.isArray(u.value))return[];if(!b.value.trim())return u.value;const e=b.value.toLowerCase().trim();return u.value.filter(o=>{var i,v;return((i=o.full_name)==null?void 0:i.toLowerCase().includes(e))||((v=o.email)==null?void 0:v.toLowerCase().includes(e))})}),C=P(()=>Array.isArray(u.value)&&u.value.length>0),E=P(()=>Array.isArray(p.value)&&p.value.length>0),k=async()=>{if(l.value){y.value=!0;try{const e=await g.fetchAvailableClients();u.value=Array.isArray(e)?e:[]}catch(e){console.error("Error loading available clients:",e),await z("Error al cargar clientes disponibles","error"),u.value=[]}finally{y.value=!1}}},w=async e=>{if(!(!e||!l.value))try{const o=await g.fetchDocumentPermissions(e);F(o)}catch(o){console.error("Error loading document permissions:",o),F(g.selectedDocument)}},F=e=>{if(!(!e||!l.value)&&(c.value=[],a.value=[],d.value=!1,typeof e.is_public=="boolean"&&(d.value=e.is_public),!d.value)){if(e.visibility_permissions&&Array.isArray(e.visibility_permissions)){const o=e.visibility_permissions.filter(i=>i.user_id&&i.email&&i.full_name);c.value=o.map(i=>({id:i.user_id,user_id:i.user_id,email:i.email,full_name:i.full_name}))}if(e.usability_permissions&&Array.isArray(e.usability_permissions)){const o=e.usability_permissions.filter(i=>i.user_id&&i.email&&i.full_name);a.value=o.map(i=>({id:i.user_id,user_id:i.user_id,email:i.email,full_name:i.full_name}))}}};return{availableClients:u,selectedVisibilityUsers:c,selectedUsabilityUsers:a,isPublicDocument:d,isLoadingClients:y,clientSearchQuery:b,isLawyer:l,filteredClients:p,hasAvailableClients:C,hasFilteredClients:E,loadAvailableClients:k,loadDocumentPermissions:w,initializeExistingPermissions:F,toggleVisibilityPermission:e=>{const o=c.value.findIndex(i=>i.id===e.id);if(o>=0){c.value.splice(o,1);const i=a.value.findIndex(v=>v.id===e.id);i>=0&&a.value.splice(i,1)}else c.value.push(e)},toggleUsabilityPermission:e=>{if(!c.value.some(v=>v.id===e.id)){z("El usuario debe tener permisos de visualización primero","warning");return}const i=a.value.findIndex(v=>v.id===e.id);i>=0?a.value.splice(i,1):a.value.push(e)},hasVisibilityPermission:e=>e?c.value.some(o=>o.id===e.id||o.user_id===e.user_id):!1,hasUsabilityPermission:e=>e?a.value.some(o=>o.id===e.id||o.user_id===e.user_id):!1,togglePublicAccess:()=>{d.value=!d.value,d.value&&(c.value=[],a.value=[])},getPermissionsData:()=>l.value?{is_public:d.value,visibility_user_ids:d.value?[]:c.value.map(e=>e.user_id),usability_user_ids:d.value?[]:a.value.map(e=>e.user_id)}:{},initializePermissions:async e=>{l.value&&(await k(),e!=null&&e.id&&await w(e.id))}}}const Z={key:0,class:"mt-6"},H=s("div",{class:"flex items-center justify-between mb-4"},[s("h3",{class:"text-lg font-medium text-primary"},"Gestión de Permisos")],-1),J={class:"mb-6 p-4 bg-gray-50 rounded-lg border"},K={class:"flex items-center justify-between"},W=s("div",null,[s("h4",{class:"text-sm font-medium text-gray-700"},"Acceso Público"),s("p",{class:"text-sm text-gray-500 mt-1"}," Si está habilitado, todos los usuarios pueden ver y usar este documento ")],-1),X={key:0,class:"space-y-4"},Y={key:0},ee={class:"flex items-center justify-between mb-3"},se={class:"text-sm font-medium text-gray-700"},te={key:0,class:"text-blue-600"},ie={key:1,class:"text-gray-500"},oe={class:"mb-3"},ne={class:"relative"},re=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1),ae={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},le=s("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),de=[le],ce={key:0,class:"space-y-2 max-h-60 overflow-y-auto border rounded-lg p-3"},ue={class:"flex-1"},me={class:"text-sm font-medium text-gray-900"},he={class:"text-sm text-gray-500"},_e={class:"flex items-center space-x-4"},ge={class:"flex items-center"},ye=["id","checked","onChange"],ve=["for"],fe={class:"flex items-center"},be=["id","checked","onChange","disabled"],xe=["for"],pe={key:1,class:"text-center py-6 border rounded-lg"},ke={class:"flex flex-col items-center"},Fe=s("svg",{class:"h-12 w-12 text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),Ce=s("p",{class:"text-gray-500 font-medium"},"No se encontraron clientes",-1),Ee={class:"text-gray-400 text-sm mt-1"},we={key:1,class:"text-center py-6"},Pe=s("p",{class:"text-gray-500"},"No hay clientes disponibles.",-1),Ae=s("p",{class:"text-gray-400 text-sm mt-1"},"Los clientes aparecerán aquí cuando estén registrados en el sistema.",-1),De=[Pe,Ae],Be={key:2,class:"text-center py-6"},Le=s("p",{class:"text-gray-500"},"Cargando clientes disponibles...",-1),Ve=[Le],Ue={key:3,class:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200"},je=s("h5",{class:"text-sm font-medium text-blue-800 mb-2"},"Resumen de Permisos:",-1),ze={key:0,class:"mb-2"},Se={class:"text-sm text-blue-700"},Me={key:1},$e={class:"text-sm text-blue-700"},Ne={key:1,class:"mt-4 p-4 bg-green-50 rounded-lg border border-green-200"},qe=s("div",{class:"flex items-center"},[s("svg",{class:"h-5 w-5 text-green-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),s("p",{class:"text-sm text-green-700"},[s("strong",null,"Documento público:"),A(" Todos los usuarios registrados pueden ver y usar este documento. ")])],-1),Te=[qe],Ze={__name:"DocumentPermissionsManager",props:{document:{type:Object,default:null}},setup(g,{expose:f}){const u=g,{availableClients:c,selectedVisibilityUsers:a,selectedUsabilityUsers:d,isPublicDocument:y,isLoadingClients:b,clientSearchQuery:l,isLawyer:p,filteredClients:C,hasAvailableClients:E,hasFilteredClients:k,toggleVisibilityPermission:w,toggleUsabilityPermission:F,hasVisibilityPermission:D,hasUsabilityPermission:V,togglePublicAccess:B,getPermissionsData:U,initializePermissions:j}=Q();return N(async()=>{u.document&&await j(u.document)}),f({getPermissionsData:U}),(M,_)=>t(p)?(n(),r("div",Z,[H,s("div",J,[s("div",K,[W,s("button",{onClick:_[0]||(_[0]=(...e)=>t(B)&&t(B)(...e)),type:"button",class:S(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-offset-2",t(y)?"bg-secondary":"bg-gray-200"])},[s("span",{class:S(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",t(y)?"translate-x-5":"translate-x-0"])},null,2)],2)])]),t(y)?h("",!0):(n(),r("div",X,[t(E)?(n(),r("div",Y,[s("div",ee,[s("h4",se,[A(" Asignar Permisos a Clientes: "),t(l).trim()?(n(),r("span",te," ("+m(t(C).length)+" de "+m(t(c).length)+" clientes) ",1)):(n(),r("span",ie," ("+m(t(c).length)+" clientes) ",1))])]),s("div",oe,[s("div",ne,[re,q(s("input",{"onUpdate:modelValue":_[1]||(_[1]=e=>I(l)?l.value=e:null),type:"text",placeholder:"Buscar por nombre o email...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-secondary focus:border-secondary text-sm"},null,512),[[T,t(l)]]),t(l).trim()?(n(),r("div",ae,[s("button",{onClick:_[2]||(_[2]=e=>l.value=""),type:"button",class:"text-gray-400 hover:text-gray-600"},de)])):h("",!0)])]),t(k)?(n(),r("div",ce,[(n(!0),r(R,null,O(t(C),e=>(n(),r("div",{key:e.id,class:"flex items-center justify-between p-3 bg-white border rounded-lg hover:bg-gray-50"},[s("div",ue,[s("p",me,m(e.full_name),1),s("p",he,m(e.email),1)]),s("div",_e,[s("div",ge,[s("input",{id:`visibility_${e.id}`,type:"checkbox",checked:t(D)(e),onChange:o=>t(w)(e),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded"},null,40,ye),s("label",{for:`visibility_${e.id}`,class:"ml-2 text-sm text-gray-600"}," Ver ",8,ve)]),s("div",fe,[s("input",{id:`usability_${e.id}`,type:"checkbox",checked:t(V)(e),onChange:o=>t(F)(e),disabled:!t(D)(e),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded disabled:bg-gray-100"},null,40,be),s("label",{for:`usability_${e.id}`,class:"ml-2 text-sm text-gray-600"}," Usar ",8,xe)])])]))),128))])):t(l).trim()&&!t(k)?(n(),r("div",pe,[s("div",ke,[Fe,Ce,s("p",Ee,' No hay clientes que coincidan con "'+m(t(l))+'" ',1),s("button",{onClick:_[3]||(_[3]=e=>l.value=""),type:"button",class:"mt-3 text-sm text-secondary hover:text-secondary-dark underline"}," Limpiar búsqueda ")])])):h("",!0)])):!t(b)&&!t(E)?(n(),r("div",we,De)):h("",!0),t(b)?(n(),r("div",Be,Ve)):h("",!0),t(a).length>0||t(d).length>0?(n(),r("div",Ue,[je,t(a).length>0?(n(),r("div",ze,[s("p",Se,[s("strong",null,"Pueden ver ("+m(t(a).length)+"):",1),A(" "+m(t(a).map(e=>e.full_name).join(", ")),1)])])):h("",!0),t(d).length>0?(n(),r("div",Me,[s("p",$e,[s("strong",null,"Pueden usar ("+m(t(d).length)+"):",1),A(" "+m(t(d).map(e=>e.full_name).join(", ")),1)])])):h("",!0)])):h("",!0)])),t(y)?(n(),r("div",Ne,Te)):h("",!0)])):h("",!0)}};export{Ze as _,Qe as a,Ge as g,Oe as r,Q as u};
