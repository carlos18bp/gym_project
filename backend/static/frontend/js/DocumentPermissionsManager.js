import{I as X,r as b,c as V,s as $,o as Y,T as Z,j as t,e as a,f as n,g as s,n as J,F as K,N as W,t as _,l as h,p as P,w as ee,v as se,aT as te}from"./index.js";import{u as ie}from"./index2.js";const T=[{id:0,name:"Gris Suave",light:"#F5F5F5",dark:"#9E9E9E",hex:"#E0E0E0"},{id:1,name:"Rosa Pastel",light:"#FCE4EC",dark:"#AD1457",hex:"#F8BBD9"},{id:2,name:"Lavanda",light:"#F3E5F5",dark:"#7B1FA2",hex:"#E1BEE7"},{id:3,name:"Azul Suave",light:"#E3F2FD",dark:"#1565C0",hex:"#BBDEFB"},{id:4,name:"Verde Menta",light:"#E8F5E8",dark:"#2E7D32",hex:"#C8E6C9"},{id:5,name:"Amarillo Pastel",light:"#FFF8E1",dark:"#F57F17",hex:"#FFF176"},{id:6,name:"Durazno",light:"#FFF3E0",dark:"#E65100",hex:"#FFCC80"},{id:7,name:"Coral",light:"#FFEBEE",dark:"#C62828",hex:"#FFCDD2"},{id:8,name:"Turquesa",light:"#E0F2F1",dark:"#00695C",hex:"#B2DFDB"},{id:9,name:"Violeta",light:"#EDE7F6",dark:"#4527A0",hex:"#D1C4E9"},{id:10,name:"Salmón",light:"#FFF4E6",dark:"#BF360C",hex:"#FFAB91"},{id:11,name:"Aqua",light:"#E1F5FE",dark:"#0277BD",hex:"#81D4FA"},{id:12,name:"Lima",light:"#F1F8E9",dark:"#558B2F",hex:"#DCEDC8"},{id:13,name:"Lila",light:"#F9FBE7",dark:"#9E9D24",hex:"#E6EE9C"},{id:14,name:"Crema",light:"#FFFDE7",dark:"#F9A825",hex:"#FFF59D"},{id:15,name:"Celeste",light:"#E8EAF6",dark:"#303F9F",hex:"#C5CAE9"}];function Ds(x){return T.find(w=>w.id===x)||T[0]}function Ls(){return T}function le(){const x=ie(),w=X(),g=b([]),y=b([]),d=b([]),r=b(!1),p=b(!1),C=b(""),c=b([]),v=b([]),u=b([]),F=b(!1),f=V(()=>{var e;return((e=w.getCurrentUser)==null?void 0:e.role)==="lawyer"}),A=V(()=>{if(!Array.isArray(g.value))return[];if(!C.value.trim())return g.value;const e=C.value.toLowerCase().trim();return g.value.filter(o=>{var l,k;return((l=o.full_name)==null?void 0:l.toLowerCase().includes(e))||((k=o.email)==null?void 0:k.toLowerCase().includes(e))})}),U=V(()=>Array.isArray(g.value)&&g.value.length>0),B=V(()=>Array.isArray(A.value)&&A.value.length>0),D=V(()=>Array.isArray(c.value)&&c.value.length>0),L=async()=>{if(f.value){p.value=!0;try{const e=await x.fetchAvailableClients();g.value=Array.isArray(e)?e:[]}catch(e){console.error("Error loading available clients:",e),await $("Error al cargar clientes disponibles","error"),g.value=[]}finally{p.value=!1}}},N=async()=>{if(f.value){F.value=!0;try{const e=await x.fetchAvailableRoles();c.value=Array.isArray(e.roles)?e.roles:[]}catch(e){console.error("Error loading available roles:",e),await $("Error al cargar roles disponibles","error"),c.value=[]}finally{F.value=!1}}},j=async e=>{if(!(!e||!f.value))try{const o=await x.fetchDocumentPermissions(e);E(o)}catch(o){console.error("Error loading document permissions:",o),E(x.selectedDocument)}},E=e=>{if(!(!e||!f.value)&&(y.value=[],d.value=[],v.value=[],u.value=[],r.value=!1,typeof e.is_public=="boolean"&&(r.value=e.is_public),!r.value)){if(e.active_roles&&(e.active_roles.visibility_roles&&Array.isArray(e.active_roles.visibility_roles)&&(v.value=[...e.active_roles.visibility_roles]),e.active_roles.usability_roles&&Array.isArray(e.active_roles.usability_roles)&&(u.value=[...e.active_roles.usability_roles])),e.visibility_permissions&&Array.isArray(e.visibility_permissions)){const o=e.visibility_permissions.filter(l=>l.user_id&&l.email&&l.full_name);y.value=o.map(l=>({id:l.user_id,user_id:l.user_id,email:l.email,full_name:l.full_name}))}if(e.usability_permissions&&Array.isArray(e.usability_permissions)){const o=e.usability_permissions.filter(l=>l.user_id&&l.email&&l.full_name);d.value=o.map(l=>({id:l.user_id,user_id:l.user_id,email:l.email,full_name:l.full_name}))}}};return{availableClients:g,selectedVisibilityUsers:y,selectedUsabilityUsers:d,isPublicDocument:r,isLoadingClients:p,clientSearchQuery:C,availableRoles:c,selectedRolesVisibility:v,selectedRolesUsability:u,isLoadingRoles:F,isLawyer:f,filteredClients:A,hasAvailableClients:U,hasFilteredClients:B,hasAvailableRoles:D,loadAvailableClients:L,loadDocumentPermissions:j,initializeExistingPermissions:E,toggleVisibilityPermission:e=>{const o=y.value.findIndex(l=>l.id===e.id);if(o>=0){y.value.splice(o,1);const l=d.value.findIndex(k=>k.id===e.id);l>=0&&d.value.splice(l,1)}else y.value.push(e)},toggleUsabilityPermission:e=>{if(!y.value.some(k=>k.id===e.id)){$("El usuario debe tener permisos de visualización primero","warning");return}const l=d.value.findIndex(k=>k.id===e.id);l>=0?d.value.splice(l,1):d.value.push(e)},hasVisibilityPermission:e=>e?y.value.some(o=>o.id===e.id||o.user_id===e.user_id):!1,hasUsabilityPermission:e=>e?d.value.some(o=>o.id===e.id||o.user_id===e.user_id):!1,togglePublicAccess:()=>{r.value=!r.value,r.value&&(y.value=[],d.value=[],v.value=[],u.value=[])},toggleRoleVisibilityPermission:e=>{const o=v.value.indexOf(e);if(o>=0){v.value.splice(o,1);const l=u.value.indexOf(e);l>=0&&u.value.splice(l,1)}else v.value.push(e)},toggleRoleUsabilityPermission:e=>{if(!v.value.includes(e)){$("El rol debe tener permisos de visualización primero","warning");return}const l=u.value.indexOf(e);l>=0?u.value.splice(l,1):u.value.push(e)},hasRoleVisibilityPermission:e=>v.value.includes(e),hasRoleUsabilityPermission:e=>u.value.includes(e),getRoleDisplayName:e=>{const o=c.value.find(l=>l.code===e);return o?o.display_name:e},getPermissionsData:()=>f.value?{is_public:r.value,visibility:{roles:r.value?[]:v.value,user_ids:r.value?[]:y.value.map(e=>e.user_id)},usability:{roles:r.value?[]:u.value,user_ids:r.value?[]:d.value.map(e=>e.user_id)}}:{},initializePermissions:async e=>{f.value&&(await Promise.all([L(),N()]),e!=null&&e.id&&await j(e.id))}}}const oe={key:0,class:"mt-6"},ae=s("div",{class:"flex items-center justify-between mb-4"},[s("h3",{class:"text-lg font-medium text-primary"},"Gestión de Permisos")],-1),ne={class:"mb-6 p-4 bg-gray-50 rounded-lg border"},re={class:"flex items-center justify-between"},de=s("div",null,[s("h4",{class:"text-sm font-medium text-gray-700"},"Acceso Público"),s("p",{class:"text-sm text-gray-500 mt-1"}," Si está habilitado, todos los usuarios pueden ver y usar este documento ")],-1),ce={key:0,class:"space-y-6"},ue={class:"border-b border-gray-200 pb-6"},_e=s("div",{class:"flex items-center justify-between mb-4"},[s("h4",{class:"text-sm font-medium text-gray-700"},"Permisos por Rol")],-1),he={key:0,class:"space-y-3"},ye={class:"flex-1"},me={class:"flex items-center gap-2"},ge={class:"text-sm font-medium text-gray-900"},ve={class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},be={key:0,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},fe={class:"text-xs text-gray-500 mt-1"},xe={key:0,class:"flex items-center space-x-4"},pe={class:"flex items-center"},ke=["id","checked","onChange"],Fe=["for"],Ce={class:"flex items-center"},Ee=["id","checked","onChange","disabled"],Pe=["for"],we={key:1,class:"text-xs text-gray-400 italic"},Ae={key:1,class:"text-center py-4"},Re=s("p",{class:"text-gray-500 text-sm"},"Cargando roles disponibles...",-1),Ve=[Re],Ue={key:2,class:"text-center py-4"},Be=s("p",{class:"text-gray-500 text-sm"},"No hay roles disponibles.",-1),De=[Be],Le={key:3,class:"mt-4 p-3 bg-purple-50 rounded-lg border border-purple-200"},je=s("h5",{class:"text-sm font-medium text-purple-800 mb-2"},"Resumen de Permisos por Rol:",-1),$e={key:0,class:"mb-2"},Ne={class:"text-sm text-purple-700"},ze=s("strong",null,"Roles que pueden ver:",-1),Se={key:1},qe={class:"text-sm text-purple-700"},Me=s("strong",null,"Roles que pueden usar:",-1),Te={key:0},Ie={class:"flex items-center justify-between mb-3"},Oe={class:"text-sm font-medium text-gray-700"},Ge={key:0,class:"text-blue-600"},Qe={key:1,class:"text-gray-500"},He={class:"mb-3"},Je={class:"relative"},Ke=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1),We={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},Xe=s("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),Ye=[Xe],Ze={key:0,class:"space-y-2 max-h-60 overflow-y-auto border rounded-lg p-3"},es={class:"flex-1"},ss={class:"text-sm font-medium text-gray-900"},ts={class:"text-sm text-gray-500"},is={class:"flex items-center space-x-4"},ls={class:"flex items-center"},os=["id","checked","onChange"],as=["for"],ns={class:"flex items-center"},rs=["id","checked","onChange","disabled"],ds=["for"],cs={key:1,class:"text-center py-6 border rounded-lg"},us={class:"flex flex-col items-center"},_s=s("svg",{class:"h-12 w-12 text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),hs=s("p",{class:"text-gray-500 font-medium"},"No se encontraron clientes",-1),ys={class:"text-gray-400 text-sm mt-1"},ms={key:1,class:"text-center py-6"},gs=s("p",{class:"text-gray-500"},"No hay clientes disponibles.",-1),vs=s("p",{class:"text-gray-400 text-sm mt-1"},"Los clientes aparecerán aquí cuando estén registrados en el sistema.",-1),bs=[gs,vs],fs={key:2,class:"text-center py-6"},xs=s("p",{class:"text-gray-500"},"Cargando clientes disponibles...",-1),ps=[xs],ks={key:3,class:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200"},Fs=s("h5",{class:"text-sm font-medium text-blue-800 mb-2"},"Resumen de Permisos:",-1),Cs={key:0,class:"mb-2"},Es={class:"text-sm text-blue-700"},Ps={key:1},ws={class:"text-sm text-blue-700"},As={key:1,class:"mt-4 p-4 bg-green-50 rounded-lg border border-green-200"},Rs=s("div",{class:"flex items-center"},[s("svg",{class:"h-5 w-5 text-green-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),s("p",{class:"text-sm text-green-700"},[s("strong",null,"Documento público:"),P(" Todos los usuarios registrados pueden ver y usar este documento. ")])],-1),Vs=[Rs],js={__name:"DocumentPermissionsManager",props:{document:{type:Object,default:null}},setup(x,{expose:w}){const g=x,{availableClients:y,selectedVisibilityUsers:d,selectedUsabilityUsers:r,isPublicDocument:p,isLoadingClients:C,clientSearchQuery:c,availableRoles:v,selectedRolesVisibility:u,selectedRolesUsability:F,isLoadingRoles:f,isLawyer:A,filteredClients:U,hasAvailableClients:B,hasFilteredClients:D,hasAvailableRoles:L,toggleVisibilityPermission:N,toggleUsabilityPermission:j,hasVisibilityPermission:E,hasUsabilityPermission:I,togglePublicAccess:z,toggleRoleVisibilityPermission:O,toggleRoleUsabilityPermission:G,hasRoleVisibilityPermission:S,hasRoleUsabilityPermission:Q,getRoleDisplayName:q,getPermissionsData:H,initializePermissions:M}=le();return Y(async()=>{g.document&&await M(g.document)}),Z(()=>g.document,(R,m)=>{R&&R.id!==(m==null?void 0:m.id)&&M(R)},{deep:!0}),w({getPermissionsData:H}),(R,m)=>t(A)?(a(),n("div",oe,[ae,s("div",ne,[s("div",re,[de,s("button",{onClick:m[0]||(m[0]=(...i)=>t(z)&&t(z)(...i)),type:"button",class:J(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-offset-2",t(p)?"bg-secondary":"bg-gray-200"])},[s("span",{class:J(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",t(p)?"translate-x-5":"translate-x-0"])},null,2)],2)])]),t(p)?h("",!0):(a(),n("div",ce,[s("div",ue,[_e,t(L)?(a(),n("div",he,[(a(!0),n(K,null,W(t(v),i=>(a(),n("div",{key:i.code,class:"flex items-center justify-between p-3 bg-gray-50 border rounded-lg"},[s("div",ye,[s("div",me,[s("p",ge,_(i.display_name),1),s("span",ve,_(i.user_count)+" usuarios ",1),i.has_automatic_access?(a(),n("span",be," Acceso automático ")):h("",!0)]),s("p",fe,_(i.description),1)]),i.can_be_granted_permissions?(a(),n("div",xe,[s("div",pe,[s("input",{id:`role_visibility_${i.code}`,type:"checkbox",checked:t(S)(i.code),onChange:e=>t(O)(i.code),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded"},null,40,ke),s("label",{for:`role_visibility_${i.code}`,class:"ml-2 text-sm text-gray-600"}," Ver ",8,Fe)]),s("div",Ce,[s("input",{id:`role_usability_${i.code}`,type:"checkbox",checked:t(Q)(i.code),onChange:e=>t(G)(i.code),disabled:!t(S)(i.code),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded disabled:bg-gray-100"},null,40,Ee),s("label",{for:`role_usability_${i.code}`,class:"ml-2 text-sm text-gray-600"}," Usar ",8,Pe)])])):(a(),n("div",we," No requiere permisos explícitos "))]))),128))])):t(f)?(a(),n("div",Ae,Ve)):(a(),n("div",Ue,De)),t(u).length>0||t(F).length>0?(a(),n("div",Le,[je,t(u).length>0?(a(),n("div",$e,[s("p",Ne,[ze,P(" "+_(t(u).map(i=>t(q)(i)).join(", ")),1)])])):h("",!0),t(F).length>0?(a(),n("div",Se,[s("p",qe,[Me,P(" "+_(t(F).map(i=>t(q)(i)).join(", ")),1)])])):h("",!0)])):h("",!0)]),t(B)?(a(),n("div",Te,[s("div",Ie,[s("h4",Oe,[P(" Asignar Permisos a Clientes: "),t(c).trim()?(a(),n("span",Ge," ("+_(t(U).length)+" de "+_(t(y).length)+" clientes) ",1)):(a(),n("span",Qe," ("+_(t(y).length)+" clientes) ",1))])]),s("div",He,[s("div",Je,[Ke,ee(s("input",{"onUpdate:modelValue":m[1]||(m[1]=i=>te(c)?c.value=i:null),type:"text",placeholder:"Buscar por nombre o email...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-secondary focus:border-secondary text-sm"},null,512),[[se,t(c)]]),t(c).trim()?(a(),n("div",We,[s("button",{onClick:m[2]||(m[2]=i=>c.value=""),type:"button",class:"text-gray-400 hover:text-gray-600"},Ye)])):h("",!0)])]),t(D)?(a(),n("div",Ze,[(a(!0),n(K,null,W(t(U),i=>(a(),n("div",{key:i.id,class:"flex items-center justify-between p-3 bg-white border rounded-lg hover:bg-gray-50"},[s("div",es,[s("p",ss,_(i.full_name),1),s("p",ts,_(i.email),1)]),s("div",is,[s("div",ls,[s("input",{id:`visibility_${i.id}`,type:"checkbox",checked:t(E)(i),onChange:e=>t(N)(i),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded"},null,40,os),s("label",{for:`visibility_${i.id}`,class:"ml-2 text-sm text-gray-600"}," Ver ",8,as)]),s("div",ns,[s("input",{id:`usability_${i.id}`,type:"checkbox",checked:t(I)(i),onChange:e=>t(j)(i),disabled:!t(E)(i),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded disabled:bg-gray-100"},null,40,rs),s("label",{for:`usability_${i.id}`,class:"ml-2 text-sm text-gray-600"}," Usar ",8,ds)])])]))),128))])):t(c).trim()&&!t(D)?(a(),n("div",cs,[s("div",us,[_s,hs,s("p",ys,' No hay clientes que coincidan con "'+_(t(c))+'" ',1),s("button",{onClick:m[3]||(m[3]=i=>c.value=""),type:"button",class:"mt-3 text-sm text-secondary hover:text-secondary-dark underline"}," Limpiar búsqueda ")])])):h("",!0)])):!t(C)&&!t(B)?(a(),n("div",ms,bs)):h("",!0),t(C)?(a(),n("div",fs,ps)):h("",!0),t(d).length>0||t(r).length>0?(a(),n("div",ks,[Fs,t(d).length>0?(a(),n("div",Cs,[s("p",Es,[s("strong",null,"Pueden ver ("+_(t(d).length)+"):",1),P(" "+_(t(d).map(i=>i.full_name).join(", ")),1)])])):h("",!0),t(r).length>0?(a(),n("div",Ps,[s("p",ws,[s("strong",null,"Pueden usar ("+_(t(r).length)+"):",1),P(" "+_(t(r).map(i=>i.full_name).join(", ")),1)])])):h("",!0)])):h("",!0)])),t(p)?(a(),n("div",As,Vs)):h("",!0)])):h("",!0)}};export{js as _,Ls as a,Ds as g,le as u};
