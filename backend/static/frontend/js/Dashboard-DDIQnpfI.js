import{e as a,f as n,g as e,B as Te,a_ as Xe,D as ne,C as ee,a1 as Ge,a2 as Ie,r as R,c as D,V as te,Y as Me,k as H,i as O,h as u,j as c,a$ as fe,b0 as oe,b1 as he,b2 as ve,p as w,A as le,t as l,m as ye,w as W,v as ae,l as q,L as X,aZ as Re,b3 as pe,s as j,P as Pe,Q as De,b4 as Ke,F as Q,I as Y,n as B,aX as xe,a9 as Be,ad as st,U as ce,aj as mt,x as we,a7 as ot,z as Ve,o as $e,H as Oe,u as Fe,aY as Le,G as gt,ai as ft,ab as ht}from"./index-BROrgVaC.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as ze}from"./CheckCircleIcon-CmyiFrWB.js";import{r as je}from"./PhotoIcon-3-nF9FKJ.js";import{r as de,a as at}from"./LinkIcon-DdDRh74t.js";import{r as re}from"./CalendarIcon-CRSLtFf1.js";import{r as Ne}from"./EyeIcon-B0hz1SW0.js";import{r as it,a as nt,b as vt}from"./TagIcon-BK9oA3_k.js";import{r as pt}from"./ChevronRightIcon-DYnoKygb.js";import{r as _t}from"./EllipsisVerticalIcon-CczxQbp9.js";import{r as rt}from"./PencilIcon-YGP1YVK5.js";import{r as bt}from"./TrashIcon-DyZxV_p1.js";import{r as He}from"./ArrowTopRightOnSquareIcon-DlLfyhVh.js";import{r as We}from"./DocumentIcon-C7Y5428u.js";import{r as yt}from"./ExclamationTriangleIcon-Eb0O5_Hn.js";import{r as be}from"./PlusIcon-DLOcpYgm.js";import{r as xt}from"./ChevronDownIcon-f_qxucPv.js";import{r as et}from"./ArrowLeftIcon-B4be1172.js";function wt(t,o){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75"})])}function Ze(t,o){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})])}function Ce(t,o){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"})])}function Qe(t,o){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"})])}function Ae(t,o){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"})])}function $t(t,o){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"})])}function lt(t,o){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}function zt(t,o){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"})])}function ct(t,o){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"})])}function Et(t,o){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})])}const ue=Te("organizations",{state:()=>({organizations:[],currentOrganization:null,myMemberships:[],invitations:[],myInvitations:[],organizationMembers:[],isLoading:!1,isLoadingInvitations:!1,isLoadingMembers:!1,pagination:{count:0,next:null,previous:null,currentPage:1,pageSize:10},organizationStats:{total_organizations:0,total_members:0,total_pending_invitations:0,recent_requests_count:0,active_organizations_count:0,organizations_by_status:{},recent_invitations_count:0},dataLoaded:!1,lastFetchTime:null}),getters:{organizationById:t=>o=>t.organizations.find(s=>s.id===o),activeOrganizations:t=>t.organizations.filter(o=>o.is_active),pendingInvitations:t=>t.myInvitations.filter(o=>o.status==="PENDING"),canRespondToInvitation:t=>o=>{const s=t.myInvitations.find(r=>r.id===o);return s&&s.can_be_responded&&!s.is_expired}},actions:{async createOrganization(t){try{if(this.isLoading=!0,t.profile_image||t.cover_image){const o=new FormData;Object.keys(t).forEach(r=>{r!=="profile_image"&&r!=="cover_image"&&t[r]!==null&&o.append(r,t[r])}),t.profile_image&&o.append("profile_image",t.profile_image),t.cover_image&&o.append("cover_image",t.cover_image);const s=await Xe("organizations/create/",o);if(s.status===201){const r=s.data.organization;return this.organizations.unshift(r),this.currentOrganization=r,s.data}}else{const o=await ne("organizations/create/",t);if(o.status===201){const s=o.data.organization;return this.organizations.unshift(s),this.currentOrganization=s,o.data}}throw new Error("Error creating organization")}catch(o){throw console.error("Error creating organization:",o),o}finally{this.isLoading=!1}},async getMyOrganizations(t={}){try{this.isLoading=!0;const o=new URLSearchParams;Object.keys(t).forEach(d=>{t[d]!==null&&t[d]!==void 0&&t[d]!==""&&o.append(d,t[d])});const s=`organizations/my-organizations/${o.toString()?"?"+o.toString():""}`,r=await ee(s);if(r.status===200)return this.organizations=r.data.results,this.pagination={count:r.data.count,next:r.data.next,previous:r.data.previous,currentPage:t.page||1,pageSize:t.page_size||10},this.dataLoaded=!0,this.lastFetchTime=new Date().toISOString(),r.data;throw new Error("Error fetching organizations")}catch(o){throw console.error("Error fetching organizations:",o),o}finally{this.isLoading=!1}},async getOrganizationDetail(t){try{this.isLoading=!0;const o=await ee(`organizations/${t}/`);if(o.status===200){this.currentOrganization=o.data;const s=this.organizations.findIndex(r=>r.id===t);return s>=0&&(this.organizations[s]=o.data),o.data}throw new Error("Organization not found")}catch(o){throw console.error("Error fetching organization detail:",o),o}finally{this.isLoading=!1}},async updateOrganization(t,o){try{if(this.isLoading=!0,o.profile_image||o.cover_image){const s=new FormData;Object.keys(o).forEach(d=>{d!=="profile_image"&&d!=="cover_image"&&o[d]!==null&&s.append(d,o[d])}),o.profile_image&&s.append("profile_image",o.profile_image),o.cover_image&&s.append("cover_image",o.cover_image);const r=await Xe(`organizations/${t}/update/`,s);if(r.status===200){const d=r.data.organization;return this._updateOrganizationInState(t,d),r.data}}else{const s=await Ge(`organizations/${t}/update/`,o);if(s.status===200){const r=s.data.organization;return this._updateOrganizationInState(t,r),s.data}}throw new Error("Error updating organization")}catch(s){throw console.error("Error updating organization:",s),s}finally{this.isLoading=!1}},async deleteOrganization(t){try{this.isLoading=!0;const o=await Ie(`organizations/${t}/delete/`);if(o.status===200)return this.organizations=this.organizations.filter(s=>s.id!==t),this.currentOrganization&&this.currentOrganization.id===t&&(this.currentOrganization=null),o.data;throw new Error("Error deleting organization")}catch(o){throw console.error("Error deleting organization:",o),o}finally{this.isLoading=!1}},async sendInvitation(t,o){try{this.isLoadingInvitations=!0;const s=await ne(`organizations/${t}/invitations/send/`,o);if(s.status===201){const r=s.data.invitation;return this.invitations.unshift(r),s.data}throw new Error("Error sending invitation")}catch(s){throw console.error("Error sending invitation:",s),s}finally{this.isLoadingInvitations=!1}},async getOrganizationInvitations(t,o={}){try{this.isLoadingInvitations=!0;const s=new URLSearchParams;Object.keys(o).forEach(i=>{o[i]!==null&&o[i]!==void 0&&o[i]!==""&&s.append(i,o[i])});const r=`organizations/${t}/invitations/${s.toString()?"?"+s.toString():""}`,d=await ee(r);if(d.status===200)return this.invitations=d.data,d.data;throw new Error("Error fetching invitations")}catch(s){throw console.error("Error fetching invitations:",s),s}finally{this.isLoadingInvitations=!1}},async cancelInvitation(t,o){try{this.isLoadingInvitations=!0;const s=await Ie(`organizations/${t}/invitations/${o}/cancel/`);if(s.status===200)return this.invitations=this.invitations.filter(r=>r.id!==o),s.data;throw new Error("Error canceling invitation")}catch(s){throw console.error("Error canceling invitation:",s),s}finally{this.isLoadingInvitations=!1}},async getMyInvitations(t={}){try{this.isLoadingInvitations=!0;const o=new URLSearchParams;Object.keys(t).forEach(d=>{t[d]!==null&&t[d]!==void 0&&t[d]!==""&&o.append(d,t[d])});const s=`invitations/my-invitations/${o.toString()?"?"+o.toString():""}`,r=await ee(s);if(r.status===200)return this.myInvitations=r.data.results,this.pagination={count:r.data.count,next:r.data.next,previous:r.data.previous,currentPage:t.page||1,pageSize:t.page_size||10},r.data;throw new Error("Error fetching my invitations")}catch(o){throw console.error("Error fetching my invitations:",o),o}finally{this.isLoadingInvitations=!1}},async respondToInvitation(t,o){try{this.isLoadingInvitations=!0;const s=await ne(`invitations/${t}/respond/`,{action:o});if(s.status===200){const r=this.myInvitations.findIndex(d=>d.id===t);return r>=0&&(this.myInvitations[r]=s.data.invitation),o==="accept"&&await this.getMyMemberships(),s.data}throw new Error("Error responding to invitation")}catch(s){throw console.error("Error responding to invitation:",s),s}finally{this.isLoadingInvitations=!1}},async getMyMemberships(){try{this.isLoading=!0;const t=await ee("organizations/my-memberships/");if(t.status===200)return this.myMemberships=t.data.organizations,t.data;throw new Error("Error fetching memberships")}catch(t){throw console.error("Error fetching memberships:",t),t}finally{this.isLoading=!1}},async leaveOrganization(t){try{this.isLoading=!0;const o=await ne(`organizations/${t}/leave/`,{});if(o.status===200)return this.myMemberships=this.myMemberships.filter(s=>s.id!==t),o.data;throw new Error("Error leaving organization")}catch(o){throw console.error("Error leaving organization:",o),o}finally{this.isLoading=!1}},async getOrganizationMembers(t,o={}){try{this.isLoadingMembers=!0;const s=new URLSearchParams;Object.keys(o).forEach(i=>{o[i]!==null&&o[i]!==void 0&&o[i]!==""&&s.append(i,o[i])});const r=`organizations/${t}/members/${s.toString()?"?"+s.toString():""}`,d=await ee(r);if(d.status===200)return this.organizationMembers=d.data.members||[],d.data.members||[];throw new Error("Error fetching members")}catch(s){throw console.error("Error fetching members:",s),s}finally{this.isLoadingMembers=!1}},async removeMember(t,o){try{this.isLoadingMembers=!0;const s=await Ie(`organizations/${t}/members/${o}/remove/`);if(s.status===200)return this.organizationMembers=this.organizationMembers.filter(r=>r.id!==o),s.data;throw new Error("Error removing member")}catch(s){throw console.error("Error removing member:",s),s}finally{this.isLoadingMembers=!1}},async getOrganizationStats(){try{this.isLoading=!0;const t=await ee("organizations/stats/");if(t.status===200)return this.organizationStats=t.data,t.data;throw new Error("Error fetching statistics")}catch(t){throw console.error("Error fetching statistics:",t),t}finally{this.isLoading=!1}},async getOrganizationPublicInfo(t){try{this.isLoading=!0;const o=await ee(`organizations/${t}/public/`);if(o.status===200)return o.data;throw new Error("Error fetching public organization info")}catch(o){throw console.error("Error fetching public organization info:",o),o}finally{this.isLoading=!1}},clearAll(){this.organizations=[],this.currentOrganization=null,this.myMemberships=[],this.invitations=[],this.myInvitations=[],this.organizationMembers=[],this.organizationStats={total_organizations:0,total_members:0,total_pending_invitations:0,recent_requests_count:0,active_organizations_count:0,organizations_by_status:{},recent_invitations_count:0},this.dataLoaded=!1,this.lastFetchTime=null},_updateOrganizationInState(t,o){const s=this.organizations.findIndex(d=>d.id===t);s>=0&&(this.organizations[s]=o),this.currentOrganization&&this.currentOrganization.id===t&&(this.currentOrganization=o);const r=this.myMemberships.findIndex(d=>d.id===t);r>=0&&(this.myMemberships[r]=o)}}}),Ue=Te("corporateRequests",{state:()=>({myRequests:[],receivedRequests:[],currentRequest:null,availableOrganizations:[],requestTypes:[],requestResponses:[],isLoading:!1,isLoadingRequests:!1,isLoadingResponses:!1,isLoadingTypes:!1,pagination:{count:0,next:null,previous:null,currentPage:1,pageSize:10},dashboardStats:{total_requests:0,status_counts:{},priority_counts:{},recent_requests_count:0,assigned_to_me_count:0,overdue_count:0},filters:{status:null,priority:null,search:"",assigned_to_me:!1},dataLoaded:!1,lastFetchTime:null}),getters:{requestById:t=>o=>[...t.myRequests,...t.receivedRequests].find(r=>r.id===o),requestsByStatus:t=>o=>[...t.myRequests,...t.receivedRequests].filter(r=>r.status===o),highPriorityRequests:t=>[...t.myRequests,...t.receivedRequests].filter(s=>s.priority==="HIGH"||s.priority==="URGENT"),pendingRequestsCount:t=>[...t.myRequests,...t.receivedRequests].filter(s=>s.status==="PENDING").length,requestTypeById:t=>o=>t.requestTypes.find(s=>s.id===o)},actions:{async getMyOrganizationsForRequests(){try{this.isLoading=!0;const t=await ee("corporate-requests/clients/my-organizations/");if(t.status===200)return this.availableOrganizations=t.data.organizations,t.data;throw new Error("Error fetching organizations for requests")}catch(t){throw console.error("Error fetching organizations for requests:",t),t}finally{this.isLoading=!1}},async getRequestTypes(){var t;try{this.isLoadingTypes=!0;const o=await ee("corporate-requests/clients/request-types/");if(o.status===200){const s=o.data.request_types||o.data;return this.requestTypes=s,s}throw new Error("Error fetching request types")}catch(o){throw console.error("Error fetching request types:",o),console.error("Error details:",(t=o.response)==null?void 0:t.data),o}finally{this.isLoadingTypes=!1}},async createCorporateRequest(t){try{this.isLoading=!0;const o=await ne("corporate-requests/clients/create/",t);if(o.status===201){const s=o.data.corporate_request;return this.myRequests.unshift(s),this.currentRequest=s,o.data}throw new Error("Error creating corporate request")}catch(o){throw console.error("Error creating corporate request:",o),o}finally{this.isLoading=!1}},async getMyRequests(t={}){try{this.isLoadingRequests=!0;const o=new URLSearchParams;Object.keys(t).forEach(d=>{t[d]!==null&&t[d]!==void 0&&t[d]!==""&&o.append(d,t[d])});const s=`corporate-requests/clients/my-requests/${o.toString()?"?"+o.toString():""}`,r=await ee(s);if(r.status===200)return this.myRequests=r.data.results,this.pagination={count:r.data.count,next:r.data.next,previous:r.data.previous,currentPage:t.page||1,pageSize:t.page_size||10},this.dataLoaded=!0,this.lastFetchTime=new Date().toISOString(),r.data;throw new Error("Error fetching my requests")}catch(o){throw console.error("Error fetching my requests:",o),o}finally{this.isLoadingRequests=!1}},async getMyRequestDetail(t){try{this.isLoading=!0;const o=await ee(`corporate-requests/clients/${t}/`);if(o.status===200){this.currentRequest=o.data.corporate_request,this.requestResponses=o.data.corporate_request.responses||[];const s=this.myRequests.findIndex(r=>r.id===t);return s>=0&&(this.myRequests[s]=o.data.corporate_request),o.data}throw new Error("Request not found")}catch(o){throw console.error("Error fetching request detail:",o),o}finally{this.isLoading=!1}},async addResponseToMyRequest(t,o){try{this.isLoadingResponses=!0;const s=typeof o=="string"?{response_text:o}:o,r=await ne(`corporate-requests/clients/${t}/responses/`,s);if(r.status===201){const d=r.data.response;return this.currentRequest&&this.currentRequest.id===t?(this.currentRequest.response_count=(this.currentRequest.response_count||0)+1,this.currentRequest.responses||(this.currentRequest.responses=[]),this.currentRequest.responses.push(d)):this.requestResponses.push(d),r.data}throw new Error("Error adding response")}catch(s){throw console.error("Error adding response:",s),s}finally{this.isLoadingResponses=!1}},async getReceivedRequests(t={}){try{this.isLoadingRequests=!0;const o=new URLSearchParams;Object.keys(t).forEach(d=>{t[d]!==null&&t[d]!==void 0&&t[d]!==""&&o.append(d,t[d])});const s=`corporate-requests/corporate/received/${o.toString()?"?"+o.toString():""}`,r=await ee(s);if(r.status===200)return this.receivedRequests=r.data.results,this.pagination={count:r.data.count,next:r.data.next,previous:r.data.previous,currentPage:t.page||1,pageSize:t.page_size||10},this.dataLoaded=!0,this.lastFetchTime=new Date().toISOString(),r.data;throw new Error("Error fetching received requests")}catch(o){throw console.error("Error fetching received requests:",o),o}finally{this.isLoadingRequests=!1}},async getReceivedRequestDetail(t){try{this.isLoading=!0;const o=await ee(`corporate-requests/corporate/${t}/`);if(o.status===200){this.currentRequest=o.data.corporate_request,this.requestResponses=o.data.corporate_request.responses||[];const s=this.receivedRequests.findIndex(r=>r.id===t);return s>=0&&(this.receivedRequests[s]=o.data.corporate_request),o.data}throw new Error("Request not found")}catch(o){throw console.error("Error fetching received request detail:",o),o}finally{this.isLoading=!1}},async updateReceivedRequest(t,o){try{this.isLoading=!0;const s=await Ge(`corporate-requests/corporate/${t}/update/`,o);if(s.status===200){const r=s.data.corporate_request;return this._updateRequestInState(t,r),s.data}throw new Error("Error updating request")}catch(s){throw console.error("Error updating request:",s),s}finally{this.isLoading=!1}},async addResponseToReceivedRequest(t,o){try{this.isLoadingResponses=!0;const s=typeof o=="string"?{response_text:o,is_internal_note:!1}:o,r=await ne(`corporate-requests/corporate/${t}/responses/`,s);if(r.status===201){const d=r.data.response;return this.currentRequest&&this.currentRequest.id===t?(this.currentRequest.response_count=(this.currentRequest.response_count||0)+1,this.currentRequest.responses||(this.currentRequest.responses=[]),this.currentRequest.responses.push(d)):this.requestResponses.push(d),r.data}throw new Error("Error adding response")}catch(s){throw console.error("Error adding response:",s),s}finally{this.isLoadingResponses=!1}},async getDashboardStats(){try{this.isLoading=!0;const t=await ee("corporate-requests/corporate/dashboard-stats/");if(t.status===200)return this.dashboardStats=t.data,t.data;throw new Error("Error fetching dashboard stats")}catch(t){throw console.error("Error fetching dashboard stats:",t),t}finally{this.isLoading=!1}},async getRequestConversation(t){try{this.isLoadingResponses=!0;const o=await ee(`corporate-requests/${t}/conversation/`);if(o.status===200)return this.requestResponses=o.data.responses,o.data;throw new Error("Error fetching conversation")}catch(o){throw console.error("Error fetching conversation:",o),o}finally{this.isLoadingResponses=!1}},async updateFilters(t,o){this.filters={...this.filters,...t};const s={status:this.filters.status,priority:this.filters.priority,search:this.filters.search,page:1};o==="corporate_client"&&this.filters.assigned_to_me&&(s.assigned_to_me=this.filters.assigned_to_me),o==="client"||o==="basic"?await this.getMyRequests(s):o==="corporate_client"&&await this.getReceivedRequests(s)},clearFilters(){this.filters={status:null,priority:null,search:"",assigned_to_me:!1}},async refreshRequests(t){const o={page:this.pagination.currentPage,page_size:this.pagination.pageSize};t==="client"||t==="basic"?await this.getMyRequests(o):t==="corporate_client"&&await this.getReceivedRequests(o)},clearAll(){this.myRequests=[],this.receivedRequests=[],this.currentRequest=null,this.availableOrganizations=[],this.requestTypes=[],this.requestResponses=[],this.dashboardStats={total_requests:0,status_counts:{},priority_counts:{},recent_requests_count:0,assigned_to_me_count:0,overdue_count:0},this.clearFilters(),this.dataLoaded=!1,this.lastFetchTime=null},_updateRequestInState(t,o){const s=this.myRequests.findIndex(d=>d.id===t);s>=0&&(this.myRequests[s]=o);const r=this.receivedRequests.findIndex(d=>d.id===t);r>=0&&(this.receivedRequests[r]=o),this.currentRequest&&this.currentRequest.id===t&&(this.currentRequest=o)},getStatusDisplay(t){return{PENDING:"Pendiente",IN_REVIEW:"En Revisión",RESPONDED:"Respondida",RESOLVED:"Resuelta",CLOSED:"Cerrada"}[t]||t},getPriorityDisplay(t){return{LOW:"Baja",MEDIUM:"Media",HIGH:"Alta",URGENT:"Urgente"}[t]||t},getPriorityColorClass(t){return{LOW:"text-gray-600 bg-gray-100",MEDIUM:"text-blue-600 bg-blue-100",HIGH:"text-orange-600 bg-orange-100",URGENT:"text-red-600 bg-red-100"}[t]||"text-gray-600 bg-gray-100"},getStatusColorClass(t){return{PENDING:"text-yellow-600 bg-yellow-100",IN_REVIEW:"text-blue-600 bg-blue-100",RESPONDED:"text-purple-600 bg-purple-100",RESOLVED:"text-green-600 bg-green-100",CLOSED:"text-gray-600 bg-gray-100"}[t]||"text-gray-600 bg-gray-100"}}}),se=t=>(Pe("data-v-6908ea93"),t=t(),De(),t),kt=se(()=>e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)),qt={class:"fixed inset-0 z-10 overflow-y-auto"},Ct={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},Rt={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},Mt=se(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," Crea tu organización para empezar a recibir solicitudes corporativas ",-1)),Pt={key:0,class:"flex justify-center items-center py-8"},Dt=se(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),St=se(()=>e("span",{class:"ml-2 text-gray-600"},"Creando organización...",-1)),It=[Dt,St],Lt={key:1,class:"text-center py-6"},jt=se(()=>e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," ¡Organización Creada! ",-1)),Ot={class:"text-sm text-gray-600 mb-6"},Nt={class:"space-y-4"},At=se(()=>e("h4",{class:"text-md font-medium text-gray-900"},"Información Básica",-1)),Ut=se(()=>e("label",{for:"title",class:"block text-sm font-medium leading-6 text-gray-900"}," Nombre de la Organización * ",-1)),Vt={class:"mt-2"},Tt={key:0,class:"mt-1 text-sm text-red-600"},Gt=se(()=>e("label",{for:"description",class:"block text-sm font-medium leading-6 text-gray-900"}," Descripción * ",-1)),Bt={class:"mt-2"},Ft=se(()=>e("p",{class:"mt-1 text-xs text-gray-500"}," Esta descripción será visible para los clientes que reciban invitaciones ",-1)),Ht={key:0,class:"mt-1 text-sm text-red-600"},Wt={class:"space-y-4 border-t border-gray-200 pt-6"},Zt=se(()=>e("h4",{class:"text-md font-medium text-gray-900"},"Imágenes (Opcional)",-1)),Qt=se(()=>e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Imagen de Perfil ",-1)),Yt={class:"mt-2 flex items-center space-x-4"},Jt={class:"flex-shrink-0"},Xt=["src"],Kt={class:"flex-1"},es=se(()=>e("p",{class:"mt-1 text-xs text-gray-500"},"PNG, JPG hasta 5MB",-1)),ts={key:0,class:"mt-1 text-sm text-red-600"},ss=se(()=>e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Imagen de Portada ",-1)),os={class:"mt-2"},as={class:"mb-4"},is=["src"],ns=se(()=>e("p",{class:"mt-1 text-xs text-gray-500"},"PNG, JPG hasta 5MB. Recomendado: 800x400px",-1)),rs={key:0,class:"mt-1 text-sm text-red-600"},ls={key:0,class:"space-y-4 border-t border-gray-200 pt-6"},cs=se(()=>e("h4",{class:"text-md font-medium text-gray-900"},"Vista Previa",-1)),ds={class:"bg-gray-50 border border-gray-200 rounded-lg overflow-hidden"},us={class:"relative h-24 bg-gradient-to-r from-blue-500 to-purple-600"},ms=["src"],gs=se(()=>e("div",{class:"absolute inset-0 bg-black bg-opacity-30"},null,-1)),fs={class:"absolute bottom-2 left-4"},hs=["src"],vs={class:"p-4"},ps={class:"text-sm font-medium text-gray-900 mb-1"},_s={class:"text-xs text-gray-600 line-clamp-2"},bs={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},ys={class:"flex"},xs=se(()=>e("div",{class:"ml-3"},[e("h5",{class:"text-sm font-medium text-blue-800"},"Información importante"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Serás el líder y administrador de esta organización"),e("p",null,"• Podrás invitar clientes a unirse como miembros"),e("p",null,"• Los miembros podrán enviarte solicitudes corporativas"),e("p",null,"• Puedes editar la información en cualquier momento")])],-1)),ws={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},$s=["disabled"],zs={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Es={__name:"CreateOrganizationModal",props:{visible:{type:Boolean,default:!1}},emits:["close","created"],setup(t,{emit:o}){const s=t,r=o,d=ue(),i=R(!1),f=R(!1),h=R({}),g=R(null),E=R({title:"",description:"",profile_image:null,cover_image:null}),_=R(null),v=R(null),y=D(()=>"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMDAgMTAwTDE4MCA4MEwyMjAgODBMMjAwIDEwMFoiIGZpbGw9IiM5Q0E0QUYiLz4KPC9zdmc+"),m=()=>{E.value={title:"",description:"",profile_image:null,cover_image:null},h.value={},_.value=null,v.value=null,f.value=!1,g.value=null},k=p=>{const b=p.target.files[0];if(b){if(b.size>5*1024*1024){j("La imagen debe ser menor a 5MB","warning");return}if(!b.type.startsWith("image/")){j("Solo se permiten archivos de imagen","warning");return}E.value.profile_image=b;const P=new FileReader;P.onload=A=>{_.value=A.target.result},P.readAsDataURL(b)}},x=p=>{const b=p.target.files[0];if(b){if(b.size>5*1024*1024){j("La imagen debe ser menor a 5MB","warning");return}if(!b.type.startsWith("image/")){j("Solo se permiten archivos de imagen","warning");return}E.value.cover_image=b;const P=new FileReader;P.onload=A=>{v.value=A.target.result},P.readAsDataURL(b)}},M=async()=>{var p,b,P,A;try{i.value=!0,h.value={};const U={title:E.value.title.trim(),description:E.value.description.trim()};E.value.profile_image&&(U.profile_image=E.value.profile_image),E.value.cover_image&&(U.cover_image=E.value.cover_image);const T=await d.createOrganization(U);g.value=T.organization,f.value=!0,j("Organización creada exitosamente","success"),r("created",T.organization)}catch(U){console.error("Error creating organization:",U),(b=(p=U.response)==null?void 0:p.data)!=null&&b.details?h.value=U.response.data.details:(A=(P=U.response)==null?void 0:P.data)!=null&&A.error?j(U.response.data.error,"error"):j("Error al crear la organización","error")}finally{i.value=!1}},C=()=>{m()},$=()=>{i.value||r("close")};return te(()=>s.visible,p=>{p&&Me(()=>{m()})}),(p,b)=>(a(),H(c(pe),{as:"template",show:t.visible},{default:O(()=>[u(c(fe),{class:"relative z-50",onClose:$},{default:O(()=>[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[kt]),_:1}),e("div",qt,[e("div",Ct,[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6"},{default:O(()=>{var P;return[e("div",Rt,[e("div",null,[u(c(ve),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:O(()=>[w(" Crear Nueva Organización ")]),_:1}),Mt]),e("button",{onClick:$,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(c(le),{class:"h-6 w-6"})])]),i.value?(a(),n("div",Pt,It)):f.value?(a(),n("div",Lt,[u(c(ze),{class:"h-16 w-16 text-green-500 mx-auto mb-4"}),jt,e("p",Ot,[w(" Tu organización "),e("strong",null,l((P=g.value)==null?void 0:P.title),1),w(" ha sido creada exitosamente. ")]),e("div",{class:"space-y-3"},[e("button",{onClick:C,class:"w-full inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Crear Otra Organización "),e("button",{onClick:$,class:"w-full inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cerrar ")])])):(a(),n("form",{key:2,onSubmit:ye(M,["prevent"]),class:"space-y-6"},[e("div",Nt,[At,e("div",null,[Ut,e("div",Vt,[W(e("input",{id:"title","onUpdate:modelValue":b[0]||(b[0]=A=>E.value.title=A),type:"text",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ej: Consultora Jurídica Andina"},null,512),[[ae,E.value.title]])]),h.value.title?(a(),n("p",Tt,l(h.value.title[0]),1)):q("",!0)]),e("div",null,[Gt,e("div",Bt,[W(e("textarea",{id:"description","onUpdate:modelValue":b[1]||(b[1]=A=>E.value.description=A),rows:"4",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Describe el propósito y servicios de tu organización..."},null,512),[[ae,E.value.description]])]),Ft,h.value.description?(a(),n("p",Ht,l(h.value.description[0]),1)):q("",!0)])]),e("div",Wt,[Zt,e("div",null,[Qt,e("div",Yt,[e("div",Jt,[e("img",{src:_.value||c(X),alt:"Profile preview",class:"h-16 w-16 rounded-full object-cover border-2 border-gray-200 bg-gray-50"},null,8,Xt)]),e("div",Kt,[e("input",{ref:"profileImageInput",type:"file",accept:"image/*",class:"hidden",onChange:k},null,544),e("button",{type:"button",onClick:b[2]||(b[2]=A=>p.$refs.profileImageInput.click()),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(je),{class:"h-4 w-4 mr-2"}),w(" Seleccionar Imagen ")]),es])]),h.value.profile_image?(a(),n("p",ts,l(h.value.profile_image[0]),1)):q("",!0)]),e("div",null,[ss,e("div",os,[e("div",as,[e("img",{src:v.value||y.value,alt:"Cover preview",class:"w-full h-32 rounded-lg object-cover border-2 border-gray-200 bg-gray-50"},null,8,is)]),e("div",null,[e("input",{ref:"coverImageInput",type:"file",accept:"image/*",class:"hidden",onChange:x},null,544),e("button",{type:"button",onClick:b[3]||(b[3]=A=>p.$refs.coverImageInput.click()),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(je),{class:"h-4 w-4 mr-2"}),w(" Seleccionar Portada ")]),ns])]),h.value.cover_image?(a(),n("p",rs,l(h.value.cover_image[0]),1)):q("",!0)])]),E.value.title||E.value.description?(a(),n("div",ls,[cs,e("div",ds,[e("div",us,[v.value?(a(),n("img",{key:0,src:v.value,alt:"Portada preview",class:"w-full h-full object-cover"},null,8,ms)):q("",!0),gs,e("div",fs,[e("img",{src:_.value||c(X),alt:"Logo preview",class:"h-12 w-12 rounded-full border-2 border-white object-cover bg-white"},null,8,hs)])]),e("div",vs,[e("h3",ps,l(E.value.title||"Nombre de la Organización"),1),e("p",_s,l(E.value.description||"Descripción de la organización..."),1)])])])):q("",!0),e("div",bs,[e("div",ys,[u(c(de),{class:"h-5 w-5 text-blue-400 mt-0.5"}),xs])]),e("div",ws,[e("button",{type:"button",onClick:$,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value||!E.value.title.trim()||!E.value.description.trim(),class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),n("div",zs)):(a(),H(c(Re),{key:1,class:"h-4 w-4 mr-2"})),w(" "+l(i.value?"Creando...":"Crear Organización"),1)],8,$s)])],32))]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},ks=Se(Es,[["__scopeId","data-v-6908ea93"]]),qs=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),Cs={class:"fixed inset-0 z-10 overflow-y-auto"},Rs={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},Ms={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},Ps=e("p",{class:"mt-1 text-sm text-gray-500"}," Actualiza la información y configuración de tu organización ",-1),Ds={key:0,class:"flex justify-center items-center py-8"},Ss=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),Is=e("span",{class:"ml-2 text-gray-600"},"Actualizando organización...",-1),Ls=[Ss,Is],js={class:"space-y-4"},Os=e("h4",{class:"text-md font-medium text-gray-900"},"Información Básica",-1),Ns=e("label",{for:"title",class:"block text-sm font-medium leading-6 text-gray-900"}," Nombre de la Organización * ",-1),As={class:"mt-2"},Us={key:0,class:"mt-1 text-sm text-red-600"},Vs=e("label",{for:"description",class:"block text-sm font-medium leading-6 text-gray-900"}," Descripción * ",-1),Ts={class:"mt-2"},Gs={key:0,class:"mt-1 text-sm text-red-600"},Bs=e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Estado de la Organización ",-1),Fs={class:"mt-2"},Hs={class:"flex items-center space-x-6"},Ws={class:"flex items-center"},Zs=e("label",{for:"active",class:"ml-2 block text-sm text-gray-900"}," Activa ",-1),Qs={class:"flex items-center"},Ys=e("label",{for:"inactive",class:"ml-2 block text-sm text-gray-900"}," Inactiva ",-1),Js={class:"space-y-4 border-t border-gray-200 pt-6"},Xs=e("h4",{class:"text-md font-medium text-gray-900"},"Imágenes",-1),Ks=e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Imagen de Perfil ",-1),eo={class:"mt-2 flex items-center space-x-4"},to={class:"flex-shrink-0"},so=["src"],oo=e("p",{class:"mt-1 text-xs text-gray-500"},"PNG, JPG hasta 5MB",-1),ao={key:0,class:"mt-1 text-sm text-red-600"},io=e("label",{class:"block text-sm font-medium leading-6 text-gray-900"}," Imagen de Portada ",-1),no={class:"mt-2"},ro={class:"mb-4"},lo=["src"],co=e("p",{class:"mt-1 text-xs text-gray-500"},"PNG, JPG hasta 5MB",-1),uo={key:0,class:"mt-1 text-sm text-red-600"},mo={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},go=["disabled"],fo={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},ho={__name:"EditOrganizationModal",props:{visible:{type:Boolean,default:!1},organization:{type:Object,default:null}},emits:["close","updated"],setup(t,{emit:o}){const s=t,r=o,d=ue(),i=R(!1),f=R({}),h=R({title:"",description:"",is_active:!0,profile_image:null,cover_image:null}),g=R(null),E=R(null),_=D(()=>{var C;return g.value?g.value:(C=s.organization)!=null&&C.profile_image_url?s.organization.profile_image_url:X}),v=D(()=>{var C;return E.value?E.value:(C=s.organization)!=null&&C.cover_image_url?s.organization.cover_image_url:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMDAgMTAwTDE4MCA4MEwyMjAgODBMMjAwIDEwMFoiIGZpbGw9IiM5Q0E0QUYiLz4KPC9zdmc+"}),y=()=>{s.organization?h.value={title:s.organization.title||"",description:s.organization.description||"",is_active:s.organization.is_active!==void 0?s.organization.is_active:!0,profile_image:null,cover_image:null}:h.value={title:"",description:"",is_active:!0,profile_image:null,cover_image:null},f.value={},g.value=null,E.value=null},m=C=>{const $=C.target.files[0];if($){if($.size>5*1024*1024){j("La imagen debe ser menor a 5MB","warning");return}if(!$.type.startsWith("image/")){j("Solo se permiten archivos de imagen","warning");return}h.value.profile_image=$;const p=new FileReader;p.onload=b=>{g.value=b.target.result},p.readAsDataURL($)}},k=C=>{const $=C.target.files[0];if($){if($.size>5*1024*1024){j("La imagen debe ser menor a 5MB","warning");return}if(!$.type.startsWith("image/")){j("Solo se permiten archivos de imagen","warning");return}h.value.cover_image=$;const p=new FileReader;p.onload=b=>{E.value=b.target.result},p.readAsDataURL($)}},x=async()=>{var C,$,p,b;if(s.organization)try{i.value=!0,f.value={};const P={title:h.value.title,description:h.value.description,is_active:h.value.is_active};h.value.profile_image&&(P.profile_image=h.value.profile_image),h.value.cover_image&&(P.cover_image=h.value.cover_image);const A=await d.updateOrganization(s.organization.id,P);j("Organización actualizada exitosamente","success"),r("updated",A.organization)}catch(P){console.error("Error updating organization:",P),($=(C=P.response)==null?void 0:C.data)!=null&&$.details?f.value=P.response.data.details:(b=(p=P.response)==null?void 0:p.data)!=null&&b.error?j(P.response.data.error,"error"):j("Error al actualizar la organización","error")}finally{i.value=!1}},M=()=>{i.value||r("close")};return te(()=>s.visible,C=>{C&&Me(()=>{y()})}),te(()=>s.organization,C=>{C&&s.visible&&y()}),(C,$)=>(a(),H(c(pe),{as:"template",show:t.visible},{default:O(()=>[u(c(fe),{class:"relative z-50",onClose:M},{default:O(()=>[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[qs]),_:1}),e("div",Cs,[e("div",Rs,[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6"},{default:O(()=>[e("div",Ms,[e("div",null,[u(c(ve),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:O(()=>[w(" Editar Organización ")]),_:1}),Ps]),e("button",{onClick:M,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(c(le),{class:"h-6 w-6"})])]),i.value?(a(),n("div",Ds,Ls)):(a(),n("form",{key:1,onSubmit:ye(x,["prevent"]),class:"space-y-6"},[e("div",js,[Os,e("div",null,[Ns,e("div",As,[W(e("input",{id:"title","onUpdate:modelValue":$[0]||($[0]=p=>h.value.title=p),type:"text",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ingresa el nombre de la organización"},null,512),[[ae,h.value.title]])]),f.value.title?(a(),n("p",Us,l(f.value.title[0]),1)):q("",!0)]),e("div",null,[Vs,e("div",Ts,[W(e("textarea",{id:"description","onUpdate:modelValue":$[1]||($[1]=p=>h.value.description=p),rows:"4",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Describe tu organización..."},null,512),[[ae,h.value.description]])]),f.value.description?(a(),n("p",Gs,l(f.value.description[0]),1)):q("",!0)]),e("div",null,[Bs,e("div",Fs,[e("div",Hs,[e("div",Ws,[W(e("input",{id:"active","onUpdate:modelValue":$[2]||($[2]=p=>h.value.is_active=p),value:!0,type:"radio",class:"h-4 w-4 text-blue-600 focus:ring-blue-600 border-gray-300"},null,512),[[Ke,h.value.is_active]]),Zs]),e("div",Qs,[W(e("input",{id:"inactive","onUpdate:modelValue":$[3]||($[3]=p=>h.value.is_active=p),value:!1,type:"radio",class:"h-4 w-4 text-blue-600 focus:ring-blue-600 border-gray-300"},null,512),[[Ke,h.value.is_active]]),Ys])])])])]),e("div",Js,[Xs,e("div",null,[Ks,e("div",eo,[e("div",to,[e("img",{src:_.value,alt:"Profile preview",class:"h-16 w-16 rounded-full object-cover border-2 border-gray-200"},null,8,so)]),e("div",null,[e("input",{ref:"profileImageInput",type:"file",accept:"image/*",class:"hidden",onChange:m},null,544),e("button",{type:"button",onClick:$[4]||($[4]=p=>C.$refs.profileImageInput.click()),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(je),{class:"h-4 w-4 mr-2"}),w(" Cambiar Imagen ")]),oo])]),f.value.profile_image?(a(),n("p",ao,l(f.value.profile_image[0]),1)):q("",!0)]),e("div",null,[io,e("div",no,[e("div",ro,[e("img",{src:v.value,alt:"Cover preview",class:"w-full h-32 rounded-lg object-cover border-2 border-gray-200"},null,8,lo)]),e("div",null,[e("input",{ref:"coverImageInput",type:"file",accept:"image/*",class:"hidden",onChange:k},null,544),e("button",{type:"button",onClick:$[5]||($[5]=p=>C.$refs.coverImageInput.click()),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(je),{class:"h-4 w-4 mr-2"}),w(" Cambiar Portada ")]),co])]),f.value.cover_image?(a(),n("p",uo,l(f.value.cover_image[0]),1)):q("",!0)])]),e("div",mo,[e("button",{type:"button",onClick:M,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value,class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),n("div",fo)):q("",!0),w(" "+l(i.value?"Guardando...":"Guardar Cambios"),1)],8,go)])],32))]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},vo=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),po={class:"fixed inset-0 z-10 overflow-y-auto"},_o={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},bo={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},yo={class:"mt-1 text-sm text-gray-500"},xo={key:0,class:"flex justify-center items-center py-8"},wo=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),$o=e("span",{class:"ml-2 text-gray-600"},"Enviando invitación...",-1),zo=[wo,$o],Eo={key:0,class:"bg-gray-50 rounded-lg p-4"},ko={class:"flex items-center space-x-3"},qo=["src","alt"],Co={class:"text-sm font-medium text-gray-900"},Ro={class:"text-xs text-gray-500"},Mo=e("label",{for:"email",class:"block text-sm font-medium leading-6 text-gray-900"}," Email del Cliente * ",-1),Po={class:"mt-2"},Do=e("p",{class:"mt-1 text-xs text-gray-500"}," El email debe corresponder a un usuario registrado como cliente en la plataforma ",-1),So={key:0,class:"mt-1 text-sm text-red-600"},Io=e("label",{for:"message",class:"block text-sm font-medium leading-6 text-gray-900"}," Mensaje Personalizado ",-1),Lo={class:"mt-2"},jo=e("p",{class:"mt-1 text-xs text-gray-500"}," Este mensaje se incluirá en la invitación que reciba el cliente ",-1),Oo={key:0,class:"mt-1 text-sm text-red-600"},No={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Ao=e("h5",{class:"text-sm font-medium text-blue-900 mb-2"},"Vista previa del mensaje:",-1),Uo={class:"text-sm text-blue-800 bg-white rounded p-3 border border-blue-100"},Vo={class:"mb-2"},To={class:"mb-2 italic"},Go=e("p",{class:"text-xs text-blue-600"},"Puedes aceptar o rechazar esta invitación desde tu panel de control.",-1),Bo={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},Fo={class:"flex"},Ho=e("div",{class:"ml-3"},[e("h5",{class:"text-sm font-medium text-yellow-800"},"Información importante"),e("div",{class:"mt-1 text-sm text-yellow-700 space-y-1"},[e("p",null,"• La invitación se enviará al usuario dentro de la plataforma"),e("p",null,"• El usuario debe estar registrado como cliente"),e("p",null,"• Las invitaciones expiran automáticamente en 30 días"),e("p",null,"• Puedes cancelar invitaciones pendientes en cualquier momento")])],-1),Wo={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},Zo=["disabled"],Qo={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Yo={key:2,class:"text-center py-6"},Jo=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," ¡Invitación Enviada! ",-1),Xo={class:"text-sm text-gray-600 mb-6"},Ko={__name:"InviteMemberModal",props:{visible:{type:Boolean,default:!1},organization:{type:Object,default:null}},emits:["close","invited"],setup(t,{emit:o}){const s=t,r=o,d=ue(),i=R(!1),f=R(!1),h=R({}),g=R({invited_user_email:"",message:""}),E=()=>{g.value={invited_user_email:"",message:""},h.value={},f.value=!1},_=async()=>{var k,x,M,C,$,p;if(s.organization)try{i.value=!0,h.value={};const b={invited_user_email:g.value.invited_user_email.trim(),message:g.value.message.trim()},P=await d.sendInvitation(s.organization.id,b);j("Invitación enviada exitosamente","success"),f.value=!0,r("invited",P.invitation)}catch(b){console.error("Error sending invitation:",b),(x=(k=b.response)==null?void 0:k.data)!=null&&x.details?h.value=b.response.data.details:(C=(M=b.response)==null?void 0:M.data)!=null&&C.error?j(b.response.data.error,"error"):(($=b.response)==null?void 0:$.status)===400?(p=b.response.data)!=null&&p.invited_user_email?h.value.invited_user_email=b.response.data.invited_user_email:j("Error en los datos de la invitación","error"):j("Error al enviar la invitación","error")}finally{i.value=!1}},v=()=>{E()},y=()=>{i.value||r("close")};te(()=>s.visible,k=>{k&&Me(()=>{E()})});const m=D(()=>s.organization?`Te invitamos a unirte a nuestra organización "${s.organization.title}" para colaborar en proyectos y solicitudes corporativas. ¡Esperamos contar contigo!`:"");return te(()=>s.organization,k=>{k&&s.visible&&!g.value.message.trim()&&(g.value.message=m.value)}),(k,x)=>(a(),H(c(pe),{as:"template",show:t.visible},{default:O(()=>[u(c(fe),{class:"relative z-50",onClose:y},{default:O(()=>[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[vo]),_:1}),e("div",po,[e("div",_o,[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"},{default:O(()=>{var M,C;return[e("div",bo,[e("div",null,[u(c(ve),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:O(()=>[w(" Invitar Nuevo Miembro ")]),_:1}),e("p",yo," Invita a un cliente a unirse a "+l((M=t.organization)==null?void 0:M.title),1)]),e("button",{onClick:y,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(c(le),{class:"h-6 w-6"})])]),i.value?(a(),n("div",xo,zo)):(a(),n("form",{key:1,onSubmit:ye(_,["prevent"]),class:"space-y-6"},[t.organization?(a(),n("div",Eo,[e("div",ko,[e("img",{src:t.organization.profile_image_url||c(X),alt:`Logo de ${t.organization.title}`,class:"h-12 w-12 rounded-full object-cover border-2 border-white"},null,8,qo),e("div",null,[e("h4",Co,l(t.organization.title),1),e("p",Ro,l(t.organization.member_count)+" miembros actuales",1)])])])):q("",!0),e("div",null,[Mo,e("div",Po,[W(e("input",{id:"email","onUpdate:modelValue":x[0]||(x[0]=$=>g.value.invited_user_email=$),type:"email",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"cliente@ejemplo.com"},null,512),[[ae,g.value.invited_user_email]])]),Do,h.value.invited_user_email?(a(),n("p",So,l(h.value.invited_user_email[0]),1)):q("",!0)]),e("div",null,[Io,e("div",Lo,[W(e("textarea",{id:"message","onUpdate:modelValue":x[1]||(x[1]=$=>g.value.message=$),rows:"4",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Opcional: Añade un mensaje personalizado para la invitación..."},null,512),[[ae,g.value.message]])]),jo,h.value.message?(a(),n("p",Oo,l(h.value.message[0]),1)):q("",!0)]),g.value.message.trim()?(a(),n("div",No,[Ao,e("div",Uo,[e("p",Vo,[e("strong",null,l((C=t.organization)==null?void 0:C.title),1),w(" te ha invitado a unirte a su organización.")]),e("p",To,'"'+l(g.value.message)+'"',1),Go])])):q("",!0),e("div",Bo,[e("div",Fo,[u(c(de),{class:"h-5 w-5 text-yellow-400 mt-0.5"}),Ho])]),e("div",Wo,[e("button",{type:"button",onClick:y,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value||!g.value.invited_user_email.trim(),class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),n("div",Qo)):(a(),H(c(ct),{key:1,class:"h-4 w-4 mr-2"})),w(" "+l(i.value?"Enviando...":"Enviar Invitación"),1)],8,Zo)])],32)),f.value?(a(),n("div",Yo,[u(c(ze),{class:"h-16 w-16 text-green-500 mx-auto mb-4"}),Jo,e("p",Xo,[w(" La invitación ha sido enviada exitosamente a "),e("strong",null,l(g.value.invited_user_email),1)]),e("div",{class:"space-y-3"},[e("button",{onClick:v,class:"w-full inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Invitar a Otra Persona "),e("button",{onClick:y,class:"w-full inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cerrar ")])])):q("",!0)]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},ea=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),ta={class:"fixed inset-0 z-10 overflow-y-auto"},sa={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},oa={class:"mb-4"},aa={class:"flex items-center justify-between"},ia={class:"flex items-center space-x-3"},na={class:"flex-shrink-0"},ra=["src","alt"],la={class:"text-sm text-gray-500"},ca=e("span",{class:"sr-only"},"Cerrar",-1),da={key:0,class:"flex justify-center items-center py-12"},ua=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),ma=e("span",{class:"ml-2 text-gray-600"},"Cargando miembros...",-1),ga=[ua,ma],fa={key:1,class:"mt-4"},ha={class:"max-h-96 overflow-y-auto"},va={role:"list",class:"divide-y divide-gray-200"},pa={class:"flex items-center space-x-4"},_a={class:"flex-shrink-0"},ba=["src","alt"],ya={key:1,class:"h-10 w-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-semibold text-sm shadow-sm"},xa={class:"flex-1 min-w-0"},wa={class:"text-sm font-medium text-gray-900 truncate"},$a={class:"text-sm text-gray-500 truncate"},za={class:"flex items-center space-x-2"},Ea={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},ka={class:"flex-shrink-0 text-sm text-gray-500"},qa={class:"flex items-center"},Ca={key:2,class:"text-center py-12"},Ra=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay miembros",-1),Ma=e("p",{class:"mt-1 text-sm text-gray-500"}," Esta organización aún no tiene miembros activos. ",-1),Pa={class:"mt-5 sm:mt-6"},Da={__name:"MembersListModal",props:{visible:{type:Boolean,required:!0},organization:{type:Object,default:null}},emits:["close"],setup(t,{emit:o}){const s=t,r=o,d=ue(),i=R(!1),f=R([]),h=async()=>{var _;if((_=s.organization)!=null&&_.id)try{i.value=!0;const v=await d.getOrganizationMembers(s.organization.id);f.value=v||[]}catch(v){console.error("Error loading members:",v),j("Error al cargar los miembros","error"),f.value=[]}finally{i.value=!1}},g=_=>new Date(_).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}),E=(_,v)=>{var k,x;const y=((k=_==null?void 0:_.charAt(0))==null?void 0:k.toUpperCase())||"",m=((x=v==null?void 0:v.charAt(0))==null?void 0:x.toUpperCase())||"";return`${y}${m}`||"?"};return te(()=>s.visible,_=>{_&&s.organization&&h()}),(_,v)=>(a(),H(c(pe),{as:"template",show:t.visible},{default:O(()=>[u(c(fe),{as:"div",class:"relative z-50",onClose:v[2]||(v[2]=y=>r("close"))},{default:O(()=>[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[ea]),_:1}),e("div",ta,[e("div",sa,[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6"},{default:O(()=>{var y;return[e("div",oa,[e("div",aa,[e("div",ia,[e("div",na,[t.organization?(a(),n("img",{key:0,src:t.organization.profile_image_url||c(X),alt:`Logo de ${(y=t.organization)==null?void 0:y.title}`,class:"h-12 w-12 rounded-full object-cover border-2 border-gray-200"},null,8,ra)):q("",!0)]),e("div",null,[u(c(ve),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:O(()=>{var m;return[w(" Miembros de "+l((m=t.organization)==null?void 0:m.title),1)]}),_:1}),e("p",la,l(f.value.length)+" "+l(f.value.length===1?"miembro activo":"miembros activos"),1)])]),e("button",{type:"button",class:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:v[0]||(v[0]=m=>r("close"))},[ca,u(c(le),{class:"h-6 w-6"})])])]),i.value?(a(),n("div",da,ga)):f.value.length>0?(a(),n("div",fa,[e("div",ha,[e("ul",va,[(a(!0),n(Q,null,Y(f.value,m=>{var k,x,M,C,$,p;return a(),n("li",{key:m.id,class:"py-4 hover:bg-gray-50 px-4 rounded-lg transition-colors"},[e("div",pa,[e("div",_a,[(k=m.user_info)!=null&&k.profile_image_url?(a(),n("img",{key:0,src:m.user_info.profile_image_url,alt:`Avatar de ${(x=m.user_info)==null?void 0:x.full_name}`,class:"h-10 w-10 rounded-full object-cover border border-gray-200"},null,8,ba)):(a(),n("div",ya,l(E((M=m.user_info)==null?void 0:M.first_name,(C=m.user_info)==null?void 0:C.last_name)),1))]),e("div",xa,[e("p",wa,l(($=m.user_info)==null?void 0:$.full_name),1),e("p",$a,l((p=m.user_info)==null?void 0:p.email),1)]),e("div",za,[e("span",{class:B([m.role==="ADMIN"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800","inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(m.role_display),3),m.is_active?(a(),n("span",Ea,[u(c(ze),{class:"h-3 w-3 mr-1"}),w(" Activo ")])):q("",!0)]),e("div",ka,[e("div",qa,[u(c(re),{class:"h-4 w-4 mr-1"}),w(" "+l(g(m.joined_at)),1)])])])])}),128))])])])):(a(),n("div",Ca,[u(c(xe),{class:"h-12 w-12 mx-auto text-gray-300"}),Ra,Ma])),e("div",Pa,[e("button",{type:"button",class:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600",onClick:v[1]||(v[1]=m=>r("close"))}," Cerrar ")])]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},Sa=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),Ia={class:"fixed inset-0 z-10 overflow-y-auto"},La={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},ja={class:"mb-4"},Oa={class:"flex items-center justify-between"},Na={class:"text-sm text-gray-500 mt-1"},Aa=e("span",{class:"sr-only"},"Cerrar",-1),Ua={key:0,class:"flex justify-center items-center py-12"},Va=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),Ta=e("span",{class:"ml-2 text-gray-600"},"Cargando miembros...",-1),Ga=[Va,Ta],Ba={key:1,class:"mt-4"},Fa={class:"max-h-[32rem] overflow-y-auto space-y-6"},Ha={class:"bg-gray-50 px-4 py-3 border-b border-gray-200"},Wa={class:"flex items-center space-x-3"},Za=["src","alt"],Qa={class:"text-sm font-semibold text-gray-900"},Ya={class:"text-xs text-gray-500"},Ja={class:"bg-white"},Xa={role:"list",class:"divide-y divide-gray-200"},Ka={class:"flex items-center space-x-3"},ei={class:"flex-shrink-0"},ti=["src","alt"],si={class:"flex-1 min-w-0"},oi={class:"text-sm font-medium text-gray-900 truncate"},ai={class:"text-xs text-gray-500 truncate"},ii={class:"flex items-center space-x-2"},ni={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},ri={class:"flex-shrink-0 text-xs text-gray-500 hidden sm:block"},li={class:"flex items-center"},ci={key:2,class:"text-center py-12"},di=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay miembros",-1),ui=e("p",{class:"mt-1 text-sm text-gray-500"}," Tus organizaciones aún no tienen miembros activos. ",-1),mi={class:"mt-5 sm:mt-6"},gi={__name:"AllMembersModal",props:{visible:{type:Boolean,required:!0},organizations:{type:Array,default:()=>[]}},emits:["close"],setup(t,{emit:o}){const s=t,r=o,d=ue(),i=R(!1),f=R([]),h=D(()=>f.value.reduce((_,v)=>_+v.members.length,0)),g=async()=>{if(!(!s.organizations||s.organizations.length===0))try{i.value=!0;const _=s.organizations.map(async v=>{try{const y=await d.getOrganizationMembers(v.id);return{organization:v,members:y||[]}}catch(y){return console.error(`Error loading members for organization ${v.id}:`,y),{organization:v,members:[]}}});f.value=await Promise.all(_)}catch(_){console.error("Error loading all members:",_),j("Error al cargar los miembros","error"),f.value=[]}finally{i.value=!1}},E=_=>new Date(_).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"});return te(()=>s.visible,_=>{_&&s.organizations&&s.organizations.length>0&&g()}),(_,v)=>(a(),H(c(pe),{as:"template",show:t.visible},{default:O(()=>[u(c(fe),{as:"div",class:"relative z-50",onClose:v[2]||(v[2]=y=>r("close"))},{default:O(()=>[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[Sa]),_:1}),e("div",Ia,[e("div",La,[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl sm:p-6"},{default:O(()=>[e("div",ja,[e("div",Oa,[e("div",null,[u(c(ve),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:O(()=>[w(" Todos los Miembros ")]),_:1}),e("p",Na,l(h.value)+" "+l(h.value===1?"miembro":"miembros")+" en "+l(t.organizations.length)+" "+l(t.organizations.length===1?"organización":"organizaciones"),1)]),e("button",{type:"button",class:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:v[0]||(v[0]=y=>r("close"))},[Aa,u(c(le),{class:"h-6 w-6"})])])]),i.value?(a(),n("div",Ua,Ga)):f.value.length>0?(a(),n("div",Ba,[e("div",Fa,[(a(!0),n(Q,null,Y(f.value,y=>(a(),n("div",{key:y.organization.id,class:"border border-gray-200 rounded-lg overflow-hidden"},[e("div",Ha,[e("div",Wa,[e("img",{src:y.organization.profile_image_url||c(X),alt:`Logo de ${y.organization.title}`,class:"h-10 w-10 rounded-full object-cover border-2 border-gray-200"},null,8,Za),e("div",null,[e("h4",Qa,l(y.organization.title),1),e("p",Ya,l(y.members.length)+" "+l(y.members.length===1?"miembro":"miembros"),1)])])]),e("div",Ja,[e("ul",Xa,[(a(!0),n(Q,null,Y(y.members,m=>{var k,x,M,C;return a(),n("li",{key:m.id,class:"py-3 px-4 hover:bg-gray-50 transition-colors"},[e("div",Ka,[e("div",ei,[e("img",{src:((k=m.user_info)==null?void 0:k.profile_image_url)||c(X),alt:`Avatar de ${(x=m.user_info)==null?void 0:x.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,ti)]),e("div",si,[e("p",oi,l((M=m.user_info)==null?void 0:M.full_name),1),e("p",ai,l((C=m.user_info)==null?void 0:C.email),1)]),e("div",ii,[e("span",{class:B([m.role==="ADMIN"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800","inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"])},l(m.role_display),3),m.is_active?(a(),n("span",ni,[u(c(ze),{class:"h-3 w-3 mr-1"}),w(" Activo ")])):q("",!0)]),e("div",ri,[e("div",li,[u(c(re),{class:"h-3 w-3 mr-1"}),w(" "+l(E(m.joined_at)),1)])])])])}),128))])])]))),128))])])):(a(),n("div",ci,[u(c(xe),{class:"h-12 w-12 mx-auto text-gray-300"}),di,ui])),e("div",mi,[e("button",{type:"button",class:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600",onClick:v[1]||(v[1]=y=>r("close"))}," Cerrar ")])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},Ee=t=>(Pe("data-v-ed42b646"),t=t(),De(),t),fi={class:"bg-white shadow rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow"},hi={class:"mb-4"},vi={class:"flex items-center flex-wrap gap-2 mb-2"},pi={class:"text-sm font-medium text-gray-900"},_i={class:"text-lg font-semibold text-gray-900 mb-1"},bi={class:"text-sm text-gray-600 line-clamp-2 mb-3"},yi={class:"flex flex-wrap gap-2"},xi=Ee(()=>e("span",{class:"hidden sm:inline"},"Ver Detalle",-1)),wi=Ee(()=>e("span",{class:"sm:hidden"},"Detalle",-1)),$i={class:"relative"},zi=Ee(()=>e("span",{class:"hidden sm:inline"},"Cambiar Estado",-1)),Ei=Ee(()=>e("span",{class:"sm:hidden"},"Estado",-1)),ki={key:0,class:"absolute right-0 mt-1 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none z-10"},qi={class:"py-1"},Ci=["onClick","disabled"],Ri={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Mi={class:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg"},Pi=["src","alt"],Di={class:"text-sm font-medium text-gray-900"},Si={class:"text-xs text-gray-500"},Ii={class:"flex items-center space-x-3 p-3 bg-blue-50 rounded-lg"},Li=["src","alt"],ji={class:"text-sm font-medium text-blue-900"},Oi=Ee(()=>e("p",{class:"text-xs text-blue-600"}," Vía organización ",-1)),Ni={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-gray-500 mb-4"},Ai={class:"flex items-center"},Ui={class:"flex items-center"},Vi={class:"flex items-center"},Ti={class:"flex items-center"},Gi={key:0,class:"text-xs text-gray-500 mb-3"},Bi=Ee(()=>e("span",{class:"font-medium"},"Última actualización:",-1)),Fi={class:"w-full bg-gray-200 rounded-full h-1.5 mb-2"},Hi={class:"text-xs text-gray-500"},Wi={__name:"CorporateRequestCard",props:{request:{type:Object,required:!0}},emits:["view-detail","status-updated"],setup(t,{emit:o}){const s=t,r=o,d=R(!1),i=R(!1),f=D(()=>{var p;return((p=s.request.client_info)==null?void 0:p.profile_image_url)||X}),h=D(()=>{var p;return((p=s.request.organization_info)==null?void 0:p.profile_image_url)||X}),g=D(()=>[{value:"PENDING",label:"Pendiente"},{value:"IN_REVIEW",label:"En Revisión"},{value:"RESPONDED",label:"Respondida"},{value:"RESOLVED",label:"Resuelta"},{value:"CLOSED",label:"Cerrada"}]),E=()=>{r("view-detail",s.request.id)},_=async p=>{if(p===s.request.status){d.value=!1;return}try{i.value=!0,d.value=!1,r("status-updated",{requestId:s.request.id,newStatus:p,request:s.request})}catch(b){console.error("Error updating status:",b)}finally{i.value=!1}},v=p=>({PENDING:"Pendiente",IN_REVIEW:"En Revisión",RESPONDED:"Respondida",RESOLVED:"Resuelta",CLOSED:"Cerrada"})[p]||p,y=p=>({PENDING:"bg-yellow-100 text-yellow-800",IN_REVIEW:"bg-blue-100 text-blue-800",RESPONDED:"bg-purple-100 text-purple-800",RESOLVED:"bg-green-100 text-green-800",CLOSED:"bg-gray-100 text-gray-800"})[p]||"bg-gray-100 text-gray-800",m=p=>({LOW:"Baja",MEDIUM:"Media",HIGH:"Alta",URGENT:"Urgente"})[p]||p,k=p=>({LOW:"bg-gray-100 text-gray-600",MEDIUM:"bg-blue-100 text-blue-600",HIGH:"bg-orange-100 text-orange-600",URGENT:"bg-red-100 text-red-600"})[p]||"bg-gray-100 text-gray-600",x=p=>({PENDING:20,IN_REVIEW:40,RESPONDED:60,RESOLVED:80,CLOSED:100})[p]||0,M=p=>({PENDING:"bg-yellow-500",IN_REVIEW:"bg-blue-500",RESPONDED:"bg-purple-500",RESOLVED:"bg-green-500",CLOSED:"bg-gray-500"})[p]||"bg-gray-500",C=p=>({PENDING:"La solicitud está esperando revisión inicial",IN_REVIEW:"La solicitud está siendo analizada por el equipo",RESPONDED:"Se ha proporcionado una respuesta al cliente",RESOLVED:"La solicitud ha sido completada satisfactoriamente",CLOSED:"La solicitud ha sido cerrada y archivada"})[p]||"Estado desconocido",$=p=>{const b=new Date(p),A=Math.abs(new Date-b),U=Math.ceil(A/(1e3*60*60*24));return U===0?"Hoy":U===1?"Ayer":U<7?`Hace ${U} días`:U<30?`Hace ${Math.ceil(U/7)} semanas`:b.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})};return(p,b)=>{var P,A,U,T,V;return a(),n("div",fi,[e("div",hi,[e("div",vi,[e("span",pi,l(t.request.request_number),1),e("span",{class:B([y(t.request.status),"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium"])},l(v(t.request.status)),3),e("span",{class:B([k(t.request.priority),"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium"])},l(m(t.request.priority)),3)]),e("h3",_i,l(t.request.title),1),e("p",bi,l(t.request.description),1),e("div",yi,[e("button",{onClick:E,class:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(Ne),{class:"h-3 w-3 sm:mr-1"}),xi,wi]),e("div",$i,[e("button",{onClick:b[0]||(b[0]=S=>d.value=!d.value),class:"inline-flex items-center px-2.5 py-1.5 border border-blue-300 text-xs font-medium rounded text-blue-700 bg-blue-50 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 whitespace-nowrap"},[u(c(Ze),{class:"h-3 w-3 sm:mr-1"}),zi,Ei]),d.value?(a(),n("div",ki,[e("div",qi,[(a(!0),n(Q,null,Y(g.value,S=>(a(),n("button",{key:S.value,onClick:N=>_(S.value),disabled:i.value,class:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 disabled:opacity-50"},[e("span",{class:B([y(S.value),"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium mr-2"])},l(S.label),3)],8,Ci))),128))])])):q("",!0)])])]),e("div",Ri,[e("div",Mi,[e("img",{src:f.value,alt:`Avatar de ${(P=t.request.client_info)==null?void 0:P.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,Pi),e("div",null,[e("p",Di,l((A=t.request.client_info)==null?void 0:A.full_name),1),e("p",Si," Cliente • "+l((U=t.request.client_info)==null?void 0:U.email),1)])]),e("div",Ii,[e("img",{src:h.value,alt:`Logo de ${(T=t.request.organization_info)==null?void 0:T.title}`,class:"h-8 w-8 rounded-full object-cover border border-blue-200"},null,8,Li),e("div",null,[e("p",ji,l(((V=t.request.organization_info)==null?void 0:V.title)||"Organización"),1),Oi])])]),e("div",Ni,[e("div",Ai,[u(c(it),{class:"h-3 w-3 mr-1"}),w(" "+l(t.request.request_type_name),1)]),e("div",Ui,[u(c(re),{class:"h-3 w-3 mr-1"}),w(" "+l($(t.request.created_at)),1)]),e("div",Vi,[u(c(Qe),{class:"h-3 w-3 mr-1"}),w(" "+l(t.request.response_count)+" respuestas ",1)]),e("div",Ti,[u(c(Be),{class:"h-3 w-3 mr-1"}),w(" "+l(t.request.days_since_created)+" días ",1)])]),t.request.status_updated_at&&t.request.status_updated_at!==t.request.created_at?(a(),n("div",Gi,[Bi,w(" "+l($(t.request.status_updated_at)),1)])):q("",!0),e("div",Fi,[e("div",{class:B([M(t.request.status),"h-1.5 rounded-full transition-all duration-300"]),style:st({width:x(t.request.status)+"%"})},null,6)]),e("p",Hi,l(C(t.request.status)),1),d.value?(a(),n("div",{key:1,onClick:b[1]||(b[1]=S=>d.value=!1),class:"fixed inset-0 z-0"})):q("",!0)])}}},Zi=Se(Wi,[["__scopeId","data-v-ed42b646"]]),Qi={class:"mb-6"},Yi={class:"flex items-center justify-between"},Ji=e("div",null,[e("h2",{class:"text-lg font-medium text-gray-900"},"Solicitudes Recibidas"),e("p",{class:"mt-1 text-sm text-gray-600"}," Gestiona todas las solicitudes enviadas por tus clientes ")],-1),Xi=["disabled"],Ki={class:"mb-6 bg-gray-50 rounded-lg p-4"},en={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},tn=e("label",{for:"status-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Estado ",-1),sn=we('<option value="">Todos los estados</option><option value="PENDING">Pendiente</option><option value="IN_REVIEW">En Revisión</option><option value="RESPONDED">Respondida</option><option value="RESOLVED">Resuelta</option><option value="CLOSED">Cerrada</option>',6),on=[sn],an=e("label",{for:"priority-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Prioridad ",-1),nn=we('<option value="">Todas las prioridades</option><option value="LOW">Baja</option><option value="MEDIUM">Media</option><option value="HIGH">Alta</option><option value="URGENT">Urgente</option>',5),rn=[nn],ln=e("label",{for:"organization-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Organización ",-1),cn=e("option",{value:""},"Todas las organizaciones",-1),dn=["value"],un=e("label",{for:"search",class:"block text-sm font-medium text-gray-700 mb-1"}," Buscar ",-1),mn={class:"mt-4 flex flex-wrap gap-4 text-sm text-gray-600"},gn={key:0,class:"flex justify-center items-center py-8"},fn=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),hn=e("span",{class:"ml-2 text-gray-600"},"Cargando solicitudes...",-1),vn=[fn,hn],pn={key:1,class:"space-y-4"},_n={key:0,class:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 mt-6"},bn={class:"flex flex-1 justify-between sm:hidden"},yn=["disabled"],xn=["disabled"],wn={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},$n={class:"text-sm text-gray-700"},zn={class:"font-medium"},En={class:"font-medium"},kn={class:"font-medium"},qn={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Cn=["disabled"],Rn=["onClick"],Mn=["disabled"],Pn={key:2,class:"text-center py-12"},Dn={class:"text-lg font-medium text-gray-900 mb-2"},Sn={class:"text-gray-600 mb-6"},In={key:0},Ln={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto"},jn={class:"flex"},On=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Por qué no hay solicitudes?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Asegúrate de tener organizaciones creadas"),e("p",null,"• Los miembros deben enviar solicitudes a través de tus organizaciones"),e("p",null,"• Las solicitudes aparecerán automáticamente aquí")])],-1),Nn={__name:"ReceivedRequestsSection",props:{requests:{type:Array,default:()=>[]},organizations:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["view-detail","status-updated","refresh"],setup(t,{emit:o}){const s=t,r=o,d=R(""),i=R(""),f=R(""),h=R(""),g=R(1),E=R(10),_=D(()=>{let S=[...s.requests];if(d.value&&(S=S.filter(N=>N.status===d.value)),i.value&&(S=S.filter(N=>N.priority===i.value)),f.value&&(S=S.filter(N=>{var z;return((z=N.organization_info)==null?void 0:z.id)===parseInt(f.value)})),h.value.trim()){const N=h.value.toLowerCase().trim();S=S.filter(z=>{var I,L;return z.title.toLowerCase().includes(N)||z.request_number.toLowerCase().includes(N)||((I=z.client_name)==null?void 0:I.toLowerCase().includes(N))||((L=z.description)==null?void 0:L.toLowerCase().includes(N))})}return S.sort((N,z)=>new Date(z.created_at)-new Date(N.created_at))}),v=D(()=>Math.ceil(_.value.length/E.value)),y=D(()=>(g.value-1)*E.value+1),m=D(()=>Math.min(g.value*E.value,_.value.length)),k=D(()=>{const S=(g.value-1)*E.value,N=S+E.value;return _.value.slice(S,N)}),x=D(()=>{const S=[];let z=Math.max(1,g.value-Math.floor(2.5)),I=Math.min(v.value,z+5-1);I-z+1<5&&(z=Math.max(1,I-5+1));for(let L=z;L<=I;L++)S.push(L);return S}),M=D(()=>_.value.filter(S=>S.status==="PENDING").length),C=D(()=>_.value.filter(S=>S.status==="IN_REVIEW").length),$=D(()=>_.value.filter(S=>S.priority==="URGENT").length),p=D(()=>s.requests.length===0?"No has recibido solicitudes":"No se encontraron solicitudes"),b=D(()=>s.requests.length===0?"Cuando tus clientes envíen solicitudes a través de tus organizaciones, aparecerán aquí para que las gestiones.":"No hay solicitudes que coincidan con los filtros seleccionados. Intenta ajustar los criterios de búsqueda."),P=S=>{r("view-detail",S)},A=S=>{r("status-updated",S)},U=()=>{r("refresh")},T=()=>{g.value=1},V=()=>{d.value="",i.value="",f.value="",h.value="",g.value=1};return te(_,()=>{g.value>v.value&&v.value>0&&(g.value=1)}),(S,N)=>(a(),n("div",null,[e("div",Qi,[e("div",Yi,[Ji,e("button",{onClick:U,disabled:t.isLoading,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},[u(c(Ze),{class:B([t.isLoading?"animate-spin":"","h-4 w-4 mr-2"])},null,8,["class"]),w(" Actualizar ")],8,Xi)])]),e("div",Ki,[e("div",en,[e("div",null,[tn,W(e("select",{id:"status-filter","onUpdate:modelValue":N[0]||(N[0]=z=>d.value=z),onChange:T,class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},on,544),[[ce,d.value]])]),e("div",null,[an,W(e("select",{id:"priority-filter","onUpdate:modelValue":N[1]||(N[1]=z=>i.value=z),onChange:T,class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},rn,544),[[ce,i.value]])]),e("div",null,[ln,W(e("select",{id:"organization-filter","onUpdate:modelValue":N[2]||(N[2]=z=>f.value=z),onChange:T,class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},[cn,(a(!0),n(Q,null,Y(t.organizations,z=>(a(),n("option",{key:z.id,value:z.id},l(z.title),9,dn))),128))],544),[[ce,f.value]])]),e("div",null,[un,W(e("input",{id:"search","onUpdate:modelValue":N[3]||(N[3]=z=>h.value=z),onInput:T,type:"text",placeholder:"Buscar por título, cliente...",class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},null,544),[[ae,h.value]])])]),e("div",mn,[e("span",null,[w("Total: "),e("strong",null,l(_.value.length),1)]),e("span",null,[w("Pendientes: "),e("strong",null,l(M.value),1)]),e("span",null,[w("En Revisión: "),e("strong",null,l(C.value),1)]),e("span",null,[w("Urgentes: "),e("strong",null,l($.value),1)])])]),t.isLoading?(a(),n("div",gn,vn)):_.value.length>0?(a(),n("div",pn,[(a(!0),n(Q,null,Y(k.value,z=>(a(),H(Zi,{key:z.id,request:z,onViewDetail:P,onStatusUpdated:A},null,8,["request"]))),128)),v.value>1?(a(),n("div",_n,[e("div",bn,[e("button",{onClick:N[4]||(N[4]=z=>g.value>1&&g.value--),disabled:g.value<=1,class:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50"}," Anterior ",8,yn),e("button",{onClick:N[5]||(N[5]=z=>g.value<v.value&&g.value++),disabled:g.value>=v.value,class:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50"}," Siguiente ",8,xn)]),e("div",wn,[e("div",null,[e("p",$n,[w(" Mostrando "),e("span",zn,l(y.value),1),w(" a "),e("span",En,l(m.value),1),w(" de "),e("span",kn,l(_.value.length),1),w(" resultados ")])]),e("div",null,[e("nav",qn,[e("button",{onClick:N[6]||(N[6]=z=>g.value>1&&g.value--),disabled:g.value<=1,class:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50"},[u(c(mt),{class:"h-5 w-5"})],8,Cn),(a(!0),n(Q,null,Y(x.value,z=>(a(),n("button",{key:z,onClick:I=>g.value=z,class:B([z===g.value?"relative z-10 inline-flex items-center bg-blue-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600":"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"])},l(z),11,Rn))),128)),e("button",{onClick:N[7]||(N[7]=z=>g.value<v.value&&g.value++),disabled:g.value>=v.value,class:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50"},[u(c(pt),{class:"h-5 w-5"})],8,Mn)])])])])):q("",!0)])):(a(),n("div",Pn,[u(c(Ae),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e("h3",Dn,l(p.value),1),e("p",Sn,l(b.value),1),t.requests.length>0?(a(),n("div",In,[e("button",{onClick:V,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(le),{class:"h-4 w-4 mr-2"}),w(" Limpiar Filtros ")])])):(a(),n("div",Ln,[e("div",jn,[u(c(de),{class:"h-5 w-5 text-blue-400 mt-0.5"}),On])]))]))]))}},Ye=Te("organizationPosts",{state:()=>({managementPosts:[],publicPosts:[],currentPost:null,isLoading:!1,isLoadingPosts:!1,isCreatingPost:!1,isUpdatingPost:!1,isDeletingPost:!1,pagination:{count:0,next:null,previous:null,currentPage:1,pageSize:10},filters:{is_active:null,is_pinned:null,search:"",page:1,page_size:10}}),getters:{sortedManagementPosts:t=>[...t.managementPosts].sort((o,s)=>o.is_pinned&&!s.is_pinned?-1:!o.is_pinned&&s.is_pinned?1:new Date(s.created_at)-new Date(o.created_at)),sortedPublicPosts:t=>[...t.publicPosts].sort((o,s)=>o.is_pinned&&!s.is_pinned?-1:!o.is_pinned&&s.is_pinned?1:new Date(s.created_at)-new Date(o.created_at)),activePostsCount:t=>t.managementPosts.filter(o=>o.is_active).length,pinnedPostsCount:t=>t.managementPosts.filter(o=>o.is_pinned).length},actions:{async createPost(t,o){try{this.isCreatingPost=!0;const s=await ne(`organizations/${t}/posts/create/`,o);if(s.status===201){const r=s.data.post;return this.managementPosts.unshift(r),this.currentPost=r,s.data}throw new Error("Error creating post")}catch(s){throw console.error("Error creating post:",s),s}finally{this.isCreatingPost=!1}},async getManagementPosts(t,o={}){try{this.isLoadingPosts=!0;const s=new URLSearchParams;Object.keys(o).forEach(i=>{o[i]!==null&&o[i]!==void 0&&o[i]!==""&&s.append(i,o[i])});const r=`organizations/${t}/posts/${s.toString()?"?"+s.toString():""}`,d=await ee(r);if(d.status===200)return this.managementPosts=d.data.results||d.data,d.data.count!==void 0&&(this.pagination={count:d.data.count,next:d.data.next,previous:d.data.previous,currentPage:o.page||1,pageSize:o.page_size||10}),d.data;throw new Error("Error fetching management posts")}catch(s){throw console.error("Error fetching management posts:",s),s}finally{this.isLoadingPosts=!1}},async getPublicPosts(t,o={}){try{this.isLoadingPosts=!0;const s=new URLSearchParams;Object.keys(o).forEach(i=>{o[i]!==null&&o[i]!==void 0&&o[i]!==""&&s.append(i,o[i])});const r=`organizations/${t}/posts/public/${s.toString()?"?"+s.toString():""}`,d=await ee(r);if(d.status===200)return this.publicPosts=d.data.results||d.data,d.data.count!==void 0&&(this.pagination={count:d.data.count,next:d.data.next,previous:d.data.previous,currentPage:o.page||1,pageSize:o.page_size||10}),d.data;throw new Error("Error fetching public posts")}catch(s){throw console.error("Error fetching public posts:",s),s}finally{this.isLoadingPosts=!1}},async getPostDetail(t,o){try{this.isLoading=!0;const s=await ee(`organizations/${t}/posts/${o}/`);if(s.status===200){this.currentPost=s.data.post||s.data;const r=this.managementPosts.findIndex(d=>d.id===o);return r>=0&&(this.managementPosts[r]=this.currentPost),s.data}throw new Error("Error fetching post detail")}catch(s){throw console.error("Error fetching post detail:",s),s}finally{this.isLoading=!1}},async updatePost(t,o,s){try{this.isUpdatingPost=!0;const r=await Ge(`organizations/${t}/posts/${o}/update/`,s);if(r.status===200){const d=r.data.post||r.data,i=this.managementPosts.findIndex(f=>f.id===o);return i>=0&&(this.managementPosts[i]=d),this.currentPost&&this.currentPost.id===o&&(this.currentPost=d),r.data}throw new Error("Error updating post")}catch(r){throw console.error("Error updating post:",r),r}finally{this.isUpdatingPost=!1}},async deletePost(t,o){try{this.isDeletingPost=!0;const s=await Ie(`organizations/${t}/posts/${o}/delete/`);if(s.status===200||s.status===204)return this.managementPosts=this.managementPosts.filter(r=>r.id!==o),this.currentPost&&this.currentPost.id===o&&(this.currentPost=null),s.data||{message:"Post eliminado exitosamente"};throw new Error("Error deleting post")}catch(s){throw console.error("Error deleting post:",s),s}finally{this.isDeletingPost=!1}},async togglePinPost(t,o){try{this.isLoading=!0;const s=await ne(`organizations/${t}/posts/${o}/toggle-pin/`,{});if(s.status===200){const r=s.data.post,d=this.managementPosts.findIndex(i=>i.id===o);return d>=0&&(this.managementPosts[d]=r),this.currentPost&&this.currentPost.id===o&&(this.currentPost=r),s.data}throw new Error("Error toggling post pin status")}catch(s){throw console.error("Error toggling post pin status:",s),s}finally{this.isLoading=!1}},async togglePostStatus(t,o){try{this.isLoading=!0;const s=await ne(`organizations/${t}/posts/${o}/toggle-status/`,{});if(s.status===200){const r=s.data.post,d=this.managementPosts.findIndex(i=>i.id===o);return d>=0&&(this.managementPosts[d]=r),this.currentPost&&this.currentPost.id===o&&(this.currentPost=r),s.data}throw new Error("Error toggling post status")}catch(s){throw console.error("Error toggling post status:",s),s}finally{this.isLoading=!1}},setFilters(t){this.filters={...this.filters,...t}},clearFilters(){this.filters={is_active:null,is_pinned:null,search:"",page:1,page_size:10}},clearPosts(){this.managementPosts=[],this.publicPosts=[],this.currentPost=null,this.pagination={count:0,next:null,previous:null,currentPage:1,pageSize:10}},clearAll(){this.clearPosts(),this.clearFilters(),this.isLoading=!1,this.isLoadingPosts=!1,this.isCreatingPost=!1,this.isUpdatingPost=!1,this.isDeletingPost=!1}}}),An={class:"bg-white shadow rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow"},Un={class:"flex items-start justify-between mb-4"},Vn={class:"flex-1 min-w-0"},Tn={class:"flex items-center space-x-2 mb-2"},Gn={class:"text-lg font-semibold text-gray-900 truncate"},Bn={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800"},Fn={class:"text-sm text-gray-500 mb-3"},Hn={class:"relative"},Wn={key:0,class:"absolute right-0 mt-1 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none z-10"},Zn={class:"py-1"},Qn=e("div",{class:"border-t border-gray-100"},null,-1),Yn={class:"mb-4"},Jn={class:"text-gray-700 whitespace-pre-wrap"},Xn={key:0,class:"mb-4"},Kn=["href"],er={class:"flex items-center justify-between text-xs text-gray-500 pt-4 border-t border-gray-100"},tr={class:"flex items-center space-x-4"},sr={class:"flex items-center"},or={key:0,class:"flex items-center text-yellow-600"},ar={class:"flex items-center space-x-2"},ir={__name:"CorporatePostCard",props:{post:{type:Object,required:!0},organizationId:{type:Number,required:!0}},emits:["edit","delete","toggle-pin","toggle-status"],setup(t,{emit:o}){const s=t,r=o,d=R(!1),i=()=>{d.value=!1,r("edit",s.post)},f=()=>{d.value=!1,r("delete",s.post)},h=()=>{d.value=!1,r("toggle-pin",s.post)},g=()=>{d.value=!1,r("toggle-status",s.post)},E=v=>new Date(v).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),_=v=>{const y=new Date(v),k=Math.abs(new Date-y),x=Math.ceil(k/(1e3*60*60*24));return x===0?"hoy":x===1?"ayer":x<7?`hace ${x} días`:x<30?`hace ${Math.ceil(x/7)} semanas`:`el ${E(v)}`};return(v,y)=>(a(),n("div",An,[e("div",Un,[e("div",Vn,[e("div",Tn,[e("h3",Gn,l(t.post.title),1),t.post.is_pinned?(a(),n("span",Bn,[u(c(Ce),{class:"h-3 w-3 mr-1"}),w(" Fijado ")])):q("",!0),e("span",{class:B([t.post.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800","inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"])},l(t.post.is_active?"Activo":"Inactivo"),3)]),e("p",Fn," Creado "+l(_(t.post.created_at)),1)]),e("div",Hn,[e("button",{onClick:y[0]||(y[0]=m=>d.value=!d.value),class:"inline-flex items-center p-2 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 rounded-full"},[u(c(_t),{class:"h-5 w-5"})]),d.value?(a(),n("div",Wn,[e("div",Zn,[e("button",{onClick:i,class:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},[u(c(rt),{class:"h-4 w-4 mr-3"}),w(" Editar ")]),e("button",{onClick:h,class:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},[u(c(Ce),{class:"h-4 w-4 mr-3"}),w(" "+l(t.post.is_pinned?"Desfijar":"Fijar"),1)]),e("button",{onClick:g,class:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},[(a(),H(ot(t.post.is_active?c($t):c(Ne)),{class:"h-4 w-4 mr-3"})),w(" "+l(t.post.is_active?"Desactivar":"Activar"),1)]),Qn,e("button",{onClick:f,class:"flex items-center w-full px-4 py-2 text-sm text-red-700 hover:bg-red-50"},[u(c(bt),{class:"h-4 w-4 mr-3"}),w(" Eliminar ")])])])):q("",!0)])]),e("div",Yn,[e("p",Jn,l(t.post.content),1)]),t.post.has_link&&t.post.link_url?(a(),n("div",Xn,[e("a",{href:t.post.link_url,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-3 py-2 border border-blue-300 text-sm font-medium rounded-md text-blue-700 bg-blue-50 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(at),{class:"h-4 w-4 mr-2"}),w(" "+l(t.post.link_name||"Ver enlace")+" ",1),u(c(He),{class:"h-3 w-3 ml-1"})],8,Kn)])):q("",!0),e("div",er,[e("div",tr,[e("span",sr,[u(c(re),{class:"h-3 w-3 mr-1"}),w(" "+l(E(t.post.created_at)),1)]),t.post.is_pinned?(a(),n("span",or,[u(c(Ce),{class:"h-3 w-3 mr-1"}),w(" Fijado ")])):q("",!0)]),e("div",ar,[e("span",{class:B(t.post.is_active?"text-green-600":"text-red-600")},l(t.post.is_active?"Visible para miembros":"Oculto para miembros"),3)])]),d.value?(a(),n("div",{key:1,onClick:y[1]||(y[1]=m=>d.value=!1),class:"fixed inset-0 z-0"})):q("",!0)]))}},nr=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),rr={class:"fixed inset-0 z-10 overflow-y-auto"},lr={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},cr={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},dr={class:"mt-1 text-sm text-gray-500"},ur={key:0,class:"flex justify-center items-center py-8"},mr=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),gr={class:"ml-2 text-gray-600"},fr=e("label",{for:"title",class:"block text-sm font-medium leading-6 text-gray-900"}," Título * ",-1),hr={class:"mt-2"},vr={key:0,class:"mt-1 text-sm text-red-600"},pr=e("label",{for:"content",class:"block text-sm font-medium leading-6 text-gray-900"}," Contenido * ",-1),_r={class:"mt-2"},br=e("p",{class:"mt-1 text-xs text-gray-500"}," Proporciona información clara y útil para los miembros de la organización ",-1),yr={key:0,class:"mt-1 text-sm text-red-600"},xr={class:"border-t border-gray-200 pt-6"},wr={class:"flex items-center justify-between mb-4"},$r=e("h4",{class:"text-md font-medium text-gray-900"},"Enlace Opcional",-1),zr={key:0,class:"space-y-4"},Er=e("label",{for:"link_name",class:"block text-sm font-medium leading-6 text-gray-900"}," Texto del Enlace ",-1),kr={class:"mt-2"},qr={key:0,class:"mt-1 text-sm text-red-600"},Cr=e("label",{for:"link_url",class:"block text-sm font-medium leading-6 text-gray-900"}," URL del Enlace ",-1),Rr={class:"mt-2"},Mr=e("p",{class:"mt-1 text-xs text-gray-500"}," Debe incluir http:// o https:// ",-1),Pr={key:0,class:"mt-1 text-sm text-red-600"},Dr=e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-3"},[e("p",{class:"text-sm text-yellow-800"},[e("strong",null,"Nota:"),w(" Si agregas un enlace, tanto el texto como la URL son obligatorios. ")])],-1),Sr={class:"border-t border-gray-200 pt-6"},Ir=e("h4",{class:"text-md font-medium text-gray-900 mb-4"},"Opciones",-1),Lr={class:"space-y-3"},jr={class:"flex items-center"},Or=e("label",{for:"is_pinned",class:"ml-2 text-sm text-gray-700"}," Fijar post (aparecerá en la parte superior) ",-1),Nr={key:0,class:"flex items-center"},Ar=e("label",{for:"is_active",class:"ml-2 text-sm text-gray-700"}," Post activo (visible para los miembros) ",-1),Ur={key:0,class:"border-t border-gray-200 pt-6"},Vr=e("h4",{class:"text-md font-medium text-gray-900 mb-4"},"Vista Previa",-1),Tr={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},Gr={class:"flex items-center space-x-2 mb-2"},Br={class:"text-lg font-semibold text-gray-900"},Fr={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800"},Hr={class:"text-gray-700 whitespace-pre-wrap mb-3"},Wr={key:0,class:"inline-flex items-center px-3 py-2 border border-blue-300 text-sm font-medium rounded-md text-blue-700 bg-blue-50"},Zr={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},Qr=["disabled"],Yr={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Jr={__name:"PostFormModal",props:{visible:{type:Boolean,default:!1},post:{type:Object,default:null},organizationId:{type:Number,required:!0}},emits:["close","saved"],setup(t,{emit:o}){const s=t,r=o,d=Ye(),i=R(!1),f=R({}),h=R(!1),g=R({title:"",content:"",link_name:"",link_url:"",is_pinned:!1,is_active:!0}),E=D(()=>!!s.post),_=D(()=>{const k=g.value.title.trim(),x=g.value.content.trim(),M=!g.value.link_name&&!g.value.link_url||g.value.link_name.trim()&&g.value.link_url.trim();return k&&x&&M}),v=()=>{s.post?(g.value={title:s.post.title||"",content:s.post.content||"",link_name:s.post.link_name||"",link_url:s.post.link_url||"",is_pinned:s.post.is_pinned||!1,is_active:s.post.is_active!==void 0?s.post.is_active:!0},h.value=!!(s.post.link_name||s.post.link_url)):(g.value={title:"",content:"",link_name:"",link_url:"",is_pinned:!1,is_active:!0},h.value=!1),f.value={}},y=async()=>{var k,x,M,C;try{i.value=!0,f.value={};const $=g.value.link_name.trim(),p=g.value.link_url.trim();if($&&!p||!$&&p){j("Si agregas un enlace, tanto el texto como la URL son obligatorios","warning");return}const b={title:g.value.title.trim(),content:g.value.content.trim(),is_pinned:g.value.is_pinned};$&&p&&(b.link_name=g.value.link_name.trim(),b.link_url=g.value.link_url.trim()),E.value&&(b.is_active=g.value.is_active);let P;E.value?(P=await d.updatePost(s.organizationId,s.post.id,b),j("Post actualizado exitosamente","success")):(P=await d.createPost(s.organizationId,b),j("Post creado exitosamente","success")),r("saved",P)}catch($){console.error("Error saving post:",$),(x=(k=$.response)==null?void 0:k.data)!=null&&x.details?f.value=$.response.data.details:(C=(M=$.response)==null?void 0:M.data)!=null&&C.error?j($.response.data.error,"error"):j(`Error al ${E.value?"actualizar":"crear"} el post`,"error")}finally{i.value=!1}},m=()=>{i.value||r("close")};return te(()=>s.visible,k=>{k&&Me(()=>{v()})}),te(()=>s.post,()=>{s.visible&&v()}),(k,x)=>(a(),H(c(pe),{as:"template",show:t.visible},{default:O(()=>[u(c(fe),{class:"relative z-50",onClose:m},{default:O(()=>[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[nr]),_:1}),e("div",rr,[e("div",lr,[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6"},{default:O(()=>[e("div",cr,[e("div",null,[u(c(ve),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:O(()=>[w(l(E.value?"Editar Post":"Crear Nuevo Post"),1)]),_:1}),e("p",dr,l(E.value?"Modifica la información del post":"Comparte información importante con los miembros"),1)]),e("button",{onClick:m,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(c(le),{class:"h-6 w-6"})])]),i.value?(a(),n("div",ur,[mr,e("span",gr,l(E.value?"Actualizando...":"Creando..."),1)])):(a(),n("form",{key:1,onSubmit:ye(y,["prevent"]),class:"space-y-6"},[e("div",null,[fr,e("div",hr,[W(e("input",{id:"title","onUpdate:modelValue":x[0]||(x[0]=M=>g.value.title=M),type:"text",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ej: Anuncio importante sobre nuevas políticas"},null,512),[[ae,g.value.title]])]),f.value.title?(a(),n("p",vr,l(f.value.title[0]),1)):q("",!0)]),e("div",null,[pr,e("div",_r,[W(e("textarea",{id:"content","onUpdate:modelValue":x[1]||(x[1]=M=>g.value.content=M),rows:"5",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Escribe el contenido del post..."},null,512),[[ae,g.value.content]])]),br,f.value.content?(a(),n("p",yr,l(f.value.content[0]),1)):q("",!0)]),e("div",xr,[e("div",wr,[$r,e("button",{type:"button",onClick:x[2]||(x[2]=M=>h.value=!h.value),class:"text-sm text-blue-600 hover:text-blue-800 font-medium"},l(h.value?"Ocultar enlace":"Agregar enlace"),1)]),h.value?(a(),n("div",zr,[e("div",null,[Er,e("div",kr,[W(e("input",{id:"link_name","onUpdate:modelValue":x[3]||(x[3]=M=>g.value.link_name=M),type:"text",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ej: Ver documento completo"},null,512),[[ae,g.value.link_name]])]),f.value.link_name?(a(),n("p",qr,l(f.value.link_name[0]),1)):q("",!0)]),e("div",null,[Cr,e("div",Rr,[W(e("input",{id:"link_url","onUpdate:modelValue":x[4]||(x[4]=M=>g.value.link_url=M),type:"url",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"https://ejemplo.com/documento"},null,512),[[ae,g.value.link_url]])]),Mr,f.value.link_url?(a(),n("p",Pr,l(f.value.link_url[0]),1)):q("",!0)]),Dr])):q("",!0)]),e("div",Sr,[Ir,e("div",Lr,[e("div",jr,[W(e("input",{id:"is_pinned","onUpdate:modelValue":x[5]||(x[5]=M=>g.value.is_pinned=M),type:"checkbox",class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[Ve,g.value.is_pinned]]),Or]),E.value?(a(),n("div",Nr,[W(e("input",{id:"is_active","onUpdate:modelValue":x[6]||(x[6]=M=>g.value.is_active=M),type:"checkbox",class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[Ve,g.value.is_active]]),Ar])):q("",!0)])]),g.value.title||g.value.content?(a(),n("div",Ur,[Vr,e("div",Tr,[e("div",Gr,[e("h5",Br,l(g.value.title||"Título del post"),1),g.value.is_pinned?(a(),n("span",Fr," Fijado ")):q("",!0)]),e("p",Hr,l(g.value.content||"Contenido del post..."),1),g.value.link_name&&g.value.link_url?(a(),n("div",Wr,[w(l(g.value.link_name)+" ",1),u(c(He),{class:"h-3 w-3 ml-1"})])):q("",!0)])])):q("",!0),e("div",Zr,[e("button",{type:"button",onClick:m,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value||!_.value,class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),n("div",Yr)):(a(),H(c(We),{key:1,class:"h-4 w-4 mr-2"})),w(" "+l(i.value?E.value?"Actualizando...":"Creando...":E.value?"Actualizar Post":"Crear Post"),1)],8,Qr)])],32))]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},Xr=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),Kr={class:"fixed inset-0 z-10 overflow-y-auto"},el={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},tl={class:"sm:flex sm:items-start"},sl={class:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left"},ol={class:"mt-2"},al={class:"text-sm text-gray-500"},il={class:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},nl=["disabled"],rl={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},ll=["disabled"],dt={__name:"ConfirmationModal",props:{visible:{type:Boolean,default:!1},title:{type:String,required:!0},message:{type:String,required:!0},confirmText:{type:String,default:"Confirmar"},cancelText:{type:String,default:"Cancelar"},confirmColor:{type:String,default:"yellow",validator:t=>["red","yellow"].includes(t)},isLoading:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(t,{emit:o}){const s=t,r=o,d=()=>{s.isLoading||r("confirm")},i=()=>{s.isLoading||r("cancel")};return(f,h)=>(a(),H(c(pe),{as:"template",show:t.visible},{default:O(()=>[u(c(fe),{class:"relative z-50",onClose:i},{default:O(()=>[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[Xr]),_:1}),e("div",Kr,[e("div",el,[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"},{default:O(()=>[e("div",tl,[e("div",{class:B(["mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full sm:mx-0 sm:h-10 sm:w-10",t.confirmColor==="red"?"bg-red-100":"bg-yellow-100"])},[u(c(yt),{class:B(["h-6 w-6",t.confirmColor==="red"?"text-red-600":"text-yellow-600"])},null,8,["class"])],2),e("div",sl,[u(c(ve),{as:"h3",class:"text-base font-semibold leading-6 text-gray-900"},{default:O(()=>[w(l(t.title),1)]),_:1}),e("div",ol,[e("p",al,l(t.message),1)])])]),e("div",il,[e("button",{type:"button",onClick:d,disabled:t.isLoading,class:B(["inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",t.confirmColor==="red"?"bg-red-600 hover:bg-red-500 focus-visible:outline-red-600":"bg-yellow-600 hover:bg-yellow-500 focus-visible:outline-yellow-600"])},[t.isLoading?(a(),n("div",rl)):q("",!0),w(" "+l(t.isLoading?"Procesando...":t.confirmText),1)],10,nl),e("button",{type:"button",onClick:i,disabled:t.isLoading,class:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed"},l(t.cancelText),9,ll)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},cl={class:"mb-6"},dl={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},ul=e("div",null,[e("h2",{class:"text-lg font-medium text-gray-900"},"Posts de la Organización"),e("p",{class:"mt-1 text-sm text-gray-600"}," Comparte anuncios e información importante con los miembros ")],-1),ml={class:"flex sm:justify-end"},gl={key:0,class:"flex justify-center items-center py-8"},fl=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),hl=e("span",{class:"ml-2 text-gray-600"},"Cargando posts...",-1),vl=[fl,hl],pl={key:1,class:"space-y-4"},_l={key:2,class:"text-center py-12"},bl={class:"text-lg font-medium text-gray-900 mb-2"},yl={class:"text-gray-600 mb-6"},xl={key:0},wl={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto mt-6"},$l={class:"flex"},zl=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Cómo usar los posts?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Comparte anuncios importantes con tu equipo"),e("p",null,"• Incluye enlaces a documentos o recursos"),e("p",null,"• Fija posts importantes para mantenerlos arriba"),e("p",null,"• Activa/desactiva posts según sea necesario")])],-1),El={__name:"OrganizationPostsSection",props:{organizationId:{type:Number,required:!0}},setup(t){const o=t,s=Ye(),r=R(!1),d=R(!1),i=R(null),f=D(()=>s.isLoadingPosts),h=D(()=>s.managementPosts),g=D(()=>s.sortedManagementPosts),E=D(()=>"No hay posts creados"),_=D(()=>"Crea tu primer post para compartir información importante con los miembros de tu organización."),v=async()=>{try{await s.getManagementPosts(o.organizationId)}catch(b){console.error("Error loading posts:",b),j("Error al cargar los posts","error")}},y=()=>{i.value=null,r.value=!0},m=()=>{r.value=!1,i.value=null},k=b=>{i.value=b,r.value=!0},x=b=>{i.value=b,d.value=!0},M=async()=>{try{await s.deletePost(o.organizationId,i.value.id),j(`Post "${i.value.title}" eliminado exitosamente`,"success"),d.value=!1,i.value=null}catch(b){console.error("Error deleting post:",b),j("Error al eliminar el post","error")}},C=async b=>{try{await s.togglePinPost(o.organizationId,b.id);const P=b.is_pinned?"desfijado":"fijado";j(`Post ${P} exitosamente`,"success")}catch(P){console.error("Error toggling pin:",P),j("Error al cambiar el estado de fijado","error")}},$=async b=>{try{await s.togglePostStatus(o.organizationId,b.id);const P=b.is_active?"desactivado":"activado";j(`Post ${P} exitosamente`,"success")}catch(P){console.error("Error toggling status:",P),j("Error al cambiar el estado del post","error")}},p=()=>{m(),v()};return $e(()=>{v()}),te(()=>o.organizationId,()=>{o.organizationId&&v()}),(b,P)=>{var A;return a(),n("div",null,[e("div",cl,[e("div",dl,[ul,e("div",ml,[e("button",{onClick:y,class:"inline-flex items-center justify-center w-full sm:w-auto px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(be),{class:"h-4 w-4 mr-2"}),w(" Nuevo Post ")])])])]),f.value?(a(),n("div",gl,vl)):g.value.length>0?(a(),n("div",pl,[(a(!0),n(Q,null,Y(g.value,U=>(a(),H(ir,{key:U.id,post:U,"organization-id":t.organizationId,onEdit:k,onDelete:x,onTogglePin:C,onToggleStatus:$},null,8,["post","organization-id"]))),128))])):(a(),n("div",_l,[u(c(We),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e("h3",bl,l(E.value),1),e("p",yl,l(_.value),1),h.value.length===0?(a(),n("div",xl,[e("button",{onClick:y,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(be),{class:"h-4 w-4 mr-2"}),w(" Crear Primer Post ")]),e("div",wl,[e("div",$l,[u(c(de),{class:"h-5 w-5 text-blue-400 mt-0.5"}),zl])])])):q("",!0)])),u(Jr,{visible:r.value,post:i.value,"organization-id":t.organizationId,onClose:m,onSaved:p},null,8,["visible","post","organization-id"]),u(dt,{visible:d.value,title:`¿Eliminar post '${(A=i.value)==null?void 0:A.title}'?`,message:"Esta acción no se puede deshacer. El post será eliminado permanentemente.","confirm-text":"Sí, eliminar","confirm-color":"red","is-loading":c(s).isDeletingPost,onConfirm:M,onCancel:P[0]||(P[0]=U=>d.value=!1)},null,8,["visible","title","is-loading"])])}}},kl={class:"px-4 py-6 sm:px-6 lg:px-8"},ql={key:0,class:"flex justify-center items-center py-12"},Cl=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),Rl=e("span",{class:"ml-2 text-gray-600"},"Cargando datos...",-1),Ml=[Cl,Rl],Pl={key:1,class:"text-center py-12"},Dl={class:"mx-auto max-w-md"},Sl=e("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"})],-1),Il=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Acceso Restringido",-1),Ll=e("p",{class:"mt-1 text-sm text-gray-500"}," Este dashboard es solo para clientes corporativos. ",-1),jl={class:"mt-2 text-xs text-gray-400"},Ol={key:2},Nl=e("div",{class:"mb-8"},[e("div",{class:"sm:flex sm:items-center sm:justify-between"},[e("div",null,[e("h1",{class:"text-2xl font-bold leading-6 text-gray-900"}," Panel Corporativo "),e("p",{class:"mt-2 text-sm text-gray-700"}," Gestiona tus organizaciones y solicitudes corporativas ")])])],-1),Al={class:"mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4"},Ul={class:"bg-white overflow-hidden shadow rounded-lg"},Vl={class:"p-5"},Tl={class:"flex items-center"},Gl={class:"flex-shrink-0"},Bl={class:"ml-5 w-0 flex-1"},Fl=e("dt",{class:"text-sm font-medium text-gray-500 truncate"}," Organizaciones ",-1),Hl={class:"text-lg font-medium text-gray-900"},Wl={class:"p-5"},Zl={class:"flex items-center"},Ql={class:"flex-shrink-0"},Yl={class:"ml-5 w-0 flex-1"},Jl=e("dt",{class:"text-sm font-medium text-gray-500 truncate group-hover:text-blue-600 transition-colors"}," Miembros Totales ",-1),Xl={class:"text-lg font-medium text-gray-900 group-hover:text-blue-600 transition-colors"},Kl={class:"bg-white overflow-hidden shadow rounded-lg"},ec={class:"p-5"},tc={class:"flex items-center"},sc={class:"flex-shrink-0"},oc={class:"ml-5 w-0 flex-1"},ac=e("dt",{class:"text-sm font-medium text-gray-500 truncate"}," Invitaciones Pendientes ",-1),ic={class:"text-lg font-medium text-gray-900"},nc={class:"bg-white overflow-hidden shadow rounded-lg"},rc={class:"p-5"},lc={class:"flex items-center"},cc={class:"flex-shrink-0"},dc={class:"ml-5 w-0 flex-1"},uc=e("dt",{class:"text-sm font-medium text-gray-500 truncate"}," Total Solicitudes ",-1),mc={class:"text-lg font-medium text-gray-900"},gc={class:"space-y-6"},fc={class:"relative h-48 bg-gradient-to-r from-blue-500 to-purple-600"},hc=["src","alt"],vc=e("div",{class:"absolute inset-0 bg-black bg-opacity-30"},null,-1),pc={class:"absolute bottom-4 left-6"},_c={class:"relative"},bc=["src","alt"],yc={class:"absolute top-4 right-4"},xc=["onClick"],wc={class:"px-6 py-4"},$c={class:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4"},zc={class:"flex-1"},Ec={class:"text-xl font-semibold text-gray-900 mb-2"},kc={class:"text-gray-600 mb-4"},qc={class:"flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-gray-500 mb-4"},Cc=["onClick","title"],Rc={class:"group-hover:underline"},Mc={class:"flex items-center"},Pc={class:"flex items-center"},Dc={class:"flex sm:ml-4 mt-4 sm:mt-0"},Sc=["onClick"],Ic={key:0,class:"text-center py-12"},Lc=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," No tienes organizaciones creadas ",-1),jc=e("p",{class:"text-gray-600 mb-6"}," Crea tu primera organización para empezar a recibir solicitudes de clientes. ",-1),Oc={class:"mt-8"},Nc={__name:"CorporateClientDashboard",setup(t){const o=ue(),s=Ue(),r=Oe(),d=Fe(),i=R(!1),f=R(!1),h=R(!1),g=R(!1),E=R(!1),_=R(null),v=R(null),y=D(()=>o.isLoading||s.isLoadingRequests),m=D(()=>o.organizations),k=D(()=>o.organizationStats),x=D(()=>s.receivedRequests),M=D(()=>{var G;return((G=r.currentUser)==null?void 0:G.role)==="corporate_client"}),C=async()=>{var G,ie,ge;try{const Z=(G=r.currentUser)==null?void 0:G.role;if(!Z){console.error("User role not available");return}if(Z!=="corporate_client"){console.error("User is not a corporate client, cannot load corporate dashboard data");return}await Promise.all([o.getMyOrganizations(),o.getOrganizationStats(),s.getReceivedRequests({page_size:50})])}catch(Z){console.error("Error loading dashboard data:",Z),((ie=Z.response)==null?void 0:ie.status)===403?console.error("Access denied. User may not have corporate client permissions."):((ge=Z.response)==null?void 0:ge.status)===401&&console.error("Authentication error. User may need to log in again.")}},$=G=>{_.value=G,f.value=!0},p=()=>{f.value=!1,_.value=null},b=G=>{_.value=G,h.value=!0},P=()=>{h.value=!1,_.value=null},A=G=>{v.value=G,g.value=!0},U=()=>{E.value=!0},T=()=>{E.value=!1},V=()=>{g.value=!1,v.value=null},S=()=>{i.value=!0},N=()=>{i.value=!1},z=G=>{N(),Promise.all([o.getMyOrganizations(),o.getOrganizationStats()])},I=G=>{p(),o.getMyOrganizations()},L=G=>{P(),o.getOrganizationStats()},F=G=>{d.push({name:"organizations_dashboard",query:{tab:"request-detail",id:G}})},J=()=>{s.getReceivedRequests({page_size:50})},me=async G=>{try{await s.updateReceivedRequest(G.requestId,{status:G.newStatus}),J()}catch(ie){console.error("Error updating request status:",ie)}},_e=G=>new Date(G).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"});return $e(async()=>{var ie;r.currentUser||await r.init(),((ie=r.currentUser)==null?void 0:ie.role)==="corporate_client"&&C()}),(G,ie)=>{var ge;return a(),n("div",kl,[y.value?(a(),n("div",ql,Ml)):M.value?(a(),n("div",Ol,[Nl,e("div",Al,[e("div",Ul,[e("div",Vl,[e("div",Tl,[e("div",Gl,[u(c(Re),{class:"h-6 w-6 text-gray-400"})]),e("div",Bl,[e("dl",null,[Fl,e("dd",Hl,l(k.value.total_organizations),1)])])])])]),e("button",{onClick:U,class:"bg-white overflow-hidden shadow rounded-lg hover:shadow-lg transition-shadow cursor-pointer text-left w-full group",title:"Ver todos los miembros de tus organizaciones"},[e("div",Wl,[e("div",Zl,[e("div",Ql,[u(c(xe),{class:"h-6 w-6 text-gray-400 group-hover:text-blue-600 transition-colors"})]),e("div",Yl,[e("dl",null,[Jl,e("dd",Xl,l(k.value.total_members),1)])])])])]),e("div",Kl,[e("div",ec,[e("div",tc,[e("div",sc,[u(c(Le),{class:"h-6 w-6 text-gray-400"})]),e("div",oc,[e("dl",null,[ac,e("dd",ic,l(k.value.total_pending_invitations),1)])])])])]),e("div",nc,[e("div",rc,[e("div",lc,[e("div",cc,[u(c(Ae),{class:"h-6 w-6 text-gray-400"})]),e("div",dc,[e("dl",null,[uc,e("dd",mc,l(x.value.length),1)])])])])])])])):(a(),n("div",Pl,[e("div",Dl,[Sl,Il,Ll,e("p",jl," Tu rol actual: "+l(((ge=c(r).currentUser)==null?void 0:ge.role)||"Sin definir"),1)])])),e("div",gc,[(a(!0),n(Q,null,Y(m.value,Z=>(a(),n("div",{key:Z.id,class:"bg-white shadow rounded-lg overflow-hidden"},[e("div",fc,[Z.cover_image_url?(a(),n("img",{key:0,src:Z.cover_image_url,alt:`Portada de ${Z.title}`,class:"w-full h-full object-cover"},null,8,hc)):q("",!0),vc,e("div",pc,[e("div",_c,[e("img",{src:Z.profile_image_url||c(X),alt:`Logo de ${Z.title}`,class:"h-20 w-20 rounded-full border-4 border-white object-cover bg-white"},null,8,bc)])]),e("div",yc,[e("button",{onClick:qe=>$(Z),class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-black bg-opacity-50 hover:bg-opacity-70 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(c(rt),{class:"h-4 w-4 mr-1"}),w(" Editar ")],8,xc)])]),e("div",wc,[e("div",$c,[e("div",zc,[e("h3",Ec,l(Z.title),1),e("p",kc,l(Z.description),1),e("div",qc,[e("button",{onClick:qe=>A(Z),class:"flex items-center hover:text-blue-600 transition-colors cursor-pointer group",title:`Ver lista de miembros de ${Z.title}`},[u(c(xe),{class:"h-4 w-4 mr-1 group-hover:text-blue-600"}),e("span",Rc,l(Z.member_count)+" miembros ",1)],8,Cc),e("div",Mc,[u(c(Le),{class:"h-4 w-4 mr-1"}),w(" "+l(Z.pending_invitations_count)+" invitaciones pendientes ",1)]),e("div",Pc,[u(c(re),{class:"h-4 w-4 mr-1"}),w(" Creada "+l(_e(Z.created_at)),1)])])]),e("div",Dc,[e("button",{onClick:qe=>b(Z),class:"inline-flex items-center justify-center w-full sm:w-auto px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(c(ct),{class:"h-4 w-4 mr-2"}),w(" Invitar Miembro ")],8,Sc)])])])]))),128)),m.value.length===0?(a(),n("div",Ic,[u(c(Re),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),Lc,jc,e("button",{onClick:S,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(be),{class:"h-4 w-4 mr-2"}),w(" Crear Organización ")])])):q("",!0)]),(a(!0),n(Q,null,Y(m.value,Z=>(a(),n("div",{key:`posts-${Z.id}`,class:"mt-8"},[u(El,{"organization-id":Z.id},null,8,["organization-id"])]))),128)),e("div",Oc,[u(Nn,{requests:x.value,organizations:m.value,"is-loading":c(s).isLoadingRequests,onViewDetail:F,onStatusUpdated:me,onRefresh:J},null,8,["requests","organizations","is-loading"])]),u(ks,{visible:i.value,onClose:N,onCreated:z},null,8,["visible"]),u(ho,{visible:f.value,organization:_.value,onClose:p,onUpdated:I},null,8,["visible","organization"]),u(Ko,{visible:h.value,organization:_.value,onClose:P,onInvited:L},null,8,["visible","organization"]),u(Da,{visible:g.value,organization:v.value,onClose:V},null,8,["visible","organization"]),u(gi,{visible:E.value,organizations:m.value,onClose:T},null,8,["visible","organizations"])])}}},ut=t=>(Pe("data-v-8fb6d1d9"),t=t(),De(),t),Ac={class:"bg-white shadow rounded-lg border border-gray-200 overflow-hidden hover:shadow-md transition-shadow"},Uc={class:"relative h-32 bg-gradient-to-r from-blue-500 to-purple-600"},Vc=["src","alt"],Tc=ut(()=>e("div",{class:"absolute inset-0 bg-black bg-opacity-30"},null,-1)),Gc={class:"absolute bottom-3 left-4"},Bc=["src","alt"],Fc={class:"absolute top-3 right-3"},Hc={class:"p-6"},Wc={class:"mb-4"},Zc={class:"text-lg font-semibold text-gray-900 mb-1"},Qc={class:"text-sm text-gray-600 mb-3 line-clamp-2"},Yc={class:"flex items-center space-x-4 text-xs text-gray-500"},Jc={class:"flex items-center"},Xc={class:"flex items-center"},Kc={class:"mb-4 p-3 bg-gray-50 rounded-lg"},ed={class:"flex items-start space-x-3"},td=["src","alt"],sd={class:"flex-1 min-w-0"},od={class:"text-sm font-medium text-gray-900"},ad={class:"text-xs text-gray-500 mb-2"},id={class:"text-sm text-gray-700 italic"},nd={key:0,class:"mb-4"},rd={key:0},ld={key:1},cd={key:1,class:"flex space-x-3"},dd=["disabled"],ud={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},md=["disabled"],gd={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600 mr-2"},fd={key:2,class:"text-center py-2"},hd={class:"text-sm text-gray-600"},vd={key:3,class:"text-center py-2"},pd=ut(()=>e("p",{class:"text-sm text-gray-500"}," Esta invitación ha expirado ",-1)),_d=[pd],bd={__name:"InvitationCard",props:{invitation:{type:Object,required:!0}},emits:["responded"],setup(t,{emit:o}){const s=t,r=o,d=ue(),i=R(!1),f=R(null),h=D(()=>s.invitation.can_be_responded&&!s.invitation.is_expired&&s.invitation.status==="PENDING"),g=D(()=>{if(!s.invitation.expires_at)return!1;const $=(new Date(s.invitation.expires_at)-new Date)/(1e3*60*60*24);return $<=7&&$>0}),E=D(()=>s.invitation.organization_info.profile_image_url||X),_=async x=>{var M,C;try{i.value=!0,f.value=x;const $=await d.respondToInvitation(s.invitation.id,x);j(`Invitación ${x==="accept"?"aceptada":"rechazada"} exitosamente`,"success"),r("responded",$.invitation)}catch($){console.error("Error responding to invitation:",$),(C=(M=$.response)==null?void 0:M.data)!=null&&C.error?j($.response.data.error,"error"):j("Error al responder la invitación","error")}finally{i.value=!1,f.value=null}},v=x=>({PENDING:"Pendiente",ACCEPTED:"Aceptada",REJECTED:"Rechazada",EXPIRED:"Expirada",CANCELLED:"Cancelada"})[x]||x,y=x=>({PENDING:"bg-yellow-100 text-yellow-800",ACCEPTED:"bg-green-100 text-green-800",REJECTED:"bg-red-100 text-red-800",EXPIRED:"bg-gray-100 text-gray-800",CANCELLED:"bg-gray-100 text-gray-800"})[x]||"bg-gray-100 text-gray-800",m=x=>new Date(x).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),k=x=>{const M=new Date(x),$=Math.abs(new Date-M),p=Math.ceil($/(1e3*60*60*24));return p===0?"hoy":p===1?"hace 1 día":p<7?`hace ${p} días`:p<30?`hace ${Math.ceil(p/7)} semanas`:m(x)};return(x,M)=>(a(),n("div",Ac,[e("div",Uc,[t.invitation.organization_info.cover_image_url?(a(),n("img",{key:0,src:t.invitation.organization_info.cover_image_url,alt:`Portada de ${t.invitation.organization_info.title}`,class:"w-full h-full object-cover"},null,8,Vc)):q("",!0),Tc,e("div",Gc,[e("img",{src:t.invitation.organization_info.profile_image_url||"/src/assets/images/user_avatar.jpg",alt:`Logo de ${t.invitation.organization_info.title}`,class:"h-12 w-12 rounded-full border-2 border-white object-cover bg-white"},null,8,Bc)]),e("div",Fc,[e("span",{class:B([y(t.invitation.status),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(v(t.invitation.status)),3)])]),e("div",Hc,[e("div",Wc,[e("h3",Zc,l(t.invitation.organization_info.title),1),e("p",Qc,l(t.invitation.organization_info.description),1),e("div",Yc,[e("div",Jc,[u(c(xe),{class:"h-3 w-3 mr-1"}),w(" "+l(t.invitation.organization_info.member_count)+" miembros ",1)]),e("div",Xc,[u(c(re),{class:"h-3 w-3 mr-1"}),w(" "+l(m(t.invitation.created_at)),1)])])]),e("div",Kc,[e("div",ed,[e("img",{src:E.value,alt:`Avatar de ${t.invitation.invited_by_info.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,td),e("div",sd,[e("p",od,l(t.invitation.invited_by_info.full_name),1),e("p",ad,l(t.invitation.invited_by_info.email),1),e("p",id,' "'+l(t.invitation.message||"Te invita a unirte a esta organización.")+'" ',1)])])]),t.invitation.expires_at?(a(),n("div",nd,[e("div",{class:B(["flex items-center text-xs",g.value?"text-orange-600":"text-gray-500"])},[u(c(Be),{class:"h-3 w-3 mr-1"}),t.invitation.is_expired?(a(),n("span",rd," Expiró "+l(k(t.invitation.expires_at)),1)):(a(),n("span",ld," Expira "+l(k(t.invitation.expires_at)),1))],2)])):q("",!0),h.value?(a(),n("div",cd,[e("button",{onClick:M[0]||(M[0]=C=>_("accept")),disabled:i.value,class:"flex-1 inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[i.value&&f.value==="accept"?(a(),n("div",ud)):(a(),H(c(nt),{key:1,class:"h-4 w-4 mr-2"})),w(" "+l(i.value&&f.value==="accept"?"Aceptando...":"Aceptar"),1)],8,dd),e("button",{onClick:M[1]||(M[1]=C=>_("reject")),disabled:i.value,class:"flex-1 inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[i.value&&f.value==="reject"?(a(),n("div",gd)):(a(),H(c(le),{key:1,class:"h-4 w-4 mr-2"})),w(" "+l(i.value&&f.value==="reject"?"Rechazando...":"Rechazar"),1)],8,md)])):t.invitation.responded_at?(a(),n("div",fd,[e("p",hd," Respondiste "+l(k(t.invitation.responded_at)),1)])):(a(),n("div",vd,_d))])]))}},yd=Se(bd,[["__scopeId","data-v-8fb6d1d9"]]),xd=e("div",{class:"mb-6"},[e("h2",{class:"text-lg font-medium text-gray-900"},"Invitaciones Recibidas"),e("p",{class:"mt-1 text-sm text-gray-600"}," Revisa y responde a las invitaciones de organizaciones ")],-1),wd={key:0,class:"flex justify-center items-center py-8"},$d=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),zd=e("span",{class:"ml-2 text-gray-600"},"Cargando invitaciones...",-1),Ed=[$d,zd],kd={key:1,class:"space-y-4"},qd={key:2,class:"text-center py-12"},Cd=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," No tienes invitaciones ",-1),Rd=e("p",{class:"text-gray-600 mb-6"}," Cuando recibas invitaciones de organizaciones, aparecerán aquí para que puedas responderlas. ",-1),Md={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto"},Pd={class:"flex"},Dd=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Cómo recibir invitaciones?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Los clientes corporativos pueden invitarte a sus organizaciones"),e("p",null,"• Solo necesitan tu email registrado en la plataforma"),e("p",null,"• Las invitaciones aparecerán automáticamente aquí")])],-1),Sd={__name:"InvitationsSection",props:{invitations:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["invitation-responded"],setup(t,{emit:o}){const s=o,r=d=>{s("invitation-responded",d)};return(d,i)=>(a(),n("div",null,[xd,t.isLoading?(a(),n("div",wd,Ed)):t.invitations.length>0?(a(),n("div",kd,[(a(!0),n(Q,null,Y(t.invitations,f=>(a(),H(yd,{key:f.id,invitation:f,onResponded:r},null,8,["invitation"]))),128))])):(a(),n("div",qd,[u(c(Le),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),Cd,Rd,e("div",Md,[e("div",Pd,[u(c(de),{class:"h-5 w-5 text-blue-400 mt-0.5"}),Dd])])]))]))}},ke=t=>(Pe("data-v-84669378"),t=t(),De(),t),Id={class:"bg-white shadow rounded-lg border border-gray-200 overflow-hidden hover:shadow-md transition-shadow"},Ld={class:"relative h-32 bg-gradient-to-r from-blue-500 to-purple-600"},jd=["src","alt"],Od=ke(()=>e("div",{class:"absolute inset-0 bg-black bg-opacity-30"},null,-1)),Nd={class:"absolute bottom-3 left-4"},Ad=["src","alt"],Ud={class:"absolute top-3 right-3"},Vd={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},Td={class:"p-4"},Gd={class:"mb-4"},Bd={class:"text-lg font-semibold text-gray-900 mb-1"},Fd={class:"text-sm text-gray-600 mb-3 line-clamp-2"},Hd={class:"flex items-center space-x-4 text-xs text-gray-500 mb-3"},Wd={class:"flex items-center"},Zd={class:"flex items-center"},Qd={class:"mb-4 p-3 bg-gray-50 rounded-lg"},Yd=ke(()=>e("p",{class:"text-xs text-gray-500 mb-1"},"Líder de la organización",-1)),Jd={class:"flex items-center space-x-2"},Xd=["src","alt"],Kd={class:"text-sm font-medium text-gray-900"},eu={class:"text-xs text-gray-500"},tu={class:"space-y-2"},su={class:"flex gap-2"},ou=ke(()=>e("span",{class:"hidden sm:inline"},"Ver Detalles",-1)),au=ke(()=>e("span",{class:"sm:hidden"},"Detalles",-1)),iu=ke(()=>e("span",{class:"hidden sm:inline"},"Salir",-1)),nu=ke(()=>e("span",{class:"sm:hidden"},"Salir",-1)),ru={__name:"OrganizationCard",props:{organization:{type:Object,required:!0}},emits:["left","create-request","view-details"],setup(t,{emit:o}){const s=t,r=o,d=ue(),i=R(!1),f=R(!1),h=()=>{r("create-request",s.organization.id)},g=()=>{r("view-details",s.organization.id)},E=async()=>{var v,y;try{f.value=!0,await d.leaveOrganization(s.organization.id),j(`Has abandonado ${s.organization.title}`,"success"),i.value=!1,r("left",s.organization.id)}catch(m){console.error("Error leaving organization:",m),(y=(v=m.response)==null?void 0:v.data)!=null&&y.error?j(m.response.data.error,"error"):j("Error al abandonar la organización","error")}finally{f.value=!1}},_=v=>new Date(v).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"});return(v,y)=>(a(),n("div",Id,[e("div",Ld,[t.organization.cover_image_url?(a(),n("img",{key:0,src:t.organization.cover_image_url,alt:`Portada de ${t.organization.title}`,class:"w-full h-full object-cover"},null,8,jd)):q("",!0),Od,e("div",Nd,[e("img",{src:t.organization.profile_image_url||c(X),alt:`Logo de ${t.organization.title}`,class:"h-12 w-12 rounded-full border-2 border-white object-cover bg-white"},null,8,Ad)]),e("div",Ud,[e("span",Vd,[u(c(nt),{class:"h-3 w-3 mr-1"}),w(" Miembro ")])])]),e("div",Td,[e("div",Gd,[e("h3",Bd,l(t.organization.title),1),e("p",Fd,l(t.organization.description),1),e("div",Hd,[e("div",Wd,[u(c(xe),{class:"h-3 w-3 mr-1"}),w(" "+l(t.organization.member_count)+" miembros ",1)]),e("div",Zd,[u(c(re),{class:"h-3 w-3 mr-1"}),w(" Miembro desde "+l(_(t.organization.joined_at)),1)])])]),e("div",Qd,[Yd,e("div",Jd,[e("img",{src:t.organization.corporate_client_info.profile_image_url||c(X),alt:`Avatar de ${t.organization.corporate_client_info.full_name}`,class:"h-6 w-6 rounded-full object-cover border border-gray-200"},null,8,Xd),e("div",null,[e("p",Kd,l(t.organization.corporate_client_info.full_name),1),e("p",eu,l(t.organization.corporate_client_info.email),1)])])]),e("div",tu,[e("button",{onClick:h,class:"w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(c(be),{class:"h-4 w-4 mr-2"}),w(" Nueva Solicitud ")]),e("div",su,[e("button",{onClick:g,class:"flex-1 inline-flex justify-center items-center px-2 py-2 border border-gray-300 text-xs sm:text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(c(Ne),{class:"h-4 w-4 sm:mr-1"}),ou,au]),e("button",{onClick:y[0]||(y[0]=m=>i.value=!0),class:"flex-1 inline-flex justify-center items-center px-2 py-2 border border-red-300 text-xs sm:text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors"},[u(c(wt),{class:"h-4 w-4 sm:mr-1"}),iu,nu])])])]),u(dt,{visible:i.value,title:`¿Salir de ${t.organization.title}?`,message:"¿Estás seguro de que quieres abandonar esta organización? Ya no podrás enviar solicitudes a través de ella.","confirm-text":"Sí, salir","confirm-color":"red","is-loading":f.value,onConfirm:E,onCancel:y[1]||(y[1]=m=>i.value=!1)},null,8,["visible","title","is-loading"])]))}},lu=Se(ru,[["__scopeId","data-v-84669378"]]),cu=e("div",{class:"mb-6"},[e("h2",{class:"text-lg font-medium text-gray-900"},"Mis Organizaciones"),e("p",{class:"mt-1 text-sm text-gray-600"}," Organizaciones donde eres miembro activo ")],-1),du={key:0,class:"flex justify-center items-center py-8"},uu=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),mu=e("span",{class:"ml-2 text-gray-600"},"Cargando organizaciones...",-1),gu=[uu,mu],fu={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},hu={key:2,class:"text-center py-12"},vu=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," No perteneces a ninguna organización ",-1),pu=e("p",{class:"text-gray-600 mb-6"}," Para unirte a organizaciones, necesitas recibir y aceptar invitaciones de clientes corporativos. ",-1),_u={class:"max-w-2xl mx-auto space-y-4"},bu={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},yu={class:"flex"},xu=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Cómo unirme a una organización?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"1. Espera a recibir una invitación de un cliente corporativo"),e("p",null,'2. Revisa la invitación en la pestaña "Invitaciones"'),e("p",null,"3. Acepta la invitación para convertirte en miembro"),e("p",null,"4. Una vez miembro, podrás enviar solicitudes a esa organización")])],-1),wu={class:"bg-green-50 border border-green-200 rounded-lg p-4"},$u={class:"flex"},zu=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-green-800"},"Beneficios de ser miembro"),e("div",{class:"mt-1 text-sm text-green-700 space-y-1"},[e("p",null,"• Enviar solicitudes corporativas especializadas"),e("p",null,"• Acceso a servicios específicos de la organización"),e("p",null,"• Comunicación directa con el equipo corporativo"),e("p",null,"• Seguimiento detallado de tus solicitudes")])],-1),Eu={__name:"OrganizationsSection",props:{organizations:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["organization-left","create-request","view-details"],setup(t,{emit:o}){const s=o,r=f=>{s("organization-left",f)},d=f=>{s("create-request",f)},i=f=>{s("view-details",f)};return(f,h)=>(a(),n("div",null,[cu,t.isLoading?(a(),n("div",du,gu)):t.organizations.length>0?(a(),n("div",fu,[(a(!0),n(Q,null,Y(t.organizations,g=>(a(),H(lu,{key:g.id,organization:g,onLeft:r,onCreateRequest:d,onViewDetails:i},null,8,["organization"]))),128))])):(a(),n("div",hu,[u(c(Re),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),vu,pu,e("div",_u,[e("div",bu,[e("div",yu,[u(c(de),{class:"h-5 w-5 text-blue-400 mt-0.5"}),xu])]),e("div",wu,[e("div",$u,[u(c(ze),{class:"h-5 w-5 text-green-400 mt-0.5"}),zu])])])]))]))}},ku=t=>(Pe("data-v-a9bfd787"),t=t(),De(),t),qu={class:"flex items-start justify-between mb-4"},Cu={class:"flex items-center space-x-2 mb-1"},Ru={class:"text-sm font-medium text-gray-900"},Mu={class:"text-lg font-semibold text-gray-900 mb-2"},Pu={class:"text-sm text-gray-600 mb-4 line-clamp-2"},Du={class:"flex items-center space-x-3 mb-4 p-3 bg-gray-50 rounded-lg"},Su=["src","alt"],Iu={class:"text-sm font-medium text-gray-900"},Lu={class:"text-xs text-gray-500"},ju={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-gray-500 mb-4"},Ou={class:"flex items-center"},Nu={class:"flex items-center"},Au={class:"flex items-center"},Uu={class:"flex items-center"},Vu={key:0,class:"text-xs text-gray-500 mb-2"},Tu=ku(()=>e("span",{class:"font-medium"},"Última actualización:",-1)),Gu={class:"w-full bg-gray-200 rounded-full h-1"},Bu={__name:"RequestCard",props:{request:{type:Object,required:!0}},emits:["view-detail"],setup(t,{emit:o}){const s=t,r=o,d=D(()=>{var m;return((m=s.request.organization_info)==null?void 0:m.profile_image_url)||X}),i=()=>{r("view-detail",s.request.id)},f=m=>({PENDING:"Pendiente",IN_REVIEW:"En Revisión",RESPONDED:"Respondida",RESOLVED:"Resuelta",CLOSED:"Cerrada"})[m]||m,h=m=>({PENDING:"bg-yellow-100 text-yellow-800",IN_REVIEW:"bg-blue-100 text-blue-800",RESPONDED:"bg-purple-100 text-purple-800",RESOLVED:"bg-green-100 text-green-800",CLOSED:"bg-gray-100 text-gray-800"})[m]||"bg-gray-100 text-gray-800",g=m=>({LOW:"Baja",MEDIUM:"Media",HIGH:"Alta",URGENT:"Urgente"})[m]||m,E=m=>({LOW:"bg-gray-100 text-gray-600",MEDIUM:"bg-blue-100 text-blue-600",HIGH:"bg-orange-100 text-orange-600",URGENT:"bg-red-100 text-red-600"})[m]||"bg-gray-100 text-gray-600",_=m=>({PENDING:20,IN_REVIEW:40,RESPONDED:60,RESOLVED:80,CLOSED:100})[m]||0,v=m=>({PENDING:"bg-yellow-500",IN_REVIEW:"bg-blue-500",RESPONDED:"bg-purple-500",RESOLVED:"bg-green-500",CLOSED:"bg-gray-500"})[m]||"bg-gray-500",y=m=>{const k=new Date(m),M=Math.abs(new Date-k),C=Math.ceil(M/(1e3*60*60*24));return C===0?"Hoy":C===1?"Ayer":C<7?`Hace ${C} días`:C<30?`Hace ${Math.ceil(C/7)} semanas`:k.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})};return(m,k)=>{var x,M;return a(),n("div",{class:"bg-white shadow rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow cursor-pointer",onClick:i},[e("div",qu,[e("div",null,[e("div",Cu,[e("span",Ru,l(t.request.request_number),1),e("span",{class:B([h(t.request.status),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(f(t.request.status)),3),e("span",{class:B([E(t.request.priority),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(g(t.request.priority)),3)]),e("h3",Mu,l(t.request.title),1)]),e("button",{onClick:ye(i,["stop"]),class:"inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(Ne),{class:"h-3 w-3 mr-1"}),w(" Ver Detalle ")])]),e("p",Pu,l(t.request.description),1),e("div",Du,[e("img",{src:d.value,alt:`Logo de ${(x=t.request.organization_info)==null?void 0:x.title}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,Su),e("div",null,[e("p",Iu,l(((M=t.request.organization_info)==null?void 0:M.title)||"Organización"),1),e("p",Lu," Líder: "+l(t.request.corporate_client_name),1)])]),e("div",ju,[e("div",Ou,[u(c(it),{class:"h-3 w-3 mr-1"}),w(" "+l(t.request.request_type_name),1)]),e("div",Nu,[u(c(re),{class:"h-3 w-3 mr-1"}),w(" "+l(y(t.request.created_at)),1)]),e("div",Au,[u(c(Qe),{class:"h-3 w-3 mr-1"}),w(" "+l(t.request.response_count)+" respuestas ",1)]),e("div",Uu,[u(c(Be),{class:"h-3 w-3 mr-1"}),w(" "+l(t.request.days_since_created)+" días ",1)])]),t.request.status_updated_at&&t.request.status_updated_at!==t.request.created_at?(a(),n("div",Vu,[Tu,w(" "+l(y(t.request.status_updated_at)),1)])):q("",!0),e("div",Gu,[e("div",{class:B([v(t.request.status),"h-1 rounded-full transition-all duration-300"]),style:st({width:_(t.request.status)+"%"})},null,6)])])}}},Fu=Se(Bu,[["__scopeId","data-v-a9bfd787"]]),Hu={class:"mb-6"},Wu={class:"flex items-center justify-between"},Zu=e("div",null,[e("h2",{class:"text-lg font-medium text-gray-900"},"Mis Solicitudes Corporativas"),e("p",{class:"mt-1 text-sm text-gray-600"}," Seguimiento de todas tus solicitudes enviadas ")],-1),Qu={class:"mb-6 bg-gray-50 rounded-lg p-4"},Yu={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ju=e("label",{for:"status-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Estado ",-1),Xu=we('<option value="">Todos los estados</option><option value="PENDING">Pendiente</option><option value="IN_REVIEW">En Revisión</option><option value="RESPONDED">Respondida</option><option value="RESOLVED">Resuelta</option><option value="CLOSED">Cerrada</option>',6),Ku=[Xu],e0=e("label",{for:"priority-filter",class:"block text-sm font-medium text-gray-700 mb-1"}," Prioridad ",-1),t0=we('<option value="">Todas las prioridades</option><option value="LOW">Baja</option><option value="MEDIUM">Media</option><option value="HIGH">Alta</option><option value="URGENT">Urgente</option>',5),s0=[t0],o0=e("label",{for:"search",class:"block text-sm font-medium text-gray-700 mb-1"}," Buscar ",-1),a0={key:0,class:"flex justify-center items-center py-8"},i0=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),n0=e("span",{class:"ml-2 text-gray-600"},"Cargando solicitudes...",-1),r0=[i0,n0],l0={key:1,class:"space-y-4"},c0={key:2,class:"text-center py-12"},d0={class:"text-lg font-medium text-gray-900 mb-2"},u0={class:"text-gray-600 mb-6"},m0={key:0,class:"space-y-4"},g0={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto"},f0={class:"flex"},h0=e("div",{class:"ml-3 text-left"},[e("h5",{class:"text-sm font-medium text-blue-800"},"¿Cómo crear una solicitud?"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"1. Asegúrate de ser miembro de al menos una organización"),e("p",null,'2. Haz clic en "Nueva Solicitud"'),e("p",null,"3. Selecciona la organización y tipo de solicitud"),e("p",null,"4. Proporciona todos los detalles necesarios")])],-1),v0={key:1},p0={__name:"MyRequestsSection",props:{requests:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["request-detail","create-request"],setup(t,{emit:o}){const s=t,r=o,d=R(""),i=R(""),f=R(""),h=D(()=>{let y=[...s.requests];if(d.value&&(y=y.filter(m=>m.status===d.value)),i.value&&(y=y.filter(m=>m.priority===i.value)),f.value.trim()){const m=f.value.toLowerCase().trim();y=y.filter(k=>{var x;return k.title.toLowerCase().includes(m)||k.request_number.toLowerCase().includes(m)||((x=k.description)==null?void 0:x.toLowerCase().includes(m))})}return y.sort((m,k)=>new Date(k.created_at)-new Date(m.created_at))}),g=D(()=>s.requests.length===0?"No has enviado solicitudes":"No se encontraron solicitudes"),E=D(()=>s.requests.length===0?"Cuando envíes solicitudes corporativas a tus organizaciones, aparecerán aquí para que puedas dar seguimiento.":"No hay solicitudes que coincidan con los filtros seleccionados. Intenta ajustar los criterios de búsqueda."),_=y=>{r("request-detail",y)},v=()=>{d.value="",i.value="",f.value=""};return te([d,i,f],()=>{}),(y,m)=>(a(),n("div",null,[e("div",Hu,[e("div",Wu,[Zu,e("button",{onClick:m[0]||(m[0]=k=>r("create-request")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(be),{class:"h-4 w-4 mr-2"}),w(" Nueva Solicitud ")])])]),e("div",Qu,[e("div",Yu,[e("div",null,[Ju,W(e("select",{id:"status-filter","onUpdate:modelValue":m[1]||(m[1]=k=>d.value=k),class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},Ku,512),[[ce,d.value]])]),e("div",null,[e0,W(e("select",{id:"priority-filter","onUpdate:modelValue":m[2]||(m[2]=k=>i.value=k),class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},s0,512),[[ce,i.value]])]),e("div",null,[o0,W(e("input",{id:"search","onUpdate:modelValue":m[3]||(m[3]=k=>f.value=k),type:"text",placeholder:"Buscar por título o número...",class:"block w-full rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[ae,f.value]])])])]),t.isLoading?(a(),n("div",a0,r0)):h.value.length>0?(a(),n("div",l0,[(a(!0),n(Q,null,Y(h.value,k=>(a(),H(Fu,{key:k.id,request:k,onViewDetail:_},null,8,["request"]))),128))])):(a(),n("div",c0,[u(c(Ae),{class:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e("h3",d0,l(g.value),1),e("p",u0,l(E.value),1),t.requests.length===0?(a(),n("div",m0,[e("button",{onClick:m[4]||(m[4]=k=>r("create-request")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(be),{class:"h-4 w-4 mr-2"}),w(" Crear Primera Solicitud ")]),e("div",g0,[e("div",f0,[u(c(de),{class:"h-5 w-5 text-blue-400 mt-0.5"}),h0])])])):(a(),n("div",v0,[e("button",{onClick:v,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(le),{class:"h-4 w-4 mr-2"}),w(" Limpiar Filtros ")])]))]))]))}},_0=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),b0={class:"fixed inset-0 z-10 overflow-y-auto"},y0={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},x0={class:"flex items-center justify-between border-b border-gray-200 pb-4 mb-6"},w0=e("p",{class:"mt-1 text-sm text-gray-500"}," Envía una solicitud a través de una de tus organizaciones ",-1),$0={key:0,class:"flex justify-center items-center py-8"},z0=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),E0=e("span",{class:"ml-2 text-gray-600"},"Enviando solicitud...",-1),k0=[z0,E0],q0={key:1,class:"text-center py-6"},C0=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," ¡Solicitud Enviada! ",-1),R0={class:"text-sm text-gray-600 mb-2"},M0={class:"text-sm text-gray-500 mb-6"},P0=e("label",{for:"organization",class:"block text-sm font-medium leading-6 text-gray-900"}," Organización * ",-1),D0={class:"mt-2"},S0=e("option",{value:""},"Selecciona una organización",-1),I0=["value"],L0={key:0,class:"mt-1 text-sm text-red-600"},j0={key:0,class:"bg-gray-50 rounded-lg p-4"},O0={class:"flex items-center space-x-3"},N0=["src","alt"],A0={class:"text-sm font-medium text-gray-900"},U0={class:"text-xs text-gray-500"},V0=e("label",{for:"request_type",class:"block text-sm font-medium leading-6 text-gray-900"}," Tipo de Solicitud * ",-1),T0={class:"mt-2"},G0=e("option",{value:""},"Selecciona un tipo",-1),B0=["value"],F0={key:0,class:"mt-1 text-sm text-red-600"},H0=e("label",{for:"title",class:"block text-sm font-medium leading-6 text-gray-900"}," Título de la Solicitud * ",-1),W0={class:"mt-2"},Z0={key:0,class:"mt-1 text-sm text-red-600"},Q0=e("label",{for:"description",class:"block text-sm font-medium leading-6 text-gray-900"}," Descripción Detallada * ",-1),Y0={class:"mt-2"},J0=e("p",{class:"mt-1 text-xs text-gray-500"}," Proporciona todos los detalles relevantes para que puedan ayudarte mejor ",-1),X0={key:0,class:"mt-1 text-sm text-red-600"},K0=e("label",{for:"priority",class:"block text-sm font-medium leading-6 text-gray-900"}," Prioridad ",-1),em={class:"mt-2"},tm=e("option",{value:"LOW"},"Baja",-1),sm=e("option",{value:"MEDIUM"},"Media",-1),om=e("option",{value:"HIGH"},"Alta",-1),am=e("option",{value:"URGENT"},"Urgente",-1),im=[tm,sm,om,am],nm={key:0,class:"mt-1 text-sm text-red-600"},rm={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},lm={class:"flex"},cm=e("div",{class:"ml-3"},[e("h5",{class:"text-sm font-medium text-blue-800"},"Información importante"),e("div",{class:"mt-1 text-sm text-blue-700 space-y-1"},[e("p",null,"• Tu solicitud será enviada al equipo de la organización seleccionada"),e("p",null,"• Recibirás un número de seguimiento para tu solicitud"),e("p",null,"• Podrás ver el progreso y responder a comentarios"),e("p",null,"• El equipo corporativo te contactará para más detalles si es necesario")])],-1),dm={class:"flex justify-end space-x-3 border-t border-gray-200 pt-6"},um=["disabled"],mm={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},gm={__name:"CreateRequestModal",props:{visible:{type:Boolean,default:!1},organizations:{type:Array,default:()=>[]}},emits:["close","created"],setup(t,{emit:o}){const s=t,r=o,d=Ue(),i=R(!1),f=R(!1),h=R({}),g=R(null),E=R([]),_=R({organization:"",request_type:"",title:"",description:"",priority:"MEDIUM"}),v=D(()=>s.organizations.find($=>$.id===_.value.organization)),y=D(()=>_.value.organization&&_.value.request_type&&_.value.title.trim()&&_.value.description.trim()),m=()=>{_.value={organization:"",request_type:"",title:"",description:"",priority:"MEDIUM"},h.value={},f.value=!1,g.value=null},k=async()=>{var $,p;try{const b=await d.getRequestTypes();Array.isArray(b)?E.value=b:(console.error("Request types is not an array:",b),j("Formato de tipos de solicitud inválido","error"))}catch(b){console.error("Error loading request types:",b),(($=b.response)==null?void 0:$.status)===403?j("No tienes permisos para cargar tipos de solicitudes","error"):((p=b.response)==null?void 0:p.status)===401?j("Sesión expirada. Por favor, vuelve a iniciar sesión","error"):j("Error al cargar tipos de solicitudes","error")}},x=async()=>{var $,p,b,P;try{i.value=!0,h.value={};const A={organization:_.value.organization,request_type:_.value.request_type,title:_.value.title.trim(),description:_.value.description.trim(),priority:_.value.priority},U=await d.createCorporateRequest(A);g.value=U.corporate_request,f.value=!0,j("Solicitud enviada exitosamente","success"),r("created",U.corporate_request)}catch(A){console.error("Error creating request:",A),(p=($=A.response)==null?void 0:$.data)!=null&&p.details?h.value=A.response.data.details:(P=(b=A.response)==null?void 0:b.data)!=null&&P.error?j(A.response.data.error,"error"):j("Error al enviar la solicitud","error")}finally{i.value=!1}},M=()=>{m()},C=()=>{i.value||r("close")};return te(()=>s.visible,$=>{$&&Me(()=>{m(),E.value.length===0&&k()})}),$e(()=>{k()}),($,p)=>(a(),H(c(pe),{as:"template",show:t.visible},{default:O(()=>[u(c(fe),{class:"relative z-50",onClose:C},{default:O(()=>[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[_0]),_:1}),e("div",b0,[e("div",y0,[u(c(oe),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[u(c(he),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6"},{default:O(()=>{var b,P,A,U;return[e("div",x0,[e("div",null,[u(c(ve),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900"},{default:O(()=>[w(" Nueva Solicitud Corporativa ")]),_:1}),w0]),e("button",{onClick:C,class:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},[u(c(le),{class:"h-6 w-6"})])]),i.value?(a(),n("div",$0,k0)):f.value?(a(),n("div",q0,[u(c(ze),{class:"h-16 w-16 text-green-500 mx-auto mb-4"}),C0,e("p",R0,[w(" Tu solicitud "),e("strong",null,l((b=g.value)==null?void 0:b.request_number),1),w(" ha sido enviada exitosamente. ")]),e("p",M0,[w(" El equipo de "),e("strong",null,l((A=(P=g.value)==null?void 0:P.organization_info)==null?void 0:A.title),1),w(" la revisará pronto. ")]),e("div",{class:"space-y-3"},[e("button",{onClick:M,class:"w-full inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Crear Otra Solicitud "),e("button",{onClick:C,class:"w-full inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cerrar ")])])):(a(),n("form",{key:2,onSubmit:ye(x,["prevent"]),class:"space-y-6"},[e("div",null,[P0,e("div",D0,[W(e("select",{id:"organization","onUpdate:modelValue":p[0]||(p[0]=T=>_.value.organization=T),required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"},[S0,(a(!0),n(Q,null,Y(t.organizations,T=>(a(),n("option",{key:T.id,value:T.id},l(T.title),9,I0))),128))],512),[[ce,_.value.organization]])]),h.value.organization?(a(),n("p",L0,l(h.value.organization[0]),1)):q("",!0)]),v.value?(a(),n("div",j0,[e("div",O0,[e("img",{src:v.value.profile_image_url||c(X),alt:`Logo de ${v.value.title}`,class:"h-10 w-10 rounded-full object-cover border border-gray-200"},null,8,N0),e("div",null,[e("h4",A0,l(v.value.title),1),e("p",U0," Líder: "+l((U=v.value.corporate_client_info)==null?void 0:U.full_name),1)])])])):q("",!0),e("div",null,[V0,e("div",T0,[W(e("select",{id:"request_type","onUpdate:modelValue":p[1]||(p[1]=T=>_.value.request_type=T),required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"},[G0,(a(!0),n(Q,null,Y(E.value,T=>(a(),n("option",{key:T.id,value:T.id},l(T.name),9,B0))),128))],512),[[ce,_.value.request_type]])]),h.value.request_type?(a(),n("p",F0,l(h.value.request_type[0]),1)):q("",!0)]),e("div",null,[H0,e("div",W0,[W(e("input",{id:"title","onUpdate:modelValue":p[2]||(p[2]=T=>_.value.title=T),type:"text",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Ej: Revisión de contrato de servicios"},null,512),[[ae,_.value.title]])]),h.value.title?(a(),n("p",Z0,l(h.value.title[0]),1)):q("",!0)]),e("div",null,[Q0,e("div",Y0,[W(e("textarea",{id:"description","onUpdate:modelValue":p[3]||(p[3]=T=>_.value.description=T),rows:"4",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6",placeholder:"Describe detalladamente lo que necesitas..."},null,512),[[ae,_.value.description]])]),J0,h.value.description?(a(),n("p",X0,l(h.value.description[0]),1)):q("",!0)]),e("div",null,[K0,e("div",em,[W(e("select",{id:"priority","onUpdate:modelValue":p[4]||(p[4]=T=>_.value.priority=T),class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"},im,512),[[ce,_.value.priority]])]),h.value.priority?(a(),n("p",nm,l(h.value.priority[0]),1)):q("",!0)]),e("div",rm,[e("div",lm,[u(c(de),{class:"h-5 w-5 text-blue-400 mt-0.5"}),cm])]),e("div",dm,[e("button",{type:"button",onClick:C,class:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancelar "),e("button",{type:"submit",disabled:i.value||!y.value,class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),n("div",mm)):(a(),H(c(lt),{key:1,class:"h-4 w-4 mr-2"})),w(" "+l(i.value?"Enviando...":"Enviar Solicitud"),1)],8,um)])],32))]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}},fm={class:"bg-white shadow rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow"},hm={class:"mb-4"},vm={class:"flex items-center space-x-2 mb-2"},pm={class:"text-lg font-semibold text-gray-900"},_m={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800"},bm={class:"flex items-center text-sm text-gray-500 space-x-4"},ym={class:"flex items-center"},xm={class:"flex items-center"},wm={class:"mb-4"},$m={class:"text-gray-700 whitespace-pre-wrap leading-relaxed"},zm={key:0,class:"mb-4"},Em=["href"],km={class:"flex items-center justify-between text-xs text-gray-500 pt-4 border-t border-gray-100"},qm={class:"flex items-center space-x-4"},Cm={class:"flex items-center"},Rm={key:0,class:"flex items-center text-yellow-600"},Mm={key:0,class:"flex items-center text-green-600"},Pm=e("span",{class:"h-2 w-2 bg-green-400 rounded-full mr-1 animate-pulse"},null,-1),tt={__name:"ClientPostCard",props:{post:{type:Object,required:!0}},setup(t){const o=t,s=D(()=>{const i=new Date(o.post.created_at),h=Math.abs(new Date-i);return Math.ceil(h/(1e3*60*60*24))<=3}),r=i=>new Date(i).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),d=i=>{const f=new Date(i),g=Math.abs(new Date-f),E=Math.ceil(g/(1e3*60*60*24)),_=Math.ceil(g/(1e3*60*60)),v=Math.ceil(g/(1e3*60));if(v<60)return v<=1?"hace un momento":`hace ${v} minutos`;if(_<24)return _===1?"hace 1 hora":`hace ${_} horas`;if(E===0)return"hoy";if(E===1)return"ayer";if(E<7)return`hace ${E} días`;if(E<30){const m=Math.ceil(E/7);return`hace ${m} ${m===1?"semana":"semanas"}`}const y=Math.ceil(E/30);return y<12?`hace ${y} ${y===1?"mes":"meses"}`:r(i)};return(i,f)=>(a(),n("div",fm,[e("div",hm,[e("div",vm,[e("h3",pm,l(t.post.title),1),t.post.is_pinned?(a(),n("span",_m,[u(c(Ce),{class:"h-3 w-3 mr-1"}),w(" Fijado ")])):q("",!0)]),e("div",bm,[e("div",ym,[u(c(Et),{class:"h-4 w-4 mr-1"}),e("span",null,l(t.post.author_name),1)]),e("div",xm,[u(c(re),{class:"h-4 w-4 mr-1"}),e("span",null,l(d(t.post.created_at)),1)])])]),e("div",wm,[e("p",$m,l(t.post.content),1)]),t.post.has_link&&t.post.link_url?(a(),n("div",zm,[e("a",{href:t.post.link_url,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-4 py-2 border border-blue-300 text-sm font-medium rounded-md text-blue-700 bg-blue-50 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[u(c(at),{class:"h-4 w-4 mr-2"}),w(" "+l(t.post.link_name||"Ver enlace")+" ",1),u(c(He),{class:"h-3 w-3 ml-2"})],8,Em)])):q("",!0),e("div",km,[e("div",qm,[e("span",Cm,[u(c(re),{class:"h-3 w-3 mr-1"}),w(" "+l(r(t.post.created_at)),1)]),t.post.is_pinned?(a(),n("span",Rm,[u(c(Ce),{class:"h-3 w-3 mr-1"}),w(" Anuncio Destacado ")])):q("",!0)]),s.value?(a(),n("div",Mm,[Pm,w(" Reciente ")])):q("",!0)])]))}},Dm={class:"mb-6"},Sm={class:"flex items-center justify-between"},Im=e("div",null,[e("h2",{class:"text-lg font-medium text-gray-900"},"Anuncios de la Organización"),e("p",{class:"mt-1 text-sm text-gray-600"}," Información importante de la organización ")],-1),Lm=["disabled"],jm={key:0,class:"flex justify-center items-center py-8"},Om=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),Nm=e("span",{class:"ml-2 text-gray-600"},"Cargando anuncios...",-1),Am=[Om,Nm],Um={key:1,class:"space-y-4"},Vm={key:2,class:"text-center py-12"},Tm={class:"text-lg font-medium text-gray-900 mb-2"},Gm={class:"text-gray-600 mb-6"},Bm={class:"flex"},Fm={class:"ml-3 text-left"},Hm=e("p",null,"• Acepta una invitación pendiente de una organización",-1),Wm=e("p",null,"• Solicita unirte a una organización existente",-1),Zm=e("p",null,"• Contacta al líder de la organización para recibir una invitación",-1),Qm=e("p",null,"• Los líderes de la organización pueden publicar anuncios importantes",-1),Ym=e("p",null,"• Revisa esta sección regularmente para mantenerte informado",-1),Jm=e("p",null,"• Los anuncios fijados aparecen en la parte superior",-1),Xm={__name:"OrganizationPostsSection",props:{organizationId:{type:Number,required:!0}},setup(t){const o=t,s=Ye(),r=R(null),d=R(!1),i=D(()=>s.isLoadingPosts);D(()=>s.publicPosts);const f=D(()=>s.sortedPublicPosts),h=D(()=>f.value.filter(m=>m.is_pinned)),g=D(()=>f.value.filter(m=>!m.is_pinned)),E=D(()=>d.value?"No tienes acceso a estos anuncios":"No hay anuncios disponibles"),_=D(()=>d.value?"Para ver los anuncios de una organización, primero debes ser miembro activo de ella. Acepta una invitación o solicita unirte a una organización.":"La organización aún no ha publicado ningún anuncio. Los anuncios importantes aparecerán aquí."),v=async()=>{var m;try{r.value=null,d.value=!1,await s.getPublicPosts(o.organizationId)}catch(k){console.error("Error loading posts:",k),r.value=k,((m=k.response)==null?void 0:m.status)===403?d.value=!0:j("Error al cargar los anuncios","error")}},y=()=>{v()};return $e(()=>{v()}),te(()=>o.organizationId,()=>{o.organizationId&&v()}),(m,k)=>(a(),n("div",null,[e("div",Dm,[e("div",Sm,[Im,e("button",{onClick:y,disabled:i.value,class:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},[u(c(Ze),{class:B([i.value?"animate-spin":"","h-4 w-4 mr-2"])},null,8,["class"]),w(" Actualizar ")],8,Lm)])]),i.value?(a(),n("div",jm,Am)):f.value.length>0?(a(),n("div",Um,[(a(!0),n(Q,null,Y(h.value,x=>(a(),H(tt,{key:`pinned-${x.id}`,post:x},null,8,["post"]))),128)),(a(!0),n(Q,null,Y(g.value,x=>(a(),H(tt,{key:`regular-${x.id}`,post:x},null,8,["post"]))),128))])):(a(),n("div",Vm,[d.value?(a(),H(c(vt),{key:0,class:"h-16 w-16 mx-auto mb-4 text-amber-400"})):(a(),H(c(zt),{key:1,class:"h-16 w-16 mx-auto mb-4 text-gray-300"})),e("h3",Tm,l(E.value),1),e("p",Gm,l(_.value),1),e("div",{class:B([d.value?"bg-amber-50 border-amber-200":"bg-blue-50 border-blue-200","border rounded-lg p-4 max-w-md mx-auto"])},[e("div",Bm,[u(c(de),{class:B([d.value?"text-amber-400":"text-blue-400","h-5 w-5 mt-0.5"])},null,8,["class"]),e("div",Fm,[e("h5",{class:B([d.value?"text-amber-800":"text-blue-800","text-sm font-medium"])},l(d.value?"¿Cómo acceder?":"Sobre los anuncios"),3),e("div",{class:B([d.value?"text-amber-700":"text-blue-700","mt-1 text-sm space-y-1"])},[d.value?(a(),n(Q,{key:0},[Hm,Wm,Zm],64)):(a(),n(Q,{key:1},[Qm,Ym,Jm],64))],2)])])],2)]))]))}},Km={class:"px-4 py-6 sm:px-6 lg:px-8"},eg={key:0,class:"flex justify-center items-center py-12"},tg=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),sg=e("span",{class:"ml-2 text-gray-600"},"Cargando datos...",-1),og=[tg,sg],ag={key:1,class:"text-center py-12"},ig={class:"mx-auto max-w-md"},ng=e("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"})],-1),rg=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Acceso Restringido",-1),lg=e("p",{class:"mt-1 text-sm text-gray-500"}," Esta vista es solo para clientes normales. ",-1),cg={class:"mt-2 text-xs text-gray-400"},dg={key:2},ug={class:"mb-8"},mg={class:"sm:flex sm:items-center sm:justify-between"},gg=e("div",null,[e("h1",{class:"text-2xl font-bold leading-6 text-gray-900"}," Mis Organizaciones "),e("p",{class:"mt-2 text-sm text-gray-700"}," Gestiona tus membresías, invitaciones y solicitudes corporativas ")],-1),fg={class:"mt-4 sm:mt-0 flex space-x-3"},hg=["disabled","title"],vg={key:0,class:"mb-8",ref:"postsSection"},pg=e("div",{class:"mb-6"},[e("h2",{class:"text-lg font-medium text-gray-900"},"Anuncios de Organizaciones"),e("p",{class:"mt-1 text-sm text-gray-600"}," Información importante de las organizaciones donde eres miembro ")],-1),_g={class:"space-y-8"},bg={class:"bg-white shadow rounded-lg overflow-hidden"},yg={class:"px-6 py-4 border-b border-gray-200"},xg={class:"flex items-center space-x-4"},wg=["src","alt"],$g={class:"text-lg font-semibold text-gray-900"},zg={class:"text-sm text-gray-600"},Eg={class:"px-6 py-4"},kg={class:"border-b border-gray-200 mb-6"},qg={class:"sm:hidden"},Cg=e("label",{for:"current-tab",class:"sr-only"},"Selecciona sección",-1),Rg={class:"relative inline-block w-full"},Mg={key:0,class:"absolute z-20 mt-1 w-full rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5"},Pg={class:"max-h-60 overflow-auto py-1 text-sm text-gray-700"},Dg=["onClick","disabled"],Sg={class:"hidden sm:block"},Ig={class:"-mb-px flex space-x-8","aria-label":"Tabs"},Lg=["onClick","disabled","title"],jg={class:"space-y-6"},Og={key:0},Ng={key:1},Ag={key:2},Ug={__name:"ClientDashboard",setup(t){const o=ue(),s=Ue(),r=Oe(),d=Fe(),i=R("organizations"),f=R(!1),h=R({}),g=R(!1),E=D(()=>o.isLoading||s.isLoadingRequests),_=D(()=>{var V,S;return((V=r.currentUser)==null?void 0:V.role)==="client"||((S=r.currentUser)==null?void 0:S.role)==="basic"}),v=D(()=>o.myInvitations),y=D(()=>o.myMemberships),m=D(()=>s.myRequests),k=D(()=>[{id:"organizations",name:"Mis Organizaciones",icon:Re,count:y.value.length,disabled:!1},{id:"requests",name:"Mis Solicitudes",icon:Ae,count:m.value.length,disabled:y.value.length===0},{id:"invitations",name:"Invitaciones",icon:Le,count:v.value.filter(V=>V.status==="PENDING").length,disabled:!1}]),x=D(()=>{const V=k.value.find(S=>S.id===i.value);return V?V.name:"Selecciona sección"}),M=async()=>{var V,S,N;try{const z=(V=r.currentUser)==null?void 0:V.role;if(!z){console.error("User role not available");return}if(z!=="client"&&z!=="basic"){console.error("User is not a client or basic user, cannot load dashboard data");return}console.log("Loading dashboard data for role:",z),(await Promise.allSettled([o.getMyInvitations(),o.getMyMemberships(),s.getMyRequests({page_size:50})])).forEach((L,F)=>{var J,me;L.status==="rejected"&&(console.error(`Error loading ${["invitations","memberships","requests"][F]}:`,L.reason),F===2&&((me=(J=L.reason)==null?void 0:J.response)==null?void 0:me.status)===403&&console.log("User may not have organization memberships yet, skipping request load"))}),console.log("Dashboard data loaded successfully")}catch(z){console.error("Error loading dashboard data:",z),((S=z.response)==null?void 0:S.status)===403?console.error("Access denied. User may not have proper permissions."):((N=z.response)==null?void 0:N.status)===401&&console.error("Authentication error. User may need to log in again.")}},C=()=>{f.value=!0},$=()=>{f.value=!1},p=V=>{Promise.all([o.getMyInvitations(),o.getMyMemberships()])},b=V=>{o.getMyMemberships()},P=V=>{$(),s.getMyRequests(),i.value="requests"},A=V=>{d.push({name:"organizations_dashboard",query:{tab:"request-detail",id:V}})},U=(V,S)=>{V&&(h.value[S]=V)},T=V=>{const S=h.value[V];if(S){const z=S.getBoundingClientRect().top+window.pageYOffset-150;window.scrollTo({top:z,behavior:"smooth"}),S.classList.add("ring-2","ring-blue-500","ring-offset-2"),setTimeout(()=>{S.classList.remove("ring-2","ring-blue-500","ring-offset-2")},2e3)}};return te(y,V=>{V.length===0&&i.value==="requests"&&(i.value="organizations")}),te(i,()=>{g.value=!1}),$e(async()=>{var S;console.log("ClientDashboard mounted"),r.currentUser||(console.log("Waiting for user data to be available..."),await r.init());const V=(S=r.currentUser)==null?void 0:S.role;console.log("Current user role:",V),V==="client"||V==="basic"?M():console.error("User does not have client or basic role. Current role:",V)}),(V,S)=>{var N;return a(),n("div",Km,[E.value?(a(),n("div",eg,og)):_.value?(a(),n("div",dg,[e("div",ug,[e("div",mg,[gg,e("div",fg,[e("button",{onClick:C,disabled:y.value.length===0,class:B([y.value.length===0?"bg-gray-300 cursor-not-allowed text-gray-500":"bg-blue-600 hover:bg-blue-700 text-white","inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"]),title:y.value.length===0?"Debes ser miembro de una organización para crear solicitudes":""},[u(c(be),{class:"h-4 w-4 mr-2"}),w(" Nueva Solicitud ")],10,hg)])])]),y.value.length>0?(a(),n("div",vg,[pg,e("div",_g,[(a(!0),n(Q,null,Y(y.value,z=>(a(),n("div",{key:`posts-${z.id}`,ref_for:!0,ref:I=>U(I,z.id)},[e("div",bg,[e("div",yg,[e("div",xg,[e("img",{src:z.profile_image_url||c(X),alt:`Logo de ${z.title}`,class:"h-12 w-12 rounded-full object-cover bg-gray-100"},null,8,wg),e("div",null,[e("h3",$g,l(z.title),1),e("p",zg,l(z.description),1)])])]),e("div",Eg,[u(Xm,{"organization-id":z.id},null,8,["organization-id"])])])]))),128))])],512)):q("",!0),e("div",kg,[e("div",qg,[Cg,e("div",Rg,[e("button",{id:"current-tab",type:"button",onClick:S[0]||(S[0]=z=>g.value=!g.value),class:"inline-flex w-full justify-between items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-left text-sm font-medium text-gray-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"},[e("span",null,l(x.value),1),u(c(xt),{class:"h-4 w-4 text-gray-400"})]),g.value?(a(),n("div",Mg,[e("ul",Pg,[(a(!0),n(Q,null,Y(k.value,z=>(a(),n("li",{key:z.id},[e("button",{type:"button",onClick:I=>!z.disabled&&(i.value=z.id),disabled:z.disabled,class:B(["flex w-full items-center justify-between px-3 py-2 text-left",z.disabled?"text-gray-300 cursor-not-allowed":i.value===z.id?"bg-blue-50 text-blue-700":"hover:bg-gray-50"])},[e("span",null,l(z.name),1),z.count!==void 0?(a(),n("span",{key:0,class:B(["ml-2 inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",z.disabled?"bg-gray-100 text-gray-400":i.value===z.id?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-900"])},l(z.count),3)):q("",!0)],10,Dg)]))),128))])])):q("",!0)])]),e("div",Sg,[e("nav",Ig,[(a(!0),n(Q,null,Y(k.value,z=>(a(),n("button",{key:z.id,onClick:I=>!z.disabled&&(i.value=z.id),disabled:z.disabled,class:B([z.disabled?"border-transparent text-gray-300 cursor-not-allowed":i.value===z.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-colors"]),title:z.disabled?"Debes ser miembro de al menos una organización para acceder a esta sección":""},[(a(),H(ot(z.icon),{class:"h-5 w-5 mr-2 inline"})),w(" "+l(z.name)+" ",1),z.count!==void 0?(a(),n("span",{key:0,class:B([z.disabled?"bg-gray-100 text-gray-400":i.value===z.id?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-900","ml-2 py-0.5 px-2.5 rounded-full text-xs font-medium"])},l(z.count),3)):q("",!0)],10,Lg))),128))])])]),e("div",jg,[i.value==="organizations"?(a(),n("div",Og,[u(Eu,{organizations:y.value,"is-loading":c(o).isLoading,onOrganizationLeft:b,onCreateRequest:C,onViewDetails:T},null,8,["organizations","is-loading"])])):q("",!0),i.value==="requests"?(a(),n("div",Ng,[u(p0,{requests:m.value,"is-loading":c(s).isLoadingRequests,onRequestDetail:A,onCreateRequest:C},null,8,["requests","is-loading"])])):q("",!0),i.value==="invitations"?(a(),n("div",Ag,[u(Sd,{invitations:v.value,"is-loading":c(o).isLoadingInvitations,onInvitationResponded:p},null,8,["invitations","is-loading"])])):q("",!0)])])):(a(),n("div",ag,[e("div",ig,[ng,rg,lg,e("p",cg," Tu rol actual: "+l(((N=c(r).currentUser)==null?void 0:N.role)||"Sin definir"),1)])])),u(gm,{visible:f.value,organizations:y.value,onClose:$,onCreated:P},null,8,["visible","organizations"])])}}},Vg={__name:"ClientOrganizationsView",setup(t){return(o,s)=>(a(),H(Ug))}},Tg={class:"px-4 py-6 sm:px-6 lg:px-8"},Gg={key:0,class:"flex justify-center items-center py-12"},Bg=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),Fg=e("span",{class:"ml-2 text-gray-600"},"Cargando solicitud...",-1),Hg=[Bg,Fg],Wg={key:1,class:"text-center py-12"},Zg={class:"mx-auto max-w-md"},Qg=e("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),Yg=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Error al cargar la solicitud",-1),Jg={class:"mt-1 text-sm text-gray-500"},Xg={class:"mt-6"},Kg={key:2},ef={class:"mb-6"},tf={class:"mb-4"},sf={class:"mb-3"},of={class:"text-xl sm:text-2xl font-bold text-gray-900 mb-1"},af={class:"text-sm text-gray-600"},nf={class:"flex flex-wrap gap-2"},rf={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},lf={class:"lg:col-span-2 space-y-6"},cf={class:"bg-white shadow rounded-lg p-6"},df=e("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Detalles de la Solicitud",-1),uf={class:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2"},mf=e("dt",{class:"text-sm font-medium text-gray-500"},"Tipo de Solicitud",-1),gf={class:"mt-1 text-sm text-gray-900"},ff=e("dt",{class:"text-sm font-medium text-gray-500"},"Fecha de Creación",-1),hf={class:"mt-1 text-sm text-gray-900"},vf={key:0},pf=e("dt",{class:"text-sm font-medium text-gray-500"},"Última Actualización",-1),_f={class:"mt-1 text-sm text-gray-900"},bf=e("dt",{class:"text-sm font-medium text-gray-500"},"Días Transcurridos",-1),yf={class:"mt-1 text-sm text-gray-900"},xf={key:1},wf=e("dt",{class:"text-sm font-medium text-gray-500"},"Fecha Estimada de Completado",-1),$f={class:"mt-1 text-sm text-gray-900"},zf={key:2},Ef=e("dt",{class:"text-sm font-medium text-gray-500"},"Fecha de Completado",-1),kf={class:"mt-1 text-sm text-gray-900"},qf={class:"mt-6"},Cf=e("dt",{class:"text-sm font-medium text-gray-500 mb-2"},"Descripción",-1),Rf={class:"text-sm text-gray-900 whitespace-pre-wrap"},Mf={key:0,class:"bg-white shadow rounded-lg p-6"},Pf=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Archivos Adjuntos",-1),Df={class:"space-y-3"},Sf={class:"flex items-center space-x-3"},If={class:"text-sm font-medium text-gray-900"},Lf={class:"text-xs text-gray-500"},jf=["href"],Of={class:"bg-white shadow rounded-lg p-6"},Nf={class:"text-lg font-medium text-gray-900 mb-4"},Af={key:0,class:"space-y-4"},Uf={class:"flex items-start justify-between mb-2"},Vf={class:"flex items-center space-x-2"},Tf={class:"text-sm font-medium text-gray-900"},Gf={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800"},Bf={class:"text-xs text-gray-500"},Ff={class:"text-sm text-gray-700 whitespace-pre-wrap"},Hf={key:1,class:"text-center py-6"},Wf=e("p",{class:"text-sm text-gray-500"},"No hay respuestas aún",-1),Zf=e("label",{for:"response",class:"block text-sm font-medium text-gray-700 mb-2"}," Agregar Respuesta ",-1),Qf=["disabled"],Yf={key:0,class:"mt-3"},Jf={class:"flex items-center"},Xf=e("span",{class:"ml-2 text-sm text-gray-700"},"Nota interna (solo visible para el equipo corporativo)",-1),Kf={class:"mt-3 flex justify-end"},eh=["disabled"],th={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},sh={class:"space-y-6"},oh={class:"bg-white shadow rounded-lg p-6"},ah=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Participantes",-1),ih={class:"space-y-4"},nh={class:"flex items-center space-x-3"},rh=["src","alt"],lh={class:"text-sm font-medium text-gray-900"},ch={class:"text-xs text-gray-500"},dh={class:"flex items-center space-x-3"},uh=["src","alt"],mh={class:"text-sm font-medium text-gray-900"},gh={class:"text-xs text-gray-500"},fh={key:0,class:"flex items-center space-x-3"},hh=["src","alt"],vh={class:"text-sm font-medium text-gray-900"},ph={class:"text-xs text-gray-500"},_h={key:0,class:"bg-white shadow rounded-lg p-6"},bh=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Organización",-1),yh={class:"flex items-center space-x-3"},xh=["src","alt"],wh={class:"text-sm font-medium text-gray-900"},$h=e("p",{class:"text-xs text-gray-500"},"Vía organización",-1),zh={key:1,class:"bg-white shadow rounded-lg p-6"},Eh=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Acciones",-1),kh={class:"space-y-3"},qh=e("label",{for:"status",class:"block text-sm font-medium text-gray-700 mb-2"}," Cambiar Estado ",-1),Ch=["disabled"],Rh=we('<option value="PENDING">Pendiente</option><option value="IN_REVIEW">En Revisión</option><option value="RESPONDED">Respondida</option><option value="RESOLVED">Resuelta</option><option value="CLOSED">Cerrada</option>',5),Mh=[Rh],Ph={__name:"RequestDetailView",setup(t){const o=Ue(),s=Oe(),r=gt(),d=Fe(),i=R(null),f=R(!1),h=R(null),g=R(""),E=R(!1),_=R(!1),v=R(""),y=R(!1),m=D(()=>{var I;return(I=s.currentUser)==null?void 0:I.role}),k=D(()=>{var I,L;return((L=(I=i.value)==null?void 0:I.client_info)==null?void 0:L.profile_image_url)||X}),x=D(()=>{var I,L;return((L=(I=i.value)==null?void 0:I.corporate_client_info)==null?void 0:L.profile_image_url)||X}),M=D(()=>{var I,L;return((L=(I=i.value)==null?void 0:I.assigned_to_info)==null?void 0:L.profile_image_url)||X}),C=async()=>{var I,L;try{f.value=!0,h.value=null;const F=r.query.id;if(!F)throw new Error("ID de solicitud no proporcionado");let J;if(m.value==="client"||m.value==="basic")J=await o.getMyRequestDetail(F);else if(m.value==="corporate_client")J=await o.getReceivedRequestDetail(F);else throw new Error("Rol de usuario no válido");i.value=J.corporate_request,v.value=i.value.status}catch(F){console.error("Error loading request detail:",F),h.value=((L=(I=F.response)==null?void 0:I.data)==null?void 0:L.error)||F.message||"Error al cargar la solicitud"}finally{f.value=!1}},$=async()=>{var I,L;try{_.value=!0;const F={response_text:g.value.trim()};m.value==="corporate_client"&&(F.is_internal_note=E.value);let J;m.value==="client"||m.value==="basic"?J=await o.addResponseToMyRequest(i.value.id,F):m.value==="corporate_client"&&(J=await o.addResponseToReceivedRequest(i.value.id,F)),o.currentRequest&&o.currentRequest.id===i.value.id&&(i.value.responses=o.currentRequest.responses,i.value.response_count=o.currentRequest.response_count),g.value="",E.value=!1}catch(F){console.error("Error submitting response:",F),j(((L=(I=F.response)==null?void 0:I.data)==null?void 0:L.error)||"Error al enviar la respuesta","error")}finally{_.value=!1}},p=async()=>{var I,L;if(v.value!==i.value.status)try{y.value=!0,await o.updateReceivedRequest(i.value.id,{status:v.value}),i.value.status=v.value,i.value.status_updated_at=new Date().toISOString(),j("Estado actualizado exitosamente","success")}catch(F){console.error("Error updating status:",F),j(((L=(I=F.response)==null?void 0:I.data)==null?void 0:L.error)||"Error al actualizar el estado","error"),v.value=i.value.status}finally{y.value=!1}},b=()=>{d.push({name:"organizations_dashboard"})},P=I=>new Date(I).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),A=I=>{const L=new Date(I),F=new Date,J=new Date(L.getFullYear(),L.getMonth(),L.getDate()),_e=new Date(F.getFullYear(),F.getMonth(),F.getDate())-J,G=Math.round(_e/(1e3*60*60*24));return G===0?"Hoy":G===1?"Ayer":G>1&&G<7?`Hace ${G} días`:P(I)},U=I=>{if(I===0)return"0 Bytes";const L=1024,F=["Bytes","KB","MB","GB"],J=Math.floor(Math.log(I)/Math.log(L));return parseFloat((I/Math.pow(L,J)).toFixed(2))+" "+F[J]},T=I=>({PENDING:"Pendiente",IN_REVIEW:"En Revisión",RESPONDED:"Respondida",RESOLVED:"Resuelta",CLOSED:"Cerrada"})[I]||I,V=I=>({PENDING:"bg-yellow-100 text-yellow-800",IN_REVIEW:"bg-blue-100 text-blue-800",RESPONDED:"bg-purple-100 text-purple-800",RESOLVED:"bg-green-100 text-green-800",CLOSED:"bg-gray-100 text-gray-800"})[I]||"bg-gray-100 text-gray-800",S=I=>({LOW:"Baja",MEDIUM:"Media",HIGH:"Alta",URGENT:"Urgente"})[I]||I,N=I=>({LOW:"bg-gray-100 text-gray-600",MEDIUM:"bg-blue-100 text-blue-600",HIGH:"bg-orange-100 text-orange-600",URGENT:"bg-red-100 text-red-600"})[I]||"bg-gray-100 text-gray-600",z=I=>({client:"Cliente",corporate_client:"Cliente Corporativo"})[I]||I;return te(()=>r.query.id,()=>{r.query.id&&C()}),$e(()=>{r.query.id&&C()}),(I,L)=>{var F,J,me,_e,G,ie,ge,Z,qe,Je;return a(),n("div",Tg,[f.value?(a(),n("div",Gg,Hg)):h.value?(a(),n("div",Wg,[e("div",Zg,[Qg,Yg,e("p",Jg,l(h.value),1),e("div",Xg,[e("button",{onClick:b,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(et),{class:"h-4 w-4 mr-2"}),w(" Volver ")])])])])):i.value?(a(),n("div",Kg,[e("div",ef,[e("div",tf,[e("button",{onClick:b,class:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u(c(et),{class:"h-4 w-4 mr-2"}),w(" Volver ")])]),e("div",sf,[e("h1",of,l(i.value.title),1),e("p",af,"Solicitud "+l(i.value.request_number),1)]),e("div",nf,[e("span",{class:B([V(i.value.status),"inline-flex items-center px-2.5 py-1 rounded-full text-xs sm:text-sm font-medium"])},l(T(i.value.status)),3),e("span",{class:B([N(i.value.priority),"inline-flex items-center px-2.5 py-1 rounded-full text-xs sm:text-sm font-medium"])},l(S(i.value.priority)),3)])]),e("div",rf,[e("div",lf,[e("div",cf,[df,e("dl",uf,[e("div",null,[mf,e("dd",gf,l(i.value.request_type_name),1)]),e("div",null,[ff,e("dd",hf,l(P(i.value.created_at)),1)]),i.value.status_updated_at&&i.value.status_updated_at!==i.value.created_at?(a(),n("div",vf,[pf,e("dd",_f,l(P(i.value.status_updated_at)),1)])):q("",!0),e("div",null,[bf,e("dd",yf,l(i.value.days_since_created)+" días",1)]),i.value.estimated_completion_date?(a(),n("div",xf,[wf,e("dd",$f,l(P(i.value.estimated_completion_date)),1)])):q("",!0),i.value.actual_completion_date?(a(),n("div",zf,[Ef,e("dd",kf,l(P(i.value.actual_completion_date)),1)])):q("",!0)]),e("div",qf,[Cf,e("dd",Rf,l(i.value.description),1)])]),i.value.files&&i.value.files.length>0?(a(),n("div",Mf,[Pf,e("div",Df,[(a(!0),n(Q,null,Y(i.value.files,K=>(a(),n("div",{key:K.id,class:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50"},[e("div",Sf,[u(c(We),{class:"h-8 w-8 text-gray-400"}),e("div",null,[e("p",If,l(K.file_name),1),e("p",Lf,l(U(K.file_size)),1)])]),e("a",{href:K.file_url,target:"_blank",class:"inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50"},[u(c(ft),{class:"h-3 w-3 mr-1"}),w(" Descargar ")],8,jf)]))),128))])])):q("",!0),e("div",Of,[e("h3",Nf," Conversación ("+l(((F=i.value.responses)==null?void 0:F.length)||0)+" respuestas) ",1),i.value.responses&&i.value.responses.length>0?(a(),n("div",Af,[(a(!0),n(Q,null,Y(i.value.responses,K=>(a(),n("div",{key:K.id,class:B(["p-4 rounded-lg",K.user_type===m.value?"bg-blue-50 border-l-4 border-blue-400":"bg-gray-50 border-l-4 border-gray-300"])},[e("div",Uf,[e("div",Vf,[e("span",Tf,l(K.user_name),1),e("span",{class:B(["inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",K.user_type==="corporate_client"?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"])},l(z(K.user_type)),3),K.is_internal_note?(a(),n("span",Gf," Nota Interna ")):q("",!0)]),e("span",Bf,l(A(K.created_at)),1)]),e("p",Ff,l(K.response_text),1)],2))),128))])):(a(),n("div",Hf,[u(c(Qe),{class:"h-12 w-12 mx-auto mb-3 text-gray-300"}),Wf])),e("form",{onSubmit:ye($,["prevent"]),class:"mt-6 border-t pt-6"},[e("div",null,[Zf,W(e("textarea",{id:"response","onUpdate:modelValue":L[0]||(L[0]=K=>g.value=K),rows:"3",required:"",disabled:_.value,class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Escribe tu respuesta..."},null,8,Qf),[[ae,g.value]])]),m.value==="corporate_client"?(a(),n("div",Yf,[e("label",Jf,[W(e("input",{"onUpdate:modelValue":L[1]||(L[1]=K=>E.value=K),type:"checkbox",class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[Ve,E.value]]),Xf])])):q("",!0),e("div",Kf,[e("button",{type:"submit",disabled:_.value||!g.value.trim(),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},[_.value?(a(),n("div",th)):(a(),H(c(lt),{key:1,class:"h-4 w-4 mr-2"})),w(" "+l(_.value?"Enviando...":"Enviar Respuesta"),1)],8,eh)])],32)])]),e("div",sh,[e("div",oh,[ah,e("div",ih,[e("div",nh,[e("img",{src:k.value,alt:`Avatar de ${(J=i.value.client_info)==null?void 0:J.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,rh),e("div",null,[e("p",lh,l((me=i.value.client_info)==null?void 0:me.full_name),1),e("p",ch,"Cliente • "+l((_e=i.value.client_info)==null?void 0:_e.email),1)])]),e("div",dh,[e("img",{src:x.value,alt:`Avatar de ${(G=i.value.corporate_client_info)==null?void 0:G.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,uh),e("div",null,[e("p",mh,l((ie=i.value.corporate_client_info)==null?void 0:ie.full_name),1),e("p",gh,"Cliente Corporativo • "+l((ge=i.value.corporate_client_info)==null?void 0:ge.email),1)])]),i.value.assigned_to_info?(a(),n("div",fh,[e("img",{src:M.value,alt:`Avatar de ${(Z=i.value.assigned_to_info)==null?void 0:Z.full_name}`,class:"h-8 w-8 rounded-full object-cover border border-gray-200"},null,8,hh),e("div",null,[e("p",vh,l((qe=i.value.assigned_to_info)==null?void 0:qe.full_name),1),e("p",ph,"Asignado • "+l((Je=i.value.assigned_to_info)==null?void 0:Je.email),1)])])):q("",!0)])]),i.value.organization_info?(a(),n("div",_h,[bh,e("div",yh,[e("img",{src:i.value.organization_info.profile_image_url||c(X),alt:`Logo de ${i.value.organization_info.title}`,class:"h-10 w-10 rounded-full object-cover border border-gray-200"},null,8,xh),e("div",null,[e("p",wh,l(i.value.organization_info.title),1),$h])])])):q("",!0),m.value==="corporate_client"?(a(),n("div",zh,[Eh,e("div",kh,[e("div",null,[qh,W(e("select",{id:"status","onUpdate:modelValue":L[2]||(L[2]=K=>v.value=K),onChange:p,disabled:y.value,class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},Mh,40,Ch),[[ce,v.value]])])])])):q("",!0)])])])):q("",!0)])}}},Dh={key:1},Sh={class:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8"},Ih=e("h1",{class:"text-lg font-semibold leading-6 text-gray-900"},"Organizaciones",-1),Lh={key:2,class:"px-4 py-6 sm:px-6 lg:px-8"},jh=we('<div class="text-center py-12"><div class="mx-auto max-w-md"><svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"></path></svg><h3 class="mt-2 text-sm font-medium text-gray-900">Acceso Restringido</h3><p class="mt-1 text-sm text-gray-500"> No tienes permisos para acceder a este módulo. </p></div></div>',1),Oh=[jh],sv={__name:"Dashboard",setup(t){const o=Oe(),s=D(()=>{var r;return((r=o.currentUser)==null?void 0:r.role)||null});return(r,d)=>(a(),n("div",null,[r.$route.query.tab==="request-detail"?(a(),H(Ph,{key:0})):(a(),n("div",Dh,[e("div",Sh,[ht(r.$slots,"default"),Ih]),s.value==="corporate_client"?(a(),H(Nc,{key:0})):s.value==="client"||s.value==="basic"?(a(),H(Vg,{key:1})):(a(),n("div",Lh,Oh))]))]))}};export{sv as default};
