import{e as s,f as u,g as e,r as O,s as v,E as fe,al as tt,c as N,T as ue,o as We,as as Le,w as me,Q as Ne,k as A,i as Z,t as k,h as M,j as i,G as ie,ah as Te,p as T,l as I,F as K,N as te,a2 as qe,O as Oe,P as Ie,ad as Ge,b8 as ke,ae as Ve,n as G,af as De,ag as He,u as je,a9 as le,a5 as Ze,ac as st,aK as at,m as pe,v as ze,b as rt,D as Ee,I as Qe,an as Ce,ao as Se,ba as ot}from"./index.js";import{g as Re,u as nt,_ as lt}from"./DocumentPermissionsManager.js";import{useRecentViews as it}from"./useRecentViews.js";import{u as he,o as Ye,d as dt}from"./index2.js";import{a as ct}from"./DocumentRelationshipsModal.js";import{_ as be}from"./_plugin-vue_export-helper.js";import{r as Ue}from"./TrashIcon.js";import{r as ce}from"./DocumentIcon.js";import{r as Ke}from"./PhotoIcon.js";import{r as Be}from"./LinkIcon.js";import{r as Pe}from"./CheckCircleIcon.js";import{r as Me}from"./CloudArrowUpIcon.js";import{r as ut}from"./ExclamationTriangleIcon.js";import{r as Xe}from"./EllipsisVerticalIcon.js";import{r as mt}from"./ChevronRightIcon.js";import{r as gt}from"./PencilIcon.js";import{s as pt,h as Ae}from"./loading_message.js";function Fe(o,C){return s(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"})])}function ft(){const o=O(!1),C=O("");async function r(n,$,p="",t="",x=[],b={}){if(!$)throw C.value="Recipient email is required.",await v(C.value,"error"),new Error(C.value);const S=new FormData;S.append("to_email",$),S.append("subject",p),S.append("body",t),x.forEach((w,f)=>{S.append(`attachments[${f}]`,w)});for(const[w,f]of Object.entries(b))S.append(w,f);try{o.value=!0,C.value="",pt("Sending email...","Please wait while we send the email.");const w=await fe(n,S);return Ae(),await v("Email sent successfully.","success"),w.data}catch(w){throw Ae(),console.error("Error sending email:",w.message),C.value="An error occurred while sending the email. Please try again.",await v(C.value,"error"),w}finally{o.value=!1}}return{sendEmail:r,isLoading:o,errorMessage:C}}function ee(o){return tt.fire({title:o,icon:"question",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",buttonsStyling:!1}).then(C=>C.isConfirmed)}const q=o=>(Oe("data-v-1cb4d3ef"),o=o(),Ie(),o),ht={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},bt={class:"px-6 py-4 border-b border-gray-200"},vt=q(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"GestiÃ³n de Membrete",-1)),yt={class:"text-sm text-gray-500 mt-1"},xt={class:"p-6 overflow-y-auto flex-grow"},wt={key:0,class:"text-center py-10"},_t=q(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),$t={class:"mt-4 text-gray-500"},kt={key:1,class:"space-y-6"},Dt={key:0,class:"space-y-4"},Et=q(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete Actual",-1)),Ct={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},St=["src"],Pt={class:"mt-4 flex justify-center space-x-3"},Mt=["disabled"],Ft={key:1,class:"text-center py-8"},Ot=q(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete",-1)),It=q(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," Este documento no tiene una imagen de membrete configurada. ",-1)),jt={class:"space-y-4"},zt={class:"text-lg font-medium text-gray-900"},Tt={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},Rt={key:0},Ut={class:"mt-4"},Bt=q(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, mÃ¡ximo 10MB. Se usa Ãºnicamente para los PDF. ",-1)),At=q(()=>e("p",{class:"text-xs text-gray-400 mt-1"},' Dimensiones ideales: 2550 Ã— 3300 pÃ­xeles (tamaÃ±o carta, 8.5" Ã— 11" a 300 DPI) ',-1)),Wt={key:1,class:"space-y-4"},Lt={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Nt={class:"text-gray-400"},qt={key:0,class:"mt-4"},Gt=["src"],Vt={class:"flex justify-center space-x-3"},Ht=["disabled"],Zt={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Qt={class:"space-y-4 border-t border-gray-200 pt-6"},Yt=q(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Plantilla Word especÃ­fica de este documento (.docx)",-1)),Kt=q(()=>e("p",{class:"text-sm text-gray-500"},[T(" Esta plantilla se usarÃ¡ al descargar "),e("strong",null,"este documento"),T(" en Word. Si no estÃ¡ configurada, se usarÃ¡ la plantilla Word global (Membrete Global) si existe. ")],-1)),Xt={key:0,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Jt={class:"text-sm text-gray-700"},es=q(()=>e("div",{class:"font-medium"},"Plantilla actual:",-1)),ts={class:"mt-1 break-words"},ss={class:"font-mono break-all"},as={key:0,class:"text-gray-400 ml-2"},rs={class:"mt-3 flex flex-wrap gap-3"},os=["disabled"],ns={key:1,class:"text-sm text-gray-500"},ls={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},is={key:0},ds={class:"mt-4"},cs=q(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos .docx, mÃ¡ximo 10MB. ",-1)),us={key:1,class:"space-y-4"},ms={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},gs={class:"text-gray-400"},ps={class:"flex justify-center space-x-3"},fs=["disabled"],hs={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},bs={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},vs={class:"flex items-center space-x-2"},ys=q(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete para PDF",-1)),xs=q(()=>e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-yellow-800 mb-2"},"ðŸ”„ Prioridad de Membrete"),e("div",{class:"text-sm text-yellow-700 space-y-1"},[e("div",null,[e("strong",null,"1Âº Prioridad:"),T(" Membrete especÃ­fico del documento (este)")]),e("div",null,[e("strong",null,"2Âº Prioridad:"),T(" Membrete global de imagen para PDF del usuario")]),e("div",null,[e("strong",null,"3Âº Prioridad:"),T(" Sin membrete")])])],-1)),ws=q(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"ðŸ“ Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"2550 pÃ­xeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"3300 pÃ­xeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"ProporciÃ³n:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta, 300 DPI)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"Â±10%")])])])],-1)),_s=q(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"ðŸŽ¨ DistribuciÃ³n Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"âš ï¸ ZONA CRÃTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"MantÃ©n semi-transparente. El texto del documento se superpone aquÃ­.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, telÃ©fonos, emails, informaciÃ³n de contacto.")])])])])])],-1)),$s=q(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"ðŸ”§ Consideraciones TÃ©cnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"â€¢"),e("span",null,[e("strong",null,"Posicionamiento:"),T(" La imagen se centra automÃ¡ticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"â€¢"),e("span",null,[e("strong",null,"Transparencia:"),T(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"â€¢"),e("span",null,[e("strong",null,"MÃ¡rgenes:"),T(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"â€¢"),e("span",null,[e("strong",null,"ResoluciÃ³n:"),T(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"âš ï¸"),e("span",null,[e("strong",null,"Zona crÃ­tica:"),T(" Evita elementos grÃ¡ficos densos en el centro (300-400px de altura)")])])])])],-1)),ks=q(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"ðŸ’¡ Tips de DiseÃ±o RÃ¡pido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"â€¢ Si solo tienes header, ubÃ­calo en los primeros 120-150px"),e("div",null,"â€¢ El resto de la imagen debe ser transparente o blanco"),e("div",null,"â€¢ Para footer, usa los Ãºltimos 80-120px"),e("div",null,"â€¢ El texto se superpone en toda la imagen, mantÃ©n el centro claro")])],-1)),Ds={key:3,class:"space-y-2"},Es={class:"flex"},Cs={class:"text-sm text-yellow-700"},Ss={__name:"LetterheadModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close","uploaded","deleted"],setup(o,{emit:C}){const r=o,n=C,$=he(),p=O(!1),t=O(""),x=O(!1),b=O(!1),S=O(null),w=O(null),f=O(null),P=O([]),W=O(null),V=O(!1),m=O(null),h=O(!1),d=O(null),F=O(""),y=O(null),a=O(!1),E=O(!1),R=O(null),j=N(()=>{var g;return(g=r.document)==null?void 0:g.id}),B=()=>{oe(),n("close")},L=g=>{const _=g.target.files[0];if(_){if(!_.name.toLowerCase().endsWith(".docx")){alert("Solo se permiten archivos .docx para la plantilla Word");return}if(_.size>10*1024*1024){alert("El archivo de plantilla no puede ser mayor a 10MB");return}m.value=_}},de=()=>{m.value=null,R.value&&(R.value.value="")},X=async()=>{var g;if(!(!m.value||!j.value)){a.value=!0;try{const U=(g=(await $.uploadDocumentLetterheadWordTemplate(j.value,m.value)).data)==null?void 0:g.template_info;h.value=!0,F.value=(U==null?void 0:U.filename)||m.value.name,y.value=(U==null?void 0:U.size_bytes)||m.value.size,await re(),de()}catch(_){console.error("Error uploading document Word template:",_),alert("Error al subir la plantilla Word. Por favor intenta nuevamente.")}finally{a.value=!1}}},re=async()=>{var g,_;if(j.value)try{const U=await $.getDocumentLetterheadWordTemplate(j.value,"blob");if(!U){h.value=!1,d.value&&URL.revokeObjectURL(d.value),d.value=null,F.value="",y.value=null;return}if(U&&U.data){h.value=!0,d.value&&URL.revokeObjectURL(d.value),d.value=URL.createObjectURL(U.data);const H=((g=U.headers)==null?void 0:g["content-disposition"])||((_=U.headers)==null?void 0:_["Content-Disposition"]);let Y="plantilla_word.docx";if(H){const ae=H.match(/filename="?([^";]+)"?/i);ae&&ae[1]&&(Y=ae[1])}F.value=Y,y.value=U.data.size||null}}catch(U){console.error("Error loading document Word template:",U)}},ve=async()=>{await ee("Â¿EstÃ¡s seguro de que deseas eliminar la plantilla Word de membrete de este documento?")&&ge()},ge=async()=>{if(j.value){E.value=!0;try{await $.deleteDocumentLetterheadWordTemplate(j.value),d.value&&URL.revokeObjectURL(d.value),d.value=null,F.value="",y.value=null,h.value=!1}catch(g){console.error("Error deleting document Word template:",g),alert("Error al eliminar la plantilla Word. Por favor intenta nuevamente.")}finally{E.value=!1}}},ye=()=>{if(d.value){const g=document.createElement("a");g.href=d.value,g.download=F.value||"membrete-word.docx",document.body.appendChild(g),g.click(),document.body.removeChild(g)}},xe=g=>{const _=g.target.files[0];if(!_)return;if(!_.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(_.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}S.value=_,P.value=[];const U=new FileReader;U.onload=H=>{w.value=H.target.result;const Y=new Image;Y.onload=()=>{we(Y.width,Y.height)},Y.src=H.target.result},U.readAsDataURL(_)},we=(g,_)=>{const ae=g/_,$e=2550/3300,et=Math.abs(ae-$e)/$e;if(g===2550&&_===3300){P.value.push("âœ… Dimensiones perfectas: 2550 Ã— 3300 pÃ­xeles");return}et<=.1?(P.value.push(`â„¹ï¸ Buenas proporciones detectadas: ${g} Ã— ${_} pÃ­xeles (${ae.toFixed(3)})`),(g!==2550||_!==3300)&&P.value.push('ðŸ’¡ Para mejores resultados, usa exactamente 2550 Ã— 3300 pÃ­xeles (tamaÃ±o carta, 8.5" Ã— 11" a 300 DPI)')):(P.value.push(`âš ï¸ Proporciones no ideales: ${g} Ã— ${_} pÃ­xeles (${ae.toFixed(3)})`),P.value.push(`ðŸŽ¯ Proporciones recomendadas: ${$e.toFixed(3)} (8.5:11, tamaÃ±o carta)`),P.value.push("ðŸ“ Considera redimensionar tu imagen a 2550 Ã— 3300 pÃ­xeles (tamaÃ±o carta)")),(g<1200||_<1600)&&P.value.push("âš ï¸ Imagen muy pequeÃ±a - puede verse pixelada en documentos PDF tamaÃ±o carta"),(g>4e3||_>5e3)&&P.value.push("â„¹ï¸ Imagen muy grande - se redimensionarÃ¡ automÃ¡ticamente para ajustarse al tamaÃ±o carta")},oe=()=>{S.value=null,w.value=null,P.value=[],V.value=!1,W.value&&(W.value.value="")},_e=async()=>{var g;if(!(!S.value||!j.value)){x.value=!0,P.value=[];try{const _=await $.uploadLetterheadImage(j.value,S.value);(g=_.data)!=null&&g.warnings&&_.data.warnings.length>0&&(P.value=_.data.warnings),await se(),oe(),n("uploaded",_.data)}catch(_){console.error("Error uploading letterhead:",_),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{x.value=!1}}},se=async()=>{if(j.value)try{const g=await $.getLetterheadImage(j.value);g&&g.data?f.value=URL.createObjectURL(g.data):f.value=null}catch(g){g.response&&g.response.status!==404&&console.error("Unexpected error loading letterhead:",g),f.value=null}},l=async()=>{await ee("Â¿EstÃ¡s seguro de que deseas eliminar la imagen de membrete?")&&c()},c=async()=>{if(j.value){b.value=!0;try{await $.deleteLetterheadImage(j.value),f.value&&URL.revokeObjectURL(f.value),f.value=null,n("deleted")}catch(g){console.error("Error deleting letterhead:",g),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{b.value=!1}}},D=()=>{var g;if(f.value){const _=document.createElement("a");_.href=f.value,_.download=`membrete-${((g=r.document)==null?void 0:g.title)||"documento"}.png`,document.body.appendChild(_),_.click(),document.body.removeChild(_)}},z=()=>{f.value=null},Q=g=>{if(g===0)return"0 Bytes";const _=1024,U=["Bytes","KB","MB","GB"],H=Math.floor(Math.log(g)/Math.log(_));return parseFloat((g/Math.pow(_,H)).toFixed(2))+" "+U[H]};ue(()=>r.isVisible,g=>{g&&j.value&&(se(),re())}),ue(()=>r.document,g=>{g&&r.isVisible&&(se(),re())});const ne=()=>{f.value&&URL.revokeObjectURL(f.value),w.value&&URL.revokeObjectURL(w.value),d.value&&URL.revokeObjectURL(d.value)};return We(()=>{r.isVisible&&j.value&&(se(),re())}),Le(ne),(g,_)=>me((s(),A(qe,null,{default:Z(()=>{var U;return[e("div",ht,[e("div",bt,[vt,e("p",yt," Documento: "+k(((U=o.document)==null?void 0:U.title)||"Cargando..."),1),e("button",{onClick:B,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[M(i(ie),{class:"h-6 w-6"})])]),e("div",xt,[p.value?(s(),u("div",wt,[_t,e("p",$t,k(t.value),1)])):(s(),u("div",kt,[f.value?(s(),u("div",Dt,[Et,e("div",Ct,[e("img",{src:f.value,alt:"Membrete actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:z},null,40,St),e("div",Pt,[e("button",{onClick:D,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[M(i(Te),{class:"h-4 w-4 mr-2"}),T(" Descargar ")]),e("button",{onClick:l,disabled:b.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[M(i(Ue),{class:"h-4 w-4 mr-2"}),T(" "+k(b.value?"Eliminando...":"Eliminar"),1)],8,Mt)])])])):(s(),u("div",Ft,[M(i(ce),{class:"mx-auto h-12 w-12 text-gray-400"}),Ot,It])),e("div",jt,[e("h3",zt,k(f.value?"Reemplazar Membrete":"Subir Membrete"),1),e("div",Tt,[e("input",{ref_key:"fileInput",ref:W,type:"file",accept:".png",onChange:xe,class:"hidden"},null,544),S.value?(s(),u("div",Wt,[e("div",Lt,[M(i(Pe),{class:"h-5 w-5 text-green-500"}),e("span",null,k(S.value.name),1),e("span",Nt,"("+k(Q(S.value.size))+")",1)]),w.value?(s(),u("div",qt,[e("img",{src:w.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,Gt)])):I("",!0),e("div",Vt,[e("button",{onClick:oe,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:_e,disabled:x.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[x.value?(s(),u("div",Zt)):(s(),A(i(Me),{key:0,class:"h-4 w-4 mr-2"})),T(" "+k(x.value?"Subiendo...":"Subir Imagen"),1)],8,Ht)])])):(s(),u("div",Rt,[M(i(Ke),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Ut,[e("button",{onClick:_[0]||(_[0]=H=>g.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG "),e("button",{onClick:_[1]||(_[1]=H=>V.value=!V.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[M(i(Be),{class:"h-4 w-4 mr-2"}),T(" "+k(V.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),Bt,At]))])]),e("div",Qt,[Yt,Kt,h.value?(s(),u("div",Xt,[e("div",Jt,[es,e("div",ts,[e("span",ss,k(F.value||"plantilla_word.docx"),1),y.value?(s(),u("span",as,"("+k(Q(y.value))+")",1)):I("",!0)])]),e("div",rs,[d.value?(s(),u("button",{key:0,onClick:ye,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[M(i(Te),{class:"h-4 w-4 mr-2"}),T(" Descargar ")])):I("",!0),e("button",{onClick:ve,disabled:E.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[M(i(Ue),{class:"h-4 w-4 mr-2"}),T(" "+k(E.value?"Eliminando...":"Eliminar"),1)],8,os)])])):(s(),u("div",ns," Este documento no tiene una plantilla Word configurada. Puedes subir un archivo .docx con tu membrete. ")),e("div",ls,[e("input",{ref_key:"wordTemplateInput",ref:R,type:"file",accept:".docx",onChange:L,class:"hidden"},null,544),m.value?(s(),u("div",us,[e("div",ms,[M(i(Pe),{class:"h-5 w-5 text-green-500"}),e("span",null,k(m.value.name),1),e("span",gs,"("+k(Q(m.value.size))+")",1)]),e("div",ps,[e("button",{onClick:de,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:X,disabled:a.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[a.value?(s(),u("div",hs)):(s(),A(i(Me),{key:0,class:"h-4 w-4 mr-2"})),T(" "+k(a.value?"Subiendo...":"Subir Plantilla"),1)],8,fs)])])):(s(),u("div",is,[M(i(ce),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",ds,[e("button",{onClick:_[2]||(_[2]=H=>g.$refs.wordTemplateInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Plantilla .docx (Word) ")]),cs]))])]),V.value?(s(),u("div",bs,[e("div",vs,[M(i(Be),{class:"h-6 w-6 text-blue-600"}),ys]),xs,ws,_s,$s,ks])):I("",!0),P.value.length>0?(s(),u("div",Ds,[(s(!0),u(K,null,te(P.value,(H,Y)=>(s(),u("div",{key:Y,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",Es,[M(i(ut),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",Cs,k(H),1)])]))),128))])):I("",!0)]))])])]}),_:1},512)),[[Ne,o.isVisible]])}},Ps=be(Ss,[["__scopeId","data-v-1cb4d3ef"]]),Ms={class:"py-1"},Fs=["disabled","onClick"],Os={key:1,class:"submenu-container relative"},Is=["onMouseenter","onMouseleave"],js={class:"flex items-center"},zs=["onMouseenter","onMouseleave"],Ts={class:"py-1"},Rs=["disabled","onClick"],Us={key:2,class:"border-t border-gray-100"},Bs={__name:"HierarchicalMenu",props:{menuItems:{type:Array,required:!0,default:()=>[]},menuPosition:{type:String,default:"right-0 left-auto sm:left-0 sm:right-auto"}},emits:["menu-action","modalOpen","navigation"],setup(o,{emit:C}){const r=C,n=O(null);let $=null;const p=b=>{$&&(clearTimeout($),$=null),n.value=b},t=b=>{$=setTimeout(()=>{n.value===b&&(n.value=null)},150)},x=b=>{n.value=null,r("menu-action",b)};return(b,S)=>(s(),A(i(He),{as:"div",class:"relative inline-block text-left menu-container"},{default:Z(()=>[M(i(Ge),{class:"flex items-center justify-center w-8 h-8 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors focus:outline-none focus:ring-0"},{default:Z(()=>[M(i(Xe),{class:"w-5 h-5","aria-hidden":"true"})]),_:1}),M(ke,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:Z(()=>[M(i(Ve),{class:G(["absolute z-50 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",o.menuPosition])},{default:Z(()=>[e("div",Ms,[(s(!0),u(K,null,te(o.menuItems,w=>(s(),u(K,{key:w.id||w.label},[w.children?(s(),u("div",Os,[M(i(De),null,{default:Z(()=>[e("div",{class:"w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition cursor-pointer flex items-center justify-between",onMouseenter:f=>p(w.id),onMouseleave:f=>t(w.id)},[e("div",js,k(w.label),1),M(i(mt),{class:"w-4 h-4 text-gray-400"})],40,Is)]),_:2},1024),M(ke,{"enter-active-class":"transition ease-out duration-150","enter-from-class":"transform opacity-0 translate-x-2 scale-95","enter-to-class":"transform opacity-100 translate-x-0 scale-100","leave-active-class":"transition ease-in duration-100","leave-from-class":"transform opacity-100 translate-x-0 scale-100","leave-to-class":"transform opacity-0 translate-x-2 scale-95"},{default:Z(()=>[n.value===w.id?(s(),u("div",{key:0,class:"absolute left-full top-0 mt-0 w-52 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none z-60",onMouseenter:f=>p(w.id),onMouseleave:f=>t(w.id)},[e("div",Ts,[(s(!0),u(K,null,te(w.children,f=>(s(),u("button",{key:f.label,class:G(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":f.disabled,"cursor-pointer":!f.disabled}]),disabled:f.disabled,onClick:P=>x(f.action)},[f.disabled?(s(),A(i(Fe),{key:0,class:"size-4 text-gray-400 inline mr-2","aria-hidden":"true"})):I("",!0),T(" "+k(f.label),1)],10,Rs))),128))])],40,zs)):I("",!0)]),_:2},1024)])):(s(),A(i(De),{key:0},{default:Z(()=>[e("button",{class:G(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":w.disabled,"cursor-pointer":!w.disabled}]),disabled:w.disabled,onClick:f=>x(w.action)},[w.disabled?(s(),A(i(Fe),{key:0,class:"size-5 text-gray-400 inline mr-2","aria-hidden":"true"})):I("",!0),T(" "+k(w.label),1)],10,Fs)]),_:2},1024)),w.divider?(s(),u("div",Us)):I("",!0)],64))),128))])]),_:1},8,["class"])]),_:1})]),_:1}))}},As=be(Bs,[["__scopeId","data-v-60d5f9c4"]]);function Ws(o,C){if(!o||o.length===0)return[];const r={editing:{id:"editing",label:"EdiciÃ³n y gestiÃ³n",children:[],priority:1},downloads:{id:"downloads",label:"Descargas",children:[],priority:2},communication:{id:"communication",label:"ComunicaciÃ³n",children:[],priority:3},states:{id:"states",label:"Estados del documento",children:[],priority:4},signatures:{id:"signatures",label:"Firmas",children:[],priority:5},actions:{id:"actions",label:"Acciones",children:[],priority:6}};o.forEach(p=>{const t={...p};switch(p.action){case"edit":r.editing.children.push(t);break;case"permissions":r.editing.children.push(t);break;case"copy":r.editing.children.push(t);break;case"downloadPDF":case"downloadWord":case"downloadSignedDocument":r.downloads.children.push(t);break;case"email":r.communication.children.push(t);break;case"publish":case"draft":case"formalize":r.states.children.push(t);break;case"viewSignatures":case"sign":r.signatures.children.push(t);break;case"preview":case"delete":case"removeFromFolder":case"useDocument":r.actions.children.push(t);break;default:r.actions.children.push(t)}});const n=Object.values(r).filter(p=>p.children.length>0).sort((p,t)=>p.priority-t.priority),$=[];return n.forEach((p,t)=>{p.children.length===1?$.push(p.children[0]):$.push(p),t<n.length-1&&$.push({divider:!0})}),$}function Ls(o){return o&&o.length>6}const Je=o=>(Oe("data-v-a1d6dccd"),o=o(),Ie(),o),Ns=["data-document-id"],qs={class:"flex justify-between items-start mb-3"},Gs={class:"flex items-center gap-2"},Vs={class:"py-1"},Hs=["disabled","onClick"],Zs={class:"space-y-2"},Qs={class:"text-lg font-semibold text-gray-900 leading-tight"},Ys={key:0,class:"text-sm text-gray-600 leading-relaxed"},Ks={key:1,class:"pt-2"},Xs={class:"flex items-center gap-2 flex-wrap"},Js=Je(()=>e("span",{class:"text-xs font-medium text-gray-500"},"Etiquetas:",-1)),ea={class:"flex items-center gap-1.5"},ta=["title"],sa={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-50"},aa={class:"bg-gray-900 text-white text-xs rounded-lg py-1.5 px-2.5 whitespace-nowrap shadow-lg"},ra=Je(()=>e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-[4px] border-r-[4px] border-t-[4px] border-transparent border-t-gray-900"},null,-1)),oa={__name:"BaseDocumentCard",props:{document:{type:Object,required:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},highlightedDocId:{type:[String,Number],default:null},showTags:{type:Boolean,default:!0},additionalClasses:{type:[String,Array,Object],default:""},statusIcon:{type:[String,Object,Function],default:null},statusText:{type:String,default:null},statusBadgeClasses:{type:[String,Object,Array],default:null},menuOptions:{type:Array,default:null},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},promptDocuments:{type:Boolean,default:!1},enableModals:{type:Boolean,default:!0},editModalComponent:{type:String,default:"UseDocumentByClient"},editRoute:{type:String,default:null},enableSignatures:{type:Boolean,default:!0},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null}},emits:["click","refresh","remove-from-folder","modal-open","navigation","menuAction"],setup(o,{emit:C}){const r=je(),n=o,$=C,{activeModals:p,openModal:t,closeModal:x,getUserRole:b}=eo(n.documentStore,n.userStore),{handlePreviewDocument:S,deleteDocument:w,downloadPDFDocument:f,downloadWordDocument:P,copyDocument:W,publishDocument:V,moveToDraft:m,formalizeDocument:h,signDocument:d,downloadSignedDocument:F}=to(n.documentStore,n.userStore,$),y=l=>{l.target.closest(".menu-container")||$("click",n.document,l)},a=()=>{$("refresh")},E={default:{getMenuOptions:(l,c)=>{const D=[];return D.push({label:"Usar Formato",action:"useDocument"}),D.push({label:"Gestionar Membrete",action:"letterhead"}),c==="folder"&&D.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),D}},client:{getMenuOptions:(l,c)=>{const D=[];return l.state==="Completed"?D.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Editar Formulario",action:"editForm"},{label:"Editar Documento",action:"editDocument"}]}):D.push({label:"Completar",action:"editForm"}),l.state==="Completed"&&D.push({label:"Previsualizar",action:"preview"}),D.push({label:"Eliminar",action:"delete"}),D.push({label:"Gestionar Membrete",action:"letterhead"}),D.push({label:"Administrar Asociaciones",action:"relationships"}),l.state==="Completed"&&D.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar",action:"email"}),c==="folder"&&D.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),D}},lawyer:{getMenuOptions:(l,c)=>{const D=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"PrevisualizaciÃ³n",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}];return l.state==="Draft"?D.push({label:"Publicar",action:"publish",disabled:!_e(l)}):l.state==="Published"&&(D.push({label:"Mover a Borrador",action:"draft"}),D.push({label:"Formalizar y Agregar Firmas",action:"formalize"})),(l.state==="Completed"||l.state==="Published")&&D.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),l.requires_signature&&["PendingSignatures","FullySigned","Rejected","Expired"].includes(l.state)&&(D.push({label:"Ver Firmas",action:"viewSignatures"}),se(l)&&D.push({label:"Firmar documento",action:"sign"})),D}},signatures:{getMenuOptions:(l,c)=>{const D=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}];return l.requires_signature&&(l.state==="PendingSignatures"||l.state==="FullySigned")&&D.push({label:"Estado de las firmas",action:"viewSignatures"}),se(l)&&D.push({label:"Firmar documento",action:"sign"}),l.state==="FullySigned"&&D.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),l.state==="PendingSignatures"&&D.push({label:"Descargar PDF",action:"downloadPDF"}),c==="folder"&&D.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),D}}},R=N(()=>{if(n.menuOptions!==null)return n.menuOptions;if(n.showMenuOptions===!1)return[];if(n.showMenuOptions===!0){const c=E[n.cardType];return c?c.getMenuOptions(n.document,n.cardContext):[]}const l=E[n.cardType];return l?l.getMenuOptions(n.document,n.cardContext):[]}),j=N(()=>n.promptDocuments?"right-0 left-auto sm:right-auto sm:left-0 sm:-translate-x-[calc(100%-24px)]":"right-0 left-auto sm:left-0 sm:right-auto"),B=N(()=>!R.value||R.value.length===0?[]:oe(R.value)?R.value:Ws(R.value,n.document)),L=N(()=>{switch(n.document.state){case"Completed":case"Published":case"FullySigned":return"border-green-400 bg-green-50/50 shadow-green-100";case"Progress":case"Draft":return"border-blue-300 bg-blue-50/30 shadow-blue-100";case"PendingSignatures":return"border-yellow-400 bg-yellow-50/50 shadow-yellow-100";default:return"border-gray-200 bg-white"}}),de=N(()=>{if(!n.highlightedDocId||String(n.document.id)!==String(n.highlightedDocId))return"";const l=n.document.state;return l==="Published"||l==="FullySigned"||l==="Completed"?"shadow-lg animate-pulse-highlight-green":l==="PendingSignatures"?"shadow-lg animate-pulse-highlight-yellow":"shadow-lg animate-pulse-highlight-blue"}),X=N(()=>{if(n.statusIcon)return n.statusIcon;switch(n.document.state){case"Published":case"FullySigned":case"Completed":return Pe;case"Draft":case"Progress":case"PendingSignatures":default:return gt}}),re=N(()=>{if(n.statusText)return n.statusText;switch(n.document.state){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return"Desconocido"}}),ve=N(()=>{if(n.statusBadgeClasses)return n.statusBadgeClasses;switch(n.document.state){case"Published":case"FullySigned":case"Completed":return"bg-green-100 text-green-700 border border-green-200";case"Draft":case"Progress":return"bg-blue-100 text-blue-700 border border-blue-200";case"PendingSignatures":return"bg-yellow-100 text-yellow-700 border border-yellow-200";default:return"bg-gray-100 text-gray-700 border border-gray-200"}}),ge=async(l,c)=>{try{switch(l){case"edit":await ye(c);break;case"editForm":await xe(c);break;case"editDocument":await we(c);break;case"permissions":t("permissions",c);break;case"relationships":t("relationships",c);break;case"preview":await S(c);break;case"delete":await w(c);break;case"downloadPDF":await f(c);break;case"downloadWord":await P(c);break;case"email":t("email",c);break;case"copy":await W(c);break;case"publish":await V(c);break;case"draft":await m(c);break;case"formalize":await h(c);break;case"viewSignatures":t("signatures",c);break;case"sign":await d(c,t);break;case"downloadSignedDocument":await F(c);break;case"removeFromFolder":$("remove-from-folder",c);break;case"useDocument":$("click",c);break;case"use":$("menuAction",l,c);break;case"letterhead":t("letterhead",c);break;default:console.warn("Unknown action:",l)}}catch(D){console.error(`Error executing action ${l}:`,D)}},ye=async l=>{if(n.editRoute){const c=encodeURIComponent(l.title.trim()),D=n.editRoute.replace(":id",l.id).replace(":title",c);r.push(D)}else t("edit",l,{userRole:b()})},xe=async l=>{t("edit",l,{userRole:b()})},we=async l=>{r.push(`/dynamic_document_dashboard/client/editor/edit/${l.id}`)},oe=l=>l&&l.some(c=>c.children&&c.children.length>0),_e=l=>!l.variables||l.variables.length===0?!0:l.variables.every(c=>c.name_es&&c.name_es.trim().length>0),se=l=>{var z,Q;if(!l.requires_signature||l.state!=="PendingSignatures"||!l.signatures||l.signatures.length===0)return!1;const c=(Q=(z=n.userStore)==null?void 0:z.currentUser)==null?void 0:Q.email,D=l.signatures.find(ne=>ne.signer_email===c);return!(!D||D.signed)};return(l,c)=>{var D;return s(),u(K,null,[e("div",{"data-document-id":o.document.id,class:G(["relative bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 p-4 cursor-pointer focus:outline-none focus:ring-0",[L.value,de.value,o.additionalClasses]]),onClick:y},[e("div",qs,[e("div",Gs,[le(l.$slots,"status-badge",{},()=>[e("div",{class:G(["inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium",ve.value])},[(s(),A(Ze(X.value),{class:"w-3.5 h-3.5"})),e("span",null,k(re.value),1)],2)],!0),le(l.$slots,"additional-badges",{},void 0,!0)]),le(l.$slots,"right-action",{},()=>[i(Ls)(R.value)||oe(R.value)?(s(),A(As,{key:0,"menu-items":B.value,"menu-position":j.value,onMenuAction:c[0]||(c[0]=z=>ge(z,o.document))},null,8,["menu-items","menu-position"])):R.value&&R.value.length>0?(s(),A(i(He),{key:1,as:"div",class:"relative inline-block text-left menu-container"},{default:Z(()=>[M(i(Ge),{class:"flex items-center justify-center w-8 h-8 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors focus:outline-none focus:ring-0"},{default:Z(()=>[M(i(Xe),{class:"w-5 h-5","aria-hidden":"true"})]),_:1}),M(ke,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:Z(()=>[M(i(Ve),{class:G(["absolute z-50 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",j.value])},{default:Z(()=>[e("div",Vs,[(s(!0),u(K,null,te(R.value,z=>(s(),A(i(De),{key:z.label},{default:Z(()=>[e("button",{class:G(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":z.disabled,"cursor-pointer":!z.disabled}]),disabled:z.disabled,onClick:Q=>ge(z.action,o.document)},[z.disabled?(s(),A(i(Fe),{key:0,class:"size-5 text-gray-400 inline mr-2","aria-hidden":"true"})):I("",!0),T(" "+k(z.label),1)],10,Hs)]),_:2},1024))),128))])]),_:1},8,["class"])]),_:1})]),_:1})):I("",!0)],!0)]),e("div",Zs,[e("h3",Qs,k(o.document.title),1),o.document.description?(s(),u("p",Ys,k(o.document.description),1)):I("",!0),le(l.$slots,"additional-content",{},void 0,!0),o.showTags&&o.document.tags&&o.document.tags.length>0?(s(),u("div",Ks,[e("div",Xs,[Js,e("div",ea,[(s(!0),u(K,null,te(o.document.tags,z=>{var Q,ne;return s(),u("div",{key:z.id,class:"group relative"},[e("div",{class:"w-5 h-5 rounded-full cursor-pointer transition-all duration-200 hover:scale-110 hover:ring-2 hover:ring-offset-1 shadow-sm",style:st({backgroundColor:((Q=i(Re)(z.color_id))==null?void 0:Q.hex)||"#9CA3AF",boxShadow:`0 0 0 1px ${((ne=i(Re)(z.color_id))==null?void 0:ne.dark)||"#6B7280"}40`}),title:z.name},null,12,ta),e("div",sa,[e("div",aa,[T(k(z.name)+" ",1),ra])])])}),128))])])])):I("",!0)]),le(l.$slots,"footer",{},void 0,!0),le(l.$slots,"additional-actions",{},void 0,!0)],10,Ns),i(p).edit.isOpen?(s(),A(i(ha),{key:0,document:i(p).edit.document,"user-role":i(b)(),onClose:c[1]||(c[1]=z=>i(x)("edit"))},null,8,["document","user-role"])):I("",!0),i(p).email.isOpen?(s(),A(i(Ba),{key:1,document:i(p).email.document,onClose:c[2]||(c[2]=z=>i(x)("email"))},null,8,["document"])):I("",!0),i(p).signatures.isOpen?(s(),A(i(Or),{key:2,"document-id":(D=i(p).signatures.document)==null?void 0:D.id,onClose:c[3]||(c[3]=z=>i(x)("signatures")),onRefresh:a},null,8,["document-id"])):I("",!0),i(p).electronicSignature.isOpen?(s(),A(i(Rr),{key:3,onClose:c[4]||(c[4]=z=>i(x)("electronicSignature"))})):I("",!0),i(p).permissions.isOpen?(s(),A(i(Jr),{key:4,"is-open":i(p).permissions.isOpen,document:i(p).permissions.document,onClose:c[5]||(c[5]=z=>i(x)("permissions")),onSaved:a},null,8,["is-open","document"])):I("",!0),i(p).letterhead.isOpen?(s(),A(Ps,{key:5,"is-visible":i(p).letterhead.isOpen,document:i(p).letterhead.document,onClose:c[6]||(c[6]=z=>i(x)("letterhead")),onUploaded:a,onDeleted:a},null,8,["is-visible","document"])):I("",!0),i(p).relationships.isOpen?(s(),A(ct,{key:6,"is-open":i(p).relationships.isOpen,document:i(p).relationships.document,onClose:c[7]||(c[7]=z=>i(x)("relationships")),onRefresh:a},null,8,["is-open","document"])):I("",!0)],64)}}},xo=be(oa,[["__scopeId","data-v-a1d6dccd"]]),na={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},la={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},ia={class:"flex justify-end"},da=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[T(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),ca={class:"mt-2"},ua={class:"flex gap-2 mt-2.5"},ma=["disabled"],ga=e("span",null,"Actualizar nombre",-1),pa=[ga],fa=["disabled"],ha={__name:"EditDocumentModal",props:{document:{type:Object,required:!0},userRole:{type:String,default:"client"},showEditorButton:{type:Boolean,default:!0}},emits:["close"],setup(o,{emit:C}){const r=o,n=je(),$=he(),p=C,t=O(""),x=O(""),b=()=>{p("close")};at(()=>{var h,d;r.document?(t.value=((h=r.document)==null?void 0:h.title)||"",x.value=((d=r.document)==null?void 0:d.title)||""):(t.value="",x.value="")});const S=h=>{h.key==="Escape"&&b()};We(()=>{document.addEventListener("keydown",S)}),Le(()=>{document.removeEventListener("keydown",S)});const w=N(()=>t.value.trim().length>0),f=N(()=>{var h;return!!((h=r.document)!=null&&h.id)}),P=N(()=>f.value&&t.value.trim()!==x.value.trim()&&t.value.trim().length>0),W=N(()=>f.value?r.showEditorButton:!0);async function V(){if(f.value&&P.value)try{const h={title:t.value.trim()};await $.updateDocument(r.document.id,h),x.value=t.value.trim(),v("Nombre del documento actualizado exitosamente.","success"),b()}catch(h){console.error("Error updating document name:",h),v("Error al actualizar el nombre del documento.","error")}}function m(){var d;const h=encodeURIComponent(t.value.trim());(d=r.document)!=null&&d.id&&!f.value?r.userRole==="lawyer"?n.push(`/dynamic_document_dashboard/lawyer/editor/create/${h}`):n.push(`/dynamic_document_dashboard/document/use/creator/${r.document.id}/${h}`):f.value?r.userRole==="lawyer"?n.push(`/dynamic_document_dashboard/lawyer/editor/edit/${r.document.id}`):n.push(`/dynamic_document_dashboard/document/use/editor/${r.document.id}/${h}`):v("Error: No se pudo continuar. Documento no seleccionado.","error")}return(h,d)=>(s(),u("div",na,[e("div",la,[e("div",ia,[e("button",{onClick:b},[M(i(ie),{class:"size-6"})])]),e("form",{onSubmit:pe(m,["prevent"])},[e("div",null,[da,e("div",ca,[me(e("input",{"onUpdate:modelValue":d[0]||(d[0]=F=>t.value=F),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[ze,t.value]])])]),e("div",ua,[f.value?(s(),u("button",{key:0,type:"button",onClick:V,disabled:!P.value,class:G(["p-2.5 text-sm font-medium rounded-md flex gap-2",P.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},pa,10,ma)):I("",!0),W.value?(s(),u("button",{key:1,type:"submit",class:G(["p-2.5 text-sm font-medium rounded-md flex gap-2",w.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!w.value},[e("span",null,k(f.value?"Editar Documento":"Continuar"),1)],10,fa)):I("",!0)])],32)])]))}},ba={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},va={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},ya={class:"flex justify-end"},xa=e("label",{for:"email",class:"block text-base font-medium leading-6 text-primary"},[T(" Correo electrÃ³nico "),e("span",{class:"text-red-500"},"*")],-1),wa={class:"mt-2"},_a={class:"mt-4"},$a=e("label",{for:"files",class:"block text-base font-medium leading-6 text-primary"}," Anexos ",-1),ka={key:0,class:"text-center"},Da={class:"mt-4 flex text-sm/6 text-gray-600"},Ea={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"},Ca=e("span",null,"Sube un archivo",-1),Sa=e("p",{class:"pl-1"},"o arrastra y suelta",-1),Pa=e("p",{class:"text-xs/5 text-gray-600"}," PNG, JPG, PDF, DOCX de hasta 20MB ",-1),Ma={key:1,class:"w-full flex flex-wrap gap-3"},Fa=["onMouseenter","onMouseleave"],Oa=["onClick"],Ia={class:"text-center text-xs truncate w-20"},ja=["disabled"],za=e("span",null,"Enviar",-1),Ta=[za],Ra="dynamic-documents/send_email_with_attachments/",Ua=20*1024*1024,Ba={__name:"SendDocumentModal",props:{document:{type:Object,required:!0}},emits:["close"],setup(o,{emit:C}){const r=C,{sendEmail:n}=ft(),$=O(null),p=o,t=()=>{x.email="",b.value=[],$.value=null},x=rt({email:""}),b=O([]),S=y=>{const a=Array.from(y.target.files);f(a),y.target.value=null},w=y=>{const a=Array.from(y.dataTransfer.files);f(a)},f=y=>{let a=b.value.reduce((E,R)=>E+R.file.size,0);y.forEach(E=>{if(E.size>Ua){v(`The file "${E.name}" exceeds the 20 MB limit.`,"warning");return}const R=E.name.split(".").pop().toLowerCase();let j="",B={general:"",xMark:""};switch(R){case"png":case"jpg":case"jpeg":j=Ke,B.general="border-gray-200 text-gray-400",B.xMark="bg-gray-400";break;case"pdf":j=ce,B.general="border-red-600/20 text-red-600/60",B.xMark="bg-red-600/60";break;case"docx":j=ce,B.general="border-blue-600/20 text-blue-600/60",B.xMark="bg-blue-600/60";break;default:v("Unsupported file type. Only PDF, DOCX, JPG, and PNG are allowed.","warning");return}b.value.push({name:E.name,icon:j,style:B,hover:!1,file:E}),a+=E.size})},P=y=>{b.value.splice(y,1)},W=y=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y),V=N(()=>W(x.email)),m=N(()=>V.value),h=async y=>{try{const a=await Ee(`dynamic-documents/${y}/download-pdf/`,"blob");if(!a||!a.data)throw new Error("Invalid response from server");return new File([a.data],`document_${y}.pdf`,{type:"application/pdf"})}catch(a){return console.error("Error downloading PDF:",a),v("No se pudo descargar el documento PDF.","error"),null}};ue(()=>p.document,y=>{y&&Object.keys(y).length>0&&y.id&&h(y.id)},{immediate:!0});const d=async()=>{try{if(p.document.id){const a=await h(p.document.id);a&&b.value.push({name:a.name,file:a,icon:ce,style:{general:"border-blue-600/20 text-blue-600/60",xMark:"bg-blue-600/60"},hover:!1})}const y=b.value.map(a=>a.file);await n(Ra,x.email,p.document.title,"Attached is the requested document along with additional attachments.",y,{documentId:p.document.id})}catch(y){console.error("Error sending the email:",y)}finally{F()}},F=()=>{t(),r("close")};return(y,a)=>(s(),u("div",ba,[e("div",va,[e("div",ya,[e("button",{onClick:a[0]||(a[0]=E=>F())},[M(i(ie),{class:"size-6"})])]),e("form",{onSubmit:pe(d,["prevent"])},[e("div",null,[xa,e("div",wa,[me(e("input",{"onUpdate:modelValue":a[1]||(a[1]=E=>x.email=E),type:"text",name:"email",id:"email",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[ze,x.email]])])]),e("div",_a,[$a,e("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 bg-white px-6 py-10",onDragover:a[2]||(a[2]=pe(()=>{},["prevent"])),onDrop:pe(w,["prevent"])},[b.value.length<1?(s(),u("div",ka,[M(i(Me),{class:"mx-auto size-12 text-gray-300","aria-hidden":"true"}),e("div",Da,[e("label",Ea,[Ca,e("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",onChange:S},null,32)]),Sa]),Pa])):(s(),u("div",Ma,[(s(!0),u(K,null,te(b.value,(E,R)=>(s(),u("div",{key:R,class:G(["relative p-4 grid rounded-md bg-white border-2",E.style.general]),onMouseenter:j=>E.hover=!0,onMouseleave:j=>E.hover=!1},[me(e("div",{class:G(["absolute p-0.5 mt-2 ml-2 rounded-full",E.style.xMark]),onClick:j=>P(R)},[M(i(ie),{class:"size-3 text-white"})],10,Oa),[[Ne,E.hover]]),(s(),A(Ze(E.icon),{class:"size-12 mx-auto"})),e("span",Ia,k(E.name),1)],42,Fa))),128))]))],32)]),e("button",{type:"submit",class:G(["mt-4 p-2.5 text-sm font-medium rounded-md flex gap-2",m.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!m.value},Ta,10,ja)],32)])]))}},J=o=>(Oe("data-v-f12bccfe"),o=o(),Ie(),o),Aa={class:"fixed inset-0 z-50 flex items-center justify-center"},Wa={class:"relative bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col"},La=J(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Estado de firmas del documento",-1)),Na=J(()=>e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),qa=[Na],Ga={class:"p-6 overflow-y-auto flex-grow"},Va={key:0,class:"text-center py-10"},Ha=J(()=>e("div",{class:"spinner"},null,-1)),Za=J(()=>e("p",{class:"mt-4 text-gray-500"},"Cargando informaciÃ³n de firmas...",-1)),Qa=[Ha,Za],Ya={key:1},Ka={class:"mb-4"},Xa={class:"text-lg font-medium text-gray-900"},Ja={class:"text-sm text-gray-500"},er={class:"inline-flex items-center"},tr={key:0,class:"text-sm text-gray-500 mt-1"},sr={class:"text-sm text-gray-500 mt-1"},ar={class:"mt-6"},rr={class:"min-w-full divide-y divide-gray-200"},or=J(()=>e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Usuario"),e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado"),e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Fecha de firma")])],-1)),nr={class:"bg-white divide-y divide-gray-200"},lr={class:"px-4 py-4 whitespace-nowrap"},ir={class:"flex items-center"},dr={class:"text-sm font-medium text-gray-900 flex items-center"},cr={key:0,class:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full"},ur={class:"text-sm text-gray-500"},mr={class:"px-4 py-4 whitespace-nowrap"},gr={class:"px-4 py-4 whitespace-nowrap text-sm text-gray-500"},pr={class:"px-4 py-4 whitespace-nowrap"},fr={class:"flex items-center"},hr={class:"text-sm font-medium text-gray-900"},br={class:"text-sm text-gray-500"},vr={class:"px-4 py-4 whitespace-nowrap"},yr={class:"px-4 py-4 whitespace-nowrap text-sm text-gray-500"},xr={class:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-between items-center"},wr={class:"flex gap-3"},_r={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40"},$r={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4"},kr=J(()=>e("h2",{class:"text-sm font-semibold text-gray-900"},"Rechazar documento",-1)),Dr=J(()=>e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),Er=[Dr],Cr={class:"px-4 py-4 space-y-3 text-sm text-gray-700"},Sr={class:"font-semibold"},Pr=J(()=>e("p",{class:"text-xs text-gray-500"}," El rechazo devolverÃ¡ el documento al abogado creador para que pueda revisarlo, editarlo o archivarlo. ",-1)),Mr=J(()=>e("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Motivo del rechazo (opcional) ",-1)),Fr={__name:"DocumentSignaturesModal",props:{documentId:Number},emits:["close","refresh"],setup(o,{emit:C}){const r=o,n=C,$=he(),p=Qe(),t=O(null),x=O(!1),b=O(""),S=N(()=>{if(!t.value||!t.value.requires_signature||t.value.state!=="PendingSignatures"||!t.value.signers||t.value.signers.length===0)return!1;const d=t.value.signers.find(F=>F.is_current_user);return!(!d||d.signed)}),w=()=>{n("close")},f=d=>d?new Date(d).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"â€”",P=async()=>{if(!r.documentId){console.error("No document ID provided");return}try{const d=p.currentUser.id,F=await Ee(`dynamic-documents/user/${d}/pending-documents-full/`);if(F.status!==200)throw new Error(`Error loading documents: ${F.status}`);const y=F.data.find(a=>a.id===r.documentId);if(y)t.value=y;else{const a=await Ee(`dynamic-documents/${r.documentId}/`);if(a.status!==200)throw new Error(`Error loading document: ${a.status}`);t.value=a.data}}catch(d){console.error("Error loading document data:",d),d.response&&console.error("Error response data:",d.response.data),t.value=null,await v("Error al cargar la informaciÃ³n de firmas","error")}};ue(()=>r.documentId,d=>{d&&P()},{immediate:!0}),ue(()=>$.documents,()=>{r.documentId&&P()},{deep:!0});const W=async()=>{try{const d=p.currentUser.id;if(!p.currentUser.has_signature){await v("Para firmar documentos necesitas tener una firma registrada.","info"),await ee("Â¿Deseas crear una firma electrÃ³nica ahora?")?n("open-electronic-signature"):await v("Necesitas una firma para poder firmar documentos.","warning");return}if(!await ee(`Â¿EstÃ¡s seguro de que deseas firmar el documento "${t.value.title}"?`)){await v("OperaciÃ³n de firma cancelada","info");return}const y=`dynamic-documents/${t.value.id}/sign/${d}/`;await v("Procesando firma del documento...","info");const a=await fe(y,{});if(a.status===200||a.status===201){await v(`Â¡Documento "${t.value.title}" firmado correctamente!`,"success");try{await Ce(Se.FINISH,`Firmaste el documento "${t.value.title}"`)}catch(E){console.warn("No se pudo registrar la actividad de firma:",E)}await P(),n("refresh")}else throw new Error(`Unexpected server response: ${a.status} ${a.statusText}`)}catch(d){console.error("Error signing document:",d),await v(`Error al firmar el documento: ${d.message}`,"error")}},V=()=>{b.value="",x.value=!0},m=()=>{x.value=!1,b.value=""},h=async()=>{if(t.value)try{const d=p.currentUser.id,F=`dynamic-documents/${t.value.id}/reject/${d}/`,y=b.value?{comment:b.value}:{},a=await fe(F,y);if(a&&(a.status===200||a.status===201)){await v("Documento rechazado correctamente.","success");try{await Ce(Se.FINISH,`Rechazaste el documento "${t.value.title}"`)}catch(E){console.warn("No se pudo registrar la actividad de rechazo:",E)}m(),w(),n("refresh")}else await v("Error al rechazar el documento.","error")}catch(d){console.error("Error rejecting document:",d),await v("Error al rechazar el documento.","error")}};return(d,F)=>{var y;return s(),u("div",Aa,[e("div",{class:"absolute inset-0 bg-black opacity-50",onClick:w}),e("div",Wa,[e("div",{class:"px-6 py-4 border-b border-gray-200"},[La,e("button",{onClick:w,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},qa)]),e("div",Ga,[t.value?(s(),u("div",Ya,[e("div",Ka,[e("h3",Xa,k(t.value.title),1),e("p",Ja,[e("span",er,[e("span",{class:G(["inline-block w-3 h-3 rounded-full mr-2",t.value.fully_signed?"bg-green-500":"bg-yellow-500"])},null,2),T(" "+k(t.value.fully_signed?"Documento completamente firmado":"Pendiente de firmas"),1)])]),t.value.creator?(s(),u("p",tr," Creado por: "+k(t.value.creator.name)+" ("+k(t.value.creator.email)+") ",1)):I("",!0),e("p",sr," Firmas: "+k(t.value.completed_signatures||0)+"/"+k(t.value.total_signatures||0),1)]),e("div",ar,[e("table",rr,[or,e("tbody",nr,[(s(!0),u(K,null,te(t.value.signers||[],a=>(s(),u("tr",{key:"sig_"+a.signature_id,class:G({"bg-blue-50":a.is_current_user})},[e("td",lr,[e("div",ir,[e("div",null,[e("div",dr,[T(k(a.signer_name)+" ",1),a.is_current_user?(s(),u("span",cr,"TÃº")):I("",!0)]),e("div",ur,k(a.signer_email),1)])])]),e("td",mr,[e("span",{class:G(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",a.signed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},k(a.signed?"Firmado":"Pendiente"),3)]),e("td",gr,k(a.signed_at?f(a.signed_at):"â€”"),1)],2))),128)),!t.value.signers&&t.value.signatures?(s(!0),u(K,{key:0},te(t.value.signatures,a=>(s(),u("tr",{key:"old_"+a.id},[e("td",pr,[e("div",fr,[e("div",null,[e("div",hr,k(a.signer_name||a.signer_email),1),e("div",br,k(a.signer_email),1)])])]),e("td",vr,[e("span",{class:G(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",a.signed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},k(a.signed?"Firmado":"Pendiente"),3)]),e("td",yr,k(a.signed_at?f(a.signed_at):"â€”"),1)]))),128)):I("",!0)])])])])):(s(),u("div",Va,Qa))]),e("div",xr,[e("div",wr,[S.value?(s(),u("button",{key:0,onClick:W,class:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors"}," Firmar documento ")):I("",!0),S.value?(s(),u("button",{key:1,onClick:V,class:"px-4 py-2 bg-red-600 text-white hover:bg-red-700 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors"}," Rechazar documento ")):I("",!0)]),e("button",{onClick:w,class:"px-4 py-2 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400"}," Cerrar ")])]),x.value?(s(),u("div",_r,[e("div",$r,[e("div",{class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},[kr,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:m},Er)]),e("div",Cr,[e("p",null,[T(" EstÃ¡s a punto de rechazar el documento "),e("span",Sr,'"'+k((y=t.value)==null?void 0:y.title)+'"',1),T(". ")]),Pr,e("div",null,[Mr,me(e("textarea",{"onUpdate:modelValue":F[0]||(F[0]=a=>b.value=a),rows:"4",class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-secondary focus:border-transparent resize-none",placeholder:"Describe brevemente por quÃ© no estÃ¡s de acuerdo con el documento..."},null,512),[[ze,b.value]])])]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end gap-2 bg-gray-50"},[e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100",onClick:m}," Cancelar "),e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700",onClick:h}," Rechazar documento ")])])])):I("",!0)])}}},Or=be(Fr,[["__scopeId","data-v-f12bccfe"]]),Ir={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},jr={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-auto shadow-xl"},zr={class:"flex justify-between items-center mb-4"},Tr=e("h2",{class:"text-lg font-medium text-primary"},"Firma ElectrÃ³nica",-1),Rr={__name:"ElectronicSignatureModal",emits:["close"],setup(o,{emit:C}){const r=Qe(),n=C,$=()=>{n("close")},p=async t=>{r.currentUser&&(r.currentUser.has_signature=!0),v("Firma electrÃ³nica guardada correctamente","success"),setTimeout(()=>{$()},500)};return(t,x)=>(s(),u("div",Ir,[e("div",jr,[e("div",zr,[Tr,e("button",{onClick:$,class:"text-gray-400 hover:text-gray-500"},[M(i(ie),{class:"h-6 w-6"})])]),M(ot,{initialShowOptions:!0,"user-id":i(r).currentUser.id,onSignatureSaved:p,onCancel:$},null,8,["user-id"])])]))}},Ur={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Br={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0"},Ar={class:"inline-block w-full max-w-4xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl"},Wr={class:"flex items-center justify-between pb-4 mb-6 border-b border-gray-200"},Lr=e("h3",{class:"text-lg font-medium leading-6 text-gray-900"}," GestiÃ³n de Permisos ",-1),Nr={class:"mt-1 text-sm text-gray-500"},qr={key:0,class:"mb-6"},Gr={key:1,class:"p-4 mb-6 bg-red-50 border border-red-200 rounded-lg"},Vr=e("div",{class:"flex items-center"},[e("svg",{class:"w-5 h-5 text-red-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("p",{class:"text-red-700"},"No tienes permisos para gestionar los permisos de este documento.")],-1),Hr=[Vr],Zr={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},Qr=["disabled"],Yr={key:0,class:"flex items-center"},Kr=e("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},null,-1),Xr={key:1},Jr={__name:"DocumentPermissionsModal",props:{isOpen:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close","saved"],setup(o,{emit:C}){const r=o,n=C,$=he(),p=O(null),t=O(!1),{isLawyer:x}=nt(),b=N(()=>{var f;return x.value&&((f=r.document)==null?void 0:f.id)}),S=()=>{t.value||n("close")},w=async()=>{var P;if(!b.value||t.value)return;const f=(P=p.value)==null?void 0:P.getPermissionsData();if(!f){await v("Error al obtener los permisos actuales","error");return}t.value=!0;try{const W=r.document.id;await $.manageDocumentPermissions(W,f),await v("Permisos actualizados exitosamente","success"),n("saved",r.document),S()}catch(W){console.error("Error saving permissions:",W),await v("Error al guardar los permisos","error")}finally{t.value=!1}};return(f,P)=>(s(),A(qe,null,{default:Z(()=>{var W;return[o.isOpen?(s(),u("div",Ur,[e("div",Br,[e("div",{class:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:S}),e("div",Ar,[e("div",Wr,[e("div",null,[Lr,e("p",Nr,k(((W=o.document)==null?void 0:W.title)||"Documento"),1)]),e("button",{onClick:S,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors"},[M(i(ie),{class:"w-6 h-6"})])]),b.value?(s(),u("div",qr,[M(lt,{ref_key:"permissionsManagerRef",ref:p,document:o.document},null,8,["document"])])):(s(),u("div",Gr,Hr)),e("div",Zr,[e("button",{onClick:S,type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"},k(b.value?"Cancelar":"Cerrar"),1),b.value?(s(),u("button",{key:0,onClick:w,disabled:t.value,type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-secondary rounded-md hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[t.value?(s(),u("span",Yr,[Kr,T(" Guardando... ")])):(s(),u("span",Xr,"Guardar Permisos"))],8,Qr)):I("",!0)])])])])):I("",!0)]}),_:1}))}};function eo(o,C){const r=O({edit:{isOpen:!1,document:null},email:{isOpen:!1,document:null},preview:{isOpen:!1,document:null},signatures:{isOpen:!1,document:null},electronicSignature:{isOpen:!1,document:null},permissions:{isOpen:!1,document:null},letterhead:{isOpen:!1,document:null},relationships:{isOpen:!1,document:null}}),n=(x,b,S={})=>{switch(p(),x){case"edit":r.value.edit={isOpen:!0,document:b,...S};break;case"email":r.value.email={isOpen:!0,document:b};break;case"preview":Ye(b);break;case"signatures":r.value.signatures={isOpen:!0,document:b};break;case"electronic-signature":r.value.electronicSignature={isOpen:!0,document:b};break;case"permissions":r.value.permissions={isOpen:!0,document:b};break;case"letterhead":r.value.letterhead={isOpen:!0,document:b};break;case"relationships":r.value.relationships={isOpen:!0,document:b};break;default:console.warn(`Unknown modal type: ${x}`)}},$=x=>{r.value[x]&&(r.value[x]={isOpen:!1,document:null})},p=()=>{Object.keys(r.value).forEach(x=>{r.value[x]={isOpen:!1,document:null}})};return{activeModals:r,openModal:n,closeModal:$,closeAllModals:p,getUserRole:()=>{var x;return((x=C==null?void 0:C.currentUser)==null?void 0:x.role)||"client"}}}function to(o,C,r){const{registerView:n}=it(),$=je();return{handlePreviewDocument:async m=>{await n("document",m.id),Ye(m)},deleteDocument:async m=>{if(await ee(`Â¿EstÃ¡s seguro de que deseas eliminar el documento "${m.title}"?`)&&o)try{await o.deleteDocument(m.id),await v("Documento eliminado exitosamente","success"),r("refresh")}catch(d){throw await v("Error al eliminar el documento","error"),d}},downloadPDFDocument:async m=>{if(o)try{await o.downloadPDF(m.id,m.title),await v("PDF descargado exitosamente","success")}catch(h){throw await v("Error al descargar el PDF","error"),h}},downloadWordDocument:async m=>{if(o)try{await o.downloadWord(m.id,m.title),await v("Documento Word descargado exitosamente","success")}catch(h){throw await v("Error al descargar el documento Word","error"),h}},copyDocument:async m=>{var h;if(!o){await v("Funcionalidad de duplicar no implementada aÃºn","info");return}try{const d=new Date,F=String(d.getDate()).padStart(2,"0"),y=String(d.getMonth()+1).padStart(2,"0"),a=d.getFullYear(),E=`${F}${y}${a}`,R=`${m.title} ${E}`,j={title:R,content:m.content,state:"Draft",variables:((h=m.variables)==null?void 0:h.map(L=>({name_en:L.name_en,name_es:L.name_es,tooltip:L.tooltip,field_type:L.field_type,select_options:L.select_options,value:""})))||[],requires_signature:!1};if(!await ee(`Â¿Deseas crear una copia del documento '${m.title}'?`))return;await o.createDocument(j),await v(`Copia creada exitosamente: "${R}"`,"success"),r("refresh")}catch(d){console.error("Error creating document copy:",d),await v("Error al crear la copia del documento","error")}},publishDocument:async m=>{if(o)try{const h={...m,state:"Published",is_public:!0};await o.updateDocument(m.id,h),await v("Documento publicado exitosamente","success"),r("refresh")}catch(h){throw await v("Error al publicar el documento","error"),h}},moveToDraft:async m=>{if(o)try{const h={...m,state:"Draft"};await o.updateDocument(m.id,h),await v("Documento movido a borrador exitosamente","success"),r("refresh")}catch(h){throw await v("Error al mover el documento a borrador","error"),h}},formalizeDocument:async m=>{try{$.push(`/dynamic_document_dashboard/document/use/formalize/${m.id}/${m.title}`)}catch(h){console.error("Error al formalizar el documento:",h),await v("Error al formalizar el documento","error")}},signDocument:async(m,h)=>{var d,F;try{const y=C.currentUser.id,a=C.currentUser.email;if(!m.requires_signature){await v("Este documento no requiere firmas","error");return}const E=(d=m.signatures)==null?void 0:d.find(B=>B.signer_email===a);if(!E){await v("No estÃ¡s autorizado para firmar este documento","error");return}if(E.signed){await v("Ya has firmado este documento","info");return}if(!C.currentUser.has_signature){await v("Para firmar documentos necesitas tener una firma registrada.","info"),await ee("Â¿Deseas crear una firma electrÃ³nica ahora?")?r("open-electronic-signature"):await v("Necesitas una firma para poder firmar documentos.","warning");return}if(!await ee(`Â¿EstÃ¡s seguro de que deseas firmar el documento "${m.title}"?`)){await v("OperaciÃ³n de firma cancelada","info");return}const j=`dynamic-documents/${m.id}/sign/${y}/`;try{await v("Procesando firma del documento...","info");const B=await fe(j,{});if(B.status===200||B.status===201){await o.init(!0);const L=((F=o.documents)==null?void 0:F.find(X=>X.id===m.id))||m;await v(`Â¡Documento "${L.title}" firmado correctamente!`,"success");try{await Ce(Se.FINISH,`Firmaste el documento "${L.title}"`)}catch(X){console.warn("No se pudo registrar la actividad de firma:",X)}Array.isArray(L.signatures)&&L.signatures.length>0&&L.signatures.every(X=>X.signed)?(await v(`El documento "${L.title}" ha sido firmado por todas las partes`,"success"),r("document-fully-signed",L),setTimeout(()=>{r("refresh"),setTimeout(()=>{h("signatures",L)},1500)},500)):(r("refresh"),setTimeout(()=>{h("signatures",L)},1e3))}else throw new Error(`Unexpected server response: ${B.status} ${B.statusText}`)}catch(B){throw console.error("Error in HTTP request:",B),B}}catch(y){console.error("General error signing document:",y),await v(`Error al firmar el documento: ${y.message}`,"error")}},downloadSignedDocument:async m=>{try{if(m.state!=="FullySigned"){v("El documento debe estar completamente firmado para descargarlo","warning");return}if(!m.signatures||m.signatures.length===0){v("El documento no tiene firmas registradas","warning");return}const h=`dynamic-documents/${m.id}/generate-signatures-pdf/`;await dt(h,`firmas_${m.title}.pdf`)}catch(h){console.error("Error downloading signed document:",h),v("Error al descargar el documento firmado","error")}}}}export{xo as B,Or as D,Ps as L,ha as _,eo as a,to as b,Ba as c,Jr as d,Fe as r,ee as s,ft as u};
