import{e as a,f as l,g as e,r as I,s as $,E as De,w as ee,Q as Ce,k as T,i as G,t as y,h as S,j as c,G as K,a2 as Ee,c as N,v as be,F as H,N as W,n as q,a1 as Ae,p as U,l as j,O as ue,P as me,D as oe,a0 as Xe,T as re,o as Se,a5 as Pe,al as Ye,ar as Le,ah as Ke,ad as ze,b7 as we,ae as Te,af as $e,ag as Be,u as Me,a9 as ae,ac as et,aJ as tt,m as fe,b as st,I as Ue,ba as at}from"./index.js";import{g as Oe,u as ot,_ as nt}from"./DocumentPermissionsManager.js";import{useRecentViews as rt}from"./useRecentViews.js";import{u as ye,o as qe,d as lt}from"./index2.js";import{_ as le}from"./_plugin-vue_export-helper.js";import{r as Ne}from"./MagnifyingGlassIcon.js";import{r as ne}from"./DocumentIcon.js";import{r as Fe}from"./LinkIcon.js";import{r as Ve}from"./TrashIcon.js";import{r as Ge}from"./PhotoIcon.js";import{r as je}from"./InformationCircleIcon.js";import{r as He}from"./CheckCircleIcon.js";import{r as We}from"./CloudArrowUpIcon.js";import{r as it}from"./ExclamationTriangleIcon.js";import{r as Qe}from"./EllipsisVerticalIcon.js";import{r as ct}from"./ChevronRightIcon.js";import{r as dt}from"./PencilIcon.js";import{s as ut,h as Ie}from"./loading_message.js";function Ze(t,u){return a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"})])}function ke(t,u){return a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"})])}function mt(){const t=I(!1),u=I("");async function o(i,f,d="",r="",h=[],x={}){if(!f)throw u.value="Recipient email is required.",await $(u.value,"error"),new Error(u.value);const k=new FormData;k.append("to_email",f),k.append("subject",d),k.append("body",r),h.forEach((p,g)=>{k.append(`attachments[${g}]`,p)});for(const[p,g]of Object.entries(x))k.append(p,g);try{t.value=!0,u.value="",ut("Sending email...","Please wait while we send the email.");const p=await De(i,k);return Ie(),await $("Email sent successfully.","success"),p.data}catch(p){throw Ie(),console.error("Error sending email:",p.message),u.value="An error occurred while sending the email. Please try again.",await $(u.value,"error"),p}finally{t.value=!1}}return{sendEmail:o,isLoading:t,errorMessage:u}}const gt={class:"bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full overflow-auto max-h-[80vh]"},pt={class:"flex justify-between items-center mb-4"},ht={class:"text-lg font-bold"},ft=["innerHTML"],Sr={__name:"DocumentPreviewModal",props:{isVisible:Boolean,documentData:{type:Object,default:()=>({title:"",content:""})}},emits:["close"],setup(t,{emit:u}){const o=u,i=()=>{o("close")};return(f,d)=>ee((a(),T(Ee,null,{default:G(()=>[e("div",gt,[e("div",pt,[e("h2",ht," PrevisualizaciÃ³n del Documento: "+y(t.documentData.title),1),e("button",{onClick:i},[S(c(K),{class:"size-6 text-gray-500 hover:text-gray-700"})])]),e("div",{class:"prose max-w-none",innerHTML:t.documentData.content},null,8,ft)])]),_:1},512)),[[Ce,t.isVisible]])}},ge=t=>(ue("data-v-dc50dff1"),t=t(),me(),t),bt={class:"space-y-6"},yt=ge(()=>e("h4",{class:"text-lg font-semibold text-gray-900"},"Relacionar Documentos JurÃ­dicos",-1)),vt={class:"text-sm text-gray-600 mt-1"},xt=ge(()=>e("p",{class:"text-xs text-blue-600 mt-1"}," Solo se muestran documentos completados que te pertenecen ",-1)),_t={class:"bg-gray-50 p-4 rounded-lg"},wt={class:"relative"},$t={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},kt={key:0,class:"flex items-center justify-center py-12"},Dt=ge(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),Ct=ge(()=>e("span",{class:"ml-3 text-gray-600"},"Cargando documentos disponibles...",-1)),Et=[Dt,Ct],St={key:1,class:"text-center py-12"},Pt={class:"mt-2 text-sm font-medium text-gray-900"},Mt={class:"mt-1 text-sm text-gray-500"},Ft={key:2,class:"space-y-4"},Rt={class:"grid grid-cols-1 gap-4"},Ot={class:"flex items-start justify-between"},jt={class:"flex-1 min-w-0"},It={class:"flex items-center space-x-3"},At={class:"flex-shrink-0"},Lt={class:"flex-1 min-w-0"},zt={class:"text-sm font-medium text-gray-900 truncate"},Tt={class:"mt-1 flex items-center space-x-4 text-xs text-gray-500"},Bt={class:"inline-flex items-center"},Ut={key:0},qt={key:0,class:"mt-3 text-sm text-gray-600 line-clamp-2"},Nt={key:1,class:"mt-3 flex flex-wrap gap-1"},Vt={class:"flex-shrink-0 ml-4"},Gt=["onClick","disabled"],Ht={key:1,class:"w-4 h-4 mr-2 animate-spin rounded-full border-2 border-white border-t-transparent"},Wt={key:0,class:"flex justify-center mt-6"},Qt=ge(()=>e("nav",{class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px"},null,-1)),Zt=[Qt],Jt={__name:"RelateDocumentsTab",props:{document:{type:Object,required:!0},availableDocuments:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["relate-document"],setup(t,{emit:u}){const o=t,i=u,f=I(""),d=I(!1),r=N(()=>{if(!o.availableDocuments)return[];let w=o.availableDocuments;if(f.value.trim()){const _=f.value.toLowerCase();w=w.filter(s=>{var n,D;return((n=s.title)==null?void 0:n.toLowerCase().includes(_))||((D=s.content)==null?void 0:D.toLowerCase().includes(_))})}return w}),h=async w=>{d.value=!0;try{await i("relate-document",w,"related")}finally{d.value=!1}},x=w=>({Draft:"bg-gray-500",Published:"bg-green-500",Progress:"bg-blue-500",Completed:"bg-purple-500",FullySigned:"bg-emerald-500",PendingSignatures:"bg-yellow-500"})[w]||"bg-gray-500",k=w=>({Draft:"bg-gray-400",Published:"bg-green-400",Progress:"bg-blue-400",Completed:"bg-purple-400",FullySigned:"bg-emerald-400",PendingSignatures:"bg-yellow-400"})[w]||"bg-gray-400",p=w=>({Draft:"Borrador",Published:"Publicado",Progress:"En Progreso",Completed:"Completado",FullySigned:"Firmado",PendingSignatures:"Pendiente de Firma"})[w]||w,g=w=>{if(!w)return"";try{return new Date(w).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}catch{return w}},b=w=>{if(!w)return"";const _=document.createElement("div");return _.innerHTML=w,_.textContent||_.innerText||""};return(w,_)=>(a(),l("div",bt,[e("div",null,[yt,e("p",vt,' Selecciona documentos para asociar con "'+y(t.document.title)+'" ',1),xt]),e("div",_t,[e("div",wt,[e("div",$t,[S(c(Ne),{class:"h-5 w-5 text-gray-400"})]),ee(e("input",{id:"search","onUpdate:modelValue":_[0]||(_[0]=s=>f.value=s),type:"text",placeholder:"Buscar por tÃ­tulo...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md text-sm placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[be,f.value]])])]),t.isLoading?(a(),l("div",kt,Et)):r.value.length===0?(a(),l("div",St,[S(c(ne),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",Pt,y(t.availableDocuments.length===0?"No hay documentos disponibles":"No se encontraron documentos"),1),e("p",Mt,y(t.availableDocuments.length===0?"No tienes otros documentos completados disponibles para relacionar, o todos ya estÃ¡n relacionados con este documento.":"Intenta ajustar tu bÃºsqueda para encontrar documentos."),1)])):(a(),l("div",Ft,[e("div",Rt,[(a(!0),l(H,null,W(r.value,s=>(a(),l("div",{key:s.id,class:"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors"},[e("div",Ot,[e("div",jt,[e("div",It,[e("div",At,[e("div",{class:q(["w-10 h-10 rounded-lg flex items-center justify-center",x(s.state)])},[S(c(Ae),{class:"w-5 h-5 text-white"})],2)]),e("div",Lt,[e("h5",zt,y(s.title),1),e("div",Tt,[e("span",Bt,[e("span",{class:q(["w-2 h-2 rounded-full mr-1.5",k(s.state)])},null,2),U(" "+y(p(s.state)),1)]),s.created_at?(a(),l("span",Ut,y(g(s.created_at)),1)):j("",!0)])])]),s.content?(a(),l("div",qt,y(b(s.content)),1)):j("",!0),s.tags&&s.tags.length>0?(a(),l("div",Nt,[(a(!0),l(H,null,W(s.tags,n=>(a(),l("span",{key:n.id,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800"},y(n.name),1))),128))])):j("",!0)]),e("div",Vt,[e("button",{onClick:n=>h(s),disabled:d.value,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[d.value?(a(),l("div",Ht)):(a(),T(c(Fe),{key:0,class:"w-4 h-4 mr-2"})),U(" "+y(d.value?"Relacionando...":"Relacionar"),1)],8,Gt)])])]))),128))]),r.value.length>=10?(a(),l("div",Wt,Zt)):j("",!0)]))]))}},Xt=le(Jt,[["__scopeId","data-v-dc50dff1"]]),ve=t=>(ue("data-v-f2ecbaa3"),t=t(),me(),t),Yt={class:"space-y-6"},Kt=ve(()=>e("h4",{class:"text-lg font-semibold text-gray-900"},"Documentos Relacionados",-1)),es={class:"text-sm text-gray-600 mt-1"},ts=ve(()=>e("p",{class:"text-xs text-blue-600 mt-1"}," Solo se muestran documentos completados que te pertenecen ",-1)),ss={class:"bg-gray-50 p-4 rounded-lg"},as={class:"relative"},os={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},ns={key:0,class:"flex items-center justify-center py-12"},rs=ve(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),ls=ve(()=>e("span",{class:"ml-3 text-gray-600"},"Cargando documentos relacionados...",-1)),is=[rs,ls],cs={key:1,class:"text-center py-12"},ds={class:"mt-2 text-sm font-medium text-gray-900"},us={class:"mt-1 text-sm text-gray-500"},ms={key:2,class:"space-y-4"},gs={class:"grid grid-cols-1 gap-4"},ps={class:"flex items-start justify-between"},hs={class:"flex-1 min-w-0"},fs={class:"flex items-center space-x-3"},bs={class:"flex-shrink-0"},ys={class:"flex-1 min-w-0"},vs={class:"text-sm font-medium text-gray-900 truncate"},xs={class:"mt-1 flex items-center space-x-4 text-xs text-gray-500"},_s={class:"inline-flex items-center"},ws={key:0},$s={class:"mt-3"},ks={class:"flex items-center space-x-2"},Ds={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Cs={key:0,class:"mt-2 text-xs text-gray-500"},Es={key:0,class:"mt-3 text-sm text-gray-600 line-clamp-2"},Ss={key:1,class:"mt-3 flex flex-wrap gap-1"},Ps={class:"flex-shrink-0 ml-4"},Ms=["onClick","disabled"],Fs={key:1,class:"w-4 h-4 mr-2 animate-spin rounded-full border-2 border-red-600 border-t-transparent"},Rs={__name:"RelatedDocumentsTab",props:{document:{type:Object,required:!0},relatedDocuments:{type:Array,default:()=>[]},relationships:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["unrelate-document"],setup(t,{emit:u}){const o=t,i=u,f=I(""),d=I(!1),r=N(()=>{if(!o.relatedDocuments)return[];let _=o.relatedDocuments;if(f.value.trim()){const s=f.value.toLowerCase();_=_.filter(n=>{var D,A;return((D=n.title)==null?void 0:D.toLowerCase().includes(s))||((A=n.content)==null?void 0:A.toLowerCase().includes(s))})}return _}),h=_=>{const s=o.relationships.find(n=>n.source_document===_||n.target_document===_);return s?{id:s.id,created_by:s.created_by_name,created_at:s.created_at}:null},x=async _=>{const s=h(_.id);if(s){d.value=!0;try{await i("unrelate-document",s.id)}finally{d.value=!1}}},k=_=>({Draft:"bg-gray-500",Published:"bg-green-500",Progress:"bg-blue-500",Completed:"bg-purple-500",FullySigned:"bg-emerald-500",PendingSignatures:"bg-yellow-500"})[_]||"bg-gray-500",p=_=>({Draft:"bg-gray-400",Published:"bg-green-400",Progress:"bg-blue-400",Completed:"bg-purple-400",FullySigned:"bg-emerald-400",PendingSignatures:"bg-yellow-400"})[_]||"bg-gray-400",g=_=>({Draft:"Borrador",Published:"Publicado",Progress:"En Progreso",Completed:"Completado",FullySigned:"Firmado",PendingSignatures:"Pendiente de Firma"})[_]||_,b=_=>{if(!_)return"";try{return new Date(_).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}catch{return _}},w=_=>{if(!_)return"";const s=document.createElement("div");return s.innerHTML=_,s.textContent||s.innerText||""};return(_,s)=>(a(),l("div",Yt,[e("div",null,[Kt,e("p",es,' Documentos asociados con "'+y(t.document.title)+'" ',1),ts]),e("div",ss,[e("div",as,[e("div",os,[S(c(Ne),{class:"h-5 w-5 text-gray-400"})]),ee(e("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>f.value=n),type:"text",placeholder:"Buscar en documentos relacionados...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md text-sm placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[be,f.value]])])]),t.isLoading?(a(),l("div",ns,is)):r.value.length===0?(a(),l("div",cs,[S(c(Ze),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",ds,y(t.relatedDocuments.length===0?"No hay documentos relacionados":"No se encontraron documentos"),1),e("p",us,y(t.relatedDocuments.length===0?'Este documento aÃºn no tiene documentos relacionados. Utiliza la pestaÃ±a "Relacionar Documentos" para crear asociaciones.':"Intenta ajustar tu bÃºsqueda para encontrar documentos relacionados."),1)])):(a(),l("div",ms,[e("div",gs,[(a(!0),l(H,null,W(r.value,n=>{var D;return a(),l("div",{key:n.id,class:"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors"},[e("div",ps,[e("div",hs,[e("div",fs,[e("div",bs,[e("div",{class:q(["w-10 h-10 rounded-lg flex items-center justify-center",k(n.state)])},[S(c(Ae),{class:"w-5 h-5 text-white"})],2)]),e("div",ys,[e("h5",vs,y(n.title),1),e("div",xs,[e("span",_s,[e("span",{class:q(["w-2 h-2 rounded-full mr-1.5",p(n.state)])},null,2),U(" "+y(g(n.state)),1)]),n.created_at?(a(),l("span",ws,y(b(n.created_at)),1)):j("",!0)])])]),e("div",$s,[e("div",ks,[e("span",Ds,[S(c(Fe),{class:"w-3 h-3 mr-1"}),U(" Relacionado ")])]),(D=h(n.id))!=null&&D.created_by?(a(),l("div",Cs," Relacionado por "+y(h(n.id).created_by)+" el "+y(b(h(n.id).created_at)),1)):j("",!0)]),n.content?(a(),l("div",Es,y(w(n.content)),1)):j("",!0),n.tags&&n.tags.length>0?(a(),l("div",Ss,[(a(!0),l(H,null,W(n.tags,A=>(a(),l("span",{key:A.id,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800"},y(A.name),1))),128))])):j("",!0)]),e("div",Ps,[e("button",{onClick:A=>x(n),disabled:d.value,class:"inline-flex items-center justify-center px-3 py-2 border border-red-300 shadow-sm text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 disabled:opacity-50 transition-colors"},[d.value?(a(),l("div",Fs)):(a(),T(c(Ve),{key:0,class:"w-4 h-4 mr-2"})),U(" "+y(d.value?"Eliminando...":"Desrelacionar"),1)],8,Ms)])])])}),128))])]))]))}},Os=le(Rs,[["__scopeId","data-v-f2ecbaa3"]]),ce={async getDocumentRelationships(t){try{return(await oe(`dynamic-documents/${t}/relationships/`)).data||[]}catch(u){throw console.error("Error fetching document relationships:",u),u}},async getRelatedDocuments(t){try{return(await oe(`dynamic-documents/${t}/related-documents/`)).data||[]}catch(u){throw console.error("Error fetching related documents:",u),u}},async getAvailableDocumentsForRelationship(t){try{return(await oe(`dynamic-documents/${t}/available-for-relationship/`)).data||[]}catch(u){throw console.error("Error fetching available documents:",u),u}},async createDocumentRelationship(t){try{return(await De("dynamic-documents/relationships/create/",t)).data}catch(u){throw console.error("Error creating document relationship:",u),u}},async deleteDocumentRelationship(t){try{const u=await Xe(`dynamic-documents/relationships/${t}/delete/`);return u.status===200||u.status===204}catch(u){throw console.error("Error deleting document relationship:",u),u}}};function js(t){const u=I([]),o=I([]),i=I([]),f=I(!1),d=I(!1),r=I(!1),h=I(!1),x=async()=>{if(t){d.value=!0;try{u.value=await ce.getAvailableDocumentsForRelationship(t)}catch(n){throw console.error("Error loading available documents:",n),u.value=[],n}finally{d.value=!1}}},k=async()=>{if(t){r.value=!0;try{o.value=await ce.getRelatedDocuments(t)}catch(n){throw console.error("Error loading related documents:",n),o.value=[],n}finally{r.value=!1}}},p=async()=>{if(t){h.value=!0;try{i.value=await ce.getDocumentRelationships(t)}catch(n){throw console.error("Error loading relationships:",n),i.value=[],n}finally{h.value=!1}}},g=async n=>{f.value=!0;try{return await ce.createDocumentRelationship(n)}catch(D){throw console.error("Error creating relationship:",D),D}finally{f.value=!1}},b=async n=>{f.value=!0;try{return await ce.deleteDocumentRelationship(n)}catch(D){throw console.error("Error deleting relationship:",D),D}finally{f.value=!1}},w=(n,D)=>i.value.find(A=>A.source_document===n&&A.target_document===D||A.source_document===D&&A.target_document===n);return{availableDocuments:u,relatedDocuments:o,relationships:i,isLoading:f,isLoadingAvailable:d,isLoadingRelated:r,isLoadingRelationships:h,loadAvailableDocuments:x,loadRelatedDocuments:k,loadRelationships:p,loadAllData:async()=>{await Promise.all([x(),k(),p()])},createRelationship:g,deleteRelationship:b,findRelationship:w,areDocumentsRelated:(n,D)=>!!w(n,D)}}const Is={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center"},As={class:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden"},Ls={class:"bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4"},zs={class:"flex items-center justify-between"},Ts={class:"flex items-center space-x-3"},Bs={class:"p-2 bg-white bg-opacity-20 rounded-lg"},Us=e("h3",{class:"text-lg font-semibold text-white"}," Administrar Asociaciones de Documentos ",-1),qs={class:"text-blue-100 text-sm"},Ns=e("p",{class:"text-blue-200 text-xs mt-1"}," Solo documentos completados de tu propiedad ",-1),Vs={class:"border-b border-gray-200 bg-gray-50"},Gs={class:"flex"},Hs=["onClick"],Ws={class:"flex items-center space-x-2"},Qs={class:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]"},Zs={key:0,class:"flex items-center justify-center py-12"},Js=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),Xs=e("span",{class:"ml-3 text-gray-600"},"Cargando...",-1),Ys=[Js,Xs],Ks={key:1,class:"space-y-6"},ea={key:2,class:"space-y-6"},ta={__name:"DocumentRelationshipsModal",props:{isOpen:{type:Boolean,default:!1},document:{type:Object,required:!0}},emits:["close","refresh"],setup(t,{emit:u}){var O;const o=t,i=u,{availableDocuments:f,relatedDocuments:d,relationships:r,isLoading:h,isLoadingAvailable:x,isLoadingRelated:k,loadAvailableDocuments:p,loadRelatedDocuments:g,loadRelationships:b,createRelationship:w,deleteRelationship:_}=js((O=o.document)==null?void 0:O.id),s=I("relate"),n=N(()=>{var P,L;return[{id:"relate",label:"Relacionar Documentos",icon:Fe,count:(P=f.value)==null?void 0:P.length},{id:"related",label:"Documentos Relacionados",icon:Ze,count:(L=d.value)==null?void 0:L.length}]}),D=()=>{i("close")},A=async()=>{var P;if((P=o.document)!=null&&P.id)try{await Promise.all([p(),g(),b()])}catch(L){console.error("Error loading data:",L),await $("Error al cargar los datos","error")}},F=async P=>{try{await w({source_document:o.document.id,target_document:P.id}),await $("Documentos relacionados exitosamente","success"),await A(),i("refresh")}catch(L){console.error("Error relating document:",L),await $("Error al relacionar los documentos","error")}},E=async P=>{try{await _(P),await $("RelaciÃ³n eliminada exitosamente","success"),await A(),i("refresh")}catch(L){console.error("Error unrelating document:",L),await $("Error al eliminar la relaciÃ³n","error")}};return re(()=>o.isOpen,P=>{var L;P&&((L=o.document)!=null&&L.id)&&(s.value="relate",A())}),Se(()=>{var P;o.isOpen&&((P=o.document)!=null&&P.id)&&A()}),(P,L)=>t.isOpen?(a(),l("div",Is,[e("div",As,[e("div",Ls,[e("div",zs,[e("div",Ts,[e("div",Bs,[S(c(ne),{class:"w-6 h-6 text-white"})]),e("div",null,[Us,e("p",qs,y(t.document.title),1),Ns])]),e("button",{onClick:D,class:"text-white hover:text-blue-200 transition-colors p-2 hover:bg-white hover:bg-opacity-10 rounded-lg"},[S(c(K),{class:"w-6 h-6"})])])]),e("div",Vs,[e("nav",Gs,[(a(!0),l(H,null,W(n.value,B=>(a(),l("button",{key:B.id,onClick:Q=>s.value=B.id,class:q(["py-3 px-6 text-sm font-medium border-b-2 transition-colors",s.value===B.id?"border-blue-500 text-blue-600 bg-white":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},[e("div",Ws,[(a(),T(Pe(B.icon),{class:"w-4 h-4"})),e("span",null,y(B.label),1),B.count!==void 0?(a(),l("span",{key:0,class:q(["px-2 py-0.5 rounded-full text-xs",s.value===B.id?"bg-blue-100 text-blue-600":"bg-gray-200 text-gray-600"])},y(B.count),3)):j("",!0)])],10,Hs))),128))])]),e("div",Qs,[c(h)?(a(),l("div",Zs,Ys)):s.value==="relate"?(a(),l("div",Ks,[S(Xt,{document:t.document,"available-documents":c(f),"is-loading":c(x),onRelateDocument:F,onRefresh:A},null,8,["document","available-documents","is-loading"])])):s.value==="related"?(a(),l("div",ea,[S(Os,{document:t.document,"related-documents":c(d),relationships:c(r),"is-loading":c(k),onUnrelateDocument:E,onRefresh:A},null,8,["document","related-documents","relationships","is-loading"])])):j("",!0)]),e("div",{class:"bg-gray-50 px-6 py-4 border-t border-gray-200"},[e("div",{class:"flex justify-end space-x-3"},[e("button",{onClick:D,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"}," Cerrar ")])])])])):j("",!0)}};function de(t){return Ye.fire({title:t,icon:"question",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",buttonsStyling:!1}).then(u=>u.isConfirmed)}const J=t=>(ue("data-v-e55f9aeb"),t=t(),me(),t),sa={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},aa={class:"px-6 py-4 border-b border-gray-200"},oa=J(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"GestiÃ³n de Membrete",-1)),na={class:"text-sm text-gray-500 mt-1"},ra={class:"p-6 overflow-y-auto flex-grow"},la={key:0,class:"text-center py-10"},ia=J(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),ca={class:"mt-4 text-gray-500"},da={key:1,class:"space-y-6"},ua={key:0,class:"space-y-4"},ma=J(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete Actual",-1)),ga={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},pa=["src"],ha={class:"mt-4 flex justify-center space-x-3"},fa=["disabled"],ba={key:1,class:"text-center py-8"},ya=J(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete",-1)),va=J(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," Este documento no tiene una imagen de membrete configurada. ",-1)),xa={class:"space-y-4"},_a={class:"text-lg font-medium text-gray-900"},wa={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},$a={key:0},ka={class:"mt-4"},Da=J(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, mÃ¡ximo 10MB ",-1)),Ca=J(()=>e("p",{class:"text-xs text-gray-400 mt-1"}," Dimensiones ideales: 612 Ã— 612 pÃ­xeles (8.5:11 Carta) ",-1)),Ea={key:1,class:"space-y-4"},Sa={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Pa={class:"text-gray-400"},Ma={key:0,class:"mt-4"},Fa=["src"],Ra={class:"flex justify-center space-x-3"},Oa=["disabled"],ja={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Ia={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},Aa={class:"flex items-center space-x-2"},La=J(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete",-1)),za=J(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"ðŸ“ Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"612 pÃ­xeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"612 pÃ­xeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"ProporciÃ³n:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"Â±10%")])])])],-1)),Ta=J(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"ðŸŽ¨ DistribuciÃ³n Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"âš ï¸ ZONA CRÃTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"MantÃ©n semi-transparente. El texto del documento se superpone aquÃ­.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, telÃ©fonos, emails, informaciÃ³n de contacto.")])])])])])],-1)),Ba=J(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"ðŸ”§ Consideraciones TÃ©cnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"â€¢"),e("span",null,[e("strong",null,"Posicionamiento:"),U(" La imagen se centra automÃ¡ticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"â€¢"),e("span",null,[e("strong",null,"Transparencia:"),U(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"â€¢"),e("span",null,[e("strong",null,"MÃ¡rgenes:"),U(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"â€¢"),e("span",null,[e("strong",null,"ResoluciÃ³n:"),U(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"âš ï¸"),e("span",null,[e("strong",null,"Zona crÃ­tica:"),U(" Evita elementos grÃ¡ficos densos en el centro (300-400px de altura)")])])])])],-1)),Ua=J(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"ðŸ’¡ Tips de DiseÃ±o RÃ¡pido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"â€¢ Si solo tienes header, ubÃ­calo en los primeros 120-150px"),e("div",null,"â€¢ El resto de la imagen debe ser transparente o blanco"),e("div",null,"â€¢ Para footer, usa los Ãºltimos 80-120px"),e("div",null,"â€¢ El texto se superpone en toda la imagen, mantÃ©n el centro claro")])],-1)),qa={key:3,class:"space-y-2"},Na={class:"flex"},Va={class:"text-sm text-yellow-700"},Ga={__name:"LetterheadModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close","uploaded","deleted"],setup(t,{emit:u}){const o=t,i=u,f=ye(),d=I(!1),r=I(""),h=I(!1),x=I(!1),k=I(null),p=I(null),g=I(null),b=I([]),w=I(null),_=I(!1),s=N(()=>{var C;return(C=o.document)==null?void 0:C.id}),n=()=>{F(),i("close")},D=C=>{const R=C.target.files[0];if(!R)return;if(!R.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(R.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}k.value=R,b.value=[];const X=new FileReader;X.onload=Z=>{p.value=Z.target.result;const Y=new Image;Y.onload=()=>{A(Y.width,Y.height)},Y.src=Z.target.result},X.readAsDataURL(R)},A=(C,R)=>{const ie=C/R,te=612/612,_e=Math.abs(ie-te)/te;if(C===612&&R===612){b.value.push("âœ… Dimensiones perfectas: 612 Ã— 612 pÃ­xeles");return}_e<=.1?(b.value.push(`â„¹ï¸ Buenas proporciones detectadas: ${C} Ã— ${R} pÃ­xeles (${ie.toFixed(3)})`),(C!==612||R!==612)&&b.value.push("ðŸ’¡ Para mejores resultados, usa exactamente 612 Ã— 612 pÃ­xeles")):(b.value.push(`âš ï¸ Proporciones no ideales: ${C} Ã— ${R} pÃ­xeles (${ie.toFixed(3)})`),b.value.push(`ðŸŽ¯ Proporciones recomendadas: ${te.toFixed(3)} (8.5:11)`),b.value.push("ðŸ“ Considera redimensionar tu imagen a 612 Ã— 612 pÃ­xeles")),(C<300||R<300)&&b.value.push("âš ï¸ Imagen muy pequeÃ±a - puede verse pixelada en documentos"),(C>1200||R>1600)&&b.value.push("â„¹ï¸ Imagen muy grande - se redimensionarÃ¡ automÃ¡ticamente")},F=()=>{k.value=null,p.value=null,b.value=[],_.value=!1,w.value&&(w.value.value="")},E=async()=>{var C;if(!(!k.value||!s.value)){h.value=!0,b.value=[];try{const R=await f.uploadLetterheadImage(s.value,k.value);(C=R.data)!=null&&C.warnings&&R.data.warnings.length>0&&(b.value=R.data.warnings),await O(),F(),i("uploaded",R.data)}catch(R){console.error("Error uploading letterhead:",R),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{h.value=!1}}},O=async()=>{if(s.value){if(o.document&&!o.document.letterhead_image){g.value=null;return}try{const C=await f.getLetterheadImage(s.value);C&&C.data?g.value=URL.createObjectURL(C.data):g.value=null}catch(C){C.response&&C.response.status!==404&&console.error("Unexpected error loading letterhead:",C),g.value=null}}},P=async()=>{await de("Â¿EstÃ¡s seguro de que deseas eliminar la imagen de membrete?")&&L()},L=async()=>{if(s.value){x.value=!0;try{await f.deleteLetterheadImage(s.value),g.value&&URL.revokeObjectURL(g.value),g.value=null,i("deleted")}catch(C){console.error("Error deleting letterhead:",C),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{x.value=!1}}},B=()=>{var C;if(g.value){const R=document.createElement("a");R.href=g.value,R.download=`membrete-${((C=o.document)==null?void 0:C.title)||"documento"}.png`,document.body.appendChild(R),R.click(),document.body.removeChild(R)}},Q=()=>{g.value=null},V=C=>{if(C===0)return"0 Bytes";const R=1024,X=["Bytes","KB","MB","GB"],Z=Math.floor(Math.log(C)/Math.log(R));return parseFloat((C/Math.pow(R,Z)).toFixed(2))+" "+X[Z]};re(()=>o.isVisible,C=>{C&&s.value&&O()}),re(()=>o.document,C=>{C&&o.isVisible&&O()});const xe=()=>{g.value&&URL.revokeObjectURL(g.value),p.value&&URL.revokeObjectURL(p.value)};return Se(()=>{o.isVisible&&s.value&&O()}),Le(xe),(C,R)=>ee((a(),T(Ee,null,{default:G(()=>{var X;return[e("div",sa,[e("div",aa,[oa,e("p",na," Documento: "+y(((X=t.document)==null?void 0:X.title)||"Cargando..."),1),e("button",{onClick:n,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[S(c(K),{class:"h-6 w-6"})])]),e("div",ra,[d.value?(a(),l("div",la,[ia,e("p",ca,y(r.value),1)])):(a(),l("div",da,[g.value?(a(),l("div",ua,[ma,e("div",ga,[e("img",{src:g.value,alt:"Membrete actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:Q},null,40,pa),e("div",ha,[e("button",{onClick:B,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[S(c(Ke),{class:"h-4 w-4 mr-2"}),U(" Descargar ")]),e("button",{onClick:P,disabled:x.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[S(c(Ve),{class:"h-4 w-4 mr-2"}),U(" "+y(x.value?"Eliminando...":"Eliminar"),1)],8,fa)])])])):(a(),l("div",ba,[S(c(ne),{class:"mx-auto h-12 w-12 text-gray-400"}),ya,va])),e("div",xa,[e("h3",_a,y(g.value?"Reemplazar Membrete":"Subir Membrete"),1),e("div",wa,[e("input",{ref_key:"fileInput",ref:w,type:"file",accept:".png",onChange:D,class:"hidden"},null,544),k.value?(a(),l("div",Ea,[e("div",Sa,[S(c(He),{class:"h-5 w-5 text-green-500"}),e("span",null,y(k.value.name),1),e("span",Pa,"("+y(V(k.value.size))+")",1)]),p.value?(a(),l("div",Ma,[e("img",{src:p.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,Fa)])):j("",!0),e("div",Ra,[e("button",{onClick:F,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:E,disabled:h.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[h.value?(a(),l("div",ja)):(a(),T(c(We),{key:0,class:"h-4 w-4 mr-2"})),U(" "+y(h.value?"Subiendo...":"Subir Imagen"),1)],8,Oa)])])):(a(),l("div",$a,[S(c(Ge),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",ka,[e("button",{onClick:R[0]||(R[0]=Z=>C.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG "),e("button",{onClick:R[1]||(R[1]=Z=>_.value=!_.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[S(c(je),{class:"h-4 w-4 mr-2"}),U(" "+y(_.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),Da,Ca]))])]),_.value?(a(),l("div",Ia,[e("div",Aa,[S(c(je),{class:"h-6 w-6 text-blue-600"}),La]),za,Ta,Ba,Ua])):j("",!0),b.value.length>0?(a(),l("div",qa,[(a(!0),l(H,null,W(b.value,(Z,Y)=>(a(),l("div",{key:Y,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",Na,[S(c(it),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",Va,y(Z),1)])]))),128))])):j("",!0)]))])])]}),_:1},512)),[[Ce,t.isVisible]])}},Ha=le(Ga,[["__scopeId","data-v-e55f9aeb"]]),Wa={class:"py-1"},Qa=["disabled","onClick"],Za={key:1,class:"submenu-container relative"},Ja=["onMouseenter","onMouseleave"],Xa={class:"flex items-center"},Ya=["onMouseenter","onMouseleave"],Ka={class:"py-1"},eo=["disabled","onClick"],to={key:2,class:"border-t border-gray-100"},so={__name:"HierarchicalMenu",props:{menuItems:{type:Array,required:!0,default:()=>[]},menuPosition:{type:String,default:"right-0 left-auto sm:left-0 sm:right-auto"}},emits:["menu-action","modalOpen","navigation"],setup(t,{emit:u}){const o=u,i=I(null);let f=null;const d=x=>{f&&(clearTimeout(f),f=null),i.value=x},r=x=>{f=setTimeout(()=>{i.value===x&&(i.value=null)},150)},h=x=>{i.value=null,o("menu-action",x)};return(x,k)=>(a(),T(c(Be),{as:"div",class:"relative inline-block text-left menu-container"},{default:G(()=>[S(c(ze),{class:"flex items-center justify-center w-8 h-8 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors focus:outline-none focus:ring-0"},{default:G(()=>[S(c(Qe),{class:"w-5 h-5","aria-hidden":"true"})]),_:1}),S(we,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:G(()=>[S(c(Te),{class:q(["absolute z-50 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",t.menuPosition])},{default:G(()=>[e("div",Wa,[(a(!0),l(H,null,W(t.menuItems,p=>(a(),l(H,{key:p.id||p.label},[p.children?(a(),l("div",Za,[S(c($e),null,{default:G(()=>[e("div",{class:"w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition cursor-pointer flex items-center justify-between",onMouseenter:g=>d(p.id),onMouseleave:g=>r(p.id)},[e("div",Xa,y(p.label),1),S(c(ct),{class:"w-4 h-4 text-gray-400"})],40,Ja)]),_:2},1024),S(we,{"enter-active-class":"transition ease-out duration-150","enter-from-class":"transform opacity-0 translate-x-2 scale-95","enter-to-class":"transform opacity-100 translate-x-0 scale-100","leave-active-class":"transition ease-in duration-100","leave-from-class":"transform opacity-100 translate-x-0 scale-100","leave-to-class":"transform opacity-0 translate-x-2 scale-95"},{default:G(()=>[i.value===p.id?(a(),l("div",{key:0,class:"absolute left-full top-0 mt-0 w-52 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none z-60",onMouseenter:g=>d(p.id),onMouseleave:g=>r(p.id)},[e("div",Ka,[(a(!0),l(H,null,W(p.children,g=>(a(),l("button",{key:g.label,class:q(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":g.disabled,"cursor-pointer":!g.disabled}]),disabled:g.disabled,onClick:b=>h(g.action)},[g.disabled?(a(),T(c(ke),{key:0,class:"size-4 text-gray-400 inline mr-2","aria-hidden":"true"})):j("",!0),U(" "+y(g.label),1)],10,eo))),128))])],40,Ya)):j("",!0)]),_:2},1024)])):(a(),T(c($e),{key:0},{default:G(()=>[e("button",{class:q(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":p.disabled,"cursor-pointer":!p.disabled}]),disabled:p.disabled,onClick:g=>h(p.action)},[p.disabled?(a(),T(c(ke),{key:0,class:"size-5 text-gray-400 inline mr-2","aria-hidden":"true"})):j("",!0),U(" "+y(p.label),1)],10,Qa)]),_:2},1024)),p.divider?(a(),l("div",to)):j("",!0)],64))),128))])]),_:1},8,["class"])]),_:1})]),_:1}))}},ao=le(so,[["__scopeId","data-v-60d5f9c4"]]);function oo(t,u){if(!t||t.length===0)return[];const o={editing:{id:"editing",label:"EdiciÃ³n y gestiÃ³n",children:[],priority:1},downloads:{id:"downloads",label:"Descargas",children:[],priority:2},communication:{id:"communication",label:"ComunicaciÃ³n",children:[],priority:3},states:{id:"states",label:"Estados del documento",children:[],priority:4},signatures:{id:"signatures",label:"Firmas",children:[],priority:5},actions:{id:"actions",label:"Acciones",children:[],priority:6}};t.forEach(d=>{const r={...d};switch(d.action){case"edit":o.editing.children.push(r);break;case"permissions":o.editing.children.push(r);break;case"copy":o.editing.children.push(r);break;case"downloadPDF":case"downloadWord":case"downloadSignedDocument":o.downloads.children.push(r);break;case"email":o.communication.children.push(r);break;case"publish":case"draft":case"formalize":o.states.children.push(r);break;case"viewSignatures":case"sign":o.signatures.children.push(r);break;case"preview":case"delete":case"removeFromFolder":case"useDocument":o.actions.children.push(r);break;default:o.actions.children.push(r)}});const i=Object.values(o).filter(d=>d.children.length>0).sort((d,r)=>d.priority-r.priority),f=[];return i.forEach((d,r)=>{d.children.length===1?f.push(d.children[0]):f.push(d),r<i.length-1&&f.push({divider:!0})}),f}function no(t){return t&&t.length>6}const Je=t=>(ue("data-v-a77a1fb5"),t=t(),me(),t),ro=["data-document-id"],lo={class:"flex justify-between items-start mb-3"},io={class:"flex items-center gap-2"},co={class:"py-1"},uo=["disabled","onClick"],mo={class:"space-y-2"},go={class:"text-lg font-semibold text-gray-900 leading-tight"},po={key:0,class:"text-sm text-gray-600 leading-relaxed"},ho={key:1,class:"pt-2"},fo={class:"flex items-center gap-2 flex-wrap"},bo=Je(()=>e("span",{class:"text-xs font-medium text-gray-500"},"Etiquetas:",-1)),yo={class:"flex items-center gap-1.5"},vo=["title"],xo={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-50"},_o={class:"bg-gray-900 text-white text-xs rounded-lg py-1.5 px-2.5 whitespace-nowrap shadow-lg"},wo=Je(()=>e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-[4px] border-r-[4px] border-t-[4px] border-transparent border-t-gray-900"},null,-1)),$o={__name:"BaseDocumentCard",props:{document:{type:Object,required:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},highlightedDocId:{type:[String,Number],default:null},showTags:{type:Boolean,default:!0},additionalClasses:{type:[String,Array,Object],default:""},statusIcon:{type:[String,Object,Function],default:null},statusText:{type:String,default:null},statusBadgeClasses:{type:[String,Object,Array],default:null},menuOptions:{type:Array,default:null},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},promptDocuments:{type:Boolean,default:!1},enableModals:{type:Boolean,default:!0},editModalComponent:{type:String,default:"UseDocumentByClient"},editRoute:{type:String,default:null},enableSignatures:{type:Boolean,default:!0},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null}},emits:["click","refresh","remove-from-folder","modal-open","navigation","menuAction"],setup(t,{emit:u}){const o=Me(),i=t,f=u,{activeModals:d,openModal:r,closeModal:h,getUserRole:x}=ir(i.documentStore,i.userStore),{handlePreviewDocument:k,deleteDocument:p,downloadPDFDocument:g,downloadWordDocument:b,copyDocument:w,publishDocument:_,moveToDraft:s,formalizeDocument:n,signDocument:D,downloadSignedDocument:A}=cr(i.documentStore,i.userStore,f),F=m=>{m.target.closest(".menu-container")||f("click",i.document,m)},E=()=>{f("refresh")},O={default:{getMenuOptions:(m,v)=>{const M=[];return M.push({label:"Usar Formato",action:"useDocument"}),M.push({label:"Gestionar Membrete",action:"letterhead"}),v==="folder"&&M.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),M}},client:{getMenuOptions:(m,v)=>{const M=[];return m.state==="Completed"?M.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Editar Formulario",action:"editForm"},{label:"Editar Documento",action:"editDocument"}]}):M.push({label:"Completar",action:"editForm"}),m.state==="Completed"&&M.push({label:"Previsualizar",action:"preview"}),M.push({label:"Eliminar",action:"delete"}),M.push({label:"Gestionar Membrete",action:"letterhead"}),M.push({label:"Administrar Asociaciones",action:"relationships"}),m.state==="Completed"&&M.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar",action:"email"}),v==="folder"&&M.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),M}},lawyer:{getMenuOptions:(m,v)=>{const M=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Administrar Asociaciones",action:"relationships"},{label:"Eliminar",action:"delete"},{label:"PrevisualizaciÃ³n",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}];return m.state==="Draft"?M.push({label:"Publicar",action:"publish",disabled:!_e(m)}):m.state==="Published"&&(M.push({label:"Mover a Borrador",action:"draft"}),M.push({label:"Formalizar y Agregar Firmas",action:"formalize"})),(m.state==="Completed"||m.state==="Published")&&M.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),m.requires_signature&&(M.push({label:"Ver Firmas",action:"viewSignatures"}),Re(m)&&M.push({label:"Firmar documento",action:"sign"})),M}},signatures:{getMenuOptions:(m,v)=>{const M=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}];return m.requires_signature&&(m.state==="PendingSignatures"||m.state==="FullySigned")&&M.push({label:"Estado de las firmas",action:"viewSignatures"}),Re(m)&&M.push({label:"Firmar documento",action:"sign"}),m.state==="FullySigned"&&M.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),m.state==="PendingSignatures"&&M.push({label:"Descargar PDF",action:"downloadPDF"}),v==="folder"&&M.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),M}}},P=N(()=>{if(i.menuOptions!==null)return i.menuOptions;if(i.showMenuOptions===!1)return[];if(i.showMenuOptions===!0){const v=O[i.cardType];return v?v.getMenuOptions(i.document,i.cardContext):[]}const m=O[i.cardType];return m?m.getMenuOptions(i.document,i.cardContext):[]}),L=N(()=>i.promptDocuments?"right-0 left-auto sm:right-auto sm:left-0 sm:-translate-x-[calc(100%-24px)]":"right-0 left-auto sm:left-0 sm:right-auto"),B=N(()=>!P.value||P.value.length===0?[]:te(P.value)?P.value:oo(P.value,i.document)),Q=N(()=>{switch(i.document.state){case"Completed":case"Published":case"FullySigned":return"border-green-400 bg-green-50/50 shadow-green-100";case"Progress":case"Draft":return"border-blue-300 bg-blue-50/30 shadow-blue-100";case"PendingSignatures":return"border-yellow-400 bg-yellow-50/50 shadow-yellow-100";default:return"border-gray-200 bg-white"}}),V=N(()=>{if(!i.highlightedDocId||String(i.document.id)!==String(i.highlightedDocId))return"";const m=i.document.state;return m==="Published"||m==="FullySigned"||m==="Completed"?"shadow-lg animate-pulse-highlight-green":m==="PendingSignatures"?"shadow-lg animate-pulse-highlight-yellow":"shadow-lg animate-pulse-highlight-blue"}),xe=N(()=>{if(i.statusIcon)return i.statusIcon;switch(i.document.state){case"Published":case"FullySigned":case"Completed":return He;case"Draft":case"Progress":case"PendingSignatures":default:return dt}}),C=N(()=>{if(i.statusText)return i.statusText;switch(i.document.state){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return"Desconocido"}}),R=N(()=>{if(i.statusBadgeClasses)return i.statusBadgeClasses;switch(i.document.state){case"Published":case"FullySigned":case"Completed":return"bg-green-100 text-green-700 border border-green-200";case"Draft":case"Progress":return"bg-blue-100 text-blue-700 border border-blue-200";case"PendingSignatures":return"bg-yellow-100 text-yellow-700 border border-yellow-200";default:return"bg-gray-100 text-gray-700 border border-gray-200"}}),X=async(m,v)=>{try{switch(m){case"edit":await Z(v);break;case"editForm":await Y(v);break;case"editDocument":await ie(v);break;case"permissions":r("permissions",v);break;case"relationships":r("relationships",v);break;case"preview":await k(v);break;case"delete":await p(v);break;case"downloadPDF":await g(v);break;case"downloadWord":await b(v);break;case"email":r("email",v);break;case"copy":await w(v);break;case"publish":await _(v);break;case"draft":await s(v);break;case"formalize":await n(v);break;case"viewSignatures":r("signatures",v);break;case"sign":await D(v,r);break;case"downloadSignedDocument":await A(v);break;case"removeFromFolder":f("remove-from-folder",v);break;case"useDocument":f("click",v);break;case"use":f("menuAction",m,v);break;case"letterhead":r("letterhead",v);break;default:console.warn("Unknown action:",m)}}catch(M){console.error(`Error executing action ${m}:`,M)}},Z=async m=>{if(i.editRoute){const v=encodeURIComponent(m.title.trim()),M=i.editRoute.replace(":id",m.id).replace(":title",v);o.push(M)}else r("edit",m,{userRole:x()})},Y=async m=>{r("edit",m,{userRole:x()})},ie=async m=>{o.push(`/dynamic_document_dashboard/client/editor/edit/${m.id}`)},te=m=>m&&m.some(v=>v.children&&v.children.length>0),_e=m=>!m.variables||m.variables.length===0?!0:m.variables.every(v=>v.name_es&&v.name_es.trim().length>0),Re=m=>{var z,se;if(!m.requires_signature||m.state!=="PendingSignatures"||!m.signatures||m.signatures.length===0)return!1;const v=(se=(z=i.userStore)==null?void 0:z.currentUser)==null?void 0:se.email,M=m.signatures.find(he=>he.signer_email===v);return!(!M||M.signed)};return(m,v)=>{var M;return a(),l(H,null,[e("div",{"data-document-id":t.document.id,class:q(["relative bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 p-4 cursor-pointer focus:outline-none focus:ring-0",[Q.value,V.value,t.additionalClasses]]),onClick:F},[e("div",lo,[e("div",io,[ae(m.$slots,"status-badge",{},()=>[e("div",{class:q(["inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium",R.value])},[(a(),T(Pe(xe.value),{class:"w-3.5 h-3.5"})),e("span",null,y(C.value),1)],2)],!0),ae(m.$slots,"additional-badges",{},void 0,!0)]),ae(m.$slots,"right-action",{},()=>[c(no)(P.value)||te(P.value)?(a(),T(ao,{key:0,"menu-items":B.value,"menu-position":L.value,onMenuAction:v[0]||(v[0]=z=>X(z,t.document))},null,8,["menu-items","menu-position"])):P.value&&P.value.length>0?(a(),T(c(Be),{key:1,as:"div",class:"relative inline-block text-left menu-container"},{default:G(()=>[S(c(ze),{class:"flex items-center justify-center w-8 h-8 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors focus:outline-none focus:ring-0"},{default:G(()=>[S(c(Qe),{class:"w-5 h-5","aria-hidden":"true"})]),_:1}),S(we,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:G(()=>[S(c(Te),{class:q(["absolute z-50 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",L.value])},{default:G(()=>[e("div",co,[(a(!0),l(H,null,W(P.value,z=>(a(),T(c($e),{key:z.label},{default:G(()=>[e("button",{class:q(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":z.disabled,"cursor-pointer":!z.disabled}]),disabled:z.disabled,onClick:se=>X(z.action,t.document)},[z.disabled?(a(),T(c(ke),{key:0,class:"size-5 text-gray-400 inline mr-2","aria-hidden":"true"})):j("",!0),U(" "+y(z.label),1)],10,uo)]),_:2},1024))),128))])]),_:1},8,["class"])]),_:1})]),_:1})):j("",!0)],!0)]),e("div",mo,[e("h3",go,y(t.document.title),1),t.document.description?(a(),l("p",po,y(t.document.description),1)):j("",!0),ae(m.$slots,"additional-content",{},void 0,!0),t.showTags&&t.document.tags&&t.document.tags.length>0?(a(),l("div",ho,[e("div",fo,[bo,e("div",yo,[(a(!0),l(H,null,W(t.document.tags,z=>{var se,he;return a(),l("div",{key:z.id,class:"group relative"},[e("div",{class:"w-5 h-5 rounded-full cursor-pointer transition-all duration-200 hover:scale-110 hover:ring-2 hover:ring-offset-1 shadow-sm",style:et({backgroundColor:((se=c(Oe)(z.color_id))==null?void 0:se.hex)||"#9CA3AF",boxShadow:`0 0 0 1px ${((he=c(Oe)(z.color_id))==null?void 0:he.dark)||"#6B7280"}40`}),title:z.name},null,12,vo),e("div",xo,[e("div",_o,[U(y(z.name)+" ",1),wo])])])}),128))])])])):j("",!0)]),ae(m.$slots,"footer",{},void 0,!0),ae(m.$slots,"additional-actions",{},void 0,!0)],10,ro),c(d).edit.isOpen?(a(),T(c(jo),{key:0,document:c(d).edit.document,"user-role":c(x)(),onClose:v[1]||(v[1]=z=>c(h)("edit"))},null,8,["document","user-role"])):j("",!0),c(d).email.isOpen?(a(),T(c(an),{key:1,document:c(d).email.document,onClose:v[2]||(v[2]=z=>c(h)("email"))},null,8,["document"])):j("",!0),c(d).signatures.isOpen?(a(),T(c(Bn),{key:2,"document-id":(M=c(d).signatures.document)==null?void 0:M.id,onClose:v[3]||(v[3]=z=>c(h)("signatures")),onRefresh:E},null,8,["document-id"])):j("",!0),c(d).electronicSignature.isOpen?(a(),T(c(Gn),{key:3,onClose:v[4]||(v[4]=z=>c(h)("electronicSignature"))})):j("",!0),c(d).permissions.isOpen?(a(),T(c(lr),{key:4,"is-open":c(d).permissions.isOpen,document:c(d).permissions.document,onClose:v[5]||(v[5]=z=>c(h)("permissions")),onSaved:E},null,8,["is-open","document"])):j("",!0),c(d).letterhead.isOpen?(a(),T(Ha,{key:5,"is-visible":c(d).letterhead.isOpen,document:c(d).letterhead.document,onClose:v[6]||(v[6]=z=>c(h)("letterhead")),onUploaded:E,onDeleted:E},null,8,["is-visible","document"])):j("",!0),c(d).relationships.isOpen?(a(),T(ta,{key:6,"is-open":c(d).relationships.isOpen,document:c(d).relationships.document,onClose:v[7]||(v[7]=z=>c(h)("relationships")),onRefresh:E},null,8,["is-open","document"])):j("",!0)],64)}}},Pr=le($o,[["__scopeId","data-v-a77a1fb5"]]),ko={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Do={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Co={class:"flex justify-end"},Eo=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[U(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),So={class:"mt-2"},Po={class:"flex gap-2 mt-2.5"},Mo=["disabled"],Fo=e("span",null,"Actualizar nombre",-1),Ro=[Fo],Oo=["disabled"],jo={__name:"EditDocumentModal",props:{document:{type:Object,required:!0},userRole:{type:String,default:"client"}},emits:["close"],setup(t,{emit:u}){const o=t,i=Me(),f=ye(),d=u,r=I(""),h=I(""),x=()=>{d("close")};tt(()=>{var s,n;o.document?(r.value=((s=o.document)==null?void 0:s.title)||"",h.value=((n=o.document)==null?void 0:n.title)||""):(r.value="",h.value="")});const k=s=>{s.key==="Escape"&&x()};Se(()=>{document.addEventListener("keydown",k)}),Le(()=>{document.removeEventListener("keydown",k)});const p=N(()=>r.value.trim().length>0),g=N(()=>{var s;return!!((s=o.document)!=null&&s.id)}),b=N(()=>g.value&&r.value.trim()!==h.value.trim()&&r.value.trim().length>0);async function w(){if(g.value&&b.value)try{const s={title:r.value.trim()};await f.updateDocument(o.document.id,s),h.value=r.value.trim(),$("Nombre del documento actualizado exitosamente.","success"),x()}catch(s){console.error("Error updating document name:",s),$("Error al actualizar el nombre del documento.","error")}}function _(){var n;const s=encodeURIComponent(r.value.trim());(n=o.document)!=null&&n.id&&!g.value?o.userRole==="lawyer"?i.push(`/dynamic_document_dashboard/lawyer/editor/create/${s}`):i.push(`/dynamic_document_dashboard/document/use/creator/${o.document.id}/${s}`):g.value?o.userRole==="lawyer"?i.push(`/dynamic_document_dashboard/lawyer/editor/edit/${o.document.id}`):i.push(`/dynamic_document_dashboard/document/use/editor/${o.document.id}/${s}`):$("Error: No se pudo continuar. Documento no seleccionado.","error")}return(s,n)=>(a(),l("div",ko,[e("div",Do,[e("div",Co,[e("button",{onClick:x},[S(c(K),{class:"size-6"})])]),e("form",{onSubmit:fe(_,["prevent"])},[e("div",null,[Eo,e("div",So,[ee(e("input",{"onUpdate:modelValue":n[0]||(n[0]=D=>r.value=D),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[be,r.value]])])]),e("div",Po,[g.value?(a(),l("button",{key:0,type:"button",onClick:w,disabled:!b.value,class:q(["p-2.5 text-sm font-medium rounded-md flex gap-2",b.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Ro,10,Mo)):j("",!0),e("button",{type:"submit",class:q(["p-2.5 text-sm font-medium rounded-md flex gap-2",p.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!p.value},[e("span",null,y(g.value?"Editar Documento":"Continuar"),1)],10,Oo)])],32)])]))}},Io={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Ao={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Lo={class:"flex justify-end"},zo=e("label",{for:"email",class:"block text-base font-medium leading-6 text-primary"},[U(" Correo electrÃ³nico "),e("span",{class:"text-red-500"},"*")],-1),To={class:"mt-2"},Bo={class:"mt-4"},Uo=e("label",{for:"files",class:"block text-base font-medium leading-6 text-primary"}," Anexos ",-1),qo={key:0,class:"text-center"},No={class:"mt-4 flex text-sm/6 text-gray-600"},Vo={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"},Go=e("span",null,"Sube un archivo",-1),Ho=e("p",{class:"pl-1"},"o arrastra y suelta",-1),Wo=e("p",{class:"text-xs/5 text-gray-600"}," PNG, JPG, PDF, DOCX de hasta 20MB ",-1),Qo={key:1,class:"w-full flex flex-wrap gap-3"},Zo=["onMouseenter","onMouseleave"],Jo=["onClick"],Xo={class:"text-center text-xs truncate w-20"},Yo=["disabled"],Ko=e("span",null,"Enviar",-1),en=[Ko],tn="dynamic-documents/send_email_with_attachments/",sn=20*1024*1024,an={__name:"SendDocumentModal",props:{document:{type:Object,required:!0}},emits:["close"],setup(t,{emit:u}){const o=u,{sendEmail:i}=mt(),f=I(null),d=t,r=()=>{h.email="",x.value=[],f.value=null},h=st({email:""}),x=I([]),k=F=>{const E=Array.from(F.target.files);g(E),F.target.value=null},p=F=>{const E=Array.from(F.dataTransfer.files);g(E)},g=F=>{let E=x.value.reduce((O,P)=>O+P.file.size,0);F.forEach(O=>{if(O.size>sn){$(`The file "${O.name}" exceeds the 20 MB limit.`,"warning");return}const P=O.name.split(".").pop().toLowerCase();let L="",B={general:"",xMark:""};switch(P){case"png":case"jpg":case"jpeg":L=Ge,B.general="border-gray-200 text-gray-400",B.xMark="bg-gray-400";break;case"pdf":L=ne,B.general="border-red-600/20 text-red-600/60",B.xMark="bg-red-600/60";break;case"docx":L=ne,B.general="border-blue-600/20 text-blue-600/60",B.xMark="bg-blue-600/60";break;default:$("Unsupported file type. Only PDF, DOCX, JPG, and PNG are allowed.","warning");return}x.value.push({name:O.name,icon:L,style:B,hover:!1,file:O}),E+=O.size})},b=F=>{x.value.splice(F,1)},w=F=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(F),_=N(()=>w(h.email)),s=N(()=>_.value),n=async F=>{try{const E=await oe(`dynamic-documents/${F}/download-pdf/`,"blob");if(!E||!E.data)throw new Error("Invalid response from server");return new File([E.data],`document_${F}.pdf`,{type:"application/pdf"})}catch(E){return console.error("Error downloading PDF:",E),$("No se pudo descargar el documento PDF.","error"),null}};re(()=>d.document,F=>{F&&Object.keys(F).length>0&&F.id&&n(F.id)},{immediate:!0});const D=async()=>{try{if(d.document.id){const E=await n(d.document.id);E&&x.value.push({name:E.name,file:E,icon:ne,style:{general:"border-blue-600/20 text-blue-600/60",xMark:"bg-blue-600/60"},hover:!1})}const F=x.value.map(E=>E.file);await i(tn,h.email,d.document.title,"Attached is the requested document along with additional attachments.",F,{documentId:d.document.id})}catch(F){console.error("Error sending the email:",F)}finally{A()}},A=()=>{r(),o("close")};return(F,E)=>(a(),l("div",Io,[e("div",Ao,[e("div",Lo,[e("button",{onClick:E[0]||(E[0]=O=>A())},[S(c(K),{class:"size-6"})])]),e("form",{onSubmit:fe(D,["prevent"])},[e("div",null,[zo,e("div",To,[ee(e("input",{"onUpdate:modelValue":E[1]||(E[1]=O=>h.email=O),type:"text",name:"email",id:"email",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[be,h.email]])])]),e("div",Bo,[Uo,e("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 bg-white px-6 py-10",onDragover:E[2]||(E[2]=fe(()=>{},["prevent"])),onDrop:fe(p,["prevent"])},[x.value.length<1?(a(),l("div",qo,[S(c(We),{class:"mx-auto size-12 text-gray-300","aria-hidden":"true"}),e("div",No,[e("label",Vo,[Go,e("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",onChange:k},null,32)]),Ho]),Wo])):(a(),l("div",Qo,[(a(!0),l(H,null,W(x.value,(O,P)=>(a(),l("div",{key:P,class:q(["relative p-4 grid rounded-md bg-white border-2",O.style.general]),onMouseenter:L=>O.hover=!0,onMouseleave:L=>O.hover=!1},[ee(e("div",{class:q(["absolute p-0.5 mt-2 ml-2 rounded-full",O.style.xMark]),onClick:L=>b(P)},[S(c(K),{class:"size-3 text-white"})],10,Jo),[[Ce,O.hover]]),(a(),T(Pe(O.icon),{class:"size-12 mx-auto"})),e("span",Xo,y(O.name),1)],42,Zo))),128))]))],32)]),e("button",{type:"submit",class:q(["mt-4 p-2.5 text-sm font-medium rounded-md flex gap-2",s.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!s.value},en,10,Yo)],32)])]))}},pe=t=>(ue("data-v-9843e2c5"),t=t(),me(),t),on={class:"fixed inset-0 z-50 flex items-center justify-center"},nn={class:"relative bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col"},rn=pe(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Estado de firmas del documento",-1)),ln=pe(()=>e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),cn=[ln],dn={class:"p-6 overflow-y-auto flex-grow"},un={key:0,class:"text-center py-10"},mn=pe(()=>e("div",{class:"spinner"},null,-1)),gn=pe(()=>e("p",{class:"mt-4 text-gray-500"},"Cargando informaciÃ³n de firmas...",-1)),pn=[mn,gn],hn={key:1},fn={class:"mb-4"},bn={class:"text-lg font-medium text-gray-900"},yn={class:"text-sm text-gray-500"},vn={class:"inline-flex items-center"},xn={key:0,class:"text-sm text-gray-500 mt-1"},_n={class:"text-sm text-gray-500 mt-1"},wn={class:"mt-6"},$n={class:"min-w-full divide-y divide-gray-200"},kn=pe(()=>e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Usuario"),e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado"),e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Fecha de firma")])],-1)),Dn={class:"bg-white divide-y divide-gray-200"},Cn={class:"px-4 py-4 whitespace-nowrap"},En={class:"flex items-center"},Sn={class:"text-sm font-medium text-gray-900 flex items-center"},Pn={key:0,class:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full"},Mn={class:"text-sm text-gray-500"},Fn={class:"px-4 py-4 whitespace-nowrap"},Rn={class:"px-4 py-4 whitespace-nowrap text-sm text-gray-500"},On={class:"px-4 py-4 whitespace-nowrap"},jn={class:"flex items-center"},In={class:"text-sm font-medium text-gray-900"},An={class:"text-sm text-gray-500"},Ln={class:"px-4 py-4 whitespace-nowrap"},zn={class:"px-4 py-4 whitespace-nowrap text-sm text-gray-500"},Tn={__name:"DocumentSignaturesModal",props:{documentId:Number},emits:["close","refresh"],setup(t,{emit:u}){const o=t,i=u,f=ye(),d=Ue(),r=I(null),h=()=>{i("close")},x=p=>p?new Date(p).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"â€”",k=async()=>{if(!o.documentId){console.error("No document ID provided");return}try{const p=d.currentUser.id,g=await oe(`dynamic-documents/user/${p}/pending-documents-full/`);if(g.status!==200)throw new Error(`Error loading documents: ${g.status}`);const b=g.data.find(w=>w.id===o.documentId);if(b)r.value=b;else{const w=await oe(`dynamic-documents/${o.documentId}/`);if(w.status!==200)throw new Error(`Error loading document: ${w.status}`);r.value=w.data}}catch(p){console.error("Error loading document data:",p),p.response&&console.error("Error response data:",p.response.data),r.value=null,await $("Error al cargar la informaciÃ³n de firmas","error")}};return re(()=>o.documentId,p=>{p&&k()},{immediate:!0}),re(()=>f.documents,()=>{o.documentId&&k()},{deep:!0}),(p,g)=>(a(),l("div",on,[e("div",{class:"absolute inset-0 bg-black opacity-50",onClick:h}),e("div",nn,[e("div",{class:"px-6 py-4 border-b border-gray-200"},[rn,e("button",{onClick:h,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},cn)]),e("div",dn,[r.value?(a(),l("div",hn,[e("div",fn,[e("h3",bn,y(r.value.title),1),e("p",yn,[e("span",vn,[e("span",{class:q(["inline-block w-3 h-3 rounded-full mr-2",r.value.fully_signed?"bg-green-500":"bg-yellow-500"])},null,2),U(" "+y(r.value.fully_signed?"Documento completamente firmado":"Pendiente de firmas"),1)])]),r.value.creator?(a(),l("p",xn," Creado por: "+y(r.value.creator.name)+" ("+y(r.value.creator.email)+") ",1)):j("",!0),e("p",_n," Firmas: "+y(r.value.completed_signatures||0)+"/"+y(r.value.total_signatures||0),1)]),e("div",wn,[e("table",$n,[kn,e("tbody",Dn,[(a(!0),l(H,null,W(r.value.signers||[],b=>(a(),l("tr",{key:"sig_"+b.signature_id,class:q({"bg-blue-50":b.is_current_user})},[e("td",Cn,[e("div",En,[e("div",null,[e("div",Sn,[U(y(b.signer_name)+" ",1),b.is_current_user?(a(),l("span",Pn,"TÃº")):j("",!0)]),e("div",Mn,y(b.signer_email),1)])])]),e("td",Fn,[e("span",{class:q(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",b.signed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},y(b.signed?"Firmado":"Pendiente"),3)]),e("td",Rn,y(b.signed_at?x(b.signed_at):"â€”"),1)],2))),128)),!r.value.signers&&r.value.signatures?(a(!0),l(H,{key:0},W(r.value.signatures,b=>(a(),l("tr",{key:"old_"+b.id},[e("td",On,[e("div",jn,[e("div",null,[e("div",In,y(b.signer_name||b.signer_email),1),e("div",An,y(b.signer_email),1)])])]),e("td",Ln,[e("span",{class:q(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",b.signed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},y(b.signed?"Firmado":"Pendiente"),3)]),e("td",zn,y(b.signed_at?x(b.signed_at):"â€”"),1)]))),128)):j("",!0)])])])])):(a(),l("div",un,pn))]),e("div",{class:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end"},[e("button",{onClick:h,class:"px-4 py-2 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400"}," Cerrar ")])])]))}},Bn=le(Tn,[["__scopeId","data-v-9843e2c5"]]),Un={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},qn={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-auto shadow-xl"},Nn={class:"flex justify-between items-center mb-4"},Vn=e("h2",{class:"text-lg font-medium text-primary"},"Firma ElectrÃ³nica",-1),Gn={__name:"ElectronicSignatureModal",emits:["close"],setup(t,{emit:u}){const o=Ue(),i=u,f=()=>{i("close")},d=async r=>{o.currentUser&&(o.currentUser.has_signature=!0),$("Firma electrÃ³nica guardada correctamente","success"),setTimeout(()=>{f()},500)};return(r,h)=>(a(),l("div",Un,[e("div",qn,[e("div",Nn,[Vn,e("button",{onClick:f,class:"text-gray-400 hover:text-gray-500"},[S(c(K),{class:"h-6 w-6"})])]),S(at,{initialShowOptions:!0,"user-id":c(o).currentUser.id,onSignatureSaved:d,onCancel:f},null,8,["user-id"])])]))}},Hn={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Wn={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0"},Qn={class:"inline-block w-full max-w-4xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl"},Zn={class:"flex items-center justify-between pb-4 mb-6 border-b border-gray-200"},Jn=e("h3",{class:"text-lg font-medium leading-6 text-gray-900"}," GestiÃ³n de Permisos ",-1),Xn={class:"mt-1 text-sm text-gray-500"},Yn={key:0,class:"mb-6"},Kn={key:1,class:"p-4 mb-6 bg-red-50 border border-red-200 rounded-lg"},er=e("div",{class:"flex items-center"},[e("svg",{class:"w-5 h-5 text-red-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("p",{class:"text-red-700"},"No tienes permisos para gestionar los permisos de este documento.")],-1),tr=[er],sr={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},ar=["disabled"],or={key:0,class:"flex items-center"},nr=e("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},null,-1),rr={key:1},lr={__name:"DocumentPermissionsModal",props:{isOpen:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close","saved"],setup(t,{emit:u}){const o=t,i=u,f=ye(),d=I(null),r=I(!1),{isLawyer:h}=ot(),x=N(()=>{var g;return h.value&&((g=o.document)==null?void 0:g.id)}),k=()=>{r.value||i("close")},p=async()=>{var b;if(!x.value||r.value)return;const g=(b=d.value)==null?void 0:b.getPermissionsData();if(!g){await $("Error al obtener los permisos actuales","error");return}r.value=!0;try{const w=o.document.id;await f.manageDocumentPermissions(w,g),await $("Permisos actualizados exitosamente","success"),i("saved",o.document),k()}catch(w){console.error("Error saving permissions:",w),await $("Error al guardar los permisos","error")}finally{r.value=!1}};return(g,b)=>(a(),T(Ee,null,{default:G(()=>{var w;return[t.isOpen?(a(),l("div",Hn,[e("div",Wn,[e("div",{class:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:k}),e("div",Qn,[e("div",Zn,[e("div",null,[Jn,e("p",Xn,y(((w=t.document)==null?void 0:w.title)||"Documento"),1)]),e("button",{onClick:k,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors"},[S(c(K),{class:"w-6 h-6"})])]),x.value?(a(),l("div",Yn,[S(nt,{ref_key:"permissionsManagerRef",ref:d,document:t.document},null,8,["document"])])):(a(),l("div",Kn,tr)),e("div",sr,[e("button",{onClick:k,type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"},y(x.value?"Cancelar":"Cerrar"),1),x.value?(a(),l("button",{key:0,onClick:p,disabled:r.value,type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-secondary rounded-md hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[r.value?(a(),l("span",or,[nr,U(" Guardando... ")])):(a(),l("span",rr,"Guardar Permisos"))],8,ar)):j("",!0)])])])])):j("",!0)]}),_:1}))}};function ir(t,u){const o=I({edit:{isOpen:!1,document:null},email:{isOpen:!1,document:null},preview:{isOpen:!1,document:null},signatures:{isOpen:!1,document:null},electronicSignature:{isOpen:!1,document:null},permissions:{isOpen:!1,document:null},letterhead:{isOpen:!1,document:null},relationships:{isOpen:!1,document:null}}),i=(h,x,k={})=>{switch(d(),h){case"edit":o.value.edit={isOpen:!0,document:x,...k};break;case"email":o.value.email={isOpen:!0,document:x};break;case"preview":qe(x);break;case"signatures":o.value.signatures={isOpen:!0,document:x};break;case"electronic-signature":o.value.electronicSignature={isOpen:!0,document:x};break;case"permissions":o.value.permissions={isOpen:!0,document:x};break;case"letterhead":o.value.letterhead={isOpen:!0,document:x};break;case"relationships":o.value.relationships={isOpen:!0,document:x};break;default:console.warn(`Unknown modal type: ${h}`)}},f=h=>{o.value[h]&&(o.value[h]={isOpen:!1,document:null})},d=()=>{Object.keys(o.value).forEach(h=>{o.value[h]={isOpen:!1,document:null}})};return{activeModals:o,openModal:i,closeModal:f,closeAllModals:d,getUserRole:()=>{var h;return((h=u==null?void 0:u.currentUser)==null?void 0:h.role)||"client"}}}function cr(t,u,o){const{registerView:i}=rt(),f=Me();return{handlePreviewDocument:async s=>{await i("document",s.id),qe(s)},deleteDocument:async s=>{if(await de(`Â¿EstÃ¡s seguro de que deseas eliminar el documento "${s.title}"?`)&&t)try{await t.deleteDocument(s.id),await $("Documento eliminado exitosamente","success"),o("refresh")}catch(D){throw await $("Error al eliminar el documento","error"),D}},downloadPDFDocument:async s=>{if(t)try{await t.downloadPDF(s.id,s.title),await $("PDF descargado exitosamente","success")}catch(n){throw await $("Error al descargar el PDF","error"),n}},downloadWordDocument:async s=>{if(t)try{await t.downloadWord(s.id,s.title),await $("Documento Word descargado exitosamente","success")}catch(n){throw await $("Error al descargar el documento Word","error"),n}},copyDocument:async s=>{var n;if(!t){await $("Funcionalidad de duplicar no implementada aÃºn","info");return}try{const D=new Date,A=String(D.getDate()).padStart(2,"0"),F=String(D.getMonth()+1).padStart(2,"0"),E=D.getFullYear(),O=`${A}${F}${E}`,P=`${s.title} ${O}`,L={title:P,content:s.content,state:"Draft",variables:((n=s.variables)==null?void 0:n.map(Q=>({name_en:Q.name_en,name_es:Q.name_es,tooltip:Q.tooltip,field_type:Q.field_type,select_options:Q.select_options,value:""})))||[],requires_signature:!1};if(!await de(`Â¿Deseas crear una copia del documento '${s.title}'?`))return;await t.createDocument(L),await $(`Copia creada exitosamente: "${P}"`,"success"),o("refresh")}catch(D){console.error("Error creating document copy:",D),await $("Error al crear la copia del documento","error")}},publishDocument:async s=>{if(t)try{const n={...s,state:"Published",is_public:!0};await t.updateDocument(s.id,n),await $("Documento publicado exitosamente","success"),o("refresh")}catch(n){throw await $("Error al publicar el documento","error"),n}},moveToDraft:async s=>{if(t)try{const n={...s,state:"Draft"};await t.updateDocument(s.id,n),await $("Documento movido a borrador exitosamente","success"),o("refresh")}catch(n){throw await $("Error al mover el documento a borrador","error"),n}},formalizeDocument:async s=>{try{f.push(`/dynamic_document_dashboard/document/use/formalize/${s.id}/${s.title}`)}catch(n){console.error("Error al formalizar el documento:",n),await $("Error al formalizar el documento","error")}},signDocument:async(s,n)=>{var D,A;try{const F=u.currentUser.id,E=u.currentUser.email;if(!s.requires_signature){await $("Este documento no requiere firmas","error");return}const O=(D=s.signatures)==null?void 0:D.find(V=>V.signer_email===E);if(!O){await $("No estÃ¡s autorizado para firmar este documento","error");return}if(O.signed){await $("Ya has firmado este documento","info");return}if(!u.currentUser.has_signature){await $("Para firmar documentos necesitas tener una firma registrada.","info"),await de("Â¿Deseas crear una firma electrÃ³nica ahora?")?o("open-electronic-signature"):await $("Necesitas una firma para poder firmar documentos.","warning");return}if(!await de(`Â¿EstÃ¡s seguro de que deseas firmar el documento "${s.title}"?`)){await $("OperaciÃ³n de firma cancelada","info");return}const L=((A=s.signatures)==null?void 0:A.filter(V=>!V.signed))||[],B=L.length===1&&L[0].signer_email===E,Q=`dynamic-documents/${s.id}/sign/${F}/`;try{await $("Procesando firma del documento...","info");const V=await De(Q,{});if(V.status===200||V.status===201)await $(`Â¡Documento "${s.title}" firmado correctamente!`,"success"),B?(await $(`El documento "${s.title}" ha sido firmado por todas las partes`,"success"),o("document-fully-signed",s),setTimeout(()=>{t.init(),o("refresh"),setTimeout(()=>{n("signatures",s)},1500)},1e3)):(await t.init(),o("refresh"),setTimeout(()=>{n("signatures",s)},1e3));else throw new Error(`Unexpected server response: ${V.status} ${V.statusText}`)}catch(V){throw console.error("Error in HTTP request:",V),V}}catch(F){console.error("General error signing document:",F),await $(`Error al firmar el documento: ${F.message}`,"error")}},downloadSignedDocument:async s=>{try{if(s.state!=="FullySigned"){$("El documento debe estar completamente firmado para descargarlo","warning");return}if(!s.signatures||s.signatures.length===0){$("El documento no tiene firmas registradas","warning");return}const n=`dynamic-documents/${s.id}/generate-signatures-pdf/`;await lt(n,`firmas_${s.title}.pdf`)}catch(n){console.error("Error downloading signed document:",n),$("Error al descargar el documento firmado","error")}}}}export{Pr as B,Bn as D,Ha as L,Sr as _,Ze as a,ir as b,cr as c,jo as d,an as e,ta as f,lr as g,ke as r,de as s,mt as u};
