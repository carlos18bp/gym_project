import{e as a,f as l,g as e,r as A,s as $,E as De,w as K,Q as Ce,k as B,i as V,t as f,h as S,j as c,G as Y,a1 as Ee,c as N,v as fe,F as G,M as H,n as U,aS as Ae,p as T,l as j,N as ce,O as de,D as ae,a0 as Xe,T as ie,o as Se,a4 as Pe,ap as ze,ad as Le,ae as we,af as Be,ag as $e,ac as Te,u as Me,a8 as se,b0 as Ye,aH as Ke,m as he,b as et,P as Ue,b7 as tt,aj as st}from"./index.js";import{g as Oe,u as at,_ as ot}from"./DocumentPermissionsManager.js";import{useRecentViews as nt}from"./useRecentViews.js";import{u as be,o as qe,d as rt}from"./index2.js";import{_ as ne}from"./_plugin-vue_export-helper.js";import{a as Ne,r as Ve}from"./MagnifyingGlassIcon.js";import{r as oe}from"./DocumentIcon.js";import{c as Fe,a as Ge,b as He,r as lt}from"./LinkIcon.js";import{r as We}from"./TrashIcon.js";import{r as it}from"./ArrowDownTrayIcon.js";import{r as Qe}from"./PhotoIcon.js";import{r as je}from"./InformationCircleIcon.js";import{r as ct}from"./ExclamationTriangleIcon.js";import{r as dt}from"./PencilIcon.js";import{s as ut,h as Ie}from"./loading_message.js";function Ze(t,u){return a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"})])}function ke(t,u){return a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"})])}function mt(){const t=A(!1),u=A("");async function o(i,h,r="",m="",p=[],v={}){if(!h)throw u.value="Recipient email is required.",await $(u.value,"error"),new Error(u.value);const _=new FormData;_.append("to_email",h),_.append("subject",r),_.append("body",m),p.forEach((b,d)=>{_.append(`attachments[${d}]`,b)});for(const[b,d]of Object.entries(v))_.append(b,d);try{t.value=!0,u.value="",ut("Sending email...","Please wait while we send the email.");const b=await De(i,_);return Ie(),await $("Email sent successfully.","success"),b.data}catch(b){throw Ie(),console.error("Error sending email:",b.message),u.value="An error occurred while sending the email. Please try again.",await $(u.value,"error"),b}finally{t.value=!1}}return{sendEmail:o,isLoading:t,errorMessage:u}}const gt={class:"bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full overflow-auto max-h-[80vh]"},pt={class:"flex justify-between items-center mb-4"},ht={class:"text-lg font-bold"},ft=["innerHTML"],Dr={__name:"DocumentPreviewModal",props:{isVisible:Boolean,documentData:{type:Object,default:()=>({title:"",content:""})}},emits:["close"],setup(t,{emit:u}){const o=u,i=()=>{o("close")};return(h,r)=>K((a(),B(Ee,null,{default:V(()=>[e("div",gt,[e("div",pt,[e("h2",ht," Previsualización del Documento: "+f(t.documentData.title),1),e("button",{onClick:i},[S(c(Y),{class:"size-6 text-gray-500 hover:text-gray-700"})])]),e("div",{class:"prose max-w-none",innerHTML:t.documentData.content},null,8,ft)])]),_:1},512)),[[Ce,t.isVisible]])}},ue=t=>(ce("data-v-dc50dff1"),t=t(),de(),t),bt={class:"space-y-6"},yt=ue(()=>e("h4",{class:"text-lg font-semibold text-gray-900"},"Relacionar Documentos Jurídicos",-1)),vt={class:"text-sm text-gray-600 mt-1"},xt=ue(()=>e("p",{class:"text-xs text-blue-600 mt-1"}," Solo se muestran documentos completados que te pertenecen ",-1)),_t={class:"bg-gray-50 p-4 rounded-lg"},wt={class:"relative"},$t={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},kt={key:0,class:"flex items-center justify-center py-12"},Dt=ue(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),Ct=ue(()=>e("span",{class:"ml-3 text-gray-600"},"Cargando documentos disponibles...",-1)),Et=[Dt,Ct],St={key:1,class:"text-center py-12"},Pt={class:"mt-2 text-sm font-medium text-gray-900"},Mt={class:"mt-1 text-sm text-gray-500"},Ft={key:2,class:"space-y-4"},Rt={class:"grid grid-cols-1 gap-4"},Ot={class:"flex items-start justify-between"},jt={class:"flex-1 min-w-0"},It={class:"flex items-center space-x-3"},At={class:"flex-shrink-0"},zt={class:"flex-1 min-w-0"},Lt={class:"text-sm font-medium text-gray-900 truncate"},Bt={class:"mt-1 flex items-center space-x-4 text-xs text-gray-500"},Tt={class:"inline-flex items-center"},Ut={key:0},qt={key:0,class:"mt-3 text-sm text-gray-600 line-clamp-2"},Nt={key:1,class:"mt-3 flex flex-wrap gap-1"},Vt={class:"flex-shrink-0 ml-4"},Gt=["onClick","disabled"],Ht={key:1,class:"w-4 h-4 mr-2 animate-spin rounded-full border-2 border-white border-t-transparent"},Wt={key:0,class:"flex justify-center mt-6"},Qt=ue(()=>e("nav",{class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px"},null,-1)),Zt=[Qt],Jt={__name:"RelateDocumentsTab",props:{document:{type:Object,required:!0},availableDocuments:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["relate-document"],setup(t,{emit:u}){const o=t,i=u,h=A(""),r=A(!1),m=N(()=>{if(!o.availableDocuments)return[];let w=o.availableDocuments;if(h.value.trim()){const x=h.value.toLowerCase();w=w.filter(s=>{var n,D;return((n=s.title)==null?void 0:n.toLowerCase().includes(x))||((D=s.content)==null?void 0:D.toLowerCase().includes(x))})}return w}),p=async w=>{r.value=!0;try{await i("relate-document",w,"related")}finally{r.value=!1}},v=w=>({Draft:"bg-gray-500",Published:"bg-green-500",Progress:"bg-blue-500",Completed:"bg-purple-500",FullySigned:"bg-emerald-500",PendingSignatures:"bg-yellow-500"})[w]||"bg-gray-500",_=w=>({Draft:"bg-gray-400",Published:"bg-green-400",Progress:"bg-blue-400",Completed:"bg-purple-400",FullySigned:"bg-emerald-400",PendingSignatures:"bg-yellow-400"})[w]||"bg-gray-400",b=w=>({Draft:"Borrador",Published:"Publicado",Progress:"En Progreso",Completed:"Completado",FullySigned:"Firmado",PendingSignatures:"Pendiente de Firma"})[w]||w,d=w=>{if(!w)return"";try{return new Date(w).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}catch{return w}},k=w=>{if(!w)return"";const x=document.createElement("div");return x.innerHTML=w,x.textContent||x.innerText||""};return(w,x)=>(a(),l("div",bt,[e("div",null,[yt,e("p",vt,' Selecciona documentos para asociar con "'+f(t.document.title)+'" ',1),xt]),e("div",_t,[e("div",wt,[e("div",$t,[S(c(Ne),{class:"h-5 w-5 text-gray-400"})]),K(e("input",{id:"search","onUpdate:modelValue":x[0]||(x[0]=s=>h.value=s),type:"text",placeholder:"Buscar por título...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md text-sm placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[fe,h.value]])])]),t.isLoading?(a(),l("div",kt,Et)):m.value.length===0?(a(),l("div",St,[S(c(oe),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",Pt,f(t.availableDocuments.length===0?"No hay documentos disponibles":"No se encontraron documentos"),1),e("p",Mt,f(t.availableDocuments.length===0?"No tienes otros documentos completados disponibles para relacionar, o todos ya están relacionados con este documento.":"Intenta ajustar tu búsqueda para encontrar documentos."),1)])):(a(),l("div",Ft,[e("div",Rt,[(a(!0),l(G,null,H(m.value,s=>(a(),l("div",{key:s.id,class:"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors"},[e("div",Ot,[e("div",jt,[e("div",It,[e("div",At,[e("div",{class:U(["w-10 h-10 rounded-lg flex items-center justify-center",v(s.state)])},[S(c(Ae),{class:"w-5 h-5 text-white"})],2)]),e("div",zt,[e("h5",Lt,f(s.title),1),e("div",Bt,[e("span",Tt,[e("span",{class:U(["w-2 h-2 rounded-full mr-1.5",_(s.state)])},null,2),T(" "+f(b(s.state)),1)]),s.created_at?(a(),l("span",Ut,f(d(s.created_at)),1)):j("",!0)])])]),s.content?(a(),l("div",qt,f(k(s.content)),1)):j("",!0),s.tags&&s.tags.length>0?(a(),l("div",Nt,[(a(!0),l(G,null,H(s.tags,n=>(a(),l("span",{key:n.id,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800"},f(n.name),1))),128))])):j("",!0)]),e("div",Vt,[e("button",{onClick:n=>p(s),disabled:r.value,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[r.value?(a(),l("div",Ht)):(a(),B(c(Fe),{key:0,class:"w-4 h-4 mr-2"})),T(" "+f(r.value?"Relacionando...":"Relacionar"),1)],8,Gt)])])]))),128))]),m.value.length>=10?(a(),l("div",Wt,Zt)):j("",!0)]))]))}},Xt=ne(Jt,[["__scopeId","data-v-dc50dff1"]]),ye=t=>(ce("data-v-f2ecbaa3"),t=t(),de(),t),Yt={class:"space-y-6"},Kt=ye(()=>e("h4",{class:"text-lg font-semibold text-gray-900"},"Documentos Relacionados",-1)),es={class:"text-sm text-gray-600 mt-1"},ts=ye(()=>e("p",{class:"text-xs text-blue-600 mt-1"}," Solo se muestran documentos completados que te pertenecen ",-1)),ss={class:"bg-gray-50 p-4 rounded-lg"},as={class:"relative"},os={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},ns={key:0,class:"flex items-center justify-center py-12"},rs=ye(()=>e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),ls=ye(()=>e("span",{class:"ml-3 text-gray-600"},"Cargando documentos relacionados...",-1)),is=[rs,ls],cs={key:1,class:"text-center py-12"},ds={class:"mt-2 text-sm font-medium text-gray-900"},us={class:"mt-1 text-sm text-gray-500"},ms={key:2,class:"space-y-4"},gs={class:"grid grid-cols-1 gap-4"},ps={class:"flex items-start justify-between"},hs={class:"flex-1 min-w-0"},fs={class:"flex items-center space-x-3"},bs={class:"flex-shrink-0"},ys={class:"flex-1 min-w-0"},vs={class:"text-sm font-medium text-gray-900 truncate"},xs={class:"mt-1 flex items-center space-x-4 text-xs text-gray-500"},_s={class:"inline-flex items-center"},ws={key:0},$s={class:"mt-3"},ks={class:"flex items-center space-x-2"},Ds={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Cs={key:0,class:"mt-2 text-xs text-gray-500"},Es={key:0,class:"mt-3 text-sm text-gray-600 line-clamp-2"},Ss={key:1,class:"mt-3 flex flex-wrap gap-1"},Ps={class:"flex-shrink-0 ml-4"},Ms=["onClick","disabled"],Fs={key:1,class:"w-4 h-4 mr-2 animate-spin rounded-full border-2 border-red-600 border-t-transparent"},Rs={__name:"RelatedDocumentsTab",props:{document:{type:Object,required:!0},relatedDocuments:{type:Array,default:()=>[]},relationships:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["unrelate-document"],setup(t,{emit:u}){const o=t,i=u,h=A(""),r=A(!1),m=N(()=>{if(!o.relatedDocuments)return[];let x=o.relatedDocuments;if(h.value.trim()){const s=h.value.toLowerCase();x=x.filter(n=>{var D,z;return((D=n.title)==null?void 0:D.toLowerCase().includes(s))||((z=n.content)==null?void 0:z.toLowerCase().includes(s))})}return x}),p=x=>{const s=o.relationships.find(n=>n.source_document===x||n.target_document===x);return s?{id:s.id,created_by:s.created_by_name,created_at:s.created_at}:null},v=async x=>{const s=p(x.id);if(s){r.value=!0;try{await i("unrelate-document",s.id)}finally{r.value=!1}}},_=x=>({Draft:"bg-gray-500",Published:"bg-green-500",Progress:"bg-blue-500",Completed:"bg-purple-500",FullySigned:"bg-emerald-500",PendingSignatures:"bg-yellow-500"})[x]||"bg-gray-500",b=x=>({Draft:"bg-gray-400",Published:"bg-green-400",Progress:"bg-blue-400",Completed:"bg-purple-400",FullySigned:"bg-emerald-400",PendingSignatures:"bg-yellow-400"})[x]||"bg-gray-400",d=x=>({Draft:"Borrador",Published:"Publicado",Progress:"En Progreso",Completed:"Completado",FullySigned:"Firmado",PendingSignatures:"Pendiente de Firma"})[x]||x,k=x=>{if(!x)return"";try{return new Date(x).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}catch{return x}},w=x=>{if(!x)return"";const s=document.createElement("div");return s.innerHTML=x,s.textContent||s.innerText||""};return(x,s)=>(a(),l("div",Yt,[e("div",null,[Kt,e("p",es,' Documentos asociados con "'+f(t.document.title)+'" ',1),ts]),e("div",ss,[e("div",as,[e("div",os,[S(c(Ne),{class:"h-5 w-5 text-gray-400"})]),K(e("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>h.value=n),type:"text",placeholder:"Buscar en documentos relacionados...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md text-sm placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[fe,h.value]])])]),t.isLoading?(a(),l("div",ns,is)):m.value.length===0?(a(),l("div",cs,[S(c(Ze),{class:"mx-auto h-12 w-12 text-gray-400"}),e("h3",ds,f(t.relatedDocuments.length===0?"No hay documentos relacionados":"No se encontraron documentos"),1),e("p",us,f(t.relatedDocuments.length===0?'Este documento aún no tiene documentos relacionados. Utiliza la pestaña "Relacionar Documentos" para crear asociaciones.':"Intenta ajustar tu búsqueda para encontrar documentos relacionados."),1)])):(a(),l("div",ms,[e("div",gs,[(a(!0),l(G,null,H(m.value,n=>{var D;return a(),l("div",{key:n.id,class:"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors"},[e("div",ps,[e("div",hs,[e("div",fs,[e("div",bs,[e("div",{class:U(["w-10 h-10 rounded-lg flex items-center justify-center",_(n.state)])},[S(c(Ae),{class:"w-5 h-5 text-white"})],2)]),e("div",ys,[e("h5",vs,f(n.title),1),e("div",xs,[e("span",_s,[e("span",{class:U(["w-2 h-2 rounded-full mr-1.5",b(n.state)])},null,2),T(" "+f(d(n.state)),1)]),n.created_at?(a(),l("span",ws,f(k(n.created_at)),1)):j("",!0)])])]),e("div",$s,[e("div",ks,[e("span",Ds,[S(c(Fe),{class:"w-3 h-3 mr-1"}),T(" Relacionado ")])]),(D=p(n.id))!=null&&D.created_by?(a(),l("div",Cs," Relacionado por "+f(p(n.id).created_by)+" el "+f(k(p(n.id).created_at)),1)):j("",!0)]),n.content?(a(),l("div",Es,f(w(n.content)),1)):j("",!0),n.tags&&n.tags.length>0?(a(),l("div",Ss,[(a(!0),l(G,null,H(n.tags,z=>(a(),l("span",{key:z.id,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800"},f(z.name),1))),128))])):j("",!0)]),e("div",Ps,[e("button",{onClick:z=>v(n),disabled:r.value,class:"inline-flex items-center justify-center px-3 py-2 border border-red-300 shadow-sm text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 disabled:opacity-50 transition-colors"},[r.value?(a(),l("div",Fs)):(a(),B(c(We),{key:0,class:"w-4 h-4 mr-2"})),T(" "+f(r.value?"Eliminando...":"Desrelacionar"),1)],8,Ms)])])])}),128))])]))]))}},Os=ne(Rs,[["__scopeId","data-v-f2ecbaa3"]]),le={async getDocumentRelationships(t){try{return(await ae(`dynamic-documents/${t}/relationships/`)).data||[]}catch(u){throw console.error("Error fetching document relationships:",u),u}},async getRelatedDocuments(t){try{return(await ae(`dynamic-documents/${t}/related-documents/`)).data||[]}catch(u){throw console.error("Error fetching related documents:",u),u}},async getAvailableDocumentsForRelationship(t){try{return(await ae(`dynamic-documents/${t}/available-for-relationship/`)).data||[]}catch(u){throw console.error("Error fetching available documents:",u),u}},async createDocumentRelationship(t){try{return(await De("dynamic-documents/relationships/create/",t)).data}catch(u){throw console.error("Error creating document relationship:",u),u}},async deleteDocumentRelationship(t){try{const u=await Xe(`dynamic-documents/relationships/${t}/delete/`);return u.status===200||u.status===204}catch(u){throw console.error("Error deleting document relationship:",u),u}}};function js(t){const u=A([]),o=A([]),i=A([]),h=A(!1),r=A(!1),m=A(!1),p=A(!1),v=async()=>{if(t){r.value=!0;try{u.value=await le.getAvailableDocumentsForRelationship(t)}catch(n){throw console.error("Error loading available documents:",n),u.value=[],n}finally{r.value=!1}}},_=async()=>{if(t){m.value=!0;try{o.value=await le.getRelatedDocuments(t)}catch(n){throw console.error("Error loading related documents:",n),o.value=[],n}finally{m.value=!1}}},b=async()=>{if(t){p.value=!0;try{i.value=await le.getDocumentRelationships(t)}catch(n){throw console.error("Error loading relationships:",n),i.value=[],n}finally{p.value=!1}}},d=async n=>{h.value=!0;try{return await le.createDocumentRelationship(n)}catch(D){throw console.error("Error creating relationship:",D),D}finally{h.value=!1}},k=async n=>{h.value=!0;try{return await le.deleteDocumentRelationship(n)}catch(D){throw console.error("Error deleting relationship:",D),D}finally{h.value=!1}},w=(n,D)=>i.value.find(z=>z.source_document===n&&z.target_document===D||z.source_document===D&&z.target_document===n);return{availableDocuments:u,relatedDocuments:o,relationships:i,isLoading:h,isLoadingAvailable:r,isLoadingRelated:m,isLoadingRelationships:p,loadAvailableDocuments:v,loadRelatedDocuments:_,loadRelationships:b,loadAllData:async()=>{await Promise.all([v(),_(),b()])},createRelationship:d,deleteRelationship:k,findRelationship:w,areDocumentsRelated:(n,D)=>!!w(n,D)}}const Is={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center"},As={class:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden"},zs={class:"bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4"},Ls={class:"flex items-center justify-between"},Bs={class:"flex items-center space-x-3"},Ts={class:"p-2 bg-white bg-opacity-20 rounded-lg"},Us=e("h3",{class:"text-lg font-semibold text-white"}," Administrar Asociaciones de Documentos ",-1),qs={class:"text-blue-100 text-sm"},Ns=e("p",{class:"text-blue-200 text-xs mt-1"}," Solo documentos completados de tu propiedad ",-1),Vs={class:"border-b border-gray-200 bg-gray-50"},Gs={class:"flex"},Hs=["onClick"],Ws={class:"flex items-center space-x-2"},Qs={class:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]"},Zs={key:0,class:"flex items-center justify-center py-12"},Js=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),Xs=e("span",{class:"ml-3 text-gray-600"},"Cargando...",-1),Ys=[Js,Xs],Ks={key:1,class:"space-y-6"},ea={key:2,class:"space-y-6"},ta={__name:"DocumentRelationshipsModal",props:{isOpen:{type:Boolean,default:!1},document:{type:Object,required:!0}},emits:["close","refresh"],setup(t,{emit:u}){var I;const o=t,i=u,{availableDocuments:h,relatedDocuments:r,relationships:m,isLoading:p,isLoadingAvailable:v,isLoadingRelated:_,loadAvailableDocuments:b,loadRelatedDocuments:d,loadRelationships:k,createRelationship:w,deleteRelationship:x}=js((I=o.document)==null?void 0:I.id),s=A("relate"),n=N(()=>{var E,M;return[{id:"relate",label:"Relacionar Documentos",icon:Fe,count:(E=h.value)==null?void 0:E.length},{id:"related",label:"Documentos Relacionados",icon:Ze,count:(M=r.value)==null?void 0:M.length}]}),D=()=>{i("close")},z=async()=>{var E;if((E=o.document)!=null&&E.id)try{await Promise.all([b(),d(),k()])}catch(M){console.error("Error loading data:",M),await $("Error al cargar los datos","error")}},O=async E=>{try{await w({source_document:o.document.id,target_document:E.id}),await $("Documentos relacionados exitosamente","success"),await z(),i("refresh")}catch(M){console.error("Error relating document:",M),await $("Error al relacionar los documentos","error")}},C=async E=>{try{await x(E),await $("Relación eliminada exitosamente","success"),await z(),i("refresh")}catch(M){console.error("Error unrelating document:",M),await $("Error al eliminar la relación","error")}};return ie(()=>o.isOpen,E=>{var M;E&&((M=o.document)!=null&&M.id)&&(s.value="relate",z())}),Se(()=>{var E;o.isOpen&&((E=o.document)!=null&&E.id)&&z()}),(E,M)=>t.isOpen?(a(),l("div",Is,[e("div",As,[e("div",zs,[e("div",Ls,[e("div",Bs,[e("div",Ts,[S(c(oe),{class:"w-6 h-6 text-white"})]),e("div",null,[Us,e("p",qs,f(t.document.title),1),Ns])]),e("button",{onClick:D,class:"text-white hover:text-blue-200 transition-colors p-2 hover:bg-white hover:bg-opacity-10 rounded-lg"},[S(c(Y),{class:"w-6 h-6"})])])]),e("div",Vs,[e("nav",Gs,[(a(!0),l(G,null,H(n.value,q=>(a(),l("button",{key:q.id,onClick:J=>s.value=q.id,class:U(["py-3 px-6 text-sm font-medium border-b-2 transition-colors",s.value===q.id?"border-blue-500 text-blue-600 bg-white":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},[e("div",Ws,[(a(),B(Pe(q.icon),{class:"w-4 h-4"})),e("span",null,f(q.label),1),q.count!==void 0?(a(),l("span",{key:0,class:U(["px-2 py-0.5 rounded-full text-xs",s.value===q.id?"bg-blue-100 text-blue-600":"bg-gray-200 text-gray-600"])},f(q.count),3)):j("",!0)])],10,Hs))),128))])]),e("div",Qs,[c(p)?(a(),l("div",Zs,Ys)):s.value==="relate"?(a(),l("div",Ks,[S(Xt,{document:t.document,"available-documents":c(h),"is-loading":c(v),onRelateDocument:O,onRefresh:z},null,8,["document","available-documents","is-loading"])])):s.value==="related"?(a(),l("div",ea,[S(Os,{document:t.document,"related-documents":c(r),relationships:c(m),"is-loading":c(_),onUnrelateDocument:C,onRefresh:z},null,8,["document","related-documents","relationships","is-loading"])])):j("",!0)]),e("div",{class:"bg-gray-50 px-6 py-4 border-t border-gray-200"},[e("div",{class:"flex justify-end space-x-3"},[e("button",{onClick:D,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"}," Cerrar ")])])])])):j("",!0)}},Q=t=>(ce("data-v-72e8b696"),t=t(),de(),t),sa={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},aa={class:"px-6 py-4 border-b border-gray-200"},oa=Q(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gestión de Membrete",-1)),na={class:"text-sm text-gray-500 mt-1"},ra={class:"p-6 overflow-y-auto flex-grow"},la={key:0,class:"text-center py-10"},ia=Q(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),ca={class:"mt-4 text-gray-500"},da={key:1,class:"space-y-6"},ua={key:0,class:"space-y-4"},ma=Q(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete Actual",-1)),ga={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},pa=["src"],ha={class:"mt-4 flex justify-center space-x-3"},fa=["disabled"],ba={key:1,class:"text-center py-8"},ya=Q(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete",-1)),va=Q(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," Este documento no tiene una imagen de membrete configurada. ",-1)),xa={class:"space-y-4"},_a={class:"text-lg font-medium text-gray-900"},wa={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},$a={key:0},ka={class:"mt-4"},Da=Q(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, máximo 10MB ",-1)),Ca=Q(()=>e("p",{class:"text-xs text-gray-400 mt-1"}," Dimensiones ideales: 612 × 612 píxeles (8.5:11 Carta) ",-1)),Ea={key:1,class:"space-y-4"},Sa={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Pa={class:"text-gray-400"},Ma={key:0,class:"mt-4"},Fa=["src"],Ra={class:"flex justify-center space-x-3"},Oa=["disabled"],ja={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Ia={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},Aa={class:"flex items-center space-x-2"},za=Q(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete",-1)),La=Q(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"📐 Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"612 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"612 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporción:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"±10%")])])])],-1)),Ba=Q(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🎨 Distribución Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"⚠️ ZONA CRÍTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mantén semi-transparente. El texto del documento se superpone aquí.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, teléfonos, emails, información de contacto.")])])])])])],-1)),Ta=Q(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🔧 Consideraciones Técnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Posicionamiento:"),T(" La imagen se centra automáticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Transparencia:"),T(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Márgenes:"),T(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Resolución:"),T(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"⚠️"),e("span",null,[e("strong",null,"Zona crítica:"),T(" Evita elementos gráficos densos en el centro (300-400px de altura)")])])])])],-1)),Ua=Q(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"💡 Tips de Diseño Rápido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"• Si solo tienes header, ubícalo en los primeros 120-150px"),e("div",null,"• El resto de la imagen debe ser transparente o blanco"),e("div",null,"• Para footer, usa los últimos 80-120px"),e("div",null,"• El texto se superpone en toda la imagen, mantén el centro claro")])],-1)),qa={key:3,class:"space-y-2"},Na={class:"flex"},Va={class:"text-sm text-yellow-700"},Ga={__name:"LetterheadModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close","uploaded","deleted"],setup(t,{emit:u}){const o=t,i=u,h=be(),r=A(!1),m=A(""),p=A(!1),v=A(!1),_=A(null),b=A(null),d=A(null),k=A([]),w=A(null),x=A(!1),s=N(()=>{var F;return(F=o.document)==null?void 0:F.id}),n=()=>{O(),i("close")},D=F=>{const R=F.target.files[0];if(!R)return;if(!R.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(R.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}_.value=R,k.value=[];const Z=new FileReader;Z.onload=W=>{b.value=W.target.result;const X=new Image;X.onload=()=>{z(X.width,X.height)},X.src=W.target.result},Z.readAsDataURL(R)},z=(F,R)=>{const re=F/R,ee=612/612,_e=Math.abs(re-ee)/ee;if(F===612&&R===612){k.value.push("✅ Dimensiones perfectas: 612 × 612 píxeles");return}_e<=.1?(k.value.push(`ℹ️ Buenas proporciones detectadas: ${F} × ${R} píxeles (${re.toFixed(3)})`),(F!==612||R!==612)&&k.value.push("💡 Para mejores resultados, usa exactamente 612 × 612 píxeles")):(k.value.push(`⚠️ Proporciones no ideales: ${F} × ${R} píxeles (${re.toFixed(3)})`),k.value.push(`🎯 Proporciones recomendadas: ${ee.toFixed(3)} (8.5:11)`),k.value.push("📐 Considera redimensionar tu imagen a 612 × 612 píxeles")),(F<300||R<300)&&k.value.push("⚠️ Imagen muy pequeña - puede verse pixelada en documentos"),(F>1200||R>1600)&&k.value.push("ℹ️ Imagen muy grande - se redimensionará automáticamente")},O=()=>{_.value=null,b.value=null,k.value=[],x.value=!1,w.value&&(w.value.value="")},C=async()=>{var F;if(!(!_.value||!s.value)){p.value=!0,k.value=[];try{const R=await h.uploadLetterheadImage(s.value,_.value);(F=R.data)!=null&&F.warnings&&R.data.warnings.length>0&&(k.value=R.data.warnings),await I(),O(),i("uploaded",R.data)}catch(R){console.error("Error uploading letterhead:",R),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{p.value=!1}}},I=async()=>{if(s.value)try{const F=await h.getLetterheadImage(s.value);F.data&&(d.value=URL.createObjectURL(F.data))}catch{d.value=null}},E=()=>{confirm("¿Estás seguro de que deseas eliminar la imagen de membrete?")&&M()},M=async()=>{if(s.value){v.value=!0;try{await h.deleteLetterheadImage(s.value),d.value&&URL.revokeObjectURL(d.value),d.value=null,i("deleted")}catch(F){console.error("Error deleting letterhead:",F),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{v.value=!1}}},q=()=>{var F;if(d.value){const R=document.createElement("a");R.href=d.value,R.download=`membrete-${((F=o.document)==null?void 0:F.title)||"documento"}.png`,document.body.appendChild(R),R.click(),document.body.removeChild(R)}},J=()=>{d.value=null},ve=F=>{if(F===0)return"0 Bytes";const R=1024,Z=["Bytes","KB","MB","GB"],W=Math.floor(Math.log(F)/Math.log(R));return parseFloat((F/Math.pow(R,W)).toFixed(2))+" "+Z[W]};ie(()=>o.isVisible,F=>{F&&s.value&&I()}),ie(()=>o.document,F=>{F&&o.isVisible&&I()});const xe=()=>{d.value&&URL.revokeObjectURL(d.value),b.value&&URL.revokeObjectURL(b.value)};return Se(()=>{o.isVisible&&s.value&&I()}),ze(xe),(F,R)=>K((a(),B(Ee,null,{default:V(()=>{var Z;return[e("div",sa,[e("div",aa,[oa,e("p",na," Documento: "+f(((Z=t.document)==null?void 0:Z.title)||"Cargando..."),1),e("button",{onClick:n,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[S(c(Y),{class:"h-6 w-6"})])]),e("div",ra,[r.value?(a(),l("div",la,[ia,e("p",ca,f(m.value),1)])):(a(),l("div",da,[d.value?(a(),l("div",ua,[ma,e("div",ga,[e("img",{src:d.value,alt:"Membrete actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:J},null,40,pa),e("div",ha,[e("button",{onClick:q,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[S(c(it),{class:"h-4 w-4 mr-2"}),T(" Descargar ")]),e("button",{onClick:E,disabled:v.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[S(c(We),{class:"h-4 w-4 mr-2"}),T(" "+f(v.value?"Eliminando...":"Eliminar"),1)],8,fa)])])])):(a(),l("div",ba,[S(c(oe),{class:"mx-auto h-12 w-12 text-gray-400"}),ya,va])),e("div",xa,[e("h3",_a,f(d.value?"Reemplazar Membrete":"Subir Membrete"),1),e("div",wa,[e("input",{ref_key:"fileInput",ref:w,type:"file",accept:".png",onChange:D,class:"hidden"},null,544),_.value?(a(),l("div",Ea,[e("div",Sa,[S(c(Ge),{class:"h-5 w-5 text-green-500"}),e("span",null,f(_.value.name),1),e("span",Pa,"("+f(ve(_.value.size))+")",1)]),b.value?(a(),l("div",Ma,[e("img",{src:b.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,Fa)])):j("",!0),e("div",Ra,[e("button",{onClick:O,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:C,disabled:p.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[p.value?(a(),l("div",ja)):(a(),B(c(Ve),{key:0,class:"h-4 w-4 mr-2"})),T(" "+f(p.value?"Subiendo...":"Subir Imagen"),1)],8,Oa)])])):(a(),l("div",$a,[S(c(Qe),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",ka,[e("button",{onClick:R[0]||(R[0]=W=>F.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG "),e("button",{onClick:R[1]||(R[1]=W=>x.value=!x.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[S(c(je),{class:"h-4 w-4 mr-2"}),T(" "+f(x.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),Da,Ca]))])]),x.value?(a(),l("div",Ia,[e("div",Aa,[S(c(je),{class:"h-6 w-6 text-blue-600"}),za]),La,Ba,Ta,Ua])):j("",!0),k.value.length>0?(a(),l("div",qa,[(a(!0),l(G,null,H(k.value,(W,X)=>(a(),l("div",{key:X,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",Na,[S(c(ct),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",Va,f(W),1)])]))),128))])):j("",!0)]))])])]}),_:1},512)),[[Ce,t.isVisible]])}},Ha=ne(Ga,[["__scopeId","data-v-72e8b696"]]),Wa={class:"py-1"},Qa=["disabled","onClick"],Za={key:1,class:"submenu-container relative"},Ja=["onMouseenter","onMouseleave"],Xa={class:"flex items-center"},Ya=["onMouseenter","onMouseleave"],Ka={class:"py-1"},eo=["disabled","onClick"],to={key:2,class:"border-t border-gray-100"},so={__name:"HierarchicalMenu",props:{menuItems:{type:Array,required:!0,default:()=>[]},menuPosition:{type:String,default:"right-0 left-auto sm:left-0 sm:right-auto"}},emits:["menu-action","modalOpen","navigation"],setup(t,{emit:u}){const o=u,i=A(null);let h=null;const r=v=>{h&&(clearTimeout(h),h=null),i.value=v},m=v=>{h=setTimeout(()=>{i.value===v&&(i.value=null)},150)},p=v=>{i.value=null,o("menu-action",v)};return(v,_)=>(a(),B(c(Te),{as:"div",class:"relative inline-block text-left menu-container"},{default:V(()=>[S(c(Le),{class:"flex items-center justify-center w-8 h-8 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors focus:outline-none focus:ring-0"},{default:V(()=>[S(c(He),{class:"w-5 h-5","aria-hidden":"true"})]),_:1}),S(we,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:V(()=>[S(c(Be),{class:U(["absolute z-50 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",t.menuPosition])},{default:V(()=>[e("div",Wa,[(a(!0),l(G,null,H(t.menuItems,b=>(a(),l(G,{key:b.id||b.label},[b.children?(a(),l("div",Za,[S(c($e),null,{default:V(()=>[e("div",{class:"w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition cursor-pointer flex items-center justify-between",onMouseenter:d=>r(b.id),onMouseleave:d=>m(b.id)},[e("div",Xa,f(b.label),1),S(c(lt),{class:"w-4 h-4 text-gray-400"})],40,Ja)]),_:2},1024),S(we,{"enter-active-class":"transition ease-out duration-150","enter-from-class":"transform opacity-0 translate-x-2 scale-95","enter-to-class":"transform opacity-100 translate-x-0 scale-100","leave-active-class":"transition ease-in duration-100","leave-from-class":"transform opacity-100 translate-x-0 scale-100","leave-to-class":"transform opacity-0 translate-x-2 scale-95"},{default:V(()=>[i.value===b.id?(a(),l("div",{key:0,class:"absolute left-full top-0 mt-0 w-52 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none z-60",onMouseenter:d=>r(b.id),onMouseleave:d=>m(b.id)},[e("div",Ka,[(a(!0),l(G,null,H(b.children,d=>(a(),l("button",{key:d.label,class:U(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":d.disabled,"cursor-pointer":!d.disabled}]),disabled:d.disabled,onClick:k=>p(d.action)},[d.disabled?(a(),B(c(ke),{key:0,class:"size-4 text-gray-400 inline mr-2","aria-hidden":"true"})):j("",!0),T(" "+f(d.label),1)],10,eo))),128))])],40,Ya)):j("",!0)]),_:2},1024)])):(a(),B(c($e),{key:0},{default:V(()=>[e("button",{class:U(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":b.disabled,"cursor-pointer":!b.disabled}]),disabled:b.disabled,onClick:d=>p(b.action)},[b.disabled?(a(),B(c(ke),{key:0,class:"size-5 text-gray-400 inline mr-2","aria-hidden":"true"})):j("",!0),T(" "+f(b.label),1)],10,Qa)]),_:2},1024)),b.divider?(a(),l("div",to)):j("",!0)],64))),128))])]),_:1},8,["class"])]),_:1})]),_:1}))}},ao=ne(so,[["__scopeId","data-v-60d5f9c4"]]);function oo(t,u){if(!t||t.length===0)return[];const o={editing:{id:"editing",label:"Edición y gestión",children:[],priority:1},downloads:{id:"downloads",label:"Descargas",children:[],priority:2},communication:{id:"communication",label:"Comunicación",children:[],priority:3},states:{id:"states",label:"Estados del documento",children:[],priority:4},signatures:{id:"signatures",label:"Firmas",children:[],priority:5},actions:{id:"actions",label:"Acciones",children:[],priority:6}};t.forEach(r=>{const m={...r};switch(r.action){case"edit":o.editing.children.push(m);break;case"permissions":o.editing.children.push(m);break;case"copy":o.editing.children.push(m);break;case"downloadPDF":case"downloadWord":case"downloadSignedDocument":o.downloads.children.push(m);break;case"email":o.communication.children.push(m);break;case"publish":case"draft":case"formalize":o.states.children.push(m);break;case"viewSignatures":case"sign":o.signatures.children.push(m);break;case"preview":case"delete":case"removeFromFolder":case"useDocument":o.actions.children.push(m);break;default:o.actions.children.push(m)}});const i=Object.values(o).filter(r=>r.children.length>0).sort((r,m)=>r.priority-m.priority),h=[];return i.forEach((r,m)=>{r.children.length===1?h.push(r.children[0]):h.push(r),m<i.length-1&&h.push({divider:!0})}),h}function no(t){return t&&t.length>6}const Je=t=>(ce("data-v-a77a1fb5"),t=t(),de(),t),ro=["data-document-id"],lo={class:"flex justify-between items-start mb-3"},io={class:"flex items-center gap-2"},co={class:"py-1"},uo=["disabled","onClick"],mo={class:"space-y-2"},go={class:"text-lg font-semibold text-gray-900 leading-tight"},po={key:0,class:"text-sm text-gray-600 leading-relaxed"},ho={key:1,class:"pt-2"},fo={class:"flex items-center gap-2 flex-wrap"},bo=Je(()=>e("span",{class:"text-xs font-medium text-gray-500"},"Etiquetas:",-1)),yo={class:"flex items-center gap-1.5"},vo=["title"],xo={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-50"},_o={class:"bg-gray-900 text-white text-xs rounded-lg py-1.5 px-2.5 whitespace-nowrap shadow-lg"},wo=Je(()=>e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-[4px] border-r-[4px] border-t-[4px] border-transparent border-t-gray-900"},null,-1)),$o={__name:"BaseDocumentCard",props:{document:{type:Object,required:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},highlightedDocId:{type:[String,Number],default:null},showTags:{type:Boolean,default:!0},additionalClasses:{type:[String,Array,Object],default:""},statusIcon:{type:[String,Object,Function],default:null},statusText:{type:String,default:null},statusBadgeClasses:{type:[String,Object,Array],default:null},menuOptions:{type:Array,default:null},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},promptDocuments:{type:Boolean,default:!1},enableModals:{type:Boolean,default:!0},editModalComponent:{type:String,default:"UseDocumentByClient"},editRoute:{type:String,default:null},enableSignatures:{type:Boolean,default:!0},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null}},emits:["click","refresh","remove-from-folder","modal-open","navigation","menuAction"],setup(t,{emit:u}){const o=Me(),i=t,h=u,{activeModals:r,openModal:m,closeModal:p,getUserRole:v}=ir(i.documentStore,i.userStore),{handlePreviewDocument:_,deleteDocument:b,downloadPDFDocument:d,downloadWordDocument:k,copyDocument:w,publishDocument:x,moveToDraft:s,formalizeDocument:n,signDocument:D,downloadSignedDocument:z}=cr(i.documentStore,i.userStore,h),O=g=>{g.target.closest(".menu-container")||h("click",i.document,g)},C=()=>{h("refresh")},I={default:{getMenuOptions:(g,y)=>{const P=[];return P.push({label:"Usar Formato",action:"useDocument"}),P.push({label:"Gestionar Membrete",action:"letterhead"}),y==="folder"&&P.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),P}},client:{getMenuOptions:(g,y)=>{const P=[];return g.state==="Completed"?P.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Editar Formulario",action:"editForm"},{label:"Editar Documento",action:"editDocument"}]}):P.push({label:"Completar",action:"editForm"}),g.state==="Completed"&&P.push({label:"Previsualizar",action:"preview"}),P.push({label:"Eliminar",action:"delete"}),P.push({label:"Gestionar Membrete",action:"letterhead"}),P.push({label:"Administrar Asociaciones",action:"relationships"}),g.state==="Completed"&&P.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar",action:"email"}),y==="folder"&&P.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),P}},lawyer:{getMenuOptions:(g,y)=>{const P=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Administrar Asociaciones",action:"relationships"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}];return g.state==="Draft"?P.push({label:"Publicar",action:"publish",disabled:!_e(g)}):g.state==="Published"&&(P.push({label:"Mover a Borrador",action:"draft"}),P.push({label:"Formalizar y Agregar Firmas",action:"formalize"})),(g.state==="Completed"||g.state==="Published")&&P.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),g.requires_signature&&(P.push({label:"Ver Firmas",action:"viewSignatures"}),Re(g)&&P.push({label:"Firmar documento",action:"sign"})),P}},signatures:{getMenuOptions:(g,y)=>{const P=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}];return g.requires_signature&&(g.state==="PendingSignatures"||g.state==="FullySigned")&&P.push({label:"Estado de las firmas",action:"viewSignatures"}),Re(g)&&P.push({label:"Firmar documento",action:"sign"}),g.state==="FullySigned"&&P.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),g.state==="PendingSignatures"&&P.push({label:"Descargar PDF",action:"downloadPDF"}),y==="folder"&&P.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),P}}},E=N(()=>{if(i.menuOptions!==null)return i.menuOptions;if(i.showMenuOptions===!1)return[];if(i.showMenuOptions===!0){const y=I[i.cardType];return y?y.getMenuOptions(i.document,i.cardContext):[]}const g=I[i.cardType];return g?g.getMenuOptions(i.document,i.cardContext):[]}),M=N(()=>i.promptDocuments?"right-0 left-auto sm:right-auto sm:left-0 sm:-translate-x-[calc(100%-24px)]":"right-0 left-auto sm:left-0 sm:right-auto"),q=N(()=>!E.value||E.value.length===0?[]:ee(E.value)?E.value:oo(E.value,i.document)),J=N(()=>{switch(i.document.state){case"Completed":case"Published":case"FullySigned":return"border-green-400 bg-green-50/50 shadow-green-100";case"Progress":case"Draft":return"border-blue-300 bg-blue-50/30 shadow-blue-100";case"PendingSignatures":return"border-yellow-400 bg-yellow-50/50 shadow-yellow-100";default:return"border-gray-200 bg-white"}}),ve=N(()=>{if(!i.highlightedDocId||String(i.document.id)!==String(i.highlightedDocId))return"";const g=i.document.state;return g==="Published"||g==="FullySigned"||g==="Completed"?"shadow-lg animate-pulse-highlight-green":g==="PendingSignatures"?"shadow-lg animate-pulse-highlight-yellow":"shadow-lg animate-pulse-highlight-blue"}),xe=N(()=>{if(i.statusIcon)return i.statusIcon;switch(i.document.state){case"Published":case"FullySigned":case"Completed":return Ge;case"Draft":case"Progress":case"PendingSignatures":default:return dt}}),F=N(()=>{if(i.statusText)return i.statusText;switch(i.document.state){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return"Desconocido"}}),R=N(()=>{if(i.statusBadgeClasses)return i.statusBadgeClasses;switch(i.document.state){case"Published":case"FullySigned":case"Completed":return"bg-green-100 text-green-700 border border-green-200";case"Draft":case"Progress":return"bg-blue-100 text-blue-700 border border-blue-200";case"PendingSignatures":return"bg-yellow-100 text-yellow-700 border border-yellow-200";default:return"bg-gray-100 text-gray-700 border border-gray-200"}}),Z=async(g,y)=>{try{switch(g){case"edit":await W(y);break;case"editForm":await X(y);break;case"editDocument":await re(y);break;case"permissions":m("permissions",y);break;case"relationships":m("relationships",y);break;case"preview":await _(y);break;case"delete":await b(y);break;case"downloadPDF":await d(y);break;case"downloadWord":await k(y);break;case"email":m("email",y);break;case"copy":await w(y);break;case"publish":await x(y);break;case"draft":await s(y);break;case"formalize":await n(y);break;case"viewSignatures":m("signatures",y);break;case"sign":await D(y,m);break;case"downloadSignedDocument":await z(y);break;case"removeFromFolder":h("remove-from-folder",y);break;case"useDocument":h("click",y);break;case"use":h("menuAction",g,y);break;case"letterhead":m("letterhead",y);break;default:console.warn("Unknown action:",g)}}catch(P){console.error(`Error executing action ${g}:`,P)}},W=async g=>{if(i.editRoute){const y=encodeURIComponent(g.title.trim()),P=i.editRoute.replace(":id",g.id).replace(":title",y);o.push(P)}else m("edit",g,{userRole:v()})},X=async g=>{m("edit",g,{userRole:v()})},re=async g=>{o.push(`/dynamic_document_dashboard/client/editor/edit/${g.id}`)},ee=g=>g&&g.some(y=>y.children&&y.children.length>0),_e=g=>!g.variables||g.variables.length===0?!0:g.variables.every(y=>y.name_es&&y.name_es.trim().length>0),Re=g=>{var L,te;if(!g.requires_signature||g.state!=="PendingSignatures"||!g.signatures||g.signatures.length===0)return!1;const y=(te=(L=i.userStore)==null?void 0:L.currentUser)==null?void 0:te.email,P=g.signatures.find(ge=>ge.signer_email===y);return!(!P||P.signed)};return(g,y)=>{var P;return a(),l(G,null,[e("div",{"data-document-id":t.document.id,class:U(["relative bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 p-4 cursor-pointer focus:outline-none focus:ring-0",[J.value,ve.value,t.additionalClasses]]),onClick:O},[e("div",lo,[e("div",io,[se(g.$slots,"status-badge",{},()=>[e("div",{class:U(["inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium",R.value])},[(a(),B(Pe(xe.value),{class:"w-3.5 h-3.5"})),e("span",null,f(F.value),1)],2)],!0),se(g.$slots,"additional-badges",{},void 0,!0)]),se(g.$slots,"right-action",{},()=>[c(no)(E.value)||ee(E.value)?(a(),B(ao,{key:0,"menu-items":q.value,"menu-position":M.value,onMenuAction:y[0]||(y[0]=L=>Z(L,t.document))},null,8,["menu-items","menu-position"])):E.value&&E.value.length>0?(a(),B(c(Te),{key:1,as:"div",class:"relative inline-block text-left menu-container"},{default:V(()=>[S(c(Le),{class:"flex items-center justify-center w-8 h-8 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors focus:outline-none focus:ring-0"},{default:V(()=>[S(c(He),{class:"w-5 h-5","aria-hidden":"true"})]),_:1}),S(we,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:V(()=>[S(c(Be),{class:U(["absolute z-50 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",M.value])},{default:V(()=>[e("div",co,[(a(!0),l(G,null,H(E.value,L=>(a(),B(c($e),{key:L.label},{default:V(()=>[e("button",{class:U(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":L.disabled,"cursor-pointer":!L.disabled}]),disabled:L.disabled,onClick:te=>Z(L.action,t.document)},[L.disabled?(a(),B(c(ke),{key:0,class:"size-5 text-gray-400 inline mr-2","aria-hidden":"true"})):j("",!0),T(" "+f(L.label),1)],10,uo)]),_:2},1024))),128))])]),_:1},8,["class"])]),_:1})]),_:1})):j("",!0)],!0)]),e("div",mo,[e("h3",go,f(t.document.title),1),t.document.description?(a(),l("p",po,f(t.document.description),1)):j("",!0),se(g.$slots,"additional-content",{},void 0,!0),t.showTags&&t.document.tags&&t.document.tags.length>0?(a(),l("div",ho,[e("div",fo,[bo,e("div",yo,[(a(!0),l(G,null,H(t.document.tags,L=>{var te,ge;return a(),l("div",{key:L.id,class:"group relative"},[e("div",{class:"w-5 h-5 rounded-full cursor-pointer transition-all duration-200 hover:scale-110 hover:ring-2 hover:ring-offset-1 shadow-sm",style:Ye({backgroundColor:((te=c(Oe)(L.color_id))==null?void 0:te.hex)||"#9CA3AF",boxShadow:`0 0 0 1px ${((ge=c(Oe)(L.color_id))==null?void 0:ge.dark)||"#6B7280"}40`}),title:L.name},null,12,vo),e("div",xo,[e("div",_o,[T(f(L.name)+" ",1),wo])])])}),128))])])])):j("",!0)]),se(g.$slots,"footer",{},void 0,!0),se(g.$slots,"additional-actions",{},void 0,!0)],10,ro),c(r).edit.isOpen?(a(),B(c(jo),{key:0,document:c(r).edit.document,"user-role":c(v)(),onClose:y[1]||(y[1]=L=>c(p)("edit"))},null,8,["document","user-role"])):j("",!0),c(r).email.isOpen?(a(),B(c(an),{key:1,document:c(r).email.document,onClose:y[2]||(y[2]=L=>c(p)("email"))},null,8,["document"])):j("",!0),c(r).signatures.isOpen?(a(),B(c(Tn),{key:2,"document-id":(P=c(r).signatures.document)==null?void 0:P.id,onClose:y[3]||(y[3]=L=>c(p)("signatures")),onRefresh:C},null,8,["document-id"])):j("",!0),c(r).electronicSignature.isOpen?(a(),B(c(Gn),{key:3,onClose:y[4]||(y[4]=L=>c(p)("electronicSignature"))})):j("",!0),c(r).permissions.isOpen?(a(),B(c(lr),{key:4,"is-open":c(r).permissions.isOpen,document:c(r).permissions.document,onClose:y[5]||(y[5]=L=>c(p)("permissions")),onSaved:C},null,8,["is-open","document"])):j("",!0),c(r).letterhead.isOpen?(a(),B(Ha,{key:5,"is-visible":c(r).letterhead.isOpen,document:c(r).letterhead.document,onClose:y[6]||(y[6]=L=>c(p)("letterhead")),onUploaded:C,onDeleted:C},null,8,["is-visible","document"])):j("",!0),c(r).relationships.isOpen?(a(),B(ta,{key:6,"is-open":c(r).relationships.isOpen,document:c(r).relationships.document,onClose:y[7]||(y[7]=L=>c(p)("relationships")),onRefresh:C},null,8,["is-open","document"])):j("",!0)],64)}}},Cr=ne($o,[["__scopeId","data-v-a77a1fb5"]]),ko={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Do={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Co={class:"flex justify-end"},Eo=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[T(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),So={class:"mt-2"},Po={class:"flex gap-2 mt-2.5"},Mo=["disabled"],Fo=e("span",null,"Actualizar nombre",-1),Ro=[Fo],Oo=["disabled"],jo={__name:"EditDocumentModal",props:{document:{type:Object,required:!0},userRole:{type:String,default:"client"}},emits:["close"],setup(t,{emit:u}){const o=t,i=Me(),h=be(),r=u,m=A(""),p=A(""),v=()=>{r("close")};Ke(()=>{var s,n;o.document?(m.value=((s=o.document)==null?void 0:s.title)||"",p.value=((n=o.document)==null?void 0:n.title)||""):(m.value="",p.value="")});const _=s=>{s.key==="Escape"&&v()};Se(()=>{document.addEventListener("keydown",_)}),ze(()=>{document.removeEventListener("keydown",_)});const b=N(()=>m.value.trim().length>0),d=N(()=>{var s;return!!((s=o.document)!=null&&s.id)}),k=N(()=>d.value&&m.value.trim()!==p.value.trim()&&m.value.trim().length>0);async function w(){if(d.value&&k.value)try{const s={title:m.value.trim()};await h.updateDocument(o.document.id,s),p.value=m.value.trim(),$("Nombre del documento actualizado exitosamente.","success"),v()}catch(s){console.error("Error updating document name:",s),$("Error al actualizar el nombre del documento.","error")}}function x(){var n;const s=encodeURIComponent(m.value.trim());(n=o.document)!=null&&n.id&&!d.value?o.userRole==="lawyer"?i.push(`/dynamic_document_dashboard/lawyer/editor/create/${s}`):i.push(`/dynamic_document_dashboard/document/use/creator/${o.document.id}/${s}`):d.value?o.userRole==="lawyer"?i.push(`/dynamic_document_dashboard/lawyer/editor/edit/${o.document.id}`):i.push(`/dynamic_document_dashboard/document/use/editor/${o.document.id}/${s}`):$("Error: No se pudo continuar. Documento no seleccionado.","error")}return(s,n)=>(a(),l("div",ko,[e("div",Do,[e("div",Co,[e("button",{onClick:v},[S(c(Y),{class:"size-6"})])]),e("form",{onSubmit:he(x,["prevent"])},[e("div",null,[Eo,e("div",So,[K(e("input",{"onUpdate:modelValue":n[0]||(n[0]=D=>m.value=D),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[fe,m.value]])])]),e("div",Po,[d.value?(a(),l("button",{key:0,type:"button",onClick:w,disabled:!k.value,class:U(["p-2.5 text-sm font-medium rounded-md flex gap-2",k.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Ro,10,Mo)):j("",!0),e("button",{type:"submit",class:U(["p-2.5 text-sm font-medium rounded-md flex gap-2",b.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!b.value},[e("span",null,f(d.value?"Editar Documento":"Continuar"),1)],10,Oo)])],32)])]))}},Io={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Ao={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},zo={class:"flex justify-end"},Lo=e("label",{for:"email",class:"block text-base font-medium leading-6 text-primary"},[T(" Correo electrónico "),e("span",{class:"text-red-500"},"*")],-1),Bo={class:"mt-2"},To={class:"mt-4"},Uo=e("label",{for:"files",class:"block text-base font-medium leading-6 text-primary"}," Anexos ",-1),qo={key:0,class:"text-center"},No={class:"mt-4 flex text-sm/6 text-gray-600"},Vo={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"},Go=e("span",null,"Sube un archivo",-1),Ho=e("p",{class:"pl-1"},"o arrastra y suelta",-1),Wo=e("p",{class:"text-xs/5 text-gray-600"}," PNG, JPG, PDF, DOCX de hasta 20MB ",-1),Qo={key:1,class:"w-full flex flex-wrap gap-3"},Zo=["onMouseenter","onMouseleave"],Jo=["onClick"],Xo={class:"text-center text-xs truncate w-20"},Yo=["disabled"],Ko=e("span",null,"Enviar",-1),en=[Ko],tn="dynamic-documents/send_email_with_attachments/",sn=20*1024*1024,an={__name:"SendDocumentModal",props:{document:{type:Object,required:!0}},emits:["close"],setup(t,{emit:u}){const o=u,{sendEmail:i}=mt(),h=A(null),r=t,m=()=>{p.email="",v.value=[],h.value=null},p=et({email:""}),v=A([]),_=O=>{const C=Array.from(O.target.files);d(C),O.target.value=null},b=O=>{const C=Array.from(O.dataTransfer.files);d(C)},d=O=>{let C=v.value.reduce((I,E)=>I+E.file.size,0);O.forEach(I=>{if(I.size>sn){$(`The file "${I.name}" exceeds the 20 MB limit.`,"warning");return}const E=I.name.split(".").pop().toLowerCase();let M="",q={general:"",xMark:""};switch(E){case"png":case"jpg":case"jpeg":M=Qe,q.general="border-gray-200 text-gray-400",q.xMark="bg-gray-400";break;case"pdf":M=oe,q.general="border-red-600/20 text-red-600/60",q.xMark="bg-red-600/60";break;case"docx":M=oe,q.general="border-blue-600/20 text-blue-600/60",q.xMark="bg-blue-600/60";break;default:$("Unsupported file type. Only PDF, DOCX, JPG, and PNG are allowed.","warning");return}v.value.push({name:I.name,icon:M,style:q,hover:!1,file:I}),C+=I.size})},k=O=>{v.value.splice(O,1)},w=O=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(O),x=N(()=>w(p.email)),s=N(()=>x.value),n=async O=>{try{const C=await ae(`dynamic-documents/${O}/download-pdf/`,"blob");if(!C||!C.data)throw new Error("Invalid response from server");return new File([C.data],`document_${O}.pdf`,{type:"application/pdf"})}catch(C){return console.error("Error downloading PDF:",C),$("No se pudo descargar el documento PDF.","error"),null}};ie(()=>r.document,O=>{O&&Object.keys(O).length>0&&O.id&&n(O.id)},{immediate:!0});const D=async()=>{try{if(r.document.id){const C=await n(r.document.id);C&&v.value.push({name:C.name,file:C,icon:oe,style:{general:"border-blue-600/20 text-blue-600/60",xMark:"bg-blue-600/60"},hover:!1})}const O=v.value.map(C=>C.file);await i(tn,p.email,r.document.title,"Attached is the requested document along with additional attachments.",O,{documentId:r.document.id})}catch(O){console.error("Error sending the email:",O)}finally{z()}},z=()=>{m(),o("close")};return(O,C)=>(a(),l("div",Io,[e("div",Ao,[e("div",zo,[e("button",{onClick:C[0]||(C[0]=I=>z())},[S(c(Y),{class:"size-6"})])]),e("form",{onSubmit:he(D,["prevent"])},[e("div",null,[Lo,e("div",Bo,[K(e("input",{"onUpdate:modelValue":C[1]||(C[1]=I=>p.email=I),type:"text",name:"email",id:"email",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[fe,p.email]])])]),e("div",To,[Uo,e("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 bg-white px-6 py-10",onDragover:C[2]||(C[2]=he(()=>{},["prevent"])),onDrop:he(b,["prevent"])},[v.value.length<1?(a(),l("div",qo,[S(c(Ve),{class:"mx-auto size-12 text-gray-300","aria-hidden":"true"}),e("div",No,[e("label",Vo,[Go,e("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",onChange:_},null,32)]),Ho]),Wo])):(a(),l("div",Qo,[(a(!0),l(G,null,H(v.value,(I,E)=>(a(),l("div",{key:E,class:U(["relative p-4 grid rounded-md bg-white border-2",I.style.general]),onMouseenter:M=>I.hover=!0,onMouseleave:M=>I.hover=!1},[K(e("div",{class:U(["absolute p-0.5 mt-2 ml-2 rounded-full",I.style.xMark]),onClick:M=>k(E)},[S(c(Y),{class:"size-3 text-white"})],10,Jo),[[Ce,I.hover]]),(a(),B(Pe(I.icon),{class:"size-12 mx-auto"})),e("span",Xo,f(I.name),1)],42,Zo))),128))]))],32)]),e("button",{type:"submit",class:U(["mt-4 p-2.5 text-sm font-medium rounded-md flex gap-2",s.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!s.value},en,10,Yo)],32)])]))}},me=t=>(ce("data-v-33bff9d6"),t=t(),de(),t),on={class:"fixed inset-0 z-50 flex items-center justify-center"},nn={class:"relative bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col"},rn=me(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Estado de firmas del documento",-1)),ln=me(()=>e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),cn=[ln],dn={class:"p-6 overflow-y-auto flex-grow"},un={key:0,class:"text-center py-10"},mn=me(()=>e("div",{class:"spinner"},null,-1)),gn=me(()=>e("p",{class:"mt-4 text-gray-500"},"Cargando información de firmas...",-1)),pn=[mn,gn],hn={key:1},fn={class:"mb-4"},bn={class:"text-lg font-medium text-gray-900"},yn={class:"text-sm text-gray-500"},vn={class:"inline-flex items-center"},xn={key:0,class:"text-sm text-gray-500 mt-1"},_n={class:"text-sm text-gray-500 mt-1"},wn={class:"mt-6"},$n={class:"min-w-full divide-y divide-gray-200"},kn=me(()=>e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Usuario"),e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado"),e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Fecha de firma")])],-1)),Dn={class:"bg-white divide-y divide-gray-200"},Cn={class:"px-4 py-4 whitespace-nowrap"},En={class:"flex items-center"},Sn={class:"text-sm font-medium text-gray-900 flex items-center"},Pn={key:0,class:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full"},Mn={class:"text-sm text-gray-500"},Fn={class:"px-4 py-4 whitespace-nowrap"},Rn={class:"px-4 py-4 whitespace-nowrap text-sm text-gray-500"},On={class:"px-4 py-4 whitespace-nowrap"},jn={class:"flex items-center"},In={class:"text-sm font-medium text-gray-900"},An={class:"text-sm text-gray-500"},zn={class:"px-4 py-4 whitespace-nowrap"},Ln={class:"px-4 py-4 whitespace-nowrap text-sm text-gray-500"},Bn={__name:"DocumentSignaturesModal",props:{documentId:Number},emits:["close","refresh"],setup(t,{emit:u}){const o=t,i=u;be();const h=Ue(),r=A(null),m=()=>{i("close")},p=_=>_?new Date(_).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—",v=async()=>{if(!o.documentId){console.error("No document ID provided");return}try{const _=h.currentUser.id,b=await ae(`dynamic-documents/user/${_}/pending-documents-full/`);if(b.status!==200)throw new Error(`Error loading documents: ${b.status}`);const d=b.data.find(k=>k.id===o.documentId);if(d)r.value=d;else{const k=await ae(`dynamic-documents/${o.documentId}/`);if(k.status!==200)throw new Error(`Error loading document: ${k.status}`);r.value=k.data}}catch(_){console.error("Error loading document data:",_),_.response&&console.error("Error response data:",_.response.data),r.value=null,await $("Error al cargar la información de firmas","error")}};return ie(()=>o.documentId,_=>{_&&v()},{immediate:!0}),(_,b)=>(a(),l("div",on,[e("div",{class:"absolute inset-0 bg-black opacity-50",onClick:m}),e("div",nn,[e("div",{class:"px-6 py-4 border-b border-gray-200"},[rn,e("button",{onClick:m,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},cn)]),e("div",dn,[r.value?(a(),l("div",hn,[e("div",fn,[e("h3",bn,f(r.value.title),1),e("p",yn,[e("span",vn,[e("span",{class:U(["inline-block w-3 h-3 rounded-full mr-2",r.value.fully_signed?"bg-green-500":"bg-yellow-500"])},null,2),T(" "+f(r.value.fully_signed?"Documento completamente firmado":"Pendiente de firmas"),1)])]),r.value.creator?(a(),l("p",xn," Creado por: "+f(r.value.creator.name)+" ("+f(r.value.creator.email)+") ",1)):j("",!0),e("p",_n," Firmas: "+f(r.value.completed_signatures||0)+"/"+f(r.value.total_signatures||0),1)]),e("div",wn,[e("table",$n,[kn,e("tbody",Dn,[(a(!0),l(G,null,H(r.value.signers||[],d=>(a(),l("tr",{key:"sig_"+d.signature_id,class:U({"bg-blue-50":d.is_current_user})},[e("td",Cn,[e("div",En,[e("div",null,[e("div",Sn,[T(f(d.signer_name)+" ",1),d.is_current_user?(a(),l("span",Pn,"Tú")):j("",!0)]),e("div",Mn,f(d.signer_email),1)])])]),e("td",Fn,[e("span",{class:U(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",d.signed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},f(d.signed?"Firmado":"Pendiente"),3)]),e("td",Rn,f(d.signed_at?p(d.signed_at):"—"),1)],2))),128)),!r.value.signers&&r.value.signatures?(a(!0),l(G,{key:0},H(r.value.signatures,d=>(a(),l("tr",{key:"old_"+d.id},[e("td",On,[e("div",jn,[e("div",null,[e("div",In,f(d.signer_name||d.signer_email),1),e("div",An,f(d.signer_email),1)])])]),e("td",zn,[e("span",{class:U(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",d.signed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},f(d.signed?"Firmado":"Pendiente"),3)]),e("td",Ln,f(d.signed_at?p(d.signed_at):"—"),1)]))),128)):j("",!0)])])])])):(a(),l("div",un,pn))]),e("div",{class:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end"},[e("button",{onClick:m,class:"px-4 py-2 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400"}," Cerrar ")])])]))}},Tn=ne(Bn,[["__scopeId","data-v-33bff9d6"]]),Un={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},qn={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-auto shadow-xl"},Nn={class:"flex justify-between items-center mb-4"},Vn=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),Gn={__name:"ElectronicSignatureModal",emits:["close"],setup(t,{emit:u}){const o=Ue(),i=u,h=()=>{i("close")},r=async m=>{o.currentUser&&(o.currentUser.has_signature=!0),$("Firma electrónica guardada correctamente","success"),setTimeout(()=>{h()},500)};return(m,p)=>(a(),l("div",Un,[e("div",qn,[e("div",Nn,[Vn,e("button",{onClick:h,class:"text-gray-400 hover:text-gray-500"},[S(c(Y),{class:"h-6 w-6"})])]),S(tt,{initialShowOptions:!0,"user-id":c(o).currentUser.id,onSignatureSaved:r,onCancel:h},null,8,["user-id"])])]))}},Hn={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Wn={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0"},Qn={class:"inline-block w-full max-w-4xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl"},Zn={class:"flex items-center justify-between pb-4 mb-6 border-b border-gray-200"},Jn=e("h3",{class:"text-lg font-medium leading-6 text-gray-900"}," Gestión de Permisos ",-1),Xn={class:"mt-1 text-sm text-gray-500"},Yn={key:0,class:"mb-6"},Kn={key:1,class:"p-4 mb-6 bg-red-50 border border-red-200 rounded-lg"},er=e("div",{class:"flex items-center"},[e("svg",{class:"w-5 h-5 text-red-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("p",{class:"text-red-700"},"No tienes permisos para gestionar los permisos de este documento.")],-1),tr=[er],sr={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},ar=["disabled"],or={key:0,class:"flex items-center"},nr=e("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},null,-1),rr={key:1},lr={__name:"DocumentPermissionsModal",props:{isOpen:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close","saved"],setup(t,{emit:u}){const o=t,i=u,h=be(),r=A(null),m=A(!1),{isLawyer:p}=at(),v=N(()=>{var d;return p.value&&((d=o.document)==null?void 0:d.id)}),_=()=>{m.value||i("close")},b=async()=>{var k;if(!v.value||m.value)return;const d=(k=r.value)==null?void 0:k.getPermissionsData();if(!d){await $("Error al obtener los permisos actuales","error");return}m.value=!0;try{const w=o.document.id;await h.manageDocumentPermissions(w,d),await $("Permisos actualizados exitosamente","success"),i("saved",o.document),_()}catch(w){console.error("Error saving permissions:",w),await $("Error al guardar los permisos","error")}finally{m.value=!1}};return(d,k)=>(a(),B(Ee,null,{default:V(()=>{var w;return[t.isOpen?(a(),l("div",Hn,[e("div",Wn,[e("div",{class:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:_}),e("div",Qn,[e("div",Zn,[e("div",null,[Jn,e("p",Xn,f(((w=t.document)==null?void 0:w.title)||"Documento"),1)]),e("button",{onClick:_,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors"},[S(c(Y),{class:"w-6 h-6"})])]),v.value?(a(),l("div",Yn,[S(ot,{ref_key:"permissionsManagerRef",ref:r,document:t.document},null,8,["document"])])):(a(),l("div",Kn,tr)),e("div",sr,[e("button",{onClick:_,type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"},f(v.value?"Cancelar":"Cerrar"),1),v.value?(a(),l("button",{key:0,onClick:b,disabled:m.value,type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-secondary rounded-md hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[m.value?(a(),l("span",or,[nr,T(" Guardando... ")])):(a(),l("span",rr,"Guardar Permisos"))],8,ar)):j("",!0)])])])])):j("",!0)]}),_:1}))}};function pe(t){return st.fire({title:t,icon:"question",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",buttonsStyling:!1}).then(u=>u.isConfirmed)}function ir(t,u){const o=A({edit:{isOpen:!1,document:null},email:{isOpen:!1,document:null},preview:{isOpen:!1,document:null},signatures:{isOpen:!1,document:null},electronicSignature:{isOpen:!1,document:null},permissions:{isOpen:!1,document:null},letterhead:{isOpen:!1,document:null},relationships:{isOpen:!1,document:null}}),i=(p,v,_={})=>{switch(r(),p){case"edit":o.value.edit={isOpen:!0,document:v,..._};break;case"email":o.value.email={isOpen:!0,document:v};break;case"preview":qe(v);break;case"signatures":o.value.signatures={isOpen:!0,document:v};break;case"electronic-signature":o.value.electronicSignature={isOpen:!0,document:v};break;case"permissions":o.value.permissions={isOpen:!0,document:v};break;case"letterhead":o.value.letterhead={isOpen:!0,document:v};break;case"relationships":o.value.relationships={isOpen:!0,document:v};break;default:console.warn(`Unknown modal type: ${p}`)}},h=p=>{o.value[p]&&(o.value[p]={isOpen:!1,document:null})},r=()=>{Object.keys(o.value).forEach(p=>{o.value[p]={isOpen:!1,document:null}})};return{activeModals:o,openModal:i,closeModal:h,closeAllModals:r,getUserRole:()=>{var p;return((p=u==null?void 0:u.currentUser)==null?void 0:p.role)||"client"}}}function cr(t,u,o){const{registerView:i}=nt(),h=Me();return{handlePreviewDocument:async s=>{await i("document",s.id),qe(s)},deleteDocument:async s=>{if(await pe(`¿Estás seguro de que deseas eliminar el documento "${s.title}"?`)&&t)try{await t.deleteDocument(s.id),await $("Documento eliminado exitosamente","success"),o("refresh")}catch(D){throw await $("Error al eliminar el documento","error"),D}},downloadPDFDocument:async s=>{if(t)try{await t.downloadPDF(s.id,s.title),await $("PDF descargado exitosamente","success")}catch(n){throw await $("Error al descargar el PDF","error"),n}},downloadWordDocument:async s=>{if(t)try{await t.downloadWord(s.id,s.title),await $("Documento Word descargado exitosamente","success")}catch(n){throw await $("Error al descargar el documento Word","error"),n}},copyDocument:async s=>{var n;if(!t){await $("Funcionalidad de duplicar no implementada aún","info");return}try{const D=new Date,z=String(D.getDate()).padStart(2,"0"),O=String(D.getMonth()+1).padStart(2,"0"),C=D.getFullYear(),I=`${z}${O}${C}`,E=`${s.title} ${I}`,M={title:E,content:s.content,state:"Draft",variables:((n=s.variables)==null?void 0:n.map(J=>({name_en:J.name_en,name_es:J.name_es,tooltip:J.tooltip,field_type:J.field_type,select_options:J.select_options,value:""})))||[],requires_signature:!1};if(!await pe(`¿Deseas crear una copia del documento '${s.title}'?`))return;await t.createDocument(M),await $(`Copia creada exitosamente: "${E}"`,"success"),o("refresh")}catch(D){console.error("Error creating document copy:",D),await $("Error al crear la copia del documento","error")}},publishDocument:async s=>{if(t)try{const n={...s,state:"Published",is_public:!0};await t.updateDocument(s.id,n),await $("Documento publicado exitosamente","success"),o("refresh")}catch(n){throw await $("Error al publicar el documento","error"),n}},moveToDraft:async s=>{if(t)try{const n={...s,state:"Draft"};await t.updateDocument(s.id,n),await $("Documento movido a borrador exitosamente","success"),o("refresh")}catch(n){throw await $("Error al mover el documento a borrador","error"),n}},formalizeDocument:async s=>{try{h.push(`/dynamic_document_dashboard/document/use/formalize/${s.id}/${s.title}`)}catch(n){console.error("Error al formalizar el documento:",n),await $("Error al formalizar el documento","error")}},signDocument:async(s,n)=>{var D;try{const z=u.currentUser.id,O=u.currentUser.email;if(!s.requires_signature){await $("Este documento no requiere firmas","error");return}const C=(D=s.signatures)==null?void 0:D.find(M=>M.signer_email===O);if(!C){await $("No estás autorizado para firmar este documento","error");return}if(C.signed){await $("Ya has firmado este documento","info");return}if(!u.currentUser.has_signature){await $("Para firmar documentos necesitas tener una firma registrada.","info"),await pe("¿Deseas crear una firma electrónica ahora?")?n("electronic-signature",s):await $("Necesitas una firma para poder firmar documentos.","warning");return}if(!await pe(`¿Estás seguro de que deseas firmar el documento "${s.title}"?`)){await $("Operación de firma cancelada","info");return}const E=`dynamic-documents/${s.id}/sign/${z}/`;try{await $("Procesando firma del documento...","info");const M=await De(E,{});if(M.status===200||M.status===201)await $(`¡Documento "${s.title}" firmado correctamente!`,"success"),o("refresh");else throw new Error(`Unexpected server response: ${M.status} ${M.statusText}`)}catch(M){throw console.error("Error in HTTP request:",M),M}}catch(z){console.error("General error signing document:",z),await $(`Error al firmar el documento: ${z.message}`,"error")}},downloadSignedDocument:async s=>{try{if(s.state!=="FullySigned"){$("El documento debe estar completamente firmado para descargarlo","warning");return}if(!s.signatures||s.signatures.length===0){$("El documento no tiene firmas registradas","warning");return}const n=`dynamic-documents/${s.id}/generate-signatures-pdf/`;await rt(n,`firmas_${s.title}.pdf`)}catch(n){console.error("Error downloading signed document:",n),$("Error al descargar el documento firmado","error")}}}}export{Cr as B,Dr as _,mt as u};
