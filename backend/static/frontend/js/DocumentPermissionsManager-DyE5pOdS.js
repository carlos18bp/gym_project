import{I as oe,r as F,c as L,s as q,o as re,W as ae,j as t,e as r,f as a,g as s,n as se,F as te,J as ie,t as v,l as f,p as U,w as ne,v as de,aX as ce}from"./index-BWL8Y4C8.js";import{u as ue}from"./index-B3uj7xYX.js";const J=[{id:0,name:"Gris Suave",light:"#F5F5F5",dark:"#9E9E9E",hex:"#E0E0E0"},{id:1,name:"Rosa Pastel",light:"#FCE4EC",dark:"#AD1457",hex:"#F8BBD9"},{id:2,name:"Lavanda",light:"#F3E5F5",dark:"#7B1FA2",hex:"#E1BEE7"},{id:3,name:"Azul Suave",light:"#E3F2FD",dark:"#1565C0",hex:"#BBDEFB"},{id:4,name:"Verde Menta",light:"#E8F5E8",dark:"#2E7D32",hex:"#C8E6C9"},{id:5,name:"Amarillo Pastel",light:"#FFF8E1",dark:"#F57F17",hex:"#FFF176"},{id:6,name:"Durazno",light:"#FFF3E0",dark:"#E65100",hex:"#FFCC80"},{id:7,name:"Coral",light:"#FFEBEE",dark:"#C62828",hex:"#FFCDD2"},{id:8,name:"Turquesa",light:"#E0F2F1",dark:"#00695C",hex:"#B2DFDB"},{id:9,name:"Violeta",light:"#EDE7F6",dark:"#4527A0",hex:"#D1C4E9"},{id:10,name:"Salmón",light:"#FFF4E6",dark:"#BF360C",hex:"#FFAB91"},{id:11,name:"Aqua",light:"#E1F5FE",dark:"#0277BD",hex:"#81D4FA"},{id:12,name:"Lima",light:"#F1F8E9",dark:"#558B2F",hex:"#DCEDC8"},{id:13,name:"Lila",light:"#F9FBE7",dark:"#9E9D24",hex:"#E6EE9C"},{id:14,name:"Crema",light:"#FFFDE7",dark:"#F9A825",hex:"#FFF59D"},{id:15,name:"Celeste",light:"#E8EAF6",dark:"#303F9F",hex:"#C5CAE9"}];function Ms(E){return J.find(V=>V.id===E)||J[0]}function Ts(){return J}function _e(){const E=ue(),V=oe(),_=F([]),y=F([]),u=F([]),c=F(!1),w=F(!1),A=F(""),h=F([]),x=F([]),m=F([]),C=F(!1),k=L(()=>{var e;return((e=V.getCurrentUser)==null?void 0:e.role)==="lawyer"}),B=L(()=>{if(!Array.isArray(_.value))return[];if(!A.value.trim())return _.value;const e=A.value.toLowerCase().trim();return _.value.filter(o=>{var n,d;return((n=o.full_name)==null?void 0:n.toLowerCase().includes(e))||((d=o.email)==null?void 0:d.toLowerCase().includes(e))})}),I=L(()=>Array.isArray(_.value)&&_.value.length>0),j=L(()=>Array.isArray(B.value)&&B.value.length>0),S=L(()=>Array.isArray(h.value)&&h.value.length>0),z=async()=>{if(k.value){w.value=!0;try{const e=await E.fetchAvailableClients();_.value=Array.isArray(e)?e:[]}catch(e){console.error("Error loading available clients:",e),await q("Error al cargar clientes disponibles","error"),_.value=[]}finally{w.value=!1}}},M=async()=>{if(k.value){C.value=!0;try{const e=await E.fetchAvailableRoles();h.value=Array.isArray(e.roles)?e.roles:[]}catch(e){console.error("Error loading available roles:",e),await q("Error al cargar roles disponibles","error"),h.value=[]}finally{C.value=!1}}},$=async e=>{if(!(!e||!k.value))try{const o=await E.fetchDocumentPermissions(e);R(o)}catch(o){console.error("Error loading document permissions:",o),R(E.selectedDocument)}},R=e=>{if(!(!e||!k.value)&&(y.value=[],u.value=[],x.value=[],m.value=[],c.value=!1,typeof e.is_public=="boolean"&&(c.value=e.is_public),!c.value)){let o=[],n=[];e.active_roles&&(e.active_roles.visibility_roles&&Array.isArray(e.active_roles.visibility_roles)&&(x.value=[...e.active_roles.visibility_roles],o=[...e.active_roles.visibility_roles]),e.active_roles.usability_roles&&Array.isArray(e.active_roles.usability_roles)&&(m.value=[...e.active_roles.usability_roles],n=[...e.active_roles.usability_roles]));const d=g=>Array.isArray(_.value)&&_.value.find(l=>l.user_id===g||l.id===g)||null;if(e.visibility_permissions&&Array.isArray(e.visibility_permissions)){const g=e.visibility_permissions.filter(l=>l.user_id&&l.email&&l.full_name).filter(l=>{if(!o.length)return!0;const b=d(l.user_id);return!b||!b.role?!0:!o.includes(b.role)});y.value=g.map(l=>({id:l.user_id,user_id:l.user_id,email:l.email,full_name:l.full_name}))}if(e.usability_permissions&&Array.isArray(e.usability_permissions)){const g=e.usability_permissions.filter(l=>l.user_id&&l.email&&l.full_name).filter(l=>{if(!n.length)return!0;const b=d(l.user_id);return!b||!b.role?!0:!n.includes(b.role)});u.value=g.map(l=>({id:l.user_id,user_id:l.user_id,email:l.email,full_name:l.full_name}))}}};return{availableClients:_,selectedVisibilityUsers:y,selectedUsabilityUsers:u,isPublicDocument:c,isLoadingClients:w,clientSearchQuery:A,availableRoles:h,selectedRolesVisibility:x,selectedRolesUsability:m,isLoadingRoles:C,isLawyer:k,filteredClients:B,hasAvailableClients:I,hasFilteredClients:j,hasAvailableRoles:S,loadAvailableClients:z,loadDocumentPermissions:$,initializeExistingPermissions:R,toggleVisibilityPermission:e=>{const o=y.value.findIndex(n=>n.id===e.id);if(o>=0){y.value.splice(o,1);const n=u.value.findIndex(d=>d.id===e.id);n>=0&&u.value.splice(n,1)}else y.value.push(e)},toggleUsabilityPermission:e=>{if(!y.value.some(d=>d.id===e.id)){q("El usuario debe tener permisos de visualización primero","warning");return}const n=u.value.findIndex(d=>d.id===e.id);n>=0?u.value.splice(n,1):u.value.push(e)},hasVisibilityPermission:e=>e?y.value.some(o=>o.id===e.id||o.user_id===e.user_id):!1,hasUsabilityPermission:e=>e?u.value.some(o=>o.id===e.id||o.user_id===e.user_id):!1,togglePublicAccess:()=>{c.value=!c.value,c.value&&(y.value=[],u.value=[],x.value=[],m.value=[])},toggleRoleVisibilityPermission:e=>{const o=x.value.indexOf(e),n=()=>Array.isArray(_.value)?_.value.filter(d=>d.role===e).map(d=>d.user_id??d.id).filter(Boolean):[];if(o>=0){x.value.splice(o,1);const d=m.value.indexOf(e);d>=0&&m.value.splice(d,1);const g=new Set(n());g.size>0&&(y.value=y.value.filter(l=>!g.has(l.user_id??l.id)),u.value=u.value.filter(l=>!g.has(l.user_id??l.id)))}else if(x.value.push(e),new Set(n()).size>0){const g=new Set(y.value.map(l=>l.user_id??l.id));_.value.filter(l=>l.role===e).forEach(l=>{const b=l.user_id??l.id;b&&!g.has(b)&&y.value.push({id:b,user_id:b,email:l.email,full_name:l.full_name})})}},toggleRoleUsabilityPermission:e=>{if(!x.value.includes(e)){q("El rol debe tener permisos de visualización primero","warning");return}const n=m.value.indexOf(e);n>=0?m.value.splice(n,1):m.value.push(e)},hasRoleVisibilityPermission:e=>x.value.includes(e),hasRoleUsabilityPermission:e=>m.value.includes(e),getRoleDisplayName:e=>{const o=h.value.find(n=>n.code===e);return o?o.display_name:e},getPermissionsData:()=>k.value?{is_public:c.value,visibility:{roles:c.value?[]:x.value,user_ids:c.value?[]:y.value.map(e=>e.user_id)},usability:{roles:c.value?[]:m.value,user_ids:c.value?[]:u.value.map(e=>e.user_id)}}:{},getPermissionsDataExpanded:()=>{if(!k.value)return{};const e=P=>{if(!P||P.length===0)return[];const ee=new Set;return P.forEach(le=>{_.value.filter(Q=>Q.role===le).forEach(Q=>{ee.add(Q.user_id)})}),Array.from(ee)},o=y.value.map(P=>P.user_id),n=u.value.map(P=>P.user_id),d=e(x.value),g=e(m.value),l=[...new Set([...o,...d])],b=[...new Set([...n,...g])];return{is_public:c.value,visibility_user_ids:c.value?[]:l,usability_user_ids:c.value?[]:b}},initializePermissions:async e=>{k.value&&(await Promise.all([z(),M()]),e!=null&&e.id&&await $(e.id))}}}const ye={key:0,class:"mt-6"},he=s("div",{class:"flex items-center justify-between mb-4"},[s("h3",{class:"text-lg font-medium text-primary"},"Gestión de Permisos")],-1),me={class:"mb-6 p-4 bg-gray-50 rounded-lg border"},ve={class:"flex items-center justify-between"},ge=s("div",null,[s("h4",{class:"text-sm font-medium text-gray-700"},"Acceso Público"),s("p",{class:"text-sm text-gray-500 mt-1"}," Si está habilitado, todos los usuarios pueden ver y usar este documento ")],-1),be={key:0,class:"space-y-6"},fe={class:"border-b border-gray-200 pb-6"},xe=s("div",{class:"flex items-center justify-between mb-4"},[s("h4",{class:"text-sm font-medium text-gray-700"},"Permisos por Rol")],-1),pe={key:0,class:"space-y-3"},ke={class:"flex-1"},Fe={class:"flex items-center gap-2"},Ee={class:"text-sm font-medium text-gray-900"},we={class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Ce={key:0,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},Pe={class:"text-xs text-gray-500 mt-1"},Ae={key:0,class:"flex items-center space-x-4"},Re={class:"flex items-center"},Ue=["id","checked","onChange"],Ve=["for"],Be={class:"flex items-center"},De=["id","checked","onChange","disabled"],Le=["for"],Ie={key:1,class:"text-xs text-gray-400 italic"},je={key:1,class:"text-center py-4"},Se=s("p",{class:"text-gray-500 text-sm"},"Cargando roles disponibles...",-1),ze=[Se],$e={key:2,class:"text-center py-4"},Ne=s("p",{class:"text-gray-500 text-sm"},"No hay roles disponibles.",-1),qe=[Ne],Me={key:3,class:"mt-4 p-3 bg-purple-50 rounded-lg border border-purple-200"},Te=s("h5",{class:"text-sm font-medium text-purple-800 mb-2"},"Resumen de Permisos por Rol:",-1),Oe={key:0,class:"mb-2"},We={class:"text-sm text-purple-700"},Ge=s("strong",null,"Roles que pueden ver:",-1),Qe={key:1},Je={class:"text-sm text-purple-700"},Xe=s("strong",null,"Roles que pueden usar:",-1),He={key:0},Ke={class:"flex items-center justify-between mb-3"},Ye={class:"text-sm font-medium text-gray-700"},Ze={key:0,class:"text-blue-600"},es={key:1,class:"text-gray-500"},ss={class:"mb-3"},ts={class:"relative"},is=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1),ls={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},os=s("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),rs=[os],as={key:0,class:"space-y-2 max-h-60 overflow-y-auto border rounded-lg p-3"},ns={class:"flex-1"},ds={class:"text-sm font-medium text-gray-900"},cs={class:"text-sm text-gray-500"},us={class:"flex items-center space-x-4"},_s={class:"flex items-center"},ys=["id","checked","onChange"],hs=["for"],ms={class:"flex items-center"},vs=["id","checked","onChange","disabled"],gs=["for"],bs={key:1,class:"text-center py-6 border rounded-lg"},fs={class:"flex flex-col items-center"},xs=s("svg",{class:"h-12 w-12 text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),ps=s("p",{class:"text-gray-500 font-medium"},"No se encontraron clientes",-1),ks={class:"text-gray-400 text-sm mt-1"},Fs={key:1,class:"text-center py-6"},Es=s("p",{class:"text-gray-500"},"No hay clientes disponibles.",-1),ws=s("p",{class:"text-gray-400 text-sm mt-1"},"Los clientes aparecerán aquí cuando estén registrados en el sistema.",-1),Cs=[Es,ws],Ps={key:2,class:"text-center py-6"},As=s("p",{class:"text-gray-500"},"Cargando clientes disponibles...",-1),Rs=[As],Us={key:3,class:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200"},Vs=s("h5",{class:"text-sm font-medium text-blue-800 mb-2"},"Resumen de Permisos:",-1),Bs={key:0,class:"mb-2"},Ds={class:"text-sm text-blue-700"},Ls={key:1},Is={class:"text-sm text-blue-700"},js={key:1,class:"mt-4 p-4 bg-green-50 rounded-lg border border-green-200"},Ss=s("div",{class:"flex items-center"},[s("svg",{class:"h-5 w-5 text-green-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),s("p",{class:"text-sm text-green-700"},[s("strong",null,"Documento público:"),U(" Todos los usuarios registrados pueden ver y usar este documento. ")])],-1),zs=[Ss],Os={__name:"DocumentPermissionsManager",props:{document:{type:Object,default:null}},setup(E,{expose:V}){const _=E,{availableClients:y,selectedVisibilityUsers:u,selectedUsabilityUsers:c,isPublicDocument:w,isLoadingClients:A,clientSearchQuery:h,availableRoles:x,selectedRolesVisibility:m,selectedRolesUsability:C,isLoadingRoles:k,isLawyer:B,filteredClients:I,hasAvailableClients:j,hasFilteredClients:S,hasAvailableRoles:z,toggleVisibilityPermission:M,toggleUsabilityPermission:$,hasVisibilityPermission:R,hasUsabilityPermission:X,togglePublicAccess:T,toggleRoleVisibilityPermission:H,toggleRoleUsabilityPermission:K,hasRoleVisibilityPermission:O,hasRoleUsabilityPermission:Y,getRoleDisplayName:W,getPermissionsData:Z,initializePermissions:G}=_e();return re(async()=>{_.document&&await G(_.document)}),ae(()=>_.document,(D,p)=>{D&&D.id!==(p==null?void 0:p.id)&&G(D)},{deep:!0}),V({getPermissionsData:Z}),(D,p)=>t(B)?(r(),a("div",ye,[he,s("div",me,[s("div",ve,[ge,s("button",{onClick:p[0]||(p[0]=(...i)=>t(T)&&t(T)(...i)),type:"button",class:se(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-offset-2",t(w)?"bg-secondary":"bg-gray-200"])},[s("span",{class:se(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",t(w)?"translate-x-5":"translate-x-0"])},null,2)],2)])]),t(w)?f("",!0):(r(),a("div",be,[s("div",fe,[xe,t(z)?(r(),a("div",pe,[(r(!0),a(te,null,ie(t(x),i=>(r(),a("div",{key:i.code,class:"flex items-center justify-between p-3 bg-gray-50 border rounded-lg"},[s("div",ke,[s("div",Fe,[s("p",Ee,v(i.display_name),1),s("span",we,v(i.user_count)+" usuarios ",1),i.has_automatic_access?(r(),a("span",Ce," Acceso automático ")):f("",!0)]),s("p",Pe,v(i.description),1)]),i.can_be_granted_permissions?(r(),a("div",Ae,[s("div",Re,[s("input",{id:`role_visibility_${i.code}`,type:"checkbox",checked:t(O)(i.code),onChange:N=>t(H)(i.code),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded"},null,40,Ue),s("label",{for:`role_visibility_${i.code}`,class:"ml-2 text-sm text-gray-600"}," Ver ",8,Ve)]),s("div",Be,[s("input",{id:`role_usability_${i.code}`,type:"checkbox",checked:t(Y)(i.code),onChange:N=>t(K)(i.code),disabled:!t(O)(i.code),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded disabled:bg-gray-100"},null,40,De),s("label",{for:`role_usability_${i.code}`,class:"ml-2 text-sm text-gray-600"}," Usar ",8,Le)])])):(r(),a("div",Ie," No requiere permisos explícitos "))]))),128))])):t(k)?(r(),a("div",je,ze)):(r(),a("div",$e,qe)),t(m).length>0||t(C).length>0?(r(),a("div",Me,[Te,t(m).length>0?(r(),a("div",Oe,[s("p",We,[Ge,U(" "+v(t(m).map(i=>t(W)(i)).join(", ")),1)])])):f("",!0),t(C).length>0?(r(),a("div",Qe,[s("p",Je,[Xe,U(" "+v(t(C).map(i=>t(W)(i)).join(", ")),1)])])):f("",!0)])):f("",!0)]),t(j)?(r(),a("div",He,[s("div",Ke,[s("h4",Ye,[U(" Asignar Permisos a Clientes: "),t(h).trim()?(r(),a("span",Ze," ("+v(t(I).length)+" de "+v(t(y).length)+" clientes) ",1)):(r(),a("span",es," ("+v(t(y).length)+" clientes) ",1))])]),s("div",ss,[s("div",ts,[is,ne(s("input",{"onUpdate:modelValue":p[1]||(p[1]=i=>ce(h)?h.value=i:null),type:"text",placeholder:"Buscar por nombre o email...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-secondary focus:border-secondary text-sm"},null,512),[[de,t(h)]]),t(h).trim()?(r(),a("div",ls,[s("button",{onClick:p[2]||(p[2]=i=>h.value=""),type:"button",class:"text-gray-400 hover:text-gray-600"},rs)])):f("",!0)])]),t(S)?(r(),a("div",as,[(r(!0),a(te,null,ie(t(I),i=>(r(),a("div",{key:i.id,class:"flex items-center justify-between p-3 bg-white border rounded-lg hover:bg-gray-50"},[s("div",ns,[s("p",ds,v(i.full_name),1),s("p",cs,v(i.email),1)]),s("div",us,[s("div",_s,[s("input",{id:`visibility_${i.id}`,type:"checkbox",checked:t(R)(i),onChange:N=>t(M)(i),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded"},null,40,ys),s("label",{for:`visibility_${i.id}`,class:"ml-2 text-sm text-gray-600"}," Ver ",8,hs)]),s("div",ms,[s("input",{id:`usability_${i.id}`,type:"checkbox",checked:t(X)(i),onChange:N=>t($)(i),disabled:!t(R)(i),class:"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 rounded disabled:bg-gray-100"},null,40,vs),s("label",{for:`usability_${i.id}`,class:"ml-2 text-sm text-gray-600"}," Usar ",8,gs)])])]))),128))])):t(h).trim()&&!t(S)?(r(),a("div",bs,[s("div",fs,[xs,ps,s("p",ks,' No hay clientes que coincidan con "'+v(t(h))+'" ',1),s("button",{onClick:p[3]||(p[3]=i=>h.value=""),type:"button",class:"mt-3 text-sm text-secondary hover:text-secondary-dark underline"}," Limpiar búsqueda ")])])):f("",!0)])):!t(A)&&!t(j)?(r(),a("div",Fs,Cs)):f("",!0),t(A)?(r(),a("div",Ps,Rs)):f("",!0),t(u).length>0||t(c).length>0?(r(),a("div",Us,[Vs,t(u).length>0?(r(),a("div",Bs,[s("p",Ds,[s("strong",null,"Pueden ver ("+v(t(u).length)+"):",1),U(" "+v(t(u).map(i=>i.full_name).join(", ")),1)])])):f("",!0),t(c).length>0?(r(),a("div",Ls,[s("p",Is,[s("strong",null,"Pueden usar ("+v(t(c).length)+"):",1),U(" "+v(t(c).map(i=>i.full_name).join(", ")),1)])])):f("",!0)])):f("",!0)])),t(w)?(r(),a("div",js,zs)):f("",!0)])):f("",!0)}};export{Os as _,Ts as a,Ms as g,_e as u};
