import{N as $,X as z,Y as U,ai as G,aj as I,u as V,L as B,r as T,b as j,o as O,c as R,e as p,f as y,g as e,j as b,l as _,A,h as v,w as m,v as h,F as X,H,n as w,M as J,I as Y,a4 as Z,t as K,m as f,s as g}from"./index.js";import{s as Q,h as W,r as N}from"./loading_message.js";import{r as ee,a as te}from"./PhotoIcon.js";const se=$("intranetGymStore",{state:()=>({legalDocuments:[],dataLoaded:!1}),actions:{async init(){this.dataLoaded||await this.fetchLegalDocuments()},async fetchLegalDocuments(){try{const a=await z("list_legal_intranet_documents/");this.legalDocuments=a.data,this.dataLoaded=!0}catch(a){console.error("Error fetching legal documents:",a),this.legalDocuments=[],this.dataLoaded=!1}},async createReportRequest(a){const o=new FormData;o.append("contract",a.document),o.append("initialDate",a.initialDate),o.append("endDate",a.endDate),o.append("paymentConcept",a.paymentConcept),o.append("paymentAmount",a.paymentAmount),o.append("userName",a.userName),o.append("userLastName",a.userLastName),a.files&&a.files.length>0&&a.files.forEach((i,x)=>{o.append(`files[${x}]`,i)});try{const i=await U("create_report_request/",o);return i.status===201?(await G(I.CREATE,`Enviaste un informe de facturación por ${a.paymentAmount} - ${a.paymentConcept}.`),this.dataLoaded=!1,i.status):(console.error("Failed to create report request:",i.status),null)}catch(i){return console.error("Error creating report request:",i.message),null}}}}),ne={class:"px-4 pb-10 sm:px-6 lg:px-8"},ae={class:"w-full p-5 rounded-lg border-2 border-stroke bg-terciary space-y-3"},re={class:"flex items-center justify-between"},oe=e("h1",{class:"text-primary text-xl font-semibold"},"Presentar Informe",-1),ie={class:"mt-4 space-y-3"},le={class:"grid md:grid-cols-2 xl:grid-cols-4 gap-3"},de=e("label",{for:"document-number",class:"block text-base font-medium leading-6 text-primary"},[f(" No. Contrato "),e("span",{class:"text-red-500"},"*")],-1),ce={class:"mt-2"},ue=e("label",{for:"initial-report-period",class:"block text-base font-medium leading-6 text-primary"},[f(" Fecha Inicial "),e("span",{class:"text-red-500"},"*")],-1),pe={class:"mt-2"},me=e("label",{for:"final-report-period",class:"block text-base font-medium leading-6 text-primary"},[f(" Fecha Final "),e("span",{class:"text-red-500"},"*")],-1),ge={class:"mt-2"},ye=e("label",{for:"payment-concept",class:"block text-base font-medium leading-6 text-primary"},[f(" Concepto de Pago "),e("span",{class:"text-red-500"},"*")],-1),he={class:"mt-2"},fe=e("label",{for:"payment-concept",class:"block text-base font-medium leading-6 text-primary"},[f(" Valor a Cobrar y/o Facturar "),e("span",{class:"text-red-500"},"*")],-1),xe={class:"mt-2"},be={class:"flex items-center rounded-md bg-white px-3 outline outline-1 -outline-offset-1 outline-gray-300 focus-within:outline focus-within:outline-2 focus-within:outline-secondary"},_e=e("div",{class:"shrink-0 select-none text-base text-gray-500 sm:text-sm"}," $ ",-1),ve=e("div",{id:"payment-currency",class:"shrink-0 select-none text-base text-gray-500 sm:text-sm"}," COP ",-1),we={class:"col-span-full"},ke=e("label",{for:"files",class:"block text-base font-medium leading-6 text-primary"}," Anexos ",-1),Ce={key:0,class:"text-center"},De={class:"mt-4 flex text-sm/6 text-gray-600"},Fe={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"},Ae=e("span",null,"Sube un archivo",-1),Ne=e("p",{class:"pl-1"},"o arrastra y suelta",-1),Me=e("p",{class:"text-xs/5 text-gray-600"}," PNG, JPG, PDF, DOCX de hasta 20MB ",-1),Ee={key:1,class:"w-full flex flex-wrap gap-3"},Le=["onMouseenter","onMouseleave"],Se=["onClick"],qe={class:"text-center text-xs truncate w-20"},Pe={class:"flex gap-3 span-col-full"},$e=["disabled"],ze=e("span",null,"Guardar",-1),Ue=[ze],Ge=20*1024*1024,Ie=20*1024*1024,je={__name:"FacturationForm",emits:["close"],setup(a,{emit:o}){const i=o,x=V(),M=se(),k=B(),l=T([]),n=j({document:null,initialDate:null,endDate:null,paymentConcept:"",paymentAmount:null,files:[],userName:"",userLastName:""});O(async()=>{await k.init();const r=k.getCurrentUser;r&&(n.userName=r.first_name||"",n.userLastName=r.last_name||"")});const C=()=>{i("close")},E=r=>{const s=Array.from(r.target.files);D(s),r.target.value=null},L=r=>{r.preventDefault();const s=Array.from(r.dataTransfer.files);D(s)},D=r=>{let s=l.value.reduce((t,u)=>t+u.file.size,0);r.forEach(t=>{if(t.size>Ge){g(`El archivo "${t.name}" excede el límite de 20 MB. Por favor, selecciona un archivo más pequeño.`,"warning");return}if(s+t.size>Ie){g("No se pueden agregar más archivos porque el tamaño total excede el límite de 20 MB.","warning");return}const u=t.name.split(".").pop().toLowerCase();let d="",c={general:"",xMark:""};switch(u){case"png":case"jpg":case"jpeg":d=te,c.general="border-gray-200 text-gray-400",c.xMark="bg-gray-400";break;case"pdf":d=N,c.general="border-red-600/20 text-red-600/60",c.xMark="bg-red-600/60";break;case"docx":d=N,c.general="border-blue-600/20 text-blue-600/60",c.xMark="bg-blue-600/60";break;default:g("¡Ups! Ese tipo de archivo no es compatible. Asegúrate de que el archivo sea PDF, DOCX, JPG, PNG, JPEG.","warning");return}l.value.push({name:t.name,icon:d,style:c,hover:!1,file:t}),s+=t.size})},S=r=>{l.value.splice(r,1)},F=R(()=>n.document!==null&&n.initialDate!==null&&n.endDate!==null&&n.paymentConcept.trim()&&n.paymentAmount!==null&&!isNaN(n.paymentAmount)),q=async()=>{Q();const r=l.value.map(s=>s.file);n.files=r;try{const s=await M.createReportRequest(n);W(),s===201?(g("¡Solicitud creada exitosamente!","success"),P(),C(),x.push({name:"dashboard"})):g("Error al crear la solicitud. Intenta nuevamente.","error")}catch(s){console.error("Error al enviar la solicitud:",s),g("Hubo un error inesperado. Por favor, inténtalo más tarde.","error")}},P=()=>{n.document=null,n.initialDate=null,n.endDate=null,n.paymentConcept="",n.paymentAmount=null,l.value=[]};return(r,s)=>(p(),y("div",ne,[e("div",ae,[e("div",re,[oe,b(_(A),{class:"size-6 text-primary cursor-pointer",onClick:C})]),e("form",{onSubmit:s[6]||(s[6]=v(t=>q(),["prevent"]))},[e("div",ie,[e("div",le,[e("div",null,[de,e("div",ce,[m(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>n.document=t),type:"text",name:"document-number",id:"document-number",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,n.document]])])]),e("div",null,[ue,e("div",pe,[m(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>n.initialDate=t),type:"date",name:"initial-report-period",id:"initial-report-period",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,n.initialDate]])])]),e("div",null,[me,e("div",ge,[m(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>n.endDate=t),type:"date",name:"final-report-period",id:"final-report-period",placeholder:"Fecha inicial",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,n.endDate]])])]),e("div",null,[ye,e("div",he,[m(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>n.paymentConcept=t),type:"text",name:"payment-concept",id:"payment-concept",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,n.paymentConcept]])])]),e("div",null,[fe,e("div",xe,[e("div",be,[_e,m(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>n.paymentAmount=t),type:"text",name:"payment-concept",id:"payment-concept",class:"block min-w-0 grow py-1.5 pl-1 pr-3 text-base text-primary border-none placeholder:text-gray-400 focus-within:outline-none focus-within:border-none focus-within:ring-0 sm:text-sm",placeholder:"0.00","aria-describedby":"payment-currency",required:""},null,512),[[h,n.paymentAmount]]),ve])])]),e("div",we,[ke,e("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 bg-white px-6 py-10",onDragover:s[5]||(s[5]=v(()=>{},["prevent"])),onDrop:v(L,["prevent"])},[l.value.length<1?(p(),y("div",Ce,[b(_(ee),{class:"mx-auto size-12 text-gray-300","aria-hidden":"true"}),e("div",De,[e("label",Fe,[Ae,e("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",onChange:E},null,32)]),Ne]),Me])):(p(),y("div",Ee,[(p(!0),y(X,null,H(l.value,(t,u)=>(p(),y("div",{key:u,class:w(["relative p-4 grid rounded-md bg-white border-2",t.style.general]),onMouseenter:d=>t.hover=!0,onMouseleave:d=>t.hover=!1},[m(e("div",{class:w(["absolute p-0.5 mt-2 ml-2 rounded-full",t.style.xMark]),onClick:d=>S(u)},[b(_(A),{class:"size-3 text-white"})],10,Se),[[J,t.hover]]),(p(),Y(Z(t.icon),{class:"size-12 mx-auto"})),e("span",qe,K(t.name),1)],42,Le))),128))]))],32)]),e("div",Pe,[e("button",{type:"submit",class:w(["p-2.5 text-sm font-medium rounded-md flex gap-2",F.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!F.value},Ue,10,$e)])])])],32)])]))}};export{je as _,se as u};
