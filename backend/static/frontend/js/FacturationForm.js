import{N,X as $,Y as z,ah as G,ai as I,u as V,r as B,b as T,c as U,e as p,f as y,g as e,j as b,l as _,A as F,h as v,w as m,v as h,F as j,H as O,n as w,M as R,I as X,a3 as H,t as J,m as f,s as g}from"./index.js";import{s as Y,h as Z,r as A}from"./loading_message.js";import{r as K,a as Q}from"./ModalTransition.js";const W=N("intranetGymStore",{state:()=>({legalDocuments:[],dataLoaded:!1}),actions:{async init(){this.dataLoaded||await this.fetchLegalDocuments()},async fetchLegalDocuments(){try{const a=await $("list_legal_intranet_documents/");this.legalDocuments=a.data,this.dataLoaded=!0}catch(a){console.error("Error fetching legal documents:",a),this.legalDocuments=[],this.dataLoaded=!1}},async createReportRequest(a){const r=new FormData;r.append("document",a.document),r.append("initialDate",a.initialDate),r.append("endDate",a.endDate),r.append("paymentConcept",a.paymentConcept),r.append("paymentAmount",a.paymentAmount),a.files&&a.files.length>0&&a.files.forEach((i,x)=>{r.append(`files[${x}]`,i)});try{const i=await z("create_report_request/",r);return i.status===201?(await G(I.CREATE,`Enviaste un informe de facturación por ${a.paymentAmount} - ${a.paymentConcept}.`),this.dataLoaded=!1,i.status):(console.error("Failed to create report request:",i.status),null)}catch(i){return console.error("Error creating report request:",i.message),null}}}}),ee={class:"px-4 pb-10 sm:px-6 lg:px-8"},te={class:"w-full p-5 rounded-lg border-2 border-stroke bg-terciary space-y-3"},se={class:"flex items-center justify-between"},ne=e("h1",{class:"text-primary text-xl font-semibold"},"Presentar Informe",-1),ae={class:"mt-4 space-y-3"},oe={class:"grid md:grid-cols-2 xl:grid-cols-4 gap-3"},re=e("label",{for:"document-number",class:"block text-base font-medium leading-6 text-primary"},[f(" No. Contrato "),e("span",{class:"text-red-500"},"*")],-1),ie={class:"mt-2"},le=e("label",{for:"initial-report-period",class:"block text-base font-medium leading-6 text-primary"},[f(" Fecha Inicial "),e("span",{class:"text-red-500"},"*")],-1),de={class:"mt-2"},ce=e("label",{for:"final-report-period",class:"block text-base font-medium leading-6 text-primary"},[f(" Fecha Final "),e("span",{class:"text-red-500"},"*")],-1),ue={class:"mt-2"},pe=e("label",{for:"payment-concept",class:"block text-base font-medium leading-6 text-primary"},[f(" Concepto de Pago "),e("span",{class:"text-red-500"},"*")],-1),me={class:"mt-2"},ge=e("label",{for:"payment-concept",class:"block text-base font-medium leading-6 text-primary"},[f(" Valor a Cobrar y/o Facturar "),e("span",{class:"text-red-500"},"*")],-1),ye={class:"mt-2"},he={class:"flex items-center rounded-md bg-white px-3 outline outline-1 -outline-offset-1 outline-gray-300 focus-within:outline focus-within:outline-2 focus-within:outline-secondary"},fe=e("div",{class:"shrink-0 select-none text-base text-gray-500 sm:text-sm"}," $ ",-1),xe=e("div",{id:"payment-currency",class:"shrink-0 select-none text-base text-gray-500 sm:text-sm"}," COP ",-1),be={class:"col-span-full"},_e=e("label",{for:"files",class:"block text-base font-medium leading-6 text-primary"}," Anexos ",-1),ve={key:0,class:"text-center"},we={class:"mt-4 flex text-sm/6 text-gray-600"},ke={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"},Ce=e("span",null,"Sube un archivo",-1),De=e("p",{class:"pl-1"},"o arrastra y suelta",-1),Fe=e("p",{class:"text-xs/5 text-gray-600"}," PNG, JPG, PDF, DOCX de hasta 20MB ",-1),Ae={key:1,class:"w-full flex flex-wrap gap-3"},Ee=["onMouseenter","onMouseleave"],Me=["onClick"],qe={class:"text-center text-xs truncate w-20"},Se={class:"flex gap-3 span-col-full"},Le=["disabled"],Pe=e("span",null,"Guardar",-1),Ne=[Pe],$e=20*1024*1024,ze=20*1024*1024,Be={__name:"FacturationForm",emits:["close"],setup(a,{emit:r}){const i=r,x=V(),E=W(),l=B([]),n=T({document:null,initialDate:null,endDate:null,paymentConcept:"",paymentAmount:null,files:[]}),k=()=>{i("close")},M=o=>{const s=Array.from(o.target.files);C(s),o.target.value=null},q=o=>{o.preventDefault();const s=Array.from(o.dataTransfer.files);C(s)},C=o=>{let s=l.value.reduce((t,u)=>t+u.file.size,0);o.forEach(t=>{if(t.size>$e){g(`El archivo "${t.name}" excede el límite de 20 MB. Por favor, selecciona un archivo más pequeño.`,"warning");return}if(s+t.size>ze){g("No se pueden agregar más archivos porque el tamaño total excede el límite de 20 MB.","warning");return}const u=t.name.split(".").pop().toLowerCase();let d="",c={general:"",xMark:""};switch(u){case"png":case"jpg":case"jpeg":d=Q,c.general="border-gray-200 text-gray-400",c.xMark="bg-gray-400";break;case"pdf":d=A,c.general="border-red-600/20 text-red-600/60",c.xMark="bg-red-600/60";break;case"docx":d=A,c.general="border-blue-600/20 text-blue-600/60",c.xMark="bg-blue-600/60";break;default:g("¡Ups! Ese tipo de archivo no es compatible. Asegúrate de que el archivo sea PDF, DOCX, JPG, PNG, JPEG.","warning");return}l.value.push({name:t.name,icon:d,style:c,hover:!1,file:t}),s+=t.size})},S=o=>{l.value.splice(o,1)},D=U(()=>n.document!==null&&n.initialDate!==null&&n.endDate!==null&&n.paymentConcept.trim()&&n.paymentAmount!==null&&!isNaN(n.paymentAmount)),L=async()=>{Y();const o=l.value.map(s=>s.file);n.files=o;try{const s=await E.createReportRequest(n);Z(),s===201?(g("¡Solicitud creada exitosamente!","success"),P(),k(),x.push({name:"dashboard"})):g("Error al crear la solicitud. Intenta nuevamente.","error")}catch(s){console.error("Error al enviar la solicitud:",s),g("Hubo un error inesperado. Por favor, inténtalo más tarde.","error")}},P=()=>{n.document=null,n.initialDate=null,n.endDate=null,n.paymentConcept="",n.paymentAmount=null,l.value=[]};return(o,s)=>(p(),y("div",ee,[e("div",te,[e("div",se,[ne,b(_(F),{class:"size-6 text-primary cursor-pointer",onClick:k})]),e("form",{onSubmit:s[6]||(s[6]=v(t=>L(),["prevent"]))},[e("div",ae,[e("div",oe,[e("div",null,[re,e("div",ie,[m(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>n.document=t),type:"text",name:"document-number",id:"document-number",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,n.document]])])]),e("div",null,[le,e("div",de,[m(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>n.initialDate=t),type:"date",name:"initial-report-period",id:"initial-report-period",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,n.initialDate]])])]),e("div",null,[ce,e("div",ue,[m(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>n.endDate=t),type:"date",name:"final-report-period",id:"final-report-period",placeholder:"Fecha inicial",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,n.endDate]])])]),e("div",null,[pe,e("div",me,[m(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>n.paymentConcept=t),type:"text",name:"payment-concept",id:"payment-concept",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,n.paymentConcept]])])]),e("div",null,[ge,e("div",ye,[e("div",he,[fe,m(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>n.paymentAmount=t),type:"text",name:"payment-concept",id:"payment-concept",class:"block min-w-0 grow py-1.5 pl-1 pr-3 text-base text-primary border-none placeholder:text-gray-400 focus-within:outline-none focus-within:border-none focus-within:ring-0 sm:text-sm",placeholder:"0.00","aria-describedby":"payment-currency",required:""},null,512),[[h,n.paymentAmount]]),xe])])]),e("div",be,[_e,e("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 bg-white px-6 py-10",onDragover:s[5]||(s[5]=v(()=>{},["prevent"])),onDrop:v(q,["prevent"])},[l.value.length<1?(p(),y("div",ve,[b(_(K),{class:"mx-auto size-12 text-gray-300","aria-hidden":"true"}),e("div",we,[e("label",ke,[Ce,e("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",onChange:M},null,32)]),De]),Fe])):(p(),y("div",Ae,[(p(!0),y(j,null,O(l.value,(t,u)=>(p(),y("div",{key:u,class:w(["relative p-4 grid rounded-md bg-white border-2",t.style.general]),onMouseenter:d=>t.hover=!0,onMouseleave:d=>t.hover=!1},[m(e("div",{class:w(["absolute p-0.5 mt-2 ml-2 rounded-full",t.style.xMark]),onClick:d=>S(u)},[b(_(F),{class:"size-3 text-white"})],10,Me),[[R,t.hover]]),(p(),X(H(t.icon),{class:"size-12 mx-auto"})),e("span",qe,J(t.name),1)],42,Ee))),128))]))],32)]),e("div",Se,[e("button",{type:"submit",class:w(["p-2.5 text-sm font-medium rounded-md flex gap-2",D.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!D.value},Ne,10,Le)])])])],32)])]))}};export{Be as _,W as u};
