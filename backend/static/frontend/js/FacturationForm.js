import{C as $,D as z,E as G,ak as U,al as V,u as B,P as I,r as T,b as j,o as O,c as R,e as m,f as y,g as e,j as b,l as _,G as F,h as v,w as p,v as h,F as X,M as J,n as w,Q as H,m as Z,a4 as Q,t as Y,p as f,s as g}from"./index.js";import{s as K,h as W,r as N}from"./loading_message.js";import{r as ee,a as te}from"./PhotoIcon.js";const se=$("intranetGymStore",{state:()=>({legalDocuments:[],dataLoaded:!1}),actions:{async init(){this.dataLoaded||await this.fetchLegalDocuments()},async fetchLegalDocuments(){try{const n=await z("list_legal_intranet_documents/");this.legalDocuments=n.data,this.dataLoaded=!0}catch(n){console.error("Error fetching legal documents:",n),this.legalDocuments=[],this.dataLoaded=!1}},async createReportRequest(n){const o=new FormData;o.append("contract",n.document),o.append("initialDate",n.initialDate),o.append("endDate",n.endDate),o.append("paymentConcept",n.paymentConcept),o.append("paymentAmount",n.paymentAmount),o.append("userName",n.userName),o.append("userLastName",n.userLastName),o.append("userEmail",n.userEmail),n.files&&n.files.length>0&&n.files.forEach((i,x)=>{o.append(`files[${x}]`,i)});try{const i=await G("create_report_request/",o);return i.status===201?(await U(V.CREATE,`Enviaste un informe de facturación por ${n.paymentAmount} - ${n.paymentConcept}.`),this.dataLoaded=!1,i.status):(console.error("Failed to create report request:",i.status),null)}catch(i){return console.error("Error creating report request:",i.message),null}}}}),ae={class:"px-4 pb-10 sm:px-6 lg:px-8"},ne={class:"w-full p-5 rounded-lg border-2 border-stroke bg-terciary space-y-3"},re={class:"flex items-center justify-between"},oe=e("h1",{class:"text-primary text-xl font-semibold"},"Presentar Informe",-1),ie={class:"mt-4 space-y-3"},le={class:"grid md:grid-cols-2 xl:grid-cols-4 gap-3"},de=e("label",{for:"document-number",class:"block text-base font-medium leading-6 text-primary"},[f(" No. Contrato "),e("span",{class:"text-red-500"},"*")],-1),ce={class:"mt-2"},ue=e("label",{for:"initial-report-period",class:"block text-base font-medium leading-6 text-primary"},[f(" Fecha Inicial "),e("span",{class:"text-red-500"},"*")],-1),me={class:"mt-2"},pe=e("label",{for:"final-report-period",class:"block text-base font-medium leading-6 text-primary"},[f(" Fecha Final "),e("span",{class:"text-red-500"},"*")],-1),ge={class:"mt-2"},ye=e("label",{for:"payment-concept",class:"block text-base font-medium leading-6 text-primary"},[f(" Concepto de Pago "),e("span",{class:"text-red-500"},"*")],-1),he={class:"mt-2"},fe=e("label",{for:"payment-concept",class:"block text-base font-medium leading-6 text-primary"},[f(" Valor a Cobrar y/o Facturar "),e("span",{class:"text-red-500"},"*")],-1),xe={class:"mt-2"},be={class:"flex items-center rounded-md bg-white px-3 outline outline-1 -outline-offset-1 outline-gray-300 focus-within:outline focus-within:outline-2 focus-within:outline-secondary"},_e=e("div",{class:"shrink-0 select-none text-base text-gray-500 sm:text-sm"}," $ ",-1),ve=e("div",{id:"payment-currency",class:"shrink-0 select-none text-base text-gray-500 sm:text-sm"}," COP ",-1),we={class:"col-span-full"},ke=e("label",{for:"files",class:"block text-base font-medium leading-6 text-primary"}," Anexos ",-1),Ce={key:0,class:"text-center"},Ee={class:"mt-4 flex text-sm/6 text-gray-600"},De={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"},Fe=e("span",null,"Sube un archivo",-1),Ne=e("p",{class:"pl-1"},"o arrastra y suelta",-1),Ae=e("p",{class:"text-xs/5 text-gray-600"}," PNG, JPG, PDF, DOCX de hasta 20MB ",-1),Me={key:1,class:"w-full flex flex-wrap gap-3"},Le=["onMouseenter","onMouseleave"],Se=["onClick"],qe={class:"text-center text-xs truncate w-20"},Pe={class:"flex gap-3 span-col-full"},$e=["disabled"],ze=e("span",null,"Guardar",-1),Ge=[ze],Ue=20*1024*1024,Ve=20*1024*1024,je={__name:"FacturationForm",emits:["close"],setup(n,{emit:o}){const i=o,x=B(),A=se(),k=I(),l=T([]),t=j({document:null,initialDate:null,endDate:null,paymentConcept:"",paymentAmount:null,files:[],userName:"",userLastName:"",userEmail:""});O(async()=>{await k.init();const r=k.getCurrentUser;r&&(t.userName=r.first_name||"",t.userLastName=r.last_name||"",t.userEmail=r.email||"")});const C=()=>{i("close")},M=r=>{const a=Array.from(r.target.files);E(a),r.target.value=null},L=r=>{r.preventDefault();const a=Array.from(r.dataTransfer.files);E(a)},E=r=>{let a=l.value.reduce((s,u)=>s+u.file.size,0);r.forEach(s=>{if(s.size>Ue){g(`El archivo "${s.name}" excede el límite de 20 MB. Por favor, selecciona un archivo más pequeño.`,"warning");return}if(a+s.size>Ve){g("No se pueden agregar más archivos porque el tamaño total excede el límite de 20 MB.","warning");return}const u=s.name.split(".").pop().toLowerCase();let d="",c={general:"",xMark:""};switch(u){case"png":case"jpg":case"jpeg":d=te,c.general="border-gray-200 text-gray-400",c.xMark="bg-gray-400";break;case"pdf":d=N,c.general="border-red-600/20 text-red-600/60",c.xMark="bg-red-600/60";break;case"docx":d=N,c.general="border-blue-600/20 text-blue-600/60",c.xMark="bg-blue-600/60";break;default:g("¡Ups! Ese tipo de archivo no es compatible. Asegúrate de que el archivo sea PDF, DOCX, JPG, PNG, JPEG.","warning");return}l.value.push({name:s.name,icon:d,style:c,hover:!1,file:s}),a+=s.size})},S=r=>{l.value.splice(r,1)},D=R(()=>t.document!==null&&t.initialDate!==null&&t.endDate!==null&&t.paymentConcept.trim()&&t.paymentAmount!==null&&!isNaN(t.paymentAmount)),q=async()=>{K();const r=l.value.map(a=>a.file);t.files=r;try{const a=await A.createReportRequest(t);W(),a===201?(g("¡Solicitud creada exitosamente!","success"),P(),C(),x.push({name:"dashboard"})):g("Error al crear la solicitud. Intenta nuevamente.","error")}catch(a){console.error("Error al enviar la solicitud:",a),g("Hubo un error inesperado. Por favor, inténtalo más tarde.","error")}},P=()=>{t.document=null,t.initialDate=null,t.endDate=null,t.paymentConcept="",t.paymentAmount=null,l.value=[],t.userName="",t.userLastName="",t.userEmail=""};return(r,a)=>(m(),y("div",ae,[e("div",ne,[e("div",re,[oe,b(_(F),{class:"size-6 text-primary cursor-pointer",onClick:C})]),e("form",{onSubmit:a[6]||(a[6]=v(s=>q(),["prevent"]))},[e("div",ie,[e("div",le,[e("div",null,[de,e("div",ce,[p(e("input",{"onUpdate:modelValue":a[0]||(a[0]=s=>t.document=s),type:"text",name:"document-number",id:"document-number",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,t.document]])])]),e("div",null,[ue,e("div",me,[p(e("input",{"onUpdate:modelValue":a[1]||(a[1]=s=>t.initialDate=s),type:"date",name:"initial-report-period",id:"initial-report-period",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,t.initialDate]])])]),e("div",null,[pe,e("div",ge,[p(e("input",{"onUpdate:modelValue":a[2]||(a[2]=s=>t.endDate=s),type:"date",name:"final-report-period",id:"final-report-period",placeholder:"Fecha inicial",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,t.endDate]])])]),e("div",null,[ye,e("div",he,[p(e("input",{"onUpdate:modelValue":a[3]||(a[3]=s=>t.paymentConcept=s),type:"text",name:"payment-concept",id:"payment-concept",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[h,t.paymentConcept]])])]),e("div",null,[fe,e("div",xe,[e("div",be,[_e,p(e("input",{"onUpdate:modelValue":a[4]||(a[4]=s=>t.paymentAmount=s),type:"text",name:"payment-concept",id:"payment-concept",class:"block min-w-0 grow py-1.5 pl-1 pr-3 text-base text-primary border-none placeholder:text-gray-400 focus-within:outline-none focus-within:border-none focus-within:ring-0 sm:text-sm",placeholder:"0.00","aria-describedby":"payment-currency",required:""},null,512),[[h,t.paymentAmount]]),ve])])]),e("div",we,[ke,e("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 bg-white px-6 py-10",onDragover:a[5]||(a[5]=v(()=>{},["prevent"])),onDrop:v(L,["prevent"])},[l.value.length<1?(m(),y("div",Ce,[b(_(ee),{class:"mx-auto size-12 text-gray-300","aria-hidden":"true"}),e("div",Ee,[e("label",De,[Fe,e("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",onChange:M},null,32)]),Ne]),Ae])):(m(),y("div",Me,[(m(!0),y(X,null,J(l.value,(s,u)=>(m(),y("div",{key:u,class:w(["relative p-4 grid rounded-md bg-white border-2",s.style.general]),onMouseenter:d=>s.hover=!0,onMouseleave:d=>s.hover=!1},[p(e("div",{class:w(["absolute p-0.5 mt-2 ml-2 rounded-full",s.style.xMark]),onClick:d=>S(u)},[b(_(F),{class:"size-3 text-white"})],10,Se),[[H,s.hover]]),(m(),Z(Q(s.icon),{class:"size-12 mx-auto"})),e("span",qe,Y(s.name),1)],42,Le))),128))]))],32)]),e("div",Pe,[e("button",{type:"submit",class:w(["p-2.5 text-sm font-medium rounded-md flex gap-2",D.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!D.value},Ge,10,$e)])])])],32)])]))}};export{je as _,se as u};
