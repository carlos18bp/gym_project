import{r as v,e as a,f as m,g as e,h as y,t as o,w as C,j as R,p as E,l as b,k as L,N as I,O as M,a as U,c as O,T as A,o as j,S as G,v as V,aS as z,F as W,M as H,x as J,u as K,P as X,b as Y,d as Z,i as D,a8 as ee}from"./index.js";import{_ as te}from"./SearchBarAndFilterBy.js";import{_ as se,a as ae,b as oe,u as le}from"./DeleteConfirmModal.js";import{_ as F}from"./_plugin-vue_export-helper.js";import{r as ne}from"./PencilIcon.js";import{r as re}from"./TrashIcon.js";import{r as ie}from"./PlusIcon.js";import"./MagnifyingGlassIcon2.js";import"./ExclamationTriangleIcon.js";const N=t=>(I("data-v-a3a1ab71"),t=t(),M(),t),de={class:"bg-white rounded-lg shadow hover:shadow-md transition-shadow duration-200 overflow-hidden"},ue={class:"px-6 py-4 border-b border-gray-200"},ce={class:"flex items-center justify-between"},ve={class:"flex items-center space-x-3"},me={class:"text-sm font-medium text-gray-900"},ge={key:0,class:"relative"},he={key:0,class:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-10"},fe={class:"py-1"},_e={class:"px-6 py-4"},pe={class:"mb-4"},xe={class:"text-lg font-semibold text-gray-900 mb-1"},ye={class:"text-sm text-gray-600"},be={class:"space-y-2 mb-4"},we={class:"flex items-center text-sm"},qe=N(()=>e("span",{class:"font-medium text-gray-700 w-20"},"Tipo:",-1)),Se={class:"text-gray-600"},$e={class:"flex items-center text-sm"},ke=N(()=>e("span",{class:"font-medium text-gray-700 w-20"},"Área:",-1)),Ce={class:"text-gray-600"},Re={class:"flex items-center text-sm space-x-2"},De=N(()=>e("span",{class:"font-medium text-gray-700 w-20"},"Respuestas:",-1)),Ee={class:"text-gray-600"},Le={class:"mb-4"},Ne={class:"text-sm text-gray-600 line-clamp-3"},Ve={class:"flex items-center justify-between pt-4 border-t border-gray-100"},Ie={class:"text-xs text-gray-500"},Me={__name:"LegalRequestCard",props:{request:{type:Object,required:!0},userRole:{type:String,default:"client"}},emits:["view-detail","status-updated","deleted"],setup(t,{emit:$}){const f=t,w=$,_=v(!1),s=v(!1),d=v(!1),x=l=>new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),g=()=>{_.value=!1,s.value=!0},h=()=>{_.value=!1,d.value=!0},p=l=>{s.value=!1,w("status-updated",l)},q=()=>{d.value=!1,w("deleted",f.request.id)},k={beforeMount(l,r){l.clickOutsideEvent=u=>{l===u.target||l.contains(u.target)||r.value()},document.addEventListener("click",l.clickOutsideEvent)},unmounted(l){document.removeEventListener("click",l.clickOutsideEvent)}};return(l,r)=>(a(),m("div",de,[e("div",ue,[e("div",ce,[e("div",ve,[y(se,{status:t.request.status},null,8,["status"]),e("span",me,o(t.request.request_number),1)]),t.userRole==="lawyer"?(a(),m("div",ge,[_.value?C((a(),m("div",he,[e("div",fe,[e("button",{onClick:g,class:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left"},[y(R(ne),{class:"h-4 w-4 mr-3"}),E(" Cambiar Estado ")]),e("button",{onClick:h,class:"flex items-center px-4 py-2 text-sm text-red-700 hover:bg-red-50 w-full text-left"},[y(R(re),{class:"h-4 w-4 mr-3"}),E(" Eliminar ")])])])),[[k,()=>_.value=!1]]):b("",!0)])):b("",!0)])]),e("div",_e,[e("div",pe,[e("h3",xe,o(t.request.first_name)+" "+o(t.request.last_name),1),e("p",ye,o(t.request.email),1)]),e("div",be,[e("div",we,[qe,e("span",Se,o(t.request.request_type_name),1)]),e("div",$e,[ke,e("span",Ce,o(t.request.discipline_name),1)]),e("div",Re,[De,e("span",Ee,o(t.request.response_count),1)])]),e("div",Le,[e("p",Ne,o(t.request.description),1)]),e("div",Ve,[e("span",Ie,o(x(t.request.created_at)),1),e("button",{onClick:r[0]||(r[0]=u=>l.$emit("view-detail",t.request.id)),class:"text-indigo-600 hover:text-indigo-800 text-sm font-medium"}," Ver detalles → ")])]),s.value?(a(),L(ae,{key:0,request:t.request,onClose:r[1]||(r[1]=u=>s.value=!1),onUpdated:p},null,8,["request"])):b("",!0),d.value?(a(),L(oe,{key:1,request:t.request,onClose:r[2]||(r[2]=u=>d.value=!1),onDeleted:q},null,8,["request"])):b("",!0)]))}},Ue=F(Me,[["__scopeId","data-v-a3a1ab71"]]),Oe=t=>(I("data-v-98ced2ef"),t=t(),M(),t),je={class:"legal-requests-list"},Fe={class:"mb-6 bg-white rounded-lg shadow p-6"},Qe={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4"},Te={class:"text-2xl font-bold text-gray-900"},Be={class:"text-gray-600 mt-1"},Pe={class:"flex flex-col sm:flex-row gap-3"},Ae=J('<option value="" data-v-98ced2ef>Todos los estados</option><option value="PENDING" data-v-98ced2ef>Pendiente</option><option value="IN_REVIEW" data-v-98ced2ef>En Revisión</option><option value="RESPONDED" data-v-98ced2ef>Respondida</option><option value="CLOSED" data-v-98ced2ef>Cerrada</option>',5),Ge=[Ae],ze={class:"flex gap-2"},We={key:0,class:"flex justify-center py-12"},He=Oe(()=>e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"},null,-1)),Je=[He],Ke={key:1,class:"text-center py-12 bg-white rounded-lg shadow"},Xe={class:"mt-4 text-lg font-medium text-gray-900"},Ye={class:"mt-2 text-gray-600"},Ze={key:2,class:"grid gap-6 md:grid-cols-2 lg:grid-cols-3"},et={key:3,class:"text-center mt-8"},tt=["disabled"],st={key:4,class:"mt-6 text-center text-gray-600"},at={__name:"LegalRequestsList",props:{userRole:{type:String,default:"client"},externalSearchQuery:{type:String,default:""}},emits:["view-detail"],setup(t,{emit:$}){const f=t,w=le(),_=U(),s=v([]),d=v(!1),x=v(!1),g=v(""),h=v(""),p=v(""),q=v(0),k=v(!1),l=v(1),r=O(()=>{var c;return f.userRole||((c=_.user)==null?void 0:c.role)||"client"}),u=async(c=1,n=!1)=>{c===1?d.value=!0:x.value=!0;try{const i={page:c,search:f.externalSearchQuery,status:g.value,date_from:h.value,date_to:p.value},S=await w.fetchRequests(i);n?s.value=[...s.value,...S.requests]:s.value=S.requests,q.value=S.count,k.value=S.requests.length===20,l.value=c}catch(i){console.error("❌ Error fetching requests:",i)}finally{d.value=!1,x.value=!1}},Q=()=>{u(l.value+1,!0)},T=()=>{g.value="",h.value="",p.value="",u()};A(()=>f.externalSearchQuery,()=>{u()});const B=c=>{const n=s.value.findIndex(i=>i.id===c.id);n!==-1&&(s.value[n]=c)},P=c=>{s.value=s.value.filter(n=>n.id!==c),q.value-=1};return j(()=>{u()}),(c,n)=>(a(),m("div",je,[e("div",Fe,[e("div",Qe,[e("div",null,[e("h1",Te,o(r.value==="lawyer"?"Solicitudes":"Mis Solicitudes"),1),e("p",Be,o(r.value==="lawyer"?"Gestiona todas las solicitudes legales":"Seguimiento de tus solicitudes"),1)]),e("div",Pe,[C(e("select",{"onUpdate:modelValue":n[0]||(n[0]=i=>g.value=i),class:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-48",onChange:u},Ge,544),[[G,g.value]]),e("div",ze,[C(e("input",{"onUpdate:modelValue":n[1]||(n[1]=i=>h.value=i),type:"date",class:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Fecha desde",onChange:u},null,544),[[V,h.value]]),C(e("input",{"onUpdate:modelValue":n[2]||(n[2]=i=>p.value=i),type:"date",class:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Fecha hasta",onChange:u},null,544),[[V,p.value]])]),g.value||h.value||p.value?(a(),m("button",{key:0,onClick:T,class:"px-3 py-2 text-gray-600 hover:text-gray-800 text-sm",title:"Limpiar filtros"}," ✕ Limpiar ")):b("",!0)])])]),d.value?(a(),m("div",We,Je)):s.value.length===0?(a(),m("div",Ke,[y(R(z),{class:"mx-auto h-16 w-16 text-gray-400"}),e("h3",Xe,o(f.externalSearchQuery?"No se encontraron solicitudes":"No hay solicitudes"),1),e("p",Ye,o(f.externalSearchQuery?"Intenta con otros términos de búsqueda":r.value==="lawyer"?"No hay solicitudes registradas en el sistema":"No has creado ninguna solicitud aún"),1)])):(a(),m("div",Ze,[(a(!0),m(W,null,H(s.value,i=>(a(),L(Ue,{key:i.id,request:i,"user-role":r.value,onViewDetail:n[3]||(n[3]=S=>c.$emit("view-detail",S)),onStatusUpdated:B,onDeleted:P},null,8,["request","user-role"]))),128))])),k.value?(a(),m("div",et,[e("button",{onClick:Q,disabled:x.value,class:"px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed"},o(x.value?"Cargando...":"Cargar más"),9,tt)])):b("",!0),s.value.length>0?(a(),m("div",st," Mostrando "+o(s.value.length)+" de "+o(q.value)+" solicitudes ",1)):b("",!0)]))}},ot=F(at,[["__scopeId","data-v-98ced2ef"]]),lt={class:"legal-requests-page"},nt={key:0,class:"flex items-center space-x-4"},rt={class:"flex space-x-4","aria-label":"Tabs"},_t={__name:"LegalRequestsList",setup(t){const $=K(),f=U(),w=X(),_=v(""),s=Y({}),d=O(()=>s.role||"client"),x=g=>{$.push({name:"legal_request_detail",params:{id:g}})};return j(async()=>{await w.init(),Object.assign(s,w.userById(f.userAuth.id))}),(g,h)=>{const p=Z("router-link");return a(),m("div",lt,[y(te,{"onUpdate:searchQuery":h[0]||(h[0]=q=>_.value=q)},{auxiliary_button:D(()=>[d.value==="client"||d.value==="basic"||d.value==="corporate_client"?(a(),m("div",nt,[e("nav",rt,[y(p,{to:{name:"legal_request_create"},class:"inline-flex items-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg shadow-md hover:shadow-lg transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1"},{default:D(()=>[y(R(ie),{class:"w-5 h-5 mr-2"}),E(" Nueva Solicitud ")]),_:1})])])):b("",!0)]),default:D(()=>[ee(g.$slots,"default")]),_:3}),y(ot,{"user-role":d.value,"external-search-query":_.value,onViewDetail:x},null,8,["user-role","external-search-query"])])}}};export{_t as default};
