import{r as c,e as a,f as m,g as e,j as _,t as o,w as R,l as k,p as D,i as w,m as L,N as V,O as I,a as U,c as O,T as G,o as T,S as z,v as M,aS as j,F as W,M as H,x as J,u as K,P as X,b as Y,d as Z,k as C,aT as ee}from"./index.js";import{_ as te}from"./SearchBarAndFilterBy.js";import{_ as se,a as ae,b as oe,u as le}from"./DeleteConfirmModal.js";import{_ as F}from"./_plugin-vue_export-helper.js";import{r as ne}from"./PencilIcon.js";import{r as re}from"./TrashIcon.js";import{r as ie}from"./PlusIcon.js";import"./MagnifyingGlassIcon.js";import"./ExclamationTriangleIcon.js";const N=t=>(V("data-v-a3a1ab71"),t=t(),I(),t),de={class:"bg-white rounded-lg shadow hover:shadow-md transition-shadow duration-200 overflow-hidden"},ue={class:"px-6 py-4 border-b border-gray-200"},ce={class:"flex items-center justify-between"},me={class:"flex items-center space-x-3"},ve={class:"text-sm font-medium text-gray-900"},ge={key:0,class:"relative"},he={key:0,class:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-10"},_e={class:"py-1"},fe={class:"px-6 py-4"},pe={class:"mb-4"},xe={class:"text-lg font-semibold text-gray-900 mb-1"},ye={class:"text-sm text-gray-600"},be={class:"space-y-2 mb-4"},we={class:"flex items-center text-sm"},qe=N(()=>e("span",{class:"font-medium text-gray-700 w-20"},"Tipo:",-1)),$e={class:"text-gray-600"},Se={class:"flex items-center text-sm"},ke=N(()=>e("span",{class:"font-medium text-gray-700 w-20"},"Área:",-1)),Ce={class:"text-gray-600"},Re={class:"flex items-center text-sm space-x-2"},De=N(()=>e("span",{class:"font-medium text-gray-700 w-20"},"Respuestas:",-1)),Ee={class:"text-gray-600"},Le={class:"mb-4"},Ne={class:"text-sm text-gray-600 line-clamp-3"},Me={class:"flex items-center justify-between pt-4 border-t border-gray-100"},Ve={class:"text-xs text-gray-500"},Ie={__name:"LegalRequestCard",props:{request:{type:Object,required:!0},userRole:{type:String,default:"client"}},emits:["view-detail","status-updated","deleted"],setup(t,{emit:E}){const f=t,$=E,p=c(!1),s=c(!1),g=c(!1),x=l=>new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),y=()=>{p.value=!1,s.value=!0},h=()=>{p.value=!1,g.value=!0},v=l=>{s.value=!1,$("status-updated",l)},b=()=>{g.value=!1,$("deleted",f.request.id)},q={beforeMount(l,r){l.clickOutsideEvent=d=>{l===d.target||l.contains(d.target)||r.value()},document.addEventListener("click",l.clickOutsideEvent)},unmounted(l){document.removeEventListener("click",l.clickOutsideEvent)}};return(l,r)=>(a(),m("div",de,[e("div",ue,[e("div",ce,[e("div",me,[_(se,{status:t.request.status},null,8,["status"]),e("span",ve,o(t.request.request_number),1)]),t.userRole==="lawyer"?(a(),m("div",ge,[p.value?R((a(),m("div",he,[e("div",_e,[e("button",{onClick:y,class:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left"},[_(k(ne),{class:"h-4 w-4 mr-3"}),D(" Cambiar Estado ")]),e("button",{onClick:h,class:"flex items-center px-4 py-2 text-sm text-red-700 hover:bg-red-50 w-full text-left"},[_(k(re),{class:"h-4 w-4 mr-3"}),D(" Eliminar ")])])])),[[q,()=>p.value=!1]]):w("",!0)])):w("",!0)])]),e("div",fe,[e("div",pe,[e("h3",xe,o(t.request.first_name)+" "+o(t.request.last_name),1),e("p",ye,o(t.request.email),1)]),e("div",be,[e("div",we,[qe,e("span",$e,o(t.request.request_type_name),1)]),e("div",Se,[ke,e("span",Ce,o(t.request.discipline_name),1)]),e("div",Re,[De,e("span",Ee,o(t.request.response_count),1)])]),e("div",Le,[e("p",Ne,o(t.request.description),1)]),e("div",Me,[e("span",Ve,o(x(t.request.created_at)),1),e("button",{onClick:r[0]||(r[0]=d=>l.$emit("view-detail",t.request.id)),class:"text-indigo-600 hover:text-indigo-800 text-sm font-medium"}," Ver detalles → ")])]),s.value?(a(),L(ae,{key:0,request:t.request,onClose:r[1]||(r[1]=d=>s.value=!1),onUpdated:v},null,8,["request"])):w("",!0),g.value?(a(),L(oe,{key:1,request:t.request,onClose:r[2]||(r[2]=d=>g.value=!1),onDeleted:b},null,8,["request"])):w("",!0)]))}},Ue=F(Ie,[["__scopeId","data-v-a3a1ab71"]]),Oe=t=>(V("data-v-98ced2ef"),t=t(),I(),t),Te={class:"legal-requests-list"},je={class:"mb-6 bg-white rounded-lg shadow p-6"},Fe={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4"},Qe={class:"text-2xl font-bold text-gray-900"},Be={class:"text-gray-600 mt-1"},Pe={class:"flex flex-col sm:flex-row gap-3"},Ae=J('<option value="" data-v-98ced2ef>Todos los estados</option><option value="PENDING" data-v-98ced2ef>Pendiente</option><option value="IN_REVIEW" data-v-98ced2ef>En Revisión</option><option value="RESPONDED" data-v-98ced2ef>Respondida</option><option value="CLOSED" data-v-98ced2ef>Cerrada</option>',5),Ge=[Ae],ze={class:"flex gap-2"},We={key:0,class:"flex justify-center py-12"},He=Oe(()=>e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"},null,-1)),Je=[He],Ke={key:1,class:"text-center py-12 bg-white rounded-lg shadow"},Xe={class:"mt-4 text-lg font-medium text-gray-900"},Ye={class:"mt-2 text-gray-600"},Ze={key:2,class:"grid gap-6 md:grid-cols-2 lg:grid-cols-3"},et={key:3,class:"text-center mt-8"},tt=["disabled"],st={key:4,class:"mt-6 text-center text-gray-600"},at={__name:"LegalRequestsList",props:{userRole:{type:String,default:"client"},externalSearchQuery:{type:String,default:""}},emits:["view-detail"],setup(t,{emit:E}){const f=t,$=le(),p=U(),s=c([]),g=c(!1),x=c(!1),y=c(""),h=c(""),v=c(""),b=c(0),q=c(!1),l=c(1),r=O(()=>{var u;return f.userRole||((u=p.user)==null?void 0:u.role)||"client"}),d=async(u=1,n=!1)=>{u===1?g.value=!0:x.value=!0;try{const i={page:u,search:f.externalSearchQuery,status:y.value,date_from:h.value,date_to:v.value},S=await $.fetchRequests(i);n?s.value=[...s.value,...S.requests]:s.value=S.requests,b.value=S.count,q.value=S.requests.length===20,l.value=u}catch(i){console.error("❌ Error fetching requests:",i)}finally{g.value=!1,x.value=!1}},Q=()=>{d(l.value+1,!0)},B=()=>{y.value="",h.value="",v.value="",d()};G(()=>f.externalSearchQuery,()=>{d()});const P=u=>{const n=s.value.findIndex(i=>i.id===u.id);n!==-1&&(s.value[n]=u)},A=u=>{s.value=s.value.filter(n=>n.id!==u),b.value-=1};return T(()=>{d()}),(u,n)=>(a(),m("div",Te,[e("div",je,[e("div",Fe,[e("div",null,[e("h1",Qe,o(r.value==="lawyer"?"Solicitudes":"Mis Solicitudes"),1),e("p",Be,o(r.value==="lawyer"?"Gestiona todas las solicitudes legales":"Seguimiento de tus solicitudes"),1)]),e("div",Pe,[R(e("select",{"onUpdate:modelValue":n[0]||(n[0]=i=>y.value=i),class:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-48",onChange:d},Ge,544),[[z,y.value]]),e("div",ze,[R(e("input",{"onUpdate:modelValue":n[1]||(n[1]=i=>h.value=i),type:"date",class:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Fecha desde",onChange:d},null,544),[[M,h.value]]),R(e("input",{"onUpdate:modelValue":n[2]||(n[2]=i=>v.value=i),type:"date",class:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Fecha hasta",onChange:d},null,544),[[M,v.value]])]),y.value||h.value||v.value?(a(),m("button",{key:0,onClick:B,class:"px-3 py-2 text-gray-600 hover:text-gray-800 text-sm",title:"Limpiar filtros"}," ✕ Limpiar ")):w("",!0)])])]),g.value?(a(),m("div",We,Je)):s.value.length===0?(a(),m("div",Ke,[_(k(j),{class:"mx-auto h-16 w-16 text-gray-400"}),e("h3",Xe,o(f.externalSearchQuery?"No se encontraron solicitudes":"No hay solicitudes"),1),e("p",Ye,o(f.externalSearchQuery?"Intenta con otros términos de búsqueda":r.value==="lawyer"?"No hay solicitudes registradas en el sistema":"No has creado ninguna solicitud aún"),1)])):(a(),m("div",Ze,[(a(!0),m(W,null,H(s.value,i=>(a(),L(Ue,{key:i.id,request:i,"user-role":r.value,onViewDetail:n[3]||(n[3]=S=>u.$emit("view-detail",S)),onStatusUpdated:P,onDeleted:A},null,8,["request","user-role"]))),128))])),q.value?(a(),m("div",et,[e("button",{onClick:Q,disabled:x.value,class:"px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed"},o(x.value?"Cargando...":"Cargar más"),9,tt)])):w("",!0),s.value.length>0?(a(),m("div",st," Mostrando "+o(s.value.length)+" de "+o(b.value)+" solicitudes ",1)):w("",!0)]))}},ot=F(at,[["__scopeId","data-v-98ced2ef"]]),lt={class:"legal-requests-page"},nt=e("span",{class:"sr-only"},"Abrir menú",-1),rt={key:0,class:"flex items-center space-x-4"},it={class:"flex space-x-4","aria-label":"Tabs"},pt={__name:"LegalRequestsList",emits:["toggle-sidebar"],setup(t,{emit:E}){const f=K(),$=U(),p=X(),s=c(""),g=Y({}),x=O(()=>g.role||"client"),y=h=>{f.push({name:"legal_request_detail",params:{id:h}})};return T(async()=>{await p.init(),Object.assign(g,p.userById($.userAuth.id))}),(h,v)=>{const b=Z("router-link");return a(),m("div",lt,[_(te,{"onUpdate:searchQuery":v[1]||(v[1]=q=>s.value=q)},{auxiliary_button:C(()=>[x.value==="client"?(a(),m("div",rt,[e("nav",it,[_(b,{to:{name:"legal_requests_list"},class:"text-gray-500 hover:text-gray-700 px-3 py-2 text-sm font-medium rounded-md","active-class":"bg-indigo-100 text-indigo-700"},{default:C(()=>[_(k(j),{class:"w-4 h-4 inline mr-1"}),D(" Mis Solicitudes ")]),_:1}),_(b,{to:{name:"legal_request_create"},class:"text-gray-500 hover:text-gray-700 px-3 py-2 text-sm font-medium rounded-md","active-class":"bg-indigo-100 text-indigo-700"},{default:C(()=>[_(k(ie),{class:"w-4 h-4 inline mr-1"}),D(" Nueva ")]),_:1})])])):w("",!0)]),default:C(()=>[e("button",{type:"button",class:"-m-2.5 p-2.5 text-gray-700 lg:hidden",onClick:v[0]||(v[0]=q=>h.$emit("toggle-sidebar"))},[nt,_(k(ee),{class:"h-6 w-6","aria-hidden":"true"})])]),_:1}),_(ot,{"user-role":x.value,"external-search-query":s.value,onViewDetail:y},null,8,["user-role","external-search-query"])])}}};export{pt as default};
