import{e as o,f as m,g as e,r as j,s as y,E as Me,w as ae,Q as ye,m as z,k as N,t as D,j as S,l as c,G as J,a1 as xe,c as L,T as ce,o as Se,ap as Pe,p as R,i as I,F as Z,M as X,N as we,O as _e,ad as Fe,ae as pe,af as Oe,n as T,ag as he,ac as Ie,u as ke,a8 as te,a4 as je,aU as qe,aH as Ve,h as ie,v as ze,b as Ge,D as be,P as Be,aY as We,aj as He}from"./index.js";import{r as Ze,g as De,u as Qe,_ as Ye}from"./DocumentPermissionsManager.js";import{useRecentViews as Xe}from"./useRecentViews.js";import{u as de,o as Re,d as Je}from"./index3.js";import{_ as ue}from"./_plugin-vue_export-helper.js";import{r as Ke}from"./TrashIcon.js";import{s as et,h as Ce,r as le}from"./loading_message.js";import{a as Ue,r as Te}from"./PhotoIcon.js";import{r as Ee}from"./InformationCircleIcon.js";function tt(t,h){return o(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})])}function Ae(t,h){return o(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function st(t,h){return o(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})])}function Le(t,h){return o(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"})])}function at(t,h){return o(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})])}function ve(t,h){return o(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"})])}function ot(){const t=j(!1),h=j("");async function r(n,v,i="",d="",f=[],p={}){if(!v)throw h.value="Recipient email is required.",await y(h.value,"error"),new Error(h.value);const b=new FormData;b.append("to_email",v),b.append("subject",i),b.append("body",d),f.forEach((g,s)=>{b.append(`attachments[${s}]`,g)});for(const[g,s]of Object.entries(p))b.append(g,s);try{t.value=!0,h.value="",et("Sending email...","Please wait while we send the email.");const g=await Me(n,b);return Ce(),await y("Email sent successfully.","success"),g.data}catch(g){throw Ce(),console.error("Error sending email:",g.message),h.value="An error occurred while sending the email. Please try again.",await y(h.value,"error"),g}finally{t.value=!1}}return{sendEmail:r,isLoading:t,errorMessage:h}}const rt={class:"bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full overflow-auto max-h-[80vh]"},nt={class:"flex justify-between items-center mb-4"},it={class:"text-lg font-bold"},lt=["innerHTML"],Do={__name:"DocumentPreviewModal",props:{isVisible:Boolean,documentData:{type:Object,default:()=>({title:"",content:""})}},emits:["close"],setup(t,{emit:h}){const r=h,n=()=>{r("close")};return(v,i)=>ae((o(),z(xe,null,{default:N(()=>[e("div",rt,[e("div",nt,[e("h2",it," Previsualización del Documento: "+D(t.documentData.title),1),e("button",{onClick:n},[S(c(J),{class:"size-6 text-gray-500 hover:text-gray-700"})])]),e("div",{class:"prose max-w-none",innerHTML:t.documentData.content},null,8,lt)])]),_:1},512)),[[ye,t.isVisible]])}},W=t=>(we("data-v-61bc1edc"),t=t(),_e(),t),ct={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},dt={class:"px-6 py-4 border-b border-gray-200"},ut=W(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gestión de Membrete",-1)),mt={class:"text-sm text-gray-500 mt-1"},gt={class:"p-6 overflow-y-auto flex-grow"},ft={key:0,class:"text-center py-10"},pt=W(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),ht={class:"mt-4 text-gray-500"},bt={key:1,class:"space-y-6"},vt={key:0,class:"space-y-4"},yt=W(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete Actual",-1)),xt={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},wt=["src"],_t={class:"mt-4 flex justify-center space-x-3"},kt=["disabled"],$t={key:1,class:"text-center py-8"},Dt=W(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete",-1)),Ct=W(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," Este documento no tiene una imagen de membrete configurada. ",-1)),Et={class:"space-y-4"},Mt={class:"text-lg font-medium text-gray-900"},St={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},Pt={key:0},Ft={class:"mt-4"},Ot=W(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, máximo 10MB ",-1)),It=W(()=>e("p",{class:"text-xs text-gray-400 mt-1"}," Dimensiones ideales: 612 × 792 píxeles (8.5:14 Legal/Oficio) ",-1)),jt={key:1,class:"space-y-4"},zt={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Bt={class:"text-gray-400"},Rt={key:0,class:"mt-4"},Ut=["src"],Tt={class:"flex justify-center space-x-3"},At=["disabled"],Lt={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Nt={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},qt={class:"flex items-center space-x-2"},Vt=W(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete",-1)),Gt=W(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"📐 Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"612 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"792 píxeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporción:"),e("span",{class:"ml-2 text-blue-600"},"8.5:14 (Legal/Oficio)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"±10%")])])])],-1)),Wt=W(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🎨 Distribución Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-52 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-16 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-14 left-1 text-blue-700 text-[10px]"},"150-200px"),e("div",{class:"absolute top-16 left-0 right-0 bottom-16 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"⚠️ ZONA CRÍTICA")])]),e("div",{class:"absolute top-28 left-1 text-yellow-700 text-[10px]"},"400-500px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-16 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-14 left-1 text-green-700 text-[10px]"},"92-192px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mantén semi-transparente. El texto del documento se superpone aquí.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, teléfonos, emails, información de contacto.")])])])])])],-1)),Ht=W(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"🔧 Consideraciones Técnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Posicionamiento:"),R(" La imagen se centra automáticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Transparencia:"),R(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Márgenes:"),R(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"•"),e("span",null,[e("strong",null,"Resolución:"),R(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"⚠️"),e("span",null,[e("strong",null,"Zona crítica:"),R(" Evita elementos gráficos densos en el centro (400-500px de altura)")])])])])],-1)),Zt=W(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"💡 Tips de Diseño Rápido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"• Si solo tienes header, ubícalo en los primeros 150-200px"),e("div",null,"• El resto de la imagen debe ser transparente o blanco"),e("div",null,"• Para footer, usa los últimos 92-192px"),e("div",null,"• El texto se superpone en toda la imagen, mantén el centro claro")])],-1)),Qt={key:3,class:"space-y-2"},Yt={class:"flex"},Xt={class:"text-sm text-yellow-700"},Jt={__name:"LetterheadModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close","uploaded","deleted"],setup(t,{emit:h}){const r=t,n=h,v=de(),i=j(!1),d=j(""),f=j(!1),p=j(!1),b=j(null),g=j(null),s=j(null),C=j([]),U=j(null),A=j(!1),a=L(()=>{var k;return(k=r.document)==null?void 0:k.id}),x=()=>{E(),n("close")},B=k=>{const $=k.target.files[0];if(!$)return;if(!$.type.includes("png")){alert("Solo se permiten archivos PNG");return}if($.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}b.value=$,C.value=[];const H=new FileReader;H.onload=G=>{g.value=G.target.result;const Y=new Image;Y.onload=()=>{q(Y.width,Y.height)},Y.src=G.target.result},H.readAsDataURL($)},q=(k,$)=>{const se=k/$,K=612/792,fe=Math.abs(se-K)/K;if(k===612&&$===792){C.value.push("✅ Dimensiones perfectas: 612 × 792 píxeles");return}fe<=.1?(C.value.push(`ℹ️ Buenas proporciones detectadas: ${k} × ${$} píxeles (${se.toFixed(3)})`),(k!==612||$!==792)&&C.value.push("💡 Para mejores resultados, usa exactamente 612 × 792 píxeles")):(C.value.push(`⚠️ Proporciones no ideales: ${k} × ${$} píxeles (${se.toFixed(3)})`),C.value.push(`🎯 Proporciones recomendadas: ${K.toFixed(3)} (8.5:14)`),C.value.push("📐 Considera redimensionar tu imagen a 612 × 792 píxeles")),(k<300||$<400)&&C.value.push("⚠️ Imagen muy pequeña - puede verse pixelada en documentos"),(k>1500||$>2e3)&&C.value.push("ℹ️ Imagen muy grande - se redimensionará automáticamente")},E=()=>{b.value=null,g.value=null,C.value=[],A.value=!1,U.value&&(U.value.value="")},_=async()=>{var k;if(!(!b.value||!a.value)){f.value=!0,C.value=[];try{const $=await v.uploadLetterheadImage(a.value,b.value);(k=$.data)!=null&&k.warnings&&$.data.warnings.length>0&&(C.value=$.data.warnings),await M(),E(),n("uploaded",$.data)}catch($){console.error("Error uploading letterhead:",$),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{f.value=!1}}},M=async()=>{if(a.value)try{const k=await v.getLetterheadImage(a.value);k.data&&(s.value=URL.createObjectURL(k.data))}catch{s.value=null}},F=()=>{confirm("¿Estás seguro de que deseas eliminar la imagen de membrete?")&&P()},P=async()=>{if(a.value){p.value=!0;try{await v.deleteLetterheadImage(a.value),s.value&&URL.revokeObjectURL(s.value),s.value=null,n("deleted")}catch(k){console.error("Error deleting letterhead:",k),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{p.value=!1}}},V=()=>{var k;if(s.value){const $=document.createElement("a");$.href=s.value,$.download=`membrete-${((k=r.document)==null?void 0:k.title)||"documento"}.png`,document.body.appendChild($),$.click(),document.body.removeChild($)}},Q=()=>{s.value=null},me=k=>{if(k===0)return"0 Bytes";const $=1024,H=["Bytes","KB","MB","GB"],G=Math.floor(Math.log(k)/Math.log($));return parseFloat((k/Math.pow($,G)).toFixed(2))+" "+H[G]};ce(()=>r.isVisible,k=>{k&&a.value&&M()}),ce(()=>r.document,k=>{k&&r.isVisible&&M()});const ge=()=>{s.value&&URL.revokeObjectURL(s.value),g.value&&URL.revokeObjectURL(g.value)};return Se(()=>{r.isVisible&&a.value&&M()}),Pe(ge),(k,$)=>ae((o(),z(xe,null,{default:N(()=>{var H;return[e("div",ct,[e("div",dt,[ut,e("p",mt," Documento: "+D(((H=t.document)==null?void 0:H.title)||"Cargando..."),1),e("button",{onClick:x,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[S(c(J),{class:"h-6 w-6"})])]),e("div",gt,[i.value?(o(),m("div",ft,[pt,e("p",ht,D(d.value),1)])):(o(),m("div",bt,[s.value?(o(),m("div",vt,[yt,e("div",xt,[e("img",{src:s.value,alt:"Membrete actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:Q},null,40,wt),e("div",_t,[e("button",{onClick:V,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[S(c(tt),{class:"h-4 w-4 mr-2"}),R(" Descargar ")]),e("button",{onClick:F,disabled:p.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[S(c(Ke),{class:"h-4 w-4 mr-2"}),R(" "+D(p.value?"Eliminando...":"Eliminar"),1)],8,kt)])])])):(o(),m("div",$t,[S(c(le),{class:"mx-auto h-12 w-12 text-gray-400"}),Dt,Ct])),e("div",Et,[e("h3",Mt,D(s.value?"Reemplazar Membrete":"Subir Membrete"),1),e("div",St,[e("input",{ref_key:"fileInput",ref:U,type:"file",accept:".png",onChange:B,class:"hidden"},null,544),b.value?(o(),m("div",jt,[e("div",zt,[S(c(Ae),{class:"h-5 w-5 text-green-500"}),e("span",null,D(b.value.name),1),e("span",Bt,"("+D(me(b.value.size))+")",1)]),g.value?(o(),m("div",Rt,[e("img",{src:g.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,Ut)])):I("",!0),e("div",Tt,[e("button",{onClick:E,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:_,disabled:f.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[f.value?(o(),m("div",Lt)):(o(),z(c(Te),{key:0,class:"h-4 w-4 mr-2"})),R(" "+D(f.value?"Subiendo...":"Subir Imagen"),1)],8,At)])])):(o(),m("div",Pt,[S(c(Ue),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Ft,[e("button",{onClick:$[0]||($[0]=G=>k.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG "),e("button",{onClick:$[1]||($[1]=G=>A.value=!A.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[S(c(Ee),{class:"h-4 w-4 mr-2"}),R(" "+D(A.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),Ot,It]))])]),A.value?(o(),m("div",Nt,[e("div",qt,[S(c(Ee),{class:"h-6 w-6 text-blue-600"}),Vt]),Gt,Wt,Ht,Zt])):I("",!0),C.value.length>0?(o(),m("div",Qt,[(o(!0),m(Z,null,X(C.value,(G,Y)=>(o(),m("div",{key:Y,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",Yt,[S(c(at),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",Xt,D(G),1)])]))),128))])):I("",!0)]))])])]}),_:1},512)),[[ye,t.isVisible]])}},Kt=ue(Jt,[["__scopeId","data-v-61bc1edc"]]),es={class:"py-1"},ts=["disabled","onClick"],ss={key:1,class:"submenu-container relative"},as=["onMouseenter","onMouseleave"],os={class:"flex items-center"},rs=["onMouseenter","onMouseleave"],ns={class:"py-1"},is=["disabled","onClick"],ls={key:2,class:"border-t border-gray-100"},cs={__name:"HierarchicalMenu",props:{menuItems:{type:Array,required:!0,default:()=>[]},menuPosition:{type:String,default:"right-0 left-auto sm:left-0 sm:right-auto"}},emits:["menu-action"],setup(t,{emit:h}){const r=h,n=j(null);let v=null;const i=p=>{v&&(clearTimeout(v),v=null),n.value=p},d=p=>{v=setTimeout(()=>{n.value===p&&(n.value=null)},150)},f=p=>{n.value=null,r("menu-action",p)};return(p,b)=>(o(),z(c(Ie),{as:"div",class:"relative inline-block text-left menu-container"},{default:N(()=>[S(c(Fe),{class:"flex items-center justify-center w-8 h-8 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors focus:outline-none focus:ring-0"},{default:N(()=>[S(c(Le),{class:"w-5 h-5","aria-hidden":"true"})]),_:1}),S(pe,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:N(()=>[S(c(Oe),{class:T(["absolute z-50 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",t.menuPosition])},{default:N(()=>[e("div",es,[(o(!0),m(Z,null,X(t.menuItems,g=>(o(),m(Z,{key:g.id||g.label},[g.children?(o(),m("div",ss,[S(c(he),null,{default:N(()=>[e("div",{class:"block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition cursor-pointer flex items-center justify-between",onMouseenter:s=>i(g.id),onMouseleave:s=>d(g.id)},[e("div",os,D(g.label),1),S(c(st),{class:"w-4 h-4 text-gray-400"})],40,as)]),_:2},1024),S(pe,{"enter-active-class":"transition ease-out duration-150","enter-from-class":"transform opacity-0 translate-x-2 scale-95","enter-to-class":"transform opacity-100 translate-x-0 scale-100","leave-active-class":"transition ease-in duration-100","leave-from-class":"transform opacity-100 translate-x-0 scale-100","leave-to-class":"transform opacity-0 translate-x-2 scale-95"},{default:N(()=>[n.value===g.id?(o(),m("div",{key:0,class:"absolute left-full top-0 mt-0 w-52 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none z-60",onMouseenter:s=>i(g.id),onMouseleave:s=>d(g.id)},[e("div",ns,[(o(!0),m(Z,null,X(g.children,s=>(o(),m("button",{key:s.label,class:T(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":s.disabled,"cursor-pointer":!s.disabled}]),disabled:s.disabled,onClick:C=>f(s.action)},[s.disabled?(o(),z(c(ve),{key:0,class:"size-4 text-gray-400 inline mr-2","aria-hidden":"true"})):I("",!0),R(" "+D(s.label),1)],10,is))),128))])],40,rs)):I("",!0)]),_:2},1024)])):(o(),z(c(he),{key:0},{default:N(()=>[e("button",{class:T(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":g.disabled,"cursor-pointer":!g.disabled}]),disabled:g.disabled,onClick:s=>f(g.action)},[g.disabled?(o(),z(c(ve),{key:0,class:"size-5 text-gray-400 inline mr-2","aria-hidden":"true"})):I("",!0),R(" "+D(g.label),1)],10,ts)]),_:2},1024)),g.divider?(o(),m("div",ls)):I("",!0)],64))),128))])]),_:1},8,["class"])]),_:1})]),_:1}))}},ds=ue(cs,[["__scopeId","data-v-cc7ca81e"]]);function us(t,h){if(!t||t.length===0)return[];const r={editing:{id:"editing",label:"Edición y gestión",children:[],priority:1},downloads:{id:"downloads",label:"Descargas",children:[],priority:2},communication:{id:"communication",label:"Comunicación",children:[],priority:3},states:{id:"states",label:"Estados del documento",children:[],priority:4},signatures:{id:"signatures",label:"Firmas",children:[],priority:5},actions:{id:"actions",label:"Acciones",children:[],priority:6}};t.forEach(i=>{const d={...i};switch(i.action){case"edit":r.editing.children.push(d);break;case"permissions":r.editing.children.push(d);break;case"copy":r.editing.children.push(d);break;case"downloadPDF":case"downloadWord":case"downloadSignedDocument":r.downloads.children.push(d);break;case"email":r.communication.children.push(d);break;case"publish":case"draft":case"formalize":r.states.children.push(d);break;case"viewSignatures":case"sign":r.signatures.children.push(d);break;case"preview":case"delete":case"removeFromFolder":case"useDocument":r.actions.children.push(d);break;default:r.actions.children.push(d)}});const n=Object.values(r).filter(i=>i.children.length>0).sort((i,d)=>i.priority-d.priority),v=[];return n.forEach((i,d)=>{i.children.length===1?v.push(i.children[0]):v.push(i),d<n.length-1&&v.push({divider:!0})}),v}function ms(t){return t&&t.length>6}const Ne=t=>(we("data-v-70b616b8"),t=t(),_e(),t),gs=["data-document-id"],fs={class:"flex justify-between items-start mb-3"},ps={class:"flex items-center gap-2"},hs={class:"py-1"},bs=["disabled","onClick"],vs={class:"space-y-2"},ys={class:"text-lg font-semibold text-gray-900 leading-tight"},xs={key:0,class:"text-sm text-gray-600 leading-relaxed"},ws={key:1,class:"pt-2"},_s={class:"flex items-center gap-2 flex-wrap"},ks=Ne(()=>e("span",{class:"text-xs font-medium text-gray-500"},"Etiquetas:",-1)),$s={class:"flex items-center gap-1.5"},Ds=["title"],Cs={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-50"},Es={class:"bg-gray-900 text-white text-xs rounded-lg py-1.5 px-2.5 whitespace-nowrap shadow-lg"},Ms=Ne(()=>e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-[4px] border-r-[4px] border-t-[4px] border-transparent border-t-gray-900"},null,-1)),Ss={__name:"BaseDocumentCard",props:{document:{type:Object,required:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},highlightedDocId:{type:[String,Number],default:null},showTags:{type:Boolean,default:!0},additionalClasses:{type:[String,Array,Object],default:""},statusIcon:{type:[String,Object,Function],default:null},statusText:{type:String,default:null},statusBadgeClasses:{type:[String,Object,Array],default:null},menuOptions:{type:Array,default:null},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},promptDocuments:{type:Boolean,default:!1},enableModals:{type:Boolean,default:!0},editModalComponent:{type:String,default:"UseDocumentByClient"},editRoute:{type:String,default:null},enableSignatures:{type:Boolean,default:!0},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null}},emits:["click","refresh","remove-from-folder"],setup(t,{emit:h}){const r=ke(),n=t,v=h,{activeModals:i,openModal:d,closeModal:f,getUserRole:p}=fo(n.documentStore,n.userStore),{handlePreviewDocument:b,deleteDocument:g,downloadPDFDocument:s,downloadWordDocument:C,copyDocument:U,publishDocument:A,moveToDraft:a,formalizeDocument:x,signDocument:B,downloadSignedDocument:q}=po(n.documentStore,n.userStore,v),E=l=>{l.target.closest(".menu-container")||v("click",n.document,l)},_=()=>{v("refresh")},M={default:{getMenuOptions:(l,u)=>{const w=[];return w.push({label:"Usar Formato",action:"useDocument"}),w.push({label:"Gestionar Membrete",action:"letterhead"}),u==="folder"&&w.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),w}},client:{getMenuOptions:(l,u)=>{const w=[];return l.state==="Completed"?w.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Editar Formulario",action:"editForm"},{label:"Editar Documento",action:"editDocument"}]}):w.push({label:"Completar",action:"editForm"}),l.state==="Completed"&&w.push({label:"Previsualizar",action:"preview"}),w.push({label:"Eliminar",action:"delete"}),w.push({label:"Gestionar Membrete",action:"letterhead"}),l.state==="Completed"&&w.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar",action:"email"}),u==="folder"&&w.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),w}},lawyer:{getMenuOptions:(l,u)=>{const w=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualización",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}];return l.state==="Draft"?w.push({label:"Publicar",action:"publish",disabled:!fe(l)}):l.state==="Published"&&(w.push({label:"Mover a Borrador",action:"draft"}),w.push({label:"Formalizar y Agregar Firmas",action:"formalize"})),(l.state==="Completed"||l.state==="Published")&&w.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),l.requires_signature&&(w.push({label:"Ver Firmas",action:"viewSignatures"}),$e(l)&&w.push({label:"Firmar documento",action:"sign"})),w}},signatures:{getMenuOptions:(l,u)=>{const w=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}];return l.requires_signature&&(l.state==="PendingSignatures"||l.state==="FullySigned")&&w.push({label:"Estado de las firmas",action:"viewSignatures"}),$e(l)&&w.push({label:"Firmar documento",action:"sign"}),l.state==="FullySigned"&&w.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),l.state==="PendingSignatures"&&w.push({label:"Descargar PDF",action:"downloadPDF"}),u==="folder"&&w.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),w}}},F=L(()=>{if(n.menuOptions!==null)return n.menuOptions;if(n.showMenuOptions===!1)return[];if(n.showMenuOptions===!0){const u=M[n.cardType];return u?u.getMenuOptions(n.document,n.cardContext):[]}const l=M[n.cardType];return l?l.getMenuOptions(n.document,n.cardContext):[]}),P=L(()=>n.promptDocuments?"right-0 left-auto sm:right-auto sm:left-0 sm:-translate-x-[calc(100%-24px)]":"right-0 left-auto sm:left-0 sm:right-auto"),V=L(()=>!F.value||F.value.length===0?[]:K(F.value)?F.value:us(F.value,n.document)),Q=L(()=>{switch(n.document.state){case"Completed":case"Published":case"FullySigned":return"border-green-400 bg-green-50/50 shadow-green-100";case"Progress":case"Draft":return"border-blue-300 bg-blue-50/30 shadow-blue-100";case"PendingSignatures":return"border-yellow-400 bg-yellow-50/50 shadow-yellow-100";default:return"border-gray-200 bg-white"}}),me=L(()=>{if(!n.highlightedDocId||String(n.document.id)!==String(n.highlightedDocId))return"";const l=n.document.state;return l==="Published"||l==="FullySigned"||l==="Completed"?"shadow-lg animate-pulse-highlight-green":l==="PendingSignatures"?"shadow-lg animate-pulse-highlight-yellow":"shadow-lg animate-pulse-highlight-blue"}),ge=L(()=>{if(n.statusIcon)return n.statusIcon;switch(n.document.state){case"Published":case"FullySigned":case"Completed":return Ae;case"Draft":case"Progress":case"PendingSignatures":default:return Ze}}),k=L(()=>{if(n.statusText)return n.statusText;switch(n.document.state){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return"Desconocido"}}),$=L(()=>{if(n.statusBadgeClasses)return n.statusBadgeClasses;switch(n.document.state){case"Published":case"FullySigned":case"Completed":return"bg-green-100 text-green-700 border border-green-200";case"Draft":case"Progress":return"bg-blue-100 text-blue-700 border border-blue-200";case"PendingSignatures":return"bg-yellow-100 text-yellow-700 border border-yellow-200";default:return"bg-gray-100 text-gray-700 border border-gray-200"}}),H=async(l,u)=>{try{switch(l){case"edit":await G(u);break;case"editForm":await Y(u);break;case"editDocument":await se(u);break;case"permissions":d("permissions",u);break;case"preview":await b(u);break;case"delete":await g(u);break;case"downloadPDF":await s(u);break;case"downloadWord":await C(u);break;case"email":d("email",u);break;case"copy":await U(u);break;case"publish":await A(u);break;case"draft":await a(u);break;case"formalize":await x(u);break;case"viewSignatures":d("signatures",u);break;case"sign":await B(u,d);break;case"downloadSignedDocument":await q(u);break;case"removeFromFolder":v("remove-from-folder",u);break;case"useDocument":v("click",u);break;case"letterhead":d("letterhead",u);break;default:console.warn("Unknown action:",l)}}catch(w){console.error(`Error executing action ${l}:`,w)}},G=async l=>{if(n.editRoute){const u=encodeURIComponent(l.title.trim()),w=n.editRoute.replace(":id",l.id).replace(":title",u);r.push(w)}else d("edit",l,{userRole:p()})},Y=async l=>{d("edit",l,{userRole:p()})},se=async l=>{r.push(`/dynamic_document_dashboard/client/editor/edit/${l.id}`)},K=l=>l&&l.some(u=>u.children&&u.children.length>0),fe=l=>!l.variables||l.variables.length===0?!0:l.variables.every(u=>u.name_es&&u.name_es.trim().length>0),$e=l=>{var O,ee;if(!l.requires_signature||l.state!=="PendingSignatures"||!l.signatures||l.signatures.length===0)return!1;const u=(ee=(O=n.userStore)==null?void 0:O.currentUser)==null?void 0:ee.email,w=l.signatures.find(re=>re.signer_email===u);return!(!w||w.signed)};return(l,u)=>{var w;return o(),m(Z,null,[e("div",{"data-document-id":t.document.id,class:T(["relative bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 p-4 cursor-pointer focus:outline-none focus:ring-0",[Q.value,me.value,t.additionalClasses]]),onClick:E},[e("div",fs,[e("div",ps,[te(l.$slots,"status-badge",{},()=>[e("div",{class:T(["inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium",$.value])},[(o(),z(je(ge.value),{class:"w-3.5 h-3.5"})),e("span",null,D(k.value),1)],2)],!0),te(l.$slots,"additional-badges",{},void 0,!0)]),te(l.$slots,"right-action",{},()=>[c(ms)(F.value)||K(F.value)?(o(),z(ds,{key:0,"menu-items":V.value,"menu-position":P.value,onMenuAction:u[0]||(u[0]=O=>H(O,t.document))},null,8,["menu-items","menu-position"])):F.value&&F.value.length>0?(o(),z(c(Ie),{key:1,as:"div",class:"relative inline-block text-left menu-container"},{default:N(()=>[S(c(Fe),{class:"flex items-center justify-center w-8 h-8 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors focus:outline-none focus:ring-0"},{default:N(()=>[S(c(Le),{class:"w-5 h-5","aria-hidden":"true"})]),_:1}),S(pe,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:N(()=>[S(c(Oe),{class:T(["absolute z-50 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",P.value])},{default:N(()=>[e("div",hs,[(o(!0),m(Z,null,X(F.value,O=>(o(),z(c(he),{key:O.label},{default:N(()=>[e("button",{class:T(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":O.disabled,"cursor-pointer":!O.disabled}]),disabled:O.disabled,onClick:ee=>H(O.action,t.document)},[O.disabled?(o(),z(c(ve),{key:0,class:"size-5 text-gray-400 inline mr-2","aria-hidden":"true"})):I("",!0),R(" "+D(O.label),1)],10,bs)]),_:2},1024))),128))])]),_:1},8,["class"])]),_:1})]),_:1})):I("",!0)],!0)]),e("div",vs,[e("h3",ys,D(t.document.title),1),t.document.description?(o(),m("p",xs,D(t.document.description),1)):I("",!0),te(l.$slots,"additional-content",{},void 0,!0),t.showTags&&t.document.tags&&t.document.tags.length>0?(o(),m("div",ws,[e("div",_s,[ks,e("div",$s,[(o(!0),m(Z,null,X(t.document.tags,O=>{var ee,re;return o(),m("div",{key:O.id,class:"group relative"},[e("div",{class:"w-5 h-5 rounded-full cursor-pointer transition-all duration-200 hover:scale-110 hover:ring-2 hover:ring-offset-1 shadow-sm",style:qe({backgroundColor:((ee=c(De)(O.color_id))==null?void 0:ee.hex)||"#9CA3AF",boxShadow:`0 0 0 1px ${((re=c(De)(O.color_id))==null?void 0:re.dark)||"#6B7280"}40`}),title:O.name},null,12,Ds),e("div",Cs,[e("div",Es,[R(D(O.name)+" ",1),Ms])])])}),128))])])])):I("",!0)]),te(l.$slots,"footer",{},void 0,!0),te(l.$slots,"additional-actions",{},void 0,!0)],10,gs),c(i).edit.isOpen?(o(),z(c(As),{key:0,document:c(i).edit.document,"user-role":c(p)(),onClose:u[1]||(u[1]=O=>c(f)("edit"))},null,8,["document","user-role"])):I("",!0),c(i).email.isOpen?(o(),z(c(ca),{key:1,document:c(i).email.document,onClose:u[2]||(u[2]=O=>c(f)("email"))},null,8,["document"])):I("",!0),c(i).signatures.isOpen?(o(),z(c(Ga),{key:2,"document-id":(w=c(i).signatures.document)==null?void 0:w.id,onClose:u[3]||(u[3]=O=>c(f)("signatures")),onRefresh:_},null,8,["document-id"])):I("",!0),c(i).electronicSignature.isOpen?(o(),z(c(Ya),{key:3,onClose:u[4]||(u[4]=O=>c(f)("electronicSignature"))})):I("",!0),c(i).permissions.isOpen?(o(),z(c(go),{key:4,"is-open":c(i).permissions.isOpen,document:c(i).permissions.document,onClose:u[5]||(u[5]=O=>c(f)("permissions")),onSaved:_},null,8,["is-open","document"])):I("",!0),c(i).letterhead.isOpen?(o(),z(Kt,{key:5,"is-visible":c(i).letterhead.isOpen,document:c(i).letterhead.document,onClose:u[6]||(u[6]=O=>c(f)("letterhead")),onUploaded:_,onDeleted:_},null,8,["is-visible","document"])):I("",!0)],64)}}},Co=ue(Ss,[["__scopeId","data-v-70b616b8"]]),Ps={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Fs={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Os={class:"flex justify-end"},Is=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[R(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),js={class:"mt-2"},zs={class:"flex gap-2 mt-2.5"},Bs=["disabled"],Rs=e("span",null,"Actualizar nombre",-1),Us=[Rs],Ts=["disabled"],As={__name:"EditDocumentModal",props:{document:{type:Object,required:!0},userRole:{type:String,default:"client"}},emits:["close"],setup(t,{emit:h}){const r=t,n=ke(),v=de(),i=h,d=j(""),f=j(""),p=()=>{i("close")};Ve(()=>{var a,x;r.document?(d.value=((a=r.document)==null?void 0:a.title)||"",f.value=((x=r.document)==null?void 0:x.title)||""):(d.value="",f.value="")});const b=a=>{a.key==="Escape"&&p()};Se(()=>{document.addEventListener("keydown",b)}),Pe(()=>{document.removeEventListener("keydown",b)});const g=L(()=>d.value.trim().length>0),s=L(()=>{var a;return!!((a=r.document)!=null&&a.id)}),C=L(()=>s.value&&d.value.trim()!==f.value.trim()&&d.value.trim().length>0);async function U(){if(s.value&&C.value)try{const a={title:d.value.trim()};await v.updateDocument(r.document.id,a),f.value=d.value.trim(),y("Nombre del documento actualizado exitosamente.","success"),p()}catch(a){console.error("Error updating document name:",a),y("Error al actualizar el nombre del documento.","error")}}function A(){var x;const a=encodeURIComponent(d.value.trim());(x=r.document)!=null&&x.id&&!s.value?r.userRole==="lawyer"?n.push(`/dynamic_document_dashboard/lawyer/editor/create/${a}`):n.push(`/dynamic_document_dashboard/document/use/creator/${r.document.id}/${a}`):s.value?r.userRole==="lawyer"?n.push(`/dynamic_document_dashboard/lawyer/editor/edit/${r.document.id}`):n.push(`/dynamic_document_dashboard/document/use/editor/${r.document.id}/${a}`):y("Error: No se pudo continuar. Documento no seleccionado.","error")}return(a,x)=>(o(),m("div",Ps,[e("div",Fs,[e("div",Os,[e("button",{onClick:p},[S(c(J),{class:"size-6"})])]),e("form",{onSubmit:ie(A,["prevent"])},[e("div",null,[Is,e("div",js,[ae(e("input",{"onUpdate:modelValue":x[0]||(x[0]=B=>d.value=B),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[ze,d.value]])])]),e("div",zs,[s.value?(o(),m("button",{key:0,type:"button",onClick:U,disabled:!C.value,class:T(["p-2.5 text-sm font-medium rounded-md flex gap-2",C.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Us,10,Bs)):I("",!0),e("button",{type:"submit",class:T(["p-2.5 text-sm font-medium rounded-md flex gap-2",g.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!g.value},[e("span",null,D(s.value?"Editar Documento":"Continuar"),1)],10,Ts)])],32)])]))}},Ls={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Ns={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},qs={class:"flex justify-end"},Vs=e("label",{for:"email",class:"block text-base font-medium leading-6 text-primary"},[R(" Correo electrónico "),e("span",{class:"text-red-500"},"*")],-1),Gs={class:"mt-2"},Ws={class:"mt-4"},Hs=e("label",{for:"files",class:"block text-base font-medium leading-6 text-primary"}," Anexos ",-1),Zs={key:0,class:"text-center"},Qs={class:"mt-4 flex text-sm/6 text-gray-600"},Ys={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"},Xs=e("span",null,"Sube un archivo",-1),Js=e("p",{class:"pl-1"},"o arrastra y suelta",-1),Ks=e("p",{class:"text-xs/5 text-gray-600"}," PNG, JPG, PDF, DOCX de hasta 20MB ",-1),ea={key:1,class:"w-full flex flex-wrap gap-3"},ta=["onMouseenter","onMouseleave"],sa=["onClick"],aa={class:"text-center text-xs truncate w-20"},oa=["disabled"],ra=e("span",null,"Enviar",-1),na=[ra],ia="dynamic-documents/send_email_with_attachments/",la=20*1024*1024,ca={__name:"SendDocumentModal",props:{document:{type:Object,required:!0}},emits:["close"],setup(t,{emit:h}){const r=h,{sendEmail:n}=ot(),v=j(null),i=t,d=()=>{f.email="",p.value=[],v.value=null},f=Ge({email:""}),p=j([]),b=E=>{const _=Array.from(E.target.files);s(_),E.target.value=null},g=E=>{const _=Array.from(E.dataTransfer.files);s(_)},s=E=>{let _=p.value.reduce((M,F)=>M+F.file.size,0);E.forEach(M=>{if(M.size>la){y(`The file "${M.name}" exceeds the 20 MB limit.`,"warning");return}const F=M.name.split(".").pop().toLowerCase();let P="",V={general:"",xMark:""};switch(F){case"png":case"jpg":case"jpeg":P=Ue,V.general="border-gray-200 text-gray-400",V.xMark="bg-gray-400";break;case"pdf":P=le,V.general="border-red-600/20 text-red-600/60",V.xMark="bg-red-600/60";break;case"docx":P=le,V.general="border-blue-600/20 text-blue-600/60",V.xMark="bg-blue-600/60";break;default:y("Unsupported file type. Only PDF, DOCX, JPG, and PNG are allowed.","warning");return}p.value.push({name:M.name,icon:P,style:V,hover:!1,file:M}),_+=M.size})},C=E=>{p.value.splice(E,1)},U=E=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(E),A=L(()=>U(f.email)),a=L(()=>A.value),x=async E=>{try{const _=await be(`dynamic-documents/${E}/download-pdf/`,"blob");if(!_||!_.data)throw new Error("Invalid response from server");return new File([_.data],`document_${E}.pdf`,{type:"application/pdf"})}catch(_){return console.error("Error downloading PDF:",_),y("No se pudo descargar el documento PDF.","error"),null}};ce(()=>i.document,E=>{E&&Object.keys(E).length>0&&E.id&&x(E.id)},{immediate:!0});const B=async()=>{try{if(i.document.id){const _=await x(i.document.id);_&&p.value.push({name:_.name,file:_,icon:le,style:{general:"border-blue-600/20 text-blue-600/60",xMark:"bg-blue-600/60"},hover:!1})}const E=p.value.map(_=>_.file);await n(ia,f.email,i.document.title,"Attached is the requested document along with additional attachments.",E,{documentId:i.document.id})}catch(E){console.error("Error sending the email:",E)}finally{q()}},q=()=>{d(),r("close")};return(E,_)=>(o(),m("div",Ls,[e("div",Ns,[e("div",qs,[e("button",{onClick:_[0]||(_[0]=M=>q())},[S(c(J),{class:"size-6"})])]),e("form",{onSubmit:ie(B,["prevent"])},[e("div",null,[Vs,e("div",Gs,[ae(e("input",{"onUpdate:modelValue":_[1]||(_[1]=M=>f.email=M),type:"text",name:"email",id:"email",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[ze,f.email]])])]),e("div",Ws,[Hs,e("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 bg-white px-6 py-10",onDragover:_[2]||(_[2]=ie(()=>{},["prevent"])),onDrop:ie(g,["prevent"])},[p.value.length<1?(o(),m("div",Zs,[S(c(Te),{class:"mx-auto size-12 text-gray-300","aria-hidden":"true"}),e("div",Qs,[e("label",Ys,[Xs,e("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",onChange:b},null,32)]),Js]),Ks])):(o(),m("div",ea,[(o(!0),m(Z,null,X(p.value,(M,F)=>(o(),m("div",{key:F,class:T(["relative p-4 grid rounded-md bg-white border-2",M.style.general]),onMouseenter:P=>M.hover=!0,onMouseleave:P=>M.hover=!1},[ae(e("div",{class:T(["absolute p-0.5 mt-2 ml-2 rounded-full",M.style.xMark]),onClick:P=>C(F)},[S(c(J),{class:"size-3 text-white"})],10,sa),[[ye,M.hover]]),(o(),z(je(M.icon),{class:"size-12 mx-auto"})),e("span",aa,D(M.name),1)],42,ta))),128))]))],32)]),e("button",{type:"submit",class:T(["mt-4 p-2.5 text-sm font-medium rounded-md flex gap-2",a.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!a.value},na,10,oa)],32)])]))}},oe=t=>(we("data-v-33bff9d6"),t=t(),_e(),t),da={class:"fixed inset-0 z-50 flex items-center justify-center"},ua={class:"relative bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col"},ma=oe(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Estado de firmas del documento",-1)),ga=oe(()=>e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),fa=[ga],pa={class:"p-6 overflow-y-auto flex-grow"},ha={key:0,class:"text-center py-10"},ba=oe(()=>e("div",{class:"spinner"},null,-1)),va=oe(()=>e("p",{class:"mt-4 text-gray-500"},"Cargando información de firmas...",-1)),ya=[ba,va],xa={key:1},wa={class:"mb-4"},_a={class:"text-lg font-medium text-gray-900"},ka={class:"text-sm text-gray-500"},$a={class:"inline-flex items-center"},Da={key:0,class:"text-sm text-gray-500 mt-1"},Ca={class:"text-sm text-gray-500 mt-1"},Ea={class:"mt-6"},Ma={class:"min-w-full divide-y divide-gray-200"},Sa=oe(()=>e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Usuario"),e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado"),e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Fecha de firma")])],-1)),Pa={class:"bg-white divide-y divide-gray-200"},Fa={class:"px-4 py-4 whitespace-nowrap"},Oa={class:"flex items-center"},Ia={class:"text-sm font-medium text-gray-900 flex items-center"},ja={key:0,class:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full"},za={class:"text-sm text-gray-500"},Ba={class:"px-4 py-4 whitespace-nowrap"},Ra={class:"px-4 py-4 whitespace-nowrap text-sm text-gray-500"},Ua={class:"px-4 py-4 whitespace-nowrap"},Ta={class:"flex items-center"},Aa={class:"text-sm font-medium text-gray-900"},La={class:"text-sm text-gray-500"},Na={class:"px-4 py-4 whitespace-nowrap"},qa={class:"px-4 py-4 whitespace-nowrap text-sm text-gray-500"},Va={__name:"DocumentSignaturesModal",props:{documentId:Number},emits:["close","refresh"],setup(t,{emit:h}){const r=t,n=h;de();const v=Be(),i=j(null),d=()=>{n("close")},f=b=>b?new Date(b).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—",p=async()=>{if(!r.documentId){console.error("No document ID provided");return}try{const b=v.currentUser.id,g=await be(`dynamic-documents/user/${b}/pending-documents-full/`);if(g.status!==200)throw new Error(`Error loading documents: ${g.status}`);const s=g.data.find(C=>C.id===r.documentId);if(s)i.value=s;else{const C=await be(`dynamic-documents/${r.documentId}/`);if(C.status!==200)throw new Error(`Error loading document: ${C.status}`);i.value=C.data}}catch(b){console.error("Error loading document data:",b),b.response&&console.error("Error response data:",b.response.data),i.value=null,await y("Error al cargar la información de firmas","error")}};return ce(()=>r.documentId,b=>{b&&p()},{immediate:!0}),(b,g)=>(o(),m("div",da,[e("div",{class:"absolute inset-0 bg-black opacity-50",onClick:d}),e("div",ua,[e("div",{class:"px-6 py-4 border-b border-gray-200"},[ma,e("button",{onClick:d,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},fa)]),e("div",pa,[i.value?(o(),m("div",xa,[e("div",wa,[e("h3",_a,D(i.value.title),1),e("p",ka,[e("span",$a,[e("span",{class:T(["inline-block w-3 h-3 rounded-full mr-2",i.value.fully_signed?"bg-green-500":"bg-yellow-500"])},null,2),R(" "+D(i.value.fully_signed?"Documento completamente firmado":"Pendiente de firmas"),1)])]),i.value.creator?(o(),m("p",Da," Creado por: "+D(i.value.creator.name)+" ("+D(i.value.creator.email)+") ",1)):I("",!0),e("p",Ca," Firmas: "+D(i.value.completed_signatures||0)+"/"+D(i.value.total_signatures||0),1)]),e("div",Ea,[e("table",Ma,[Sa,e("tbody",Pa,[(o(!0),m(Z,null,X(i.value.signers||[],s=>(o(),m("tr",{key:"sig_"+s.signature_id,class:T({"bg-blue-50":s.is_current_user})},[e("td",Fa,[e("div",Oa,[e("div",null,[e("div",Ia,[R(D(s.signer_name)+" ",1),s.is_current_user?(o(),m("span",ja,"Tú")):I("",!0)]),e("div",za,D(s.signer_email),1)])])]),e("td",Ba,[e("span",{class:T(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",s.signed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},D(s.signed?"Firmado":"Pendiente"),3)]),e("td",Ra,D(s.signed_at?f(s.signed_at):"—"),1)],2))),128)),!i.value.signers&&i.value.signatures?(o(!0),m(Z,{key:0},X(i.value.signatures,s=>(o(),m("tr",{key:"old_"+s.id},[e("td",Ua,[e("div",Ta,[e("div",null,[e("div",Aa,D(s.signer_name||s.signer_email),1),e("div",La,D(s.signer_email),1)])])]),e("td",Na,[e("span",{class:T(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",s.signed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},D(s.signed?"Firmado":"Pendiente"),3)]),e("td",qa,D(s.signed_at?f(s.signed_at):"—"),1)]))),128)):I("",!0)])])])])):(o(),m("div",ha,ya))]),e("div",{class:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end"},[e("button",{onClick:d,class:"px-4 py-2 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400"}," Cerrar ")])])]))}},Ga=ue(Va,[["__scopeId","data-v-33bff9d6"]]),Wa={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Ha={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-auto shadow-xl"},Za={class:"flex justify-between items-center mb-4"},Qa=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electrónica",-1),Ya={__name:"ElectronicSignatureModal",emits:["close"],setup(t,{emit:h}){const r=Be(),n=h,v=()=>{n("close")},i=async d=>{r.currentUser&&(r.currentUser.has_signature=!0),y("Firma electrónica guardada correctamente","success"),setTimeout(()=>{v()},500)};return(d,f)=>(o(),m("div",Wa,[e("div",Ha,[e("div",Za,[Qa,e("button",{onClick:v,class:"text-gray-400 hover:text-gray-500"},[S(c(J),{class:"h-6 w-6"})])]),S(We,{initialShowOptions:!0,"user-id":c(r).currentUser.id,onSignatureSaved:i,onCancel:v},null,8,["user-id"])])]))}},Xa={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Ja={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0"},Ka={class:"inline-block w-full max-w-4xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl"},eo={class:"flex items-center justify-between pb-4 mb-6 border-b border-gray-200"},to=e("h3",{class:"text-lg font-medium leading-6 text-gray-900"}," Gestión de Permisos ",-1),so={class:"mt-1 text-sm text-gray-500"},ao={key:0,class:"mb-6"},oo={key:1,class:"p-4 mb-6 bg-red-50 border border-red-200 rounded-lg"},ro=e("div",{class:"flex items-center"},[e("svg",{class:"w-5 h-5 text-red-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("p",{class:"text-red-700"},"No tienes permisos para gestionar los permisos de este documento.")],-1),no=[ro],io={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},lo=["disabled"],co={key:0,class:"flex items-center"},uo=e("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},null,-1),mo={key:1},go={__name:"DocumentPermissionsModal",props:{isOpen:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close","saved"],setup(t,{emit:h}){const r=t,n=h,v=de(),i=j(null),d=j(!1),{isLawyer:f}=Qe(),p=L(()=>{var s;return f.value&&((s=r.document)==null?void 0:s.id)}),b=()=>{d.value||n("close")},g=async()=>{var C,U,A;if(!p.value||d.value)return;const s=(C=i.value)==null?void 0:C.getPermissionsData();if(!s){await y("Error al obtener los permisos actuales","error");return}d.value=!0;try{const a=r.document.id;typeof s.is_public=="boolean"&&await v.toggleDocumentPublicAccess(a),s.is_public||(((U=s.visibility_user_ids)==null?void 0:U.length)>0&&await v.grantVisibilityPermissions(a,s.visibility_user_ids),((A=s.usability_user_ids)==null?void 0:A.length)>0&&await v.grantUsabilityPermissions(a,s.usability_user_ids)),await y("Permisos actualizados exitosamente","success"),n("saved",r.document),b()}catch(a){console.error("Error saving permissions:",a),await y("Error al guardar los permisos","error")}finally{d.value=!1}};return(s,C)=>(o(),z(xe,null,{default:N(()=>{var U;return[t.isOpen?(o(),m("div",Xa,[e("div",Ja,[e("div",{class:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:b}),e("div",Ka,[e("div",eo,[e("div",null,[to,e("p",so,D(((U=t.document)==null?void 0:U.title)||"Documento"),1)]),e("button",{onClick:b,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors"},[S(c(J),{class:"w-6 h-6"})])]),p.value?(o(),m("div",ao,[S(Ye,{ref_key:"permissionsManagerRef",ref:i,document:t.document},null,8,["document"])])):(o(),m("div",oo,no)),e("div",io,[e("button",{onClick:b,type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"},D(p.value?"Cancelar":"Cerrar"),1),p.value?(o(),m("button",{key:0,onClick:g,disabled:d.value,type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-secondary rounded-md hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[d.value?(o(),m("span",co,[uo,R(" Guardando... ")])):(o(),m("span",mo,"Guardar Permisos"))],8,lo)):I("",!0)])])])])):I("",!0)]}),_:1}))}};function ne(t){return He.fire({title:t,icon:"question",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",buttonsStyling:!1}).then(h=>h.isConfirmed)}function fo(t,h){const r=j({edit:{isOpen:!1,document:null},email:{isOpen:!1,document:null},preview:{isOpen:!1,document:null},signatures:{isOpen:!1,document:null},electronicSignature:{isOpen:!1,document:null},permissions:{isOpen:!1,document:null},letterhead:{isOpen:!1,document:null}}),n=(f,p,b={})=>{switch(i(),f){case"edit":r.value.edit={isOpen:!0,document:p,...b};break;case"email":r.value.email={isOpen:!0,document:p};break;case"preview":Re(p);break;case"signatures":r.value.signatures={isOpen:!0,document:p};break;case"electronic-signature":r.value.electronicSignature={isOpen:!0,document:p};break;case"permissions":r.value.permissions={isOpen:!0,document:p};break;case"letterhead":r.value.letterhead={isOpen:!0,document:p};break;default:console.warn(`Unknown modal type: ${f}`)}},v=f=>{r.value[f]&&(r.value[f]={isOpen:!1,document:null})},i=()=>{Object.keys(r.value).forEach(f=>{r.value[f]={isOpen:!1,document:null}})};return{activeModals:r,openModal:n,closeModal:v,closeAllModals:i,getUserRole:()=>{var f;return((f=h==null?void 0:h.currentUser)==null?void 0:f.role)||"client"}}}function po(t,h,r){const{registerView:n}=Xe(),v=ke();return{handlePreviewDocument:async a=>{await n("document",a.id),Re(a)},deleteDocument:async a=>{if(await ne(`¿Estás seguro de que deseas eliminar el documento "${a.title}"?`)&&t)try{await t.deleteDocument(a.id),await y("Documento eliminado exitosamente","success"),r("refresh")}catch(B){throw await y("Error al eliminar el documento","error"),B}},downloadPDFDocument:async a=>{if(t)try{await t.downloadPDF(a.id,a.title),await y("PDF descargado exitosamente","success")}catch(x){throw await y("Error al descargar el PDF","error"),x}},downloadWordDocument:async a=>{if(t)try{await t.downloadWord(a.id,a.title),await y("Documento Word descargado exitosamente","success")}catch(x){throw await y("Error al descargar el documento Word","error"),x}},copyDocument:async a=>{var x;if(!t){await y("Funcionalidad de duplicar no implementada aún","info");return}try{const B=new Date,q=String(B.getDate()).padStart(2,"0"),E=String(B.getMonth()+1).padStart(2,"0"),_=B.getFullYear(),M=`${q}${E}${_}`,F=`${a.title} ${M}`,P={title:F,content:a.content,state:"Draft",variables:((x=a.variables)==null?void 0:x.map(Q=>({name_en:Q.name_en,name_es:Q.name_es,tooltip:Q.tooltip,field_type:Q.field_type,select_options:Q.select_options,value:""})))||[],requires_signature:!1};if(!await ne(`¿Deseas crear una copia del documento '${a.title}'?`))return;await t.createDocument(P),await y(`Copia creada exitosamente: "${F}"`,"success"),r("refresh")}catch(B){console.error("Error creating document copy:",B),await y("Error al crear la copia del documento","error")}},publishDocument:async a=>{if(t)try{const x={...a,state:"Published"};await t.updateDocument(a.id,x),await y("Documento publicado exitosamente","success"),r("refresh")}catch(x){throw await y("Error al publicar el documento","error"),x}},moveToDraft:async a=>{if(t)try{const x={...a,state:"Draft"};await t.updateDocument(a.id,x),await y("Documento movido a borrador exitosamente","success"),r("refresh")}catch(x){throw await y("Error al mover el documento a borrador","error"),x}},formalizeDocument:async a=>{try{v.push(`/dynamic_document_dashboard/document/use/formalize/${a.id}/${a.title}`)}catch(x){console.error("Error al formalizar el documento:",x),await y("Error al formalizar el documento","error")}},signDocument:async(a,x)=>{var B;try{const q=h.currentUser.id,E=h.currentUser.email;if(!a.requires_signature){await y("Este documento no requiere firmas","error");return}const _=(B=a.signatures)==null?void 0:B.find(P=>P.signer_email===E);if(!_){await y("No estás autorizado para firmar este documento","error");return}if(_.signed){await y("Ya has firmado este documento","info");return}if(!h.currentUser.has_signature){await y("Para firmar documentos necesitas tener una firma registrada.","info"),await ne("¿Deseas crear una firma electrónica ahora?")?x("electronic-signature",a):await y("Necesitas una firma para poder firmar documentos.","warning");return}if(!await ne(`¿Estás seguro de que deseas firmar el documento "${a.title}"?`)){await y("Operación de firma cancelada","info");return}const F=`dynamic-documents/${a.id}/sign/${q}/`;try{await y("Procesando firma del documento...","info");const P=await Me(F,{});if(P.status===200||P.status===201)await y(`¡Documento "${a.title}" firmado correctamente!`,"success"),r("refresh");else throw new Error(`Unexpected server response: ${P.status} ${P.statusText}`)}catch(P){throw console.error("Error in HTTP request:",P),P}}catch(q){console.error("General error signing document:",q),await y(`Error al firmar el documento: ${q.message}`,"error")}},downloadSignedDocument:async a=>{try{if(a.state!=="FullySigned"){y("El documento debe estar completamente firmado para descargarlo","warning");return}if(!a.signatures||a.signatures.length===0){y("El documento no tiene firmas registradas","warning");return}const x=`dynamic-documents/${a.id}/generate-signatures-pdf/`;await Je(x,`firmas_${a.title}.pdf`)}catch(x){console.error("Error downloading signed document:",x),y("Error al descargar el documento firmado","error")}}}}export{Co as B,Do as _,at as a,Ae as b,Le as c,st as r,ot as u};
