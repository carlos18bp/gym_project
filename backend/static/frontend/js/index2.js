import{e as a,f as m,g as e,r as j,s as v,E as Me,w as ae,Q as ye,m as z,k as L,t as D,j as S,l as d,G as J,a1 as xe,c as A,T as de,o as Se,ap as Pe,p as R,i as I,F as Z,M as Y,N as we,O as _e,ad as Fe,ae as pe,af as Oe,n as U,ag as he,ac as Ie,u as $e,a8 as te,a4 as je,aV as qe,aH as Ge,h as ie,v as ze,b as Ve,D as be,P as Be,aZ as We,aj as He}from"./index.js";import{g as De,u as Ze,_ as Qe}from"./DocumentPermissionsManager.js";import{useRecentViews as Xe}from"./useRecentViews.js";import{u as ce,o as Re,d as Ye}from"./index3.js";import{_ as ue}from"./_plugin-vue_export-helper.js";import{r as Je}from"./ArrowDownTrayIcon.js";import{r as Ke}from"./TrashIcon.js";import{r as le}from"./DocumentIcon.js";import{a as Te,r as Ue}from"./PhotoIcon.js";import{r as Ce}from"./InformationCircleIcon.js";import{r as et}from"./ExclamationTriangleIcon.js";import{r as tt}from"./PencilIcon.js";import{s as st,h as Ee}from"./loading_message.js";function Ae(t,b){return a(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function at(t,b){return a(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})])}function Le(t,b){return a(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"})])}function ve(t,b){return a(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"})])}function ot(){const t=j(!1),b=j("");async function o(r,y,i="",c="",f=[],p={}){if(!y)throw b.value="Recipient email is required.",await v(b.value,"error"),new Error(b.value);const h=new FormData;h.append("to_email",y),h.append("subject",i),h.append("body",c),f.forEach((g,s)=>{h.append(`attachments[${s}]`,g)});for(const[g,s]of Object.entries(p))h.append(g,s);try{t.value=!0,b.value="",st("Sending email...","Please wait while we send the email.");const g=await Me(r,h);return Ee(),await v("Email sent successfully.","success"),g.data}catch(g){throw Ee(),console.error("Error sending email:",g.message),b.value="An error occurred while sending the email. Please try again.",await v(b.value,"error"),g}finally{t.value=!1}}return{sendEmail:o,isLoading:t,errorMessage:b}}const rt={class:"bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full overflow-auto max-h-[80vh]"},nt={class:"flex justify-between items-center mb-4"},it={class:"text-lg font-bold"},lt=["innerHTML"],So={__name:"DocumentPreviewModal",props:{isVisible:Boolean,documentData:{type:Object,default:()=>({title:"",content:""})}},emits:["close"],setup(t,{emit:b}){const o=b,r=()=>{o("close")};return(y,i)=>ae((a(),z(xe,null,{default:L(()=>[e("div",rt,[e("div",nt,[e("h2",it," Previsualizaci√≥n del Documento: "+D(t.documentData.title),1),e("button",{onClick:r},[S(d(J),{class:"size-6 text-gray-500 hover:text-gray-700"})])]),e("div",{class:"prose max-w-none",innerHTML:t.documentData.content},null,8,lt)])]),_:1},512)),[[ye,t.isVisible]])}},W=t=>(we("data-v-72e8b696"),t=t(),_e(),t),dt={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},ct={class:"px-6 py-4 border-b border-gray-200"},ut=W(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gesti√≥n de Membrete",-1)),mt={class:"text-sm text-gray-500 mt-1"},gt={class:"p-6 overflow-y-auto flex-grow"},ft={key:0,class:"text-center py-10"},pt=W(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),ht={class:"mt-4 text-gray-500"},bt={key:1,class:"space-y-6"},vt={key:0,class:"space-y-4"},yt=W(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete Actual",-1)),xt={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},wt=["src"],_t={class:"mt-4 flex justify-center space-x-3"},$t=["disabled"],kt={key:1,class:"text-center py-8"},Dt=W(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete",-1)),Ct=W(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," Este documento no tiene una imagen de membrete configurada. ",-1)),Et={class:"space-y-4"},Mt={class:"text-lg font-medium text-gray-900"},St={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},Pt={key:0},Ft={class:"mt-4"},Ot=W(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, m√°ximo 10MB ",-1)),It=W(()=>e("p",{class:"text-xs text-gray-400 mt-1"}," Dimensiones ideales: 612 √ó 612 p√≠xeles (8.5:11 Carta) ",-1)),jt={key:1,class:"space-y-4"},zt={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Bt={class:"text-gray-400"},Rt={key:0,class:"mt-4"},Tt=["src"],Ut={class:"flex justify-center space-x-3"},At=["disabled"],Lt={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Nt={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},qt={class:"flex items-center space-x-2"},Gt=W(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete",-1)),Vt=W(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"üìê Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"612 p√≠xeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"612 p√≠xeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporci√≥n:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"¬±10%")])])])],-1)),Wt=W(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"üé® Distribuci√≥n Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"‚ö†Ô∏è ZONA CR√çTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mant√©n semi-transparente. El texto del documento se superpone aqu√≠.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, tel√©fonos, emails, informaci√≥n de contacto.")])])])])])],-1)),Ht=W(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"üîß Consideraciones T√©cnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"‚Ä¢"),e("span",null,[e("strong",null,"Posicionamiento:"),R(" La imagen se centra autom√°ticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"‚Ä¢"),e("span",null,[e("strong",null,"Transparencia:"),R(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"‚Ä¢"),e("span",null,[e("strong",null,"M√°rgenes:"),R(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"‚Ä¢"),e("span",null,[e("strong",null,"Resoluci√≥n:"),R(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"‚ö†Ô∏è"),e("span",null,[e("strong",null,"Zona cr√≠tica:"),R(" Evita elementos gr√°ficos densos en el centro (300-400px de altura)")])])])])],-1)),Zt=W(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"üí° Tips de Dise√±o R√°pido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"‚Ä¢ Si solo tienes header, ub√≠calo en los primeros 120-150px"),e("div",null,"‚Ä¢ El resto de la imagen debe ser transparente o blanco"),e("div",null,"‚Ä¢ Para footer, usa los √∫ltimos 80-120px"),e("div",null,"‚Ä¢ El texto se superpone en toda la imagen, mant√©n el centro claro")])],-1)),Qt={key:3,class:"space-y-2"},Xt={class:"flex"},Yt={class:"text-sm text-yellow-700"},Jt={__name:"LetterheadModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close","uploaded","deleted"],setup(t,{emit:b}){const o=t,r=b,y=ce(),i=j(!1),c=j(""),f=j(!1),p=j(!1),h=j(null),g=j(null),s=j(null),C=j([]),T=j(null),q=j(!1),n=A(()=>{var $;return($=o.document)==null?void 0:$.id}),x=()=>{E(),r("close")},B=$=>{const k=$.target.files[0];if(!k)return;if(!k.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(k.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}h.value=k,C.value=[];const H=new FileReader;H.onload=V=>{g.value=V.target.result;const X=new Image;X.onload=()=>{N(X.width,X.height)},X.src=V.target.result},H.readAsDataURL(k)},N=($,k)=>{const se=$/k,K=612/612,fe=Math.abs(se-K)/K;if($===612&&k===612){C.value.push("‚úÖ Dimensiones perfectas: 612 √ó 612 p√≠xeles");return}fe<=.1?(C.value.push(`‚ÑπÔ∏è Buenas proporciones detectadas: ${$} √ó ${k} p√≠xeles (${se.toFixed(3)})`),($!==612||k!==612)&&C.value.push("üí° Para mejores resultados, usa exactamente 612 √ó 612 p√≠xeles")):(C.value.push(`‚ö†Ô∏è Proporciones no ideales: ${$} √ó ${k} p√≠xeles (${se.toFixed(3)})`),C.value.push(`üéØ Proporciones recomendadas: ${K.toFixed(3)} (8.5:11)`),C.value.push("üìê Considera redimensionar tu imagen a 612 √ó 612 p√≠xeles")),($<300||k<300)&&C.value.push("‚ö†Ô∏è Imagen muy peque√±a - puede verse pixelada en documentos"),($>1200||k>1600)&&C.value.push("‚ÑπÔ∏è Imagen muy grande - se redimensionar√° autom√°ticamente")},E=()=>{h.value=null,g.value=null,C.value=[],q.value=!1,T.value&&(T.value.value="")},_=async()=>{var $;if(!(!h.value||!n.value)){f.value=!0,C.value=[];try{const k=await y.uploadLetterheadImage(n.value,h.value);($=k.data)!=null&&$.warnings&&k.data.warnings.length>0&&(C.value=k.data.warnings),await M(),E(),r("uploaded",k.data)}catch(k){console.error("Error uploading letterhead:",k),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{f.value=!1}}},M=async()=>{if(n.value)try{const $=await y.getLetterheadImage(n.value);$.data&&(s.value=URL.createObjectURL($.data))}catch{s.value=null}},F=()=>{confirm("¬øEst√°s seguro de que deseas eliminar la imagen de membrete?")&&P()},P=async()=>{if(n.value){p.value=!0;try{await y.deleteLetterheadImage(n.value),s.value&&URL.revokeObjectURL(s.value),s.value=null,r("deleted")}catch($){console.error("Error deleting letterhead:",$),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{p.value=!1}}},G=()=>{var $;if(s.value){const k=document.createElement("a");k.href=s.value,k.download=`membrete-${(($=o.document)==null?void 0:$.title)||"documento"}.png`,document.body.appendChild(k),k.click(),document.body.removeChild(k)}},Q=()=>{s.value=null},me=$=>{if($===0)return"0 Bytes";const k=1024,H=["Bytes","KB","MB","GB"],V=Math.floor(Math.log($)/Math.log(k));return parseFloat(($/Math.pow(k,V)).toFixed(2))+" "+H[V]};de(()=>o.isVisible,$=>{$&&n.value&&M()}),de(()=>o.document,$=>{$&&o.isVisible&&M()});const ge=()=>{s.value&&URL.revokeObjectURL(s.value),g.value&&URL.revokeObjectURL(g.value)};return Se(()=>{o.isVisible&&n.value&&M()}),Pe(ge),($,k)=>ae((a(),z(xe,null,{default:L(()=>{var H;return[e("div",dt,[e("div",ct,[ut,e("p",mt," Documento: "+D(((H=t.document)==null?void 0:H.title)||"Cargando..."),1),e("button",{onClick:x,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[S(d(J),{class:"h-6 w-6"})])]),e("div",gt,[i.value?(a(),m("div",ft,[pt,e("p",ht,D(c.value),1)])):(a(),m("div",bt,[s.value?(a(),m("div",vt,[yt,e("div",xt,[e("img",{src:s.value,alt:"Membrete actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:Q},null,40,wt),e("div",_t,[e("button",{onClick:G,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[S(d(Je),{class:"h-4 w-4 mr-2"}),R(" Descargar ")]),e("button",{onClick:F,disabled:p.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[S(d(Ke),{class:"h-4 w-4 mr-2"}),R(" "+D(p.value?"Eliminando...":"Eliminar"),1)],8,$t)])])])):(a(),m("div",kt,[S(d(le),{class:"mx-auto h-12 w-12 text-gray-400"}),Dt,Ct])),e("div",Et,[e("h3",Mt,D(s.value?"Reemplazar Membrete":"Subir Membrete"),1),e("div",St,[e("input",{ref_key:"fileInput",ref:T,type:"file",accept:".png",onChange:B,class:"hidden"},null,544),h.value?(a(),m("div",jt,[e("div",zt,[S(d(Ae),{class:"h-5 w-5 text-green-500"}),e("span",null,D(h.value.name),1),e("span",Bt,"("+D(me(h.value.size))+")",1)]),g.value?(a(),m("div",Rt,[e("img",{src:g.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,Tt)])):I("",!0),e("div",Ut,[e("button",{onClick:E,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:_,disabled:f.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[f.value?(a(),m("div",Lt)):(a(),z(d(Ue),{key:0,class:"h-4 w-4 mr-2"})),R(" "+D(f.value?"Subiendo...":"Subir Imagen"),1)],8,At)])])):(a(),m("div",Pt,[S(d(Te),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Ft,[e("button",{onClick:k[0]||(k[0]=V=>$.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG "),e("button",{onClick:k[1]||(k[1]=V=>q.value=!q.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[S(d(Ce),{class:"h-4 w-4 mr-2"}),R(" "+D(q.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),Ot,It]))])]),q.value?(a(),m("div",Nt,[e("div",qt,[S(d(Ce),{class:"h-6 w-6 text-blue-600"}),Gt]),Vt,Wt,Ht,Zt])):I("",!0),C.value.length>0?(a(),m("div",Qt,[(a(!0),m(Z,null,Y(C.value,(V,X)=>(a(),m("div",{key:X,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",Xt,[S(d(et),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",Yt,D(V),1)])]))),128))])):I("",!0)]))])])]}),_:1},512)),[[ye,t.isVisible]])}},Kt=ue(Jt,[["__scopeId","data-v-72e8b696"]]),es={class:"py-1"},ts=["disabled","onClick"],ss={key:1,class:"submenu-container relative"},as=["onMouseenter","onMouseleave"],os={class:"flex items-center"},rs=["onMouseenter","onMouseleave"],ns={class:"py-1"},is=["disabled","onClick"],ls={key:2,class:"border-t border-gray-100"},ds={__name:"HierarchicalMenu",props:{menuItems:{type:Array,required:!0,default:()=>[]},menuPosition:{type:String,default:"right-0 left-auto sm:left-0 sm:right-auto"}},emits:["menu-action","modalOpen","navigation"],setup(t,{emit:b}){const o=b,r=j(null);let y=null;const i=p=>{y&&(clearTimeout(y),y=null),r.value=p},c=p=>{y=setTimeout(()=>{r.value===p&&(r.value=null)},150)},f=p=>{r.value=null,o("menu-action",p)};return(p,h)=>(a(),z(d(Ie),{as:"div",class:"relative inline-block text-left menu-container"},{default:L(()=>[S(d(Fe),{class:"flex items-center justify-center w-8 h-8 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors focus:outline-none focus:ring-0"},{default:L(()=>[S(d(Le),{class:"w-5 h-5","aria-hidden":"true"})]),_:1}),S(pe,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:L(()=>[S(d(Oe),{class:U(["absolute z-50 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",t.menuPosition])},{default:L(()=>[e("div",es,[(a(!0),m(Z,null,Y(t.menuItems,g=>(a(),m(Z,{key:g.id||g.label},[g.children?(a(),m("div",ss,[S(d(he),null,{default:L(()=>[e("div",{class:"w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition cursor-pointer flex items-center justify-between",onMouseenter:s=>i(g.id),onMouseleave:s=>c(g.id)},[e("div",os,D(g.label),1),S(d(at),{class:"w-4 h-4 text-gray-400"})],40,as)]),_:2},1024),S(pe,{"enter-active-class":"transition ease-out duration-150","enter-from-class":"transform opacity-0 translate-x-2 scale-95","enter-to-class":"transform opacity-100 translate-x-0 scale-100","leave-active-class":"transition ease-in duration-100","leave-from-class":"transform opacity-100 translate-x-0 scale-100","leave-to-class":"transform opacity-0 translate-x-2 scale-95"},{default:L(()=>[r.value===g.id?(a(),m("div",{key:0,class:"absolute left-full top-0 mt-0 w-52 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none z-60",onMouseenter:s=>i(g.id),onMouseleave:s=>c(g.id)},[e("div",ns,[(a(!0),m(Z,null,Y(g.children,s=>(a(),m("button",{key:s.label,class:U(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":s.disabled,"cursor-pointer":!s.disabled}]),disabled:s.disabled,onClick:C=>f(s.action)},[s.disabled?(a(),z(d(ve),{key:0,class:"size-4 text-gray-400 inline mr-2","aria-hidden":"true"})):I("",!0),R(" "+D(s.label),1)],10,is))),128))])],40,rs)):I("",!0)]),_:2},1024)])):(a(),z(d(he),{key:0},{default:L(()=>[e("button",{class:U(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":g.disabled,"cursor-pointer":!g.disabled}]),disabled:g.disabled,onClick:s=>f(g.action)},[g.disabled?(a(),z(d(ve),{key:0,class:"size-5 text-gray-400 inline mr-2","aria-hidden":"true"})):I("",!0),R(" "+D(g.label),1)],10,ts)]),_:2},1024)),g.divider?(a(),m("div",ls)):I("",!0)],64))),128))])]),_:1},8,["class"])]),_:1})]),_:1}))}},cs=ue(ds,[["__scopeId","data-v-60d5f9c4"]]);function us(t,b){if(!t||t.length===0)return[];const o={editing:{id:"editing",label:"Edici√≥n y gesti√≥n",children:[],priority:1},downloads:{id:"downloads",label:"Descargas",children:[],priority:2},communication:{id:"communication",label:"Comunicaci√≥n",children:[],priority:3},states:{id:"states",label:"Estados del documento",children:[],priority:4},signatures:{id:"signatures",label:"Firmas",children:[],priority:5},actions:{id:"actions",label:"Acciones",children:[],priority:6}};t.forEach(i=>{const c={...i};switch(i.action){case"edit":o.editing.children.push(c);break;case"permissions":o.editing.children.push(c);break;case"copy":o.editing.children.push(c);break;case"downloadPDF":case"downloadWord":case"downloadSignedDocument":o.downloads.children.push(c);break;case"email":o.communication.children.push(c);break;case"publish":case"draft":case"formalize":o.states.children.push(c);break;case"viewSignatures":case"sign":o.signatures.children.push(c);break;case"preview":case"delete":case"removeFromFolder":case"useDocument":o.actions.children.push(c);break;default:o.actions.children.push(c)}});const r=Object.values(o).filter(i=>i.children.length>0).sort((i,c)=>i.priority-c.priority),y=[];return r.forEach((i,c)=>{i.children.length===1?y.push(i.children[0]):y.push(i),c<r.length-1&&y.push({divider:!0})}),y}function ms(t){return t&&t.length>6}const Ne=t=>(we("data-v-4b4a2fc7"),t=t(),_e(),t),gs=["data-document-id"],fs={class:"flex justify-between items-start mb-3"},ps={class:"flex items-center gap-2"},hs={class:"py-1"},bs=["disabled","onClick"],vs={class:"space-y-2"},ys={class:"text-lg font-semibold text-gray-900 leading-tight"},xs={key:0,class:"text-sm text-gray-600 leading-relaxed"},ws={key:1,class:"pt-2"},_s={class:"flex items-center gap-2 flex-wrap"},$s=Ne(()=>e("span",{class:"text-xs font-medium text-gray-500"},"Etiquetas:",-1)),ks={class:"flex items-center gap-1.5"},Ds=["title"],Cs={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-50"},Es={class:"bg-gray-900 text-white text-xs rounded-lg py-1.5 px-2.5 whitespace-nowrap shadow-lg"},Ms=Ne(()=>e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-[4px] border-r-[4px] border-t-[4px] border-transparent border-t-gray-900"},null,-1)),Ss={__name:"BaseDocumentCard",props:{document:{type:Object,required:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},highlightedDocId:{type:[String,Number],default:null},showTags:{type:Boolean,default:!0},additionalClasses:{type:[String,Array,Object],default:""},statusIcon:{type:[String,Object,Function],default:null},statusText:{type:String,default:null},statusBadgeClasses:{type:[String,Object,Array],default:null},menuOptions:{type:Array,default:null},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},promptDocuments:{type:Boolean,default:!1},enableModals:{type:Boolean,default:!0},editModalComponent:{type:String,default:"UseDocumentByClient"},editRoute:{type:String,default:null},enableSignatures:{type:Boolean,default:!0},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null}},emits:["click","refresh","remove-from-folder","modal-open","navigation"],setup(t,{emit:b}){const o=$e(),r=t,y=b,{activeModals:i,openModal:c,closeModal:f,getUserRole:p}=fo(r.documentStore,r.userStore),{handlePreviewDocument:h,deleteDocument:g,downloadPDFDocument:s,downloadWordDocument:C,copyDocument:T,publishDocument:q,moveToDraft:n,formalizeDocument:x,signDocument:B,downloadSignedDocument:N}=po(r.documentStore,r.userStore,y),E=l=>{l.target.closest(".menu-container")||y("click",r.document,l)},_=()=>{y("refresh")},M={default:{getMenuOptions:(l,u)=>{const w=[];return w.push({label:"Usar Formato",action:"useDocument"}),w.push({label:"Gestionar Membrete",action:"letterhead"}),u==="folder"&&w.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),w}},client:{getMenuOptions:(l,u)=>{const w=[];return l.state==="Completed"?w.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Editar Formulario",action:"editForm"},{label:"Editar Documento",action:"editDocument"}]}):w.push({label:"Completar",action:"editForm"}),l.state==="Completed"&&w.push({label:"Previsualizar",action:"preview"}),w.push({label:"Eliminar",action:"delete"}),w.push({label:"Gestionar Membrete",action:"letterhead"}),l.state==="Completed"&&w.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar",action:"email"}),u==="folder"&&w.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),w}},lawyer:{getMenuOptions:(l,u)=>{const w=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualizaci√≥n",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}];return l.state==="Draft"?w.push({label:"Publicar",action:"publish",disabled:!fe(l)}):l.state==="Published"&&(w.push({label:"Mover a Borrador",action:"draft"}),w.push({label:"Formalizar y Agregar Firmas",action:"formalize"})),(l.state==="Completed"||l.state==="Published")&&w.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),l.requires_signature&&(w.push({label:"Ver Firmas",action:"viewSignatures"}),ke(l)&&w.push({label:"Firmar documento",action:"sign"})),w}},signatures:{getMenuOptions:(l,u)=>{const w=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}];return l.requires_signature&&(l.state==="PendingSignatures"||l.state==="FullySigned")&&w.push({label:"Estado de las firmas",action:"viewSignatures"}),ke(l)&&w.push({label:"Firmar documento",action:"sign"}),l.state==="FullySigned"&&w.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),l.state==="PendingSignatures"&&w.push({label:"Descargar PDF",action:"downloadPDF"}),u==="folder"&&w.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),w}}},F=A(()=>{if(r.menuOptions!==null)return r.menuOptions;if(r.showMenuOptions===!1)return[];if(r.showMenuOptions===!0){const u=M[r.cardType];return u?u.getMenuOptions(r.document,r.cardContext):[]}const l=M[r.cardType];return l?l.getMenuOptions(r.document,r.cardContext):[]}),P=A(()=>r.promptDocuments?"right-0 left-auto sm:right-auto sm:left-0 sm:-translate-x-[calc(100%-24px)]":"right-0 left-auto sm:left-0 sm:right-auto"),G=A(()=>!F.value||F.value.length===0?[]:K(F.value)?F.value:us(F.value,r.document)),Q=A(()=>{switch(r.document.state){case"Completed":case"Published":case"FullySigned":return"border-green-400 bg-green-50/50 shadow-green-100";case"Progress":case"Draft":return"border-blue-300 bg-blue-50/30 shadow-blue-100";case"PendingSignatures":return"border-yellow-400 bg-yellow-50/50 shadow-yellow-100";default:return"border-gray-200 bg-white"}}),me=A(()=>{if(!r.highlightedDocId||String(r.document.id)!==String(r.highlightedDocId))return"";const l=r.document.state;return l==="Published"||l==="FullySigned"||l==="Completed"?"shadow-lg animate-pulse-highlight-green":l==="PendingSignatures"?"shadow-lg animate-pulse-highlight-yellow":"shadow-lg animate-pulse-highlight-blue"}),ge=A(()=>{if(r.statusIcon)return r.statusIcon;switch(r.document.state){case"Published":case"FullySigned":case"Completed":return Ae;case"Draft":case"Progress":case"PendingSignatures":default:return tt}}),$=A(()=>{if(r.statusText)return r.statusText;switch(r.document.state){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return"Desconocido"}}),k=A(()=>{if(r.statusBadgeClasses)return r.statusBadgeClasses;switch(r.document.state){case"Published":case"FullySigned":case"Completed":return"bg-green-100 text-green-700 border border-green-200";case"Draft":case"Progress":return"bg-blue-100 text-blue-700 border border-blue-200";case"PendingSignatures":return"bg-yellow-100 text-yellow-700 border border-yellow-200";default:return"bg-gray-100 text-gray-700 border border-gray-200"}}),H=async(l,u)=>{try{switch(l){case"edit":await V(u);break;case"editForm":await X(u);break;case"editDocument":await se(u);break;case"permissions":c("permissions",u);break;case"preview":await h(u);break;case"delete":await g(u);break;case"downloadPDF":await s(u);break;case"downloadWord":await C(u);break;case"email":c("email",u);break;case"copy":await T(u);break;case"publish":await q(u);break;case"draft":await n(u);break;case"formalize":await x(u);break;case"viewSignatures":c("signatures",u);break;case"sign":await B(u,c);break;case"downloadSignedDocument":await N(u);break;case"removeFromFolder":y("remove-from-folder",u);break;case"useDocument":y("click",u);break;case"letterhead":c("letterhead",u);break;default:console.warn("Unknown action:",l)}}catch(w){console.error(`Error executing action ${l}:`,w)}},V=async l=>{if(r.editRoute){const u=encodeURIComponent(l.title.trim()),w=r.editRoute.replace(":id",l.id).replace(":title",u);o.push(w)}else c("edit",l,{userRole:p()})},X=async l=>{c("edit",l,{userRole:p()})},se=async l=>{o.push(`/dynamic_document_dashboard/client/editor/edit/${l.id}`)},K=l=>l&&l.some(u=>u.children&&u.children.length>0),fe=l=>!l.variables||l.variables.length===0?!0:l.variables.every(u=>u.name_es&&u.name_es.trim().length>0),ke=l=>{var O,ee;if(!l.requires_signature||l.state!=="PendingSignatures"||!l.signatures||l.signatures.length===0)return!1;const u=(ee=(O=r.userStore)==null?void 0:O.currentUser)==null?void 0:ee.email,w=l.signatures.find(re=>re.signer_email===u);return!(!w||w.signed)};return(l,u)=>{var w;return a(),m(Z,null,[e("div",{"data-document-id":t.document.id,class:U(["relative bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 p-4 cursor-pointer focus:outline-none focus:ring-0",[Q.value,me.value,t.additionalClasses]]),onClick:E},[e("div",fs,[e("div",ps,[te(l.$slots,"status-badge",{},()=>[e("div",{class:U(["inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium",k.value])},[(a(),z(je(ge.value),{class:"w-3.5 h-3.5"})),e("span",null,D($.value),1)],2)],!0),te(l.$slots,"additional-badges",{},void 0,!0)]),te(l.$slots,"right-action",{},()=>[d(ms)(F.value)||K(F.value)?(a(),z(cs,{key:0,"menu-items":G.value,"menu-position":P.value,onMenuAction:u[0]||(u[0]=O=>H(O,t.document))},null,8,["menu-items","menu-position"])):F.value&&F.value.length>0?(a(),z(d(Ie),{key:1,as:"div",class:"relative inline-block text-left menu-container"},{default:L(()=>[S(d(Fe),{class:"flex items-center justify-center w-8 h-8 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors focus:outline-none focus:ring-0"},{default:L(()=>[S(d(Le),{class:"w-5 h-5","aria-hidden":"true"})]),_:1}),S(pe,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:L(()=>[S(d(Oe),{class:U(["absolute z-50 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",P.value])},{default:L(()=>[e("div",hs,[(a(!0),m(Z,null,Y(F.value,O=>(a(),z(d(he),{key:O.label},{default:L(()=>[e("button",{class:U(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":O.disabled,"cursor-pointer":!O.disabled}]),disabled:O.disabled,onClick:ee=>H(O.action,t.document)},[O.disabled?(a(),z(d(ve),{key:0,class:"size-5 text-gray-400 inline mr-2","aria-hidden":"true"})):I("",!0),R(" "+D(O.label),1)],10,bs)]),_:2},1024))),128))])]),_:1},8,["class"])]),_:1})]),_:1})):I("",!0)],!0)]),e("div",vs,[e("h3",ys,D(t.document.title),1),t.document.description?(a(),m("p",xs,D(t.document.description),1)):I("",!0),te(l.$slots,"additional-content",{},void 0,!0),t.showTags&&t.document.tags&&t.document.tags.length>0?(a(),m("div",ws,[e("div",_s,[$s,e("div",ks,[(a(!0),m(Z,null,Y(t.document.tags,O=>{var ee,re;return a(),m("div",{key:O.id,class:"group relative"},[e("div",{class:"w-5 h-5 rounded-full cursor-pointer transition-all duration-200 hover:scale-110 hover:ring-2 hover:ring-offset-1 shadow-sm",style:qe({backgroundColor:((ee=d(De)(O.color_id))==null?void 0:ee.hex)||"#9CA3AF",boxShadow:`0 0 0 1px ${((re=d(De)(O.color_id))==null?void 0:re.dark)||"#6B7280"}40`}),title:O.name},null,12,Ds),e("div",Cs,[e("div",Es,[R(D(O.name)+" ",1),Ms])])])}),128))])])])):I("",!0)]),te(l.$slots,"footer",{},void 0,!0),te(l.$slots,"additional-actions",{},void 0,!0)],10,gs),d(i).edit.isOpen?(a(),z(d(As),{key:0,document:d(i).edit.document,"user-role":d(p)(),onClose:u[1]||(u[1]=O=>d(f)("edit"))},null,8,["document","user-role"])):I("",!0),d(i).email.isOpen?(a(),z(d(da),{key:1,document:d(i).email.document,onClose:u[2]||(u[2]=O=>d(f)("email"))},null,8,["document"])):I("",!0),d(i).signatures.isOpen?(a(),z(d(Va),{key:2,"document-id":(w=d(i).signatures.document)==null?void 0:w.id,onClose:u[3]||(u[3]=O=>d(f)("signatures")),onRefresh:_},null,8,["document-id"])):I("",!0),d(i).electronicSignature.isOpen?(a(),z(d(Xa),{key:3,onClose:u[4]||(u[4]=O=>d(f)("electronicSignature"))})):I("",!0),d(i).permissions.isOpen?(a(),z(d(go),{key:4,"is-open":d(i).permissions.isOpen,document:d(i).permissions.document,onClose:u[5]||(u[5]=O=>d(f)("permissions")),onSaved:_},null,8,["is-open","document"])):I("",!0),d(i).letterhead.isOpen?(a(),z(Kt,{key:5,"is-visible":d(i).letterhead.isOpen,document:d(i).letterhead.document,onClose:u[6]||(u[6]=O=>d(f)("letterhead")),onUploaded:_,onDeleted:_},null,8,["is-visible","document"])):I("",!0)],64)}}},Po=ue(Ss,[["__scopeId","data-v-4b4a2fc7"]]),Ps={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Fs={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},Os={class:"flex justify-end"},Is=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[R(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),js={class:"mt-2"},zs={class:"flex gap-2 mt-2.5"},Bs=["disabled"],Rs=e("span",null,"Actualizar nombre",-1),Ts=[Rs],Us=["disabled"],As={__name:"EditDocumentModal",props:{document:{type:Object,required:!0},userRole:{type:String,default:"client"}},emits:["close"],setup(t,{emit:b}){const o=t,r=$e(),y=ce(),i=b,c=j(""),f=j(""),p=()=>{i("close")};Ge(()=>{var n,x;o.document?(c.value=((n=o.document)==null?void 0:n.title)||"",f.value=((x=o.document)==null?void 0:x.title)||""):(c.value="",f.value="")});const h=n=>{n.key==="Escape"&&p()};Se(()=>{document.addEventListener("keydown",h)}),Pe(()=>{document.removeEventListener("keydown",h)});const g=A(()=>c.value.trim().length>0),s=A(()=>{var n;return!!((n=o.document)!=null&&n.id)}),C=A(()=>s.value&&c.value.trim()!==f.value.trim()&&c.value.trim().length>0);async function T(){if(s.value&&C.value)try{const n={title:c.value.trim()};await y.updateDocument(o.document.id,n),f.value=c.value.trim(),v("Nombre del documento actualizado exitosamente.","success"),p()}catch(n){console.error("Error updating document name:",n),v("Error al actualizar el nombre del documento.","error")}}function q(){var x;const n=encodeURIComponent(c.value.trim());(x=o.document)!=null&&x.id&&!s.value?o.userRole==="lawyer"?r.push(`/dynamic_document_dashboard/lawyer/editor/create/${n}`):r.push(`/dynamic_document_dashboard/document/use/creator/${o.document.id}/${n}`):s.value?o.userRole==="lawyer"?r.push(`/dynamic_document_dashboard/lawyer/editor/edit/${o.document.id}`):r.push(`/dynamic_document_dashboard/document/use/editor/${o.document.id}/${n}`):v("Error: No se pudo continuar. Documento no seleccionado.","error")}return(n,x)=>(a(),m("div",Ps,[e("div",Fs,[e("div",Os,[e("button",{onClick:p},[S(d(J),{class:"size-6"})])]),e("form",{onSubmit:ie(q,["prevent"])},[e("div",null,[Is,e("div",js,[ae(e("input",{"onUpdate:modelValue":x[0]||(x[0]=B=>c.value=B),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[ze,c.value]])])]),e("div",zs,[s.value?(a(),m("button",{key:0,type:"button",onClick:T,disabled:!C.value,class:U(["p-2.5 text-sm font-medium rounded-md flex gap-2",C.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},Ts,10,Bs)):I("",!0),e("button",{type:"submit",class:U(["p-2.5 text-sm font-medium rounded-md flex gap-2",g.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!g.value},[e("span",null,D(s.value?"Editar Documento":"Continuar"),1)],10,Us)])],32)])]))}},Ls={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Ns={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},qs={class:"flex justify-end"},Gs=e("label",{for:"email",class:"block text-base font-medium leading-6 text-primary"},[R(" Correo electr√≥nico "),e("span",{class:"text-red-500"},"*")],-1),Vs={class:"mt-2"},Ws={class:"mt-4"},Hs=e("label",{for:"files",class:"block text-base font-medium leading-6 text-primary"}," Anexos ",-1),Zs={key:0,class:"text-center"},Qs={class:"mt-4 flex text-sm/6 text-gray-600"},Xs={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"},Ys=e("span",null,"Sube un archivo",-1),Js=e("p",{class:"pl-1"},"o arrastra y suelta",-1),Ks=e("p",{class:"text-xs/5 text-gray-600"}," PNG, JPG, PDF, DOCX de hasta 20MB ",-1),ea={key:1,class:"w-full flex flex-wrap gap-3"},ta=["onMouseenter","onMouseleave"],sa=["onClick"],aa={class:"text-center text-xs truncate w-20"},oa=["disabled"],ra=e("span",null,"Enviar",-1),na=[ra],ia="dynamic-documents/send_email_with_attachments/",la=20*1024*1024,da={__name:"SendDocumentModal",props:{document:{type:Object,required:!0}},emits:["close"],setup(t,{emit:b}){const o=b,{sendEmail:r}=ot(),y=j(null),i=t,c=()=>{f.email="",p.value=[],y.value=null},f=Ve({email:""}),p=j([]),h=E=>{const _=Array.from(E.target.files);s(_),E.target.value=null},g=E=>{const _=Array.from(E.dataTransfer.files);s(_)},s=E=>{let _=p.value.reduce((M,F)=>M+F.file.size,0);E.forEach(M=>{if(M.size>la){v(`The file "${M.name}" exceeds the 20 MB limit.`,"warning");return}const F=M.name.split(".").pop().toLowerCase();let P="",G={general:"",xMark:""};switch(F){case"png":case"jpg":case"jpeg":P=Te,G.general="border-gray-200 text-gray-400",G.xMark="bg-gray-400";break;case"pdf":P=le,G.general="border-red-600/20 text-red-600/60",G.xMark="bg-red-600/60";break;case"docx":P=le,G.general="border-blue-600/20 text-blue-600/60",G.xMark="bg-blue-600/60";break;default:v("Unsupported file type. Only PDF, DOCX, JPG, and PNG are allowed.","warning");return}p.value.push({name:M.name,icon:P,style:G,hover:!1,file:M}),_+=M.size})},C=E=>{p.value.splice(E,1)},T=E=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(E),q=A(()=>T(f.email)),n=A(()=>q.value),x=async E=>{try{const _=await be(`dynamic-documents/${E}/download-pdf/`,"blob");if(!_||!_.data)throw new Error("Invalid response from server");return new File([_.data],`document_${E}.pdf`,{type:"application/pdf"})}catch(_){return console.error("Error downloading PDF:",_),v("No se pudo descargar el documento PDF.","error"),null}};de(()=>i.document,E=>{E&&Object.keys(E).length>0&&E.id&&x(E.id)},{immediate:!0});const B=async()=>{try{if(i.document.id){const _=await x(i.document.id);_&&p.value.push({name:_.name,file:_,icon:le,style:{general:"border-blue-600/20 text-blue-600/60",xMark:"bg-blue-600/60"},hover:!1})}const E=p.value.map(_=>_.file);await r(ia,f.email,i.document.title,"Attached is the requested document along with additional attachments.",E,{documentId:i.document.id})}catch(E){console.error("Error sending the email:",E)}finally{N()}},N=()=>{c(),o("close")};return(E,_)=>(a(),m("div",Ls,[e("div",Ns,[e("div",qs,[e("button",{onClick:_[0]||(_[0]=M=>N())},[S(d(J),{class:"size-6"})])]),e("form",{onSubmit:ie(B,["prevent"])},[e("div",null,[Gs,e("div",Vs,[ae(e("input",{"onUpdate:modelValue":_[1]||(_[1]=M=>f.email=M),type:"text",name:"email",id:"email",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[ze,f.email]])])]),e("div",Ws,[Hs,e("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 bg-white px-6 py-10",onDragover:_[2]||(_[2]=ie(()=>{},["prevent"])),onDrop:ie(g,["prevent"])},[p.value.length<1?(a(),m("div",Zs,[S(d(Ue),{class:"mx-auto size-12 text-gray-300","aria-hidden":"true"}),e("div",Qs,[e("label",Xs,[Ys,e("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",onChange:h},null,32)]),Js]),Ks])):(a(),m("div",ea,[(a(!0),m(Z,null,Y(p.value,(M,F)=>(a(),m("div",{key:F,class:U(["relative p-4 grid rounded-md bg-white border-2",M.style.general]),onMouseenter:P=>M.hover=!0,onMouseleave:P=>M.hover=!1},[ae(e("div",{class:U(["absolute p-0.5 mt-2 ml-2 rounded-full",M.style.xMark]),onClick:P=>C(F)},[S(d(J),{class:"size-3 text-white"})],10,sa),[[ye,M.hover]]),(a(),z(je(M.icon),{class:"size-12 mx-auto"})),e("span",aa,D(M.name),1)],42,ta))),128))]))],32)]),e("button",{type:"submit",class:U(["mt-4 p-2.5 text-sm font-medium rounded-md flex gap-2",n.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!n.value},na,10,oa)],32)])]))}},oe=t=>(we("data-v-33bff9d6"),t=t(),_e(),t),ca={class:"fixed inset-0 z-50 flex items-center justify-center"},ua={class:"relative bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col"},ma=oe(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Estado de firmas del documento",-1)),ga=oe(()=>e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),fa=[ga],pa={class:"p-6 overflow-y-auto flex-grow"},ha={key:0,class:"text-center py-10"},ba=oe(()=>e("div",{class:"spinner"},null,-1)),va=oe(()=>e("p",{class:"mt-4 text-gray-500"},"Cargando informaci√≥n de firmas...",-1)),ya=[ba,va],xa={key:1},wa={class:"mb-4"},_a={class:"text-lg font-medium text-gray-900"},$a={class:"text-sm text-gray-500"},ka={class:"inline-flex items-center"},Da={key:0,class:"text-sm text-gray-500 mt-1"},Ca={class:"text-sm text-gray-500 mt-1"},Ea={class:"mt-6"},Ma={class:"min-w-full divide-y divide-gray-200"},Sa=oe(()=>e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Usuario"),e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado"),e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Fecha de firma")])],-1)),Pa={class:"bg-white divide-y divide-gray-200"},Fa={class:"px-4 py-4 whitespace-nowrap"},Oa={class:"flex items-center"},Ia={class:"text-sm font-medium text-gray-900 flex items-center"},ja={key:0,class:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full"},za={class:"text-sm text-gray-500"},Ba={class:"px-4 py-4 whitespace-nowrap"},Ra={class:"px-4 py-4 whitespace-nowrap text-sm text-gray-500"},Ta={class:"px-4 py-4 whitespace-nowrap"},Ua={class:"flex items-center"},Aa={class:"text-sm font-medium text-gray-900"},La={class:"text-sm text-gray-500"},Na={class:"px-4 py-4 whitespace-nowrap"},qa={class:"px-4 py-4 whitespace-nowrap text-sm text-gray-500"},Ga={__name:"DocumentSignaturesModal",props:{documentId:Number},emits:["close","refresh"],setup(t,{emit:b}){const o=t,r=b;ce();const y=Be(),i=j(null),c=()=>{r("close")},f=h=>h?new Date(h).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"‚Äî",p=async()=>{if(!o.documentId){console.error("No document ID provided");return}try{const h=y.currentUser.id,g=await be(`dynamic-documents/user/${h}/pending-documents-full/`);if(g.status!==200)throw new Error(`Error loading documents: ${g.status}`);const s=g.data.find(C=>C.id===o.documentId);if(s)i.value=s;else{const C=await be(`dynamic-documents/${o.documentId}/`);if(C.status!==200)throw new Error(`Error loading document: ${C.status}`);i.value=C.data}}catch(h){console.error("Error loading document data:",h),h.response&&console.error("Error response data:",h.response.data),i.value=null,await v("Error al cargar la informaci√≥n de firmas","error")}};return de(()=>o.documentId,h=>{h&&p()},{immediate:!0}),(h,g)=>(a(),m("div",ca,[e("div",{class:"absolute inset-0 bg-black opacity-50",onClick:c}),e("div",ua,[e("div",{class:"px-6 py-4 border-b border-gray-200"},[ma,e("button",{onClick:c,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},fa)]),e("div",pa,[i.value?(a(),m("div",xa,[e("div",wa,[e("h3",_a,D(i.value.title),1),e("p",$a,[e("span",ka,[e("span",{class:U(["inline-block w-3 h-3 rounded-full mr-2",i.value.fully_signed?"bg-green-500":"bg-yellow-500"])},null,2),R(" "+D(i.value.fully_signed?"Documento completamente firmado":"Pendiente de firmas"),1)])]),i.value.creator?(a(),m("p",Da," Creado por: "+D(i.value.creator.name)+" ("+D(i.value.creator.email)+") ",1)):I("",!0),e("p",Ca," Firmas: "+D(i.value.completed_signatures||0)+"/"+D(i.value.total_signatures||0),1)]),e("div",Ea,[e("table",Ma,[Sa,e("tbody",Pa,[(a(!0),m(Z,null,Y(i.value.signers||[],s=>(a(),m("tr",{key:"sig_"+s.signature_id,class:U({"bg-blue-50":s.is_current_user})},[e("td",Fa,[e("div",Oa,[e("div",null,[e("div",Ia,[R(D(s.signer_name)+" ",1),s.is_current_user?(a(),m("span",ja,"T√∫")):I("",!0)]),e("div",za,D(s.signer_email),1)])])]),e("td",Ba,[e("span",{class:U(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",s.signed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},D(s.signed?"Firmado":"Pendiente"),3)]),e("td",Ra,D(s.signed_at?f(s.signed_at):"‚Äî"),1)],2))),128)),!i.value.signers&&i.value.signatures?(a(!0),m(Z,{key:0},Y(i.value.signatures,s=>(a(),m("tr",{key:"old_"+s.id},[e("td",Ta,[e("div",Ua,[e("div",null,[e("div",Aa,D(s.signer_name||s.signer_email),1),e("div",La,D(s.signer_email),1)])])]),e("td",Na,[e("span",{class:U(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",s.signed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},D(s.signed?"Firmado":"Pendiente"),3)]),e("td",qa,D(s.signed_at?f(s.signed_at):"‚Äî"),1)]))),128)):I("",!0)])])])])):(a(),m("div",ha,ya))]),e("div",{class:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end"},[e("button",{onClick:c,class:"px-4 py-2 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400"}," Cerrar ")])])]))}},Va=ue(Ga,[["__scopeId","data-v-33bff9d6"]]),Wa={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Ha={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-auto shadow-xl"},Za={class:"flex justify-between items-center mb-4"},Qa=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electr√≥nica",-1),Xa={__name:"ElectronicSignatureModal",emits:["close"],setup(t,{emit:b}){const o=Be(),r=b,y=()=>{r("close")},i=async c=>{o.currentUser&&(o.currentUser.has_signature=!0),v("Firma electr√≥nica guardada correctamente","success"),setTimeout(()=>{y()},500)};return(c,f)=>(a(),m("div",Wa,[e("div",Ha,[e("div",Za,[Qa,e("button",{onClick:y,class:"text-gray-400 hover:text-gray-500"},[S(d(J),{class:"h-6 w-6"})])]),S(We,{initialShowOptions:!0,"user-id":d(o).currentUser.id,onSignatureSaved:i,onCancel:y},null,8,["user-id"])])]))}},Ya={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Ja={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0"},Ka={class:"inline-block w-full max-w-4xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl"},eo={class:"flex items-center justify-between pb-4 mb-6 border-b border-gray-200"},to=e("h3",{class:"text-lg font-medium leading-6 text-gray-900"}," Gesti√≥n de Permisos ",-1),so={class:"mt-1 text-sm text-gray-500"},ao={key:0,class:"mb-6"},oo={key:1,class:"p-4 mb-6 bg-red-50 border border-red-200 rounded-lg"},ro=e("div",{class:"flex items-center"},[e("svg",{class:"w-5 h-5 text-red-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("p",{class:"text-red-700"},"No tienes permisos para gestionar los permisos de este documento.")],-1),no=[ro],io={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},lo=["disabled"],co={key:0,class:"flex items-center"},uo=e("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},null,-1),mo={key:1},go={__name:"DocumentPermissionsModal",props:{isOpen:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close","saved"],setup(t,{emit:b}){const o=t,r=b,y=ce(),i=j(null),c=j(!1),{isLawyer:f}=Ze(),p=A(()=>{var s;return f.value&&((s=o.document)==null?void 0:s.id)}),h=()=>{c.value||r("close")},g=async()=>{var C;if(!p.value||c.value)return;const s=(C=i.value)==null?void 0:C.getPermissionsData();if(!s){await v("Error al obtener los permisos actuales","error");return}c.value=!0;try{const T=o.document.id;await y.manageDocumentPermissions(T,s),await v("Permisos actualizados exitosamente","success"),r("saved",o.document),h()}catch(T){console.error("Error saving permissions:",T),await v("Error al guardar los permisos","error")}finally{c.value=!1}};return(s,C)=>(a(),z(xe,null,{default:L(()=>{var T;return[t.isOpen?(a(),m("div",Ya,[e("div",Ja,[e("div",{class:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:h}),e("div",Ka,[e("div",eo,[e("div",null,[to,e("p",so,D(((T=t.document)==null?void 0:T.title)||"Documento"),1)]),e("button",{onClick:h,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors"},[S(d(J),{class:"w-6 h-6"})])]),p.value?(a(),m("div",ao,[S(Qe,{ref_key:"permissionsManagerRef",ref:i,document:t.document},null,8,["document"])])):(a(),m("div",oo,no)),e("div",io,[e("button",{onClick:h,type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"},D(p.value?"Cancelar":"Cerrar"),1),p.value?(a(),m("button",{key:0,onClick:g,disabled:c.value,type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-secondary rounded-md hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[c.value?(a(),m("span",co,[uo,R(" Guardando... ")])):(a(),m("span",mo,"Guardar Permisos"))],8,lo)):I("",!0)])])])])):I("",!0)]}),_:1}))}};function ne(t){return He.fire({title:t,icon:"question",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",buttonsStyling:!1}).then(b=>b.isConfirmed)}function fo(t,b){const o=j({edit:{isOpen:!1,document:null},email:{isOpen:!1,document:null},preview:{isOpen:!1,document:null},signatures:{isOpen:!1,document:null},electronicSignature:{isOpen:!1,document:null},permissions:{isOpen:!1,document:null},letterhead:{isOpen:!1,document:null}}),r=(f,p,h={})=>{switch(i(),f){case"edit":o.value.edit={isOpen:!0,document:p,...h};break;case"email":o.value.email={isOpen:!0,document:p};break;case"preview":Re(p);break;case"signatures":o.value.signatures={isOpen:!0,document:p};break;case"electronic-signature":o.value.electronicSignature={isOpen:!0,document:p};break;case"permissions":o.value.permissions={isOpen:!0,document:p};break;case"letterhead":o.value.letterhead={isOpen:!0,document:p};break;default:console.warn(`Unknown modal type: ${f}`)}},y=f=>{o.value[f]&&(o.value[f]={isOpen:!1,document:null})},i=()=>{Object.keys(o.value).forEach(f=>{o.value[f]={isOpen:!1,document:null}})};return{activeModals:o,openModal:r,closeModal:y,closeAllModals:i,getUserRole:()=>{var f;return((f=b==null?void 0:b.currentUser)==null?void 0:f.role)||"client"}}}function po(t,b,o){const{registerView:r}=Xe(),y=$e();return{handlePreviewDocument:async n=>{await r("document",n.id),Re(n)},deleteDocument:async n=>{if(await ne(`¬øEst√°s seguro de que deseas eliminar el documento "${n.title}"?`)&&t)try{await t.deleteDocument(n.id),await v("Documento eliminado exitosamente","success"),o("refresh")}catch(B){throw await v("Error al eliminar el documento","error"),B}},downloadPDFDocument:async n=>{if(t)try{await t.downloadPDF(n.id,n.title),await v("PDF descargado exitosamente","success")}catch(x){throw await v("Error al descargar el PDF","error"),x}},downloadWordDocument:async n=>{if(t)try{await t.downloadWord(n.id,n.title),await v("Documento Word descargado exitosamente","success")}catch(x){throw await v("Error al descargar el documento Word","error"),x}},copyDocument:async n=>{var x;if(!t){await v("Funcionalidad de duplicar no implementada a√∫n","info");return}try{const B=new Date,N=String(B.getDate()).padStart(2,"0"),E=String(B.getMonth()+1).padStart(2,"0"),_=B.getFullYear(),M=`${N}${E}${_}`,F=`${n.title} ${M}`,P={title:F,content:n.content,state:"Draft",variables:((x=n.variables)==null?void 0:x.map(Q=>({name_en:Q.name_en,name_es:Q.name_es,tooltip:Q.tooltip,field_type:Q.field_type,select_options:Q.select_options,value:""})))||[],requires_signature:!1};if(!await ne(`¬øDeseas crear una copia del documento '${n.title}'?`))return;await t.createDocument(P),await v(`Copia creada exitosamente: "${F}"`,"success"),o("refresh")}catch(B){console.error("Error creating document copy:",B),await v("Error al crear la copia del documento","error")}},publishDocument:async n=>{if(t)try{const x={...n,state:"Published"};await t.updateDocument(n.id,x),await v("Documento publicado exitosamente","success"),o("refresh")}catch(x){throw await v("Error al publicar el documento","error"),x}},moveToDraft:async n=>{if(t)try{const x={...n,state:"Draft"};await t.updateDocument(n.id,x),await v("Documento movido a borrador exitosamente","success"),o("refresh")}catch(x){throw await v("Error al mover el documento a borrador","error"),x}},formalizeDocument:async n=>{try{y.push(`/dynamic_document_dashboard/document/use/formalize/${n.id}/${n.title}`)}catch(x){console.error("Error al formalizar el documento:",x),await v("Error al formalizar el documento","error")}},signDocument:async(n,x)=>{var B;try{const N=b.currentUser.id,E=b.currentUser.email;if(!n.requires_signature){await v("Este documento no requiere firmas","error");return}const _=(B=n.signatures)==null?void 0:B.find(P=>P.signer_email===E);if(!_){await v("No est√°s autorizado para firmar este documento","error");return}if(_.signed){await v("Ya has firmado este documento","info");return}if(!b.currentUser.has_signature){await v("Para firmar documentos necesitas tener una firma registrada.","info"),await ne("¬øDeseas crear una firma electr√≥nica ahora?")?x("electronic-signature",n):await v("Necesitas una firma para poder firmar documentos.","warning");return}if(!await ne(`¬øEst√°s seguro de que deseas firmar el documento "${n.title}"?`)){await v("Operaci√≥n de firma cancelada","info");return}const F=`dynamic-documents/${n.id}/sign/${N}/`;try{await v("Procesando firma del documento...","info");const P=await Me(F,{});if(P.status===200||P.status===201)await v(`¬°Documento "${n.title}" firmado correctamente!`,"success"),o("refresh");else throw new Error(`Unexpected server response: ${P.status} ${P.statusText}`)}catch(P){throw console.error("Error in HTTP request:",P),P}}catch(N){console.error("General error signing document:",N),await v(`Error al firmar el documento: ${N.message}`,"error")}},downloadSignedDocument:async n=>{try{if(n.state!=="FullySigned"){v("El documento debe estar completamente firmado para descargarlo","warning");return}if(!n.signatures||n.signatures.length===0){v("El documento no tiene firmas registradas","warning");return}const x=`dynamic-documents/${n.id}/generate-signatures-pdf/`;await Ye(x,`firmas_${n.title}.pdf`)}catch(x){console.error("Error downloading signed document:",x),v("Error al descargar el documento firmado","error")}}}}export{Po as B,So as _,Ae as a,Le as b,at as r,ot as u};
