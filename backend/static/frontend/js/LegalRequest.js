import{e as o,f as p,g as t,N as Q,X as Y,Y as V,ah as K,ai as W,u as ee,r as I,b as te,c as se,o as ae,d as re,j as u,k as g,h as S,w,v as R,i as k,l,F as $,H as L,n as x,m as b,s as N,a5 as le,a1 as P,I as q,t as M,M as oe,a3 as ne,R as ie}from"./index.js";import{r as U,s as de,h as ue}from"./loading_message.js";import{a as D,i as T,n as O,r as z,b as Z,u as j,l as G}from"./combobox.js";function ce(r,n){return o(),p("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M5.5 17a4.5 4.5 0 0 1-1.44-8.765 4.5 4.5 0 0 1 8.302-3.046 3.5 3.5 0 0 1 4.504 4.272A4 4 0 0 1 15 17H5.5Zm3.75-2.75a.75.75 0 0 0 1.5 0V9.66l1.95 2.1a.75.75 0 1 0 1.1-1.02l-3.25-3.5a.75.75 0 0 0-1.1 0l-3.25 3.5a.75.75 0 1 0 1.1 1.02l1.95-2.1v4.59Z","clip-rule":"evenodd"})])}function me(r,n){return o(),p("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M1 5.25A2.25 2.25 0 0 1 3.25 3h13.5A2.25 2.25 0 0 1 19 5.25v9.5A2.25 2.25 0 0 1 16.75 17H3.25A2.25 2.25 0 0 1 1 14.75v-9.5Zm1.5 5.81v3.69c0 .414.336.75.75.75h13.5a.75.75 0 0 0 .75-.75v-2.69l-2.22-2.219a.75.75 0 0 0-1.06 0l-1.91 1.909.47.47a.75.75 0 1 1-1.06 1.06L6.53 8.091a.75.75 0 0 0-1.06 0l-2.97 2.97ZM12 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z","clip-rule":"evenodd"})])}function pe(r,n){return o(),p("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"})])}const ge=Q("legalRequest",{state:()=>({legalRequests:[],dataLoaded:!1,legalRequestTypes:[],legalDisciplines:[]}),actions:{async init(){this.dataLoaded||await this.fetchDropDownOptionsData()},async fetchDropDownOptionsData(){try{let n=(await Y("dropdown_options_legal_request/")).data;if(n&&typeof n=="string")try{n=JSON.parse(n)}catch(m){console.error("JSON parse error:",m.message),n={legal_request_types:[],legal_disciplines:[]}}this.legalRequestTypes=n.legal_request_types??[],this.legalDisciplines=n.legal_disciplines??[],this.dataLoaded=!0}catch(r){console.error("Error fetching dropdown options data:",r.message),this.legalRequestTypes=[],this.legalDisciplines=[],this.dataLoaded=!1}},async createLegalRequest(r){const n={firstName:r.firstName,lastName:r.lastName,email:r.email,requestTypeId:r.requestTypeId.id,disciplineId:r.disciplineId.id,description:r.description},m=new FormData;m.append("mainData",JSON.stringify(n));try{const c=await V("create_legal_request/",m);if(c.status===201){const f=c.data.id;if(r.files&&r.files.length>0){const y=await this.uploadFiles(f,r.files);y.every(_=>_.success)||console.warn("Some files failed to upload:",y.filter(_=>!_.success))}const a=r.requestTypeId.name||"legal",h=r.disciplineId.name||"";return await K(W.CREATE,`Radicaste una solicitud de ${a}${h?` en ${h}`:""}.`),this.dataLoaded=!1,c.status}else return console.error("Failed to create legal request:",c.status),null}catch(c){return console.error("Error creating legal request:",c.message),null}},async uploadFiles(r,n){const m=[];for(const c of n)try{const f=new FormData;f.append("file",c),f.append("legalRequestId",r);const a=await V("upload_legal_request_file/",f);m.push({file:c.name,success:a.status===201})}catch(f){console.error(`Error uploading file ${c.name}:`,f.message),m.push({file:c.name,success:!1})}return m}}}),fe={class:"p-6"},he={class:"pb-10 px-4 sm:px-6 lg:px-8"},ye={class:"w-full p-5 rounded-lg border-2 border-stroke bg-terciary"},xe=t("div",null,[t("h1",{class:"text-primary text-xl font-semibold"},"Presentar Solicitud")],-1),ve={class:"mt-4 space-y-3"},be={class:"grid md:grid-cols-2 xl:grid-cols-4 gap-3"},_e=t("label",{for:"name",class:"block text-base font-medium leading-6 text-primary"},[b(" Nombre "),t("span",{class:"text-red-500"},"*")],-1),we={class:"mt-2"},ke=t("label",{for:"last_name",class:"block text-base font-medium leading-6 text-primary"},[b(" Apellido "),t("span",{class:"text-red-500"},"*")],-1),Ne={class:"mt-2"},qe=t("label",{for:"email",class:"block text-base font-medium leading-6 text-primary"},[b(" Correo electronico "),t("span",{class:"text-red-500"},"*")],-1),Ie={class:"mt-2"},Re={key:0,class:"absolute font-regular text-red-500 text-sm"},$e=t("span",{class:"text-red-500"},"*",-1),Ce={class:"relative mt-2"},Se=t("span",{class:"text-red-500"},"*",-1),Le={class:"relative mt-2"},Me={class:"col-span-full"},Fe=t("label",{for:"description",class:"block text-base font-medium leading-6 text-primary"},[b(" Descripción "),t("span",{class:"text-red-500"},"*")],-1),Ee={class:"mt-2"},Ae={class:"col-span-full"},Be=t("label",{for:"files",class:"block text-base font-medium leading-6 text-primary"}," Anexos ",-1),Ve={key:0,class:"text-center"},Pe={class:"mt-4 flex text-sm/6 text-gray-600"},Ue={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"},De=t("span",null,"Sube un archivo",-1),Te=t("p",{class:"pl-1"},"o arrastra y suelta",-1),Oe=t("p",{class:"text-xs/5 text-gray-600"}," PNG, JPG, PDF, DOCX de hasta 30MB ",-1),ze={key:1,class:"w-full flex flex-wrap gap-3"},Ze=["onMouseenter","onMouseleave"],je=["onClick"],Ge={class:"text-center text-xs truncate w-20"},Je={class:"flex gap-3 span-col-full"},He=["disabled"],Xe=t("span",null,"Guardar",-1),Qe=[Xe],Ye=t("span",null,"Cancelar",-1),Ke=30*1024*1024,st={__name:"LegalRequest",setup(r){const n=ee(),m=ge(),c=I([]),f=I([]),a=te({firstName:"",lastName:"",email:"",requestTypeId:"",disciplineId:"",description:"",files:[]}),h=I(null),y=I([]),F=i=>{const s=Array.from(i.target.files);E(s),i.target.value=null},_=i=>{i.preventDefault();const s=Array.from(i.dataTransfer.files);E(s)},E=i=>{i.forEach(s=>{if(s.size>Ke){N(`El archivo "${s.name}" excede el límite de 30 MB. Por favor, selecciona un archivo más pequeño.`,"warning");return}const C=s.name.split(".").pop().toLowerCase();let e="",d={general:"",xMark:""};switch(C){case"png":case"jpg":case"jpeg":e=me,d.general="border-gray-200 text-gray-400",d.xMark="bg-gray-400";break;case"pdf":e=U,d.general="border-red-600/20 text-red-600/60",d.xMark="bg-red-600/60";break;case"docx":e=U,d.general="border-blue-600/20 text-blue-600/60",d.xMark="bg-blue-600/60";break;default:N("¡Ups! Ese tipo de archivo no es compatible. Asegúrate de que el archivo sea PDF, DOCX, JPG, PNG, JPEG.","warning");return}y.value.push({name:s.name,icon:e,style:d,hover:!1,file:s})})},J=i=>{y.value.splice(i,1)},A=i=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i),B=se(()=>a.firstName.trim()&&a.lastName.trim()&&a.email.trim()&&A(a.email)&&a.requestTypeId&&a.disciplineId&&a.description.trim()),H=async()=>{de();const i=y.value.map(s=>s.file);a.files=i;try{const s=await m.createLegalRequest(a);ue(),s===201?(N("¡Solicitud creada exitosamente!","success"),X(),n.push({name:"process_list"})):N("Error al crear la solicitud. Intenta nuevamente.","error")}catch(s){console.error("Error al enviar la solicitud:",s),N("Hubo un error inesperado. Por favor, inténtalo más tarde.","error")}},X=()=>{a.firstName="",a.lastName="",a.email="",a.requestTypeId="",a.disciplineId="",a.description="",y.value=[]};return ae(async()=>{await m.init(),c.value=m.legalRequestTypes,f.value=m.legalDisciplines}),(i,s)=>{const C=re("SearchBarAndFilterBy");return o(),p($,null,[t("div",fe,[u(C,{"onUpdate:searchQuery":s[0]||(s[0]=e=>i.searchQuery=e)},{default:g(()=>[le(i.$slots,"default")]),_:3})]),t("div",he,[t("div",ye,[xe,t("form",{onSubmit:s[14]||(s[14]=S(e=>H(),["prevent"]))},[t("div",ve,[t("div",be,[t("div",null,[_e,t("div",we,[w(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>a.firstName=e),type:"text",name:"name",id:"name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[R,a.firstName]])])]),t("div",null,[ke,t("div",Ne,[w(t("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>a.lastName=e),type:"text",name:"last_name",id:"last_name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[R,a.lastName]])])]),t("div",null,[qe,t("div",Ie,[w(t("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>a.email=e),type:"email",name:"email",id:"email",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[R,a.email]]),a.email&&!A(a.email)?(o(),p("p",Re," Por favor, introduce un correo válido. ")):k("",!0)])]),t("div",null,[u(l(G),{as:"div",modelValue:a.requestTypeId,"onUpdate:modelValue":[s[6]||(s[6]=e=>a.requestTypeId=e),s[7]||(s[7]=e=>h.value="")]},{default:g(()=>[u(l(D),{class:"block text-base font-medium leading-6 text-primary"},{default:g(()=>[b(" Tipo de solicitud "),$e]),_:1}),t("div",Ce,[u(l(T),{class:"w-full rounded-md border-0 bg-white py-1.5 pl-3 pr-10 text-primary shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",onChange:s[4]||(s[4]=e=>h.value=e.target.value),onBlur:s[5]||(s[5]=e=>h.value=""),"display-value":e=>e!=null&&e.name?`${e==null?void 0:e.name}`:""},null,8,["display-value"]),u(l(O),{class:"absolute inset-y-0 right-0 flex items-center gap-2 rounded-r-md px-2 focus:outline-none border-l border-gray-300"},{default:g(()=>[b(" Seleccionar "),u(l(P),{class:"h-5 w-5 text-gray-400","aria-hidden":"true"})]),_:1}),c.value?(o(),q(l(j),{key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:g(()=>[(o(!0),p($,null,L(c.value,e=>(o(),q(l(z),{key:e.id,value:e,as:"template"},{default:g(({active:d,selected:v})=>[t("li",{class:x(["relative cursor-default select-none py-2 pl-3 pr-9",d?"bg-secondary text-white":"text-primary"])},[t("span",{class:x(["block truncate",v&&"font-semibold"])},M(e.name),3),v?(o(),p("span",{key:0,class:x(["absolute inset-y-0 right-0 flex items-center pr-4",d?"text-white":"text-secondary"])},[u(l(Z),{class:"h-5 w-5","aria-hidden":"true"})],2)):k("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})):k("",!0)])]),_:1},8,["modelValue"])]),t("div",null,[u(l(G),{as:"div",modelValue:a.disciplineId,"onUpdate:modelValue":[s[10]||(s[10]=e=>a.disciplineId=e),s[11]||(s[11]=e=>h.value="")]},{default:g(()=>[u(l(D),{class:"block text-base font-medium leading-6 text-primary"},{default:g(()=>[b(" Especialidad "),Se]),_:1}),t("div",Le,[u(l(T),{class:"w-full rounded-md border-0 bg-white py-1.5 pl-3 pr-10 text-primary shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",onChange:s[8]||(s[8]=e=>h.value=e.target.value),onBlur:s[9]||(s[9]=e=>h.value=""),"display-value":e=>e!=null&&e.name?`${e==null?void 0:e.name}`:""},null,8,["display-value"]),u(l(O),{class:"absolute inset-y-0 right-0 flex items-center gap-2 rounded-r-md px-2 focus:outline-none border-l border-gray-300"},{default:g(()=>[b(" Seleccionar "),u(l(P),{class:"h-5 w-5 text-gray-400","aria-hidden":"true"})]),_:1}),f.value?(o(),q(l(j),{key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:g(()=>[(o(!0),p($,null,L(f.value,e=>(o(),q(l(z),{key:e.id,value:e,as:"template"},{default:g(({active:d,selected:v})=>[t("li",{class:x(["relative cursor-default select-none py-2 pl-3 pr-9",d?"bg-secondary text-white":"text-primary"])},[t("span",{class:x(["block truncate",v&&"font-semibold"])},M(e.name),3),v?(o(),p("span",{key:0,class:x(["absolute inset-y-0 right-0 flex items-center pr-4",d?"text-white":"text-secondary"])},[u(l(Z),{class:"h-5 w-5","aria-hidden":"true"})],2)):k("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})):k("",!0)])]),_:1},8,["modelValue"])]),t("div",Me,[Fe,t("div",Ee,[w(t("textarea",{"onUpdate:modelValue":s[12]||(s[12]=e=>a.description=e),rows:"4",name:"comment",id:"comment",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[R,a.description]])])]),t("div",Ae,[Be,t("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 bg-white px-6 py-10",onDragover:s[13]||(s[13]=S(()=>{},["prevent"])),onDrop:S(_,["prevent"])},[y.value.length<1?(o(),p("div",Ve,[u(l(ce),{class:"mx-auto size-12 text-gray-300","aria-hidden":"true"}),t("div",Pe,[t("label",Ue,[De,t("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",onChange:F},null,32)]),Te]),Oe])):(o(),p("div",ze,[(o(!0),p($,null,L(y.value,(e,d)=>(o(),p("div",{key:d,class:x(["relative p-4 grid rounded-md bg-white border-2",e.style.general]),onMouseenter:v=>e.hover=!0,onMouseleave:v=>e.hover=!1},[w(t("div",{class:x(["absolute p-0.5 mt-2 ml-2 rounded-full",e.style.xMark]),onClick:v=>J(d)},[u(l(pe),{class:"size-3 text-white"})],10,je),[[oe,e.hover]]),(o(),q(ne(e.icon),{class:"size-12 mx-auto"})),t("span",Ge,M(e.name),1)],42,Ze))),128))]))],32)]),t("div",Je,[t("button",{type:"submit",class:x(["p-2.5 text-sm font-medium rounded-md flex gap-2",B.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!B.value},Qe,10,He),u(l(ie),{to:{name:"process_list"},type:"button",class:"p-2.5 text-sm font-medium rounded-md flex gap-2 bg-red-600/80 text-white cursor-pointer"},{default:g(()=>[Ye]),_:1})])])])],32)])])],64)}}};export{st as default};
