import{c as f,e as m,k as L,i as C,g as i,n as M,f as S,t as v,a8 as O,P as N,r as B,o as q,T as P,F as U,M as z,p as A,l as j,h as V,j as x,D as F,s as R,N as Q,O as H}from"./index.js";import{u as G,s as E,p as J}from"./index2.js";import{B as K,_ as W}from"./index3.js";import{_ as X}from"./_plugin-vue_export-helper.js";const Y={class:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Z={key:0,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},ee={key:1,d:"M20 6L9 17l-5-5"},te={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700 border border-gray-200"},se={__name:"SignatureDocumentCard",props:{document:{type:Object,required:!0},cardType:{type:String,default:"signatures"},cardContext:{type:String,default:"list"},highlightedDocId:{type:[String,Number],default:null},showTags:{type:Boolean,default:!0},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1}},emits:["click","preview","edit","refresh","sign","view-signatures","remove-from-folder"],setup(t,{emit:$}){const p=t,o=$;f(()=>null);const b=f(()=>p.document.state==="PendingSignatures"?"Pendiente de firmas":"Completamente firmado"),u=f(()=>p.document.state==="PendingSignatures"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-green-100 text-green-700 border border-green-200"),l=f(()=>{if(p.menuOptions!==null)return p.menuOptions}),w=e=>e.signatures?e.signatures.length:0,I=e=>e.signatures?e.signatures.filter(s=>s.signed).length:0,_=(e,s)=>{o("click",e,s),p.disableInternalActions||o("preview",e)};return(e,s)=>(m(),L(K,{document:t.document,"card-type":t.cardType,"card-context":t.cardContext,"status-icon":null,"status-text":b.value,"status-badge-classes":u.value,"highlighted-doc-id":t.highlightedDocId,"show-tags":t.showTags,"additional-classes":"mb-4","menu-options":l.value,"disable-internal-actions":t.disableInternalActions,"document-store":t.documentStore,"user-store":t.userStore,onClick:_,onPreview:s[0]||(s[0]=d=>e.$emit("preview",d)),onEdit:s[1]||(s[1]=d=>e.$emit("edit",d)),onRefresh:s[2]||(s[2]=d=>e.$emit("refresh")),onSign:s[3]||(s[3]=d=>e.$emit("sign",d)),onViewSignatures:s[4]||(s[4]=d=>e.$emit("view-signatures",d)),onRemoveFromFolder:s[5]||(s[5]=d=>e.$emit("remove-from-folder",d))},{"status-badge":C(()=>[i("div",{class:M(["inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium",u.value])},[(m(),S("svg",Y,[t.document.state==="PendingSignatures"?(m(),S("path",Z)):(m(),S("path",ee))])),i("span",null,v(b.value),1)],2)]),"additional-badges":C(()=>[i("div",te,[i("span",null,v(I(t.document))+"/"+v(w(t.document)),1)])]),"additional-content":C(()=>[]),"additional-actions":C(()=>[O(e.$slots,"additional-actions")]),_:3},8,["document","card-type","card-context","status-text","status-badge-classes","highlighted-doc-id","show-tags","menu-options","disable-internal-actions","document-store","user-store"]))}},T=t=>(Q("data-v-1b0481ad"),t=t(),H(),t),ne={key:0,class:"mt-6 flex flex-col items-center justify-center text-center text-gray-500 w-full p-12 rounded-xl bg-gray-50 border-2 border-dashed border-gray-200"},re=T(()=>i("svg",{class:"w-16 h-16 mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})],-1)),oe={class:"text-lg font-semibold mb-2 text-gray-700"},ae={class:"text-sm mb-4 max-w-md"},ie={class:"flex flex-col sm:flex-row gap-3 mt-2"},le={class:"text-xs text-gray-400 bg-gray-100 px-3 py-2 rounded-lg"},de={key:1,class:"mt-6 flex justify-center"},ue=T(()=>i("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[i("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),i("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),ce=T(()=>i("span",null,"Cargando documentos...",-1)),ge=[ue,ce],me={__name:"SignaturesList",props:{state:{type:String,required:!0,validator:t=>["PendingSignatures","FullySigned"].includes(t)},searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},emits:["refresh"],setup(t,{expose:$,emit:p}){const o=t,b=p,u=N(),l=G();B([]);const w=B(!1),I=f(()=>o.state==="PendingSignatures"?"No tienes documentos pendientes por firmar":"No tienes documentos firmados"),_=f(()=>o.state==="PendingSignatures"?"Cuando tengas documentos que requieran tu firma electrónica aparecerán aquí. Tu abogado te notificará cuando haya documentos listos para firmar.":"Una vez que firmes documentos electrónicamente, aparecerán aquí con el registro completo de firmas y podrás descargarlos cuando estén completamente firmados."),e=f(()=>{const a=u.currentUser.role,c=u.currentUser.id,g=u.currentUser.email;let r=[];if(a==="lawyer"?o.state==="PendingSignatures"?r=l.pendingSignatureDocuments.filter(n=>n.created_by===c):r=l.fullySignedDocuments.filter(n=>n.created_by===c):o.state==="PendingSignatures"?r=l.documents.filter(n=>{var y;return n.state!=="PendingSignatures"?!1:(y=n.signatures)==null?void 0:y.some(k=>k.signer_email===g)}):r=l.documents.filter(n=>{var y;return n.state!=="FullySigned"?!1:(y=n.signatures)==null?void 0:y.some(k=>k.signer_email===g&&k.signed)}),o.searchQuery&&(r=r.filter(n=>n.title.toLowerCase().includes(o.searchQuery.toLowerCase()))),o.selectedTags&&o.selectedTags.length>0){const n=o.selectedTags.map(h=>h.id);r=r.filter(h=>!h.tags||h.tags.length===0?!1:h.tags.some(y=>n.includes(y.id)))}return r}),s=f(()=>{const a=l.lastUpdatedDocumentId,c=localStorage.getItem("lastUpdatedDocumentId");return a&&e.value.some(r=>String(r.id)===String(a))?a:c&&e.value.some(n=>String(n.id)===String(c))?c:null}),d=async()=>{w.value=!0;try{if(await l.init(!0),l.pendingSignatureDocuments.length===0&&l.fullySignedDocuments.length===0){const a=u.currentUser.id,g=u.currentUser.role==="lawyer"?`dynamic-documents/created-by/${a}/pending-signatures/`:`dynamic-documents/user/${a}/pending-documents-full/`,r=await F(g);r&&r.data&&l.$patch(n=>{n.documents=[...n.documents,...r.data]})}}catch(a){console.error("Error refreshing documents:",a),R("Error al actualizar documentos","error")}finally{w.value=!1}},D=async()=>{await d(),b("refresh")};return q(async()=>{await d()}),$({refresh:D}),P(()=>l.documents,a=>{},{deep:!0}),P(()=>u.currentUser,a=>{D()}),P(()=>o.searchQuery,a=>{a||D()}),(a,c)=>(m(),S(U,null,[(m(!0),S(U,null,z(e.value,g=>(m(),L(x(se),{key:g.id,document:g,"card-type":"signatures","card-context":"list","highlighted-doc-id":s.value,"document-store":x(l),"user-store":x(u),onRefresh:D,class:"mb-4"},null,8,["document","highlighted-doc-id","document-store","user-store"]))),128)),e.value.length===0&&!w.value?(m(),S("div",ne,[re,i("h3",oe,v(I.value),1),i("p",ae,v(_.value),1),i("div",ie,[i("div",le,[A(v(o.state==="PendingSignatures"?"📝":"✅")+" ",1),i("strong",null,v(o.state==="PendingSignatures"?"Firmas pendientes":"Documentos firmados"),1)])])])):j("",!0),w.value?(m(),S("div",de,ge)):j("",!0),V(W,{isVisible:x(E),documentData:x(J),onClose:c[0]||(c[0]=g=>E.value=!1)},null,8,["isVisible","documentData"])],64))}},fe=X(me,[["__scopeId","data-v-1b0481ad"]]),ve=Object.freeze(Object.defineProperty({__proto__:null,default:fe},Symbol.toStringTag,{value:"Module"}));export{fe as S,se as _,ve as a};
