import{c as f,e as u,m as T,k as b,g as d,n as L,f as p,t as x,a7 as O,P as U,r as k,o as j,T as C,F as $,M as E,i as I,j as _,l as S,D as M,s as N,N as V,O as z}from"./index.js";import{u as A,s as P,p as F}from"./dynamicDocument.js";import{B as R,_ as Q}from"./index2.js";import{_ as q}from"./_plugin-vue_export-helper.js";const H={class:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},G={key:0,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"},J={key:1,d:"M20 6L9 17l-5-5"},K={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700 border border-gray-200"},W={__name:"SignatureDocumentCard",props:{document:{type:Object,required:!0},cardType:{type:String,default:"signatures"},cardContext:{type:String,default:"list"},highlightedDocId:{type:[String,Number],default:null},showTags:{type:Boolean,default:!0},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},menuOptions:{type:Array,default:null},disableInternalActions:{type:Boolean,default:!1}},emits:["click","preview","edit","refresh","sign","view-signatures","remove-from-folder"],setup(n,{emit:l}){const i=n,a=l;f(()=>null);const c=f(()=>i.document.state==="PendingSignatures"?"Pendiente de firmas":"Completamente firmado"),v=f(()=>i.document.state==="PendingSignatures"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-green-100 text-green-700 border border-green-200"),y=f(()=>{if(i.menuOptions!==null)return i.menuOptions}),D=e=>e.signatures?e.signatures.length:0,h=e=>e.signatures?e.signatures.filter(s=>s.signed).length:0,o=(e,s)=>{a("click",e,s),i.disableInternalActions||a("preview",e)};return(e,s)=>(u(),T(R,{document:n.document,"card-type":n.cardType,"card-context":n.cardContext,"status-icon":null,"status-text":c.value,"status-badge-classes":v.value,"highlighted-doc-id":n.highlightedDocId,"show-tags":n.showTags,"additional-classes":"mb-4","menu-options":y.value,"disable-internal-actions":n.disableInternalActions,"document-store":n.documentStore,"user-store":n.userStore,onClick:o,onPreview:s[0]||(s[0]=t=>e.$emit("preview",t)),onEdit:s[1]||(s[1]=t=>e.$emit("edit",t)),onRefresh:s[2]||(s[2]=t=>e.$emit("refresh")),onSign:s[3]||(s[3]=t=>e.$emit("sign",t)),onViewSignatures:s[4]||(s[4]=t=>e.$emit("view-signatures",t)),onRemoveFromFolder:s[5]||(s[5]=t=>e.$emit("remove-from-folder",t))},{"status-badge":b(()=>[d("div",{class:L(["inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium",v.value])},[(u(),p("svg",H,[n.document.state==="PendingSignatures"?(u(),p("path",G)):(u(),p("path",J))])),d("span",null,x(c.value),1)],2)]),"additional-badges":b(()=>[d("div",K,[d("span",null,x(h(n.document))+"/"+x(D(n.document)),1)])]),"additional-content":b(()=>[]),"additional-actions":b(()=>[O(e.$slots,"additional-actions")]),_:3},8,["document","card-type","card-context","status-text","status-badge-classes","highlighted-doc-id","show-tags","menu-options","disable-internal-actions","document-store","user-store"]))}},B=n=>(V("data-v-3061a428"),n=n(),z(),n),X={key:0,class:"mt-6 flex flex-col items-center justify-center text-center text-gray-500 w-full"},Y={class:"text-lg font-semibold"},Z={key:1,class:"mt-6 flex justify-center"},ee=B(()=>d("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),te=B(()=>d("span",null,"Cargando documentos...",-1)),se=[ee,te],ne={__name:"SignaturesList",props:{state:{type:String,required:!0,validator:n=>["PendingSignatures","FullySigned"].includes(n)},searchQuery:{type:String,default:""},selectedTags:{type:Array,default:()=>[]}},setup(n){const l=n,i=U(),a=A();k([]);const c=k(!1),v=f(()=>l.state==="PendingSignatures"?"No tienes documentos pendientes por firmar.":"No tienes documentos firmados."),y=f(()=>{const o=i.currentUser.role,e=i.currentUser.id,s=i.currentUser.email;let t=[];if(o==="lawyer"?l.state==="PendingSignatures"?t=a.pendingSignatureDocuments.filter(r=>r.created_by===e):t=a.fullySignedDocuments.filter(r=>r.created_by===e):l.state==="PendingSignatures"?t=a.documents.filter(r=>{var m;return r.state!=="PendingSignatures"?!1:(m=r.signatures)==null?void 0:m.some(w=>w.signer_email===s)}):t=a.documents.filter(r=>{var m;return r.state!=="FullySigned"?!1:(m=r.signatures)==null?void 0:m.some(w=>w.signer_email===s&&w.signed)}),l.searchQuery&&(t=t.filter(r=>r.title.toLowerCase().includes(l.searchQuery.toLowerCase()))),l.selectedTags&&l.selectedTags.length>0){const r=l.selectedTags.map(g=>g.id);t=t.filter(g=>!g.tags||g.tags.length===0?!1:g.tags.some(m=>r.includes(m.id)))}return t}),D=f(()=>{const o=a.lastUpdatedDocumentId,e=localStorage.getItem("lastUpdatedDocumentId");return o&&y.value.some(t=>String(t.id)===String(o))?o:e&&y.value.some(r=>String(r.id)===String(e))?e:null}),h=async()=>{c.value=!0;try{if(await a.init(!0),a.pendingSignatureDocuments.length===0&&a.fullySignedDocuments.length===0){const o=i.currentUser.id,s=i.currentUser.role==="lawyer"?`dynamic-documents/created-by/${o}/pending-signatures/`:`dynamic-documents/user/${o}/pending-documents-full/`,t=await M(s);t&&t.data&&a.$patch(r=>{r.documents=[...r.documents,...t.data]})}}catch(o){console.error("Error refreshing documents:",o),N("Error al actualizar documentos","error")}finally{c.value=!1}};return j(async()=>{await h()}),C(()=>a.documents,o=>{},{deep:!0}),C(()=>i.currentUser,o=>{h()}),C(()=>l.searchQuery,o=>{o||h()}),(o,e)=>(u(),p($,null,[(u(!0),p($,null,E(y.value,s=>(u(),T(S(W),{key:s.id,document:s,"card-type":"signatures","card-context":"list","highlighted-doc-id":D.value,"document-store":S(a),"user-store":S(i),onRefresh:h,class:"mb-4"},null,8,["document","highlighted-doc-id","document-store","user-store"]))),128)),y.value.length===0&&!c.value?(u(),p("div",X,[d("p",Y,x(v.value),1)])):I("",!0),c.value?(u(),p("div",Z,se)):I("",!0),_(Q,{isVisible:S(P),documentData:S(F),onClose:e[0]||(e[0]=s=>P.value=!1)},null,8,["isVisible","documentData"])],64))}},re=q(ne,[["__scopeId","data-v-3061a428"]]),ue=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"}));export{re as S,W as _,ue as a};
