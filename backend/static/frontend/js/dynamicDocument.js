import{r as f,O as h,N as p,V as y,aG as g,aH as D}from"./index.js";const _=f(!1),C=f({title:"",content:""}),b=e=>{let t=e.content;e.variables.forEach(s=>{const a=new RegExp(`{{s*${s.name_en}s*}}`,"g");t=t.replace(a,s.value)||""}),C.value={title:e.title,content:e.assigned_to?t:e.content},_.value=!0},w=async(e,t)=>{try{const s=await h(e,"blob");if(!s||!s.data)throw new Error("[ERROR] No response data received.");const a=new Blob([s.data],{type:"application/pdf"}),n=document.createElement("a");n.href=window.URL.createObjectURL(a),n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(s){console.error("[ERROR] Error downloading file:",s)}},E=p("dynamicDocument",{state:()=>({documents:[],selectedDocument:null,dataLoaded:!1}),getters:{documentById:e=>t=>e.documents.find(s=>s.id==t)||null,publishedDocumentsUnassigned:e=>e.documents.filter(t=>t.state==="Published"&&!t.assigned_to),draftAndPublishedDocumentsUnassigned:e=>e.documents.filter(t=>(t.state==="Draft"||t.state==="Published")&&!t.assigned_to),progressDocumentsByClient:e=>t=>e.documents.filter(s=>s.state==="Progress"&&s.assigned_to===t),completedDocumentsByClient:e=>t=>e.documents.filter(s=>s.state==="Completed"&&s.assigned_to===t),progressAndCompletedDocumentsByClient:e=>t=>e.documents.filter(s=>s.assigned_to===t&&(s.state==="Progress"||s.state==="Completed")),filteredDocuments:e=>(t,s)=>{if(!t)return e.documents;const a=t.toLowerCase();return e.documents.filter(n=>{var o,r,d,c,i,l,u,m;return n.title.toLowerCase().includes(a)||n.state.toLowerCase().includes(a)||n.assigned_to&&s&&(((r=(o=s.userById(n.assigned_to))==null?void 0:o.first_name)==null?void 0:r.toLowerCase().includes(a))||((c=(d=s.userById(n.assigned_to))==null?void 0:d.last_name)==null?void 0:c.toLowerCase().includes(a))||((l=(i=s.userById(n.assigned_to))==null?void 0:i.email)==null?void 0:l.toLowerCase().includes(a))||((m=(u=s.userById(n.assigned_to))==null?void 0:u.identification)==null?void 0:m.toLowerCase().includes(a)))})}},actions:{async init(){this.dataLoaded||await this.fetchDocuments()},async fetchDocuments(){try{const e=await h("dynamic-documents/");this.documents=e.data,this.dataLoaded=!0}catch(e){console.error("Error fetching documents:",e)}},async createDocument(e){try{const t=await y("dynamic-documents/create/",e);this.documents.push(t.data),this.selectedDocument=t.data,this.dataLoaded=!1,await this.fetchDocuments()}catch(t){console.error("Error creating document:",t)}},async updateDocument(e,t){try{const s=await g(`dynamic-documents/${e}/update/`,t);this.dataLoaded=!1,await this.fetchDocuments()}catch(s){console.error("Error updating document:",s)}},async deleteDocument(e){try{await D(`dynamic-documents/${e}/delete/`),this.dataLoaded=!1,await this.fetchDocuments()}catch(t){console.error("Error deleting document:",t)}},async downloadPDF(e,t){await w(`dynamic-documents/${e}/download-pdf/`,`${t}.pdf`)},async downloadWord(e,t){await w(`dynamic-documents/${e}/download-word/`,`${t}.docx`)},clearSelectedDocument(){this.selectedDocument=null}}});export{b as o,C as p,_ as s,E as u};
