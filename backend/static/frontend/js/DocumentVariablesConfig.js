import{e as u,f as m,g as e,I as P,r as $,c as O,s as w,al as Y,o as L,j as t,h as T,p as B,F as N,N as U,n as Z,ac as j,t as E,m as F,l as C,G,w as I,v as z,aU as H,u as K,S as J,x as Q}from"./index.js";import{u as A}from"./index2.js";import{a as W,g as X,_ as ee}from"./DocumentPermissionsManager.js";import{r as te}from"./PlusIcon.js";import{r as oe}from"./PencilIcon.js";import{r as se}from"./TrashIcon.js";function ne(x,k){return u(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})])}function ae(){const x=A(),k=P(),s=$([]),y=$(!1),_=$(!1),g=$({name:"",color_id:1}),v=O(()=>{var n;return((n=k.getCurrentUser)==null?void 0:n.role)==="lawyer"}),h=O(()=>W()),S=async n=>{v.value&&(await x.initTags(),n!=null&&n.tags&&n.tags.length>0?s.value=[...n.tags]:s.value=[])},M=()=>{g.value={name:"",color_id:1},_.value=!1,y.value=!0},q=n=>{g.value={...n},_.value=!0,y.value=!0},b=()=>{y.value=!1,g.value={name:"",color_id:1},_.value=!1};return{selectedTags:s,showTagModal:y,isEditingTag:_,currentTag:g,isLawyer:v,availableColors:h,initializeTags:S,openCreateTagModal:M,openEditTagModal:q,closeTagModal:b,saveTag:async()=>{if(!g.value.name.trim()){await w("El nombre de la etiqueta es requerido","error");return}try{_.value?(await x.updateTag(g.value.id,{name:g.value.name,color_id:g.value.color_id}),await w("Etiqueta actualizada exitosamente","success")):(await x.createTag({name:g.value.name,color_id:g.value.color_id}),await w("Etiqueta creada exitosamente","success")),b()}catch(n){console.error("Error saving tag:",n),await w("Error al guardar la etiqueta","error")}},deleteTag:async n=>{if((await Y.fire({title:"¿Estás seguro?",text:`¿Deseas eliminar la etiqueta "${n.name}"?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await x.deleteTag(n.id)?(s.value=s.value.filter(c=>c.id!==n.id),await w("Etiqueta eliminada exitosamente","success")):await w("Error al eliminar la etiqueta","error")}catch(D){console.error("Error deleting tag:",D),await w("Error al eliminar la etiqueta","error")}},toggleTagSelection:n=>{const d=s.value.findIndex(D=>D.id===n.id);d>=0?s.value.splice(d,1):s.value.push(n)},isTagSelected:n=>s.value.some(d=>d.id===n.id),getTagColorStyles:n=>{const d=X(n);return{backgroundColor:d.light,borderColor:d.dark,color:d.dark}},getTagIds:()=>s.value.map(n=>n.id)}}const re={key:0,class:"mt-6"},le={class:"flex items-center justify-between mb-4"},ie=e("h3",{class:"text-lg font-medium text-primary"},"Etiquetas del Documento",-1),ce={class:"space-y-3"},de={key:0},ue={class:"text-sm font-medium text-gray-700 mb-2 flex items-center gap-1"},me=e("span",null,"Etiquetas Disponibles:",-1),pe={class:"inline-flex items-center text-gray-400 cursor-help",title:"Estas son las etiquetas disponibles para todos tus documentos. Haz clic en una etiqueta para agregarla o quitarla de este documento."},ge={class:"flex flex-wrap gap-2"},fe=["onClick"],_e={class:"mr-2"},ye=["onClick"],he=["onClick"],xe={key:1},ve=e("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Etiquetas Seleccionadas:",-1),be={class:"flex flex-wrap gap-2"},we={class:"mr-2"},ke=["onClick"],De={key:2,class:"text-center py-6"},Te=e("p",{class:"text-gray-500"},"No hay etiquetas disponibles.",-1),Ce=e("p",{class:"text-gray-400 text-sm mt-1"},"Crea la primera etiqueta para organizar tus documentos.",-1),$e=[Te,Ce],Ee={class:"mt-3"},qe={class:"text-lg font-medium text-gray-900 mb-4"},Se={class:"mb-4"},Me=e("label",{for:"tag-name",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la etiqueta ",-1),Ne={class:"mb-6"},Ie=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Color de la etiqueta ",-1),Ve={class:"grid grid-cols-8 gap-2"},Ue=["onClick","title"],ze={class:"flex justify-end space-x-3"},Be={__name:"DocumentTagsManager",props:{document:{type:Object,default:null}},setup(x,{expose:k}){const s=x,y=A(),{selectedTags:_,showTagModal:g,isEditingTag:v,currentTag:h,isLawyer:S,availableColors:M,initializeTags:q,openCreateTagModal:b,openEditTagModal:V,closeTagModal:o,saveTag:r,deleteTag:i,toggleTagSelection:p,isTagSelected:l,getTagColorStyles:n,getTagIds:d}=ae();return L(async()=>{s.document&&await q(s.document)}),k({getTagIds:d}),(D,c)=>(u(),m(N,null,[t(S)?(u(),m("div",re,[e("div",le,[ie,e("button",{onClick:c[0]||(c[0]=(...a)=>t(b)&&t(b)(...a)),type:"button",class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-secondary hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary"},[T(t(te),{class:"h-4 w-4 mr-2"}),B(" Nueva Etiqueta ")])]),e("div",ce,[t(y).tags&&t(y).tags.length>0?(u(),m("div",de,[e("h4",ue,[me,e("span",pe,[T(t(ne),{class:"h-4 w-4"})])]),e("div",ge,[(u(!0),m(N,null,U(t(y).sortedTags,a=>(u(),m("div",{key:a.id,class:Z(["inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border-2 cursor-pointer transition-all duration-200",{"ring-2 ring-secondary":t(l)(a),"hover:shadow-md":!0}]),style:j(t(n)(a.color_id)),onClick:f=>t(p)(a)},[e("span",_e,E(a.name),1),e("button",{onClick:F(f=>t(V)(a),["stop"]),class:"ml-2 p-1 hover:bg-black hover:bg-opacity-10 rounded",title:"Editar etiqueta"},[T(t(oe),{class:"h-3 w-3"})],8,ye),e("button",{onClick:F(f=>t(i)(a),["stop"]),class:"ml-1 p-1 hover:bg-red-500 hover:bg-opacity-20 rounded",title:"Eliminar etiqueta"},[T(t(se),{class:"h-3 w-3"})],8,he)],14,fe))),128))])])):C("",!0),t(_).length>0?(u(),m("div",xe,[ve,e("div",be,[(u(!0),m(N,null,U(t(_),a=>(u(),m("div",{key:a.id,class:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border-2 ring-2 ring-secondary",style:j(t(n)(a.color_id))},[e("span",we,E(a.name),1),e("button",{onClick:f=>t(p)(a),class:"ml-2 p-1 hover:bg-red-500 hover:bg-opacity-20 rounded",title:"Remover etiqueta"},[T(t(G),{class:"h-3 w-3"})],8,ke)],4))),128))])])):C("",!0),!t(y).tags||t(y).tags.length===0?(u(),m("div",De,$e)):C("",!0)])])):C("",!0),t(g)?(u(),m("div",{key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onClick:c[6]||(c[6]=(...a)=>t(o)&&t(o)(...a))},[e("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",onClick:c[5]||(c[5]=F(()=>{},["stop"]))},[e("div",Ee,[e("h3",qe,E(t(v)?"Editar Etiqueta":"Nueva Etiqueta"),1),e("div",Se,[Me,I(e("input",{id:"tag-name","onUpdate:modelValue":c[1]||(c[1]=a=>t(h).name=a),type:"text",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-secondary focus:ring-secondary sm:text-sm",placeholder:"Ingresa el nombre de la etiqueta",onKeydown:c[2]||(c[2]=H((...a)=>t(r)&&t(r)(...a),["enter"]))},null,544),[[z,t(h).name]])]),e("div",Ne,[Ie,e("div",Ve,[(u(!0),m(N,null,U(t(M),a=>(u(),m("div",{key:a.id,class:Z(["w-8 h-8 rounded-full cursor-pointer border-2 transition-all duration-200",{"ring-2 ring-secondary":t(h).color_id===a.id,"border-gray-300":t(h).color_id!==a.id,"border-secondary":t(h).color_id===a.id}]),style:j({backgroundColor:a.hex}),onClick:f=>t(h).color_id=a.id,title:a.name},null,14,Ue))),128))])]),e("div",ze,[e("button",{onClick:c[3]||(c[3]=(...a)=>t(o)&&t(o)(...a)),type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"}," Cancelar "),e("button",{onClick:c[4]||(c[4]=(...a)=>t(r)&&t(r)(...a)),type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-secondary rounded-md hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary"},E(t(v)?"Actualizar":"Crear"),1)])])])])):C("",!0)],64))}},Re={class:"pb-10 px-4 sm:px-6 lg:px-8 lg:pt-10"},je={class:"w-full p-5 rounded-lg border-2 border-stroke bg-terciary"},Fe={class:"text-primary text-xl font-semibold"},Oe={class:"mt-4 space-y-4"},Ae={class:"text-primary text-lg font-semibold col-span-12"},Ze={class:"col-span-4"},Pe=["for"],Ye=e("span",{class:"text-red-500"},"*",-1),Le=["onUpdate:modelValue","id"],Ge={key:0,class:"text-red-500 text-sm mt-1"},He={class:"col-span-4"},Ke=e("label",{for:"tooltip",class:"block text-sm font-medium leading-6 text-primary"}," Tooltip ",-1),Je=["onUpdate:modelValue"],Qe={class:"col-span-4"},We=e("label",{for:"field_type",class:"block text-sm font-medium leading-6 text-primary"},[B(" Tipo de input "),e("span",{class:"text-red-500"},"*")],-1),Xe=["onUpdate:modelValue"],et=Q('<option value="input">Texto simple</option><option value="text_area">Texto largo</option><option value="number">Número</option><option value="date">Fecha</option><option value="email">Correo electrónico</option><option value="select">Selector</option>',6),tt=[et],ot={key:0,class:"col-span-12 mt-2"},st=e("label",{class:"block text-sm font-medium leading-6 text-primary"},[B(" Opciones del selector (separadas por coma) "),e("span",{class:"text-red-500"},"*")],-1),nt=["onUpdate:modelValue","onInput"],at={class:"mt-6 flex space-x-4"},mt={__name:"DocumentVariablesConfig",setup(x){const k=K(),s=A(),y=P(),_=$([]),g=$(null),v=$(null);O(()=>{var o;return((o=y.getCurrentUser)==null?void 0:o.role)==="lawyer"}),L(async()=>{var o;if(!s.selectedDocument){console.error("No selected document found");return}if(s.selectedDocument.id&&(!s.selectedDocument.tags||s.selectedDocument.tags.length===0))try{const r=await s.fetchDocumentById(s.selectedDocument.id,!0);s.selectedDocument=r}catch(r){console.error("Error fetching full document:",r)}(o=s.selectedDocument)!=null&&o.variables&&s.selectedDocument.variables.forEach(r=>{r.field_type==="select"&&(r.select_options||(r.select_options=[]),r.select_options_text=r.select_options.join(", "))})});const h={input:o=>o&&o.trim().length>0,text_area:o=>o&&o.trim().length>0,number:o=>!isNaN(parseFloat(o))&&isFinite(o),date:o=>{if(!o||!/^\d{4}-\d{2}-\d{2}$/.test(o))return!1;const i=new Date(o);return i instanceof Date&&!isNaN(i)},email:o=>o?/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(o):!1},S=(o,r)=>{const i=o.target.value;r.select_options_text=i,r.select_options=i?i.split(",").map(p=>p.trim()).filter(p=>p!==""):[]},M=()=>{var r;_.value=[];let o=!0;return(r=s.selectedDocument)==null||r.variables.forEach((i,p)=>{const l=[];if((!i.name_es||i.name_es.trim()==="")&&l.push("El nombre en pantalla es obligatorio."),i.value&&i.value.trim()!==""){const n=h[i.field_type];if(n&&!n(i.value))switch(i.field_type){case"number":l.push("El valor debe ser un número válido.");break;case"date":l.push("El valor debe ser una fecha válida en formato YYYY-MM-DD.");break;case"email":l.push("El valor debe ser un correo electrónico válido.");break;default:l.push("El valor no es válido para este tipo de campo.")}}i.field_type==="select"&&(!i.select_options||i.select_options.length===0)&&l.push("Debe ingresar al menos una opción para el selector."),l.length>0&&(_.value[p]=l.join(" "),o=!1)}),o||Y.fire({title:"Campos incompletos",text:"Por favor, verifica los campos obligatorios y sus formatos.",icon:"warning"}),o},q=o=>{if(o==="Draft"){b(o);return}M()&&b(o)},b=async o=>{var r,i;try{const p=((r=g.value)==null?void 0:r.getPermissionsData())||{},l=((i=v.value)==null?void 0:i.getTagIds())||[],n={title:s.selectedDocument.title,content:s.selectedDocument.content,state:o,variables:s.selectedDocument.variables.map(f=>({name_en:f.name_en,name_es:f.name_es,tooltip:f.tooltip||"",field_type:f.field_type,value:f.value,select_options:f.field_type==="select"?f.select_options:null})),tag_ids:l,...p},d=s.selectedDocument.title,D=s.selectedDocument.content;let c,a;if(s.selectedDocument.id?(c=s.selectedDocument.id,a=await s.updateDocument(c,n)):(a=await s.createDocument(n),a&&a.id&&(c=a.id)),s.selectedDocument=null,await s.init(),!c){const f=s.documents.find(R=>R.title===d&&R.content===D&&R.state===o);f&&(c=f.id)}c&&(window.localStorage.setItem("lastUpdatedDocumentId",c.toString()),s.lastUpdatedDocumentId=c),await w(o==="Draft"?"Documento guardado como borrador":"Documento publicado exitosamente","success"),setTimeout(()=>{k.push("/dynamic_document_dashboard")},300)}catch(p){console.error("Error saving document:",p)}},V=()=>{k.push("/dynamic_document_dashboard")};return(o,r)=>{var i,p;return u(),m("div",Re,[e("div",je,[e("h1",Fe,E((i=t(s).selectedDocument)==null?void 0:i.title),1),e("div",Oe,[(u(!0),m(N,null,U(((p=t(s).selectedDocument)==null?void 0:p.variables)||[],(l,n)=>(u(),m("div",{key:n,class:"grid grid-cols-12 gap-4 items-center"},[e("h2",Ae,E(l.name_en),1),e("div",Ze,[e("label",{for:"name_es_"+n,class:"block text-sm font-medium leading-6 text-primary"},[B(" Nombre en pantalla "),Ye],8,Pe),I(e("input",{type:"text","onUpdate:modelValue":d=>l.name_es=d,id:"name_es_"+n,class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,8,Le),[[z,l.name_es]]),_.value[n]?(u(),m("p",Ge,E(_.value[n]),1)):C("",!0)]),e("div",He,[Ke,I(e("input",{type:"text","onUpdate:modelValue":d=>l.tooltip=d,id:"tooltip",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",placeholder:"Opcional"},null,8,Je),[[z,l.tooltip]])]),e("div",Qe,[We,I(e("select",{"onUpdate:modelValue":d=>l.field_type=d,id:"field_type",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm"},tt,8,Xe),[[J,l.field_type]])]),l.field_type==="select"?(u(),m("div",ot,[st,I(e("input",{type:"text","onUpdate:modelValue":d=>l.select_options_text=d,onInput:d=>S(d,l),class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",placeholder:"Opción 1, Opción 2, Opción 3"},null,40,nt),[[z,l.select_options_text]])])):C("",!0)]))),128))]),T(Be,{ref_key:"tagsManagerRef",ref:v,document:t(s).selectedDocument},null,8,["document"]),T(ee,{ref_key:"permissionsManagerRef",ref:g,document:t(s).selectedDocument},null,8,["document"]),e("div",at,[e("button",{onClick:r[0]||(r[0]=l=>q("Draft")),class:"p-2.5 text-sm font-medium rounded-md bg-secondary text-white"}," Guardar como borrador "),e("button",{onClick:r[1]||(r[1]=l=>q("Published")),class:"p-2.5 text-sm font-medium rounded-md bg-gray-200 text-secondary border-2"}," Publicar "),e("button",{onClick:r[2]||(r[2]=l=>V()),type:"button",class:"p-2.5 text-sm font-medium rounded-md flex gap-2 bg-red-600/80 text-white cursor-pointer"}," Cancelar ")])])])}}};export{mt as default};
