import{u as Q,P as W,r as y,c as z,o as X,e as r,f as c,g as t,t as f,l as m,F as x,M as k,j as D,p as E,i as g,w as v,v as C,a$ as ee,h as S,s as _,S as te,n as F,aU as N,G as oe,aj as R,x as se}from"./index.js";import{u as ne}from"./dynamicDocument.js";import{r as ae,a as le,g as ie}from"./color_palette.js";import{r as re}from"./PlusIcon.js";import{r as ce}from"./TrashIcon.js";const de={class:"pb-10 px-4 sm:px-6 lg:px-8 lg:pt-10"},ue={class:"w-full p-5 rounded-lg border-2 border-stroke bg-terciary"},me={class:"text-primary text-xl font-semibold"},pe={class:"mt-4 space-y-4"},_e={class:"text-primary text-lg font-semibold col-span-12"},fe={class:"col-span-4"},ge=["for"],he=t("span",{class:"text-red-500"},"*",-1),ye=["onUpdate:modelValue","id"],xe={key:0,class:"text-red-500 text-sm mt-1"},ve={class:"col-span-4"},be=t("label",{for:"tooltip",class:"block text-sm font-medium leading-6 text-primary"}," Tooltip ",-1),we=["onUpdate:modelValue"],ke={class:"col-span-4"},De=t("label",{for:"field_type",class:"block text-sm font-medium leading-6 text-primary"},[E(" Tipo de input "),t("span",{class:"text-red-500"},"*")],-1),Ce=["onUpdate:modelValue"],Ee=se('<option value="input">Texto simple</option><option value="text_area">Texto largo</option><option value="number">Número</option><option value="date">Fecha</option><option value="email">Correo electrónico</option><option value="select">Selector</option>',6),Te=[Ee],qe={key:0,class:"col-span-12 mt-2"},Se=t("label",{class:"block text-sm font-medium leading-6 text-primary"},[E(" Opciones del selector (separadas por coma) "),t("span",{class:"text-red-500"},"*")],-1),Ne=["onUpdate:modelValue","onInput"],Ve={key:0,class:"mt-6"},$e={class:"flex items-center justify-between mb-4"},Ue=t("h3",{class:"text-lg font-medium text-primary"},"Etiquetas del Documento",-1),Be={class:"space-y-3"},Ie={key:0},Me=t("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Etiquetas Disponibles:",-1),ze={class:"flex flex-wrap gap-2"},Fe=["onClick"],Re={class:"mr-2"},je=["onClick"],Ae=["onClick"],Oe={key:1},Pe=t("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Etiquetas Seleccionadas:",-1),Ye={class:"flex flex-wrap gap-2"},Ze={class:"mr-2"},Ge=["onClick"],Ke={key:2,class:"text-center py-6"},Le=t("p",{class:"text-gray-500"},"No hay etiquetas disponibles.",-1),He=t("p",{class:"text-gray-400 text-sm mt-1"},"Crea la primera etiqueta para organizar tus documentos.",-1),Je=[Le,He],Qe={class:"mt-6 flex space-x-4"},We={class:"mt-3"},Xe={class:"text-lg font-medium text-gray-900 mb-4"},et={class:"mb-4"},tt=t("label",{for:"tag-name",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la etiqueta ",-1),ot={class:"mb-6"},st=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Color de la etiqueta ",-1),nt={class:"grid grid-cols-8 gap-2"},at=["onClick","title"],lt={class:"flex justify-end space-x-3"},pt={__name:"DocumentVariablesConfig",setup(it){const V=Q(),s=ne(),j=W(),b=y([]),p=y([]),w=y(!1),h=y(!1),d=y({id:null,name:"",color_id:0}),$=z(()=>{var o;return((o=j.getCurrentUser)==null?void 0:o.role)==="lawyer"}),A=z(()=>le());X(async()=>{var o,a;if(!s.selectedDocument){console.error("No selected document found");return}if(s.selectedDocument.id&&(!s.selectedDocument.tags||s.selectedDocument.tags.length===0))try{const n=await s.fetchDocumentById(s.selectedDocument.id,!0);s.selectedDocument=n}catch(n){console.error("Error fetching full document:",n)}$.value&&await s.initTags(),(o=s.selectedDocument)!=null&&o.tags&&s.selectedDocument.tags.length>0&&(p.value=[...s.selectedDocument.tags]),(a=s.selectedDocument)!=null&&a.variables&&s.selectedDocument.variables.forEach(n=>{n.field_type==="select"&&(n.select_options||(n.select_options=[]),n.select_options_text=n.select_options.join(", "))})});const O=()=>{d.value={id:null,name:"",color_id:0},h.value=!1,w.value=!0},P=o=>{d.value={...o},h.value=!0,w.value=!0},T=()=>{w.value=!1,d.value={id:null,name:"",color_id:0},h.value=!1},U=async()=>{if(!d.value.name.trim()){await _("El nombre de la etiqueta es requerido","error");return}try{h.value?(await s.updateTag(d.value.id,{name:d.value.name,color_id:d.value.color_id}),await _("Etiqueta actualizada exitosamente","success")):(await s.createTag({name:d.value.name,color_id:d.value.color_id}),await _("Etiqueta creada exitosamente","success")),T()}catch(o){console.error("Error saving tag:",o),await _("Error al guardar la etiqueta","error")}},Y=async o=>{if((await R.fire({title:"¿Estás seguro?",text:`¿Deseas eliminar la etiqueta "${o.name}"?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await s.deleteTag(o.id)?(p.value=p.value.filter(u=>u.id!==o.id),await _("Etiqueta eliminada exitosamente","success")):await _("Error al eliminar la etiqueta","error")}catch(n){console.error("Error deleting tag:",n),await _("Error al eliminar la etiqueta","error")}},B=o=>{const a=p.value.findIndex(n=>n.id===o.id);a>=0?p.value.splice(a,1):p.value.push(o)},Z=o=>p.value.some(a=>a.id===o.id),I=o=>{const a=ie(o);return{backgroundColor:a.light,borderColor:a.dark,color:a.dark}},G={input:o=>o&&o.trim().length>0,text_area:o=>o&&o.trim().length>0,number:o=>!isNaN(parseFloat(o))&&isFinite(o),date:o=>{if(!o||!/^\d{4}-\d{2}-\d{2}$/.test(o))return!1;const n=new Date(o);return n instanceof Date&&!isNaN(n)},email:o=>o?/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(o):!1},K=(o,a)=>{const n=o.target.value;a.select_options_text=n,a.select_options=n?n.split(",").map(u=>u.trim()).filter(u=>u!==""):[]},L=()=>{var a;b.value=[];let o=!0;return(a=s.selectedDocument)==null||a.variables.forEach((n,u)=>{const e=[];if((!n.name_es||n.name_es.trim()==="")&&e.push("El nombre en pantalla es obligatorio."),n.value&&n.value.trim()!==""){const i=G[n.field_type];if(i&&!i(n.value))switch(n.field_type){case"number":e.push("El valor debe ser un número válido.");break;case"date":e.push("El valor debe ser una fecha válida en formato YYYY-MM-DD.");break;case"email":e.push("El valor debe ser un correo electrónico válido.");break;default:e.push("El valor no es válido para este tipo de campo.")}}n.field_type==="select"&&(!n.select_options||n.select_options.length===0)&&e.push("Debe ingresar al menos una opción para el selector."),e.length>0&&(b.value[u]=e.join(" "),o=!1)}),o||R.fire({title:"Campos incompletos",text:"Por favor, verifica los campos obligatorios y sus formatos.",icon:"warning"}),o},M=o=>{L()&&H(o)},H=async o=>{try{const a={title:s.selectedDocument.title,content:s.selectedDocument.content,state:o,variables:s.selectedDocument.variables.map(l=>({name_en:l.name_en,name_es:l.name_es,tooltip:l.tooltip||"",field_type:l.field_type,value:l.value,select_options:l.field_type==="select"?l.select_options:null})),tag_ids:p.value.map(l=>l.id)},n=s.selectedDocument.title,u=s.selectedDocument.content;let e,i;if(s.selectedDocument.id?(e=s.selectedDocument.id,i=await s.updateDocument(e,a)):(i=await s.createDocument(a),i&&i.id&&(e=i.id)),s.selectedDocument=null,await s.init(),!e){const l=s.documents.find(q=>q.title===n&&q.content===u&&q.state===o);l&&(e=l.id)}e&&(window.localStorage.setItem("lastUpdatedDocumentId",e.toString()),s.lastUpdatedDocumentId=e),await _(o==="Draft"?"Documento guardado como borrador":"Documento publicado exitosamente","success"),setTimeout(()=>{V.push("/dynamic_document_dashboard")},300)}catch(a){console.error("Error saving document:",a)}},J=()=>{V.push("/dynamic_document_dashboard")};return(o,a)=>{var n,u;return r(),c(x,null,[t("div",de,[t("div",ue,[t("h1",me,f((n=m(s).selectedDocument)==null?void 0:n.title),1),t("div",pe,[(r(!0),c(x,null,k(((u=m(s).selectedDocument)==null?void 0:u.variables)||[],(e,i)=>(r(),c("div",{key:i,class:"grid grid-cols-12 gap-4 items-center"},[t("h2",_e,f(e.name_en),1),t("div",fe,[t("label",{for:"name_es_"+i,class:"block text-sm font-medium leading-6 text-primary"},[E(" Nombre en pantalla "),he],8,ge),v(t("input",{type:"text","onUpdate:modelValue":l=>e.name_es=l,id:"name_es_"+i,class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,8,ye),[[C,e.name_es]]),b.value[i]?(r(),c("p",xe,f(b.value[i]),1)):g("",!0)]),t("div",ve,[be,v(t("input",{type:"text","onUpdate:modelValue":l=>e.tooltip=l,id:"tooltip",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",placeholder:"Opcional"},null,8,we),[[C,e.tooltip]])]),t("div",ke,[De,v(t("select",{"onUpdate:modelValue":l=>e.field_type=l,id:"field_type",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm"},Te,8,Ce),[[te,e.field_type]])]),e.field_type==="select"?(r(),c("div",qe,[Se,v(t("input",{type:"text","onUpdate:modelValue":l=>e.select_options_text=l,onInput:l=>K(l,e),class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",placeholder:"Opción 1, Opción 2, Opción 3"},null,40,Ne),[[C,e.select_options_text]])])):g("",!0)]))),128))]),$.value?(r(),c("div",Ve,[t("div",$e,[Ue,t("button",{onClick:O,type:"button",class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-secondary hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary"},[D(m(re),{class:"h-4 w-4 mr-2"}),E(" Nueva Etiqueta ")])]),t("div",Be,[m(s).tags&&m(s).tags.length>0?(r(),c("div",Ie,[Me,t("div",ze,[(r(!0),c(x,null,k(m(s).sortedTags,e=>(r(),c("div",{key:e.id,class:F(["inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border-2 cursor-pointer transition-all duration-200",{"ring-2 ring-secondary":Z(e),"hover:shadow-md":!0}]),style:N(I(e.color_id)),onClick:i=>B(e)},[t("span",Re,f(e.name),1),t("button",{onClick:S(i=>P(e),["stop"]),class:"ml-2 p-1 hover:bg-black hover:bg-opacity-10 rounded",title:"Editar etiqueta"},[D(m(ae),{class:"h-3 w-3"})],8,je),t("button",{onClick:S(i=>Y(e),["stop"]),class:"ml-1 p-1 hover:bg-red-500 hover:bg-opacity-20 rounded",title:"Eliminar etiqueta"},[D(m(ce),{class:"h-3 w-3"})],8,Ae)],14,Fe))),128))])])):g("",!0),p.value.length>0?(r(),c("div",Oe,[Pe,t("div",Ye,[(r(!0),c(x,null,k(p.value,e=>(r(),c("div",{key:e.id,class:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border-2 ring-2 ring-secondary",style:N(I(e.color_id))},[t("span",Ze,f(e.name),1),t("button",{onClick:i=>B(e),class:"ml-2 p-1 hover:bg-red-500 hover:bg-opacity-20 rounded",title:"Remover etiqueta"},[D(m(oe),{class:"h-3 w-3"})],8,Ge)],4))),128))])])):g("",!0),!m(s).tags||m(s).tags.length===0?(r(),c("div",Ke,Je)):g("",!0)])])):g("",!0),t("div",Qe,[t("button",{onClick:a[0]||(a[0]=e=>M("Draft")),class:"p-2.5 text-sm font-medium rounded-md bg-secondary text-white"}," Guardar como borrador "),t("button",{onClick:a[1]||(a[1]=e=>M("Published")),class:"p-2.5 text-sm font-medium rounded-md bg-gray-200 text-secondary border-2"}," Publicar "),t("button",{onClick:a[2]||(a[2]=e=>J()),type:"button",class:"p-2.5 text-sm font-medium rounded-md flex gap-2 bg-red-600/80 text-white cursor-pointer"}," Cancelar ")])])]),w.value?(r(),c("div",{key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onClick:T},[t("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",onClick:a[4]||(a[4]=S(()=>{},["stop"]))},[t("div",We,[t("h3",Xe,f(h.value?"Editar Etiqueta":"Nueva Etiqueta"),1),t("div",et,[tt,v(t("input",{id:"tag-name","onUpdate:modelValue":a[3]||(a[3]=e=>d.value.name=e),type:"text",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-secondary focus:ring-secondary sm:text-sm",placeholder:"Ingresa el nombre de la etiqueta",onKeydown:ee(U,["enter"])},null,544),[[C,d.value.name]])]),t("div",ot,[st,t("div",nt,[(r(!0),c(x,null,k(A.value,e=>(r(),c("div",{key:e.id,class:F(["w-8 h-8 rounded-full cursor-pointer border-2 transition-all duration-200",{"ring-2 ring-secondary":d.value.color_id===e.id,"border-gray-300":d.value.color_id!==e.id,"border-secondary":d.value.color_id===e.id}]),style:N({backgroundColor:e.hex}),onClick:i=>d.value.color_id=e.id,title:e.name},null,14,at))),128))])]),t("div",lt,[t("button",{onClick:T,type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"}," Cancelar "),t("button",{onClick:U,type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-secondary rounded-md hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary"},f(h.value?"Actualizar":"Crear"),1)])])])])):g("",!0)],64)}}};export{pt as default};
