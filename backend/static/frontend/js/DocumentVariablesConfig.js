import{e as u,f as m,g as e,I as Y,r as S,c as A,s as k,al as H,o as G,j as n,h as E,p as z,F as I,N as j,n as L,ac as F,t as q,m as O,l as C,G as J,w as $,v as B,aV as Q,u as W,S as P,x as K}from"./index.js";import{u as Z}from"./index2.js";import{a as X,g as ee,_ as te}from"./DocumentPermissionsManager.js";import{r as oe}from"./PlusIcon.js";import{r as se}from"./PencilIcon.js";import{r as ne}from"./TrashIcon.js";function ae(v,D){return u(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})])}function re(){const v=Z(),D=Y(),a=S([]),y=S(!1),g=S(!1),f=S({name:"",color_id:1}),w=A(()=>{var t;return((t=D.getCurrentUser)==null?void 0:t.role)==="lawyer"}),h=A(()=>X()),M=async t=>{w.value&&(await v.initTags(),t!=null&&t.tags&&t.tags.length>0?a.value=[...t.tags]:a.value=[])},U=()=>{f.value={name:"",color_id:1},g.value=!1,y.value=!0},V=t=>{f.value={...t},g.value=!0,y.value=!0},b=()=>{y.value=!1,f.value={name:"",color_id:1},g.value=!1};return{selectedTags:a,showTagModal:y,isEditingTag:g,currentTag:f,isLawyer:w,availableColors:h,initializeTags:M,openCreateTagModal:U,openEditTagModal:V,closeTagModal:b,saveTag:async()=>{if(!f.value.name.trim()){await k("El nombre de la etiqueta es requerido","error");return}try{g.value?(await v.updateTag(f.value.id,{name:f.value.name,color_id:f.value.color_id}),await k("Etiqueta actualizada exitosamente","success")):(await v.createTag({name:f.value.name,color_id:f.value.color_id}),await k("Etiqueta creada exitosamente","success")),b()}catch(t){console.error("Error saving tag:",t),await k("Error al guardar la etiqueta","error")}},deleteTag:async t=>{if((await H.fire({title:"¿Estás seguro?",text:`¿Deseas eliminar la etiqueta "${t.name}"?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await v.deleteTag(t.id)?(a.value=a.value.filter(p=>p.id!==t.id),await k("Etiqueta eliminada exitosamente","success")):await k("Error al eliminar la etiqueta","error")}catch(c){console.error("Error deleting tag:",c),await k("Error al eliminar la etiqueta","error")}},toggleTagSelection:t=>{const l=a.value.findIndex(c=>c.id===t.id);l>=0?a.value.splice(l,1):a.value.push(t)},isTagSelected:t=>a.value.some(l=>l.id===t.id),getTagColorStyles:t=>{const l=ee(t);return{backgroundColor:l.light,borderColor:l.dark,color:l.dark}},getTagIds:()=>a.value.map(t=>t.id)}}const ie={key:0,class:"mt-6"},le={class:"flex items-center justify-between mb-4"},ce=e("h3",{class:"text-lg font-medium text-primary"},"Etiquetas del Documento",-1),de={class:"space-y-3"},ue={key:0},me={class:"text-sm font-medium text-gray-700 mb-2 flex items-center gap-1"},pe=e("span",null,"Etiquetas Disponibles:",-1),fe={class:"inline-flex items-center text-gray-400 cursor-help",title:"Estas son las etiquetas disponibles para todos tus documentos. Haz clic en una etiqueta para agregarla o quitarla de este documento."},ge={class:"flex flex-wrap gap-2"},_e=["onClick"],ye={class:"mr-2"},he=["onClick"],xe=["onClick"],ve={key:1},we=e("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Etiquetas Seleccionadas:",-1),be={class:"flex flex-wrap gap-2"},ke={class:"mr-2"},Ce=["onClick"],De={key:2,class:"text-center py-6"},Te=e("p",{class:"text-gray-500"},"No hay etiquetas disponibles.",-1),$e=e("p",{class:"text-gray-400 text-sm mt-1"},"Crea la primera etiqueta para organizar tus documentos.",-1),Ee=[Te,$e],Se={class:"mt-3"},qe={class:"text-lg font-medium text-gray-900 mb-4"},Me={class:"mb-4"},Ue=e("label",{for:"tag-name",class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre de la etiqueta ",-1),Ve={class:"mb-6"},Ne=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Color de la etiqueta ",-1),Ie={class:"grid grid-cols-8 gap-2"},je=["onClick","title"],Be={class:"flex justify-end space-x-3"},ze={__name:"DocumentTagsManager",props:{document:{type:Object,default:null}},setup(v,{expose:D}){const a=v,y=Z(),{selectedTags:g,showTagModal:f,isEditingTag:w,currentTag:h,isLawyer:M,availableColors:U,initializeTags:V,openCreateTagModal:b,openEditTagModal:N,closeTagModal:T,saveTag:o,deleteTag:s,toggleTagSelection:i,isTagSelected:d,getTagColorStyles:t,getTagIds:l}=re();return G(async()=>{a.document&&await V(a.document)}),D({getTagIds:l}),(c,p)=>(u(),m(I,null,[n(M)?(u(),m("div",ie,[e("div",le,[ce,e("button",{onClick:p[0]||(p[0]=(...r)=>n(b)&&n(b)(...r)),type:"button",class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-secondary hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary"},[E(n(oe),{class:"h-4 w-4 mr-2"}),z(" Nueva Etiqueta ")])]),e("div",de,[n(y).tags&&n(y).tags.length>0?(u(),m("div",ue,[e("h4",me,[pe,e("span",fe,[E(n(ae),{class:"h-4 w-4"})])]),e("div",ge,[(u(!0),m(I,null,j(n(y).sortedTags,r=>(u(),m("div",{key:r.id,class:L(["inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border-2 cursor-pointer transition-all duration-200",{"ring-2 ring-secondary":n(d)(r),"hover:shadow-md":!0}]),style:F(n(t)(r.color_id)),onClick:x=>n(i)(r)},[e("span",ye,q(r.name),1),e("button",{onClick:O(x=>n(N)(r),["stop"]),class:"ml-2 p-1 hover:bg-black hover:bg-opacity-10 rounded",title:"Editar etiqueta"},[E(n(se),{class:"h-3 w-3"})],8,he),e("button",{onClick:O(x=>n(s)(r),["stop"]),class:"ml-1 p-1 hover:bg-red-500 hover:bg-opacity-20 rounded",title:"Eliminar etiqueta"},[E(n(ne),{class:"h-3 w-3"})],8,xe)],14,_e))),128))])])):C("",!0),n(g).length>0?(u(),m("div",ve,[we,e("div",be,[(u(!0),m(I,null,j(n(g),r=>(u(),m("div",{key:r.id,class:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border-2 ring-2 ring-secondary",style:F(n(t)(r.color_id))},[e("span",ke,q(r.name),1),e("button",{onClick:x=>n(i)(r),class:"ml-2 p-1 hover:bg-red-500 hover:bg-opacity-20 rounded",title:"Remover etiqueta"},[E(n(J),{class:"h-3 w-3"})],8,Ce)],4))),128))])])):C("",!0),!n(y).tags||n(y).tags.length===0?(u(),m("div",De,Ee)):C("",!0)])])):C("",!0),n(f)?(u(),m("div",{key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onClick:p[6]||(p[6]=(...r)=>n(T)&&n(T)(...r))},[e("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",onClick:p[5]||(p[5]=O(()=>{},["stop"]))},[e("div",Se,[e("h3",qe,q(n(w)?"Editar Etiqueta":"Nueva Etiqueta"),1),e("div",Me,[Ue,$(e("input",{id:"tag-name","onUpdate:modelValue":p[1]||(p[1]=r=>n(h).name=r),type:"text",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-secondary focus:ring-secondary sm:text-sm",placeholder:"Ingresa el nombre de la etiqueta",onKeydown:p[2]||(p[2]=Q((...r)=>n(o)&&n(o)(...r),["enter"]))},null,544),[[B,n(h).name]])]),e("div",Ve,[Ne,e("div",Ie,[(u(!0),m(I,null,j(n(U),r=>(u(),m("div",{key:r.id,class:L(["w-8 h-8 rounded-full cursor-pointer border-2 transition-all duration-200",{"ring-2 ring-secondary":n(h).color_id===r.id,"border-gray-300":n(h).color_id!==r.id,"border-secondary":n(h).color_id===r.id}]),style:F({backgroundColor:r.hex}),onClick:x=>n(h).color_id=r.id,title:r.name},null,14,je))),128))])]),e("div",Be,[e("button",{onClick:p[3]||(p[3]=(...r)=>n(T)&&n(T)(...r)),type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"}," Cancelar "),e("button",{onClick:p[4]||(p[4]=(...r)=>n(o)&&n(o)(...r)),type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-secondary rounded-md hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary"},q(n(w)?"Actualizar":"Crear"),1)])])])])):C("",!0)],64))}},Re={class:"pb-10 px-4 sm:px-6 lg:px-8 lg:pt-10"},Fe={class:"w-full p-5 rounded-lg border-2 border-stroke bg-terciary"},Oe={class:"text-primary text-xl font-semibold"},Pe={class:"mt-4 space-y-4"},Ae={class:"text-primary text-lg font-semibold col-span-12"},Ze={class:"col-span-4"},Le=["for"],Ye=e("span",{class:"text-red-500"},"*",-1),He=["onUpdate:modelValue","id"],Ge={key:0,class:"text-red-500 text-sm mt-1"},Ke={class:"col-span-4"},Je=e("label",{for:"tooltip",class:"block text-sm font-medium leading-6 text-primary"}," Tooltip ",-1),Qe=["onUpdate:modelValue"],We={class:"col-span-4"},Xe=e("label",{for:"field_type",class:"block text-sm font-medium leading-6 text-primary"},[z(" Tipo de input "),e("span",{class:"text-red-500"},"*")],-1),et=["onUpdate:modelValue"],tt=K('<option value="input">Texto simple</option><option value="text_area">Texto largo</option><option value="number">Número</option><option value="date">Fecha</option><option value="email">Correo electrónico</option><option value="select">Selector</option>',6),ot=[tt],st={class:"col-span-4"},nt=["for"],at=["onUpdate:modelValue","id","onChange"],rt=K('<option value="none">Sin clasificar</option><option value="counterparty">Usuario / Contraparte</option><option value="object">Objeto</option><option value="value">Valor</option><option value="term">Plazo</option><option value="subscription_date">Fecha suscripción</option><option value="start_date">Fecha inicio</option><option value="end_date">Fecha fin</option>',8),it=[rt],lt={key:0,class:"col-span-4"},ct=["for"],dt=["onUpdate:modelValue","id"],ut=e("option",{value:""},"Sin moneda",-1),mt=e("option",{value:"COP"},"COP",-1),pt=e("option",{value:"USD"},"USD",-1),ft=e("option",{value:"EUR"},"EUR",-1),gt=[ut,mt,pt,ft],_t={key:1,class:"col-span-12 mt-2"},yt=e("label",{class:"block text-sm font-medium leading-6 text-primary"},[z(" Opciones del selector (separadas por coma) "),e("span",{class:"text-red-500"},"*")],-1),ht=["onUpdate:modelValue","onInput"],xt={class:"flex flex-col sm:flex-row gap-3 sm:gap-4 mt-6 pt-6 border-t border-gray-200"},vt=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})],-1),wt=e("span",null,"Guardar como borrador",-1),bt=[vt,wt],kt=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),Ct=e("span",null,"Publicar",-1),Dt=[kt,Ct],Tt=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),$t=e("span",null,"Cancelar",-1),Et=[Tt,$t],It={__name:"DocumentVariablesConfig",setup(v){const D=W(),a=Z(),y=Y(),g=S([]),f=S(null),w=S(null);A(()=>{var o;return((o=y.getCurrentUser)==null?void 0:o.role)==="lawyer"}),G(async()=>{var o;if(!a.selectedDocument){console.error("No selected document found");return}if(a.selectedDocument.id&&(!a.selectedDocument.tags||a.selectedDocument.tags.length===0))try{const s=await a.fetchDocumentById(a.selectedDocument.id,!0);a.selectedDocument=s}catch(s){console.error("Error fetching full document:",s)}(o=a.selectedDocument)!=null&&o.variables&&a.selectedDocument.variables.forEach(s=>{s.field_type==="select"&&(s.select_options||(s.select_options=[]),s.select_options_text=s.select_options.join(", ")),s.summary_field||(s.summary_field="none"),s.summary_field!=="value"&&(s.currency=s.currency||null)})});const h={input:o=>o&&o.trim().length>0,text_area:o=>o&&o.trim().length>0,number:o=>!isNaN(parseFloat(o))&&isFinite(o),date:o=>{if(!o||!/^\d{4}-\d{2}-\d{2}$/.test(o))return!1;const i=new Date(o);return i instanceof Date&&!isNaN(i)},email:o=>o?/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(o):!1},M=(o,s)=>{const i=o.target.value;s.select_options_text=i,s.select_options=i?i.split(",").map(d=>d.trim()).filter(d=>d!==""):[]},U=o=>{var i;if(!((i=a.selectedDocument)!=null&&i.variables))return;const s=o.summary_field||"none";s&&s!=="none"&&a.selectedDocument.variables.forEach(d=>{d!==o&&d.summary_field===s&&(d.summary_field="none")}),s==="value"&&o.field_type!=="number"&&(o.field_type="number"),(s==="subscription_date"||s==="start_date"||s==="end_date")&&o.field_type!=="date"&&(o.field_type="date"),s!=="value"&&(o.currency=null)},V=()=>{var s;g.value=[];let o=!0;return(s=a.selectedDocument)==null||s.variables.forEach((i,d)=>{const t=[];if((!i.name_es||i.name_es.trim()==="")&&t.push("El nombre en pantalla es obligatorio."),i.value&&i.value.trim()!==""){const l=h[i.field_type];if(l&&!l(i.value))switch(i.field_type){case"number":t.push("El valor debe ser un número válido.");break;case"date":t.push("El valor debe ser una fecha válida en formato YYYY-MM-DD.");break;case"email":t.push("El valor debe ser un correo electrónico válido.");break;default:t.push("El valor no es válido para este tipo de campo.")}}i.field_type==="select"&&(!i.select_options||i.select_options.length===0)&&t.push("Debe ingresar al menos una opción para el selector."),t.length>0&&(g.value[d]=t.join(" "),o=!1)}),o||H.fire({title:"Campos incompletos",text:"Por favor, verifica los campos obligatorios y sus formatos.",icon:"warning"}),o},b=o=>{if(o==="Draft"){N(o);return}V()&&N(o)},N=async o=>{var s,i;try{const d=((s=f.value)==null?void 0:s.getPermissionsData())||{},t=((i=w.value)==null?void 0:i.getTagIds())||[],l={title:a.selectedDocument.title,content:a.selectedDocument.content,state:o,variables:a.selectedDocument.variables.map(_=>({name_en:_.name_en,name_es:_.name_es,tooltip:_.tooltip||"",field_type:_.field_type,value:_.value,select_options:_.field_type==="select"?_.select_options:null,summary_field:_.summary_field||"none",currency:_.summary_field==="value"&&_.currency||null})),tag_ids:t,...d},c=a.selectedDocument.title,p=a.selectedDocument.content;let r,x;if(a.selectedDocument.id?(r=a.selectedDocument.id,x=await a.updateDocument(r,l)):(x=await a.createDocument(l),x&&x.id&&(r=x.id)),a.selectedDocument=null,await a.init(),!r){const _=a.documents.find(R=>R.title===c&&R.content===p&&R.state===o);_&&(r=_.id)}r&&(window.localStorage.setItem("lastUpdatedDocumentId",r.toString()),a.lastUpdatedDocumentId=r),await k(o==="Draft"?"Documento guardado como borrador":"Documento publicado exitosamente","success"),setTimeout(()=>{D.push("/dynamic_document_dashboard")},300)}catch(d){console.error("Error saving document:",d)}},T=()=>{D.push("/dynamic_document_dashboard")};return(o,s)=>{var i,d;return u(),m("div",Re,[e("div",Fe,[e("h1",Oe,q((i=n(a).selectedDocument)==null?void 0:i.title),1),e("div",Pe,[(u(!0),m(I,null,j(((d=n(a).selectedDocument)==null?void 0:d.variables)||[],(t,l)=>(u(),m("div",{key:l,class:"grid grid-cols-12 gap-4 items-center"},[e("h2",Ae,q(t.name_en),1),e("div",Ze,[e("label",{for:"name_es_"+l,class:"block text-sm font-medium leading-6 text-primary"},[z(" Nombre en pantalla "),Ye],8,Le),$(e("input",{type:"text","onUpdate:modelValue":c=>t.name_es=c,id:"name_es_"+l,class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,8,He),[[B,t.name_es]]),g.value[l]?(u(),m("p",Ge,q(g.value[l]),1)):C("",!0)]),e("div",Ke,[Je,$(e("input",{type:"text","onUpdate:modelValue":c=>t.tooltip=c,id:"tooltip",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",placeholder:"Opcional"},null,8,Qe),[[B,t.tooltip]])]),e("div",We,[Xe,$(e("select",{"onUpdate:modelValue":c=>t.field_type=c,id:"field_type",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm"},ot,8,et),[[P,t.field_type]])]),e("div",st,[e("label",{for:"summary_field_"+l,class:"block text-sm font-medium leading-6 text-primary"}," Clasificar ",8,nt),$(e("select",{"onUpdate:modelValue":c=>t.summary_field=c,id:"summary_field_"+l,class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",onChange:()=>U(t)},it,40,at),[[P,t.summary_field]])]),t.summary_field==="value"?(u(),m("div",lt,[e("label",{for:"currency_"+l,class:"block text-sm font-medium leading-6 text-primary"}," Moneda ",8,ct),$(e("select",{"onUpdate:modelValue":c=>t.currency=c,id:"currency_"+l,class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300"},gt,8,dt),[[P,t.currency]])])):C("",!0),t.field_type==="select"?(u(),m("div",_t,[yt,$(e("input",{type:"text","onUpdate:modelValue":c=>t.select_options_text=c,onInput:c=>M(c,t),class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",placeholder:"Opción 1, Opción 2, Opción 3"},null,40,ht),[[B,t.select_options_text]])])):C("",!0)]))),128))]),E(ze,{ref_key:"tagsManagerRef",ref:w,document:n(a).selectedDocument},null,8,["document"]),E(te,{ref_key:"permissionsManagerRef",ref:f,document:n(a).selectedDocument},null,8,["document"]),e("div",xt,[e("button",{onClick:s[0]||(s[0]=t=>b("Draft")),type:"button",class:"inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200"},bt),e("button",{onClick:s[1]||(s[1]=t=>b("Published")),type:"button",class:"inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm bg-green-600 text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all duration-200"},Dt),e("button",{onClick:s[2]||(s[2]=t=>T()),type:"button",class:"inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg shadow-sm bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200 sm:ml-auto"},Et)])])])}}};export{It as default};
