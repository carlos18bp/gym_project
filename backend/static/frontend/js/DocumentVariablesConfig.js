import{u as N,r as E,o as S,e as d,f as r,g as n,t as _,l as y,F as U,H as C,s as T,m as g,w as p,v as f,i as D,O as F,ah as I,q as O}from"./index.js";import{u as R}from"./dynamicDocument.js";const M={class:"pb-10 px-4 sm:px-6 lg:px-8 lg:pt-10"},$={class:"w-full p-5 rounded-lg border-2 border-stroke bg-terciary"},A={class:"text-primary text-xl font-semibold"},B={class:"mt-4 space-y-4"},Y={class:"text-primary text-lg font-semibold col-span-12"},z={class:"col-span-4"},P=["for"],Z=n("span",{class:"text-red-500"},"*",-1),j=["onUpdate:modelValue","id"],q={key:0,class:"text-red-500 text-sm mt-1"},G={class:"col-span-4"},H=n("label",{for:"tooltip",class:"block text-sm font-medium leading-6 text-primary"}," Tooltip ",-1),L=["onUpdate:modelValue"],J={class:"col-span-4"},K=n("label",{for:"field_type",class:"block text-sm font-medium leading-6 text-primary"},[g(" Tipo de input "),n("span",{class:"text-red-500"},"*")],-1),Q=["onUpdate:modelValue"],W=O('<option value="input">Texto simple</option><option value="text_area">Texto largo</option><option value="number">Número</option><option value="date">Fecha</option><option value="email">Correo electrónico</option><option value="select">Selector</option>',6),X=[W],ee={key:0,class:"col-span-12 mt-2"},te=n("label",{class:"block text-sm font-medium leading-6 text-primary"},[g(" Opciones del selector (separadas por coma) "),n("span",{class:"text-red-500"},"*")],-1),oe=["onUpdate:modelValue","onInput"],se={class:"mt-6 flex space-x-4"},ae={__name:"DocumentVariablesConfig",setup(ne){const h=N(),i=R(),m=E([]);S(()=>{var t;i.selectedDocument||console.error("No selected document found"),(t=i.selectedDocument)!=null&&t.variables&&i.selectedDocument.variables.forEach(o=>{o.field_type==="select"&&(o.select_options||(o.select_options=[]),o.select_options_text=o.select_options.join(", "))})});const b={input:t=>t&&t.trim().length>0,text_area:t=>t&&t.trim().length>0,number:t=>!isNaN(parseFloat(t))&&isFinite(t),date:t=>{if(!t||!/^\d{4}-\d{2}-\d{2}$/.test(t))return!1;const s=new Date(t);return s instanceof Date&&!isNaN(s)},email:t=>t?/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t):!1},w=(t,o)=>{const s=t.target.value;o.select_options_text=s,o.select_options=s?s.split(",").map(c=>c.trim()).filter(c=>c!==""):[]},k=()=>{var o;m.value=[];let t=!0;return(o=i.selectedDocument)==null||o.variables.forEach((s,c)=>{const e=[];if((!s.name_es||s.name_es.trim()==="")&&e.push("El nombre en pantalla es obligatorio."),s.value&&s.value.trim()!==""){const a=b[s.field_type];if(a&&!a(s.value))switch(s.field_type){case"number":e.push("El valor debe ser un número válido.");break;case"date":e.push("El valor debe ser una fecha válida en formato YYYY-MM-DD.");break;case"email":e.push("El valor debe ser un correo electrónico válido.");break;default:e.push("El valor no es válido para este tipo de campo.")}}s.field_type==="select"&&(!s.select_options||s.select_options.length===0)&&e.push("Debe ingresar al menos una opción para el selector."),e.length>0&&(m.value[c]=e.join(" "),t=!1)}),t||I.fire({title:"Campos incompletos",text:"Por favor, verifica los campos obligatorios y sus formatos.",icon:"warning"}),t},x=t=>{k()&&v(t)},v=async t=>{try{const o={title:i.selectedDocument.title,content:i.selectedDocument.content,state:t,variables:i.selectedDocument.variables.map(l=>({name_en:l.name_en,name_es:l.name_es,tooltip:l.tooltip||"",field_type:l.field_type,value:l.value,select_options:l.field_type==="select"?l.select_options:null}))},s=i.selectedDocument.title,c=i.selectedDocument.content;let e,a;if(i.selectedDocument.id?(e=i.selectedDocument.id,a=await i.updateDocument(e,o)):(a=await i.createDocument(o),a&&a.id&&(e=a.id)),i.selectedDocument=null,await i.init(),!e){const l=i.documents.find(u=>u.title===s&&u.content===c&&u.state===t);l&&(e=l.id)}e&&(window.localStorage.setItem("lastUpdatedDocumentId",e.toString()),i.lastUpdatedDocumentId=e),await T(t==="Draft"?"Documento guardado como borrador":"Documento publicado exitosamente","success"),setTimeout(()=>{h.push("/dynamic_document_dashboard")},300)}catch(o){console.error("Error saving document:",o)}},V=()=>{h.push("/dynamic_document_dashboard")};return(t,o)=>{var s,c;return d(),r("div",M,[n("div",$,[n("h1",A,_((s=y(i).selectedDocument)==null?void 0:s.title),1),n("div",B,[(d(!0),r(U,null,C(((c=y(i).selectedDocument)==null?void 0:c.variables)||[],(e,a)=>(d(),r("div",{key:a,class:"grid grid-cols-12 gap-4 items-center"},[n("h2",Y,_(e.name_en),1),n("div",z,[n("label",{for:"name_es_"+a,class:"block text-sm font-medium leading-6 text-primary"},[g(" Nombre en pantalla "),Z],8,P),p(n("input",{type:"text","onUpdate:modelValue":l=>e.name_es=l,id:"name_es_"+a,class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,8,j),[[f,e.name_es]]),m.value[a]?(d(),r("p",q,_(m.value[a]),1)):D("",!0)]),n("div",G,[H,p(n("input",{type:"text","onUpdate:modelValue":l=>e.tooltip=l,id:"tooltip",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",placeholder:"Opcional"},null,8,L),[[f,e.tooltip]])]),n("div",J,[K,p(n("select",{"onUpdate:modelValue":l=>e.field_type=l,id:"field_type",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm"},X,8,Q),[[F,e.field_type]])]),e.field_type==="select"?(d(),r("div",ee,[te,p(n("input",{type:"text","onUpdate:modelValue":l=>e.select_options_text=l,onInput:l=>w(l,e),class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",placeholder:"Opción 1, Opción 2, Opción 3"},null,40,oe),[[f,e.select_options_text]])])):D("",!0)]))),128))]),n("div",se,[n("button",{onClick:o[0]||(o[0]=e=>x("Draft")),class:"p-2.5 text-sm font-medium rounded-md bg-secondary text-white"}," Guardar como borrador "),n("button",{onClick:o[1]||(o[1]=e=>x("Published")),class:"p-2.5 text-sm font-medium rounded-md bg-gray-200 text-secondary border-2"}," Publicar "),n("button",{onClick:o[2]||(o[2]=e=>V()),type:"button",class:"p-2.5 text-sm font-medium rounded-md flex gap-2 bg-red-600/80 text-white cursor-pointer"}," Cancelar ")])])])}}};export{ae as default};
