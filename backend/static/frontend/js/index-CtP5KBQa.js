import{e as a,f as u,g as e,r as O,s as v,D as fe,S as tt,c as N,V as me,o as We,as as Le,w as pe,T as Ne,k as A,i as Z,m as ee,t as $,h as F,j as i,A as de,ai as Re,p as R,l as j,F as K,I as se,a4 as qe,P as Oe,Q as je,ae as Ge,b7 as $e,af as Ve,n as G,ag as De,ah as He,u as Ie,ab as ie,a7 as Ze,ad as st,aK as at,v as ze,b as rt,C as Ee,H as Qe,an as Ce,ao as Se,b9 as ot}from"./index-BROrgVaC.js";import{g as Te,u as nt,_ as lt}from"./DocumentPermissionsManager-BF_9sj_Q.js";import{useRecentViews as it}from"./useRecentViews-Dqtww0kV.js";import{u as he,o as Ye,d as dt}from"./index-DD7IbEzR.js";import{a as ct}from"./DocumentRelationshipsModal-CAdaHpvt.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as Ue}from"./TrashIcon-DyZxV_p1.js";import{r as ue}from"./DocumentIcon-C7Y5428u.js";import{r as Ke}from"./PhotoIcon-3-nF9FKJ.js";import{r as Be}from"./LinkIcon-DdDRh74t.js";import{r as Pe}from"./CheckCircleIcon-CmyiFrWB.js";import{r as Me}from"./CloudArrowUpIcon-CnTi9Fz2.js";import{r as ut}from"./ExclamationTriangleIcon-Eb0O5_Hn.js";import{r as Xe}from"./EllipsisVerticalIcon-CczxQbp9.js";import{r as mt}from"./ChevronRightIcon-DYnoKygb.js";import{r as pt}from"./PencilIcon-YGP1YVK5.js";import{s as gt,h as Ae}from"./loading_message-zJHSeb-D.js";function Fe(o,C){return a(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"})])}function ft(){const o=O(!1),C=O("");async function r(n,k,f="",t="",x=[],b={}){if(!k)throw C.value="Recipient email is required.",await v(C.value,"error"),new Error(C.value);const S=new FormData;S.append("to_email",k),S.append("subject",f),S.append("body",t),x.forEach((w,p)=>{S.append(`attachments[${p}]`,w)});for(const[w,p]of Object.entries(b))S.append(w,p);try{o.value=!0,C.value="",gt("Sending email...","Please wait while we send the email.");const w=await fe(n,S);return Ae(),await v("Email sent successfully.","success"),w.data}catch(w){throw Ae(),console.error("Error sending email:",w.message),C.value="An error occurred while sending the email. Please try again.",await v(C.value,"error"),w}finally{o.value=!1}}return{sendEmail:r,isLoading:o,errorMessage:C}}function te(o){return tt.fire({title:o,icon:"question",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",buttonsStyling:!1}).then(C=>C.isConfirmed)}const q=o=>(Oe("data-v-a8accb3a"),o=o(),je(),o),ht={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},bt={class:"px-6 py-4 border-b border-gray-200"},vt=q(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Gesti√≥n de Membrete",-1)),yt={class:"text-sm text-gray-500 mt-1"},xt={class:"p-6 overflow-y-auto flex-grow"},wt={key:0,class:"text-center py-10"},_t=q(()=>e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),kt={class:"mt-4 text-gray-500"},$t={key:1,class:"space-y-6"},Dt={key:0,class:"space-y-4"},Et=q(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Membrete Actual",-1)),Ct={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},St=["src"],Pt={class:"mt-4 flex justify-center space-x-3"},Mt=["disabled"],Ft={key:1,class:"text-center py-8"},Ot=q(()=>e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Sin Membrete",-1)),jt=q(()=>e("p",{class:"mt-1 text-sm text-gray-500"}," Este documento no tiene una imagen de membrete configurada. ",-1)),It={class:"space-y-4"},zt={class:"text-lg font-medium text-gray-900"},Rt={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},Tt={key:0},Ut={class:"mt-4"},Bt=q(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos PNG, m√°ximo 10MB. Se usa √∫nicamente para los PDF. ",-1)),At=q(()=>e("p",{class:"text-xs text-gray-400 mt-1"},' Dimensiones ideales: 2550 √ó 3300 p√≠xeles (tama√±o carta, 8.5" √ó 11" a 300 DPI) ',-1)),Wt={key:1,class:"space-y-4"},Lt={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},Nt={class:"text-gray-400"},qt={key:0,class:"mt-4"},Gt=["src"],Vt={class:"flex justify-center space-x-3"},Ht=["disabled"],Zt={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},Qt={class:"space-y-4 border-t border-gray-200 pt-6"},Yt=q(()=>e("h3",{class:"text-lg font-medium text-gray-900"},"Plantilla Word espec√≠fica de este documento (.docx)",-1)),Kt=q(()=>e("p",{class:"text-sm text-gray-500"},[R(" Esta plantilla se usar√° al descargar "),e("strong",null,"este documento"),R(" en Word. Si no est√° configurada, se usar√° la plantilla Word global (Membrete Global) si existe. ")],-1)),Xt={key:0,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Jt={class:"text-sm text-gray-700"},es=q(()=>e("div",{class:"font-medium"},"Plantilla actual:",-1)),ts={class:"mt-1 break-words"},ss={class:"font-mono break-all"},as={key:0,class:"text-gray-400 ml-2"},rs={class:"mt-3 flex flex-wrap gap-3"},os=["disabled"],ns={key:1,class:"text-sm text-gray-500"},ls={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"},is={key:0},ds={class:"mt-4"},cs=q(()=>e("p",{class:"mt-2 text-sm text-gray-500"}," Solo archivos .docx, m√°ximo 10MB. ",-1)),us={key:1,class:"space-y-4"},ms={class:"flex items-center justify-center space-x-2 text-sm text-gray-600"},ps={class:"text-gray-400"},gs={class:"flex justify-center space-x-3"},fs=["disabled"],hs={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},bs={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-6 space-y-6"},vs={class:"flex items-center space-x-2"},ys=q(()=>e("h3",{class:"text-lg font-semibold text-blue-900"},"Especificaciones del Membrete para PDF",-1)),xs=q(()=>e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-yellow-800 mb-2"},"üîÑ Prioridad de Membrete"),e("div",{class:"text-sm text-yellow-700 space-y-1"},[e("div",null,[e("strong",null,"1¬∫ Prioridad:"),R(" Membrete espec√≠fico del documento (este)")]),e("div",null,[e("strong",null,"2¬∫ Prioridad:"),R(" Membrete global de imagen para PDF del usuario")]),e("div",null,[e("strong",null,"3¬∫ Prioridad:"),R(" Sin membrete")])])],-1)),ws=q(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"üìê Dimensiones Exactas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"grid grid-cols-2 gap-4 text-sm"},[e("div",null,[e("span",{class:"font-medium text-gray-700"},"Ancho:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"2550 p√≠xeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Alto:"),e("span",{class:"ml-2 text-blue-600 font-mono"},"3300 p√≠xeles")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Proporci√≥n:"),e("span",{class:"ml-2 text-blue-600"},"8.5:11 (Carta, 300 DPI)")]),e("div",null,[e("span",{class:"font-medium text-gray-700"},"Tolerancia:"),e("span",{class:"ml-2 text-orange-600"},"¬±10%")])])])],-1)),_s=q(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"üé® Distribuci√≥n Recomendada"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-4"},[e("div",{class:"mx-auto w-40 h-44 border-2 border-gray-300 rounded bg-gradient-to-b from-blue-100 via-yellow-50 to-green-100 relative text-xs"},[e("div",{class:"absolute top-0 left-0 right-0 h-12 bg-blue-200 bg-opacity-70 border-b border-blue-300 flex items-center justify-center text-blue-800 font-medium"}," HEADER ZONE "),e("div",{class:"absolute top-10 left-1 text-blue-700 text-[10px]"},"120-150px"),e("div",{class:"absolute top-12 left-0 right-0 bottom-12 bg-yellow-100 bg-opacity-50 border-y border-yellow-300 flex items-center justify-center text-yellow-800 font-medium"},[e("div",{class:"text-center"},[e("div",null,"BODY ZONE"),e("div",{class:"text-[10px] mt-1"},"‚ö†Ô∏è ZONA CR√çTICA")])]),e("div",{class:"absolute top-20 left-1 text-yellow-700 text-[10px]"},"300-400px"),e("div",{class:"absolute bottom-0 left-0 right-0 h-12 bg-green-200 bg-opacity-70 border-t border-green-300 flex items-center justify-center text-green-800 font-medium"}," FOOTER ZONE "),e("div",{class:"absolute bottom-10 left-1 text-green-700 text-[10px]"},"80-120px")]),e("div",{class:"space-y-3 text-sm"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-blue-200 border border-blue-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-blue-800"},"Header (Superior):"),e("span",{class:"text-gray-600 ml-1"},"Logos, nombre de empresa. Puede tener mayor intensidad visual.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-yellow-800"},"Body (Centro):"),e("span",{class:"text-gray-600 ml-1"},"Mant√©n semi-transparente. El texto del documento se superpone aqu√≠.")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-4 h-4 bg-green-200 border border-green-300 rounded mt-0.5 flex-shrink-0"}),e("div",null,[e("span",{class:"font-medium text-green-800"},"Footer (Inferior):"),e("span",{class:"text-gray-600 ml-1"},"Direcciones, tel√©fonos, emails, informaci√≥n de contacto.")])])])])])],-1)),ks=q(()=>e("div",{class:"space-y-3"},[e("h4",{class:"font-medium text-gray-900"},"üîß Consideraciones T√©cnicas"),e("div",{class:"bg-white rounded-lg p-4 border border-blue-200"},[e("div",{class:"space-y-2 text-sm text-gray-700"},[e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"‚Ä¢"),e("span",null,[e("strong",null,"Posicionamiento:"),R(" La imagen se centra autom√°ticamente en el documento")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"‚Ä¢"),e("span",null,[e("strong",null,"Transparencia:"),R(" Usa PNG con canal alpha para efectos de transparencia")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"‚Ä¢"),e("span",null,[e("strong",null,"M√°rgenes:"),R(" Deja 30-50px de margen en los lados para seguridad")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-blue-600 font-medium"},"‚Ä¢"),e("span",null,[e("strong",null,"Resoluci√≥n:"),R(" 72-150 DPI es suficiente para documentos digitales")])]),e("div",{class:"flex items-start space-x-2"},[e("span",{class:"text-orange-600 font-medium"},"‚ö†Ô∏è"),e("span",null,[e("strong",null,"Zona cr√≠tica:"),R(" Evita elementos gr√°ficos densos en el centro (300-400px de altura)")])])])])],-1)),$s=q(()=>e("div",{class:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4"},[e("h4",{class:"font-medium text-green-800 mb-2"},"üí° Tips de Dise√±o R√°pido"),e("div",{class:"text-sm text-green-700 space-y-1"},[e("div",null,"‚Ä¢ Si solo tienes header, ub√≠calo en los primeros 120-150px"),e("div",null,"‚Ä¢ El resto de la imagen debe ser transparente o blanco"),e("div",null,"‚Ä¢ Para footer, usa los √∫ltimos 80-120px"),e("div",null,"‚Ä¢ El texto se superpone en toda la imagen, mant√©n el centro claro")])],-1)),Ds={key:3,class:"space-y-2"},Es={class:"flex"},Cs={class:"text-sm text-yellow-700"},Ss={__name:"LetterheadModal",props:{isVisible:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close","uploaded","deleted"],setup(o,{emit:C}){const r=o,n=C,k=he(),f=O(!1),t=O(""),x=O(!1),b=O(!1),S=O(null),w=O(null),p=O(null),P=O([]),W=O(null),V=O(!1),m=O(null),h=O(!1),d=O(null),M=O(""),y=O(null),s=O(!1),E=O(!1),T=O(null),I=N(()=>{var g;return(g=r.document)==null?void 0:g.id}),B=()=>{ne(),n("close")},L=g=>{const _=g.target.files[0];if(_){if(!_.name.toLowerCase().endsWith(".docx")){alert("Solo se permiten archivos .docx para la plantilla Word");return}if(_.size>10*1024*1024){alert("El archivo de plantilla no puede ser mayor a 10MB");return}m.value=_}},ce=()=>{m.value=null,T.value&&(T.value.value="")},X=async()=>{var g;if(!(!m.value||!I.value)){s.value=!0;try{const U=(g=(await k.uploadDocumentLetterheadWordTemplate(I.value,m.value)).data)==null?void 0:g.template_info;h.value=!0,M.value=(U==null?void 0:U.filename)||m.value.name,y.value=(U==null?void 0:U.size_bytes)||m.value.size,await oe(),ce()}catch(_){console.error("Error uploading document Word template:",_),alert("Error al subir la plantilla Word. Por favor intenta nuevamente.")}finally{s.value=!1}}},oe=async()=>{var g,_;if(I.value)try{const U=await k.getDocumentLetterheadWordTemplate(I.value,"blob");if(!U){h.value=!1,d.value&&URL.revokeObjectURL(d.value),d.value=null,M.value="",y.value=null;return}if(U&&U.data){h.value=!0,d.value&&URL.revokeObjectURL(d.value),d.value=URL.createObjectURL(U.data);const H=((g=U.headers)==null?void 0:g["content-disposition"])||((_=U.headers)==null?void 0:_["Content-Disposition"]);let Y="plantilla_word.docx";if(H){const re=H.match(/filename="?([^";]+)"?/i);re&&re[1]&&(Y=re[1])}M.value=Y,y.value=U.data.size||null}}catch(U){console.error("Error loading document Word template:",U)}},ve=async()=>{await te("¬øEst√°s seguro de que deseas eliminar la plantilla Word de membrete de este documento?")&&ge()},ge=async()=>{if(I.value){E.value=!0;try{await k.deleteDocumentLetterheadWordTemplate(I.value),d.value&&URL.revokeObjectURL(d.value),d.value=null,M.value="",y.value=null,h.value=!1}catch(g){console.error("Error deleting document Word template:",g),alert("Error al eliminar la plantilla Word. Por favor intenta nuevamente.")}finally{E.value=!1}}},ye=()=>{if(d.value){const g=document.createElement("a");g.href=d.value,g.download=M.value||"membrete-word.docx",document.body.appendChild(g),g.click(),document.body.removeChild(g)}},xe=g=>{const _=g.target.files[0];if(!_)return;if(!_.type.includes("png")){alert("Solo se permiten archivos PNG");return}if(_.size>10*1024*1024){alert("El archivo no puede ser mayor a 10MB");return}S.value=_,P.value=[];const U=new FileReader;U.onload=H=>{w.value=H.target.result;const Y=new Image;Y.onload=()=>{we(Y.width,Y.height)},Y.src=H.target.result},U.readAsDataURL(_)},we=(g,_)=>{const re=g/_,ke=2550/3300,et=Math.abs(re-ke)/ke;if(g===2550&&_===3300){P.value.push("‚úÖ Dimensiones perfectas: 2550 √ó 3300 p√≠xeles");return}et<=.1?(P.value.push(`‚ÑπÔ∏è Buenas proporciones detectadas: ${g} √ó ${_} p√≠xeles (${re.toFixed(3)})`),(g!==2550||_!==3300)&&P.value.push('üí° Para mejores resultados, usa exactamente 2550 √ó 3300 p√≠xeles (tama√±o carta, 8.5" √ó 11" a 300 DPI)')):(P.value.push(`‚ö†Ô∏è Proporciones no ideales: ${g} √ó ${_} p√≠xeles (${re.toFixed(3)})`),P.value.push(`üéØ Proporciones recomendadas: ${ke.toFixed(3)} (8.5:11, tama√±o carta)`),P.value.push("üìê Considera redimensionar tu imagen a 2550 √ó 3300 p√≠xeles (tama√±o carta)")),(g<1200||_<1600)&&P.value.push("‚ö†Ô∏è Imagen muy peque√±a - puede verse pixelada en documentos PDF tama√±o carta"),(g>4e3||_>5e3)&&P.value.push("‚ÑπÔ∏è Imagen muy grande - se redimensionar√° autom√°ticamente para ajustarse al tama√±o carta")},ne=()=>{S.value=null,w.value=null,P.value=[],V.value=!1,W.value&&(W.value.value="")},_e=async()=>{var g;if(!(!S.value||!I.value)){x.value=!0,P.value=[];try{const _=await k.uploadLetterheadImage(I.value,S.value);(g=_.data)!=null&&g.warnings&&_.data.warnings.length>0&&(P.value=_.data.warnings),await ae(),ne(),n("uploaded",_.data)}catch(_){console.error("Error uploading letterhead:",_),alert("Error al subir la imagen. Por favor intenta nuevamente.")}finally{x.value=!1}}},ae=async()=>{if(I.value)try{const g=await k.getLetterheadImage(I.value);g&&g.data?p.value=URL.createObjectURL(g.data):p.value=null}catch(g){g.response&&g.response.status!==404&&console.error("Unexpected error loading letterhead:",g),p.value=null}},l=async()=>{await te("¬øEst√°s seguro de que deseas eliminar la imagen de membrete?")&&c()},c=async()=>{if(I.value){b.value=!0;try{await k.deleteLetterheadImage(I.value),p.value&&URL.revokeObjectURL(p.value),p.value=null,n("deleted")}catch(g){console.error("Error deleting letterhead:",g),alert("Error al eliminar la imagen. Por favor intenta nuevamente.")}finally{b.value=!1}}},D=()=>{var g;if(p.value){const _=document.createElement("a");_.href=p.value,_.download=`membrete-${((g=r.document)==null?void 0:g.title)||"documento"}.png`,document.body.appendChild(_),_.click(),document.body.removeChild(_)}},z=()=>{p.value=null},Q=g=>{if(g===0)return"0 Bytes";const _=1024,U=["Bytes","KB","MB","GB"],H=Math.floor(Math.log(g)/Math.log(_));return parseFloat((g/Math.pow(_,H)).toFixed(2))+" "+U[H]};me(()=>r.isVisible,g=>{g&&I.value&&(ae(),oe())}),me(()=>r.document,g=>{g&&r.isVisible&&(ae(),oe())});const le=()=>{p.value&&URL.revokeObjectURL(p.value),w.value&&URL.revokeObjectURL(w.value),d.value&&URL.revokeObjectURL(d.value)};return We(()=>{r.isVisible&&I.value&&(ae(),oe())}),Le(le),(g,_)=>pe((a(),A(qe,null,{default:Z(()=>{var U;return[e("div",{class:"w-full h-full flex items-center justify-center p-4",onClick:ee(B,["self"])},[e("div",ht,[e("div",bt,[vt,e("p",yt," Documento: "+$(((U=o.document)==null?void 0:U.title)||"Cargando..."),1),e("button",{onClick:B,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},[F(i(de),{class:"h-6 w-6"})])]),e("div",xt,[f.value?(a(),u("div",wt,[_t,e("p",kt,$(t.value),1)])):(a(),u("div",$t,[p.value?(a(),u("div",Dt,[Et,e("div",Ct,[e("img",{src:p.value,alt:"Membrete actual",class:"max-w-full h-auto max-h-64 mx-auto shadow-sm",onError:z},null,40,St),e("div",Pt,[e("button",{onClick:D,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[F(i(Re),{class:"h-4 w-4 mr-2"}),R(" Descargar ")]),e("button",{onClick:l,disabled:b.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[F(i(Ue),{class:"h-4 w-4 mr-2"}),R(" "+$(b.value?"Eliminando...":"Eliminar"),1)],8,Mt)])])])):(a(),u("div",Ft,[F(i(ue),{class:"mx-auto h-12 w-12 text-gray-400"}),Ot,jt])),e("div",It,[e("h3",zt,$(p.value?"Reemplazar Membrete":"Subir Membrete"),1),e("div",Rt,[e("input",{ref_key:"fileInput",ref:W,type:"file",accept:".png",onChange:xe,class:"hidden"},null,544),S.value?(a(),u("div",Wt,[e("div",Lt,[F(i(Pe),{class:"h-5 w-5 text-green-500"}),e("span",null,$(S.value.name),1),e("span",Nt,"("+$(Q(S.value.size))+")",1)]),w.value?(a(),u("div",qt,[e("img",{src:w.value,alt:"Vista previa",class:"max-w-full h-auto max-h-32 mx-auto border border-gray-200 rounded"},null,8,Gt)])):j("",!0),e("div",Vt,[e("button",{onClick:ne,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:_e,disabled:x.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[x.value?(a(),u("div",Zt)):(a(),A(i(Me),{key:0,class:"h-4 w-4 mr-2"})),R(" "+$(x.value?"Subiendo...":"Subir Imagen"),1)],8,Ht)])])):(a(),u("div",Tt,[F(i(Ke),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",Ut,[e("button",{onClick:_[0]||(_[0]=H=>g.$refs.fileInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Imagen PNG "),e("button",{onClick:_[1]||(_[1]=H=>V.value=!V.value),class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[F(i(Be),{class:"h-4 w-4 mr-2"}),R(" "+$(V.value?"Ocultar":"Ver")+" Especificaciones ",1)])]),Bt,At]))])]),e("div",Qt,[Yt,Kt,h.value?(a(),u("div",Xt,[e("div",Jt,[es,e("div",ts,[e("span",ss,$(M.value||"plantilla_word.docx"),1),y.value?(a(),u("span",as,"("+$(Q(y.value))+")",1)):j("",!0)])]),e("div",rs,[d.value?(a(),u("button",{key:0,onClick:ye,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[F(i(Re),{class:"h-4 w-4 mr-2"}),R(" Descargar ")])):j("",!0),e("button",{onClick:ve,disabled:E.value,class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[F(i(Ue),{class:"h-4 w-4 mr-2"}),R(" "+$(E.value?"Eliminando...":"Eliminar"),1)],8,os)])])):(a(),u("div",ns," Este documento no tiene una plantilla Word configurada. Puedes subir un archivo .docx con tu membrete. ")),e("div",ls,[e("input",{ref_key:"wordTemplateInput",ref:T,type:"file",accept:".docx",onChange:L,class:"hidden"},null,544),m.value?(a(),u("div",us,[e("div",ms,[F(i(Pe),{class:"h-5 w-5 text-green-500"}),e("span",null,$(m.value.name),1),e("span",ps,"("+$(Q(m.value.size))+")",1)]),e("div",gs,[e("button",{onClick:ce,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Cancelar "),e("button",{onClick:X,disabled:s.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50"},[s.value?(a(),u("div",hs)):(a(),A(i(Me),{key:0,class:"h-4 w-4 mr-2"})),R(" "+$(s.value?"Subiendo...":"Subir Plantilla"),1)],8,fs)])])):(a(),u("div",is,[F(i(ue),{class:"mx-auto h-12 w-12 text-gray-400"}),e("div",ds,[e("button",{onClick:_[2]||(_[2]=H=>g.$refs.wordTemplateInput.click()),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Seleccionar Plantilla .docx (Word) ")]),cs]))])]),V.value?(a(),u("div",bs,[e("div",vs,[F(i(Be),{class:"h-6 w-6 text-blue-600"}),ys]),xs,ws,_s,ks,$s])):j("",!0),P.value.length>0?(a(),u("div",Ds,[(a(!0),u(K,null,se(P.value,(H,Y)=>(a(),u("div",{key:Y,class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[e("div",Es,[F(i(ut),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0 mt-0.5"}),e("p",Cs,$(H),1)])]))),128))])):j("",!0)]))])])])]}),_:1},512)),[[Ne,o.isVisible]])}},Ps=be(Ss,[["__scopeId","data-v-a8accb3a"]]),Ms={class:"py-1"},Fs=["disabled","onClick"],Os={key:1,class:"submenu-container relative"},js=["onMouseenter","onMouseleave"],Is={class:"flex items-center"},zs=["onMouseenter","onMouseleave"],Rs={class:"py-1"},Ts=["disabled","onClick"],Us={key:2,class:"border-t border-gray-100"},Bs={__name:"HierarchicalMenu",props:{menuItems:{type:Array,required:!0,default:()=>[]},menuPosition:{type:String,default:"right-0 left-auto sm:left-0 sm:right-auto"}},emits:["menu-action","modalOpen","navigation"],setup(o,{emit:C}){const r=C,n=O(null);let k=null;const f=b=>{k&&(clearTimeout(k),k=null),n.value=b},t=b=>{k=setTimeout(()=>{n.value===b&&(n.value=null)},150)},x=b=>{n.value=null,r("menu-action",b)};return(b,S)=>(a(),A(i(He),{as:"div",class:"relative inline-block text-left menu-container"},{default:Z(()=>[F(i(Ge),{class:"flex items-center justify-center w-8 h-8 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors focus:outline-none focus:ring-0"},{default:Z(()=>[F(i(Xe),{class:"w-5 h-5","aria-hidden":"true"})]),_:1}),F($e,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:Z(()=>[F(i(Ve),{class:G(["absolute z-50 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",o.menuPosition])},{default:Z(()=>[e("div",Ms,[(a(!0),u(K,null,se(o.menuItems,w=>(a(),u(K,{key:w.id||w.label},[w.children?(a(),u("div",Os,[F(i(De),null,{default:Z(()=>[e("div",{class:"w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition cursor-pointer flex items-center justify-between",onMouseenter:p=>f(w.id),onMouseleave:p=>t(w.id)},[e("div",Is,$(w.label),1),F(i(mt),{class:"w-4 h-4 text-gray-400"})],40,js)]),_:2},1024),F($e,{"enter-active-class":"transition ease-out duration-150","enter-from-class":"transform opacity-0 translate-x-2 scale-95","enter-to-class":"transform opacity-100 translate-x-0 scale-100","leave-active-class":"transition ease-in duration-100","leave-from-class":"transform opacity-100 translate-x-0 scale-100","leave-to-class":"transform opacity-0 translate-x-2 scale-95"},{default:Z(()=>[n.value===w.id?(a(),u("div",{key:0,class:"absolute left-full top-0 mt-0 w-52 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none z-60",onMouseenter:p=>f(w.id),onMouseleave:p=>t(w.id)},[e("div",Rs,[(a(!0),u(K,null,se(w.children,p=>(a(),u("button",{key:p.label,class:G(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":p.disabled,"cursor-pointer":!p.disabled}]),disabled:p.disabled,onClick:P=>x(p.action)},[p.disabled?(a(),A(i(Fe),{key:0,class:"size-4 text-gray-400 inline mr-2","aria-hidden":"true"})):j("",!0),R(" "+$(p.label),1)],10,Ts))),128))])],40,zs)):j("",!0)]),_:2},1024)])):(a(),A(i(De),{key:0},{default:Z(()=>[e("button",{class:G(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":w.disabled,"cursor-pointer":!w.disabled}]),disabled:w.disabled,onClick:p=>x(w.action)},[w.disabled?(a(),A(i(Fe),{key:0,class:"size-5 text-gray-400 inline mr-2","aria-hidden":"true"})):j("",!0),R(" "+$(w.label),1)],10,Fs)]),_:2},1024)),w.divider?(a(),u("div",Us)):j("",!0)],64))),128))])]),_:1},8,["class"])]),_:1})]),_:1}))}},As=be(Bs,[["__scopeId","data-v-60d5f9c4"]]);function Ws(o,C){if(!o||o.length===0)return[];const r={editing:{id:"editing",label:"Edici√≥n y gesti√≥n",children:[],priority:1},downloads:{id:"downloads",label:"Descargas",children:[],priority:2},communication:{id:"communication",label:"Comunicaci√≥n",children:[],priority:3},states:{id:"states",label:"Estados del documento",children:[],priority:4},signatures:{id:"signatures",label:"Firmas",children:[],priority:5},actions:{id:"actions",label:"Acciones",children:[],priority:6}};o.forEach(f=>{const t={...f};switch(f.action){case"edit":r.editing.children.push(t);break;case"permissions":r.editing.children.push(t);break;case"copy":r.editing.children.push(t);break;case"downloadPDF":case"downloadWord":case"downloadSignedDocument":r.downloads.children.push(t);break;case"email":r.communication.children.push(t);break;case"publish":case"draft":case"formalize":r.states.children.push(t);break;case"viewSignatures":case"sign":r.signatures.children.push(t);break;case"preview":case"delete":case"removeFromFolder":case"useDocument":r.actions.children.push(t);break;default:r.actions.children.push(t)}});const n=Object.values(r).filter(f=>f.children.length>0).sort((f,t)=>f.priority-t.priority),k=[];return n.forEach((f,t)=>{f.children.length===1?k.push(f.children[0]):k.push(f),t<n.length-1&&k.push({divider:!0})}),k}function Ls(o){return o&&o.length>6}const Je=o=>(Oe("data-v-a1d6dccd"),o=o(),je(),o),Ns=["data-document-id"],qs={class:"flex justify-between items-start mb-3"},Gs={class:"flex items-center gap-2"},Vs={class:"py-1"},Hs=["disabled","onClick"],Zs={class:"space-y-2"},Qs={class:"text-lg font-semibold text-gray-900 leading-tight"},Ys={key:0,class:"text-sm text-gray-600 leading-relaxed"},Ks={key:1,class:"pt-2"},Xs={class:"flex items-center gap-2 flex-wrap"},Js=Je(()=>e("span",{class:"text-xs font-medium text-gray-500"},"Etiquetas:",-1)),ea={class:"flex items-center gap-1.5"},ta=["title"],sa={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-50"},aa={class:"bg-gray-900 text-white text-xs rounded-lg py-1.5 px-2.5 whitespace-nowrap shadow-lg"},ra=Je(()=>e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-[4px] border-r-[4px] border-t-[4px] border-transparent border-t-gray-900"},null,-1)),oa={__name:"BaseDocumentCard",props:{document:{type:Object,required:!0},cardType:{type:String,default:"default"},cardContext:{type:String,default:"list"},highlightedDocId:{type:[String,Number],default:null},showTags:{type:Boolean,default:!0},additionalClasses:{type:[String,Array,Object],default:""},statusIcon:{type:[String,Object,Function],default:null},statusText:{type:String,default:null},statusBadgeClasses:{type:[String,Object,Array],default:null},menuOptions:{type:Array,default:null},documentStore:{type:Object,default:null},userStore:{type:Object,default:null},promptDocuments:{type:Boolean,default:!1},enableModals:{type:Boolean,default:!0},editModalComponent:{type:String,default:"UseDocumentByClient"},editRoute:{type:String,default:null},enableSignatures:{type:Boolean,default:!0},disableInternalActions:{type:Boolean,default:!1},showMenuOptions:{type:Boolean,default:null}},emits:["click","refresh","remove-from-folder","modal-open","navigation","menuAction"],setup(o,{emit:C}){const r=Ie(),n=o,k=C,{activeModals:f,openModal:t,closeModal:x,getUserRole:b}=Kr(n.documentStore,n.userStore),{handlePreviewDocument:S,deleteDocument:w,downloadPDFDocument:p,downloadWordDocument:P,copyDocument:W,publishDocument:V,moveToDraft:m,formalizeDocument:h,signDocument:d,downloadSignedDocument:M}=Xr(n.documentStore,n.userStore,k),y=l=>{l.target.closest(".menu-container")||k("click",n.document,l)},s=()=>{k("refresh")},E={default:{getMenuOptions:(l,c)=>{const D=[];return D.push({label:"Usar Formato",action:"useDocument"}),D.push({label:"Gestionar Membrete",action:"letterhead"}),c==="folder"&&D.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),D}},client:{getMenuOptions:(l,c)=>{const D=[];return l.state==="Completed"?D.push({label:"Editar",action:"edit-submenu",isGroup:!0,children:[{label:"Editar Formulario",action:"editForm"},{label:"Editar Documento",action:"editDocument"}]}):D.push({label:"Completar",action:"editForm"}),l.state==="Completed"&&D.push({label:"Previsualizar",action:"preview"}),D.push({label:"Eliminar",action:"delete"}),D.push({label:"Gestionar Membrete",action:"letterhead"}),D.push({label:"Administrar Asociaciones",action:"relationships"}),l.state==="Completed"&&D.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar",action:"email"}),c==="folder"&&D.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),D}},lawyer:{getMenuOptions:(l,c)=>{const D=[{label:"Editar",action:"edit"},{label:"Permisos",action:"permissions"},{label:"Eliminar",action:"delete"},{label:"Previsualizaci√≥n",action:"preview"},{label:"Crear una Copia",action:"copy"},{label:"Gestionar Membrete",action:"letterhead"}];return l.state==="Draft"?D.push({label:"Publicar",action:"publish",disabled:!_e(l)}):l.state==="Published"&&(D.push({label:"Mover a Borrador",action:"draft"}),D.push({label:"Formalizar y Agregar Firmas",action:"formalize"})),(l.state==="Completed"||l.state==="Published")&&D.push({label:"Descargar PDF",action:"downloadPDF"},{label:"Descargar Word",action:"downloadWord"},{label:"Enviar por Email",action:"email"}),l.requires_signature&&["PendingSignatures","FullySigned","Rejected","Expired"].includes(l.state)&&(D.push({label:"Ver Firmas",action:"viewSignatures"}),ae(l)&&D.push({label:"Firmar documento",action:"sign"})),D}},signatures:{getMenuOptions:(l,c)=>{const D=[{label:"Previsualizar",action:"preview"},{label:"Gestionar Membrete",action:"letterhead"}];return l.requires_signature&&(l.state==="PendingSignatures"||l.state==="FullySigned")&&D.push({label:"Estado de las firmas",action:"viewSignatures"}),ae(l)&&D.push({label:"Firmar documento",action:"sign"}),l.state==="FullySigned"&&D.push({label:"Descargar Documento firmado",action:"downloadSignedDocument"}),l.state==="PendingSignatures"&&D.push({label:"Descargar PDF",action:"downloadPDF"}),c==="folder"&&D.push({label:"Quitar de Carpeta",action:"removeFromFolder"}),D}}},T=N(()=>{if(n.menuOptions!==null)return n.menuOptions;if(n.showMenuOptions===!1)return[];if(n.showMenuOptions===!0){const c=E[n.cardType];return c?c.getMenuOptions(n.document,n.cardContext):[]}const l=E[n.cardType];return l?l.getMenuOptions(n.document,n.cardContext):[]}),I=N(()=>n.promptDocuments?"right-0 left-auto sm:right-auto sm:left-0 sm:-translate-x-[calc(100%-24px)]":"right-0 left-auto sm:left-0 sm:right-auto"),B=N(()=>!T.value||T.value.length===0?[]:ne(T.value)?T.value:Ws(T.value,n.document)),L=N(()=>{switch(n.document.state){case"Completed":case"Published":case"FullySigned":return"border-green-400 bg-green-50/50 shadow-green-100";case"Progress":case"Draft":return"border-blue-300 bg-blue-50/30 shadow-blue-100";case"PendingSignatures":return"border-yellow-400 bg-yellow-50/50 shadow-yellow-100";default:return"border-gray-200 bg-white"}}),ce=N(()=>{if(!n.highlightedDocId||String(n.document.id)!==String(n.highlightedDocId))return"";const l=n.document.state;return l==="Published"||l==="FullySigned"||l==="Completed"?"shadow-lg animate-pulse-highlight-green":l==="PendingSignatures"?"shadow-lg animate-pulse-highlight-yellow":"shadow-lg animate-pulse-highlight-blue"}),X=N(()=>{if(n.statusIcon)return n.statusIcon;switch(n.document.state){case"Published":case"FullySigned":case"Completed":return Pe;case"Draft":case"Progress":case"PendingSignatures":default:return pt}}),oe=N(()=>{if(n.statusText)return n.statusText;switch(n.document.state){case"Published":return"Publicado";case"Draft":return"Borrador";case"Progress":return"En progreso";case"Completed":return"Completado";case"PendingSignatures":return"Pendiente de firmas";case"FullySigned":return"Completamente firmado";default:return"Desconocido"}}),ve=N(()=>{if(n.statusBadgeClasses)return n.statusBadgeClasses;switch(n.document.state){case"Published":case"FullySigned":case"Completed":return"bg-green-100 text-green-700 border border-green-200";case"Draft":case"Progress":return"bg-blue-100 text-blue-700 border border-blue-200";case"PendingSignatures":return"bg-yellow-100 text-yellow-700 border border-yellow-200";default:return"bg-gray-100 text-gray-700 border border-gray-200"}}),ge=async(l,c)=>{try{switch(l){case"edit":await ye(c);break;case"editForm":await xe(c);break;case"editDocument":await we(c);break;case"permissions":t("permissions",c);break;case"relationships":t("relationships",c);break;case"preview":await S(c);break;case"delete":await w(c);break;case"downloadPDF":await p(c);break;case"downloadWord":await P(c);break;case"email":t("email",c);break;case"copy":await W(c);break;case"publish":await V(c);break;case"draft":await m(c);break;case"formalize":await h(c);break;case"viewSignatures":t("signatures",c);break;case"sign":await d(c,t);break;case"downloadSignedDocument":await M(c);break;case"removeFromFolder":k("remove-from-folder",c);break;case"useDocument":k("click",c);break;case"use":k("menuAction",l,c);break;case"letterhead":t("letterhead",c);break;default:console.warn("Unknown action:",l)}}catch(D){console.error(`Error executing action ${l}:`,D)}},ye=async l=>{if(n.editRoute){const c=encodeURIComponent(l.title.trim()),D=n.editRoute.replace(":id",l.id).replace(":title",c);r.push(D)}else t("edit",l,{userRole:b()})},xe=async l=>{t("edit",l,{userRole:b()})},we=async l=>{r.push(`/dynamic_document_dashboard/client/editor/edit/${l.id}`)},ne=l=>l&&l.some(c=>c.children&&c.children.length>0),_e=l=>!l.variables||l.variables.length===0?!0:l.variables.every(c=>c.name_es&&c.name_es.trim().length>0),ae=l=>{var z,Q;if(!l.requires_signature||l.state!=="PendingSignatures"||!l.signatures||l.signatures.length===0)return!1;const c=(Q=(z=n.userStore)==null?void 0:z.currentUser)==null?void 0:Q.email,D=l.signatures.find(le=>le.signer_email===c);return!(!D||D.signed)};return(l,c)=>{var D;return a(),u(K,null,[e("div",{"data-document-id":o.document.id,class:G(["relative bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 p-4 cursor-pointer focus:outline-none focus:ring-0",[L.value,ce.value,o.additionalClasses]]),onClick:y},[e("div",qs,[e("div",Gs,[ie(l.$slots,"status-badge",{},()=>[e("div",{class:G(["inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium",ve.value])},[(a(),A(Ze(X.value),{class:"w-3.5 h-3.5"})),e("span",null,$(oe.value),1)],2)],!0),ie(l.$slots,"additional-badges",{},void 0,!0)]),ie(l.$slots,"right-action",{},()=>[i(Ls)(T.value)||ne(T.value)?(a(),A(As,{key:0,"menu-items":B.value,"menu-position":I.value,onMenuAction:c[0]||(c[0]=z=>ge(z,o.document))},null,8,["menu-items","menu-position"])):T.value&&T.value.length>0?(a(),A(i(He),{key:1,as:"div",class:"relative inline-block text-left menu-container"},{default:Z(()=>[F(i(Ge),{class:"flex items-center justify-center w-8 h-8 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors focus:outline-none focus:ring-0"},{default:Z(()=>[F(i(Xe),{class:"w-5 h-5","aria-hidden":"true"})]),_:1}),F($e,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:Z(()=>[F(i(Ve),{class:G(["absolute z-50 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",I.value])},{default:Z(()=>[e("div",Vs,[(a(!0),u(K,null,se(T.value,z=>(a(),A(i(De),{key:z.label},{default:Z(()=>[e("button",{class:G(["block w-full text-left px-4 py-2 text-sm font-regular hover:bg-gray-100 transition focus:outline-none focus:ring-0",{"opacity-50 cursor-not-allowed":z.disabled,"cursor-pointer":!z.disabled}]),disabled:z.disabled,onClick:Q=>ge(z.action,o.document)},[z.disabled?(a(),A(i(Fe),{key:0,class:"size-5 text-gray-400 inline mr-2","aria-hidden":"true"})):j("",!0),R(" "+$(z.label),1)],10,Hs)]),_:2},1024))),128))])]),_:1},8,["class"])]),_:1})]),_:1})):j("",!0)],!0)]),e("div",Zs,[e("h3",Qs,$(o.document.title),1),o.document.description?(a(),u("p",Ys,$(o.document.description),1)):j("",!0),ie(l.$slots,"additional-content",{},void 0,!0),o.showTags&&o.document.tags&&o.document.tags.length>0?(a(),u("div",Ks,[e("div",Xs,[Js,e("div",ea,[(a(!0),u(K,null,se(o.document.tags,z=>{var Q,le;return a(),u("div",{key:z.id,class:"group relative"},[e("div",{class:"w-5 h-5 rounded-full cursor-pointer transition-all duration-200 hover:scale-110 hover:ring-2 hover:ring-offset-1 shadow-sm",style:st({backgroundColor:((Q=i(Te)(z.color_id))==null?void 0:Q.hex)||"#9CA3AF",boxShadow:`0 0 0 1px ${((le=i(Te)(z.color_id))==null?void 0:le.dark)||"#6B7280"}40`}),title:z.name},null,12,ta),e("div",sa,[e("div",aa,[R($(z.name)+" ",1),ra])])])}),128))])])])):j("",!0)]),ie(l.$slots,"footer",{},void 0,!0),ie(l.$slots,"additional-actions",{},void 0,!0)],10,Ns),i(f).edit.isOpen?(a(),A(i(fa),{key:0,document:i(f).edit.document,"user-role":i(b)(),onClose:c[1]||(c[1]=z=>i(x)("edit"))},null,8,["document","user-role"])):j("",!0),i(f).email.isOpen?(a(),A(i(Ta),{key:1,document:i(f).email.document,onClose:c[2]||(c[2]=z=>i(x)("email"))},null,8,["document"])):j("",!0),i(f).signatures.isOpen?(a(),A(i(Mr),{key:2,"document-id":(D=i(f).signatures.document)==null?void 0:D.id,onClose:c[3]||(c[3]=z=>i(x)("signatures")),onRefresh:s},null,8,["document-id"])):j("",!0),i(f).electronicSignature.isOpen?(a(),A(i(Ir),{key:3,onClose:c[4]||(c[4]=z=>i(x)("electronicSignature"))})):j("",!0),i(f).permissions.isOpen?(a(),A(i(Yr),{key:4,"is-open":i(f).permissions.isOpen,document:i(f).permissions.document,onClose:c[5]||(c[5]=z=>i(x)("permissions")),onSaved:s},null,8,["is-open","document"])):j("",!0),i(f).letterhead.isOpen?(a(),A(Ps,{key:5,"is-visible":i(f).letterhead.isOpen,document:i(f).letterhead.document,onClose:c[6]||(c[6]=z=>i(x)("letterhead")),onUploaded:s,onDeleted:s},null,8,["is-visible","document"])):j("",!0),i(f).relationships.isOpen?(a(),A(ct,{key:6,"is-open":i(f).relationships.isOpen,document:i(f).relationships.document,onClose:c[7]||(c[7]=z=>i(x)("relationships")),onRefresh:s},null,8,["is-open","document"])):j("",!0)],64)}}},bo=be(oa,[["__scopeId","data-v-a1d6dccd"]]),na={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},la={class:"flex justify-end"},ia=e("label",{for:"document-name",class:"block text-base font-medium leading-6 text-primary"},[R(" Nombre "),e("span",{class:"text-red-500"},"*")],-1),da={class:"mt-2"},ca={class:"flex gap-2 mt-2.5"},ua=["disabled"],ma=e("span",null,"Actualizar nombre",-1),pa=[ma],ga=["disabled"],fa={__name:"EditDocumentModal",props:{document:{type:Object,required:!0},userRole:{type:String,default:"client"},showEditorButton:{type:Boolean,default:!0}},emits:["close"],setup(o,{emit:C}){const r=o,n=Ie(),k=he(),f=C,t=O(""),x=O(""),b=()=>{f("close")};at(()=>{var h,d;r.document?(t.value=((h=r.document)==null?void 0:h.title)||"",x.value=((d=r.document)==null?void 0:d.title)||""):(t.value="",x.value="")});const S=h=>{h.key==="Escape"&&b()};We(()=>{document.addEventListener("keydown",S)}),Le(()=>{document.removeEventListener("keydown",S)});const w=N(()=>t.value.trim().length>0),p=N(()=>{var h;return!!((h=r.document)!=null&&h.id)}),P=N(()=>p.value&&t.value.trim()!==x.value.trim()&&t.value.trim().length>0),W=N(()=>p.value?r.showEditorButton:!0);async function V(){if(p.value&&P.value)try{const h={title:t.value.trim()};await k.updateDocument(r.document.id,h),x.value=t.value.trim(),v("Nombre del documento actualizado exitosamente.","success"),b()}catch(h){console.error("Error updating document name:",h),v("Error al actualizar el nombre del documento.","error")}}function m(){var d;const h=encodeURIComponent(t.value.trim());(d=r.document)!=null&&d.id&&!p.value?r.userRole==="lawyer"?n.push(`/dynamic_document_dashboard/lawyer/editor/create/${h}`):n.push(`/dynamic_document_dashboard/document/use/creator/${r.document.id}/${h}`):p.value?r.userRole==="lawyer"?n.push(`/dynamic_document_dashboard/lawyer/editor/edit/${r.document.id}`):n.push(`/dynamic_document_dashboard/document/use/editor/${r.document.id}/${h}`):v("Error: No se pudo continuar. Documento no seleccionado.","error")}return(h,d)=>(a(),u("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:ee(b,["self"])},[e("div",na,[e("div",la,[e("button",{onClick:b},[F(i(de),{class:"size-6"})])]),e("form",{onSubmit:ee(m,["prevent"])},[e("div",null,[ia,e("div",da,[pe(e("input",{"onUpdate:modelValue":d[0]||(d[0]=M=>t.value=M),type:"text",id:"document-name",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300",required:""},null,512),[[ze,t.value]])])]),e("div",ca,[p.value?(a(),u("button",{key:0,type:"button",onClick:V,disabled:!P.value,class:G(["p-2.5 text-sm font-medium rounded-md flex gap-2",P.value?"bg-primary text-white cursor-pointer":"bg-gray-200 text-gray-400 cursor-not-allowed opacity-70"])},pa,10,ua)):j("",!0),W.value?(a(),u("button",{key:1,type:"submit",class:G(["p-2.5 text-sm font-medium rounded-md flex gap-2",w.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!w.value},[e("span",null,$(p.value?"Editar Documento":"Continuar"),1)],10,ga)):j("",!0)])],32)])]))}},ha={class:"bg-white rounded-lg p-6 shadow-xl max-w-lg w-full"},ba={class:"flex justify-end"},va=e("label",{for:"email",class:"block text-base font-medium leading-6 text-primary"},[R(" Correo electr√≥nico "),e("span",{class:"text-red-500"},"*")],-1),ya={class:"mt-2"},xa={class:"mt-4"},wa=e("label",{for:"files",class:"block text-base font-medium leading-6 text-primary"}," Anexos ",-1),_a={key:0,class:"text-center"},ka={class:"mt-4 flex text-sm/6 text-gray-600"},$a={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"},Da=e("span",null,"Sube un archivo",-1),Ea=e("p",{class:"pl-1"},"o arrastra y suelta",-1),Ca=e("p",{class:"text-xs/5 text-gray-600"}," PNG, JPG, PDF, DOCX de hasta 20MB ",-1),Sa={key:1,class:"w-full flex flex-wrap gap-3"},Pa=["onMouseenter","onMouseleave"],Ma=["onClick"],Fa={class:"text-center text-xs truncate w-20"},Oa=["disabled"],ja=e("span",null,"Enviar",-1),Ia=[ja],za="dynamic-documents/send_email_with_attachments/",Ra=20*1024*1024,Ta={__name:"SendDocumentModal",props:{document:{type:Object,required:!0}},emits:["close"],setup(o,{emit:C}){const r=C,{sendEmail:n}=ft(),k=O(null),f=o,t=()=>{x.email="",b.value=[],k.value=null},x=rt({email:""}),b=O([]),S=y=>{const s=Array.from(y.target.files);p(s),y.target.value=null},w=y=>{const s=Array.from(y.dataTransfer.files);p(s)},p=y=>{let s=b.value.reduce((E,T)=>E+T.file.size,0);y.forEach(E=>{if(E.size>Ra){v(`The file "${E.name}" exceeds the 20 MB limit.`,"warning");return}const T=E.name.split(".").pop().toLowerCase();let I="",B={general:"",xMark:""};switch(T){case"png":case"jpg":case"jpeg":I=Ke,B.general="border-gray-200 text-gray-400",B.xMark="bg-gray-400";break;case"pdf":I=ue,B.general="border-red-600/20 text-red-600/60",B.xMark="bg-red-600/60";break;case"docx":I=ue,B.general="border-blue-600/20 text-blue-600/60",B.xMark="bg-blue-600/60";break;default:v("Unsupported file type. Only PDF, DOCX, JPG, and PNG are allowed.","warning");return}b.value.push({name:E.name,icon:I,style:B,hover:!1,file:E}),s+=E.size})},P=y=>{b.value.splice(y,1)},W=y=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y),V=N(()=>W(x.email)),m=N(()=>V.value),h=async y=>{try{const s=await Ee(`dynamic-documents/${y}/download-pdf/`,"blob");if(!s||!s.data)throw new Error("Invalid response from server");return new File([s.data],`document_${y}.pdf`,{type:"application/pdf"})}catch(s){return console.error("Error downloading PDF:",s),v("No se pudo descargar el documento PDF.","error"),null}};me(()=>f.document,y=>{y&&Object.keys(y).length>0&&y.id&&h(y.id)},{immediate:!0});const d=async()=>{try{if(f.document.id){const s=await h(f.document.id);s&&b.value.push({name:s.name,file:s,icon:ue,style:{general:"border-blue-600/20 text-blue-600/60",xMark:"bg-blue-600/60"},hover:!1})}const y=b.value.map(s=>s.file);await n(za,x.email,f.document.title,"Attached is the requested document along with additional attachments.",y,{documentId:f.document.id})}catch(y){console.error("Error sending the email:",y)}finally{M()}},M=()=>{t(),r("close")};return(y,s)=>(a(),u("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:ee(M,["self"])},[e("div",ha,[e("div",ba,[e("button",{onClick:s[0]||(s[0]=E=>M())},[F(i(de),{class:"size-6"})])]),e("form",{onSubmit:ee(d,["prevent"])},[e("div",null,[va,e("div",ya,[pe(e("input",{"onUpdate:modelValue":s[1]||(s[1]=E=>x.email=E),type:"text",name:"email",id:"email",class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-secondary sm:text-sm sm:leading-6",required:""},null,512),[[ze,x.email]])])]),e("div",xa,[wa,e("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 bg-white px-6 py-10",onDragover:s[2]||(s[2]=ee(()=>{},["prevent"])),onDrop:ee(w,["prevent"])},[b.value.length<1?(a(),u("div",_a,[F(i(Me),{class:"mx-auto size-12 text-gray-300","aria-hidden":"true"}),e("div",ka,[e("label",$a,[Da,e("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",onChange:S},null,32)]),Ea]),Ca])):(a(),u("div",Sa,[(a(!0),u(K,null,se(b.value,(E,T)=>(a(),u("div",{key:T,class:G(["relative p-4 grid rounded-md bg-white border-2",E.style.general]),onMouseenter:I=>E.hover=!0,onMouseleave:I=>E.hover=!1},[pe(e("div",{class:G(["absolute p-0.5 mt-2 ml-2 rounded-full",E.style.xMark]),onClick:I=>P(T)},[F(i(de),{class:"size-3 text-white"})],10,Ma),[[Ne,E.hover]]),(a(),A(Ze(E.icon),{class:"size-12 mx-auto"})),e("span",Fa,$(E.name),1)],42,Pa))),128))]))],32)]),e("button",{type:"submit",class:G(["mt-4 p-2.5 text-sm font-medium rounded-md flex gap-2",m.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!m.value},Ia,10,Oa)],32)])]))}},J=o=>(Oe("data-v-55719d60"),o=o(),je(),o),Ua={class:"fixed inset-0 z-50 flex items-center justify-center"},Ba={class:"relative bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Aa=J(()=>e("h2",{class:"text-xl font-semibold text-gray-800"},"Estado de firmas del documento",-1)),Wa=J(()=>e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),La=[Wa],Na={class:"p-6 overflow-y-auto flex-grow"},qa={key:0,class:"text-center py-10"},Ga=J(()=>e("div",{class:"spinner"},null,-1)),Va=J(()=>e("p",{class:"mt-4 text-gray-500"},"Cargando informaci√≥n de firmas...",-1)),Ha=[Ga,Va],Za={key:1},Qa={class:"mb-4"},Ya={class:"text-lg font-medium text-gray-900"},Ka={class:"text-sm text-gray-500"},Xa={class:"inline-flex items-center"},Ja={key:0,class:"text-sm text-gray-500 mt-1"},er={class:"text-sm text-gray-500 mt-1"},tr={class:"mt-6"},sr={class:"min-w-full divide-y divide-gray-200"},ar=J(()=>e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Usuario"),e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado"),e("th",{class:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Fecha de firma")])],-1)),rr={class:"bg-white divide-y divide-gray-200"},or={class:"px-4 py-4 whitespace-nowrap"},nr={class:"flex items-center"},lr={class:"text-sm font-medium text-gray-900 flex items-center"},ir={key:0,class:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full"},dr={class:"text-sm text-gray-500"},cr={class:"px-4 py-4 whitespace-nowrap"},ur={class:"px-4 py-4 whitespace-nowrap text-sm text-gray-500"},mr={class:"px-4 py-4 whitespace-nowrap"},pr={class:"flex items-center"},gr={class:"text-sm font-medium text-gray-900"},fr={class:"text-sm text-gray-500"},hr={class:"px-4 py-4 whitespace-nowrap"},br={class:"px-4 py-4 whitespace-nowrap text-sm text-gray-500"},vr={class:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-between items-center"},yr={class:"flex gap-3"},xr={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40"},wr={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4"},_r=J(()=>e("h2",{class:"text-sm font-semibold text-gray-900"},"Rechazar documento",-1)),kr=J(()=>e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),$r=[kr],Dr={class:"px-4 py-4 space-y-3 text-sm text-gray-700"},Er={class:"font-semibold"},Cr=J(()=>e("p",{class:"text-xs text-gray-500"}," El rechazo devolver√° el documento al abogado creador para que pueda revisarlo, editarlo o archivarlo. ",-1)),Sr=J(()=>e("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Motivo del rechazo (opcional) ",-1)),Pr={__name:"DocumentSignaturesModal",props:{documentId:Number},emits:["close","refresh"],setup(o,{emit:C}){const r=o,n=C,k=he(),f=Qe(),t=O(null),x=O(!1),b=O(""),S=N(()=>{if(!t.value||!t.value.requires_signature||t.value.state!=="PendingSignatures"||!t.value.signers||t.value.signers.length===0)return!1;const d=t.value.signers.find(M=>M.is_current_user);return!(!d||d.signed)}),w=()=>{n("close")},p=d=>d?new Date(d).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"‚Äî",P=async()=>{if(!r.documentId){console.error("No document ID provided");return}try{const d=f.currentUser.id,M=await Ee(`dynamic-documents/user/${d}/pending-documents-full/`);if(M.status!==200)throw new Error(`Error loading documents: ${M.status}`);const y=M.data.find(s=>s.id===r.documentId);if(y)t.value=y;else{const s=await Ee(`dynamic-documents/${r.documentId}/`);if(s.status!==200)throw new Error(`Error loading document: ${s.status}`);t.value=s.data}}catch(d){console.error("Error loading document data:",d),d.response&&console.error("Error response data:",d.response.data),t.value=null,await v("Error al cargar la informaci√≥n de firmas","error")}};me(()=>r.documentId,d=>{d&&P()},{immediate:!0}),me(()=>k.documents,()=>{r.documentId&&P()},{deep:!0});const W=async()=>{try{const d=f.currentUser.id;if(!f.currentUser.has_signature){await v("Para firmar documentos necesitas tener una firma registrada.","info"),await te("¬øDeseas crear una firma electr√≥nica ahora?")?n("open-electronic-signature"):await v("Necesitas una firma para poder firmar documentos.","warning");return}if(!await te(`¬øEst√°s seguro de que deseas firmar el documento "${t.value.title}"?`)){await v("Operaci√≥n de firma cancelada","info");return}const y=`dynamic-documents/${t.value.id}/sign/${d}/`;await v("Procesando firma del documento...","info");const s=await fe(y,{});if(s.status===200||s.status===201){await v(`¬°Documento "${t.value.title}" firmado correctamente!`,"success");try{await Ce(Se.FINISH,`Firmaste el documento "${t.value.title}"`)}catch(E){console.warn("No se pudo registrar la actividad de firma:",E)}await P(),n("refresh")}else throw new Error(`Unexpected server response: ${s.status} ${s.statusText}`)}catch(d){console.error("Error signing document:",d),await v(`Error al firmar el documento: ${d.message}`,"error")}},V=()=>{b.value="",x.value=!0},m=()=>{x.value=!1,b.value=""},h=async()=>{if(t.value)try{const d=f.currentUser.id,M=`dynamic-documents/${t.value.id}/reject/${d}/`,y=b.value?{comment:b.value}:{},s=await fe(M,y);if(s&&(s.status===200||s.status===201)){await v("Documento rechazado correctamente.","success");try{await Ce(Se.FINISH,`Rechazaste el documento "${t.value.title}"`)}catch(E){console.warn("No se pudo registrar la actividad de rechazo:",E)}m(),w(),n("refresh")}else await v("Error al rechazar el documento.","error")}catch(d){console.error("Error rejecting document:",d),await v("Error al rechazar el documento.","error")}};return(d,M)=>{var y;return a(),u("div",Ua,[e("div",{class:"absolute inset-0 bg-black opacity-50",onClick:w}),e("div",Ba,[e("div",{class:"px-6 py-4 border-b border-gray-200"},[Aa,e("button",{onClick:w,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-500"},La)]),e("div",Na,[t.value?(a(),u("div",Za,[e("div",Qa,[e("h3",Ya,$(t.value.title),1),e("p",Ka,[e("span",Xa,[e("span",{class:G(["inline-block w-3 h-3 rounded-full mr-2",t.value.state==="FullySigned"?"bg-green-500":t.value.state==="Rejected"?"bg-red-500":t.value.state==="Expired"?"bg-gray-400":"bg-yellow-500"])},null,2),R(" "+$(t.value.state==="FullySigned"?"Documento completamente firmado":t.value.state==="Rejected"?"Documento rechazado":t.value.state==="Expired"?"Documento expirado":"Pendiente de firmas"),1)])]),t.value.creator?(a(),u("p",Ja," Creado por: "+$(t.value.creator.name)+" ("+$(t.value.creator.email)+") ",1)):j("",!0),e("p",er," Firmas: "+$(t.value.completed_signatures||0)+"/"+$(t.value.total_signatures||0),1)]),e("div",tr,[e("table",sr,[ar,e("tbody",rr,[(a(!0),u(K,null,se(t.value.signers||[],s=>(a(),u("tr",{key:"sig_"+s.signature_id,class:G({"bg-blue-50":s.is_current_user})},[e("td",or,[e("div",nr,[e("div",null,[e("div",lr,[R($(s.signer_name)+" ",1),s.is_current_user?(a(),u("span",ir,"T√∫")):j("",!0)]),e("div",dr,$(s.signer_email),1)])])]),e("td",cr,[e("span",{class:G(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",s.rejected?"bg-red-100 text-red-800":s.signed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},$(s.rejected?"Rechazado":s.signed?"Firmado":"Pendiente"),3)]),e("td",ur,$(s.signed_at?p(s.signed_at):s.rejected_at?p(s.rejected_at):"‚Äî"),1)],2))),128)),!t.value.signers&&t.value.signatures?(a(!0),u(K,{key:0},se(t.value.signatures,s=>(a(),u("tr",{key:"old_"+s.id},[e("td",mr,[e("div",pr,[e("div",null,[e("div",gr,$(s.signer_name||s.signer_email),1),e("div",fr,$(s.signer_email),1)])])]),e("td",hr,[e("span",{class:G(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",s.rejected?"bg-red-100 text-red-800":s.signed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},$(s.rejected?"Rechazado":s.signed?"Firmado":"Pendiente"),3)]),e("td",br,$(s.signed_at?p(s.signed_at):s.rejected_at?p(s.rejected_at):"‚Äî"),1)]))),128)):j("",!0)])])])])):(a(),u("div",qa,Ha))]),e("div",vr,[e("div",yr,[S.value?(a(),u("button",{key:0,onClick:W,class:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors"}," Firmar documento ")):j("",!0),S.value?(a(),u("button",{key:1,onClick:V,class:"px-4 py-2 bg-red-600 text-white hover:bg-red-700 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors"}," Rechazar documento ")):j("",!0)]),e("button",{onClick:w,class:"px-4 py-2 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400"}," Cerrar ")])]),x.value?(a(),u("div",xr,[e("div",wr,[e("div",{class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},[_r,e("button",{type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100",onClick:m},$r)]),e("div",Dr,[e("p",null,[R(" Est√°s a punto de rechazar el documento "),e("span",Er,'"'+$((y=t.value)==null?void 0:y.title)+'"',1),R(". ")]),Cr,e("div",null,[Sr,pe(e("textarea",{"onUpdate:modelValue":M[0]||(M[0]=s=>b.value=s),rows:"4",class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-secondary focus:border-transparent resize-none",placeholder:"Describe brevemente por qu√© no est√°s de acuerdo con el documento..."},null,512),[[ze,b.value]])])]),e("div",{class:"px-4 py-3 border-t border-gray-100 flex justify-end gap-2 bg-gray-50"},[e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100",onClick:m}," Cancelar "),e("button",{type:"button",class:"px-3 py-1.5 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700",onClick:h}," Rechazar documento ")])])])):j("",!0)])}}},Mr=be(Pr,[["__scopeId","data-v-55719d60"]]),Fr={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-auto shadow-xl"},Or={class:"flex justify-between items-center mb-4"},jr=e("h2",{class:"text-lg font-medium text-primary"},"Firma Electr√≥nica",-1),Ir={__name:"ElectronicSignatureModal",emits:["close"],setup(o,{emit:C}){const r=Qe(),n=C,k=()=>{n("close")},f=async t=>{r.currentUser&&(r.currentUser.has_signature=!0),v("Firma electr√≥nica guardada correctamente","success"),setTimeout(()=>{k()},500)};return(t,x)=>(a(),u("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:ee(k,["self"])},[e("div",Fr,[e("div",Or,[jr,e("button",{onClick:k,class:"text-gray-400 hover:text-gray-500"},[F(i(de),{class:"h-6 w-6"})])]),F(ot,{initialShowOptions:!0,"user-id":i(r).currentUser.id,onSignatureSaved:f,onCancel:k},null,8,["user-id"])])]))}},zr={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Rr={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0"},Tr={class:"inline-block w-full max-w-4xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl"},Ur={class:"flex items-center justify-between pb-4 mb-6 border-b border-gray-200"},Br=e("h3",{class:"text-lg font-medium leading-6 text-gray-900"}," Gesti√≥n de Permisos ",-1),Ar={class:"mt-1 text-sm text-gray-500"},Wr={key:0,class:"mb-6"},Lr={key:1,class:"p-4 mb-6 bg-red-50 border border-red-200 rounded-lg"},Nr=e("div",{class:"flex items-center"},[e("svg",{class:"w-5 h-5 text-red-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("p",{class:"text-red-700"},"No tienes permisos para gestionar los permisos de este documento.")],-1),qr=[Nr],Gr={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},Vr=["disabled"],Hr={key:0,class:"flex items-center"},Zr=e("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},null,-1),Qr={key:1},Yr={__name:"DocumentPermissionsModal",props:{isOpen:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["close","saved"],setup(o,{emit:C}){const r=o,n=C,k=he(),f=O(null),t=O(!1),{isLawyer:x}=nt(),b=N(()=>{var p;return x.value&&((p=r.document)==null?void 0:p.id)}),S=()=>{t.value||n("close")},w=async()=>{var P;if(!b.value||t.value)return;const p=(P=f.value)==null?void 0:P.getPermissionsData();if(!p){await v("Error al obtener los permisos actuales","error");return}t.value=!0;try{const W=r.document.id;await k.manageDocumentPermissions(W,p),await v("Permisos actualizados exitosamente","success"),n("saved",r.document),S()}catch(W){console.error("Error saving permissions:",W),await v("Error al guardar los permisos","error")}finally{t.value=!1}};return(p,P)=>(a(),A(qe,null,{default:Z(()=>{var W;return[o.isOpen?(a(),u("div",zr,[e("div",Rr,[e("div",{class:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:S}),e("div",Tr,[e("div",Ur,[e("div",null,[Br,e("p",Ar,$(((W=o.document)==null?void 0:W.title)||"Documento"),1)]),e("button",{onClick:S,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors"},[F(i(de),{class:"w-6 h-6"})])]),b.value?(a(),u("div",Wr,[F(lt,{ref_key:"permissionsManagerRef",ref:f,document:o.document},null,8,["document"])])):(a(),u("div",Lr,qr)),e("div",Gr,[e("button",{onClick:S,type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"},$(b.value?"Cancelar":"Cerrar"),1),b.value?(a(),u("button",{key:0,onClick:w,disabled:t.value,type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-secondary rounded-md hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[t.value?(a(),u("span",Hr,[Zr,R(" Guardando... ")])):(a(),u("span",Qr,"Guardar Permisos"))],8,Vr)):j("",!0)])])])])):j("",!0)]}),_:1}))}};function Kr(o,C){const r=O({edit:{isOpen:!1,document:null},email:{isOpen:!1,document:null},preview:{isOpen:!1,document:null},signatures:{isOpen:!1,document:null},electronicSignature:{isOpen:!1,document:null},permissions:{isOpen:!1,document:null},letterhead:{isOpen:!1,document:null},relationships:{isOpen:!1,document:null}}),n=(x,b,S={})=>{switch(f(),x){case"edit":r.value.edit={isOpen:!0,document:b,...S};break;case"email":r.value.email={isOpen:!0,document:b};break;case"preview":Ye(b);break;case"signatures":r.value.signatures={isOpen:!0,document:b};break;case"electronic-signature":r.value.electronicSignature={isOpen:!0,document:b};break;case"permissions":r.value.permissions={isOpen:!0,document:b};break;case"letterhead":r.value.letterhead={isOpen:!0,document:b};break;case"relationships":r.value.relationships={isOpen:!0,document:b};break;default:console.warn(`Unknown modal type: ${x}`)}},k=x=>{r.value[x]&&(r.value[x]={isOpen:!1,document:null})},f=()=>{Object.keys(r.value).forEach(x=>{r.value[x]={isOpen:!1,document:null}})};return{activeModals:r,openModal:n,closeModal:k,closeAllModals:f,getUserRole:()=>{var x;return((x=C==null?void 0:C.currentUser)==null?void 0:x.role)||"client"}}}function Xr(o,C,r){const{registerView:n}=it(),k=Ie();return{handlePreviewDocument:async m=>{await n("document",m.id),Ye(m)},deleteDocument:async m=>{if(await te(`¬øEst√°s seguro de que deseas eliminar el documento "${m.title}"?`)&&o)try{await o.deleteDocument(m.id),await v("Documento eliminado exitosamente","success"),r("refresh")}catch(d){throw await v("Error al eliminar el documento","error"),d}},downloadPDFDocument:async m=>{if(o)try{await o.downloadPDF(m.id,m.title),await v("PDF descargado exitosamente","success")}catch(h){throw await v("Error al descargar el PDF","error"),h}},downloadWordDocument:async m=>{if(o)try{await o.downloadWord(m.id,m.title),await v("Documento Word descargado exitosamente","success")}catch(h){throw await v("Error al descargar el documento Word","error"),h}},copyDocument:async m=>{var h;if(!o){await v("Funcionalidad de duplicar no implementada a√∫n","info");return}try{const d=new Date,M=String(d.getDate()).padStart(2,"0"),y=String(d.getMonth()+1).padStart(2,"0"),s=d.getFullYear(),E=`${M}${y}${s}`,T=`${m.title} ${E}`,I={title:T,content:m.content,state:"Draft",variables:((h=m.variables)==null?void 0:h.map(L=>({name_en:L.name_en,name_es:L.name_es,tooltip:L.tooltip,field_type:L.field_type,select_options:L.select_options,value:""})))||[],requires_signature:!1};if(!await te(`¬øDeseas crear una copia del documento '${m.title}'?`))return;await o.createDocument(I),await v(`Copia creada exitosamente: "${T}"`,"success"),r("refresh")}catch(d){console.error("Error creating document copy:",d),await v("Error al crear la copia del documento","error")}},publishDocument:async m=>{if(o)try{const h={...m,state:"Published",is_public:!0};await o.updateDocument(m.id,h),await v("Documento publicado exitosamente","success"),r("refresh")}catch(h){throw await v("Error al publicar el documento","error"),h}},moveToDraft:async m=>{if(o)try{const h={...m,state:"Draft"};await o.updateDocument(m.id,h),await v("Documento movido a borrador exitosamente","success"),r("refresh")}catch(h){throw await v("Error al mover el documento a borrador","error"),h}},formalizeDocument:async m=>{try{k.push(`/dynamic_document_dashboard/document/use/formalize/${m.id}/${m.title}`)}catch(h){console.error("Error al formalizar el documento:",h),await v("Error al formalizar el documento","error")}},signDocument:async(m,h)=>{var d,M;try{const y=C.currentUser.id,s=C.currentUser.email;if(!m.requires_signature){await v("Este documento no requiere firmas","error");return}const E=(d=m.signatures)==null?void 0:d.find(B=>B.signer_email===s);if(!E){await v("No est√°s autorizado para firmar este documento","error");return}if(E.signed){await v("Ya has firmado este documento","info");return}if(!C.currentUser.has_signature){await v("Para firmar documentos necesitas tener una firma registrada.","info"),await te("¬øDeseas crear una firma electr√≥nica ahora?")?r("open-electronic-signature"):await v("Necesitas una firma para poder firmar documentos.","warning");return}if(!await te(`¬øEst√°s seguro de que deseas firmar el documento "${m.title}"?`)){await v("Operaci√≥n de firma cancelada","info");return}const I=`dynamic-documents/${m.id}/sign/${y}/`;try{await v("Procesando firma del documento...","info");const B=await fe(I,{});if(B.status===200||B.status===201){await o.init(!0);const L=((M=o.documents)==null?void 0:M.find(X=>X.id===m.id))||m;await v(`¬°Documento "${L.title}" firmado correctamente!`,"success");try{await Ce(Se.FINISH,`Firmaste el documento "${L.title}"`)}catch(X){console.warn("No se pudo registrar la actividad de firma:",X)}Array.isArray(L.signatures)&&L.signatures.length>0&&L.signatures.every(X=>X.signed)?(await v(`El documento "${L.title}" ha sido firmado por todas las partes`,"success"),r("document-fully-signed",L),setTimeout(()=>{r("refresh"),setTimeout(()=>{h("signatures",L)},1500)},500)):(r("refresh"),setTimeout(()=>{h("signatures",L)},1e3))}else throw new Error(`Unexpected server response: ${B.status} ${B.statusText}`)}catch(B){throw console.error("Error in HTTP request:",B),B}}catch(y){console.error("General error signing document:",y),await v(`Error al firmar el documento: ${y.message}`,"error")}},downloadSignedDocument:async m=>{try{if(m.state!=="FullySigned"){v("El documento debe estar completamente firmado para descargarlo","warning");return}if(!m.signatures||m.signatures.length===0){v("El documento no tiene firmas registradas","warning");return}const h=`dynamic-documents/${m.id}/generate-signatures-pdf/`;await dt(h,`firmas_${m.title}.pdf`)}catch(h){console.error("Error downloading signed document:",h),v("Error al descargar el documento firmado","error")}}}}export{bo as B,Mr as D,Ps as L,fa as _,Kr as a,Xr as b,Ta as c,Yr as d,Fe as r,te as s,ft as u};
