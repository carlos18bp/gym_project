import{u as G,H as M,a as L,r as v,c as w,b as R,o as T,d as k,e as u,f as h,g as e,m as z,w as C,v as I,h as m,i as y,k as H,j as U,l as b,n as D,p as c,t as S,x as K,s as a,q,A as O}from"./index-BWL8Y4C8.js";import{u as $,_ as F,a as P}from"./captcha-C9NcaiZ2.js";const W={class:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8"},J={class:"max-w-md w-full"},Q=e("div",{class:"text-center mb-8"},[e("img",{class:"mx-auto h-16 w-auto",src:F,alt:"G&M Abogados"}),e("h2",{class:"mt-6 text-3xl font-bold text-primary"}," Inicia sesión para continuar "),e("p",{class:"mt-2 text-sm text-gray-600"}," Accede a tu cuenta para completar tu suscripción ")],-1),X={class:"bg-white rounded-xl border border-gray-200 shadow-sm p-8"},Y=e("label",{for:"email",class:"block text-sm font-medium text-gray-900 mb-2"}," Correo electrónico ",-1),Z=e("label",{for:"password",class:"block text-sm font-medium text-gray-900 mb-2"}," Contraseña ",-1),ee=["disabled"],se={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},te=e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),ae=e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1),oe=[te,ae],ne={key:0,class:"text-center text-sm mt-2 text-gray-600"},re=e("span",{class:"font-regular"},"Intentar de nuevo en ",-1),ie={class:"font-bold"},le=e("span",{class:"font-regular"}," segundos.",-1),ce={class:"text-center"},de={class:"text-sm text-gray-600"},ue={class:"mt-6"},me=K('<div class="relative"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div><div class="relative flex justify-center text-sm"><span class="px-2 bg-white text-gray-500">O continuar con</span></div></div>',1),pe={class:"mt-6 flex justify-center"},ge={class:"mt-6 text-center"},fe=e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),he={__name:"SubscriptionSignIn",setup(xe){const p=G(),g=M(),r=L(),V=$(),f=v(""),d=v(""),j=async s=>{d.value=s},E=()=>{d.value=""},N=w(()=>r.signInTries),i=w(()=>r.signInSecondsRemaining),n=v(!1),o=R({email:"",password:""});T(async()=>{if(r.attempsSignIn("initial"),f.value=await V.fetchSiteKey(),await r.isAuthenticated()){const s=g.query.plan||"basico";p.push({name:"checkout",params:{plan:s}})}});const A=async()=>{if(!o.email){a("El correo electrónico es requerido","warning");return}if(!o.password){a("La contraseña es requerida","warning");return}if(!d.value){a("Por favor verifica que no eres un robot","warning");return}if(!n.value){if(r.attempsSignIn(),N.value%3===0)a("Has excedido el número máximo de intentos. Intenta más tarde.","warning");else{n.value=!0;try{const s=await q.post("/api/sign_in/",{email:o.email,password:o.password,captcha_token:d.value});r.login(s.data),a("¡Inicio de sesión exitoso!","success");const t=g.query.plan||"basico";p.push({name:"checkout",params:{plan:t}})}catch(s){s.response&&s.response.status===401?a("Credenciales inválidas","warning"):s.response&&s.response.status===400?a(s.response.data.error||"Error de validación","error"):a("Error en el inicio de sesión","error")}finally{n.value=!1}}o.password=""}},B=async s=>{try{const t=O(s.credential),l=await q.post("/api/google_login/",{email:t.email,given_name:t.given_name,family_name:t.family_name,picture:t.picture});r.login(l.data),a("¡Inicio de sesión exitoso con Google!","success");const x=g.query.plan||"basico";p.push({name:"checkout",params:{plan:x}})}catch{a("Error al iniciar sesión con Google","error")}};return(s,t)=>{const l=k("router-link"),x=k("GoogleLogin");return u(),h("div",W,[e("div",J,[Q,e("div",X,[e("form",{class:"space-y-6",onSubmit:z(A,["prevent"])},[e("div",null,[Y,C(e("input",{"onUpdate:modelValue":t[0]||(t[0]=_=>o.email=_),type:"email",id:"email",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-secondary focus:border-secondary block w-full p-2.5",required:""},null,512),[[I,o.email]])]),e("div",null,[Z,C(e("input",{"onUpdate:modelValue":t[1]||(t[1]=_=>o.password=_),type:"password",id:"password",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-secondary focus:border-secondary block w-full p-2.5",required:""},null,512),[[I,o.password]]),m(l,{to:{name:"forget_password"},class:"text-sm font-medium text-secondary hover:text-blue-700 mt-2 inline-block"},{default:y(()=>[c(" ¿Olvidaste tu contraseña? ")]),_:1})]),e("div",null,[f.value?(u(),H(U(P),{key:0,sitekey:f.value,onVerify:j,onExpire:E,hl:"es",class:"mx-auto"},null,8,["sitekey"])):b("",!0)]),e("div",null,[e("button",{type:"submit",disabled:i.value>1||n.value,class:D({"w-full text-white bg-secondary hover:bg-blue-700 font-semibold rounded-lg text-sm px-5 py-3 text-center flex items-center justify-center transition-colors":i.value<1&&!n.value,"w-full text-white bg-gray-400 cursor-not-allowed font-semibold rounded-lg text-sm px-5 py-3 text-center flex items-center justify-center":i.value>=1||n.value})},[n.value?(u(),h("svg",se,oe)):b("",!0),c(" "+S(n.value?"Validando credenciales...":"Iniciar sesión"),1)],10,ee),i.value>0?(u(),h("div",ne,[re,e("span",ie,S(i.value),1),le])):b("",!0)]),e("div",ce,[e("p",de,[c(" ¿No tienes cuenta? "),m(l,{to:{name:"subscription_sign_up",query:{plan:s.$route.query.plan}},class:"font-medium text-secondary hover:text-blue-700"},{default:y(()=>[c(" Regístrate aquí ")]),_:1},8,["to"])])])],32),e("div",ue,[me,e("div",pe,[m(x,{callback:B,"select-account":"","auto-login":!1})])])]),e("div",ge,[m(l,{to:{name:"subscriptions"},class:"text-sm text-gray-600 hover:text-primary flex items-center justify-center gap-2"},{default:y(()=>[fe,c(" Volver a planes ")]),_:1})])])])}}};export{he as default};
