import{e as d,f as l,g as r,a7 as V,u as I,r as g,o as E,c as F,t as m,F as G,H as M,n as b,s as k,j as N,l as S,i as y,w as D,v as C}from"./index.js";import{u as z}from"./dynamicDocument.js";function $(U,i){return d(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})])}const j={key:0,class:"pb-10 px-4 sm:px-6 lg:px-8 lg:pt-10"},H={class:"w-full p-5 rounded-lg border-2 border-stroke bg-terciary"},R={class:"text-primary text-xl font-semibold"},T={class:"mt-4 grid grid-cols-1 gap-6 sm:grid-cols-3"},Z={class:"flex items-center gap-2"},L=["for"],P={key:0,class:"relative group"},q={class:"absolute hidden group-hover:block top-2 left-4 transform translate-y-[-100%] px-3 py-2 text-sm text-white bg-gray-800 rounded-lg shadow-lg",style:{"white-space":"nowrap","z-index":"10"}},A=["onUpdate:modelValue","id"],J=["onUpdate:modelValue","id"],K={class:"mt-6 flex space-x-4"},O=["disabled"],Q={key:1,class:"text-center text-gray-500"},W=r("p",null,"Cargando documento...",-1),X=[W],te={__name:"DocumentForm",setup(U){const i=V(),f=I(),s=z(),c=g(null),e=g(null),p=g(!1);E(async()=>{var a;const u=i.params.id;p.value=i.params.mode=="editor",c.value=await s.documentById(u),i.params.mode=="creator"&&(e.value={title:i.params.title,variables:c.value.variables,content:c.value.content,created_by:c.value.created_by,assigned_to:((a=s.currentUser)==null?void 0:a.id)||null}),i.params.mode=="editor"&&(e.value=c.value,e.value.title=i.params.title)});const h=F(()=>{var u;return(u=e.value)==null?void 0:u.variables.every(a=>a.value&&a.value.trim().length>0)}),x=async(u="Draft")=>{var a,t;try{e.value.state=u;let o=null;if(p.value&&e.value.id)await s.updateDocument(e.value.id,e.value),o=e.value.id;else{(a=s.currentUser)!=null&&a.id&&!e.value.client_id&&(e.value.created_by=s.currentUser.id),e.value.variables&&(e.value.variables=e.value.variables.map(n=>({name_en:n.name_en,name_es:n.name_es,field_type:n.field_type,value:n.value,tooltip:n.tooltip})));const _=s.documents.length,v=await s.createDocument(e.value);if(v&&v.id)o=v.id;else{await s.init();const n=s.documents.filter(w=>w.title===e.value.title&&w.content===e.value.content);n.length>0?o=n[n.length-1].id:(o=(t=s.documents[s.documents.length-1])==null?void 0:t.id,o||(o=s.lastUpdatedDocumentId))}}o&&(localStorage.setItem("lastUpdatedDocumentId",o.toString()),s.lastUpdatedDocumentId=o),await k("Documento guardado exitosamente","success"),setTimeout(()=>{f.push("/dynamic_document_dashboard")},500)}catch(o){console.error("Error saving document:",o),await k("Error al guardar documento","error")}},B=()=>{f.push("/dynamic_document_dashboard")};return(u,a)=>e.value?(d(),l("div",j,[r("div",H,[r("div",null,[r("h1",R,m(e.value.title),1)]),r("div",T,[(d(!0),l(G,null,M(e.value.variables,(t,o)=>(d(),l("div",{key:o,class:b({"col-span-3":t.field_type==="text_area","col-span-1":t.field_type==="input"})},[r("div",Z,[r("label",{for:"field-"+o,class:"text-base font-medium text-primary"},m(t.name_es||t.name_en),9,L),t.tooltip?(d(),l("div",P,[N(S($),{class:"size-5 text-gray-400 hover:text-secondary cursor-pointer"}),r("div",q,m(t.tooltip),1)])):y("",!0)]),t.field_type==="input"?D((d(),l("input",{key:0,type:"text","onUpdate:modelValue":_=>t.value=_,id:"field-"+o,class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300"},null,8,A)),[[C,t.value]]):y("",!0),t.field_type==="text_area"?D((d(),l("textarea",{key:1,"onUpdate:modelValue":_=>t.value=_,id:"field-"+o,class:"block w-full rounded-md border-0 py-1.5 text-primary shadow-sm ring-1 ring-inset ring-gray-300"},null,8,J)),[[C,t.value]]):y("",!0)],2))),128))]),r("div",K,[r("button",{type:"button",class:"p-2.5 text-sm font-medium rounded-md flex gap-2 bg-secondary text-white",onClick:a[0]||(a[0]=t=>x("Progress"))},m(p.value?"Guardar cambios como Borrador":"Guardar progreso"),1),r("button",{type:"button",class:b(["p-2.5 text-sm font-medium rounded-md flex gap-2",h.value?"bg-secondary text-white":"bg-gray-200 text-secondary border-2 border-dashed border-secondary cursor-not-allowed bg-opacity-50"]),disabled:!h.value,onClick:a[1]||(a[1]=t=>x("Completed"))},m(p.value?"Completar y Generar":"Generar"),11,O),r("button",{onClick:a[2]||(a[2]=t=>B()),type:"button",class:"p-2.5 text-sm font-medium rounded-md flex gap-2 bg-red-600/80 text-white cursor-pointer"}," Cancelar ")])])])):(d(),l("div",Q,X))}};export{te as default};
